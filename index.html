<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Oodinals-v2.0</title>

  
  <script>
    if (!window.__NEXUS_RAW_FETCH__ && window.fetch) {
      try { window.__NEXUS_RAW_FETCH__ = window.fetch.bind(window); } catch (_) {}
    }

    try {
      document.documentElement.setAttribute('dir', 'ltr');
      document.documentElement.style.direction = 'ltr';
      const enforceLTR = () => {
        try {
          document.documentElement.setAttribute('dir', 'ltr');
          document.documentElement.style.direction = 'ltr';
          const nodes = document.querySelectorAll('input, textarea, select, [contenteditable]');
          nodes.forEach((el) => {
            try {
              el.setAttribute('dir', 'ltr');
              el.style.direction = 'ltr';
              el.style.unicodeBidi = 'plaintext';
              el.style.textAlign = 'left';
            } catch (_) {}
          });
        } catch (_) {}
      };
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', enforceLTR, { once: true });
      } else {
        enforceLTR();
      }
      document.addEventListener('focusin', enforceLTR, true);
      setInterval(enforceLTR, 1000);
    } catch (_) {}
  </script>

  
  <style>
    html, body, *, *::before, *::after {
      direction: ltr !important;
      unicode-bidi: plaintext;
    }
    textarea, input, select, [contenteditable] {
      direction: ltr !important;
      unicode-bidi: plaintext;
      text-align: left !important;
    }
  </style>

  <script>
    (function () {
      try {
        const params = new URLSearchParams(window.location.search || '');
        const forceOrd = params.get('forceOrd') === '1' || params.get('forceOrd') === 'true';
        const qsOrigin = params.get('ordOrigin') || params.get('ordinalsOrigin') || '';
        const storedOrigin = (function () {
          try { return window.localStorage && window.localStorage.getItem('NEXUS_ORDINALS_ORIGIN'); } catch (_) { return ''; }
        })();





        let defaultOrigin = '';
        try {
          const host = String(window.location && window.location.hostname ? window.location.hostname : '');
          const proto = String(window.location && window.location.protocol ? window.location.protocol : '');
          const isLocal = host === 'localhost' || host === '127.0.0.1';
          const isGitHubPages = host.endsWith('.github.io');
          const isFile = proto === 'file:';
          if (isLocal || isGitHubPages || isFile) defaultOrigin = 'https://ordinals.com';
        } catch (_) {}

        const origin = (forceOrd ? 'https://ordinals.com' : (qsOrigin || storedOrigin || defaultOrigin || '')).trim();
        window.__NEXUS_ORDINALS_ORIGIN__ = origin;
        window.__NEXUS_ORDINALS_ORIGIN_CONFIRMED__ = false;
        window.__NEXUS_WEB_BUILD__ = true;
      } catch (_) {
        window.__NEXUS_ORDINALS_ORIGIN__ = '';
        window.__NEXUS_ORDINALS_ORIGIN_CONFIRMED__ = false;
        window.__NEXUS_WEB_BUILD__ = true;
      }
    })();
  </script>

    
    <script>
      (function () {
        function debugEnabled() {
          try {
            const qs = String(window.location.search || '');
            if (/([?&])walletDebug=1([&#]|$)/.test(qs)) return true;
            const v = window.localStorage && window.localStorage.getItem('NEXUS_WALLET_DEBUG');
            return v === '1' || v === 'true' || window.NEXUS_WALLET_DEBUG === true;
          } catch (_) {
            return window.NEXUS_WALLET_DEBUG === true;
          }
        }

        if (!debugEnabled()) return;
        try { window.NEXUS_WALLET_DEBUG = true; } catch (_) {}

        function safeStringify(obj) {
          try { return JSON.stringify(obj, null, 2); } catch (e) { return String(e && e.message ? e.message : e); }
        }

        function getSnapshot() {
          const w = window;
          return {
            href: String(w.location && w.location.href ? w.location.href : ''),
            userAgent: String(w.navigator && w.navigator.userAgent ? w.navigator.userAgent : ''),
            ordinalsOrigin: typeof w.__NEXUS_ORDINALS_ORIGIN__ === 'string' ? w.__NEXUS_ORDINALS_ORIGIN__ : null,
            ordinalsConfirmed: w.__NEXUS_ORDINALS_ORIGIN_CONFIRMED__ === true,
            hasOkxBitcoin: !!(w.okxwallet && w.okxwallet.bitcoin),
            hasUnisat: !!w.unisat,
            hasXverse: !!(w.BitcoinProvider || w.XverseProviders),
            hasMagicEden: !!(w.magicEden && w.magicEden.bitcoin),
            hasPhantom: !!(w.phantom && w.phantom.bitcoin)
          };
        }

        function install() {
          if (document.getElementById('nexus-mini-debug')) return;

          const btn = document.createElement('button');
          btn.id = 'nexus-mini-debug-btn';
          btn.type = 'button';
          btn.textContent = 'DEBUG';
          btn.style.cssText = 'position:fixed;right:12px;bottom:12px;z-index:2147483647;background:rgba(10,10,12,.85);color:#e6e6e6;border:1px solid rgba(255,255,255,.18);border-radius:999px;padding:8px 12px;font:600 12px ui-monospace,Menlo,Consolas,monospace;cursor:pointer;';

          const panel = document.createElement('div');
          panel.id = 'nexus-mini-debug';
          panel.style.cssText = 'display:none;position:fixed;right:12px;bottom:54px;z-index:2147483647;width:min(420px,calc(100vw - 24px));max-height:40vh;overflow:hidden;background:rgba(10,10,12,.92);color:#e6e6e6;border:1px solid rgba(255,255,255,.18);border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,.35);font:12px ui-monospace,Menlo,Consolas,monospace;';

          const header = document.createElement('div');
          header.style.cssText = 'display:flex;align-items:center;justify-content:space-between;padding:8px 10px;border-bottom:1px solid rgba(255,255,255,.14);';
          header.textContent = 'Nexus Debug';

          const actions = document.createElement('div');
          actions.style.cssText = 'display:flex;gap:8px;';

          const mkBtn = (label, fn) => {
            const b = document.createElement('button');
            b.type = 'button';
            b.textContent = label;
            b.style.cssText = 'background:rgba(255,255,255,.08);color:#e6e6e6;border:1px solid rgba(255,255,255,.18);border-radius:8px;padding:4px 8px;cursor:pointer;';
            b.onclick = fn;
            return b;
          };

          const pre = document.createElement('pre');
          pre.style.cssText = 'margin:0;padding:10px;overflow:auto;white-space:pre-wrap;word-break:break-word;max-height:calc(40vh - 42px);';

          const lines = [];
          function append(line) {
            const ts = new Date().toISOString();
            lines.push('[' + ts + '] ' + line);
            while (lines.length > 250) lines.shift();
            pre.textContent = lines.join('\n');
            pre.scrollTop = pre.scrollHeight;
          }

          function snapshot() {
            append('--- snapshot ---');
            append(safeStringify(getSnapshot()));
          }

          actions.appendChild(mkBtn('Snap', snapshot));
          actions.appendChild(mkBtn('Clear', () => { lines.length = 0; pre.textContent = ''; }));
          actions.appendChild(mkBtn('Close', () => { panel.style.display = 'none'; }));
          header.appendChild(actions);
          panel.appendChild(header);
          panel.appendChild(pre);

          btn.onclick = () => {
            panel.style.display = (panel.style.display === 'none') ? 'block' : 'none';
            if (panel.style.display === 'block' && !pre.textContent) snapshot();
          };

          window.addEventListener('error', (ev) => {
            try { append('window.error: ' + String(ev && ev.message ? ev.message : ev)); } catch (_) {}
          });
          window.addEventListener('unhandledrejection', (ev) => {
            try { append('unhandledrejection: ' + String(ev && ev.reason ? (ev.reason.message || ev.reason) : ev)); } catch (_) {}
          });

          document.body.appendChild(btn);
          document.body.appendChild(panel);
          window.__NEXUS_DEBUG_APPEND__ = append;
        }

        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', install, { once: true });
        } else {
          install();
        }
      })();
    </script>

 <script>
(function nexusOrdinalsViewerWrapper() {
  if (window.NexusOrdinalsWrapper && window.NexusOrdinalsWrapper.__installed__) return;

 const FALLBACK_ORIGIN = '';

  function isHttpLike() {
    try {
      return window.location.protocol === 'http:' || window.location.protocol === 'https:';
    } catch (_) {
      return false;
    }
  }

  if (!window.__NEXUS_RAW_FETCH__ && window.fetch) {
    try {
      window.__NEXUS_RAW_FETCH__ = window.fetch.bind(window);
    } catch (_) {}
  }

  function isOrdinalsDomainHost() {
    try {
      const hostname = window.location.hostname;
      return hostname === 'ordinals.com' || hostname.endsWith('.ordinals.com');
    } catch (_) {
      return false;
    }
  }

  function shouldFallbackPath(pathname) {
    return (
      pathname === '/r/blockheight' ||
      pathname === '/blockheight' ||
      pathname === '/blockhash' ||
      pathname.startsWith('/blockhash/') ||
      pathname === '/blocktime' ||
      pathname.startsWith('/r/') ||
      pathname.startsWith('/content/')
    );
  }

  function joinOrdinals(origin, pathOrUrl) {
    if (!pathOrUrl) return origin;
    if (/^(https?:)?\/\//i.test(pathOrUrl)) return pathOrUrl;
    return `${origin}${pathOrUrl}`;
  }

  function getPreferredOriginSync() {
    if (isOrdinalsDomainHost()) return '';
    if (typeof window.__NEXUS_ORDINALS_ORIGIN__ === 'string') {
      const origin = window.__NEXUS_ORDINALS_ORIGIN__;
      return origin || '';
    }
    return '';
  }

  function rewriteOrdinalsUrlCandidate(value) {
    if (typeof value !== 'string') return value;
    const origin = getPreferredOriginSync();
    if (/^(https?:)?\/\//i.test(value)) return value;
    if (value.startsWith('/') && shouldFallbackPath(value.split('?')[0])) {
      return origin ? `${origin}${value}` : value;
    }
    return value;
  }

  function isHtmlResponse(resp) {
    try {
      const ct = String(resp && resp.headers && resp.headers.get ? (resp.headers.get('content-type') || '') : '');
      return /text\/html/i.test(ct);
    } catch (_) {
      return false;
    }
  }

  async function detectOrdinalsOrigin() {
    try {
      if (isOrdinalsDomainHost()) {
        window.__NEXUS_ORDINALS_ORIGIN_CONFIRMED__ = true;
        window.__NEXUS_ORDINALS_ORIGIN__ = '';
        return '';
      }

      const rawFetch = window.__NEXUS_RAW_FETCH__ || (window.fetch && window.fetch.bind(window));
      if (rawFetch) {
        const resp = await rawFetch('/r/blockheight', {
          cache: 'no-store',
          headers: { 'Accept': 'application/json' }
        });

        if (resp && resp.ok) {
          const ct = String(resp.headers && resp.headers.get ? (resp.headers.get('content-type') || '') : '');
          const text = await resp.text();
          const trimmed = String(text || '').trim();
          if (!/text\/html/i.test(ct) && /^\d+$/.test(trimmed)) {
            const n = parseInt(trimmed, 10);
            if (Number.isFinite(n) && n > 0) {
              window.__NEXUS_ORDINALS_ORIGIN_CONFIRMED__ = true;
              window.__NEXUS_ORDINALS_ORIGIN__ = '';
              return '';
            }
          }
        }
      }
    } catch (_) {}

    const configured = (typeof window.__NEXUS_ORDINALS_ORIGIN__ === 'string' ? window.__NEXUS_ORDINALS_ORIGIN__ : '') || '';
    return configured || FALLBACK_ORIGIN;
  }

  function detectOrdinalsOriginCached() {
    if (!window.__NEXUS_ORDINALS_ORIGIN_PROMISE__) {
      window.__NEXUS_ORDINALS_ORIGIN_PROMISE__ = (async () => {
        const origin = await detectOrdinalsOrigin();
        window.__NEXUS_ORDINALS_ORIGIN__ = origin;
        return origin;
      })();
    }
    return window.__NEXUS_ORDINALS_ORIGIN_PROMISE__;
  }

  function installFetchFallback() {
    if (window.__NEXUS_ORDINALS_FETCH_FALLBACK_INSTALLED__) return;
    window.__NEXUS_ORDINALS_FETCH_FALLBACK_INSTALLED__ = true;

    const originalFetch = window.__NEXUS_RAW_FETCH__ || (window.fetch && window.fetch.bind(window));
    if (!originalFetch) return;

    const wrappedFetch = async function fetchWithOrdinalsFallback(input, init) {
      const method = String((init && init.method) || (input && input.method) || 'GET').toUpperCase();
      if (method !== 'GET' && method !== 'HEAD') return originalFetch(input, init);

      let url;
      try {
        if (typeof input === 'string' || input instanceof URL) {
          url = new URL(String(input), window.location.href);
        } else if (input && typeof input.url === 'string') {
          url = new URL(input.url);
        }
      } catch (_) {
        return originalFetch(input, init);
      }

      if (!url || !shouldFallbackPath(url.pathname)) return originalFetch(input, init);


      const isREndpoint = url.pathname.startsWith('/r/');
      const enhancedInit = (isREndpoint && init)
        ? { ...init, headers: { 'Accept': 'application/json', ...(init.headers || {}) } }
        : (isREndpoint ? { headers: { 'Accept': 'application/json' } } : init);

     const origin = getPreferredOriginSync() || FALLBACK_ORIGIN;
      if (origin) {
        const rewritten = `${origin}${url.pathname}${url.search}`;
        try {
          const resp = await originalFetch(rewritten, enhancedInit);
          if (resp && resp.ok) {
            if (!isHtmlResponse(resp)) return resp;

            if (isREndpoint) {
              try {
                const cloned = resp.clone();
                const text = await cloned.text();
                const trimmed = text.trim();
                if (trimmed.startsWith('{') || trimmed.startsWith('[') || trimmed.startsWith('"')) {
                  return new Response(text, {
                    status: resp.status,
                    statusText: resp.statusText,
                    headers: { 'Content-Type': 'application/json' }
                  });
                }
              } catch (_) {}
            }
          }
        } catch (_) {}
      }

     return originalFetch(input, enhancedInit || init);
    };

    window.fetch = wrappedFetch;


    setInterval(() => {
      try {
        if (window.fetch !== wrappedFetch) {
          window.fetch = wrappedFetch;
        }
      } catch (_) {}
    }, 1000);
  }

  function installSrcHrefRewriter() {
    if (window.__NEXUS_ORDINALS_SRC_HREF_REWRITER_INSTALLED__) return;
    window.__NEXUS_ORDINALS_SRC_HREF_REWRITER_INSTALLED__ = true;

    try {
      const scriptSrc = Object.getOwnPropertyDescriptor(HTMLScriptElement.prototype, 'src');
      if (scriptSrc && typeof scriptSrc.set === 'function' && typeof scriptSrc.get === 'function') {
        Object.defineProperty(HTMLScriptElement.prototype, 'src', {
          configurable: true,
          enumerable: scriptSrc.enumerable,
          get: function() { return scriptSrc.get.call(this); },
          set: function(v) { return scriptSrc.set.call(this, rewriteOrdinalsUrlCandidate(v)); }
        });
      }
    } catch (_) {}

    try {
      const linkHref = Object.getOwnPropertyDescriptor(HTMLLinkElement.prototype, 'href');
      if (linkHref && typeof linkHref.set === 'function' && typeof linkHref.get === 'function') {
        Object.defineProperty(HTMLLinkElement.prototype, 'href', {
          configurable: true,
          enumerable: linkHref.enumerable,
          get: function() { return linkHref.get.call(this); },
          set: function(v) { return linkHref.set.call(this, rewriteOrdinalsUrlCandidate(v)); }
        });
      }
    } catch (_) {}

    try {
      const origSetAttr = Element.prototype.setAttribute;
      Element.prototype.setAttribute = function(name, value) {
        try {
          const n = String(name || '').toLowerCase();
          if ((n === 'src' && this && this.tagName === 'SCRIPT') || (n === 'href' && this && this.tagName === 'LINK')) {
            return origSetAttr.call(this, name, rewriteOrdinalsUrlCandidate(String(value)));
          }
        } catch (_) {}
        return origSetAttr.call(this, name, value);
      };
    } catch (_) {}
  }

  function install() {
    window.__NEXUS_DETECT_ORDINALS_ORIGIN__ = detectOrdinalsOriginCached;
    installFetchFallback();
    installSrcHrefRewriter();
    detectOrdinalsOriginCached().catch(() => FALLBACK_ORIGIN);
  }

  window.NexusOrdinalsWrapper = {
    __installed__: true,
    install,
    detectOrdinalsOrigin: detectOrdinalsOriginCached,
    getOriginSync: getPreferredOriginSync,
    joinOrdinals,
    ordinalsUrl: function ordinalsUrl(pathOrUrl) {
      const origin = getPreferredOriginSync();
      return joinOrdinals(origin || FALLBACK_ORIGIN, pathOrUrl);
    },
    rewriteOrdinalsUrlCandidate
  };

  install();
})();
  </script>


<script>
    const originalDefineProperty = Object.defineProperty;
    const originalDefineProperties = Object.defineProperties;

    Object.defineProperty = function(obj, prop, descriptor) {
      try {
        return originalDefineProperty.call(this, obj, prop, descriptor);
      } catch (e) {
        const msg = String(e && e.message ? e.message : '');
        if (msg.includes('redefine property') || msg.includes('Cannot redefine property')) {
          return obj;
        }
        throw e;
      }
    };

    Object.defineProperties = function(obj, props) {
      try {
        return originalDefineProperties.call(this, obj, props);
      } catch (e) {
        const msg = String(e && e.message ? e.message : '');
        if (msg.includes('redefine property') || msg.includes('Cannot redefine property')) {
          return obj;
        }
        throw e;
      }
    };
  </script>

 <script>
    window.tailwind = window.tailwind || {};
    window.tailwind.config = {
      theme: {
        extend: {
          colors: {
            neutral: {
              50: '#fafafa',
              100: '#f5f5f5',
              200: '#e5e5e5',
              300: '#d4d4d4',
              400: '#a3a3a3',
              500: '#737373',
              600: '#525252',
              700: '#404040',
              800: '#262626',
              900: '#171717',
              950: '#0a0a0a'
            }
          },
          animation: {
            'fade-in': 'fadeIn 0.2s ease-out',
            'scale-in': 'scaleIn 0.2s ease-out',
            'slide-down': 'slideDown 0.3s ease-out',
            'slide-up': 'slideUp 0.3s ease-out'
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' }
            },
            scaleIn: {
              '0%': { transform: 'scale(0.95)', opacity: '0' },
              '100%': { transform: 'scale(1)', opacity: '1' }
            },
            slideDown: {
              '0%': { transform: 'translateY(-20px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' }
            },
            slideUp: {
              '0%': { transform: 'translateY(20px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' }
            }
          }
        }
      }
    };
  </script>

 <script>
  (function () {
    try {
      const inferredDefault = (function () {
        try {
          const host = String(window.location && window.location.hostname ? window.location.hostname : '');
          const proto = String(window.location && window.location.protocol ? window.location.protocol : '');
          const isLocal = host === 'localhost' || host === '127.0.0.1';
          const isGitHubPages = host.endsWith('.github.io');
          const isFile = proto === 'file:';
          return (isLocal || isGitHubPages || isFile) ? 'https://ordinals.com' : '';
        } catch (_) {
          return '';
        }
      })();

      const origin = (typeof window.__NEXUS_ORDINALS_ORIGIN__ === 'string' ? window.__NEXUS_ORDINALS_ORIGIN__ : '') || '';
      const effectiveOrigin = origin || inferredDefault || '';
      const src = (effectiveOrigin ? effectiveOrigin : '') + '/content/609b117277f1e9c9f27f358fe02db34e13d08915bbcea18770dc36f5f3afcbb2i2';
      const s = document.createElement('script');
      s.src = src;
      document.head.appendChild(s);
    } catch (e) {
      try { window.__NEXUS_DEBUG_APPEND__ && window.__NEXUS_DEBUG_APPEND__('tailwind inject failed: ' + (e && e.message ? e.message : e)); } catch (_) {}
    }
  })();
 </script>

 <script>
    window.__VITE_PRELOAD__ = () => Promise.resolve();
    window.__NEXUS_LOADING_DEPS__ = true;

    (async function loadCryptoDependencies() {
      const inferredDefault = (function () {
        try {
          const host = String(window.location && window.location.hostname ? window.location.hostname : '');
          const proto = String(window.location && window.location.protocol ? window.location.protocol : '');
          const isLocal = host === 'localhost' || host === '127.0.0.1';
          const isGitHubPages = host.endsWith('.github.io');
          const isFile = proto === 'file:';
          return (isLocal || isGitHubPages || isFile) ? 'https://ordinals.com' : '';
        } catch (_) {
          return '';
        }
      })();

      const ORD = (typeof window.__NEXUS_ORDINALS_ORIGIN__ === 'string' ? window.__NEXUS_ORDINALS_ORIGIN__ : '') || inferredDefault || '';
      const join = (path) => (ORD ? (ORD + path) : path);

      const SHA256_URL    = join('/r/sat/1550501128239335/at/-1/content');
      const SECP256K1_URL = join('/r/sat/1550501128240727/at/-1/content');

      try {
        const sha256Module = await import(SHA256_URL);
        const sha256     = sha256Module.sha256     || sha256Module.default?.sha256;
        const hmacSha256 = sha256Module.hmacSha256 || sha256Module.default?.hmacSha256;

        const secp       = await import(SECP256K1_URL);
        const secpModule = secp.default || secp;

        if (secpModule.etc) {
          secpModule.etc.hmacSha256Sync = (key, ...msgs) => hmacSha256(key, ...msgs);
        }
        if (secpModule.utils) {
          secpModule.utils.sha256Sync     = sha256;
          secpModule.utils.hmacSha256Sync = hmacSha256;
        }
        if (secpModule.hashes) {
          secpModule.hashes.sha256          = sha256;
          secpModule.hashes.hmacSha256      = hmacSha256;
          secpModule.hashes.sha256Async     = async (data) => sha256(data);
          secpModule.hashes.hmacSha256Async = async (key, ...msgs) => hmacSha256(key, ...msgs);
        }

        window.secp256k1    = secpModule;
        window.crypto_sha256 = { sha256, hmacSha256 };

   window.__NEXUS_CRYPTO_READY__ = true;
        window.dispatchEvent(new CustomEvent('nexus-crypto-ready'));
      } catch (error) {
        window.__NEXUS_LOADING_DEPS__ = false;
        window.__NEXUS_DEPS_ERROR__   = error;
        throw error;
      }
    })();
  </script>


  <script>
    (function () {
      try {
        const inferredDefault = (function () {
          try {
            const host = String(window.location && window.location.hostname ? window.location.hostname : '');
            const proto = String(window.location && window.location.protocol ? window.location.protocol : '');
            const isLocal = host === 'localhost' || host === '127.0.0.1';
            const isGitHubPages = host.endsWith('.github.io');
            const isFile = proto === 'file:';
            return (isLocal || isGitHubPages || isFile) ? 'https://ordinals.com' : '';
          } catch (_) {
            return '';
          }
        })();

        const origin = (typeof window.__NEXUS_ORDINALS_ORIGIN__ === 'string' ? window.__NEXUS_ORDINALS_ORIGIN__ : '') || '';
        const effectiveOrigin = origin || inferredDefault || '';
        const p = (path) => (effectiveOrigin ? (effectiveOrigin + path) : path);
        const fav = document.getElementById('nexus-favicon');
        if (fav) fav.href = p('/r/sat/1247378084602717/at/-1/content');

        const map = {
          imports: {
            btcapi: p('/r/sat/404079598249183/at/-1/content'),
            'brotli-oc': p('/content/fb483c53bc6938c1df1e25e03e99f726d08a1c0d2db4e0e644c0baf3526a1d60i0')
          }
        };
        const s = document.createElement('script');
        s.type = 'importmap';
        s.textContent = JSON.stringify(map, null, 2);
        document.currentScript.insertAdjacentElement('afterend', s);
      } catch (e) {
        try { window.__NEXUS_DEBUG_APPEND__ && window.__NEXUS_DEBUG_APPEND__('importmap inject failed: ' + (e && e.message ? e.message : e)); } catch (_) {}
      }
    })();
  </script>
  <script type="module" crossorigin>
function e(e,t){for(var n=0;n<t.length;n++){const r=t[n];if("string"!=typeof r&&!Array.isArray(r))for(const t in r)if("default"!==t&&!(t in e)){const n=Object.getOwnPropertyDescriptor(r,t);n&&Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:()=>r[t]})}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const t={},n=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),r=e?.nonce||e?.getAttribute("nonce");i=Promise.allSettled(n.map(e=>{if((e=function(e){return"/"+e}(e))in t)return;t[e]=!0;const n=e.endsWith(".css"),i=n?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${i}`))return;const a=document.createElement("link");return a.rel=n?"stylesheet":"modulepreload",n||(a.as="script"),a.crossOrigin="",a.href=e,r&&a.setAttribute("nonce",r),document.head.appendChild(a),n?new Promise((t,n)=>{a.addEventListener("load",t),a.addEventListener("error",()=>n(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function a(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return i.then(t=>{for(const e of t||[])"rejected"===e.status&&a(e.reason);return e().catch(a)})};function r(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}for(var i={},a={byteLength:function(e){var t=d(e),n=t[0],r=t[1];return 3*(n+r)/4-r},toByteArray:function(e){var t,n,r=d(e),i=r[0],a=r[1],o=new l(function(e,t,n){return 3*(t+n)/4-n}(0,i,a)),c=0,u=a>0?i-4:i;for(n=0;n<u;n+=4)t=s[e.charCodeAt(n)]<<18|s[e.charCodeAt(n+1)]<<12|s[e.charCodeAt(n+2)]<<6|s[e.charCodeAt(n+3)],o[c++]=t>>16&255,o[c++]=t>>8&255,o[c++]=255&t;return 2===a&&(t=s[e.charCodeAt(n)]<<2|s[e.charCodeAt(n+1)]>>4,o[c++]=255&t),1===a&&(t=s[e.charCodeAt(n)]<<10|s[e.charCodeAt(n+1)]<<4|s[e.charCodeAt(n+2)]>>2,o[c++]=t>>8&255,o[c++]=255&t),o},fromByteArray:function(e){for(var t,n=e.length,r=n%3,i=[],a=16383,s=0,l=n-r;s<l;s+=a)i.push(f(e,s,s+a>l?l:s+a));return 1===r?(t=e[n-1],i.push(o[t>>2]+o[t<<4&63]+"==")):2===r&&(t=(e[n-2]<<8)+e[n-1],i.push(o[t>>10]+o[t>>4&63]+o[t<<2&63]+"=")),i.join("")}},o=[],s=[],l="undefined"!=typeof Uint8Array?Uint8Array:Array,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u=0;u<64;++u)o[u]=c[u],s[c.charCodeAt(u)]=u;function d(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function p(e){return o[e>>18&63]+o[e>>12&63]+o[e>>6&63]+o[63&e]}function f(e,t,n){for(var r,i=[],a=t;a<n;a+=3)r=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),i.push(p(r));return i.join("")}s["-".charCodeAt(0)]=62,s["_".charCodeAt(0)]=63;var m={read:function(e,t,n,r,i){var a,o,s=8*i-r-1,l=(1<<s)-1,c=l>>1,u=-7,d=n?i-1:0,p=n?-1:1,f=e[t+d];for(d+=p,a=f&(1<<-u)-1,f>>=-u,u+=s;u>0;a=256*a+e[t+d],d+=p,u-=8);for(o=a&(1<<-u)-1,a>>=-u,u+=r;u>0;o=256*o+e[t+d],d+=p,u-=8);if(0===a)a=1-c;else{if(a===l)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,r),a-=c}return(f?-1:1)*o*Math.pow(2,a-r)},write:function(e,t,n,r,i,a){var o,s,l,c=8*a-i-1,u=(1<<c)-1,d=u>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:a-1,m=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+d>=1?p/l:p*Math.pow(2,1-d))*l>=2&&(o++,l/=2),o+d>=u?(s=0,o=u):o+d>=1?(s=(t*l-1)*Math.pow(2,i),o+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,i),o=0));i>=8;e[n+f]=255&s,f+=m,s/=256,i-=8);for(o=o<<i|s,c+=i;c>0;e[n+f]=255&o,f+=m,o/=256,c-=8);e[n+f-m]|=128*g}};!function(e){const t=a,n=m,r="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=s,e.SlowBuffer=function(e){return+e!=e&&(e=0),s.alloc(+e)},e.INSPECT_MAX_BYTES=50;const i=2147483647;function o(e){if(e>i)throw new RangeError('The value "'+e+'" is invalid for option "size"');const t=new Uint8Array(e);return Object.setPrototypeOf(t,s.prototype),t}function s(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return u(e)}return l(e,t,n)}function l(e,t,n){if("string"==typeof e)return function(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!s.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const n=0|g(e,t);let r=o(n);const i=r.write(e,t);return i!==n&&(r=r.slice(0,i)),r}(e,t);if(ArrayBuffer.isView(e))return function(e){if(G(e,Uint8Array)){const t=new Uint8Array(e);return p(t.buffer,t.byteOffset,t.byteLength)}return d(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(G(e,ArrayBuffer)||e&&G(e.buffer,ArrayBuffer))return p(e,t,n);if("undefined"!=typeof SharedArrayBuffer&&(G(e,SharedArrayBuffer)||e&&G(e.buffer,SharedArrayBuffer)))return p(e,t,n);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');const r=e.valueOf&&e.valueOf();if(null!=r&&r!==e)return s.from(r,t,n);const i=function(e){if(s.isBuffer(e)){const t=0|f(e.length),n=o(t);return 0===n.length||e.copy(n,0,0,t),n}return void 0!==e.length?"number"!=typeof e.length||Y(e.length)?o(0):d(e):"Buffer"===e.type&&Array.isArray(e.data)?d(e.data):void 0}(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return s.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function c(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function u(e){return c(e),o(e<0?0:0|f(e))}function d(e){const t=e.length<0?0:0|f(e.length),n=o(t);for(let r=0;r<t;r+=1)n[r]=255&e[r];return n}function p(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');let r;return r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),Object.setPrototypeOf(r,s.prototype),r}function f(e){if(e>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return 0|e}function g(e,t){if(s.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||G(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);const n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;let i=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return q(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return X(e).length;default:if(i)return r?-1:q(e).length;t=(""+t).toLowerCase(),i=!0}}function h(e,t,n){let r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return B(this,t,n);case"utf8":case"utf-8":return A(this,t,n);case"ascii":return T(this,t,n);case"latin1":case"binary":return C(this,t,n);case"base64":return I(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function b(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function y(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),Y(n=+n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=s.from(t,r)),s.isBuffer(t))return 0===t.length?-1:x(e,t,n,r,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):x(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function x(e,t,n,r,i){let a,o=1,s=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;o=2,s/=2,l/=2,n/=2}function c(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){let r=-1;for(a=n;a<s;a++)if(c(e,a)===c(t,-1===r?0:a-r)){if(-1===r&&(r=a),a-r+1===l)return r*o}else-1!==r&&(a-=a-r),r=-1}else for(n+l>s&&(n=s-l),a=n;a>=0;a--){let n=!0;for(let r=0;r<l;r++)if(c(e,a+r)!==c(t,r)){n=!1;break}if(n)return a}return-1}function w(e,t,n,r){n=Number(n)||0;const i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;const a=t.length;let o;for(r>a/2&&(r=a/2),o=0;o<r;++o){const r=parseInt(t.substr(2*o,2),16);if(Y(r))return o;e[n+o]=r}return o}function v(e,t,n,r){return K(q(t,e.length-n),e,n,r)}function S(e,t,n,r){return K(function(e){const t=[];for(let n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function E(e,t,n,r){return K(X(t),e,n,r)}function N(e,t,n,r){return K(function(e,t){let n,r,i;const a=[];for(let o=0;o<e.length&&!((t-=2)<0);++o)n=e.charCodeAt(o),r=n>>8,i=n%256,a.push(i),a.push(r);return a}(t,e.length-n),e,n,r)}function I(e,n,r){return 0===n&&r===e.length?t.fromByteArray(e):t.fromByteArray(e.slice(n,r))}function A(e,t,n){n=Math.min(e.length,n);const r=[];let i=t;for(;i<n;){const t=e[i];let a=null,o=t>239?4:t>223?3:t>191?2:1;if(i+o<=n){let n,r,s,l;switch(o){case 1:t<128&&(a=t);break;case 2:n=e[i+1],128==(192&n)&&(l=(31&t)<<6|63&n,l>127&&(a=l));break;case 3:n=e[i+1],r=e[i+2],128==(192&n)&&128==(192&r)&&(l=(15&t)<<12|(63&n)<<6|63&r,l>2047&&(l<55296||l>57343)&&(a=l));break;case 4:n=e[i+1],r=e[i+2],s=e[i+3],128==(192&n)&&128==(192&r)&&128==(192&s)&&(l=(15&t)<<18|(63&n)<<12|(63&r)<<6|63&s,l>65535&&l<1114112&&(a=l))}}null===a?(a=65533,o=1):a>65535&&(a-=65536,r.push(a>>>10&1023|55296),a=56320|1023&a),r.push(a),i+=o}return function(e){const t=e.length;if(t<=k)return String.fromCharCode.apply(String,e);let n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=k));return n}(r)}e.kMaxLength=i,s.TYPED_ARRAY_SUPPORT=function(){try{const e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),!s.TYPED_ARRAY_SUPPORT&&"undefined"!=typeof console&&console.error,Object.defineProperty(s.prototype,"parent",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.buffer}}),Object.defineProperty(s.prototype,"offset",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.byteOffset}}),s.poolSize=8192,s.from=function(e,t,n){return l(e,t,n)},Object.setPrototypeOf(s.prototype,Uint8Array.prototype),Object.setPrototypeOf(s,Uint8Array),s.alloc=function(e,t,n){return function(e,t,n){return c(e),e<=0?o(e):void 0!==t?"string"==typeof n?o(e).fill(t,n):o(e).fill(t):o(e)}(e,t,n)},s.allocUnsafe=function(e){return u(e)},s.allocUnsafeSlow=function(e){return u(e)},s.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==s.prototype},s.compare=function(e,t){if(G(e,Uint8Array)&&(e=s.from(e,e.offset,e.byteLength)),G(t,Uint8Array)&&(t=s.from(t,t.offset,t.byteLength)),!s.isBuffer(e)||!s.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let n=e.length,r=t.length;for(let i=0,a=Math.min(n,r);i<a;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},s.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return s.alloc(0);let n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;const r=s.allocUnsafe(t);let i=0;for(n=0;n<e.length;++n){let t=e[n];if(G(t,Uint8Array))i+t.length>r.length?(s.isBuffer(t)||(t=s.from(t)),t.copy(r,i)):Uint8Array.prototype.set.call(r,t,i);else{if(!s.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(r,i)}i+=t.length}return r},s.byteLength=g,s.prototype._isBuffer=!0,s.prototype.swap16=function(){const e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)b(this,t,t+1);return this},s.prototype.swap32=function(){const e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)b(this,t,t+3),b(this,t+1,t+2);return this},s.prototype.swap64=function(){const e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)b(this,t,t+7),b(this,t+1,t+6),b(this,t+2,t+5),b(this,t+3,t+4);return this},s.prototype.toString=function(){const e=this.length;return 0===e?"":0===arguments.length?A(this,0,e):h.apply(this,arguments)},s.prototype.toLocaleString=s.prototype.toString,s.prototype.equals=function(e){if(!s.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===s.compare(this,e)},s.prototype.inspect=function(){let t="";const n=e.INSPECT_MAX_BYTES;return t=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(t+=" ... "),"<Buffer "+t+">"},r&&(s.prototype[r]=s.prototype.inspect),s.prototype.compare=function(e,t,n,r,i){if(G(e,Uint8Array)&&(e=s.from(e,e.offset,e.byteLength)),!s.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;let a=(i>>>=0)-(r>>>=0),o=(n>>>=0)-(t>>>=0);const l=Math.min(a,o),c=this.slice(r,i),u=e.slice(t,n);for(let s=0;s<l;++s)if(c[s]!==u[s]){a=c[s],o=u[s];break}return a<o?-1:o<a?1:0},s.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},s.prototype.indexOf=function(e,t,n){return y(this,e,t,n,!0)},s.prototype.lastIndexOf=function(e,t,n){return y(this,e,t,n,!1)},s.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}const i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");let a=!1;for(;;)switch(r){case"hex":return w(this,e,t,n);case"utf8":case"utf-8":return v(this,e,t,n);case"ascii":case"latin1":case"binary":return S(this,e,t,n);case"base64":return E(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return N(this,e,t,n);default:if(a)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),a=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const k=4096;function T(e,t,n){let r="";n=Math.min(e.length,n);for(let i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function C(e,t,n){let r="";n=Math.min(e.length,n);for(let i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function B(e,t,n){const r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);let i="";for(let a=t;a<n;++a)i+=J[e[a]];return i}function P(e,t,n){const r=e.slice(t,n);let i="";for(let a=0;a<r.length-1;a+=2)i+=String.fromCharCode(r[a]+256*r[a+1]);return i}function _(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function O(e,t,n,r,i,a){if(!s.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function L(e,t,n,r,i){H(t,r,i,e,n,7);let a=Number(t&BigInt(4294967295));e[n++]=a,a>>=8,e[n++]=a,a>>=8,e[n++]=a,a>>=8,e[n++]=a;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o,n}function F(e,t,n,r,i){H(t,r,i,e,n,7);let a=Number(t&BigInt(4294967295));e[n+7]=a,a>>=8,e[n+6]=a,a>>=8,e[n+5]=a,a>>=8,e[n+4]=a;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[n+3]=o,o>>=8,e[n+2]=o,o>>=8,e[n+1]=o,o>>=8,e[n]=o,n+8}function M(e,t,n,r,i,a){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function R(e,t,r,i,a){return t=+t,r>>>=0,a||M(e,0,r,4),n.write(e,t,r,i,23,4),r+4}function $(e,t,r,i,a){return t=+t,r>>>=0,a||M(e,0,r,8),n.write(e,t,r,i,52,8),r+8}s.prototype.slice=function(e,t){const n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);const r=this.subarray(e,t);return Object.setPrototypeOf(r,s.prototype),r},s.prototype.readUintLE=s.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||_(e,t,this.length);let r=this[e],i=1,a=0;for(;++a<t&&(i*=256);)r+=this[e+a]*i;return r},s.prototype.readUintBE=s.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||_(e,t,this.length);let r=this[e+--t],i=1;for(;t>0&&(i*=256);)r+=this[e+--t]*i;return r},s.prototype.readUint8=s.prototype.readUInt8=function(e,t){return e>>>=0,t||_(e,1,this.length),this[e]},s.prototype.readUint16LE=s.prototype.readUInt16LE=function(e,t){return e>>>=0,t||_(e,2,this.length),this[e]|this[e+1]<<8},s.prototype.readUint16BE=s.prototype.readUInt16BE=function(e,t){return e>>>=0,t||_(e,2,this.length),this[e]<<8|this[e+1]},s.prototype.readUint32LE=s.prototype.readUInt32LE=function(e,t){return e>>>=0,t||_(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},s.prototype.readUint32BE=s.prototype.readUInt32BE=function(e,t){return e>>>=0,t||_(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},s.prototype.readBigUInt64LE=Q(function(e){W(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||j(e,this.length-8);const r=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,i=this[++e]+256*this[++e]+65536*this[++e]+n*2**24;return BigInt(r)+(BigInt(i)<<BigInt(32))}),s.prototype.readBigUInt64BE=Q(function(e){W(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||j(e,this.length-8);const r=t*2**24+65536*this[++e]+256*this[++e]+this[++e],i=this[++e]*2**24+65536*this[++e]+256*this[++e]+n;return(BigInt(r)<<BigInt(32))+BigInt(i)}),s.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||_(e,t,this.length);let r=this[e],i=1,a=0;for(;++a<t&&(i*=256);)r+=this[e+a]*i;return i*=128,r>=i&&(r-=Math.pow(2,8*t)),r},s.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||_(e,t,this.length);let r=t,i=1,a=this[e+--r];for(;r>0&&(i*=256);)a+=this[e+--r]*i;return i*=128,a>=i&&(a-=Math.pow(2,8*t)),a},s.prototype.readInt8=function(e,t){return e>>>=0,t||_(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},s.prototype.readInt16LE=function(e,t){e>>>=0,t||_(e,2,this.length);const n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},s.prototype.readInt16BE=function(e,t){e>>>=0,t||_(e,2,this.length);const n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},s.prototype.readInt32LE=function(e,t){return e>>>=0,t||_(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},s.prototype.readInt32BE=function(e,t){return e>>>=0,t||_(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},s.prototype.readBigInt64LE=Q(function(e){W(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||j(e,this.length-8);const r=this[e+4]+256*this[e+5]+65536*this[e+6]+(n<<24);return(BigInt(r)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)}),s.prototype.readBigInt64BE=Q(function(e){W(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||j(e,this.length-8);const r=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(r)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+n)}),s.prototype.readFloatLE=function(e,t){return e>>>=0,t||_(e,4,this.length),n.read(this,e,!0,23,4)},s.prototype.readFloatBE=function(e,t){return e>>>=0,t||_(e,4,this.length),n.read(this,e,!1,23,4)},s.prototype.readDoubleLE=function(e,t){return e>>>=0,t||_(e,8,this.length),n.read(this,e,!0,52,8)},s.prototype.readDoubleBE=function(e,t){return e>>>=0,t||_(e,8,this.length),n.read(this,e,!1,52,8)},s.prototype.writeUintLE=s.prototype.writeUIntLE=function(e,t,n,r){e=+e,t>>>=0,n>>>=0,r||O(this,e,t,n,Math.pow(2,8*n)-1,0);let i=1,a=0;for(this[t]=255&e;++a<n&&(i*=256);)this[t+a]=e/i&255;return t+n},s.prototype.writeUintBE=s.prototype.writeUIntBE=function(e,t,n,r){e=+e,t>>>=0,n>>>=0,r||O(this,e,t,n,Math.pow(2,8*n)-1,0);let i=n-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+n},s.prototype.writeUint8=s.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||O(this,e,t,1,255,0),this[t]=255&e,t+1},s.prototype.writeUint16LE=s.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||O(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},s.prototype.writeUint16BE=s.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||O(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},s.prototype.writeUint32LE=s.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||O(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},s.prototype.writeUint32BE=s.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||O(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},s.prototype.writeBigUInt64LE=Q(function(e,t=0){return L(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),s.prototype.writeBigUInt64BE=Q(function(e,t=0){return F(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),s.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t>>>=0,!r){const r=Math.pow(2,8*n-1);O(this,e,t,n,r-1,-r)}let i=0,a=1,o=0;for(this[t]=255&e;++i<n&&(a*=256);)e<0&&0===o&&0!==this[t+i-1]&&(o=1),this[t+i]=(e/a|0)-o&255;return t+n},s.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t>>>=0,!r){const r=Math.pow(2,8*n-1);O(this,e,t,n,r-1,-r)}let i=n-1,a=1,o=0;for(this[t+i]=255&e;--i>=0&&(a*=256);)e<0&&0===o&&0!==this[t+i+1]&&(o=1),this[t+i]=(e/a|0)-o&255;return t+n},s.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||O(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},s.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||O(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},s.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||O(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},s.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||O(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},s.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||O(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},s.prototype.writeBigInt64LE=Q(function(e,t=0){return L(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),s.prototype.writeBigInt64BE=Q(function(e,t=0){return F(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),s.prototype.writeFloatLE=function(e,t,n){return R(this,e,t,!0,n)},s.prototype.writeFloatBE=function(e,t,n){return R(this,e,t,!1,n)},s.prototype.writeDoubleLE=function(e,t,n){return $(this,e,t,!0,n)},s.prototype.writeDoubleBE=function(e,t,n){return $(this,e,t,!1,n)},s.prototype.copy=function(e,t,n,r){if(!s.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);const i=r-n;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,r):Uint8Array.prototype.set.call(e,this.subarray(n,r),t),i},s.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!s.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===e.length){const t=e.charCodeAt(0);("utf8"===r&&t<128||"latin1"===r)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;let i;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{const a=s.isBuffer(e)?e:s.from(e,r),o=a.length;if(0===o)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<n-t;++i)this[i+t]=a[i%o]}return this};const U={};function z(e,t,n){U[e]=class extends n{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function D(e){let t="",n=e.length;const r="-"===e[0]?1:0;for(;n>=r+4;n-=3)t=`_${e.slice(n-3,n)}${t}`;return`${e.slice(0,n)}${t}`}function H(e,t,n,r,i,a){if(e>n||e<t){const n="bigint"==typeof t?"n":"";let r;throw r=0===t||t===BigInt(0)?`>= 0${n} and < 2${n} ** ${8*(a+1)}${n}`:`>= -(2${n} ** ${8*(a+1)-1}${n}) and < 2 ** ${8*(a+1)-1}${n}`,new U.ERR_OUT_OF_RANGE("value",r,e)}!function(e,t,n){W(t,"offset"),void 0!==e[t]&&void 0!==e[t+n]||j(t,e.length-(n+1))}(r,i,a)}function W(e,t){if("number"!=typeof e)throw new U.ERR_INVALID_ARG_TYPE(t,"number",e)}function j(e,t,n){if(Math.floor(e)!==e)throw W(e,n),new U.ERR_OUT_OF_RANGE("offset","an integer",e);if(t<0)throw new U.ERR_BUFFER_OUT_OF_BOUNDS;throw new U.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${t}`,e)}z("ERR_BUFFER_OUT_OF_BOUNDS",function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),z("ERR_INVALID_ARG_TYPE",function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`},TypeError),z("ERR_OUT_OF_RANGE",function(e,t,n){let r=`The value of "${e}" is out of range.`,i=n;return Number.isInteger(n)&&Math.abs(n)>2**32?i=D(String(n)):"bigint"==typeof n&&(i=String(n),(n>BigInt(2)**BigInt(32)||n<-(BigInt(2)**BigInt(32)))&&(i=D(i)),i+="n"),r+=` It must be ${t}. Received ${i}`,r},RangeError);const V=/[^+/0-9A-Za-z-_]/g;function q(e,t){let n;t=t||1/0;const r=e.length;let i=null;const a=[];for(let o=0;o<r;++o){if(n=e.charCodeAt(o),n>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&a.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&a.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;a.push(n)}else if(n<2048){if((t-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return a}function X(e){return t.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(V,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function K(e,t,n,r){let i;for(i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function G(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function Y(e){return e!=e}const J=function(){const e="0123456789abcdef",t=new Array(256);for(let n=0;n<16;++n){const r=16*n;for(let i=0;i<16;++i)t[r+i]=e[n]+e[i]}return t}();function Q(e){return"undefined"==typeof BigInt?Z:e}function Z(){throw new Error("BigInt not supported")}}(i);const g=e({__proto__:null,default:r(i)},[i]);function h(e,t){const n={inscriptionId:e.inscriptionId||e.id,inscriptionNumber:e.inscriptionNumber||e.number,address:e.address,outputValue:e.outputValue||e.output_value||e.value,content:e.content,contentType:e.contentType||e.content_type||e.mimeType,contentLength:e.contentLength||e.content_length,timestamp:e.timestamp,genesisTransaction:e.genesisTransaction||e.genesis_transaction||e.genesis_tx,location:e.location,output:e.output,offset:e.offset};switch(t){case"Xverse":n.contentType=e.contentType||e.mimeType,n.inscriptionNumber=e.number;break;case"UniSat":n.contentType=e.contentType,n.inscriptionNumber=e.inscriptionNumber}return n}function b(e,t){if("number"==typeof e)return{confirmed:e,unconfirmed:0,total:e};const n={confirmed:e.confirmed||e.amount||e.total||0,unconfirmed:e.unconfirmed||e.pending||0,total:0};switch(t){case"Xverse":n.confirmed=e.confirmed||0,n.unconfirmed=e.unconfirmed||0;break;case"UniSat":n.confirmed=e.confirm||e.confirmed||0,n.unconfirmed=e.pending||e.unconfirmed||0}return n.total=n.confirmed+n.unconfirmed,n}function y(e,t){const n={autoFinalized:!1!==e.autoFinalized,toSignInputs:e.toSignInputs||e.inputsToSign||[]};switch(t){case"Xverse":if(e.toSignInputs&&Array.isArray(e.toSignInputs)){const t={};e.toSignInputs.forEach(e=>{const n=e.address;t[n]||(t[n]=[]),"number"==typeof e.index&&t[n].push(e.index)}),n.signInputs=t}break;case"UniSat":case"OKX":n.toSignInputs=e.toSignInputs||[];break;case"Phantom":if(e.toSignInputs&&Array.isArray(e.toSignInputs)){const t=new Map;for(const n of e.toSignInputs){if(!n||"object"!=typeof n)continue;const r=n.index;if("number"!=typeof r||!Number.isFinite(r))continue;const i="string"==typeof n.address&&n.address.trim()?n.address.trim():"string"==typeof e.address&&e.address.trim()?e.address.trim():"string"==typeof e.defaultAddress&&e.defaultAddress.trim()?e.defaultAddress.trim():null;i&&(t.has(i)||t.set(i,[]),t.get(i).push(r))}const r=Array.from(t.entries()).map(([e,t])=>({address:e,signingIndexes:t}));r.length&&(n.inputsToSign=r)}}return n}function x(e){const t=(e||"").toLowerCase();return t.includes("main")||t.includes("live")?"livenet":t.includes("test")?"testnet":"livenet"}function w(e){return"string"==typeof e?e:"object"==typeof e&&null!==e?e.address||e.value||String(e):""}function v(e,t,n="input"){if(!e||"string"!=typeof e)throw new Error("Invalid PSBT: must be a non-empty string");const r=()=>"undefined"!=typeof Buffer&&Buffer&&"function"==typeof Buffer.from,i=e=>(e=>{const t=e instanceof Uint8Array?e:new Uint8Array(e);let n="";for(let r=0;r<t.length;r++)n+=t[r].toString(16).padStart(2,"0");return n})((e=>{const t=String(e||"").trim();if(r()){const e=Buffer.from(t,"base64");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}if("function"!=typeof atob)throw new Error("Base64 decoding not available in this environment");const n=atob(t),i=new Uint8Array(n.length);for(let r=0;r<n.length;r++)i[r]=n.charCodeAt(r);return i})(e)),a=String(e).trim(),o=/^[0-9a-fA-F]+$/.test(a)&&a.length%2==0,s=/^[A-Za-z0-9+/]+=*$/.test(a)&&!o;if(!o&&!s)throw new Error("PSBT must be in hex or base64 format");if(o&&!a.toLowerCase().startsWith("70736274ff"))throw new Error("Invalid PSBT: missing magic bytes (hex must start with 70736274ff)");if(s&&!a.startsWith("cHNidP8"))throw new Error("Invalid PSBT: missing magic bytes (base64 must start with cHNidP8)");if("input"===n){const e={Leather:"base64",Xverse:"base64",UniSat:"hex",OKX:"hex",MagicEden:"base64"}[t]||"hex";return"base64"===e&&o?(e=>{const t=e instanceof Uint8Array?e:new Uint8Array(e);if(r())return Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("base64");if("function"!=typeof btoa)throw new Error("Base64 encoding not available in this environment");let n="";for(let r=0;r<t.length;r+=32768){const e=t.subarray(r,r+32768);n+=String.fromCharCode.apply(null,Array.from(e))}return btoa(n)})((e=>{const t=String(e||"").trim();if(!/^[0-9a-fA-F]+$/.test(t)||t.length%2!=0)throw new Error("Invalid hex string");const n=new Uint8Array(t.length/2);for(let r=0;r<t.length;r+=2)n[r/2]=parseInt(t.slice(r,r+2),16);return n})(a)):"hex"===e&&s?i(a):a}return s?i(a):a}window.Buffer=i.Buffer,globalThis.Buffer=i.Buffer;const S={inscription:h,balance:b,psbtOptions:y,network:x,address:w,providerMethods:function(e){if(!e)return e;const t={...e};return!t.signPsbt&&e.signPSBT&&(t.signPsbt=e.signPSBT.bind(e)),t},psbtFormat:v},E={Payment:"payment",Ordinals:"ordinals",Stacks:"stacks"},N={Mainnet:"Mainnet",Testnet:"Testnet"},I=()=>"undefined"!=typeof window&&!0===window.NEXUS_WALLET_DEBUG,A=(...e)=>{I()},k=(...e)=>{I()};async function T(e,t,n){if(!e||"function"!=typeof e.request)throw new Error("Wallet provider missing request()");const r=e=>{try{return e?"string"==typeof e?e:e?.message?String(e.message):e?.error?.message?String(e.error.message):e?.error?String(e.error):JSON.stringify(e):""}catch{try{return String(e)}catch{return""}}};let i=null;try{return await(async()=>void 0===n?await e.request(t):await e.request(t,n))()}catch(a){i=a}try{const r=void 0===n?{method:t}:{method:t,params:n};return await e.request(r)}catch(o){const e=`Wallet request failed (method=${String(t)}): ${r(o)||r(i)||"Unknown error"}`,n=new Error(e);throw n.cause=o||i,n}}function C(e){if(!e)return null;if("function"==typeof e.request)return e;if(e.provider&&"function"==typeof e.provider.request)return e.provider;const t="sats-connect:";if(e.features?.[t]?.provider){const n=e.features[t].provider;if("function"==typeof n.request)return n}return null}function B(e,t={}){if(!e||"object"!=typeof e)throw new Error("createUnsecuredToken: payload must be a non-null object");const n=t.includeIat?{iat:Math.floor(Date.now()/1e3),...e}:e,r=e=>btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");return`${r(JSON.stringify({typ:"JWT",alg:"none"}))}.${r(JSON.stringify(n))}.`}function P(e){return B(e)}function _(){if("undefined"==typeof window)return null;if(window.btc_providers&&Array.isArray(window.btc_providers)&&window.btc_providers.length>0)for(const e of window.btc_providers){const t=C(e);if(t)return A(e.name||e.id),t}return window.magicEden?.bitcoin?.isMagicEden?(A(),window.magicEden.bitcoin):window.bitmapWallet&&"function"==typeof window.bitmapWallet.request?(A(),window.bitmapWallet):window.BitcoinProvider&&"function"==typeof window.BitcoinProvider.request?(A(),window.BitcoinProvider):window.XverseProviders?.BitcoinProvider?(A(),window.XverseProviders.BitcoinProvider):null}async function O({purposes:e,message:t,network:n}={}){const r=_();if(!r)throw new Error("No Bitcoin wallet found. Install Xverse, Leather, or Magic Eden.");if(window.magicEden?.bitcoin&&r===window.magicEden.bitcoin)return A(),await async function(e,t){const n=window.magicEden.bitcoin,r=B({purposes:e||["payment","ordinals"],message:t||"Connect to view your Bitcoin addresses",network:{type:"Mainnet"}});A();const i=await n.connect(r);if(i?.addresses&&Array.isArray(i.addresses))return i.addresses;throw new Error("Invalid response from Magic Eden")}(e,t);const i=["wallet_connect","getAddresses"];let a=null;for(const o of i)try{A();const i={purposes:e||[E.Payment,E.Ordinals],message:t||"Connect to view your Bitcoin addresses"};n&&(i.network=n);const s=await T(r,o,i);if("success"===s?.status)return s.result.addresses||s.result;if("error"===s?.status)throw new Error(s.error?.message||"Failed to get addresses");if(s?.result?.addresses)return s.result.addresses;if(s?.addresses)return s.addresses;if(Array.isArray(s))return s;k(),a=new Error(`${o} returned unexpected format`)}catch(tn){k(tn?.message||String(tn)),a=tn}throw a||new Error("Failed to get addresses from wallet")}async function L({address:e,message:t,protocol:n="BIP322"}){const r=_();if(!r)throw new Error("No Bitcoin wallet found");const i=await T(r,"signMessage",{address:e,message:t,protocol:n});if("success"===i.status)return i.result.signature||i.result;if("error"===i.status)throw new Error(i.error?.message||"Failed to sign message");return i}async function F({psbtBase64:e,inputsToSign:t,broadcast:n=!1}){const r=_();if(!r)throw new Error("No Bitcoin wallet found");const i=await T(r,"signPsbt",{psbt:{psbtBase64:e,inputsToSign:t,broadcast:n}});if("success"===i.status)return{psbtBase64:i.result.psbtBase64||i.result,txid:i.result.txid};if("error"===i.status)throw new Error(i.error?.message||"Failed to sign PSBT");return i}async function M({recipients:e}){const t=_();if(!t)throw new Error("No Bitcoin wallet found");const n=await T(t,"sendTransfer",{recipients:e});if("success"===n.status)return n.result.txid||n.result;if("error"===n.status)throw new Error(n.error?.message||"Failed to send transfer");return n}async function R({offset:e=0,limit:t=100}){const n=_();if(!n)throw new Error("No Bitcoin wallet found");try{const r=await T(n,"ord_getInscriptions",{offset:e,limit:t});if("success"===r.status)return r.result.inscriptions||r.result.list||r.result||[]}catch(tn){return k(tn?.message||String(tn)),[]}return[]}async function $(e={}){const t=_();if(!t)throw new Error("No Bitcoin wallet found");try{const e=await T(t,"getBalance",void 0);if(e&&"2.0"===e.jsonrpc&&e.result)return e.result;if("success"===e.status)return e.result;if("error"===e.status)throw new Error(e.error?.message||"Failed to get balance");return e}catch(tn){throw k(tn?.message||String(tn)),tn}}const U={AddressPurpose:E,BitcoinNetworkType:N,getBitcoinProvider:_,getAddresses:O,signMessage:L,signPsbt:F,sendTransfer:M,getInscriptions:R,getBalance:$,createUnsecuredToken:B,createMagicEdenToken:P},z=Object.freeze(Object.defineProperty({__proto__:null,AddressPurpose:E,BitcoinNetworkType:N,createMagicEdenToken:P,createUnsecuredToken:B,default:U,getAddresses:O,getBalance:$,getBitcoinProvider:_,getInscriptions:R,sendTransfer:M,signMessage:L,signPsbt:F},Symbol.toStringTag,{value:"Module"}));function D(e){if(!e||"object"!=typeof e)return e;const t={...e};if(!Array.isArray(t.toSignInputs)&&Array.isArray(t.inputsToSign)&&(t.toSignInputs=t.inputsToSign),!Array.isArray(t.inputsToSign)&&Array.isArray(t.toSignInputs)&&(t.inputsToSign=t.toSignInputs),Array.isArray(t.toSignInputs)){const e=t.toSignInputs.map(e=>{if(!e||"object"!=typeof e)return e;const t={...e},n=t.sighashType;return"number"==typeof n&&(Array.isArray(t.sighashTypes)?t.sighashTypes.includes(n)||(t.sighashTypes=[...t.sighashTypes,n]):t.sighashTypes=[n]),t});if(t.toSignInputs=e,t.inputsToSign=e,!Array.isArray(t.sighashTypes)){const e=[];for(const n of t.toSignInputs)if(n&&"object"==typeof n){const t=n.sighashType;"number"!=typeof t||e.includes(t)||e.push(t);const r=n.sighashTypes;if(Array.isArray(r))for(const n of r)"number"!=typeof n||e.includes(n)||e.push(n)}e.length&&(t.sighashTypes=e)}}return t}async function H(e,t,n){if(!e||"function"!=typeof e.signPsbts)return null;try{const r=Array.isArray(n)?n.map(D):D(n);return await e.signPsbts(t,r)}catch(r){return r?.message||String(r),function(){try{return"undefined"!=typeof globalThis&&!0===globalThis.NEXUS_WALLET_DEBUG}catch{return!1}}()&&"undefined"!=typeof console&&console.warn,null}}async function W(e,t,n){if(!e||"function"!=typeof e.signPsbt)return null;const r=[];for(let a=0;a<t.length;a++){const o=Array.isArray(n)?n[a]||{}:n||{};try{r.push(await e.signPsbt(t[a],D(o)))}catch(i){const e=i?.message||String(i);throw new Error(`Wallet signPsbt failed for index ${a}: ${e}`)}}return r}function j(e,t){return"string"==typeof e?1===t?[e]:null:Array.isArray(e)?"number"==typeof t&&t>0&&e.length!==t?null:e:null}async function V(e,t,n){if(!Array.isArray(t)||0===t.length)throw new Error("signPsbtsWithFallback: psbts must be a non-empty array");for(let d=0;d<t.length;d++)if("string"!=typeof t[d]||!t[d])throw new Error(`signPsbtsWithFallback: psbts[${d}] must be a non-empty string`);const r=function(e){try{return e?.walletType?.toLowerCase?.()||e?.name?.toLowerCase?.()||e?.providerName?.toLowerCase?.()||e?.id?.toLowerCase?.()||e?.constructor?.name?.toLowerCase?.()||""}catch{return""}}(e),i=r.includes("leather")||r.includes("phantom")||r.includes("xverse"),a=1===t.length,o=[];e&&o.push({label:"provider",signer:e}),e?.walletInstance&&o.push({label:"rawWallet",signer:e.walletInstance});const s=[];for(const d of o)if(d?.signer){if(!i&&!a)try{const e=j(await H(d.signer,t,n),t.length);if(e)return e}catch(u){s.push({attempt:`${d.label}.signPsbts`,error:u})}try{const e=j(await W(d.signer,t,n),t.length);if(e)return e}catch(u){s.push({attempt:`${d.label}.signPsbt`,error:u})}}const l=s[s.length-1]?.error,c=l?.message||(s.length?String(l):"No compatible wallet signing method found (signPsbts or signPsbt)");throw new Error(`Wallet signing failed${r?` (wallet=${r})`:""}: ${c}`)}class q{constructor(e){this.name=e,this.isConnected=!1,this.address=null,this.publicKey=null,this.walletInstance=null,this.features={connect:!0,getAddress:!0,getPublicKey:!1,getBalance:!0,getNetwork:!1,switchNetwork:!1,signMessage:!0,signPsbt:!0,signPsbts:!1,pushPsbt:!1,pushTx:!1,sendBitcoin:!0,sendInscription:!1,getInscriptions:!0,getAllInscriptions:!0,inscribe:!1,brc20:{transfer:!1,deploy:!1,mint:!1},runes:{send:!1,mint:!1,etch:!1},atomicals:{transfer:!1,mint:!1},arc20:{transfer:!1}}}requireInstalled(){if(!this.walletInstance)throw new Error(`${this.name} wallet not installed or not detected`)}requireConnected(){if(!this.isConnected||!this.address)throw new Error(`${this.name} wallet not connected. Please connect first.`)}supportsMethod(e){if(!e||"string"!=typeof e)return!1;const t=e.split(".");let n=this.features;for(const r of t){if("object"!=typeof n||null===n)return!0===n;if(!Object.prototype.hasOwnProperty.call(n,r))return!1;n=n[r]}return!0===n}async safeCall(e,t,n){if(!this.supportsMethod(e))throw new Error(n||`${this.name} does not support ${e}`);return await t()}async connect(){if(this.requireInstalled(),this.walletInstance.connect){const e=await this.walletInstance.connect();return this.isConnected=!0,this.address=e.address||e,e}let e=null;if(this.walletInstance.requestAccounts){const t=await this.walletInstance.requestAccounts();e=t?.[0]||null}else if(this.walletInstance.getAddress)e=await this.walletInstance.getAddress();else if(this.walletInstance.getAccounts){const t=await this.walletInstance.getAccounts();e=t?.[0]||null}if(!e)throw new Error(`${this.name}: No method available to connect`);return this.isConnected=!0,this.address=e,{address:e}}async disconnect(){this.walletInstance?.disconnect&&await this.walletInstance.disconnect(),this.isConnected=!1,this.address=null,this.publicKey=null}async getAddress(){if(this.requireInstalled(),this.requireConnected(),this.walletInstance.getAddress)return await this.walletInstance.getAddress();if(this.walletInstance.requestAccounts)return(await this.walletInstance.requestAccounts())[0];throw new Error(`${this.name}: No method available to get address`)}async getPublicKey(){return this.requireInstalled(),this.requireConnected(),await this.safeCall("getPublicKey",async()=>{if(this.walletInstance.getPublicKey)return await this.walletInstance.getPublicKey();throw new Error(`${this.name}: getPublicKey not implemented`)})}async getBalance(){if(this.requireInstalled(),this.requireConnected(),this.walletInstance.getBalance){const e=await this.walletInstance.getBalance();return"object"==typeof e?e.total||e.confirmed||e.balance||0:e}throw new Error(`${this.name}: getBalance not implemented`)}async getNetwork(){return this.requireInstalled(),await this.safeCall("getNetwork",async()=>{if(this.walletInstance.getNetwork)return await this.walletInstance.getNetwork();throw new Error(`${this.name}: getNetwork not implemented`)})}async switchNetwork(e){return this.requireInstalled(),await this.safeCall("switchNetwork",async()=>{if(this.walletInstance.switchNetwork)return await this.walletInstance.switchNetwork(e);throw new Error(`${this.name}: switchNetwork not implemented`)})}async signMessage(e,t="ecdsa"){if(this.requireInstalled(),this.requireConnected(),this.walletInstance.signMessage)return await this.walletInstance.signMessage(e,t);throw new Error(`${this.name}: signMessage not implemented`)}async signPsbt(e,t={}){if(this.requireInstalled(),this.requireConnected(),this.walletInstance.signPsbt)return await this.walletInstance.signPsbt(e,t);throw new Error(`${this.name}: signPsbt not implemented`)}async signPsbts(e,t={}){return this.requireInstalled(),this.requireConnected(),await this.safeCall("signPsbts",async()=>{if(this.walletInstance.signPsbts)return await this.walletInstance.signPsbts(e,t);const n=[];for(let i=0;i<e.length;i++)try{n.push(await this.signPsbt(e[i],t))}catch(r){const t=new Error(`${this.name}: Failed to sign PSBT ${i+1}/${e.length}: ${r.message}`);throw t.index=i,t.partialResults=[...n],t.cause=r,t}return n})}async pushPsbt(e){return this.requireInstalled(),this.requireConnected(),await this.safeCall("pushPsbt",async()=>{if(this.walletInstance.pushPsbt)return await this.walletInstance.pushPsbt(e);throw new Error(`${this.name}: pushPsbt not implemented`)})}async pushTx(e){return this.requireInstalled(),this.requireConnected(),await this.safeCall("pushTx",async()=>{if(this.walletInstance.pushTx)return await this.walletInstance.pushTx(e);throw new Error(`${this.name}: pushTx not implemented`)})}static validateSendParams(e,t){if("string"!=typeof e||!e.trim())throw new Error("Invalid recipient address: must be a non-empty string");const n=e.trim(),r=n.toLowerCase();if(!(r.startsWith("bc1q")||r.startsWith("bc1p")||r.startsWith("tb1q")||r.startsWith("tb1p")||r.startsWith("bcrt1")||/^[13mn2]/.test(n))||n.length<26||n.length>90)throw new Error("Invalid Bitcoin address format: unrecognized prefix or length");if(!Number.isInteger(t)||t<=0)throw new Error("satoshis must be a positive integer");const i=q._dustLimitForAddress(n);if(t<i)throw new Error(`Amount ${t} sats is below dust limit (${i} sats for this address type)`)}static _dustLimitForAddress(e){const t=e.toLowerCase();return t.startsWith("bc1q")||t.startsWith("tb1q")?e.length<=44?294:330:t.startsWith("bc1p")||t.startsWith("tb1p")?330:t.startsWith("bcrt1q")?e.length<=46?294:330:t.startsWith("bcrt1p")?330:e.startsWith("3")||e.startsWith("2")?540:546}static withTimeout(e,t=3e4,n="Wallet operation"){let r;return Promise.race([e,new Promise((e,i)=>{r=setTimeout(()=>i(new Error(`${n} timed out after ${t}ms`)),t)})]).finally(()=>clearTimeout(r))}async sendBitcoin(e,t,n={}){if(this.requireInstalled(),this.requireConnected(),q.validateSendParams(e,t),this.walletInstance.sendBitcoin)return await this.walletInstance.sendBitcoin(e,t,n);throw new Error(`${this.name}: sendBitcoin not implemented`)}async sendInscription(e,t,n={}){return this.requireInstalled(),this.requireConnected(),await this.safeCall("sendInscription",async()=>{if(this.walletInstance.sendInscription)return await this.walletInstance.sendInscription(e,t,n);throw new Error(`${this.name}: sendInscription not implemented`)})}async getInscriptions(e=0,t=100){if(this.requireInstalled(),this.requireConnected(),this.walletInstance.getInscriptions)return await this.walletInstance.getInscriptions(e,t);throw new Error(`${this.name}: getInscriptions not implemented`)}async getAllInscriptions(){this.requireInstalled(),this.requireConnected();const e=[];let t=0,n=0;for(;n<100;){const r=await this.getInscriptions(t,100),i=r.list||r.inscriptions||r;if(!Array.isArray(i)||0===i.length)break;if(e.push(...i),i.length<100)break;await new Promise(e=>setTimeout(e,100)),t+=100,n++}return e}async inscribe(e,t={}){return this.requireInstalled(),this.requireConnected(),await this.safeCall("inscribe",async()=>{if(this.walletInstance.inscribe)return await this.walletInstance.inscribe(e,t);throw new Error(`${this.name}: inscribe not implemented`)})}getInfo(){return{name:this.name,isInstalled:!!this.walletInstance,isConnected:this.isConnected,address:this.address,publicKey:this.publicKey,features:this.features}}getState(){const e=this.paymentAddress||this.address||null,t=this.ordinalsAddress||this.address||null,n=this.paymentPublicKey||this.publicKey||null,r=this.ordinalsPublicKey||this.publicKey||null;return{wallet:this.name,connected:!!this.isConnected,network:null,paymentAddress:e,ordinalsAddress:t,paymentPublicKey:n,ordinalsPublicKey:r,address:this.address||t||e||null}}}const X=()=>"undefined"!=typeof window&&!0===window.NEXUS_WALLET_DEBUG,K=(...e)=>{X()},G=(...e)=>{X()},Y=()=>"undefined"!=typeof window&&!0===window.NEXUS_WALLET_DEBUG,J=(...e)=>{Y()&&globalThis.console.log(...e)},Q=(...e)=>{Y()&&globalThis.console.warn(...e)},Z=(...e)=>{Y()&&globalThis.console.error(...e)};function ee(e){if("string"!=typeof e)return e;const t=e.trim();if(!t)return e;if(!t.startsWith("{")&&!t.startsWith("["))return e;try{return JSON.parse(t)}catch{return e}}async function te(e,t,n){if(!e)throw new Error("Xverse provider not available");if("function"!=typeof e.request)throw new Error("Xverse provider does not support request()");const r=e=>{try{return e?"string"==typeof e?e:e?.message?String(e.message):e?.error?.message?String(e.error.message):e?.error?String(e.error):JSON.stringify(e):""}catch{try{return String(e)}catch{return""}}};let i=null;try{const r=await(async()=>void 0===n?await e.request(t):await e.request(t,n))();if(null!=r)return r}catch(a){i=a}try{const r=void 0===n?{method:t}:{method:t,params:n},i=await e.request(r);if(null!=i)return i}catch(o){const e=r(i),n=r(o),a=`Xverse request failed (method=${String(t)}): ${n||e||"Unknown error"}`,s=new Error(a);throw s.cause=o||i,s}if(i){const e=`Xverse request returned empty result (method=${String(t)}): ${r(i)||"Unknown error"}`,n=new Error(e);throw n.cause=i,n}throw new Error(`Xverse request returned empty result (method=${String(t)})`)}function ne(e,t){if(e instanceof Error){if(t&&!String(e.message||"").startsWith(t)){const n=new Error(`${t}: ${e.message||String(e)}`);return n.cause=e,n}return e}let n="";try{n="string"==typeof e?e:e?.message?String(e.message):JSON.stringify(e)}catch{n=String(e)}const r=new Error(t?`${t}: ${n}`:n||"Unknown error");return r.cause=e,r}function re(e){const t=ee(e),n=[t?.result?.addresses,t?.result?.data?.addresses,t?.result?.payload?.addresses,t?.payload?.addresses,t?.data?.addresses,t?.addresses,"2.0"===t?.jsonrpc?t?.result?.addresses:null,"2.0"===t?.jsonrpc&&Array.isArray(t?.result)?t.result:null,Array.isArray(t?.result)?t.result:null,Array.isArray(t)?t:null];for(const r of n){if(Array.isArray(r)&&r.length)return r;if(r&&"object"==typeof r&&!Array.isArray(r)){const e=Object.values(r);if(e.length&&e.every(e=>e&&"object"==typeof e))return e}}for(const r of n){if(Array.isArray(r))return r;if(r&&"object"==typeof r&&!Array.isArray(r)){const e=Object.values(r);if(e.every(e=>e&&"object"==typeof e))return e}}return null}function ie(e){const t=String(e||"").toLowerCase();return t.startsWith("bc1p")||t.startsWith("tb1p")||t.startsWith("bcrt1p")}function ae(e){const t=String(e||"").toLowerCase();return t.startsWith("bc1q")||t.startsWith("tb1q")||t.startsWith("bcrt1q")}function oe(e){return String(e?.purpose??e?.addressPurpose??e?.type??e?.addressType??"").toLowerCase()}const se=()=>{try{if("undefined"==typeof window)return null;const e=window.XverseProviders?.BitcoinProvider||window.BitcoinProvider;if(e&&"function"==typeof e.request)return e;const t=window.btc_providers;if(Array.isArray(t))for(const n of t){if(!String(n?.name||n?.id||"").toLowerCase().includes("xverse"))continue;const e=("function"==typeof n?.request?n:null)||(n?.provider&&"function"==typeof n.provider.request?n.provider:null)||(n?.features?.["sats-connect:"]?.provider&&"function"==typeof n.features["sats-connect:"].provider.request?n.features["sats-connect:"].provider:null);if(e)return e}return null}catch{return null}},le=(...e)=>{"undefined"!=typeof window&&window.NEXUS_WALLET_DEBUG},ce=()=>"undefined"!=typeof window&&!0===window.NEXUS_WALLET_DEBUG,ue=(...e)=>{ce()},de=(...e)=>{ce()},pe=()=>"undefined"!=typeof window&&!0===window.NEXUS_WALLET_DEBUG,fe=(...e)=>{pe()},me=(...e)=>{pe()},ge=()=>"undefined"!=typeof window&&!0===window.NEXUS_WALLET_DEBUG,he=(...e)=>{ge()},be=(...e)=>{ge()},ye=()=>"undefined"!=typeof window&&!0===window.NEXUS_WALLET_DEBUG,xe=(...e)=>{ye()},we=(...e)=>{ye()},ve=()=>"undefined"!=typeof window&&!0===window.NEXUS_WALLET_DEBUG,Se=(...e)=>{ve()},Ee=(...e)=>{ve()},Ne=()=>"undefined"!=typeof window&&!0===window.NEXUS_WALLET_DEBUG,Ie=(...e)=>{Ne()},Ae=(...e)=>{Ne()},ke=(()=>{try{const e="undefined"!=typeof window?window.NEXUS_DISABLED_WALLETS:null;return e&&"object"==typeof e?e:{}}catch{return{}}})(),Te={UniSat:{name:"UniSat",detection:()=>"undefined"!=typeof window&&void 0!==window.unisat,downloadUrl:"https://unisat.io",features:["BRC-20","Runes","Inscriptions"]},Xverse:{name:"Xverse",detection:()=>{try{if("undefined"==typeof window)return!1;const e=window.XverseProviders?.BitcoinProvider||window.BitcoinProvider;if(e&&"function"==typeof e.request)return!0;const t=window.btc_providers;if(Array.isArray(t))for(const n of t)if(String(n?.name||n?.id||"").toLowerCase().includes("xverse")&&("function"==typeof n?.request&&n||n?.provider&&"function"==typeof n.provider.request&&n.provider||n?.features?.["sats-connect:"]?.provider&&"function"==typeof n.features["sats-connect:"].provider.request&&n.features["sats-connect:"].provider))return!0;return!1}catch{return!1}},downloadUrl:"https://www.xverse.app",features:["Ordinals","Payment","Inscriptions"]},OKX:{name:"OKX",detection:()=>!("undefined"==typeof window||ke[String("OKX")]||void 0===window.okxwallet?.bitcoin&&(!window.okxwallet||"function"!=typeof window.okxwallet.connect||"function"!=typeof window.okxwallet.signPsbt)),downloadUrl:"https://www.okx.com/web3",features:["BRC-20","Inscriptions"]},Leather:{name:"Leather",detection:()=>{try{return"undefined"!=typeof window&&(!!(window.btc_providers&&Array.isArray(window.btc_providers)&&window.btc_providers.some(e=>"LeatherProvider"===e.id||"Leather"===e.name||e.provider&&e.provider.isLeather))||!(!window.LeatherProvider&&!window.HiroWalletProvider))}catch(tn){return!1}},downloadUrl:"https://leather.io",features:["Stacks","Bitcoin"]},Phantom:{name:"Phantom",detection:()=>"undefined"!=typeof window&&void 0!==window.phantom?.bitcoin,downloadUrl:"https://phantom.app",features:["Limited Bitcoin Support"]},Wizz:{name:"Wizz",detection:()=>"undefined"!=typeof window&&void 0!==window.wizz,downloadUrl:"https://wizzwallet.io",features:["BRC-20","ARC-20","Atomicals","Runes"]},MagicEden:{name:"MagicEden",detection:()=>"undefined"!=typeof window&&void 0!==window.magicEden?.bitcoin?.isMagicEden,downloadUrl:"https://wallet.magiceden.io",features:["NFTs","Bitcoin"]},Oyl:{name:"Oyl",detection:()=>"undefined"!=typeof window&&void 0!==window.oyl,downloadUrl:"https://oyl.io",features:["Taproot","SegWit"]},BitmapWallet:{name:"BitmapWallet",detection:()=>"undefined"!=typeof window&&(void 0!==window.bitmapWallet&&"function"==typeof window.bitmapWallet.request),downloadUrl:"https://bitmapwallet.io",features:["Inscriptions","Bitmaps","UTXOs","Signing","Broadcasting","Rare Sats"]}},Ce={UniSat:class extends q{constructor(){super("UniSat"),this.walletInstance="undefined"!=typeof window?window.unisat:null,this.features={connect:!0,getAddress:!0,getPublicKey:!0,getBalance:!0,getNetwork:!0,switchNetwork:!0,signMessage:!0,signPsbt:!0,signPsbts:!0,pushPsbt:!0,pushTx:!0,sendBitcoin:!0,sendInscription:!1,getInscriptions:!0,getAllInscriptions:!0,inscribe:!0,brc20:{transfer:!0,deploy:!1,mint:!1,list:!0},runes:{send:!0,mint:!1,etch:!1},atomicals:{transfer:!1,mint:!1},arc20:{transfer:!1}}}isInstalled(){return this._refreshWalletInstance(),!!this.walletInstance}_refreshWalletInstance(){return"undefined"==typeof window||window.unisat&&(this.walletInstance=window.unisat),this.walletInstance}async _waitForWalletInjection({maxAttempts:e=8,baseDelayMs:t=50}={}){if("undefined"==typeof window)return null;for(let n=0;n<e;n+=1){if(this._refreshWalletInstance(),this.walletInstance)return this.walletInstance;await new Promise(e=>setTimeout(e,t*(n+1)))}return null}requireInstalled(){if(this._refreshWalletInstance(),!this.walletInstance)throw new Error("UniSat wallet not installed or not detected.\n\nDesktop: install the UniSat extension from https://unisat.io\nMobile: open this site inside UniSat's in-app browser so it can inject window.unisat.")}async connect(){await this._waitForWalletInjection(),this.requireInstalled();const e=await this.walletInstance.requestAccounts();if(e&&e.length>0)return this.address=e[0],this.isConnected=!0,K(),{address:this.address};throw new Error("Failed to connect to UniSat wallet")}async getAddress(){if(this.requireInstalled(),this.requireConnected(),this.address)return this.address;const e=await this.walletInstance.getAccounts();return e&&e.length>0?e[0]:null}async getPublicKey(){return this.requireConnected(),await this.walletInstance.getPublicKey()}async getBalance(){this.requireConnected();const e=await this.walletInstance.getBalance();return S.balance(e,"UniSat")}async getNetwork(){this.requireInstalled();const e=await this.walletInstance.getNetwork();return S.network(e)}async switchNetwork(e){this.requireInstalled(),await this.walletInstance.switchNetwork(e),K()}async getChain(){return this.requireInstalled(),await this.walletInstance.getChain()}async switchChain(e){this.requireInstalled(),await this.walletInstance.switchChain(e),K()}async signMessage(e,t="ecdsa"){return this.requireConnected(),await this.walletInstance.signMessage(e,t)}async multiSignMessage(e,t="ecdsa"){return this.requireConnected(),await this.walletInstance.multiSignMessage(e,t)}async signData(e,t="ecdsa"){return this.requireConnected(),await this.walletInstance.signData(e,t)}async signPsbt(e,t={}){if(this.requireConnected(),!e||"string"!=typeof e)throw new Error("Invalid PSBT: must be a non-empty string");const n=S.psbtFormat(String(e).trim(),"UniSat","input");let r;K();try{r=await this.walletInstance.signPsbt(n,t)}catch(i){const e=String(i?.message||i||"");if(/sighash\s*type\s*is\s*not\s*allowed/i.test(e)||/sighashTypes/i.test(e))throw new Error(e);if(/without\s*utxo\s*data/i.test(e)||/utxo\s*data/i.test(e))throw new Error(`UniSat signPsbt failed: ${e}. This usually means one or more PSBT inputs are missing witnessUtxo/nonWitnessUtxo (and for Taproot, tapInternalKey may be required).`);if(t&&Object.keys(t).length>0){if(!(/invalid\s*params/i.test(e)||/argument/i.test(e)||/parameters?/i.test(e)||/not\s*support/i.test(e)||/too\s*many/i.test(e)))throw new Error(e);G(),r=await this.walletInstance.signPsbt(n)}else r=await this.walletInstance.signPsbt(n)}if(!r)throw new Error("No signed PSBT returned from UniSat");return K(),r}async signPsbts(e,t=[]){if(this.requireConnected(),!Array.isArray(e))throw new Error("Invalid PSBTs: must be an array");const n=e.map((e,t)=>{if("string"!=typeof e||0===e.length)throw new Error(`Invalid PSBT at index ${t}: must be a non-empty string`);try{return S.psbtFormat(String(e).trim(),"UniSat","input")}catch{throw new Error(`Invalid PSBT at index ${t}: must be hex or base64`)}});return await this.walletInstance.signPsbts(n,t)}async pushPsbt(e){this.requireConnected();const t=await this.walletInstance.pushPsbt(e);return K(),t}async pushTx(e){let t;this.requireConnected();try{t="string"==typeof e?await this.walletInstance.pushTx(e):e&&"object"==typeof e&&e.rawtx?await this.walletInstance.pushTx(e.rawtx):await this.walletInstance.pushTx({rawtx:String(e)})}catch(n){if("string"!=typeof e)throw n;try{t=await this.walletInstance.pushTx({rawtx:e})}catch(r){throw new Error(`UniSat pushTx failed (string & object attempts): ${r?.message||r}`)}}if(!t||"string"!=typeof t)throw new Error("UniSat pushTx did not return a txid");return K(),t}async verifyMessageOfBIP322Simple(e,t,n){return this.requireInstalled(),await this.walletInstance.verifyMessageOfBIP322Simple(e,t,n)}async sendBitcoin(e,t){this.requireConnected(),q.validateSendParams(e,t);const n=await this.walletInstance.sendBitcoin(e,t);return K(),n}async getBitcoinUtxos(){return this.requireConnected(),await this.walletInstance.getBitcoinUtxos()}async getInscriptions(e=0,t=100){this.requireConnected();const n=await this.walletInstance.getInscriptions(e,t);return n&&n.list?(K(n.list.length),{list:n.list.map(e=>S.inscription(e,"UniSat")),total:n.total}):{list:[],total:0}}async inscribe(e,t={}){this.requireConnected();const{contentType:n="text/plain;charset=utf-8",feeRate:r=10,metadata:i}=t;if(n.includes("brc-20")||i&&i.brc20){const t=i.brc20||JSON.parse(e);return await this.inscribeTransfer(t.tick,t.amt)}return K(),{method:"psbt",requiresPsbtBuilding:!0,walletSupportsSign:"function"==typeof this.walletInstance.signPsbt,message:"Build commit+reveal PSBTs externally; wallet will sign/broadcast as requested."}}async inscribeTransfer(e,t){this.requireConnected();const n=await this.walletInstance.inscribeTransfer(e,t);return K(),n}async getBRC20List(){this.requireConnected();try{return this.walletInstance.getBRC20Summary?await this.walletInstance.getBRC20Summary():(G(),[])}catch(tn){throw G(),tn}}async sendRunes(e,t,n){this.requireConnected();const r=await this.walletInstance.sendRunes(e,t,n);return K(),r}async getAccounts(){return this.requireInstalled(),await this.walletInstance.getAccounts()}async getVersion(){return this.requireInstalled(),await this.walletInstance.getVersion()}async getBalanceV2(){return this.requireConnected(),await this.walletInstance.getBalanceV2()}setupEventListeners(){if(!this.isInstalled())return;const e=this.walletInstance;e&&e.on&&(e.on("accountsChanged",e=>{K(),e&&0!==e.length?(this.address=e[0],this.publicKey=null):(this.address=null,this.publicKey=null,this.isConnected=!1)}),e.on("networkChanged",e=>{K()}),K())}removeEventListeners(){if(!this.isInstalled())return;const e=this.walletInstance;e&&e.removeAllListeners&&(e.removeAllListeners("accountsChanged"),e.removeAllListeners("networkChanged"))}},Xverse:class extends q{constructor(){if(super("Xverse"),this.paymentAddress=null,this.ordinalsAddress=null,this.paymentPublicKey=null,this.ordinalsPublicKey=null,"undefined"!=typeof window){const e=se();e&&(this.walletInstance=e)}this.features={connect:!0,getAddress:!0,getPublicKey:!0,getBalance:!0,signMessage:!0,signPsbt:!0,signPsbts:!0,pushPsbt:!1,pushTx:!1,signTransaction:!0,signMultipleTransactions:!0,sendBtcTransaction:!0,getInscriptions:!0,sendInscription:!0,createInscription:!0,createRepeatInscriptions:!0,getUtxos:!1,getBitcoinUtxos:!1,getCapabilities:!0,runes:!0,eventListeners:!0,networkSwitch:!1,brc20:!1,arc20:!1,atomicals:!1}}isInstalled(){try{return"undefined"!=typeof window&&!!se()}catch{return!1}}getProvider(){try{return se()}catch{return null}}async connect(){this.requireInstalled();try{const t=this.getProvider();if(!t)throw new Error("Xverse provider not available (injection missing)");const n=["ordinals","payment"],r="Address for receiving Ordinals and payments",i=e=>{try{const t=ee(e);return t&&"object"==typeof t?{keys:Object.keys(t).slice(0,25),status:t.status,jsonrpc:t.jsonrpc,hasResult:!!t.result,resultKeys:t.result&&"object"==typeof t.result?Object.keys(t.result).slice(0,25):void 0}:{type:typeof t}}catch{return{type:typeof e}}},a=async(e,n,r)=>{let i;try{i=await te(t,n,r)}catch(o){return{ok:!1,error:o,response:null,addresses:null,label:e}}const a=re(i);return Array.isArray(a)&&a.length>0?{ok:!0,error:null,response:i,addresses:a,label:e}:{ok:!1,error:null,response:i,addresses:a,label:e}},o=[],s=[["getAddresses(network Mainnet)","getAddresses",{purposes:n,message:r,network:{type:"Mainnet"}}],["getAddresses(network mainnet)","getAddresses",{purposes:n,message:r,network:{type:"mainnet"}}],["getAddresses(no network)","getAddresses",{purposes:n,message:r}],["getAddresses(no network alt purposes)","getAddresses",{purposes:["payment","ordinals"],message:r}],["wallet_connect(no params)","wallet_connect",void 0],["wallet_connect(with params)","wallet_connect",{purposes:n,message:r,network:{type:"Mainnet"}}]];let l=null;for(const[e,b,y]of s){const t=await a(e,b,y);if(o.push(t),t.ok){l=t.addresses;break}if(t.error){const e=t.error.code||t.error?.cause?.code,n=(t.error.message||"").toLowerCase();if(4001===e||n.includes("reject")||n.includes("cancel")||n.includes("denied"))throw ne(t.error,"Xverse connection rejected by user")}}const c=[...o].reverse().find(e=>null!==e.response)||null,u=c?i(c.response):null;if((!l||Array.isArray(l)&&0===l.length)&&"function"==typeof t.connect)try{const e=B({purposes:n,message:r,network:{type:"Mainnet"}});Q("\u26a0\ufe0f Xverse returned 0 addresses; retrying via provider.connect(token)..."),l=re(await t.connect(e))}catch(e){Q("\u26a0\ufe0f Xverse provider.connect(token) fallback failed:",e?.message||e)}if(!Array.isArray(l)||0===l.length){const e=u?` (lastResponse=${JSON.stringify(u)})`:"";throw new Error(`No addresses returned from Xverse${e}`)}const d=l.find(e=>{const t=oe(e);return"ordinals"===t||t.includes("ord")||t.includes("taproot")||ie(e?.address)}),p=l.find(e=>{const t=oe(e);return"payment"===t||t.includes("pay")||t.includes("p2w")||ae(e?.address)}),f=l[0]||null,m=l[1]||f,g=d||f&&(ie(f.address)?f:null)||f,h=p||f&&(ae(f.address)?f:null)||m;if(!g||!h)throw new Error("Missing usable address data from Xverse");return this.paymentAddress=h.address,this.ordinalsAddress=g.address,this.paymentPublicKey=h.publicKey,this.ordinalsPublicKey=g.publicKey,this.address=this.ordinalsAddress,this.isConnected=!0,J("\u2705 Xverse connected:",{ordinals:this.ordinalsAddress,payment:this.paymentAddress,ordinalsPublicKey:this.ordinalsPublicKey,paymentPublicKey:this.paymentPublicKey}),{address:this.address,paymentAddress:this.paymentAddress,ordinalsAddress:this.ordinalsAddress,paymentPublicKey:this.paymentPublicKey,ordinalsPublicKey:this.ordinalsPublicKey}}catch(tn){const t=ne(tn,"Xverse connection failed");try{globalThis.console?.warn?.("\u274c",t.message)}catch{}throw t}}async getAddress(){return this.requireConnected(),this.ordinalsAddress||this.address}async getAddresses(e=["ordinals","payment"]){this.requireConnected();try{const t=this.getProvider();J("\ud83d\udd0d Xverse: Requesting getAddresses with purposes:",e);const n=await te(t,"getAddresses",{purposes:e,message:"App requesting addresses"});return J("\u2705 Xverse getAddresses response:",n),n&&n.result&&n.result.addresses?n.result.addresses:[{purpose:"ordinals",address:this.ordinalsAddress,publicKey:this.ordinalsPublicKey},{purpose:"payment",address:this.paymentAddress,publicKey:this.paymentPublicKey}]}catch(tn){return Q("\u26a0\ufe0f Xverse getAddresses failed, using cached addresses:",tn),[{purpose:"ordinals",address:this.ordinalsAddress,publicKey:this.ordinalsPublicKey},{purpose:"payment",address:this.paymentAddress,publicKey:this.paymentPublicKey}]}}async getBalance(){this.requireConnected();try{const e=this.getProvider();if(!e||"function"!=typeof e.request)return Q("\u26a0\ufe0f Xverse provider does not have request method"),0;J("\ud83d\udd0d Xverse: Requesting getBalance...");const t=await te(e,"getBalance",void 0);let n;if(J("\ud83d\udd0d Xverse getBalance response:",t),t&&"2.0"===t.jsonrpc&&t.result)n=t.result;else{if(!t||"success"!==t.status||!t.result){if(t&&"error"===t.status)throw new Error(t.error?.message||"Failed to get balance from Xverse");return Q("\u26a0\ufe0f Unexpected response format from Xverse getBalance:",t),0}n=t.result}return n&&n.total?(J("\ud83d\udcb0 Xverse balance (sats):",n),{confirmed:parseInt(n.confirmed||"0",10),unconfirmed:parseInt(n.unconfirmed||"0",10),total:parseInt(n.total,10)}):(Q("\u26a0\ufe0f No balance data in response"),{confirmed:0,unconfirmed:0,total:0})}catch(tn){throw Z("\u274c Xverse getBalance failed:",tn),new Error(`Xverse getBalance failed: ${tn.message||"Unknown error"}`)}}async getInscriptions(e=0,t=100){this.requireConnected();try{const n=this.getProvider(),r=this.ordinalsAddress||this.address;J(`\ud83d\udce6 Xverse: Fetching inscriptions for ${r} (offset: ${e}, limit: ${t})`);const i=await te(n,"ord_getInscriptions",{offset:e,limit:t});if(J("\u2705 Xverse inscriptions response:",i),i&&"error"===i.status)throw Z("Xverse inscriptions error:",i.error),new Error(i.error.message||"Failed to get inscriptions");return(i?.result?.inscriptions||i?.inscriptions||[]).map(e=>({inscriptionId:e.inscriptionId||e.id,inscriptionNumber:e.inscriptionNumber||e.number,contentType:e.contentType||e.content_type,contentLength:e.contentLength||e.content_length,contentBody:`/content/${e.inscriptionId||e.id}`,timestamp:e.timestamp,genesisTransaction:e.genesisTransaction||e.genesis_transaction,location:e.location,output:e.output,outputValue:e.outputValue||e.output_value}))}catch(tn){throw Z("\u274c Failed to fetch Xverse inscriptions:",tn),tn}}async signPSBT(e,t={}){if(this.requireConnected(),!e||"string"!=typeof e)throw new Error("Invalid PSBT: must be a non-empty string");try{const r=this.getProvider();if(!r)throw new Error("Xverse provider not available");J("\ud83d\udd0f Xverse: Input options:",JSON.stringify(t,null,2));const i=!!t.broadcast,a=(()=>{const e=[];if(Array.isArray(t?.sighashTypes)&&e.push(...t.sighashTypes),Array.isArray(t?.toSignInputs))for(const r of t.toSignInputs)r&&"object"==typeof r&&(Array.isArray(r.sighashTypes)&&e.push(...r.sighashTypes),null!=r.sighashType&&e.push(r.sighashType));const n=e.map(e=>Number(e)).filter(e=>Number.isFinite(e));return Array.from(new Set(n))})();let o=[];if(t.toSignInputs&&Array.isArray(t.toSignInputs)){J("\ud83d\udd27 Converting toSignInputs to sats-connect inputsToSign format");const e={},n={};t.toSignInputs.forEach(t=>{if(t.address&&void 0!==t.index){const r=t.address===this.paymentAddress,i=t.address===this.ordinalsAddress;r||i?J(`\u2705 Input ${t.index}: ${r?"PAYMENT":"ORDINALS"} address`):(Q(`\u26a0\ufe0f Unknown address in input ${t.index}: ${t.address}`),Q(`   Expected payment: ${this.paymentAddress}`),Q(`   Expected ordinals: ${this.ordinalsAddress}`)),e[t.address]||(e[t.address]=[]),e[t.address].push(t.index);const a=null!=t.sighashType?Number(t.sighashType):Array.isArray(t.sighashTypes)&&t.sighashTypes.length>0?Number(t.sighashTypes[0]):null,o=null!=a&&Number.isFinite(a)?a:null,s=`${t.address}::${o??"default"}`;if(!n[s]){const e={address:t.address,signingIndexes:[]};null!=o&&(e.sigHash=o),n[s]=e}n[s].signingIndexes.push(t.index)}}),o=Object.values(n),J("\ud83d\udd27 Converted inputsToSign (with sigHash where applicable):",JSON.stringify(o)),J("\ud83d\udd11 Address/PubKey mapping:"),o.forEach(e=>{e.address===this.paymentAddress?J(`   ${e.address} (PAYMENT) -> pubkey: ${this.paymentPublicKey}`):e.address===this.ordinalsAddress&&J(`   ${e.address} (ORDINALS) -> pubkey: ${this.ordinalsPublicKey}`)})}else t.signInputs&&"object"==typeof t.signInputs&&(J("\ud83d\udd27 Converting signInputs to inputsToSign format"),o=Object.entries(t.signInputs).map(([e,t])=>({address:e,signingIndexes:t})),J("\ud83d\udd27 Converted from signInputs:",o));const s={};if(o.forEach(e=>{Array.isArray(e.signingIndexes)&&e.signingIndexes.length>0?(s[e.address]=e.signingIndexes,J(`\u2705 Including ${e.address.slice(0,10)}... with ${e.signingIndexes.length} input(s): [${e.signingIndexes.join(", ")}]`)):Q(`\u26a0\ufe0f Skipping address ${e.address} - no inputs to sign (${e.signingIndexes?.length||0} indexes)`)}),0===Object.keys(s).length)throw new Error("signInputs is empty - no addresses with inputs to sign!");J("\u2705 Final signInputs (filtered):",JSON.stringify(s,null,2));const l=/^[0-9a-fA-F]+$/.test(e),c=/^[A-Za-z0-9+/]+=*$/.test(e)&&!l;J("\ud83d\udd0d PSBT Diagnostic:"),J("   PSBT format: "+(l?"HEX":c?"BASE64":"UNKNOWN")),J(`   Addresses in signInputs: ${Object.keys(s).length}`),Object.keys(s).forEach(e=>{const t=e.startsWith("bc1p")||e.startsWith("tb1p"),n=e.startsWith("bc1q")||e.startsWith("tb1q"),r=e.startsWith("3")||e.startsWith("2");J(`   - ${e.slice(0,10)}...: ${t?"P2TR (Taproot)":n?"P2WPKH (Native SegWit)":r?"P2SH-P2WPKH (Wrapped SegWit)":"Unknown"} - inputs: [${s[e].join(", ")}]`)});try{const t=v(e,"Xverse","output");if(t.startsWith("70736274ff")){const e=(t.match(/0000000000/g)||[]).length;J(`   \ud83d\udccb PSBT appears to have ~${e} input(s) total`),J(`   \ud83d\udccb We're asking Xverse to sign ${Object.values(s).flat().length} of them`),e>Object.values(s).flat().length&&(Q("   \u26a0\ufe0f  PSBT has MORE inputs than we're signing!"),Q(`   \u26a0\ufe0f  This might mean input ${e-1} is unsigned (e.g., inscription tapscript)`),Q("   \u26a0\ufe0f  Xverse might be confused by the unsigned Taproot input"))}}catch(n){J(`   \u2139\ufe0f  Could not decode PSBT for diagnostic: ${n.message}`)}let u;if(l)J("\ud83d\udce6 Converting PSBT from HEX to BASE64 for Xverse..."),u=v(e,"Xverse","input"),J("   Original HEX length:",e.length,"chars"),J("   Converted BASE64 length:",u.length,"chars"),J("   First 50 chars of BASE64:",u.substring(0,50));else{if(!c)throw new Error("Invalid PSBT format: neither HEX nor BASE64");J("\u2705 PSBT already in BASE64 format"),u=e}J('\ud83d\udd0f Xverse: Calling request("signPsbt") with Sats Connect format'),J("   signInputs:",JSON.stringify(s,null,2)),J("   broadcast:",i);const d={psbt:u,signInputs:s,broadcast:i},p=o.filter(e=>Array.isArray(e.signingIndexes)&&e.signingIndexes.length>0);p.length>0&&(d.inputsToSign=p),Array.isArray(a)&&a.length&&(d.sighashTypes=a,d.allowedSighashTypes=a,d.allowedSighash=a);const f=await te(r,"signPsbt",d);if(J('\ud83d\udd0d Xverse request("signPsbt") response:',f),f&&"2.0"===f.jsonrpc&&f.error){const e=f.error.code,t=f.error.message||"PSBT signing failed";if(Z("\u274c Xverse JSON-RPC error:",e,t),"USER_REJECTION"===e||4001===e)throw new Error("User rejected the signing request");if(t.includes("No taproot scripts signed")||t.includes("taproot"))throw Z("\ud83d\udea8 XVERSE LIMITATION DETECTED:"),Z('   Error: "No taproot scripts signed"'),Z("   "),Z("   This happens when:"),Z("   1. PSBT has multiple inputs (e.g., parent + inscription)"),Z("   2. Some inputs are Taproot tapscript (inscription input)"),Z("   3. Xverse tries to sign ALL Taproot inputs, not just the ones specified"),Z("   "),Z("   WORKAROUND OPTIONS:"),Z("   A) Use Magic Eden or UniSat wallet (better Taproot support)"),Z("   B) Use single-input inscriptions (no parent)"),Z("   C) Wait for Xverse to fix multi-input Taproot PSBT handling"),Z("   "),Z("   Technical: Reveal PSBT has 2 inputs:"),Z("     - Input 0: Parent inscription (key-path, wallet signs)"),Z("     - Input 1: Inscription output (tapscript, local signing)"),Z("   Xverse sees input 1 and tries to sign it, but cannot."),new Error("Xverse cannot sign parent-child inscriptions. This is a known Xverse limitation with multi-input Taproot PSBTs. Please use Magic Eden or UniSat wallet for parent-child inscriptions, or create inscriptions without parents.");throw new Error(t)}if(f&&f.result&&f.result.txid&&!f.result.psbtBase64&&!f.result.psbt)return J("\u2705 Xverse broadcast successful! Transaction ID:",f.result.txid),J("   (No signed PSBT returned - wallet broadcasted directly)"),{broadcasted:!0,txid:f.result.txid,message:"Xverse broadcasted transaction automatically"};if(f&&"success"===f.status&&f.result){const e=f.result.psbtBase64||f.result.psbt||f.result;if(!e)throw new Error("No signed PSBT in response result");J('\u2705 Xverse PSBT signed successfully via request("signPsbt")'),J("   \u2139\ufe0f  Xverse v1.6.1 ignores broadcast flag - manual broadcast required");const t=v(e,"Xverse","output");return J("\ud83d\udd27 Converted signed PSBT: BASE64 \u2192 HEX for downstream processing"),t}if(f&&"error"===f.status){const e=f.error?.code;if("USER_REJECTION"===e||4001===e)throw new Error("User rejected the signing request");throw new Error(f.error?.message||"PSBT signing failed")}if(f&&"2.0"===f.jsonrpc&&f.result){if(f.result.txid&&!f.result.psbt&&!f.result.psbtBase64)return J("\u2705 Xverse broadcast successful! Transaction ID:",f.result.txid),{broadcasted:!0,txid:f.result.txid,message:"Xverse broadcasted transaction automatically"};const e=f.result.psbt||f.result.psbtBase64;if(!e)throw new Error("No signed PSBT in JSON-RPC result");J("\u2705 Xverse PSBT signed successfully (JSON-RPC format)"),J("   \u2139\ufe0f  Xverse v1.6.1 ignores broadcast flag - manual broadcast required");const t=v(e,"Xverse","output");return J("\ud83d\udd27 Converted signed PSBT: BASE64 \u2192 HEX for downstream processing"),t}if(f&&f.psbtBase64){J("\u2705 Xverse PSBT signed successfully (direct format)");const e=v(f.psbtBase64,"Xverse","output");return J("\ud83d\udd27 Converted signed PSBT: BASE64 \u2192 HEX for downstream processing"),e}throw new Error("Invalid response format from Xverse wallet")}catch(tn){throw Z("\u274c Xverse PSBT signing failed:",tn),new Error(`Xverse: ${tn?.message||"Unknown Xverse signing error"}`)}}async signPsbt(e,t={}){return await this.signPSBT(e,t)}async pushPsbt(e,t={}){Q("\u26a0\ufe0f Xverse: Manual broadcast required"),Q("   (Automatic broadcast via signPsbt should be attempted first)"),Q("   Throwing error to trigger manual broadcast UI...");const n=new Error("Xverse requires manual broadcast");throw n.walletType="Xverse",n.requiresManualBroadcast=!0,n}async pushTx(e){Q("\u26a0\ufe0f Xverse: Manual broadcast required"),Q("   (Automatic broadcast via signPsbt should be attempted first)"),Q("   Throwing error to trigger manual broadcast UI...");const t=new Error("Xverse requires manual broadcast");throw t.walletType="Xverse",t.requiresManualBroadcast=!0,t}async sendBitcoin(e,t){this.requireConnected(),q.validateSendParams(e,t);try{const n=this.getProvider(),r=await te(n,"sendTransfer",{recipients:[{address:e,amount:Number(t)}]});if("success"===r.status)return J("\u2705 Transaction sent:",r.result.txid),r.result.txid;if("error"===r.status)throw new Error(r.error?.message||"sendTransfer failed");return J("\u2705 Transaction sent:",r.txid||r.result?.txid),r.txid||r.result?.txid}catch(tn){throw Z("\u274c Failed to send Bitcoin:",tn),tn}}async getCapabilities(){this.requireConnected();try{return{walletType:"Xverse",methods:Object.keys(this.features).filter(e=>!0===this.features[e]),features:{multiAddress:!0,runes:!0,inscriptions:!0,batchOperations:!0,utxos:!1},addresses:{payment:this.paymentAddress,ordinals:this.ordinalsAddress}}}catch(tn){throw Z("\u274c Failed to get capabilities:",tn),tn}}async signMessage(e){this.requireConnected();try{const t=this.getProvider();return await te(t,"signMessage",{address:this.ordinalsAddress||this.address,message:e})}catch(tn){throw Z("\u274c Failed to sign message:",tn),tn}}async signTransaction(e,t={}){this.requireConnected();try{const n=this.getProvider(),r=await n.signTransaction(e,t);return J("\u2705 Transaction signed via Xverse signTransaction"),r}catch(tn){throw Z("\u274c Failed to sign transaction:",tn),tn}}async signMultipleTransactions(e,t={}){this.requireConnected();try{const n=this.getProvider(),r=await n.signMultipleTransactions(e,t);return J(`\u2705 ${r.length} transactions signed via Xverse`),r}catch(tn){throw Z("\u274c Failed to sign multiple transactions:",tn),tn}}async createInscription(e,t={}){this.requireConnected();try{const n=this.getProvider(),r=await n.createInscription({...e,...t});return J("\u2705 Inscription created via Xverse:",r),r}catch(tn){throw Z("\u274c Failed to create inscription:",tn),tn}}async createRepeatInscriptions(e){this.requireConnected();try{const t=this.getProvider();if(!t)throw new Error("Xverse provider not found");J("\ud83d\udd0d Xverse: Creating repeat inscriptions with payload:",{repeat:e.repeat,contentType:e.contentType,payloadType:e.payloadType,feeRate:e.suggestedMinerFeeRate});const n=B(e);J("\ud83d\udd0d Xverse: Created JWT token for repeat inscriptions request");const r=await t.createRepeatInscriptions(n);if(J("\u2705 Xverse repeat inscriptions response:",r),!r)throw new Error("No response from Xverse wallet");if(r.error)throw new Error(r.error.message||"Provider returned an error");const i={txId:r.txId,inscriptionIds:r.inscriptionIds||[],count:e.repeat};return J(`\u2705 ${e.repeat} inscriptions created via Xverse:`,i),i}catch(tn){if(Z("\u274c Failed to create repeat inscriptions:",tn),4001===tn.code||tn.message?.includes("cancel"))throw new Error("Batch inscription cancelled by user");throw new Error(`Batch inscription failed: ${tn.message}`)}}async getNetwork(){return"mainnet"}async getPublicKey(){return this.requireConnected(),this.ordinalsPublicKey||this.paymentPublicKey}async getAccounts(){return this.requireConnected(),[{purpose:"ordinals",address:this.ordinalsAddress,publicKey:this.ordinalsPublicKey},{purpose:"payment",address:this.paymentAddress,publicKey:this.paymentPublicKey}]}getState(){return{wallet:"Xverse",connected:!!this.isConnected,network:"mainnet",paymentAddress:this.paymentAddress,ordinalsAddress:this.ordinalsAddress,paymentPublicKey:this.paymentPublicKey,ordinalsPublicKey:this.ordinalsPublicKey}}async inscribe(e,t={}){this.requireConnected();try{const n=this.getProvider();if(!n)throw new Error("Xverse provider not found");const{contentType:r="text/plain;charset=utf-8",feeRate:i=10,receiverAddress:a,devAddress:o,devFee:s=0}=t;let l="PLAIN_TEXT",c=e;if((e instanceof ArrayBuffer||r.startsWith("image/"))&&(l="BASE_64",e instanceof ArrayBuffer)){const t=new Uint8Array(e);let n="";for(let e=0;e<t.byteLength;e++)n+=String.fromCharCode(t[e]);c=btoa(n)}const u={contentType:r,content:c,payloadType:l,network:{type:"Mainnet"}};i&&(u.suggestedMinerFeeRate=i),o&&s>0&&(u.appFeeAddress=o,u.appFee=s),J("\ud83d\udd0d Xverse: Creating inscription with payload:",{contentType:u.contentType,payloadType:u.payloadType,contentLength:c.length,feeRate:u.suggestedMinerFeeRate,hasServiceFee:!(!o||!s)});const d=B(u);J("\ud83d\udd0d Xverse: Created JWT token for inscription request");const p=await n.createInscription(d);if(J("\u2705 Xverse inscription response:",p),!p)throw new Error("No response from Xverse wallet");if(p.error)throw new Error(p.error.message||"Provider returned an error");const f={txId:p.txId,inscriptionId:p.inscriptionId||p.txId};return J("\u2705 Xverse inscription created:",f),f}catch(tn){if(Z("\u274c Xverse inscribe error:",tn),4001===tn.code||tn.message?.includes("cancel"))throw new Error("Inscription cancelled by user");throw new Error(`Inscription failed: ${tn.message}`)}}async getRunesBalance(){this.requireConnected();try{const e=this.getProvider();J("\ud83d\udd0d Xverse: Requesting runes_getBalance...");const t=await te(e,"runes_getBalance",void 0);return J("\u2705 Xverse runes balance:",t),t&&t.result?t.result:t}catch(tn){throw Z("\u274c Xverse getRunesBalance failed:",tn),tn}}async transferRunes(e){this.requireConnected();try{const t=this.getProvider();J("\ud83d\udd0d Xverse: Transferring runes:",e);const n=await te(t,"runes_transfer",e);return J("\u2705 Xverse runes transfer:",n),n}catch(tn){throw Z("\u274c Xverse transferRunes failed:",tn),tn}}async mintRunes(e){this.requireConnected();try{const t=this.getProvider();J("\ud83d\udd0d Xverse: Minting runes:",e);const n=await te(t,"runes_mint",e);return J("\u2705 Xverse runes mint:",n),n}catch(tn){throw Z("\u274c Xverse mintRunes failed:",tn),tn}}async etchRunes(e){this.requireConnected();try{const t=this.getProvider();J("\ud83d\udd0d Xverse: Etching runes:",e);const n=await te(t,"runes_etch",e);return J("\u2705 Xverse runes etch:",n),n}catch(tn){throw Z("\u274c Xverse etchRunes failed:",tn),tn}}async getRunesOrder(e){this.requireConnected();try{const t=this.getProvider();J("\ud83d\udd0d Xverse: Getting runes order:",e);const n=await te(t,"runes_getOrder",{orderId:e});return J("\u2705 Xverse runes order:",n),n}catch(tn){throw Z("\u274c Xverse getRunesOrder failed:",tn),tn}}async sendInscriptions(e){this.requireConnected();try{const t=this.getProvider();J("\ud83d\udd0d Xverse: Sending inscriptions:",e);const n=await te(t,"ord_sendInscriptions",e);return J("\u2705 Xverse inscriptions sent:",n),n}catch(tn){throw Z("\u274c Xverse sendInscriptions failed:",tn),tn}}},OKX:class extends q{constructor(){super("OKX"),this.walletInstance="undefined"!=typeof window?window.okxwallet?.bitcoin:null,this.features={connect:!0,getAddress:!1,getPublicKey:!0,getBalance:!0,getNetwork:!0,switchNetwork:!1,signMessage:!0,signPsbt:!0,signPsbts:!0,pushPsbt:!1,pushTx:!1,sendBitcoin:!0,sendInscription:!0,getInscriptions:!0,getAllInscriptions:!0,inscribe:!0,brc20:{transfer:!0,deploy:!0,mint:!0},runes:{send:!1,mint:!1,etch:!1},atomicals:{transfer:!1,mint:!1},arc20:{transfer:!1}}}isInstalled(){return!!this.walletInstance}async connect(){this.requireInstalled();const e=await this.walletInstance.connect();return this.address=e.address||e,this.publicKey=e.publicKey,this.isConnected=!0,le(),e}async getAddress(){this.requireConnected();const e=await this.walletInstance.getAccounts();return e&&e.length>0?e[0]:this.address}async getPublicKey(){return this.requireConnected(),await this.walletInstance.getPublicKey()}async getBalance(){this.requireConnected();const e=await this.walletInstance.getBalance();return S.balance(e,"OKX")}async getNetwork(){this.requireInstalled();const e=await this.walletInstance.getNetwork();return S.network(e)}async signMessage(e,t="ecdsa"){return this.requireConnected(),await this.walletInstance.signMessage(e,t)}async signPsbt(e,t={}){this.requireConnected(),le();const n=S.psbtFormat(String(e).trim(),"OKX","input"),r={...t||{}};!1===r.autoFinalized&&(r.autoFinalize=!1);const i=await this.walletInstance.signPsbt(n,r);return le(),i}async signPsbts(e,t=[]){if(this.requireConnected(),le(),!Array.isArray(e))throw new Error("Invalid PSBTs: must be an array");const n=e.map((e,t)=>{if("string"!=typeof e||0===e.length)throw new Error(`Invalid PSBT at index ${t}: must be a non-empty string`);try{return S.psbtFormat(String(e).trim(),"OKX","input")}catch{throw new Error(`Invalid PSBT at index ${t}: must be hex or base64`)}}),r=await this.walletInstance.signPsbts(n,t);return le(),r}async pushPsbt(e){throw new Error("OKX broadcast not supported - use OrdNexus extension or Bitcoin Proxy")}async pushTx(e){throw new Error("OKX broadcast not supported - use OrdNexus extension or Bitcoin Proxy")}async sendBitcoin(e,t){this.requireConnected(),q.validateSendParams(e,t);const n=await this.walletInstance.sendBitcoin(e,t);return le(),n}async sendInscription(e,t,n={}){this.requireConnected();const r=await this.walletInstance.sendInscription(e,t,n);return le(),r}async getInscriptions(e=0,t=100){this.requireConnected();const n=await this.walletInstance.getInscriptions(e,t);return n&&n.list?{list:n.list.map(e=>S.inscription(e,"OKX")),total:n.total}:{list:[],total:0}}async inscribe(e,t={}){if(this.requireConnected(),"string"==typeof e&&e.length<=5&&!t.contentType&&!t.receiveAddress)return le(),await this.walletInstance.inscribe({type:51,from:this.address,tick:e});le();const n={contentType:t.contentType||"text/plain;charset=utf-8",body:e},r={type:61,from:this.address,inscriptions:[n]};return le(),await this.walletInstance.mint(r)}async inscribeTransfer(e,t){this.requireConnected();const n=await this.walletInstance.inscribe({type:51,from:this.address,tick:e});return le(),n}async getAccounts(){return this.requireInstalled(),await this.walletInstance.getAccounts()}async splitUtxo(e){return this.requireConnected(),await this.walletInstance.splitUtxo(e)}async transferNft(e,t){return this.requireConnected(),await this.walletInstance.transferNft(e,t)}async watchAsset(e){return this.requireInstalled(),await this.walletInstance.watchAsset(e)}async mint(e){return this.requireConnected(),e.from||(e.from=this.address),await this.walletInstance.mint(e)}setupEventListeners(){if(!this.isInstalled())return;const e=this.walletInstance;e&&e.on&&(e.on("accountsChanged",e=>{le(),e&&0!==e.length?this.address=e[0]:(this.address=null,this.publicKey=null,this.isConnected=!1)}),e.on("networkChanged",e=>{le()}),le())}removeEventListeners(){if(!this.isInstalled())return;const e=this.walletInstance;e&&e.removeAllListeners&&(e.removeAllListeners("accountsChanged"),e.removeAllListeners("networkChanged"))}},Leather:class extends q{constructor(){super("Leather"),this.walletInstance=this.getProvider(),this.features={connect:!0,getAddress:!0,getPublicKey:!1,getBalance:!1,getNetwork:!1,switchNetwork:!1,signMessage:!0,signPsbt:!0,signPsbts:!1,pushPsbt:!1,pushTx:!1,sendBitcoin:!1,sendInscription:!1,getInscriptions:!1,getAllInscriptions:!1,inscribe:!1,brc20:!1,runes:!1,atomicals:!1,arc20:!1,stacksSupport:!0,structuredData:!0,authentication:!0,stacksTransaction:!0,profileUpdate:!0,getProductInfo:!0,getURL:!0}}getProvider(){if("undefined"==typeof window)return null;if(window.LeatherProvider)return ue(),window.LeatherProvider;if(window.HiroWalletProvider)return ue(),window.HiroWalletProvider;if(window.btc_providers&&Array.isArray(window.btc_providers))for(const e of window.btc_providers)if(("LeatherProvider"===e.id||"Leather"===e.name)&&"function"==typeof e.request)return ue(),e;return null}isInstalled(){return!!this.walletInstance}async connect(){this.requireInstalled();try{const e=this.getProvider();if(!e||"function"!=typeof e.request)throw new Error("Leather provider.request method not available");ue();const t=await e.request("getAddresses"),n=t.result?.addresses||t.addresses;if(!n||0===n.length)throw new Error("No addresses returned from Leather");ue(n.map(e=>e.type));const r=n.find(e=>"p2tr"===e.type),i=n.find(e=>"p2wpkh"===e.type),a=r||i||n[0],o=i||r||n[0];return r&&i||r||i?ue():de(),this.address=a?.address,this.ordinalsAddress=a?.address,this.paymentAddress=o?.address,this.isConnected=!0,ue(),{address:this.address,ordinalsAddress:this.ordinalsAddress,paymentAddress:this.paymentAddress,allAddresses:n}}catch(tn){throw de(),tn}}async getAddress(){return this.requireConnected(),this.address}async getAccounts(){this.requireConnected();try{const e=this.getProvider(),t=await e.request("getAddresses");return t.result?.addresses||t.addresses}catch(tn){throw de(),tn}}async getProductInfo(){this.requireInstalled();try{const e=this.getProvider(),t=await e.getProductInfo();return ue(),t}catch(tn){throw de(),tn}}async getURL(){this.requireInstalled();try{const e=this.getProvider();return await e.getURL()}catch(tn){throw de(),tn}}async signMessage(e,t={}){this.requireConnected();try{const n=this.getProvider();ue();const r=await n.signatureRequest({message:e,...t});return ue(),r}catch(tn){throw de(),tn}}async signStructuredData(e){this.requireConnected();try{const t=this.getProvider();ue();const n=await t.structuredDataSignatureRequest(e);return ue(),n}catch(tn){throw de(),tn}}async signPsbt(e,t={}){if(this.requireConnected(),!e||"string"!=typeof e)throw new Error("Invalid PSBT: must be a non-empty string");try{const a=this.getProvider();if(!a)throw new Error("Leather provider not available");ue(),ue();const o=t?.toSignInputs||t?.inputsToSign||[],s=Array.isArray(o)?o.map(e=>"number"==typeof e?.index?e.index:null).filter(e=>null!==e):void 0,l={};Array.isArray(o)&&o.forEach(e=>{if("number"==typeof e?.index)if("number"==typeof e.sighashType)l[e.index]=e.sighashType;else if(Array.isArray(e.sighashTypes)&&e.sighashTypes.length>0){const t=e.sighashTypes.find(e=>0!==e&&0!==e);t&&(l[e.index]=t)}});const c=(e,n=!1)=>{const r=n?{psbt:e}:{hex:e};return"boolean"==typeof t?.broadcast&&(r.broadcast=!!t.broadcast),t?.network&&(r.network=t.network),s&&s.length>0&&(r.signAtIndex=s),Object.keys(l).length>0&&(r.inputSighashMap=l,ue()),r};try{ue();const t=await a.request("signPsbt",c(e));return ue(),t?.result?.hex||t?.hex||t?.psbt||t}catch(n){de()}try{ue();const t=v(e,"Leather","input"),n=await a.request("signPsbt",c(t));ue();const r=n?.result?.hex||n?.hex||n?.psbt||n;return/^[A-Za-z0-9+/]+=*$/.test(r)?v(r,"Leather","output"):r}catch(r){de()}try{ue();const t=v(e,"Leather","input"),n=await a.request("signPsbt",c(t,!0));ue();const r=n?.result?.hex||n?.hex||n?.psbt||n;return/^[A-Za-z0-9+/]+=*$/.test(r)?v(r,"Leather","output"):r}catch(i){throw de(),new Error("All PSBT format attempts failed.")}}catch(tn){de(),de();const t=tn?.message||tn?.toString()||"Unknown Leather signing error";if(t.includes("User rejected")||t.includes("cancelled"))throw new Error("User rejected the signing request");throw new Error(`Leather signing failed: ${t}`)}}async authenticate(e={}){this.requireInstalled();try{const t=this.getProvider();ue();const n=await t.authenticationRequest(e);return ue(),n}catch(tn){throw de(),tn}}async sendStacksTransaction(e){this.requireConnected();try{const t=this.getProvider();ue();const n=await t.transactionRequest(e);return ue(),n}catch(tn){throw de(),tn}}async updateProfile(e){this.requireConnected();try{const t=this.getProvider();ue();const n=await t.profileUpdateRequest(e);return ue(),n}catch(tn){throw de(),tn}}},Phantom:class extends q{constructor(){super("Phantom"),this.publicKey=null,this.paymentAddress=null,this.paymentPublicKey=null,this.walletInstance="undefined"!=typeof window?window.phantom?.bitcoin:null,this.features={connect:!0,getAddress:!0,getPublicKey:!0,getBalance:!0,getNetwork:!0,signMessage:!0,signPsbt:!0,sendBitcoin:!0,eventListeners:!0}}isInstalled(){return!!this.walletInstance}async connect(){this.requireInstalled();try{const e=await this.walletInstance.requestAccounts();if(!e||!Array.isArray(e)||0===e.length)throw new Error("No accounts returned from Phantom wallet");fe(),fe(e.length);const t=e.find(e=>"ordinals"===e.purpose),n=e.find(e=>"payment"===e.purpose);if(t&&n)fe(),this.address=t.address,this.publicKey=t.publicKey,this.paymentAddress=n.address,this.paymentPublicKey=n.publicKey;else{fe();const t=e[0];this.address=t.address,this.publicKey=t.publicKey,this.paymentAddress=t.address,this.paymentPublicKey=t.publicKey,me(),me()}return this.isConnected=!0,fe(),{address:this.address,ordinalsAddress:this.address===this.paymentAddress?null:this.address,paymentAddress:this.paymentAddress,publicKey:this.publicKey,paymentPublicKey:this.paymentPublicKey}}catch(tn){throw me(),tn}}async getAddress(){this.requireConnected();try{return(await this.walletInstance.getAccounts())[0].address}catch(tn){return me(),this.address}}async getPublicKey(){return this.requireConnected(),this.publicKey}async getAccounts(){this.requireConnected();try{return[this.address]}catch(tn){throw me(),tn}}async signMessage(e){this.requireConnected();try{const t=await this.walletInstance.signMessage(e);return"string"==typeof t?t:t.signature}catch(tn){throw me(),tn}}async signPsbt(e,t={}){this.requireConnected();try{fe();const u=()=>"undefined"!=typeof Buffer&&Buffer&&"function"==typeof Buffer.from,d=e=>{const t=String(e||"").trim();if(!/^[0-9a-fA-F]+$/.test(t)||t.length%2!=0)throw new Error("Invalid hex string");const n=new Uint8Array(t.length/2);for(let r=0;r<t.length;r+=2)n[r/2]=parseInt(t.slice(r,r+2),16);return n},p=e=>{const t=e instanceof Uint8Array?e:new Uint8Array(e);let n="";for(let r=0;r<t.length;r++)n+=t[r].toString(16).padStart(2,"0");return n},f=e=>{const t=e instanceof Uint8Array?e:new Uint8Array(e);if(u())return Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("base64");if("function"!=typeof btoa)throw new Error("Base64 encoding not available");let n="";for(let r=0;r<t.length;r+=32768){const e=t.subarray(r,r+32768);n+=String.fromCharCode.apply(null,Array.from(e))}return btoa(n)},m=e=>{const t=String(e||"").trim();if(u()){const e=Buffer.from(t,"base64");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}if("function"!=typeof atob)throw new Error("Base64 decoding not available");const n=atob(t),r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r};let g=null,h=null,b=e;try{"string"==typeof e&&e.toLowerCase().startsWith("70736274")?(g=d(e),h=f(g),fe()):"string"==typeof e&&e.startsWith("cHNidP")?(g=m(e),h=e,fe()):e instanceof Uint8Array&&(g=e,h=f(e),fe())}catch(n){me()}const x=y({...t,defaultAddress:this.address,paymentAddress:this.paymentAddress},"Phantom");let w;fe();const v=async(e=null)=>{fe();const t=g||h||b;return e?await this.walletInstance.signPSBT(t,e):await this.walletInstance.signPSBT(t)},S=async(e=null)=>{fe();const t=g||h||b;return e?await this.walletInstance.signPsbt(t,e):await this.walletInstance.signPsbt(t)},E=async()=>{if("function"!=typeof this.walletInstance.request)throw me(),new Error("Phantom Bitcoin API does not support request() method. Please ensure Phantom wallet is updated.");fe();try{return await this.walletInstance.request({method:"signPSBT",params:{psbt:g||h||b,options:x}})}catch(e){return me(),await this.walletInstance.request({method:"signPSBT",params:[g||h||b,x]})}};if("function"==typeof this.walletInstance.signPSBT)try{w=await v(null)}catch(r){me();try{me(),w=await v(x)}catch(i){me();try{w=await v({})}catch(a){if(me(),"function"==typeof this.walletInstance.signPsbt)try{w=await S(null)}catch(o){try{w=await S(x)}catch(s){me();try{w=await E()}catch(l){throw me(),new Error(`Phantom signing failed: ${r.message}. Tried signPSBT and signPsbt methods.`)}}}else{me();try{w=await E()}catch(o){throw me(),new Error(`Phantom signing failed: ${r.message}. Tried signPSBT, signPsbt, and request() methods.`)}}}}}else if("function"==typeof this.walletInstance.signPsbt)try{w=await S(null)}catch(r){try{w=await S(x)}catch(i){throw new Error(`Phantom signPsbt failed: ${i.message}`)}}else try{w=await E()}catch(c){throw new Error("Phantom wallet does not have signPSBT, signPsbt, or request() methods available. Please update your Phantom wallet.")}let N;if(fe(),w instanceof Uint8Array)fe(),N=p(w),fe();else if("undefined"!=typeof Buffer&&Buffer.isBuffer(w))fe(),N=w.toString("hex");else if("string"==typeof w)w.startsWith("cHNidP")?(fe(),N=p(m(w))):N=w;else if(w?.signedPsbtHex)N=w.signedPsbtHex;else if(w?.signedPsbt)N=w.signedPsbt;else{if(!w?.psbt)throw me(),new Error("Phantom returned unexpected PSBT format");N=w.psbt}return fe(),N}catch(tn){throw me(),tn}}async getBalance(){this.requireConnected();try{return me(),{confirmed:0,unconfirmed:0,total:0}}catch(tn){throw me(),tn}}async getNetwork(){this.requireInstalled();try{return x(await this.walletInstance.getNetwork())}catch(tn){return me(),"livenet"}}async sendBitcoin(e,t,n={}){this.requireConnected(),q.validateSendParams(e,t);try{const r=await this.walletInstance.sendTransfer({recipientAddress:e,amount:t,...n});return fe(),r}catch(tn){throw me(),tn}}setupEventListeners(){this.isInstalled()&&(this.walletInstance.on("accountsChanged",e=>{fe(),e&&e.length>0?(this.address=e[0].address,this.publicKey=e[0].publicKey):(this.address=null,this.publicKey=null,this.isConnected=!1)}),fe())}removeEventListeners(){this.isInstalled()&&("function"==typeof this.walletInstance.removeAllListeners&&this.walletInstance.removeAllListeners("accountsChanged"),fe())}},Wizz:class extends q{constructor(){super("Wizz"),this.walletInstance="undefined"!=typeof window?window.wizz:null,this.features={connect:!0,getAddress:!0,getPublicKey:!0,getBalance:!0,getNetwork:!0,switchNetwork:!0,signMessage:!0,signPsbt:!0,signPsbts:!1,pushPsbt:!0,pushTx:!0,sendBitcoin:!0,sendInscription:!1,getInscriptions:!0,getAllInscriptions:!0,inscribe:!0,brc20:{transfer:!0,deploy:!0,mint:!0},runes:{send:!0,mint:!1,etch:!1},atomicals:{transfer:!0,mint:!0},arc20:{transfer:!0},biHelix:!0,cpfp:!0,mempoolInjection:!0,bip322:!0}}isInstalled(){return!!this.walletInstance}async connect(){this.requireInstalled();try{he();const t=this.walletInstance;let n=null;if("function"==typeof t.connect)he(),n=await t.connect();else if("function"==typeof t.requestAccounts)he(),n=await t.requestAccounts();else{if("function"!=typeof t.getAccounts)throw new Error("Wizz wallet has no connection methods available");he(),n=await t.getAccounts()}if(he(),!n)throw new Error("No response from Wizz wallet");if("object"==typeof n&&n.address)this.address=n.address,this.publicKey=n.publicKey;else if(Array.isArray(n)&&n.length>0)this.address=n[0];else{if("string"!=typeof n)throw new Error("Unexpected response format from Wizz wallet");this.address=n}if(!this.address)throw new Error("Could not extract address from Wizz response");if(!this.publicKey&&"function"==typeof t.getPublicKey)try{this.publicKey=await t.getPublicKey(),he()}catch(e){be()}return this.isConnected=!0,he(),{address:this.address,publicKey:this.publicKey}}catch(tn){if(be(),-32603===tn.code)throw new Error("Wizz wallet error: Please unlock your wallet and refresh the page");if(tn.message?.includes("User rejected"))throw new Error("Connection request was rejected");throw tn}}async getAddress(){return this.requireConnected(),(await this.walletInstance.getAccounts())[0]}async getPublicKey(){return this.requireConnected(),await this.walletInstance.getPublicKey()}async getAccounts(){return this.requireInstalled(),await this.walletInstance.getAccounts()}async getBalance(){this.requireConnected();const e=await this.walletInstance.getBalance();return S.balance(e,"Wizz")}async getNetwork(){this.requireInstalled();try{const e=await this.walletInstance.getNetwork();return S.network(e)}catch(tn){return be(),"livenet"}}async switchNetwork(e){this.requireInstalled(),await this.walletInstance.switchNetwork(e),he()}async getChain(){return this.requireInstalled(),await this.walletInstance.getChain()}async switchChain(e){this.requireInstalled(),await this.walletInstance.switchChain(e),he()}async signMessage(e,t="ecdsa"){return this.requireConnected(),await this.walletInstance.signMessage(e,t)}async verifyMessage(e,t,n){return this.requireInstalled(),await this.walletInstance.verifyMessage(e,t,n)}async verifyMessageOfBIP322Simple(e,t,n){return this.requireInstalled(),await this.walletInstance.verifyMessageOfBIP322Simple(e,t,n)}async signPsbt(e,t={}){return this.requireConnected(),await this.walletInstance.signPsbt(e,t)}async pushPsbt(e){this.requireConnected();const t=await this.walletInstance.pushPsbt(e);return he(),t}async pushTx(e){this.requireConnected();const t=await this.walletInstance.pushTx({rawtx:e});return he(),t}async sendBitcoin(e,t,n={}){this.requireConnected(),q.validateSendParams(e,t);const r=await this.walletInstance.sendBitcoin(e,t,n);return he(),r}async getBitcoinUtxos(){return this.requireConnected(),await this.walletInstance.getBitcoinUtxos()}async injectMempool(e){return this.requireConnected(),await this.walletInstance.injectMempool(e)}async requestCPFP(e){this.requireConnected();const t=await this.walletInstance.requestCPFP(e);return he(),t}async getInscriptions(e=0,t=100){this.requireConnected();try{const n=this.walletInstance;let r=[];if("function"==typeof n.getInscriptions){he();const i=await n.getInscriptions(e,t);Array.isArray(i)?r=i:i&&i.list?r=i.list:i&&i.inscriptions?r=i.inscriptions:i&&i.result&&(r=i.result.inscriptions||i.result.list||[])}else{if("function"!=typeof n.getOrdinals)return be(),{list:[],total:0};{he();const i=await n.getOrdinals(e,t);r=Array.isArray(i)?i:i.list||i.inscriptions||[]}}return he(r.length),{list:r.map(e=>S.inscription(e,"Wizz")),total:r.length}}catch(tn){return be(),{list:[],total:0}}}async getInscriptionsByAddress(e,t=0,n=100){return this.requireInstalled(),await this.walletInstance.getInscriptionsByAddress(e,t,n)}async getAssets(){return this.requireConnected(),await this.walletInstance.getAssets()}async inscribe(e,t={}){this.requireConnected();try{const{contentType:n="text/plain;charset=utf-8",encoding:r="utf8",feeRate:i,receiveAddress:a,serviceFee:o=0,metadata:s}=t,l={type:61,from:this.address,inscriptions:[{contentType:n,body:e}]};if(i&&(l.feeRate=i),n.includes("brc-20")||s&&s.brc20){l.type=51;const t=s.brc20||JSON.parse(e);l.tick=t.tick}n.startsWith("image/")&&(l.type=62);const c=await this.walletInstance.inscribe(l);return he(),{inscriptionId:c.inscriptionId||c.revealTxs?.[0],txId:c.commitTx||c.txId,revealTxIds:c.revealTxs,commitTxFee:c.commitTxFee,revealTxFees:c.revealTxFees}}catch(tn){throw be(),new Error(`Inscription failed: ${tn.message}`)}}async requestMint(e){return this.requireConnected(),await this.walletInstance.requestMint(e)}async sendARC20(e,t,n){this.requireConnected();const r=await this.walletInstance.sendARC20(e,t,n);return he(),r}async sendAtomicals(e){this.requireConnected();const t=await this.walletInstance.sendAtomicals(e);return he(),t}async isAtomicalsEnabled(){return this.requireInstalled(),await this.walletInstance.isAtomicalsEnabled()}async isBiHelixAddress(e){return this.requireInstalled(),await this.walletInstance.isBiHelixAddress(e)}async getBiHelixDescriptor(){return this.requireConnected(),await this.walletInstance.getBiHelixDescriptor()}async viewAddress(e){this.requireInstalled(),await this.walletInstance.viewAddress(e)}async getVersion(){return this.requireInstalled(),await this.walletInstance.getVersion()}setupEventListeners(){if(!this.isInstalled())return;const e=this.walletInstance;e&&e.on&&(e.on("accountsChanged",e=>{he(),e&&0!==e.length?(this.address=e[0],this.publicKey=null):(this.address=null,this.publicKey=null,this.isConnected=!1)}),e.on("networkChanged",e=>{he()}),he())}removeEventListeners(){if(!this.isInstalled())return;const e=this.walletInstance;e&&e.removeAllListeners&&(e.removeAllListeners("accountsChanged"),e.removeAllListeners("networkChanged"))}},MagicEden:class extends q{constructor(){super("MagicEden"),this.paymentAddress=null,this.ordinalsAddress=null,this.walletInstance=this.getProvider(),this.features={connect:!0,getAddress:!0,getPublicKey:!1,getBalance:!1,getNetwork:!0,switchNetwork:!1,signMessage:!0,signPsbt:!0,signPsbts:!0,signTransaction:!0,pushPsbt:!1,pushTx:!1,sendBitcoin:!0,sendInscription:!1,getInscriptions:!1,getAllInscriptions:!1,inscribe:!1,brc20:{transfer:!1,deploy:!1,mint:!1},runes:{send:!1,mint:!1,etch:!1},atomicals:{transfer:!1,mint:!1},arc20:{transfer:!1},jwtAuth:!0,hardwareDetection:!0}}getProvider(){return"undefined"==typeof window?null:window.magicEden?.bitcoin?.isMagicEden?window.magicEden.bitcoin:window.BitcoinProvider?.isMagicEden?window.BitcoinProvider:null}isInstalled(){return!!this.walletInstance}async connect(){this.requireInstalled();const e=this.walletInstance,t=void 0!==window.XverseProviders||"function"==typeof window.BitcoinProvider?.request,n=void 0!==window.LeatherProvider;if((t||n)&&!e?.isMagicEden)throw new Error(`\ud83d\udea8 WALLET CONFLICT DETECTED\n\nMagic Eden cannot coexist with other Bitcoin wallets.\nDetected: ${t?"Xverse ":""}${n?"Leather":""}\n\nSOLUTIONS:\n1. Disable Xverse and Leather extensions\n2. Refresh the page\n3. Try again\n\nOR use Xverse wallet instead (recommended for multi-wallet support)`);if(!e||!e.isMagicEden)throw new Error("\u26a0\ufe0f Magic Eden wallet is installed but cannot be accessed.\n\nThis happens when multiple Bitcoin wallets are installed.\n\nSOLUTION:\n1. Disable Xverse and Leather extensions\n2. Refresh the page\n3. Try again\n\nOR use Xverse wallet instead (recommended)");try{const t=B({purposes:["payment","ordinals"],message:"Connect to view your Bitcoin addresses",network:{type:"Mainnet"}}),n=await e.connect(t);if(!n?.addresses||!Array.isArray(n.addresses))throw new Error("No addresses returned from Magic Eden wallet");const r=n.addresses.find(e=>"payment"===e.purpose),i=n.addresses.find(e=>"ordinals"===e.purpose);if(!r&&!i)throw new Error("No valid addresses returned");return this.paymentAddress=r?.address,this.ordinalsAddress=i?.address,this.address=i?.address||r?.address,this.publicKey=r?.publicKey||i?.publicKey,this.isConnected=!0,xe(),{address:this.address,paymentAddress:this.paymentAddress,ordinalsAddress:this.ordinalsAddress,publicKey:this.publicKey}}catch(tn){throw we(),tn}}async getAddress(){return this.requireConnected(),this.address}async getAccounts(){return this.requireConnected(),[{address:this.paymentAddress,publicKey:this.publicKey,purpose:"payment"},{address:this.ordinalsAddress,publicKey:this.publicKey,purpose:"ordinals"}].filter(e=>e.address)}getState(){const e=this.paymentAddress||this.address||null,t=this.ordinalsAddress||this.address||null;return{wallet:"MagicEden",connected:!!this.isConnected,network:"mainnet",paymentAddress:e,ordinalsAddress:t,paymentPublicKey:this.publicKey||null,ordinalsPublicKey:this.publicKey||null,address:this.address||t||e||null}}async getBalance(){return this.requireConnected(),xe(),{confirmed:0,unconfirmed:0,total:0}}async getNetwork(){return"mainnet"}async signMessage(e){this.requireConnected();try{const t=B({address:this.address,message:e,protocol:"BIP322"}),n=await this.walletInstance.signMessage(t);return xe(),n}catch(tn){throw we(),new Error(`Message signing failed: ${tn.message}`)}}async signPsbt(e,t={}){this.requireConnected();try{const n=e=>"string"==typeof e&&/^[0-9a-fA-F]+$/.test(e)&&e.length%2==0,r=e=>{const t=e.length,n=new Uint8Array(t/2);for(let r=0;r<t;r+=2)n[r/2]=parseInt(e.slice(r,r+2),16);return n},i=e=>{let t="";for(let n=0;n<e.length;n++)t+=e[n].toString(16).padStart(2,"0");return t},a=e=>{if("undefined"!=typeof Buffer)return Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("base64");let t="";for(let n=0;n<e.length;n+=32768){const r=e.subarray(n,n+32768);t+=String.fromCharCode.apply(null,Array.from(r))}return btoa(t)},o=e=>{if("undefined"!=typeof Buffer){const t=Buffer.from(e,"base64");return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}const t=atob(e),n=new Uint8Array(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n},s=e=>a(r(e)),l=e=>i(o(e));let c=e;n(e)&&(xe(),c=s(e));const u=(()=>{const e=Array.isArray(t?.toSignInputs)?t.toSignInputs:[],n=new Map;for(const t of e){if(!t||"object"!=typeof t)continue;const e=t.address||this.ordinalsAddress||this.paymentAddress||this.address,r=Number(t.index);!e||!Number.isFinite(r)||r<0||(n.has(e)||n.set(e,[]),n.get(e).push(r))}if(0===n.size){const e=this.ordinalsAddress||this.address;e&&n.set(e,[0])}return Array.from(n.entries()).map(([e,t])=>({address:e,signingIndexes:Array.from(new Set(t)).sort((e,t)=>e-t)}))})();xe(),xe(u.length);const d=B({network:{type:"Mainnet"},message:"Sign inscription transaction",psbtBase64:c,broadcast:!1,inputsToSign:u}),p=await this.walletInstance.signTransaction(d);if(xe(),p?.psbtBase64)return n(e)?l(p.psbtBase64):p.psbtBase64;throw new Error("No signed PSBT returned from Magic Eden")}catch(tn){if(we(),tn.message?.includes("Magic Number"))throw new Error("PSBT format error: Magic Eden expects base64 format. This error has been fixed - please try again.");throw new Error(`PSBT signing failed: ${tn.message}`)}}async signPsbts(e,t=[]){this.requireConnected();try{xe(e.length);const n=[];for(let r=0;r<e.length;r++){const i=e[r],a=Array.isArray(t)?t[r]||{}:t;xe(e.length);const o=await this.signPsbt(i,a);n.push(o)}return xe(n.length),n}catch(tn){throw we(),new Error(`Batch PSBT signing failed: ${tn.message}`)}}async signTransaction(e){this.requireConnected();const t=await this.walletInstance.signTransaction(e);return xe(),t}async signMultipleTransactions(e){this.requireConnected();const t=await this.walletInstance.signMultipleTransactions(e);return xe(t.length),t}async sendBitcoin(e,t){this.requireConnected(),q.validateSendParams(e,t);try{const n=t,r=this.paymentAddress;if(!r)throw new Error("Payment address not available. Please reconnect wallet.");const i=B({recipients:[{address:e,amountSats:n}],senderAddress:r}),a=await this.walletInstance.sendBtcTransaction(i);return xe(),a}catch(tn){we();let t=tn.message||"Unknown error";throw t.includes("validation")?t="Invalid address format. Please check the recipient address.":t.includes("rejected")?t="Transaction was rejected by user":t.includes("insufficient")&&(t="Insufficient balance to complete transaction"),new Error(`Send transaction failed: ${t}`)}}async getInscriptions(e=0,t=100){return this.requireConnected(),{list:[],total:0}}async isHardware(){if(!this.walletInstance)throw new Error("Provider not initialized");try{return await this.walletInstance.isHardware()}catch(tn){return we(),!1}}async call(e,t={}){if(!this.walletInstance||!this.walletInstance.call)throw new Error("Magic Eden RPC call method not available");try{xe();const n=await this.walletInstance.call(e,t);return xe(),n}catch(tn){throw we(),new Error(`RPC call failed: ${tn.message}`)}}setupEventListeners(){if(!this.isInstalled())return;const e=this.walletInstance;e&&e.on&&(e.on("accountsChanged",e=>{xe(),e&&0!==e.length?(this.paymentAddress=e[0],this.ordinalsAddress=e[0]):(this.paymentAddress=null,this.ordinalsAddress=null,this.isConnected=!1)}),xe())}removeEventListeners(){if(!this.isInstalled())return;const e=this.walletInstance;e&&e.removeAllListeners&&e.removeAllListeners("accountsChanged")}},Oyl:class extends q{constructor(){super("Oyl"),this.paymentAddress=null,this.ordinalsAddress=null,this.paymentPublicKey=null,this.ordinalsPublicKey=null,this.walletInstance="undefined"!=typeof window?window.oyl:null,this.features={connect:!0,getAddress:!0,getPublicKey:!1,getBalance:!0,getNetwork:!0,switchNetwork:!0,signMessage:!0,signPsbt:!0,signPsbts:!0,pushPsbt:!0,pushTx:!1,sendBitcoin:!0,sendInscription:!1,getInscriptions:!0,getAllInscriptions:!0,inscribe:!1,brc20:{transfer:!1,deploy:!1,mint:!1},runes:{send:!1,mint:!1,etch:!1},atomicals:{transfer:!1,mint:!1},arc20:{transfer:!1},relayProvider:!0}}isInstalled(){return!!this.walletInstance}async connect(){this.requireInstalled();try{Se();const e=this.walletInstance,t=await e.getAddresses();if(Se(),!t)throw new Error("No response from Oyl wallet");const n=(...e)=>{for(const n of e){const e=t?.[n];if(e&&"object"==typeof e&&"string"==typeof e.address&&e.address)return e}return null},r=n("taproot","p2tr","ordinals","ordinal"),i=n("nativeSegwit","nativeSegWit","p2wpkh","segwit","bech32","payment")||n("nestedSegwit","nestedSegWit","p2shSegwit","nested","p2sh")||n("legacy","p2pkh");if(r&&(this.address=r.address,this.ordinalsAddress=r.address,this.publicKey=r.publicKey,this.ordinalsPublicKey=r.publicKey),i?(this.paymentAddress=i.address,this.paymentPublicKey=i.publicKey,this.address||(this.address=i.address,this.publicKey=i.publicKey)):Ee(),!this.address)throw new Error("No valid address returned from Oyl wallet");return this.isConnected=!0,Se(),{address:this.address,ordinalsAddress:this.ordinalsAddress,paymentAddress:this.paymentAddress,publicKey:this.publicKey,ordinalsPublicKey:this.ordinalsPublicKey,paymentPublicKey:this.paymentPublicKey}}catch(tn){throw Ee(),tn}}async disconnect(){this.requireInstalled(),await this.walletInstance.disconnect(),this.isConnected=!1,this.address=null,this.ordinalsAddress=null,this.paymentAddress=null,this.publicKey=null,this.ordinalsPublicKey=null,this.paymentPublicKey=null,Se()}async isConnectedCheck(){if(!this.isInstalled())return!1;try{return await this.walletInstance.isConnected()}catch(tn){return this.isConnected}}async getAddress(){this.requireConnected();try{const e=await this.walletInstance.getAddresses();return e&&e.taproot&&e.taproot.address?e.taproot.address:this.address}catch(tn){return Ee(),this.address}}async getAccounts(){this.requireInstalled();try{const e=await this.walletInstance.getAddresses();if(!e||"object"!=typeof e)return[];const t=[];for(const n of Object.values(e))n&&"object"==typeof n&&"string"==typeof n.address&&n.address&&t.push(n.address);return[...new Set(t)]}catch(tn){throw Ee(),tn}}async getBalance(){this.requireConnected();try{if("function"==typeof this.walletInstance.getBalance){const e=await this.walletInstance.getBalance();return S.balance(e,"Oyl")}throw new Error("Oyl wallet does not support balance fetching")}catch(tn){throw new Error(`Failed to get Oyl balance: ${tn.message}`)}}async getNetwork(){this.requireInstalled();try{if("function"==typeof this.walletInstance.getNetwork){const e=await this.walletInstance.getNetwork();return S.network(e)}return"livenet"}catch(tn){return Ee(),"livenet"}}async switchNetwork(e){this.requireInstalled(),await this.walletInstance.switchNetwork(e),Se()}async signMessage(e,t={}){this.requireConnected();const n=t.toSignAddress||this.paymentAddress||this.address,r=await this.walletInstance.signMessage({address:n,message:e,protocol:t.protocol});return r?.signature||r}async signPsbt(e,t={}){this.requireConnected(),Se();try{let n,r=e;if(e instanceof Uint8Array)Se(),r=Array.from(e,e=>e.toString(16).padStart(2,"0")).join(""),Se();else if("string"==typeof e&&e.startsWith("cHNidP")){if(Se(),"undefined"!=typeof Buffer)r=Buffer.from(e,"base64").toString("hex");else{const t=atob(e);r=Array.from(t,e=>e.charCodeAt(0).toString(16).padStart(2,"0")).join("")}Se()}else if("string"==typeof e){const t=e.toLowerCase().trim();if(!/^[0-9a-f]+$/.test(t))throw Ee(),new Error("Invalid PSBT format provided to OYL wallet");r=t,Se()}if(!r.toLowerCase().startsWith("70736274"))throw Ee(),new Error("Invalid PSBT: missing magic bytes");Se(),Se(r.length);try{const e={psbt:r,finalize:t.autoFinalized??t.finalize??!1,broadcast:t.broadcast??!1};Se(),n=await this.walletInstance.signPsbt(e),Se()}catch(tn){throw Ee(),new Error(`OYL wallet failed to sign PSBT: ${tn?.message}. Make sure you are connected to OYL wallet and try again.`)}let i=n?.psbt||n;if(!i)throw new Error("OYL returned invalid response - no psbt property found");if(Se(),"string"==typeof i&&i.startsWith("cHNidP")){if(Se(),"undefined"!=typeof Buffer)return Buffer.from(i,"base64").toString("hex");const e=atob(i);return Array.from(e,e=>e.charCodeAt(0).toString(16).padStart(2,"0")).join("")}return i}catch(tn){throw Ee(),tn}}async signPsbts(e,t={}){this.requireConnected(),Se();const n=(e||[]).map(e=>{if("string"!=typeof e)return e;if(e.startsWith("cHNidP")){if("undefined"!=typeof Buffer)return Buffer.from(e,"base64").toString("hex");const t=atob(e);return Array.from(t,e=>e.charCodeAt(0).toString(16).padStart(2,"0")).join("")}return e}).map(e=>({psbt:e,finalize:t.autoFinalized??t.finalize??!1,broadcast:t.broadcast??!1}));Se();const r=await this.walletInstance.signPsbts(n);return Se(),Array.isArray(r)?r.map(e=>{const t=e?.psbt||e;if("string"==typeof t&&t.startsWith("cHNidP")){if("undefined"!=typeof Buffer)return Buffer.from(t,"base64").toString("hex");const e=atob(t);return Array.from(e,e=>e.charCodeAt(0).toString(16).padStart(2,"0")).join("")}return t}):r}async pushPsbt(e){this.requireConnected();const t=await this.walletInstance.pushPsbt({psbt:e}),n=t?.txid||t;return Se(),n}async sendBitcoin(e,t){if(this.requireConnected(),q.validateSendParams(e,t),"function"!=typeof this.walletInstance.sendBitcoin)throw Ee(),new Error("Oyl wallet does not support sendBitcoin() method.\nUse sendToRelayProvider() or external transaction building.");try{const n=await this.walletInstance.sendBitcoin(e,t);return Se(),n}catch(tn){throw Ee(),tn}}async getInscriptions(e=0,t=100){this.requireConnected();try{if("function"!=typeof this.walletInstance.getInscriptions)return Ee(),{list:[],total:0};const n=await this.walletInstance.getInscriptions(e,t),r=Array.isArray(n)?n:n.list||[];return{list:r.map(e=>S.inscription(e,"Oyl")),total:r.length}}catch(tn){return Ee(),{list:[],total:0}}}async sendToRelayProvider(e){if(this.requireInstalled(),"function"!=typeof this.walletInstance.sendToRelayProvider)throw new Error("Oyl wallet does not support sendToRelayProvider()");return await this.walletInstance.sendToRelayProvider(e)}},BitmapWallet:class extends q{constructor(){super("BitmapWallet"),this._events=new Map,this.walletInstance="undefined"!=typeof window&&window.bitmapWallet?window.bitmapWallet:null,this.isConnected=!!this.walletInstance?.isConnected,this.address=this.isConnected&&this.walletInstance.getAddress?this.walletInstance.getAddress():null}isInstalled(){return"undefined"!=typeof window&&window.bitmapWallet&&"function"==typeof window.bitmapWallet.request}setupEventListeners(){this.walletInstance&&"function"==typeof this.walletInstance.on&&(this.walletInstance.on("accountsChanged",e=>{e&&e.length>0&&(this.address=e[0],this._emit("accountsChanged",{accounts:e,address:this.address}))}),this.walletInstance.on("networkChanged",e=>{this._emit("networkChanged",{network:e})}),this.walletInstance.on("disconnect",()=>{this.isConnected=!1,this.address=null,this._emit("disconnect")}))}async request(e,t){let n,r;switch("object"==typeof e&&null!==e?(n=e.method,r=e.params):(n=e,r=t),n){case"connect":return await this.connect(r?.options);case"disconnect":return await this.disconnect();case"requestAccounts":case"getAccounts":return await this.getAccounts();case"getAddress":return await this.getAddress();case"getBalance":return await this.getBalance(r);case"getInscriptions":return await this.getInscriptions(r||{});case"signMessage":return await this.signMessage(r);case"signPsbt":return await this.signPsbt(r?.psbt||r);case"signPsbts":return await this.signPsbts(r?.psbts||r);case"pushPsbt":return await this.pushPsbt(r?.psbt||r);case"pushTx":return await this.pushTx(r?.hex||r);case"getUtxos":return await this.getUtxos(r?.address||r);case"getFeeRate":return await this.getFeeRate();case"getNetwork":return await this.getNetwork();case"switchNetwork":return await this.switchNetwork(r?.network||r);case"getSpendableUtxos":return await this.getSpendableUtxos(r?.address||r);case"getRunes":return await this.getRunes(r?.address||r);case"getRareSats":return await this.getRareSats(r?.address||r);case"sendBitcoin":return await this.sendBitcoin(r?.toAddress,r?.satoshis,r?.options);case"sendInscription":return await this.sendInscription(r?.address,r?.inscriptionId,r?.options);case"detectBitmaps":return await this.detectBitmaps();default:if(this.walletInstance&&"function"==typeof this.walletInstance.request)return await this.walletInstance.request({method:n,params:r});throw new Error(`Unsupported method: ${n}`)}}async connect(e={}){if(Ie(this.walletInstance),!this.walletInstance)throw new Error("BitmapWallet not installed or not detected at window.bitmapWallet");if(this.setupEventListeners(),"function"==typeof this.walletInstance.connect){Ie();const n=await this.walletInstance.connect(e);Ie(),this.isConnected=!0;try{this.address=await this.getAddress(),Ie()}catch(t){Ae()}return{...n,address:this.address||n.address||n.accounts?.[0],connected:!0}}if("function"==typeof this.walletInstance.requestAccounts){Ie();const e=await this.walletInstance.requestAccounts();return Ie(),this.isConnected=!0,this.address=Array.isArray(e)?e[0]:e,{address:this.address,accounts:e,connected:!0}}Ae(),this.isConnected=!0;try{this.address=await this.getAddress(),Ie()}catch(t){throw Ae(),new Error("BitmapWallet: Could not retrieve address. Wallet may not be connected.")}return this._emit("connect",{address:this.address}),{address:this.address,connected:!0}}async disconnect(){if(this.walletInstance?.disconnect){const e=await this.walletInstance.disconnect();return this.isConnected=!1,this.address=null,this._emit("disconnect"),e}return this.isConnected=!1,this.address=null,this._emit("disconnect"),{disconnected:!0}}async getAccounts(){return this.walletInstance?.getAccounts?await this.walletInstance.getAccounts():this.address?[this.address]:[]}async getAddress(){return this.walletInstance?.getAddress?await this.walletInstance.getAddress():this.address}async getPublicKey(){if(this.walletInstance?.getPublicKey)return await this.walletInstance.getPublicKey();throw new Error("getPublicKey not available")}async getBalance(){if(this.walletInstance?.getBalance)return await this.walletInstance.getBalance();throw new Error("getBalance not available")}async getUtxos(e){if(this.walletInstance?.getUtxos)return await this.walletInstance.getUtxos(e);throw new Error("getUtxos not available")}async getInscriptions({offset:e=0,limit:t=100}={}){return this.walletInstance?.getInscriptions?await this.walletInstance.getInscriptions({offset:e,limit:t}):[]}async detectBitmaps(){return this.walletInstance?.detectBitmaps?await this.walletInstance.detectBitmaps():[]}async signMessage({address:e,message:t,protocol:n="BIP322"}={}){if(this.walletInstance?.signMessage)return await this.walletInstance.signMessage({address:e,message:t,protocol:n});throw new Error("signMessage not available")}_isHexString(e){return"string"==typeof e&&/^[0-9a-fA-F]+$/.test(e)&&e.length%2==0}_looksLikePsbtBase64(e){return"string"==typeof e&&e.startsWith("cHNidP8")}_isMagicNumberError(e){const t=String(e?.message||e||"");return/magic\s*number/i.test(t)}async _getBitcoinJs(){if("undefined"!=typeof window&&window.bitcoin?.Psbt)return window.bitcoin;if("undefined"!=typeof window&&window.BitcoinLib?.Psbt)return window.BitcoinLib;if("undefined"!=typeof window){const e=await new Promise(e=>{let t=0;const n=setInterval(()=>{(window.bitcoin?.Psbt||window.BitcoinLib?.Psbt)&&(clearInterval(n),e(window.bitcoin||window.BitcoinLib)),t+=100,t>3e3&&(clearInterval(n),e(null))},100)});if(e)return e}throw new Error("bitcoinjs-lib not loaded. Ensure the page has loaded the bitcoin library from its inscription.")}async _convertPsbtString(e,t){const n=await this._getBitcoinJs();return"base64"===t?this._looksLikePsbtBase64(e)?e:this._isHexString(e)?n.Psbt.fromHex(e).toBase64():n.Psbt.fromBase64(e).toBase64():"hex"===t?this._isHexString(e)?e:this._looksLikePsbtBase64(e)?n.Psbt.fromBase64(e).toHex():n.Psbt.fromHex(e).toHex():e}async signPsbt(e,t={}){if(!e)throw new Error("psbt required");if(!this.walletInstance?.signPsbt)throw new Error("signPsbt not available");const n=e,r=this._isHexString(n),i=this._looksLikePsbtBase64(n),a=r?"hex":i?"base64":null;try{return await this.walletInstance.signPsbt(n,t)}catch(o){if(!this._isMagicNumberError(o))throw o;const e=r?"base64":i?"hex":"base64",s=await this._convertPsbtString(n,e),l=await this.walletInstance.signPsbt(s,t);return"string"==typeof l&&a&&a!==e?await this._convertPsbtString(l,a):l}}async signPsbts(e,t={}){if(!Array.isArray(e))throw new Error("psbts must be an array");if(this.walletInstance?.signPsbts)try{return await this.walletInstance.signPsbts(e,t)}catch(r){if(!this._isMagicNumberError(r))throw r}const n=[];for(let i=0;i<e.length;i++)n.push(await this.signPsbt(e[i],t));return n}async pushPsbt(e){if(this.walletInstance?.pushPsbt){let n=e;if("string"==typeof e&&!e.startsWith("02"))try{const t=await this._getBitcoinJs();let r;r=this._isHexString(e)?t.Psbt.fromHex(e):t.Psbt.fromBase64(e),n=r.extractTransaction().toHex()}catch(t){Ae()}return await this.walletInstance.pushPsbt(n)}throw new Error("pushPsbt not available")}async pushTx(e){if(this.walletInstance?.pushTx)return await this.walletInstance.pushTx(e);throw new Error("pushTx not available")}async getFeeRate(){if(this.walletInstance?.getFeeRate)return await this.walletInstance.getFeeRate();throw new Error("getFeeRate not available")}async getNetwork(){return this.walletInstance?.getNetwork?await this.walletInstance.getNetwork():"mainnet"}async switchNetwork(e){if(this.walletInstance?.switchNetwork){const t=await this.walletInstance.switchNetwork(e);return this._emit("networkChanged",{network:e}),t}throw new Error("switchNetwork not available")}async getSpendableUtxos(e){if(this.walletInstance?.getSpendableUtxos)return await this.walletInstance.getSpendableUtxos(e);if(this.walletInstance?.getUtxos)return await this.walletInstance.getUtxos(e);throw new Error("getSpendableUtxos not available")}async getRunes(e){return this.walletInstance?.getRunes?await this.walletInstance.getRunes(e):[]}async getRareSats(e){return this.walletInstance?.getRareSats?await this.walletInstance.getRareSats(e):[]}async sendBitcoin(e,t,n={}){if(q.validateSendParams(e,t),this.walletInstance?.sendBitcoin)return await this.walletInstance.sendBitcoin(e,t,n);throw new Error("sendBitcoin not available")}async sendInscription(e,t,n={}){if(this.walletInstance?.sendInscription)return await this.walletInstance.sendInscription(e,t,n);throw new Error("sendInscription not available")}on(e,t){return this._events.has(e)||this._events.set(e,new Set),this._events.get(e).add(t),()=>this._events.get(e).delete(t)}_emit(e,t){const n=this._events.get(e);if(n)for(const i of n)try{i(t)}catch(r){Ae()}}}};let Be={isConnected:!1,walletType:null,address:null,publicKey:null,paymentAddress:null,ordinalsAddress:null,paymentPublicKey:null,ordinalsPublicKey:null,balance:null,provider:null};const Pe=new Set;function _e(e){Be={...Be,...e},Pe.forEach(e=>e(Be))}function Oe(e,t=3e4,n="Wallet operation"){let r;return Promise.race([e,new Promise((e,i)=>{r=setTimeout(()=>i(new Error(`${n} timed out after ${t}ms`)),t)})]).finally(()=>clearTimeout(r))}async function Le(e,t,n={}){if(!Be.provider)throw new Error("No wallet connected");if("string"!=typeof e||!e.trim())throw new Error("Invalid recipient address: must be a non-empty string");const r=e.trim(),i=r.toLowerCase();if(!(i.startsWith("bc1q")||i.startsWith("bc1p")||i.startsWith("tb1q")||i.startsWith("tb1p")||i.startsWith("bcrt1")||/^[13mn2]/.test(r))||r.length<26||r.length>90)throw new Error("Invalid Bitcoin address format: unrecognized prefix or length");if(!Number.isInteger(t)||t<=0)throw new Error("satoshis must be a positive integer");const a=function(e){const t=e.toLowerCase();return t.startsWith("bc1q")||t.startsWith("tb1q")?e.length<=44?294:330:t.startsWith("bc1p")||t.startsWith("tb1p")?330:t.startsWith("bcrt1q")?e.length<=46?294:330:t.startsWith("bcrt1p")?330:e.startsWith("3")||e.startsWith("2")?540:546}(r);if(t<a)throw new Error(`Amount ${t} sats is below dust limit (${a} sats for this address type)`);return await Oe(Be.provider.sendBitcoin(e,t,n),6e4,`${Be.walletType||"Wallet"} sendBitcoin`)}function Fe(){if("undefined"==typeof window)return!1;try{const e=navigator.userAgentData;if(e){if("android"===(e.platform||"").toLowerCase())return!0;if("boolean"==typeof e.mobile)return e.mobile}}catch{}const e=(navigator.userAgent||"").toLowerCase();return!!/android|iphone|ipad|ipod|iemobile|opera mini|mobile/.test(e)||!!/samsungbrowser/i.test(e)||!!/\bsilk\b/.test(e)}function Me(e){const t=Ce[e];if(!t)throw new Error(`Unknown wallet: ${e}`);const n=new t;if(!(n.isInstalled()||"OKX"===e&&Fe())){const t=Te[e];throw new Error(`${e} wallet is not installed.\n\nDownload: ${t?.downloadUrl||"Visit wallet website"}`)}return n}async function Re(e){const t=Me(e);if(!t)throw new Error(`Failed to create provider for ${e}`);try{const r=await t.connect(),i=r.address||t.address||null,a=r.publicKey||t.publicKey||null,o=r.paymentAddress||t.paymentAddress||i;_e({isConnected:!0,walletType:e,address:i,publicKey:a,paymentAddress:o,ordinalsAddress:r.ordinalsAddress||t.ordinalsAddress||i,paymentPublicKey:r.paymentPublicKey||t.paymentPublicKey||a,ordinalsPublicKey:r.ordinalsPublicKey||t.ordinalsPublicKey||a,provider:t});try{const e=await t.getBalance();let n,r=0;"number"==typeof e?(r=Math.round(e),n=r/1e8):e&&"object"==typeof e?(r=Number(e.total)||Number(e.confirmed)||0,n=r/1e8):n=0,_e({balance:n})}catch(n){_e({balance:null})}return t}catch(tn){throw tn}}function $e(e){const t=(e&&e.message?String(e.message):"").toLowerCase();return t.includes("not installed")||t.includes("not detected")||t.includes("no provider")}async function Ue(e,t={}){const n="boolean"==typeof t.preferMobile?t.preferMobile:null;if(!(null===n?Fe():n))return await Re(e);try{return await Re(e)}catch(tn){if($e(tn))try{return{redirected:!0,deepLink:await it(e,t.targetUrl)}}catch{}throw tn}}async function ze(e,t={}){const n=t.extensionPollMs??800,r=t.extensionPollAttempts??6,i=t.targetUrl||("undefined"!=typeof window?window.location?.href:null),a=je();let o=!1;const s=Te[e];if(s?.detection&&(o=s.detection(),!o&&n>0)){const e=Math.max(50,Math.floor(n/r));for(let t=0;t<r;t++)if(await new Promise(n=>setTimeout(n,e*(t+1))),s.detection()){o=!0;break}}const l=rt(e,i),c=!!l;let u="extension";return u=o&&c?"choose":o?"extension":c?"app":"install",{walletName:e,extension:o,deepLink:c?l:null,deviceType:a,recommended:u,downloadUrl:s?.downloadUrl||null}}const De="nexus.mobileWalletDeepLinks.v1";function He(){if("undefined"==typeof window)return!1;const e=(navigator.userAgent||"").toLowerCase(),t=navigator.userAgent||"";try{const e=navigator.userAgentData;if(e&&"android"===(e.platform||"").toLowerCase()&&!1===e.mobile)return!0}catch{}return!(!(/samsungbrowser/i.test(e)&&("number"==typeof navigator.maxTouchPoints?navigator.maxTouchPoints:0)>1&&Math.min(window.screen?.width||0,window.screen?.height||0)>=600)&&!(/macintosh/.test(e)&&"number"==typeof navigator.maxTouchPoints&&navigator.maxTouchPoints>1)&&!/ipad/.test(e)&&(!/android/.test(e)||/mobile/.test(e))&&!/sm-[txp]\d/i.test(t)&&(!/kindle|silk/.test(e)||/mobile/.test(e))&&!/galaxy.*tab|gt-p\d|gt-n\d/i.test(t)&&!("number"==typeof navigator.maxTouchPoints&&navigator.maxTouchPoints>1&&Math.min(window.screen?.width||0,window.screen?.height||0)>=768))}function We(){if("undefined"==typeof window)return!1;if(He())return!0;try{const e=(navigator.userAgent||"").toLowerCase();let t=/android/.test(e)||/samsungbrowser/i.test(e);if(!t)try{t="android"===(navigator.userAgentData?.platform||"").toLowerCase()}catch{}if(t){const e=window.matchMedia?.("(pointer: fine)")?.matches,t=Math.min(window.screen?.width||0,window.screen?.height||0)>=600;if(e&&t)return!0}}catch{}return!1}function je(){return"undefined"==typeof window?"desktop":He()?"tablet":We()?"hybrid":Fe()?"phone":"desktop"}const Ve={Phantom:e=>{const t=e||window.location?.href,n=window.location?.origin||window.location?.href||t;return t&&n?`https://phantom.app/ul/browse/${encodeURIComponent(t)}?ref=${encodeURIComponent(n)}`:null},UniSat:e=>function(e,{fromScheme:t,from:n,appId:r,nonce:i}={}){if("undefined"==typeof window)return null;const a=e||window.location?.href,o=String(t||n||"unisat");if(!a)return Ye({from:o,nonce:i});const s=Ge({method:"openDapp",from:o,nonce:i,data:Ke(JSON.stringify([String(a)]))});return s&&r?`${s}&appId=${encodeURIComponent(String(r))}`:s}(e,{fromScheme:"unisat"}),Xverse:e=>{const t=e||window.location?.href;return t?`https://connect.xverse.app/browser?url=${encodeURIComponent(t)}`:null},OKX:null,MagicEden:null},qe=Object.freeze(["UniSat","Xverse","Phantom"]);function Xe(e){if("undefined"==typeof window)return null;const t=e||window.location?.href;return t?`magiceden://browser?url=${encodeURIComponent(String(t))}`:"magiceden://"}function Ke(e){if("string"!=typeof e)return"";if("function"==typeof btoa){const t=(new TextEncoder).encode(e);let n="";const r=32768;for(let e=0;e<t.length;e+=r)n+=String.fromCharCode(...t.subarray(e,e+r));return btoa(n)}return""}function Ge({method:e,from:t,nonce:n,data:r}){if("undefined"==typeof window)return null;const i=encodeURIComponent(t||window.document?.title||"NexusInscriber"),a=String(n||Math.random().toString(36).slice(2,10)),o=`unisat://request?method=${encodeURIComponent(String(e||"connect"))}`,s=[`from=${i}`,`nonce=${encodeURIComponent(a)}`];"string"==typeof r&&r.length>0&&s.push(`data=${encodeURIComponent(r)}`);try{window.sessionStorage?.setItem("nexus.unisat.mobileNonce",a)}catch{}return`${o}&${s.join("&")}`}function Ye({from:e,nonce:t}={}){return Ge({method:"connect",from:e,nonce:t})}const Je=new Set(["Xverse","Phantom","UniSat"]),Qe=new Set([]);function Ze(e){return Je.has(e)}function et(e){return Qe.has(e)}function tt(){if("undefined"==typeof window)return{};const e=window.NEXUS_MOBILE_WALLET_DEEPLINKS;if(e&&"object"==typeof e)return e;try{const e=window.localStorage?.getItem(De);if(!e)return{};const t=JSON.parse(e);return t&&"object"==typeof t?t:{}}catch{return{}}}function nt(e){if(!e||"string"!=typeof e)return!1;try{const t=new URL(e);return"http:"===t.protocol||"https:"===t.protocol}catch{return!1}}function rt(e,t){if("undefined"==typeof window)return null;const n=t||window.location?.href;if(!n)return null;if(!nt(n))return null;const r=function(e){const t=function(e){const t=tt(),n=t?.[e];return!n||"function"!=typeof n&&"string"!=typeof n?null:n}(e);return t||Ve?.[e]||null}(e);if(!r)return null;const i=encodeURIComponent(n);if("function"==typeof r)try{return r(n)}catch{return null}return r.replace(/\{url\}/g,i)}async function it(e,t){if("undefined"==typeof window)throw new Error("openMobileWallet requires a browser environment");if("MagicEden"===e){const e=t||window.location?.href;if(e&&!nt(e))throw new Error("openMobileWallet: target URL must be HTTP or HTTPS");await async function(e){const t="string"==typeof e?e:String(e||"");if(!t)return!1;try{if("undefined"!=typeof navigator&&navigator.clipboard&&"function"==typeof navigator.clipboard.writeText)return await navigator.clipboard.writeText(t),!0}catch{}try{if("undefined"==typeof document)return!1;const e=document.createElement("textarea");e.value=t,e.setAttribute("readonly",""),e.style.position="fixed",e.style.top="-9999px",e.style.left="-9999px",document.body.appendChild(e),e.select(),e.setSelectionRange(0,e.value.length);const n=document.execCommand("copy");return document.body.removeChild(e),!!n}catch{return!1}}(e);const n=Xe(e);if(!n)throw new Error("Could not build a Magic Eden deep link.\n\nOpen Magic Eden and use the Browser tab to open this site.");return window.location.href=n,n}const n=rt(e,t);if(!n)throw new Error(`No mobile deep link configured for ${e}.\n\nConfigure window.NEXUS_MOBILE_WALLET_DEEPLINKS['${e}'] = '<template>' where <template> includes {url} placeholder.\nExample: { '${e}': 'your-scheme://browse?url={url}' }`);try{Ze(e)&&window.sessionStorage?.setItem("nexus.pendingMobileWallet",e)}catch{}return window.location.href=n,n}const at={createProvider:Me,detectWallets:function(){const e=[];for(const[t,n]of Object.entries(Te))n.detection&&n.detection()&&e.push({name:t,...n});return e},connect:Re,connectSmart:Ue,connectWithStrategy:async function(e,t={}){const n=t.strategy||"auto",r=je();if("probe"===n)return await ze(e,t);if("extension"===n)return await Re(e);if("app"===n){const n=t.targetUrl||("undefined"!=typeof window?window.location?.href:null);return{redirected:!0,deepLink:await it(e,n),walletName:e}}if("desktop"===r)return await Re(e);if("tablet"===r||"hybrid"===r){const n=await ze(e,t);if(n.extension)try{return await Re(e)}catch(i){if(n.deepLink&&$e(i))return{redirected:!0,deepLink:await it(e,t.targetUrl),walletName:e,fallbackReason:"extension-connect-failed"};throw i}if(n.deepLink)return{redirected:!0,deepLink:await it(e,t.targetUrl),walletName:e};const r=Te[e];throw new Error(`${e} wallet not found on this device.\n\nOn tablets, you can either:\n  1. Install the ${e} browser extension, or\n  2. Install the ${e} mobile app\n\n`+(r?.downloadUrl?`Download: ${r.downloadUrl}`:""))}return await Ue(e,t)},disconnect:async function(){if(Be.provider)try{await Be.provider.disconnect()}catch(tn){}_e({isConnected:!1,walletType:null,address:null,publicKey:null,paymentAddress:null,ordinalsAddress:null,paymentPublicKey:null,ordinalsPublicKey:null,balance:null,provider:null})},getState:function(){return{...Be}},subscribe:function(e){return Pe.add(e),()=>Pe.delete(e)},getCurrentProvider:function(){return Be.provider},getWalletInfo:function(e){return Te[e]||null},getAllWalletInfo:function(){return{...Te}},setMobileWalletDeepLinks:function(e){return function(e){if("undefined"==typeof window)return;const t=e&&"object"==typeof e?e:{};window.NEXUS_MOBILE_WALLET_DEEPLINKS=t;try{window.localStorage?.setItem(De,JSON.stringify(t))}catch{}}(e),tt()},getMobileConnectUrl:rt,openMobileWallet:it,isMobileDevice:function(){return Fe()},isTabletDevice:function(){return He()},isHybridDevice:function(){return We()},getDeviceType:je,tryMobileAutoReconnect:async function(){if("undefined"==typeof window)return null;const e=window.sessionStorage?.getItem("nexus.pendingMobileWallet");if(!e)return null;try{window.sessionStorage?.removeItem("nexus.pendingMobileWallet")}catch{}try{const t=Te[e];if(!t||!t.detection)return null;let n=!1;for(let e=0;e<10;e+=1){if(t.detection()){n=!0;break}await new Promise(t=>setTimeout(t,75*(e+1)))}return n?await Re(e):null}catch(t){return null}},probeConnectionMethods:ze,probeAllWallets:async function(e={}){const t=e.wallets||Object.keys(Te);return await Promise.all(t.map(t=>ze(t,e).catch(e=>({walletName:t,extension:!1,deepLink:null,deviceType:je(),recommended:"error",error:e?.message||String(e)}))))},DEFAULT_MOBILE_WALLET_NAMES:qe,listMobileWalletOptions:function(e={}){if("undefined"==typeof window)return[];const t=e.targetUrl||window.location?.href,n=Array.isArray(e.wallets)?e.wallets:qe,r=[];e.includeManual&&r.push({name:"MagicEden",title:"Magic Eden",mode:"manual",appUrl:Xe(t),downloadUrl:Te?.MagicEden?.downloadUrl||"https://wallet.magiceden.io",notes:'Tapping "Open app" will copy this site\'s URL to your clipboard, then open Magic Eden. In Magic Eden, open the Browser tab and paste the URL.'});for(const i of n){const e=Te[i]||{name:i},n=rt(i,t);if(!n)continue;const a=Ze(i),o=et(i),s=a?"inAppBrowser":o?"signingOnly":"unknown",l={name:i,title:e.name||i,mode:s,hasInAppBrowser:a,openUrl:n,downloadUrl:e.downloadUrl||null};o&&(l.notes=`${i} does not have an in-app browser. Use Xverse or Phantom to open this site directly, or install the ${i} browser extension on your tablet.`),r.push(l)}return r},isMobileWalletOption:function(e){return!!rt(e)},getUniSatMobileConnectUrl:Ye,getUniSatMobileRequestUrl:function(e,t=[],{from:n,nonce:r}={}){const i=Array.isArray(t)?t:[t];return Ge({method:e,from:n,nonce:r,data:Ke(JSON.stringify(i))})},loadNormalizers:async function(){return{normalizeInscription:h,normalizeBalance:b,normalizers:S||S,normalizePsbtOptions:y,normalizeNetwork:x,normalizeAddress:w}},loadWalletConnector:async function(){return z},getBalance:async function(){if(!Be.provider)throw new Error("No wallet connected");const e=await Be.provider.getBalance();let t;return t="number"==typeof e?Math.round(e)/1e8:e&&"object"==typeof e?(Number(e.total)||Number(e.confirmed)||0)/1e8:0,_e({balance:t}),t},getInscriptions:async function(...e){if(!Be.provider)throw new Error("No wallet connected");const t=await Be.provider.getInscriptions(...e);return t&&"object"==typeof t&&Array.isArray(t.list)?t.list:Array.isArray(t)?t:[]},getAllInscriptions:async function(){if(!Be.provider)throw new Error("No wallet connected");return await Be.provider.getAllInscriptions()},signMessage:async function(...e){if(!Be.provider)throw new Error("No wallet connected");return await Be.provider.signMessage(...e)},signPsbt:async function(...e){if(!Be.provider)throw new Error("No wallet connected");return await Oe(Be.provider.signPsbt(...e),6e4,`${Be.walletType||"Wallet"} signPsbt`)},signPsbts:async function(...e){if(!Be.provider)throw new Error("No wallet connected");const t=e?.[0],n=e?.[1];return Array.isArray(t)?await V(Be.provider,t,n):await Be.provider.signPsbts(...e)},sendBitcoin:Le,sendBTC:async function(...e){return await Le(...e)},getNetwork:async function(){if(!Be.provider)throw new Error("No wallet connected");return await Be.provider.getNetwork()},switchNetwork:async function(...e){if(!Be.provider)throw new Error("No wallet connected");return await Be.provider.switchNetwork(...e)},getPublicKey:async function(){if(!Be.provider)throw new Error("No wallet connected");return await Be.provider.getPublicKey()},getAddress:async function(){if(!Be.provider)throw new Error("No wallet connected");return await Be.provider.getAddress()},getAccounts:async function(){if(!Be.provider)throw new Error("No wallet connected");return await Be.provider.getAccounts()},pushPsbt:async function(...e){if(!Be.provider)throw new Error("No wallet connected");return await Be.provider.pushPsbt(...e)},pushTx:async function(...e){if(!Be.provider)throw new Error("No wallet connected");return await Be.provider.pushTx(...e)},sendInscription:async function(...e){if(!Be.provider)throw new Error("No wallet connected");return await Be.provider.sendInscription(...e)},inscribe:async function(...e){if(!Be.provider)throw new Error("No wallet connected");return await Be.provider.inscribe(...e)},sendRunes:async function(...e){if(!Be.provider)throw new Error("No wallet connected");return await Be.provider.sendRunes(...e)},getWalletFeatures:function(){if(!Be.provider)throw new Error("No wallet connected");return Be.provider.getInfo()},getAddresses:async function(...e){if(!Be.provider)throw new Error("No wallet connected");if("function"!=typeof Be.provider.getAddresses)throw new Error(`${Be.walletType} does not support getAddresses()`);return await Be.provider.getAddresses(...e)},createRepeatInscriptions:async function(...e){if(!Be.provider)throw new Error("No wallet connected");if("function"!=typeof Be.provider.createRepeatInscriptions)throw new Error(`${Be.walletType} does not support batch inscriptions`);return await Be.provider.createRepeatInscriptions(...e)},sendInscriptions:async function(...e){if(!Be.provider)throw new Error("No wallet connected");if("function"!=typeof Be.provider.sendInscriptions)throw new Error(`${Be.walletType} does not support sendInscriptions()`);return await Be.provider.sendInscriptions(...e)},getRunesBalance:async function(){if(!Be.provider)throw new Error("No wallet connected");if("function"!=typeof Be.provider.getRunesBalance)throw new Error(`${Be.walletType} does not support Runes`);return await Be.provider.getRunesBalance()},transferRunes:async function(...e){if(!Be.provider)throw new Error("No wallet connected");if("function"!=typeof Be.provider.transferRunes)throw new Error(`${Be.walletType} does not support Runes transfer`);return await Be.provider.transferRunes(...e)},mintRunes:async function(...e){if(!Be.provider)throw new Error("No wallet connected");if("function"!=typeof Be.provider.mintRunes)throw new Error(`${Be.walletType} does not support Runes minting`);return await Be.provider.mintRunes(...e)},etchRunes:async function(...e){if(!Be.provider)throw new Error("No wallet connected");if("function"!=typeof Be.provider.etchRunes)throw new Error(`${Be.walletType} does not support Runes etching`);return await Be.provider.etchRunes(...e)},getRunesOrder:async function(...e){if(!Be.provider)throw new Error("No wallet connected");if("function"!=typeof Be.provider.getRunesOrder)throw new Error(`${Be.walletType} does not support getRunesOrder()`);return await Be.provider.getRunesOrder(...e)},signMultipleTransactions:async function(...e){if(!Be.provider)throw new Error("No wallet connected");if("function"!=typeof Be.provider.signMultipleTransactions)throw new Error(`${Be.walletType} does not support signMultipleTransactions()`);return await Be.provider.signMultipleTransactions(...e)},createInscription:async function(...e){if(!Be.provider)throw new Error("No wallet connected");if("function"!=typeof Be.provider.createInscription)throw new Error(`${Be.walletType} does not support createInscription()`);return await Be.provider.createInscription(...e)},getProductInfo:async function(){if(!Be.provider)throw new Error("No wallet connected");if("function"!=typeof Be.provider.getProductInfo)throw new Error(`${Be.walletType} does not support getProductInfo() (Leather only)`);return await Be.provider.getProductInfo()},getURL:async function(){if(!Be.provider)throw new Error("No wallet connected");if("function"!=typeof Be.provider.getURL)throw new Error(`${Be.walletType} does not support getURL() (Leather only)`);return await Be.provider.getURL()},signStructuredData:async function(...e){if(!Be.provider)throw new Error("No wallet connected");if("function"!=typeof Be.provider.signStructuredData)throw new Error(`${Be.walletType} does not support signStructuredData() (Leather only)`);return await Be.provider.signStructuredData(...e)},authenticate:async function(...e){if(!Be.provider)throw new Error("No wallet connected");if("function"!=typeof Be.provider.authenticate)throw new Error(`${Be.walletType} does not support authenticate() (Leather only)`);return await Be.provider.authenticate(...e)},sendStacksTransaction:async function(...e){if(!Be.provider)throw new Error("No wallet connected");if("function"!=typeof Be.provider.sendStacksTransaction)throw new Error(`${Be.walletType} does not support Stacks transactions (Leather only)`);return await Be.provider.sendStacksTransaction(...e)},updateProfile:async function(...e){if(!Be.provider)throw new Error("No wallet connected");if("function"!=typeof Be.provider.updateProfile)throw new Error(`${Be.walletType} does not support updateProfile() (Leather only)`);return await Be.provider.updateProfile(...e)},isHardware:async function(){if(!Be.provider)throw new Error("No wallet connected");if("function"!=typeof Be.provider.isHardware)throw new Error(`${Be.walletType} does not support isHardware() (MagicEden only)`);return await Be.provider.isHardware()},call:async function(...e){if(!Be.provider)throw new Error("No wallet connected");if("function"!=typeof Be.provider.call)throw new Error(`${Be.walletType} does not support call() (MagicEden only)`);return await Be.provider.call(...e)},inscribeTransfer:async function(...e){if(!Be.provider)throw new Error("No wallet connected");if("function"!=typeof Be.provider.inscribeTransfer)throw new Error(`${Be.walletType} does not support inscribeTransfer()`);return await Be.provider.inscribeTransfer(...e)},splitUtxo:async function(...e){if(!Be.provider)throw new Error("No wallet connected");if("function"!=typeof Be.provider.splitUtxo)throw new Error(`${Be.walletType} does not support splitUtxo() (OKX only)`);return await Be.provider.splitUtxo(...e)},transferNft:async function(...e){if(!Be.provider)throw new Error("No wallet connected");if("function"!=typeof Be.provider.transferNft)throw new Error(`${Be.walletType} does not support transferNft() (OKX only)`);return await Be.provider.transferNft(...e)},watchAsset:async function(...e){if(!Be.provider)throw new Error("No wallet connected");if("function"!=typeof Be.provider.watchAsset)throw new Error(`${Be.walletType} does not support watchAsset() (OKX only)`);return await Be.provider.watchAsset(...e)},mint:async function(...e){if(!Be.provider)throw new Error("No wallet connected");if("function"!=typeof Be.provider.mint)throw new Error(`${Be.walletType} does not support mint() (OKX only)`);return await Be.provider.mint(...e)},getCapabilities:async function(){if(!Be.provider)throw new Error("No wallet connected");if("function"!=typeof Be.provider.getCapabilities)throw new Error(`${Be.walletType} does not support getCapabilities()`);return await Be.provider.getCapabilities()},getUtxos:async function(){if(!Be.provider)throw new Error("No wallet connected");if("function"!=typeof Be.provider.getUtxos&&"function"!=typeof Be.provider.getBitcoinUtxos&&"function"!=typeof Be.provider.splitUtxo)throw new Error(`${Be.walletType} does not support UTXO fetching. Only UniSat and Wizz provide confirmed UTXO access. OKX has splitUtxo() method with different API.`);let e;return"function"==typeof Be.provider.getUtxos?e=await Be.provider.getUtxos():"function"==typeof Be.provider.getBitcoinUtxos?e=await Be.provider.getBitcoinUtxos():"function"==typeof Be.provider.splitUtxo&&(e=(await Be.provider.splitUtxo({from:Be.address,amount:2})).utxos||[]),e},getBRC20List:async function(){if(!Be.provider)throw new Error("No wallet connected");if("function"!=typeof Be.provider.getBRC20List&&"function"!=typeof Be.provider.getBRC20Summary)throw new Error(`${Be.walletType} does not support BRC-20 listing. Only UniSat provides BRC-20 token listing.`);return"function"==typeof Be.provider.getBRC20List?await Be.provider.getBRC20List():await Be.provider.getBRC20Summary()},WALLET_INFO:Te};function ot(e){const t=[];for(let n=0;n<e.length;n+=2)t.push(parseInt(e.substr(n,2),16));return t}function st(e){try{if("undefined"!=typeof TextEncoder)return Array.from((new TextEncoder).encode(e))}catch{}const t=[];for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);if(r<128)t.push(r);else if(r<2048)t.push(192|r>>6),t.push(128|63&r);else if(r>=55296&&r<=56319){n++;const i=65536+((1023&r)<<10|1023&e.charCodeAt(n));t.push(240|i>>18),t.push(128|i>>12&63),t.push(128|i>>6&63),t.push(128|63&i)}else t.push(224|r>>12),t.push(128|r>>6&63),t.push(128|63&r)}return t}function lt(e,t){const n=e<<5;if(t<=23)return[n|t];if(t<=255)return[24|n,t];if(t<=65535)return[25|n,t>>8&255,255&t];if(t<=4294967295)return[26|n,t>>>24&255,t>>>16&255,t>>>8&255,255&t];throw new Error("Length too large for CBOR definite length")}function ct(e){const t=new ArrayBuffer(8);return new DataView(t).setFloat64(0,e,!1),Array.from(new Uint8Array(t))}function ut(e){if(null==e)return[246];if(!0===e)return[245];if(!1===e)return[244];if(e instanceof Uint8Array)return[...lt(2,e.length),...Array.from(e)];if(Array.isArray(e)&&!0===e._cborBstr&&Array.isArray(e.bytes)){const t=e.bytes;return[...lt(2,t.length),...t]}if(Number.isInteger(e))return e>=0?lt(0,e):lt(1,-1-e);if("number"==typeof e)return[251,...ct(e)];if("string"==typeof e){const t=st(e);return[...lt(3,t.length),...t]}if(Array.isArray(e)){const t=e.map(ut);return[...lt(4,e.length),...t.flat()]}if("object"==typeof e){if(e instanceof Map){const t=Array.from(e.entries());t.sort(([e],[t])=>{const n="number"==typeof e&&Number.isFinite(e),r="number"==typeof t&&Number.isFinite(t);return n&&r?e-t:n&&!r?-1:!n&&r?1:String(e).localeCompare(String(t))});const n=lt(5,t.length),r=[];for(const[e,i]of t)r.push(...ut(e)),r.push(...ut(i));return[...n,...r]}const t=Object.entries(e).map(([e,t])=>[/^\d+$/.test(e)?Number(e):e,t]);t.sort(([e],[t])=>{const n="number"==typeof e&&Number.isFinite(e),r="number"==typeof t&&Number.isFinite(t);return n&&r?e-t:n&&!r?-1:!n&&r?1:String(e).localeCompare(String(t))});const n=lt(5,t.length),r=[];for(const[e,i]of t)r.push(...ut(e)),r.push(...ut(i));return[...n,...r]}throw new Error("Unsupported CBOR type")}function dt(e,t=520){const n=[];for(let r=0;r<e.length;r+=t)n.push(e.slice(r,r+t));return n}function pt(e){const t=(e=>{if(null==e)return"";let t=String(e).trim();t=t.replace(/[\u200B-\u200D\uFEFF]/g,""),t=t.replace(/^["'\s]+|["'\s]+$/g,""),t=t.replace(/\s+/g,""),t=t.replace(/\)\s*\(/g,""),t=t.split("#")[0],t=t.split("?")[0];const n=t.split("/").filter(Boolean);return n.length>0&&(t.startsWith("http://")||t.startsWith("https://")||t.includes("/inscription/"))&&(t=n[n.length-1]),t.includes(":")&&(t=t.split(":")[0]),t=t.replace(/\(i\)/gi,"i"),t})(e),n=t.match(/^([0-9a-fA-F]{64})i(\d+)$/);if(!n)throw new Error(`Invalid inscription ID format. Expected <txid>i<index>. Got: ${t||"(empty)"}`);const r=n[1],i=n[2],a=function(e){const t=(e||"").toLowerCase();if(!/^[0-9a-f]+$/.test(t)||64!==t.length)throw new Error("Invalid TXID");return t.match(/.{2}/g).reverse().join("")}(r),o=function(e){if(0===e)return[];const t=new Uint8Array(4);t[0]=255&e,t[1]=e>>8&255,t[2]=e>>16&255,t[3]=e>>24&255;let n=4;for(;n>1&&0===t[n-1];)n--;return Array.from(t.slice(0,n))}(parseInt(i));return a+Array.from(o).map(e=>e.toString(16).padStart(2,"0")).join("")}const ft=pt,mt={OP_0:0,OP_FALSE:0,OP_IF:99,OP_ENDIF:104,OP_1:81,OP_3:83,OP_5:85,OP_7:87,OP_11:91,OP_PUSHDATA1:76,OP_PUSHDATA2:77};function gt(e){const t="string"==typeof e?ot(e):e instanceof Uint8Array?Array.from(e):Array.isArray(e)?e:[],n=t.length;if(n<=75)return[n,...t];if(n<=255)return[mt.OP_PUSHDATA1,n,...t];if(n<=65535)return[mt.OP_PUSHDATA2,255&n,n>>8&255,...t];throw new Error("Data too large")}function ht(e){if(!Number.isInteger(e)||e<0||e>255)throw new Error(`Invalid tag ${e}, must be 0..255`);return 0===e?[mt.OP_0]:e>=1&&e<=16?[80+e]:gt([e])}function bt(e){const{content:t,contentType:n,parentId:r,parentIds:i,delegateId:a,metaprotocol:o,pointer:s,metadata:l,properties:c,contentEncoding:u,customTags:d={}}=e,p=[];p.push(mt.OP_FALSE),p.push(mt.OP_IF);const f=Array.from("ord").map(e=>e.charCodeAt(0).toString(16).padStart(2,"0")).join("");if(p.push(...gt(f)),p.push(...ht(1)),p.push(...gt(st(n))),null!=s){p.push(...ht(2));const e=function(e){if(null==e)return[];const t=parseInt(e);if(t<0||t>4294967295)throw new Error("Pointer must be between 0 and 4294967295");const n=[];let r=t;do{n.push(255&r),r>>>=8}while(r>0);return n}(s);p.push(...gt(e))}let m=[];if(i&&Array.isArray(i)?m=i:r&&(m=Array.isArray(r)?r:[r]),m.forEach(e=>{if(e&&e.trim()){p.push(...ht(3));const t=ft(e.trim());p.push(...gt(t))}}),l&&"object"==typeof l){const e=function(e){if(!e||"object"!=typeof e)return[];try{return ut(e)}catch(t){return[]}}(l);dt(e,520).forEach(e=>{p.push(...ht(5)),p.push(...gt(e))})}if(o&&(p.push(...ht(7)),p.push(...gt(st(o)))),u&&(p.push(...ht(9)),p.push(...gt(st(u)))),a){p.push(...ht(11));const e=pt(a);p.push(...gt(e))}if(c&&"object"==typeof c){const e=function(e){if(!e||"object"!=typeof e)return[];try{const t=e=>{if(!e||"string"!=typeof e)throw new Error("Gallery inscription ID must be a string like <txid>i<index>");const t=ot(pt(e.trim()));if(t.length<32||t.length>36)throw new Error(`Serialized inscription ID must be 32..36 bytes, got ${t.length}`);return new Uint8Array(t)},n=e=>{if(e instanceof Uint8Array)return e;if(Array.isArray(e))return e.map(e=>"string"==typeof e?{0:t(e)}:"object"==typeof e&&null!==e?n(e):e);if("object"==typeof e&&null!==e){const r=e[0]??e[0];if("string"==typeof r&&r.length>=64&&/^[a-f0-9]{64}i\d+$/i.test(r)){const i={...e};return i[0]=t(String(r)),delete i[0],n(i)}const i={};for(const[t,a]of Object.entries(e))i[/^\d+$/.test(t)?parseInt(t,10):t]="object"==typeof a&&null!==a?n(a):a;return i}return e},r=(e=>{try{if(e&&"object"==typeof e&&Array.isArray(e.gallery)){const n=e.gallery.filter(Boolean).map(e=>({0:t(String(e))})),r={...e};delete r.gallery;const i=r[0]??r[0];return Array.isArray(i)?(r[0]=[...i,...n],delete r[0]):r[0]=n,r}}catch(n){}return e})(e);return ut(n(r))}catch(t){const e=t&&t.message?t.message:String(t);throw new Error(`Failed to serialize properties to CBOR: ${e}`)}}(c);dt(e,520).forEach((e,t)=>{p.push(...ht(17)),p.push(...gt(e))})}if(p.push(...ht(0)),!a){let e;const r=(h=t)?(e=>!!e&&(e instanceof ArrayBuffer||"[object ArrayBuffer]"===Object.prototype.toString.call(e)))(h)?new Uint8Array(h):"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(h)?new Uint8Array(h.buffer,h.byteOffset||0,h.byteLength||0):null:null;if(r)e=Array.from(r);else if("string"==typeof t){if(u&&(e=>{if("string"!=typeof e)return!1;const t=e.trim();return/^\[object (ArrayBuffer|Uint8Array|Uint8ClampedArray|Int8Array|Int16Array|Int32Array|Uint16Array|Uint32Array|Float32Array|Float64Array|BigInt64Array|BigUint64Array|DataView)\]$/.test(t)})(t))throw new Error("Invalid content: encoded payload is a stringified binary object. Re-upload the file (do not use the Text tab for .br/.gz).");if((g=n)&&(g.startsWith("text/")||g.includes("json")||g.includes("javascript")||g.includes("css")))e=st(t);else try{const n="undefined"!=typeof atob?atob(t):Buffer.from(t,"base64").toString("binary");e=Array.from(n).map(e=>e.charCodeAt(0))}catch(b){e=st(t)}}else e=st(String(t??""));const i=520;for(let t=0;t<e.length;t+=i){const n=e.slice(t,t+i);p.push(...gt(n))}}var g,h;return p.push(mt.OP_ENDIF),p.map(e=>e.toString(16).padStart(2,"0")).join("")}function yt(e){return bt(e).length/2}function xt(e,t=null){return bt({content:e,contentType:"text/plain;charset=utf-8",parentId:t})}function wt(e,t=null){return bt({content:JSON.stringify(e,null,2),contentType:"application/json",parentId:t})}function vt(e,t=null){return bt({content:e,contentType:"text/html;charset=utf-8",parentId:t})}function St(e,t){e.length,t.parentId,t.delegateId,t.metaprotocol}"undefined"!=typeof window&&(window.NexusInscriptionUtils={createInscriptionScript:bt,createTextInscription:xt,createJsonInscription:wt,createHtmlInscription:vt,calculateInscriptionSize:yt,printInscriptionInfo:St,serializeParentId:ft,OP_CODES:mt});const Et=Object.freeze(Object.defineProperty({__proto__:null,OP_CODES:mt,calculateInscriptionSize:yt,createHtmlInscription:vt,createInscriptionScript:bt,createJsonInscription:wt,createTextInscription:xt,printInscriptionInfo:St,serializeParentId:ft},Symbol.toStringTag,{value:"Module"})),Nt=(()=>{if("undefined"!=typeof window){const e=window.__NEXUS_ORDINALS_ORIGIN__;if("string"==typeof e)return e}return""})(),It=(()=>{if("undefined"!=typeof window){const e=window.__NEXUS_MEMPOOL_ORIGIN__;if("string"==typeof e&&e.trim())return e.trim()}return"https://mempool.space"})();(()=>{if("undefined"==typeof window)return!1;const e=window.location.hostname;"ordinals.com"===e||e.endsWith(".ordinals.com"),"localhost"===e&&window.location.search.includes("inscription=true")})();const At=(e,t=Nt)=>("undefined"==typeof window||t&&""!==t||"string"!=typeof window.__NEXUS_ORDINALS_ORIGIN__||!window.__NEXUS_ORDINALS_ORIGIN__||(t=window.__NEXUS_ORDINALS_ORIGIN__),"string"==typeof e&&/^(https?:)?\/\//i.test(e)?e:`${t}${e.startsWith("/")?e:`/${e}`}`),kt=e=>At(e,Nt),Tt=e=>At(e,It),Ct="/r/sat/404079598249183/at/-1/content",Bt="btcapi";let Pt=null;async function _t(){if(Pt)return Pt;const e=function(){try{if(import.meta?.env?.DEV)return!0}catch{}try{const e=window.location.hostname;return"localhost"===e||"127.0.0.1"===e||e.endsWith(".local")}catch{}return!1}()?[Ct,Bt]:[Bt,Ct];let t=null;for(const r of e)try{const e=await import(r);Pt=e.default||e;break}catch(n){t=n}if(!Pt)throw t||new Error("Failed to import btcapi");return Pt._fallbackMode=!Pt.isBitmapWalletInstalled(),Pt}function Ot(){return!(!Pt||!1!==Pt._fallbackMode)}function Lt(){return!0===Pt?._fallbackMode}async function Ft(e,t="mainnet"){if(Pt||await _t(),Lt())return[];const n=[];for(const r of e){const e=await Pt.getAddressUtxos(r,t);n.push(...e.map(e=>({...e,address:r})))}return n}function Mt(e,t){const n=/\/inscription\/([a-f0-9]{64}i\d+)/g,r=[];let i;for(;null!==(i=n.exec(e));)r.push({id:i[1],address:t});return r}async function Rt(e="mainnet"){return Pt||await _t(),Lt()?{fastestFee:25,halfHourFee:15,hourFee:10,economyFee:5,minimumFee:1}:Pt.getFeeRates(e)}async function $t(e,t="mainnet"){if(Pt||await _t(),Lt())throw new Error("Bitmap Wallet required for broadcasting");return Pt.broadcastTransaction(e,t)}function Ut(){if("undefined"==typeof window)return!1;try{const e="__nexus_storage_test__";return window.sessionStorage.setItem(e,"1"),window.sessionStorage.removeItem(e),!0}catch{return!1}}function zt(){return!function(){if("undefined"==typeof window)return!1;try{if(window.top&&window.top!==window)return!0}catch{return!0}if(!Ut())return!0;try{if(window.location&&"null"===window.location.origin)return!0}catch{return!0}try{const e=window.location?.protocol;if(e&&"https:"!==e&&"http:"!==e)return!0}catch{return!0}try{const e=window.frameElement;if(e&&e.getAttribute&&null!=e.getAttribute("sandbox"))return!0}catch{return!0}return!1}()}function Dt(){return"undefined"!=typeof window&&void 0!==window.NexusBitcoinProxy&&"function"==typeof window.NexusBitcoinProxy.isEnabled&&window.NexusBitcoinProxy.isEnabled()}async function Ht(e,t={}){const n=String(e||""),r=String(t?.method||"GET").toUpperCase(),i="GET"===r||"HEAD"===r,a=(e=>{const t=String(e||"");if(!t)return t;if(/^(https?:)?\/\//i.test(t))return t;if(!t.startsWith("/"))return t;try{const e=window?.location?.hostname||"",n="ordinals.com"===e||e.endsWith(".ordinals.com"),r="undefined"!=typeof window&&"string"==typeof window.__NEXUS_ORDINALS_ORIGIN__?window.__NEXUS_ORDINALS_ORIGIN__:null;return n?window.location.origin+t:r&&r.length>0?r+t:t}catch{return t}})(n),o=e=>{const t=String(e||"").trim();if(!t)return null;if(t.startsWith("/"))return t;try{const e=new URL(t);if("ordinals.com"===e.hostname||e.hostname.endsWith(".ordinals.com"))return e.pathname+(e.search||"")}catch{}return null};try{const e=await _t();if(!Lt())return await e.proxyFetch(a,t)}catch(tn){}try{if(!zt()&&i&&Dt()){const e=o(n)||o(a);if(e){const t=await window.NexusBitcoinProxy.fetchOrdinals(e),n=Number(t?.status),r=String(t?.contentType||"text/plain"),i="string"==typeof t?.text?t.text:"";return new Response(i,{status:Number.isFinite(n)?n:200,headers:{"Content-Type":r}})}}}catch(s){}try{return await fetch(a,t)}catch(l){try{if(i&&Dt()){const e=o(n)||o(a);if(e){const t=await window.NexusBitcoinProxy.fetchOrdinals(e),n=Number(t?.status),r=String(t?.contentType||"text/plain"),i="string"==typeof t?.text?t.text:"";return new Response(i,{status:Number.isFinite(n)?n:200,headers:{"Content-Type":r}})}}}catch(c){}return await fetch(n,t)}}const Wt=new Map,jt=new Map;function Vt(e){const t=Number(e);if(Number.isFinite(t)&&!(t<=0))return Math.floor(t)}function qt(e){const t=e?.output||e?.satpoint||e?.location;if(!t||"string"!=typeof t)return;const n=t.split(":");if(n.length<2)return;const r=n[0],i=n[1];if(!/^[0-9a-f]{64}$/i.test(r))return;const a=Number(i);return!Number.isFinite(a)||a<0?void 0:`${r}:${Math.floor(a)}`}function Xt(e){if(!e)return e;const t=e.split(":")[0];return t.match(/^[0-9a-f]{64}i\d+$/),t}async function Kt(e){const t=Xt(e),n=kt(`/r/inscription/${t}`),r=await Ht(n);if(!r.ok)throw new Error(`Failed to fetch inscription: ${r.statusText}`);return await r.json()}async function Gt(e){const t=qt(await Kt(e));if(!t){const t=Xt(e);throw new Error(`Cannot resolve outpoint for inscription ${t} from ordinals details`)}return t}async function Yt(e,t={}){const n=Xt(e);if(!n)throw new Error("Missing inscriptionId");if(Wt.has(n))return Wt.get(n);const r=function(e,t){const n=Xt(t);if(!Array.isArray(e)||0===e.length)return;let r=e.find(e=>Xt(e?.id||e?.inscriptionId||e?.rawId)===n);if(r||(r=e.find(e=>Array.isArray(e?.sameSatIds)&&e.sameSatIds.includes(n))),!r)return;const i=Array.isArray(r.sameSatIds)&&r.sameSatIds.length>0?r.sameSatIds[0]:null;if(i&&Xt(i)!==n){const t=e.find(e=>Xt(e?.id||e?.inscriptionId||e?.rawId)===Xt(i));if(t)return t}return r}(t.walletInscriptions,n);if(r){const e=Vt(r?.utxo?.value),t=Vt(r?.value),i=e??t;if(void 0!==i)return Wt.set(n,i),i}if("undefined"!=typeof window&&window?.Bitcoin?.fetchInscriptionUtxo){const e=await window.Bitcoin.fetchInscriptionUtxo(n),t=Vt(e?.value);if(void 0===t)throw new Error(`fetchInscriptionUtxo(${n}) returned invalid value: ${e?.value}`);return Wt.set(n,t),t}const i=qt(await Kt(n));if(!i)throw new Error(`Cannot resolve outpoint for inscription ${n} from ordinals details`);const a=await async function(e){if(jt.has(e))return jt.get(e);const t=await Ht(kt(`/r/utxo/${e}`));if(!t.ok)throw new Error(`Failed to fetch /r/utxo/${e} (status ${t.status})`);const n=await t.json(),r=Vt(n?.value);if(void 0===r)throw new Error(`Invalid /r/utxo value for ${e}: ${n?.value}`);return jt.set(e,r),r}(i);return Wt.set(n,a),a}const Jt=Object.freeze(Object.defineProperty({__proto__:null,fetchReinscriptionTarget:async function(e,t,n){const r=kt(`/r/utxo/${e}:${t}`),i=await Ht(r);if(!i.ok)throw new Error(`UTXO not found or spent: ${e}:${t} (status: ${i.status})`);const a=await i.json();if(!a.inscriptions||0===a.inscriptions.length)throw new Error("UTXO does not contain an inscription");if(a.value<546)throw new Error(`UTXO value (${a.value} sats) below dust limit (546 sats)`);const o=a.inscriptions[0],s=a.sat_ranges?.[0]||null;return{txid:e,vout:t,value:a.value,address:n,inscriptionId:o,satRange:s}},getInscriptionDetails:Kt,getInscriptionOutpoint:Gt,getInscriptionUtxo:async function(e,t=null){const[n,r,i]=e.split(":"),a=`${n}:${r}`,o=await fetch(kt(`/r/utxo/${a}`));if(o.ok)return{...await o.json(),txid:n,vout:parseInt(r),offset:parseInt(i||0),isCurrentLocation:!0};if(404===o.status){if(t?.output){const[n,r]=t.output.split(":"),a=`${n}:${r}`,o=await fetch(kt(`/r/utxo/${a}`));if(o.ok)return{...await o.json(),txid:n,vout:parseInt(r),offset:parseInt(i||0),isCurrentLocation:!0,originalSatpoint:e}}throw new Error(`Satpoint ${e} references a spent output; current location must be resolved via FIFO sat tracking.`)}throw new Error(`Failed to fetch UTXO: ${o.statusText}`)},getRawTransaction:async function(e){const t=await fetch(kt(`/r/tx/${e}`));if(!t.ok)throw new Error(`Failed to fetch transaction: ${t.statusText}`);return await t.text()},primeInscriptionValueCacheFromList:function(e=[]){if(Array.isArray(e)&&0!==e.length)for(const t of e)try{const e=Xt(t?.id||t?.inscriptionId||t?.rawId);if(!e)continue;const n=Vt(t?.utxo?.value),r=Vt(t?.value),i=n??r;if(void 0===i)continue;Wt.has(e)||Wt.set(e,i)}catch{}},resolveExactInscriptionUtxoValue:Yt,sanitizeInscriptionId:Xt},Symbol.toStringTag,{value:"Module"})),Qt=new class{debug(...e){}warn(...e){}error(...e){}info(...e){}success(...e){}},{debug:Zt,warn:en,error:tn,info:nn,success:rn}=Qt,an=kt("/content/ce1f29db15be493a22c0e97ce19815f10273913706703120baa86fa44269af0fi0");let on=null;async function sn(){if("undefined"==typeof window)throw new Error("Bitcoin initialization requires browser environment");if(!window.secp256k1)throw new Error("window.secp256k1 not found. Ensure index.html loads Noble secp256k1 first.\nExpected: window.secp256k1 (from frontend/components/secp256k1.bundle.mjs)");const e=window.secp256k1,t=e.Point||e.ProjectivePoint;if(!t||"function"!=typeof t.fromHex){const t=e?Object.keys(e):[];throw new Error(`Bitcoin init failed: secp256k1 Point API missing. Expected window.secp256k1.Point.fromHex() or window.secp256k1.ProjectivePoint.fromHex(). Available exports: ${t.join(", ")}`)}const n=(()=>{if(e?.CURVE?.n)return e.CURVE.n;if("function"==typeof t.CURVE){const e=t.CURVE();if(e?.n)return e.n}return t?.CURVE?.n?t.CURVE.n:null})();if(!n)throw new Error("Bitcoin init failed: could not resolve curve order n from secp256k1");const r=await async function(){if("undefined"==typeof window)throw new Error("Bitcoin library requires browser environment");return window.BitcoinLib||window.bitcoin?window.BitcoinLib||window.bitcoin:(on||(on=(async()=>{Qt.debug("\ud83d\udce6 Loading bitcoinjs-lib from inscription..."),await import(an);const e=window.BitcoinLib||window.bitcoin;if(!e)throw new Error("Failed to load bitcoinjs-lib - window.BitcoinLib not set");return Qt.debug("\u2705 bitcoinjs-lib loaded"),e})()),on)}();return window.__bitcoinInitialized||(Qt.debug("\ud83d\udd27 Initializing bitcoinjs-lib with Noble secp256k1..."),Qt.debug("   Available Noble exports:",Object.keys(window.secp256k1)),r.initEccLib({isPoint:e=>{try{const n=e instanceof Uint8Array?Buffer.from(e).toString("hex"):e;return t.fromHex(n),!0}catch{return!1}},isPrivate:e=>e instanceof Uint8Array&&32===e.length&&window.secp256k1.utils.isValidSecretKey(e),isXOnlyPoint:e=>{if(!(e instanceof Uint8Array)||32!==e.length)return!1;try{return t.fromHex("02"+Buffer.from(e).toString("hex")),!0}catch{return!1}},pointFromScalar:(e,t=!0)=>window.secp256k1.getPublicKey(e,t),xOnlyPointAddTweak:(e,n)=>{try{const r=Buffer.from(e).toString("hex"),i=Buffer.from(n).toString("hex"),a=t.fromHex("02"+r),o=BigInt("0x"+i),s=t.BASE.multiply(o),l=a.add(s);if(l.equals(t.ZERO))return null;const{x:c,y:u}=l.toAffine(),d=window.secp256k1.etc.numberToBytesBE(c,32);return{parity:Number(1n&u),xOnlyPubkey:Uint8Array.from(d)}}catch(r){return Qt.error("\u274c xOnlyPointAddTweak error:",r),Qt.error("   Stack:",r.stack),null}},sign:(e,t)=>window.secp256k1.sign(e,t).toCompactRawBytes(),signSchnorr:(e,t,n)=>window.secp256k1.schnorr.sign(e,t,n),verify:(e,t,n)=>{try{return window.secp256k1.verify(n,e,t)}catch{return!1}},verifySchnorr:(e,t,n)=>{try{return window.secp256k1.schnorr.verify(n,e,t)}catch{return!1}},pointAddScalar:(e,n,r)=>{const i=e instanceof Uint8Array?Buffer.from(e).toString("hex"):e,a=t.fromHex(i),o=BigInt("0x"+Buffer.from(n).toString("hex")),s=t.BASE.multiply(o);return a.add(s).toRawBytes(r)},privateAdd:(e,t)=>{const r=BigInt("0x"+Buffer.from(e).toString("hex")),i=BigInt("0x"+Buffer.from(t).toString("hex")),a=window.secp256k1.etc.mod(r+i,n);return window.secp256k1.etc.numberToBytesBE(a,32)}}),window.__bitcoinInitialized=!0,Qt.debug("\u2705 bitcoinjs-lib initialized with Noble secp256k1")),r}const ln="__nexusBufferReady";let cn=null;function un(e){const t=e.concat;e.concat=function(n,r){const i=n.map((t,n)=>{if(e.isBuffer(t)&&"Buffer"===t.constructor.name)return t;if(t instanceof Promise)throw new Error(`Buffer.concat called with unresolved Promise at index ${n}`);return t instanceof Uint8Array?e.from(t.buffer,t.byteOffset,t.byteLength):e.isBuffer(t)?t.buffer&&void 0!==t.byteOffset&&void 0!==t.byteLength?e.from(t.buffer,t.byteOffset,t.byteLength):e.from(Uint8Array.from(t)):e.from(t)});return t.call(this,i,r)},Qt.debug("\u2705 Patched Buffer.concat for safe Uint8Array handling")}function dn(){if("undefined"==typeof window)return Promise.reject(new Error("Buffer polyfill is browser-only"));const e="undefined"!=typeof globalThis?globalThis:window;return e.Buffer?(e[ln]||(e[ln]=!0,e.global||(e.global=e),un(e.Buffer)),Promise.resolve(e.Buffer)):(cn||(cn=(async()=>{const t=await n(()=>Promise.resolve().then(()=>g),__VITE_PRELOAD__),r=t?.Buffer||t?.default?.Buffer;if(!r)throw new Error("Buffer polyfill not found in imported module");return e.Buffer||(e.Buffer=r),e.global||(e.global=e),e[ln]=!0,un(e.Buffer),e.Buffer})().catch(e=>{throw cn=null,e})),cn)}function pn(e,t){if(Buffer.isBuffer(e)&&"Buffer"===e.constructor.name)return e;if(e instanceof Uint8Array)return Buffer.from(e.buffer,e.byteOffset,e.byteLength);if(ArrayBuffer.isView(e))return Buffer.from(e.buffer,e.byteOffset,e.byteLength);if(e instanceof ArrayBuffer)return Buffer.from(e);if("string"==typeof e){const t=e.startsWith("0x")?e.slice(2):e;return Buffer.from(t,"hex")}if("Buffer"===e?.type&&Array.isArray(e.data))return Buffer.from(e.data);throw new Error(`Expected Buffer-like value for ${t||"parameter"}, got ${typeof e}`)}function fn(){if("undefined"==typeof window)return;const e=window.BitcoinLib||window.bitcoin;return e&&(window.BitcoinLib||(window.BitcoinLib=e),window.bitcoin||(window.bitcoin=e),void 0===window.Buffer&&e.Buffer&&(window.Buffer=e.Buffer)),window.BitcoinLib}const mn=Object.freeze(Object.defineProperty({__proto__:null,ensureBufferPolyfill:dn,ensureProperBuffer:pn,patchBufferConcat:un,resolveBitcoinGlobal:fn},Symbol.toStringTag,{value:"Module"}));function gn(e){if(e<253)return Buffer.from([e]);if(e<=65535)return Buffer.from([253,255&e,e>>8&255]);if(e<=4294967295)return Buffer.from([254,255&e,e>>8&255,e>>16&255,e>>24&255]);const t=Buffer.allocUnsafe(9);return t[0]=255,t.writeBigUInt64LE(BigInt(e),1),t}function hn(e){let t=0;e.forEach(e=>{const n=e.length;t+=n<253?1:n<=65535?3:n<=4294967295?5:9,t+=n});const n=e.length;t+=n<253?1:n<=65535?3:n<=4294967295?5:9;const r=Buffer.allocUnsafe(t);let i=0;const a=gn(n);return a.copy(r,i),i+=a.length,e.forEach(e=>{const t=gn(e.length);t.copy(r,i),i+=t.length,e.copy(r,i),i+=e.length}),r}function bn(e,t,n=192){const r=pn(t,"tapleaf script");return function(e,t,n){const r=e.sha256(Buffer.from("TapLeaf","utf8"));return e.sha256(Buffer.concat([r,r,n]))}(e,0,Buffer.concat([Buffer.from([n]),gn(r.length),r]))}function yn(e,t="mainnet"){switch(t){case"testnet":return e.networks?.testnet||e.networks?.bitcoin;case"regtest":return e.networks?.regtest||e.networks?.testnet||e.networks?.bitcoin;default:return e.networks?.bitcoin||e.networks?.mainnet}}function xn(e,t,n){try{return e.address.toOutputScript(t,n)}catch(r){throw new Error(`Invalid Bitcoin address "${t}": ${r.message}`)}}kt("/r/sat/1550501128240727/at/-1/content"),kt("/r/sat/1550501128239335/at/-1/content");const wn=kt("/content/ce1f29db15be493a22c0e97ce19815f10273913706703120baa86fa44269af0fi0"),vn="nexus-lib-cache-v1";async function Sn(e){try{if("undefined"==typeof caches||!caches?.open)return null;const t=await caches.open(vn),n=await t.match(e);return n&&n.ok?await n.arrayBuffer():null}catch{return null}}async function En(e,t){try{if("undefined"==typeof caches||!caches?.open)return!1;const n=await caches.open(vn),r=new Response(t,{headers:{"content-type":"text/javascript","x-nexus-cached-at":(new Date).toISOString()}});return await n.put(e,r),!0}catch{return!1}}let Nn=null;async function In(){if("undefined"==typeof window)throw new Error("loadBitcoinLibFromInscription: Browser environment required");Nn||(Nn=(async()=>{const e=fn();return e?(await dn(),await sn(),e):(await dn(),window.secp256k1||Qt.warn("\u26a0\ufe0f window.secp256k1 not found! Ensure index.html loads Noble secp256k1 correctly."),fn()?(await sn(),window.BitcoinLib):new Promise((e,t)=>{const n=document.createElement("script"),r=function(){const e="undefined"!=typeof window?window.__NEXUS_LIB_PINS__:null,t=e?.bitcoinjs||e?.bitcoinLib||null;if(!t)return null;const n=t?.url?String(t.url).trim():"",r=function(e){const t=null==e?"":String(e).trim().toLowerCase();return/^[0-9a-f]{64}$/.test(t)?t:null}(t?.sha256||t?.sha256Hex||t?.hash);return n&&r?{url:n,sha256Hex:r}:null}(),i=r?.url?r.url:wn;!r&&String(i).includes("/at/-1/")&&Qt.warn("\u26a0\ufe0f bitcoinjs-lib is being loaded from a mutable /at/-1 URL without an integrity pin. This is unsafe for production.");const a=e=>{const t=new Blob([String(e)],{type:"text/javascript"}),r=URL.createObjectURL(t);n.src=r,n.dataset.nexusBlobUrl=r};(async()=>{try{const e="undefined"!=typeof navigator&&!1===navigator.onLine;if(r){const e=await fetch(i,{cache:"no-store"});if(!e.ok)throw new Error(`Failed to fetch pinned bitcoinjs-lib (status ${e.status})`);const t=await e.arrayBuffer(),n=await async function(e){const t=e instanceof ArrayBuffer?e:e?.buffer||null;if(!t)throw new Error("sha256Hex: missing bytes");const n="undefined"!=typeof globalThis&&globalThis.crypto?globalThis.crypto:null;if(n?.subtle?.digest){const e=await n.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(e)).map(e=>e.toString(16).padStart(2,"0")).join("")}throw new Error("sha256Hex: WebCrypto not available")}(t);if(n.toLowerCase()!==r.sha256Hex.toLowerCase())throw new Error("LIB_INTEGRITY_FAIL: bitcoinjs-lib sha256 mismatch");await En(i,t);const o=new TextDecoder("utf-8").decode(t);a(o)}else{if(e){const e=await Sn(i);if(e){const t=new TextDecoder("utf-8").decode(e);return void a(t)}}let t=null;try{const e=await fetch(i,{cache:"force-cache"});e.ok&&(t=await e.arrayBuffer(),await En(i,t))}catch{t=null}if(!t){const e=await Sn(i);e&&(t=e)}if(t){const e=new TextDecoder("utf-8").decode(t);a(e)}else n.src=`${i}${String(i).includes("?")?"&":"?"}t=${Date.now()}`}}catch(e){t(e)}})(),n.async=!0,n.onload=async()=>{try{const e=n.dataset.nexusBlobUrl;e&&URL.revokeObjectURL(e)}catch{}const r=fn();if(!r)return n.remove(),Nn=null,void t(new Error("bitcoinlib global not found after script load"));try{await sn(),e(r)}catch(tn){n.remove(),Nn=null,t(tn)}},n.onerror=()=>{try{const e=n.dataset.nexusBlobUrl;e&&URL.revokeObjectURL(e)}catch{}n.remove(),Nn=null,t(new Error("Failed to load bitcoinlib.js from inscription"))},document.head.appendChild(n)}))})());const e=fn();if(e)return e;const t=await Nn;if(!t||!t.script||!t.opcodes)throw Nn=null,new Error("bitcoinjs-lib loaded but is missing expected properties (script, opcodes). The library may have failed to initialize. Check network connectivity to ordinals.com.");return t}const An=Object.freeze(Object.defineProperty({__proto__:null,loadBitcoinLib:async function(){return In()},loadBitcoinLibFromInscription:In},Symbol.toStringTag,{value:"Module"})),kn="nexus_inscription_local_keypair";let Tn=null;async function Cn(){if(Tn)return Tn;if(!window.secp256k1)throw new Error("window.secp256k1 not found - ensure Noble secp256k1 is loaded in index.html");const e=window.secp256k1,t=!("undefined"==typeof globalThis||!0!==globalThis.__NEXUS_PERSIST_INSCRIPTION_KEYPAIR__||!function(){try{if("undefined"!=typeof globalThis&&!0===globalThis.isSecureContext)return!0}catch(e){}try{if("undefined"!=typeof location){const e=String(location.protocol||""),t=String(location.hostname||"");if("https:"===e)return!0;if("localhost"===t||"127.0.0.1"===t||"::1"===t)return!0}}catch(e){}return!1}()&&(Qt.warn("\u26a0\ufe0f Inscription keypair persistence requested, but context is not secure; using ephemeral in-memory keypair"),1)),n=function(){try{const e="undefined"!=typeof globalThis?globalThis.__NEXUS_INSCRIPTION_KEYPAIR_MAX_AGE_MS__:void 0;if(null!=e){const t=Number(e);return Number.isFinite(t)&&t>0?t:null}}catch(e){}try{import.meta}catch(e){}return null}();if(!t)try{"undefined"!=typeof localStorage&&localStorage.removeItem(kn)}catch(c){}if(t){const t=(()=>{try{return"undefined"==typeof localStorage?null:localStorage.getItem(kn)}catch{return null}})();if(t)try{const r=JSON.parse(t),{privateKeyHex:i,createdAt:a}=r&&"object"==typeof r?r:{};if(null!=n&&null!=a){const e=Date.now()-Number(a);if(Number.isFinite(e)&&e>n)throw new Error("Stored private key exceeded max age")}const o=Buffer.from(i,"hex");if(32!==o.length)throw new Error("Stored private key has invalid length");if(!e.utils.isValidSecretKey(o))throw new Error("Stored private key is out of valid range");const s=e.getPublicKey(o,!0);if(!s)throw new Error("Failed to derive public key from stored private key");const l=Buffer.from(s),c=l.slice(1,33),u={privateKey:o,publicKey:l,xOnlyPubKey:c};return Tn=u,u}catch(u){Qt.warn("\u26a0\ufe0f Stored inscription keypair is invalid, generating new one:",u.message)}}let r;const i="undefined"!=typeof globalThis&&globalThis.crypto?globalThis.crypto:null;if(!i?.getRandomValues)throw new Error("Secure randomness unavailable (globalThis.crypto.getRandomValues missing)");for(let d=0;d<16;d++){const t=Buffer.from(i.getRandomValues(new Uint8Array(32)));if(32===t.length&&e.utils.isValidSecretKey(t)){r=t;break}}if(!r)throw new Error("Failed to generate a valid private key after 16 attempts");const a=e.getPublicKey(r,!0);if(!a)throw new Error("Failed to derive public key from generated private key");const o=Buffer.from(a),s=o.slice(1,33),l={privateKey:r,publicKey:o,xOnlyPubKey:s};if(Tn=l,t)try{localStorage.setItem(kn,JSON.stringify({privateKeyHex:r.toString("hex"),createdAt:Date.now()}))}catch(u){Qt.warn("\u26a0\ufe0f Unable to store inscription keypair in localStorage:",u.message)}return l}async function Bn(e,t,n,r,i){if(!window.secp256k1)throw new Error("window.secp256k1 not found - ensure Noble secp256k1 is loaded in index.html");const a=window.secp256k1,o=(()=>{try{return!(!globalThis||!globalThis.__INSCRIBE_DEBUG_SIGNING__)}catch{return!1}})();let s;try{if(Buffer.isBuffer(r))s=Buffer.from(r);else if(r instanceof Uint8Array)s=Buffer.from(r.buffer,r.byteOffset,r.byteLength);else if("string"==typeof r){const e=r.startsWith("0x")?r.slice(2):r;s=Buffer.from(e,"hex")}else s="Buffer"===r?.type&&Array.isArray(r.data)?Buffer.from(r.data):Buffer.from(r)}catch(u){throw new Error("Invalid inscription private key material - unable to convert to Buffer")}if(32!==s.length||!a.utils.isValidSecretKey(s))throw Qt.warn("\u26a0\ufe0f Local inscription key invalid length/range",{length:s.length}),new Error("Invalid inscription private key; try clearing local inscription keypair and retry");const l=Buffer.from(a.getPublicKey(s,!0)).slice(1,33),c={publicKey:l,signSchnorr:e=>{const t=e instanceof Uint8Array?e:new Uint8Array(Buffer.from(e)),n=new Uint8Array(32);n.set(t.subarray(0,32));const r=a.schnorr.sign(n,Buffer.from(s)),i=Buffer.isBuffer(r)?r:Buffer.from(r);try{const e=a.schnorr.verify(i,n,l);o&&Qt.debug("\ud83d\udd10 Local Schnorr signature verification",{verified:!!e}),e||Qt.warn("\u26a0\ufe0f Local Schnorr verification failed \u2014 signature will likely be rejected on-chain")}catch(c){Qt.warn("\u26a0\ufe0f Local Schnorr verification check threw:",c?.message)}return i}};"function"==typeof t.signTapleafInput?await t.signTapleafInput(n,c,pn(i,"tapLeafHash")):await t.signInput(n,c)}async function Pn(e,t,n){if(!e||!e.script||!e.opcodes)throw new Error("bitcoinLib not loaded \u2014 script.compile/decompile unavailable. Ensure loadBitcoinLibFromInscription() resolved before calling buildTaprootArtifacts.");const{xOnlyPubKey:r,privateKey:i}=await Cn();if(!globalThis||globalThis.__INSCRIBE_DEBUG_TAPROOT__,!window.secp256k1)throw new Error("window.secp256k1 not found");const a=window.secp256k1;function o(){for(let e=0;e<16;e++){const e=Buffer.from(crypto.getRandomValues(new Uint8Array(32)));if(a.utils.isValidSecretKey(e))return e}throw new Error("Failed to generate internal private key")}let s=o(),l=a.getPublicKey(s,!0);if(!l)throw new Error("Failed to derive internal pubkey");let c=Buffer.from(l).slice(1,33);c.equals(r)&&(s=o(),l=a.getPublicKey(s,!0),c=Buffer.from(l).slice(1,33));const u=pn(t,"inscriptionScript"),d=e.script.decompile(u);if(!d)throw new Error("Failed to decompile inscription script");const p=e.script.compile([r,e.opcodes.OP_CHECKSIG,...d]),f={output:p,redeemVersion:192},m=e.payments.p2tr({internalPubkey:c,scriptTree:f,redeem:f,network:n});if(!m?.address)throw new Error("Failed to derive p2tr address");const g=m.witness?.[m.witness.length-1];if(!g)throw new Error("No control block");const h=bn(e.crypto,p,192);return{local:{privateKey:i,xOnlyPubKey:r},witnessScript:p,controlBlock:g,taprootPayment:m,leafVersion:192,leafHash:h,tapLeafHashHex:h.toString("hex")}}async function _n(e,t){if(!e||!e.script||!e.opcodes)throw new Error("bitcoinLib not loaded \u2014 script.compile unavailable. Ensure loadBitcoinLibFromInscription() resolved before calling buildTaprootFeePoolArtifacts.");const{xOnlyPubKey:n,privateKey:r}=await Cn();if(!window.secp256k1)throw new Error("window.secp256k1 not found");const i=window.secp256k1;function a(){for(let e=0;e<16;e++){const e=Buffer.from(crypto.getRandomValues(new Uint8Array(32)));if(i.utils.isValidSecretKey(e))return e}throw new Error("Failed to generate internal private key")}let o=a(),s=i.getPublicKey(o,!0);if(!s)throw new Error("Failed to derive internal pubkey");let l=Buffer.from(s).slice(1,33);l.equals(n)&&(o=a(),s=i.getPublicKey(o,!0),l=Buffer.from(s).slice(1,33));const c=e.script.compile([n,e.opcodes.OP_CHECKSIG]),u={output:c,redeemVersion:192},d=e.payments.p2tr({internalPubkey:l,scriptTree:u,redeem:u,network:t});if(!d?.address)throw new Error("Failed to derive fee-pool p2tr address");const p=d.witness?.[d.witness.length-1];if(!p)throw new Error("No control block for fee-pool");const f=bn(e.crypto,c,192);return{local:{privateKey:r,xOnlyPubKey:n},witnessScript:c,controlBlock:p,taprootPayment:d,leafVersion:192,leafHash:f,tapLeafHashHex:f.toString("hex")}}async function On(e,t,n=64){if(!e||!e.script||!e.opcodes)throw new Error("bitcoinLib not loaded \u2014 script.compile unavailable. Ensure loadBitcoinLibFromInscription() resolved before calling buildTaprootDataCarrierArtifacts.");const r=Math.max(0,Math.floor(Number(n||0)));if(!Number.isFinite(r)||r<=0)throw new Error("buildTaprootDataCarrierArtifacts: maxChunks must be a positive integer");const{xOnlyPubKey:i,privateKey:a}=await Cn();if(!window.secp256k1)throw new Error("window.secp256k1 not found");const o=window.secp256k1;function s(){for(let e=0;e<16;e++){const e=Buffer.from(crypto.getRandomValues(new Uint8Array(32)));if(o.utils.isValidSecretKey(e))return e}throw new Error("Failed to generate internal private key")}let l=s(),c=o.getPublicKey(l,!0);if(!c)throw new Error("Failed to derive internal pubkey");let u=Buffer.from(c).slice(1,33);u.equals(i)&&(l=s(),c=o.getPublicKey(l,!0),u=Buffer.from(c).slice(1,33));const d=Array.from({length:r},()=>e.opcodes.OP_DROP),p=e.script.compile([...d,i,e.opcodes.OP_CHECKSIG]),f={output:p,redeemVersion:192},m=e.payments.p2tr({internalPubkey:u,scriptTree:f,redeem:f,network:t});if(!m?.address)throw new Error("Failed to derive data-carrier p2tr address");const g=m.witness?.[m.witness.length-1];if(!g)throw new Error("No control block for data-carrier");const h=bn(e.crypto,p,192);return{local:{privateKey:a,xOnlyPubKey:i},witnessScript:p,controlBlock:g,taprootPayment:m,leafVersion:192,leafHash:h,tapLeafHashHex:h.toString("hex"),maxChunks:r}}async function Ln(e,t,n){if(!e||!e.script||!e.opcodes)throw new Error("bitcoinLib not loaded \u2014 script.compile/decompile unavailable. Ensure loadBitcoinLibFromInscription() resolved before calling buildSharedTaprootArtifacts.");if(!Array.isArray(t)||0===t.length)throw new Error("buildSharedTaprootArtifacts: inscriptionScripts array required");const{xOnlyPubKey:r,privateKey:i}=await Cn();if(!window.secp256k1)throw new Error("window.secp256k1 not found");const a=window.secp256k1;function o(){for(let e=0;e<16;e++){const e=Buffer.from(crypto.getRandomValues(new Uint8Array(32)));if(a.utils.isValidSecretKey(e))return e}throw new Error("Failed to generate internal private key")}let s=o(),l=a.getPublicKey(s,!0),c=Buffer.from(l).slice(1,33);c.equals(r)&&(s=o(),l=a.getPublicKey(s,!0),c=Buffer.from(l).slice(1,33));const u=[];t.forEach((t,n)=>{const r=pn(t,`sharedOutput.inscriptionScript[${n}]`),i=e.script.decompile(r);if(!i)throw new Error(`Failed to decompile inscription script at index ${n}`);u.push(...i)});const d=e.script.compile([r,e.opcodes.OP_CHECKSIG,...u]),p={output:d,redeemVersion:192},f=e.payments.p2tr({internalPubkey:c,scriptTree:p,redeem:p,network:n});if(!f?.address)throw new Error("Failed to derive shared-output p2tr address");const m=f.witness?.[f.witness.length-1];if(!m)throw new Error("No control block for shared-output");const g=bn(e.crypto,d,192);return{local:{privateKey:i,xOnlyPubKey:r},witnessScript:d,controlBlock:m,taprootPayment:f,leafVersion:192,leafHash:g,tapLeafHashHex:g.toString("hex"),compositeCount:t.length}}function Fn(e,t){const n=t.tapKeySig||t.partialSig&&t.partialSig[0]?.signature;if(!n)throw new Error("Missing key-path signature");return{finalScriptWitness:hn([n])}}function Mn(e,t){if(!t.partialSig||0===t.partialSig.length)throw new Error("Missing partial signature for P2WPKH input");const{pubkey:n,signature:r}=t.partialSig[0];if(!n||!r)throw new Error("Missing pubkey or signature in partialSig");const i={finalScriptWitness:hn([r,n])};if(t.redeemScript){const e=t.redeemScript.length;i.finalScriptSig=Buffer.concat([Buffer.from([e]),t.redeemScript])}return i}function Rn(e,t){const n=t.tapLeafScript&&t.tapLeafScript[0];if(!n)throw new Error("Missing tapLeafScript");const r=[];if(t.tapScriptSig&&t.tapScriptSig.length>0)for(const a of t.tapScriptSig)r.push(a.signature);if(0===r.length)throw new Error("Missing tapscript signature");const i=Array.isArray(t.extraWitnessStack)?t.extraWitnessStack.filter(e=>Buffer.isBuffer(e)):[];return{finalScriptWitness:hn([...r,...i,n.script,n.controlBlock])}}function $n(e){return e<253?1:e<=65535?3:e<=4294967295?5:9}function Un(e,t,n=!0,r=0,i={}){const{isReveal:a=!1,parentCount:o=0,targetCount:s=0,inscriptionCount:l=1,reinscription:c=!1,parentSigIncludesSighash:u=!0,inscriptionSigIncludesSighash:d=!1,controlBlockLen:p=33,parentInputType:f="p2wpkh",inputTypes:m=null,outputType:g="p2tr",outputTypes:h=null}=i;let b=10,y=0;n&&(b+=2);for(let w=0;w<e;w++){let e=0;const t=!a&&Array.isArray(m)?m[w]:null;if("p2sh-p2wpkh"===t&&(e=23),b+=41+e,n){let e=0,n=0;if(a&&w<o)"p2tr"===f?(e=1,n+=65):(e=2,n+=1+(u?72:71),n+=34);else if(a&&w>=o&&w<o+s)e=1,n+=65;else if(a&&w>=o+s){e=3,n+=1+(d?65:64);const t=r+34;n+=$n(t)+t,n+=1+p}else"p2tr"===(!a&&Array.isArray(m)&&t?t:f)?(e=1,n+=65):(e=2,n+=73,n+=34);y+=$n(e),y+=n}}if(Array.isArray(h)&&h.length>0)for(let w=0;w<t;w++)b+="p2wpkh"===(h[w]||g)?31:43;else b+=t*("p2tr"===g?43:31);const x=4*b+y;return Math.ceil(x/4)}function zn(e,t,n){const r=Un(e,t,!0,0,{isReveal:!1}),i=Math.ceil(r*n);return{fee:i,vsize:r,achievedFeeRate:i/r,requestedFeeRate:n}}function Dn(e,t,n={}){const r=function(e,t={}){const{parentCount:n=0,includeFeePoolInput:r=!1,parentInputType:i="p2wpkh",parentSigIncludesSighash:a=!0,inscriptionSigIncludesSighash:o=!1,controlBlockLen:s=33}=t,l=Array.isArray(e)?e:[],c=l.length,u=n+c+(r?1:0),d=n+c;let p=12,f=0;for(let g=0;g<u;g++){if(p+=41,g<n){let e=0,t=0;"p2tr"===i?(e=1,t+=65):(e=2,t+=1+(a?72:71),t+=34),f+=$n(e),f+=t;continue}const e=3;let t=0;t+=1+(o?65:64);const r=(g<n+c?Math.max(0,Math.floor(l[g-n]||0)):0)+34;t+=$n(r)+r,t+=1+s,f+=$n(e),f+=t}p+=43*d;const m=4*p+f;return Math.ceil(m/4)}(e,n),i=Math.ceil(r*t);return{fee:i,vsize:r,achievedFeeRate:i/r,requestedFeeRate:t}}function Hn(e,t,n=0,r={}){const{commitFeeRate:i=null,postage:a=546,isReinscription:o=!1,parentInputType:s="p2wpkh",parentSigIncludesSighash:l=!0,inscriptionSigIncludesSighash:c=!1,controlBlockLen:u=33,hasMetadata:d=!1,metadataSize:p=0,hasProperties:f=!1,propertiesSize:m=0,hasPointer:g=!1,hasContentEncoding:h=!1,customTagCount:b=0,scriptSizeExact:y=null}=r,x=i||t,w=zn(2,2,x);let v=0;y||(g&&(v+=10),h&&(v+=20),d&&(v+=10+8*Math.ceil(p/520)),f&&(v+=10+8*Math.ceil(m/520)),v+=12*b);const S=y?Math.max(0,Math.floor(y)):100+e+p+m+v,E=function(e,t,n={}){const{parentCount:r=0,isReinscription:i=!1,targetCount:a=0,parentInputType:o="p2wpkh",parentSigIncludesSighash:s=!0,inscriptionSigIncludesSighash:l=!1,controlBlockLen:c=33}=n,u=Un(r+a+1,r+1,!0,e,{isReveal:!0,parentCount:r,targetCount:a,reinscription:i,parentSigIncludesSighash:s,inscriptionSigIncludesSighash:l,controlBlockLen:c,parentInputType:o}),d=Math.ceil(u*t);return{fee:d,vsize:u,achievedFeeRate:d/u,requestedFeeRate:t}}(S,t,{parentCount:n,isReinscription:o,targetCount:0,parentInputType:s,parentSigIncludesSighash:l,inscriptionSigIncludesSighash:c,controlBlockLen:u}),N=o?0:a;let I=E.fee+N,A=0;!o&&I<330&&(A=330-I,I=330);const k=w.fee/w.vsize,T=E.fee/E.vsize,C=w.fee+I;return{calculateCommitFee:(e,t)=>zn(e,t,x),commitFee:w.fee,commitSize:w.vsize,commitFeeRate:x,commitActualFeeRate:k,revealFee:E.fee,revealSize:E.vsize,revealFeeRate:t,revealActualFeeRate:T,postage:N,revealFunding:I,dustAdjustment:A,totalRequired:C,fundingRequired:C,isReinscription:o,parentCount:n,contentSize:e,scriptSize:S,advancedFieldsOverhead:y?0:v,usesSeparateCommitRate:!!i,usesCustomPostage:546!==a}}function Wn(e){const t=new Set,n=[];return(e||[]).forEach(e=>{(Array.isArray(e.parentUtxos)?e.parentUtxos:e.parentUtxo?[e.parentUtxo]:[]).forEach(e=>{const r=`${e.txid}:${e.vout}`;t.has(r)||(t.add(r),n.push(e))})}),n}function jn(e,t,n=50,r=38e4){return e>=n||t>=r}const Vn={platform:{address:"bc1pqu9t32xuc3kdl2lxnfvgf5tkgmssee450lhepw60yfzv2sga7f0q6jkejr",amountSats:1500,description:"Nexus OCW Platform Fee"},developer:{enabled:!1,address:null,amountSats:0,description:"Developer API Fee",mode:"transaction"},custom:[]};function qn(e){if(!e)return void(Vn.developer.enabled=!1);if(!e.address||"string"!=typeof e.address)throw new Error("Developer fee requires valid Bitcoin address");if("number"!=typeof e.amountSats||e.amountSats<0)throw new Error("Developer fee amount must be non-negative number");const t=((e,t)=>{if(!0===t)return"per-item";const n=String(e||"").trim().toLowerCase();if(!n)return"transaction";if("transaction"===n||"tx"===n)return"transaction";if("per-item"===n||"per_item"===n||"peritem"===n||"item"===n)return"per-item";throw new Error('Developer fee mode must be "transaction" or "per-item"')})(e.mode,e.perItem);Vn.developer={enabled:e.amountSats>0,address:e.address,amountSats:e.amountSats,description:e.description||"Developer API Fee",mode:t}}function Xn(e=1,t=null){const n=[],r=function(e){const t=Number(e);return Number.isFinite(t)?Math.max(1,Math.min(2e3,Math.floor(t))):1}(Array.isArray(t)?t.length:e);if(Vn.platform.address&&Vn.platform.amountSats>0&&n.push({address:Vn.platform.address,value:Vn.platform.amountSats,purpose:"platform-fee",description:Vn.platform.description}),Vn.developer.enabled&&Vn.developer.amountSats>0&&Vn.developer.address)if("per-item"===(Vn.developer.mode||"transaction"))for(let i=0;i<r;i++){const e=Array.isArray(t)?t?.[i]?.developerFeeOverride:null;if(e&&"object"==typeof e&&!1===e.enabled)continue;const r=e&&"string"==typeof e.address&&e.address.trim()?e.address.trim():Vn.developer.address,a=e&&void 0!==e.amountSats&&null!==e.amountSats?Number(e.amountSats):Vn.developer.amountSats;!Number.isFinite(a)||a<=0||n.push({address:r,value:a,purpose:"developer-fee",description:e&&(e.description||e.label)||Vn.developer.description})}else n.push({address:Vn.developer.address,value:Vn.developer.amountSats,purpose:"developer-fee",description:Vn.developer.description});return Vn.custom.forEach((e,t)=>{n.push({address:e.address,value:e.amountSats,purpose:`custom-fee-${t}`,description:e.description})}),n}function Kn(e=1,t=null){return Xn(e,t).reduce((e,t)=>e+t.value,0)}function Gn(e,t,n="Custom Fee"){if(!e||"string"!=typeof e)throw new Error("Custom fee requires valid Bitcoin address");if("number"!=typeof t||t<=0)throw new Error("Custom fee amount must be positive number");Vn.custom.push({address:e,amountSats:t,description:n})}function Yn(){Vn.custom=[]}function Jn(){const e=[];return Vn.platform.address&&Vn.platform.amountSats>0&&e.push({address:Vn.platform.address,value:Vn.platform.amountSats,purpose:"platform-fee",description:Vn.platform.description}),Vn.developer.enabled&&Vn.developer.amountSats>0&&Vn.developer.address&&e.push({address:Vn.developer.address,value:Vn.developer.amountSats,purpose:"developer-fee",description:Vn.developer.description}),Vn.custom.forEach((t,n)=>{e.push({address:t.address,value:t.amountSats,purpose:`custom-fee-${n}`,description:t.description})}),e}function Qn(){return Jn().reduce((e,t)=>e+t.value,0)}const Zn=Object.freeze(Object.defineProperty({__proto__:null,FEE_CONFIG:Vn,addCustomFee:Gn,clearCustomFees:Yn,getActiveFeeOutputs:Jn,getActiveFeeOutputsForBatch:Xn,getTotalFeeAmount:Qn,getTotalFeeAmountForBatch:Kn,setDeveloperFee:qn},Symbol.toStringTag,{value:"Module"})),er=Object.freeze(Object.defineProperty({__proto__:null,signPsbtsWithFallback:V},Symbol.toStringTag,{value:"Module"}));function tr(e){if(!e||"object"!=typeof e)return e;const t={...e};if(Array.isArray(t.toSignInputs)&&(t.toSignInputs=t.toSignInputs.map(e=>{if(!e||"object"!=typeof e)return e;const t={...e},n=t.sighashType;return"number"==typeof n&&(Array.isArray(t.sighashTypes)?t.sighashTypes.includes(n)||(t.sighashTypes=[...t.sighashTypes,n]):t.sighashTypes=[n]),t}),!Array.isArray(t.sighashTypes))){const e=[];for(const n of t.toSignInputs)if(n&&"object"==typeof n){const t=n.sighashType;"number"!=typeof t||e.includes(t)||e.push(t);const r=n.sighashTypes;if(Array.isArray(r))for(const n of r)"number"!=typeof n||e.includes(n)||e.push(n)}e.length&&(t.sighashTypes=e)}return t}async function nr(e,t,n={},r=!1){if(!e||"function"!=typeof e.signPsbt)throw new Error("Wallet must have signPsbt method");const i=e.name&&["MagicEden"].includes(e.name);if(r&&i){Qt.info(`\ud83d\ude80 Using native broadcast for ${e.name}`);try{const r=await e.signPsbt(t,tr({...n,broadcast:!0}));if(r&&r.broadcasted&&r.txid)return Qt.info(`\u2705 ${e.name} broadcasted transaction:`,r.txid),{txid:r.txid,broadcasted:!0,method:"native"};if("string"==typeof r&&64===r.length)return Qt.info(`\u2705 ${e.name} broadcasted transaction:`,r),{txid:r,broadcasted:!0,method:"native"};throw Qt.warn(`\u26a0\ufe0f Expected txid from ${e.name} broadcast, got:`,r),new Error("Unexpected broadcast response format")}catch(tn){Qt.warn(`Native broadcast failed for ${e.name}:`,tn.message)}}Qt.info(r?"\ud83d\udd04 Using fallback sign+broadcast":"\ud83d\udd0f Signing without broadcast");try{const i=await e.signPsbt(t,tr(n));if(!r)return{signedPsbt:i,broadcasted:!1,method:"sign-only"};let l=null;const c=e=>{if(!e)return null;if("string"==typeof e)return e.trim()||null;if("object"==typeof e){const t=e.txid||e.txId||e.result||e.data;if("string"==typeof t)return t.trim()||null}return null};if("function"==typeof e.pushPsbt&&!1!==e.features?.pushPsbt)try{const t=Buffer.from(i,"hex").toString("base64");if(l=c(await e.pushPsbt(t)),l)return Qt.info("\u2705 Broadcasted via pushPsbt:",l),{txid:l,signedPsbt:i,broadcasted:!0,method:"pushPsbt"}}catch(a){Qt.warn("pushPsbt failed:",a.message)}if("function"==typeof e.pushTx&&!1!==e.features?.pushTx)try{const t=(await In()).Psbt.fromHex(i);if(!0===n?.autoFinalized){Qt.info("\ud83d\udd27 Finalizing PSBT before broadcast (autoFinalized=true)...");try{t.finalizeAllInputs(),Qt.info("\u2705 All inputs finalized successfully")}catch(o){Qt.warn("\u26a0\ufe0f Could not finalize all inputs, trying individual finalization:",o.message);let e=0;for(let n=0;n<t.data.inputs.length;n++)try{t.data.inputs[n].finalScriptWitness||t.data.inputs[n].finalScriptSig||(t.finalizeInput(n),e++)}catch(a){Qt.warn(`\u26a0\ufe0f Could not finalize input ${n}:`,a.message)}Qt.info(`\u2705 Finalized ${e} of ${t.data.inputs.length} inputs`)}}Qt.info("\ud83d\udd27 Extracting transaction from PSBT...");const r=t.extractTransaction().toHex();Qt.info(`\u2705 Transaction extracted (${r.length/2} bytes)`);const s="function"==typeof e?.getState&&e.getState()?.walletType||"";if(l=c(((s||e?.walletType||e?.name||"").toLowerCase?.()||"").includes("unisat")?await e.pushTx({rawtx:r}):await e.pushTx(r)),l)return Qt.info("\u2705 Broadcasted via pushTx:",l),{txid:l,signedPsbt:i,broadcasted:!0,method:"pushTx"}}catch(a){Qt.error("\u274c pushTx failed:",a.message,a)}try{const t=(await In()).Psbt.fromHex(i);if(!0===n?.autoFinalized)try{t.finalizeAllInputs()}catch(s){}const r=t.extractTransaction().toHex(),a=String(n?.network||e?.getState?.()?.network||"mainnet").toLowerCase(),o=String(n?.label||"tx"),l=await rr(e,r,a,o);if(l)return Qt.info("\u2705 Broadcasted via broadcastTransaction fallback:",l),{txid:l,signedPsbt:i,broadcasted:!0,method:"broadcastTransaction"}}catch(a){Qt.warn("broadcastTransaction fallback failed:",a?.message||a)}return Qt.warn("\u26a0\ufe0f Broadcast requested but all methods failed"),{signedPsbt:i,broadcasted:!1,method:"fallback-failed"}}catch(tn){throw Qt.error("Signing failed:",tn.message),tn}}async function rr(e,t,n,r){let i,a;if("string"==typeof t)i=t;else{if(!t||"object"!=typeof t)throw new Error("broadcastTransaction payload must be string or {txHex, psbtBase64}");i=t.txHex,a=t.psbtBase64}try{const e="string"==typeof i&&i.toLowerCase().startsWith("70736274ff"),t="string"==typeof i&&i.startsWith("cHNidP");if(!a&&t&&(a=i,i=void 0),a&&!i){const e=(await In()).Psbt.fromBase64(a);i=e.extractTransaction().toHex()}else if(e){const e=(await In()).Psbt.fromHex(i);i=e.extractTransaction().toHex()}}catch(d){}"string"==typeof i&&(i=i.trim());const o="function"==typeof e?.getState&&e.getState()?.walletType||"",s=(o||e?.walletType||e?.name||"").toLowerCase?.()||"",l=["leather","phantom"].includes(s),c=zt(),u=async()=>{if(!i||"function"!=typeof fetch)return null;try{const t=Tt("testnet"===n?"/testnet/api/tx":"regtest"===n?"/signet/api/tx":"/api/tx"),r=performance.now(),a=await fetch(t,{method:"POST",headers:{"Content-Type":"text/plain"},body:i});if((performance.now()-r).toFixed(2),a.ok)return(await a.text()).trim();let o="";try{o=await a.text()}catch(e){}return null}catch(t){return null}};if(c&&("oodl-sale-reveal"===r||"oodl-buy"===r)){const e=await u();if(e)return e}if(!l&&i&&"function"==typeof e.pushTx&&!1!==e.features?.pushTx)try{const t=performance.now(),n=String(i);let r;if(s.includes("unisat"))try{r=await e.pushTx({rawtx:n})}catch(p){r=await e.pushTx(n)}else r=await e.pushTx(n);if((performance.now()-t).toFixed(2),"string"==typeof r)return r}catch(f){}if(!l&&a&&"function"==typeof e.pushPsbt&&!1!==e.features?.pushPsbt)try{const t=performance.now(),n=await e.pushPsbt(a);if((performance.now()-t).toFixed(2),"string"==typeof n)return n}catch(f){}if(c){const e=await u();if(e)return e}if(i&&"function"==typeof fetch&&window.NexusBitcoinProxy&&window.NexusBitcoinProxy.isEnabled())try{try{const e=window.NexusBitcoinProxy.getUrl();e&&"function"==typeof e.then&&await e}catch(f){}const e=performance.now(),t=await window.NexusBitcoinProxy.broadcastTx(i);return(performance.now()-e).toFixed(2),t}catch(m){}if(!c){const e=await u();if(e)return e}return null}const ir=Object.freeze(Object.defineProperty({__proto__:null,broadcastTransaction:rr,signAndBroadcastPsbt:nr},Symbol.toStringTag,{value:"Module"})),ar=new Map;async function or(e,t){const n=`${e}:${t}`,r=ar.get(n);if(r&&Date.now()-r.timestamp<3e4)return r.unspent;try{const r=await fetch(`https://mempool.space/api/tx/${e}/outspend/${t}`);if(!r.ok)return!0;const i=!(await r.json()).spent;return ar.set(n,{unspent:i,timestamp:Date.now()}),i}catch(tn){return!0}}function sr({bitcoinLib:e,net:t,revealPsbt:n,outputs:r,items:i,commitTxHashLE:a}){const o=(i||[]).filter(e=>e&&e.nxsParcelManifestSelfHint);if(0===o.length)return null;if(o.length>1)throw new Error("Multiple nxsParcelManifestSelfHint items in one reveal segment is not supported");const s=o[0],l=s.nxsParcelManifestSelfHint||{},c=String(l.indexingAddress||"").trim(),u=Math.ceil(Number(l.feeSats||0)),d=Number(l.bitmapNumber),p=!1!==l.all;if(!c)throw new Error("nxsParcelManifestSelfHint: indexingAddress is required");if(!Number.isFinite(u)||u<=0)throw new Error("nxsParcelManifestSelfHint: feeSats must be > 0");if(!Number.isFinite(d)||d<0)throw new Error("nxsParcelManifestSelfHint: bitmapNumber must be >= 0");return n.addOutput({address:c,value:u}),r.push({address:c,value:u,purpose:"nxs-parcel-manifest-fee",itemIndex:s.__index}),{indexingAddress:c,feeSats:u,bitmapNumber:d,all:p}}function lr(e,t="psbt"){const n=e?.data?.globalMap?.unsignedTx?.tx;if(!n||"function"!=typeof n.getId)throw new Error(`${t}: missing unsignedTx for txid check`);return n.getId()}function cr({expectedUnsignedTxid:e,psbt:t,label:n}){const r=lr(t,n);if(String(r)!==String(e)){const t=new Error(`${n}: unsigned txid changed (expected ${e}, got ${r}). Refusing to sign/broadcast.`);throw t.code="PSBT_UNSIGNED_TXID_MISMATCH",t}}function ur({bitcoinLib:e,network:t,commitTxHashLE:n,items:r}){const i=new e.Psbt({network:t}),a=[],o=[];return r.forEach((e,t)=>{const r={hash:n,index:"number"==typeof e.commitVoutIndex?e.commitVoutIndex:t,sequence:4294967293,witnessUtxo:{script:e.taprootPayment.output,value:Math.ceil(e.revealFundingValue)},tapLeafScript:[{controlBlock:e.controlBlock,leafVersion:e.leafVersion,script:e.witnessScript}]};i.addInput(r),a.push({index:t,address:e.taprootPayment.address,disableTweakSigner:!0,tapLeafHash:e.leafHash.toString("hex")});const s=Math.ceil(e.postage??546);i.addOutput({address:e.recipientAddress,value:s}),o.push({address:e.recipientAddress,value:s,purpose:"inscription-output",itemIndex:e.__index})}),{psbt:i,base64:i.toBase64(),inputsToSign:a,outputs:o}}function dr({bitcoinLib:e,network:t,commitTxHashLE:n,items:r,ordinalsPublicKey:i,fees:a,wallet:o,globalReinscriptionTargets:s,reinscriptionFeePool:l}){const c=new e.Psbt({network:t}),u=[],d=[],p=o&&"function"==typeof o.getState&&o.getState()||{},f=String(p.walletType||o?.walletType||o?.name||"").toLowerCase(),m=String(p.ordinalsAddress||o?.ordinalsAddress||"").trim(),g=String(p.paymentAddress||o?.paymentAddress||"").trim();e.Transaction,e.Transaction;const{parentSighash:h}=function(e,t){const n=e.Transaction?.SIGHASH_SINGLE??3,r=e.Transaction?.SIGHASH_ANYONECANPAY??128,i=e.Transaction?.SIGHASH_ALL??1,a=("function"==typeof t?.getState&&t.getState()?.walletType||t?.walletType||t?.name||"").toLowerCase(),o="leather"===a||"hiro"===a,s="unisat"===a||"unisat wallet"===a;let l;return o?(l=i,Qt.debug("\ud83d\udd27 Leather wallet detected: Using SIGHASH_ALL (0x01) for parent/reinscription inputs")):s?(l=n,Qt.debug("\ud83d\udd27 UniSat wallet detected: Using SIGHASH_SINGLE (no ANYONECANPAY) for parent/reinscription inputs")):(l=n|r,Qt.debug("\ud83d\udd27 Standard wallet: Using SIGHASH_SINGLE|ANYONECANPAY (0x83) for parent/reinscription inputs")),{parentSighash:l,isLeatherWallet:o}}(e,o),b=new Set,y=[],x=Wn(r),w=new Set(s||[]);(r||[]).filter(e=>e.reinscriptionUtxo&&void 0!==e.reinscriptionUtxo.txid).forEach(e=>w.add(`${e.reinscriptionUtxo.txid}:${e.reinscriptionUtxo.vout}`));const v=r.some(e=>e.reinscriptionUtxo),S=r.some(e=>!e.reinscriptionUtxo&&x.length>0),E=r.some(e=>e.reinscriptionUtxo&&(e.parentUtxos?.length>0||e.parentUtxo));if(E||v&&S?(r.forEach(e=>{if(!e.reinscriptionUtxo)return;const t=c.inputCount,i=Math.ceil(e.reinscriptionUtxo.value||0),a={hash:pn(n,"commitTxHashLE"),index:"number"==typeof e.commitVoutIndex?e.commitVoutIndex:r.indexOf(e),sequence:4294967293,witnessUtxo:{script:pn(e.taprootPayment.output,"taprootPayment.output"),value:i},tapLeafScript:[{controlBlock:pn(e.controlBlock,"controlBlock"),leafVersion:e.leafVersion,script:pn(e.witnessScript,"witnessScript")}]};c.addInput(a),u.push({index:t,address:e.taprootPayment.address,disableTweakSigner:!0,tapLeafHash:e.leafHash.toString("hex")})}),x.forEach(n=>{const r=`${n.txid}:${n.vout}`;if(b.has(r))return;if(w.has(r))return;b.add(r);const a=String(n.address||"").trim();let o;if(n.script||n.scriptHex){const e=n.scriptHex||(Buffer.isBuffer(n.script)?n.script.toString("hex"):n.script);o=pn(Buffer.from(e,"hex"),"parent witnessUtxo.script")}else o=pn(xn(e,a,t),"parent witnessUtxo.script");const s=a.startsWith("bc1p")||a.startsWith("tb1p"),l={hash:pn(Buffer.from(n.txid,"hex").reverse(),"parent input hash"),index:n.vout,sequence:4294967293,witnessUtxo:{script:o,value:n.value}};if("string"==typeof l.hash)throw new Error(`Parent input hash must be Buffer, got string: ${l.hash.substring(0,16)}...`);if("number"!=typeof l.index||l.index<0)throw new Error(`Parent input index must be non-negative number, got: ${l.index}`);if(s&&i){const e=64===i.length?i:i.slice(2);l.tapInternalKey=Buffer.from(e,"hex")}const d=c.inputCount;c.addInput(l);const p=f.includes("xverse")&&m?m:a||m||g;u.push({index:d,address:p,sighashType:h}),y.push(n)}),r.forEach(e=>{if(e.reinscriptionUtxo)return;const t=c.inputCount,i=Math.ceil(e.revealFundingValue),a={hash:pn(n,"commitTxHashLE"),index:"number"==typeof e.commitVoutIndex?e.commitVoutIndex:r.indexOf(e),sequence:4294967293,witnessUtxo:{script:pn(e.taprootPayment.output,"taprootPayment.output"),value:i},tapLeafScript:[{controlBlock:pn(e.controlBlock,"controlBlock"),leafVersion:e.leafVersion,script:pn(e.witnessScript,"witnessScript")}]};c.addInput(a),u.push({index:t,address:e.taprootPayment.address,disableTweakSigner:!0,tapLeafHash:e.leafHash.toString("hex")})})):(x.forEach(n=>{const r=`${n.txid}:${n.vout}`;if(b.has(r))return;if(w.has(r))return void Qt.warn(`\u26a0\ufe0f Skipping parent input ${r} because it is also a reinscription target spent in COMMIT`);b.add(r);const a=String(n.address||"").trim();let o;if(n.script||n.scriptHex){const e=n.scriptHex||(Buffer.isBuffer(n.script)?n.script.toString("hex"):n.script);o=pn(Buffer.from(e,"hex"),"parent witnessUtxo.script")}else o=pn(xn(e,a,t),"parent witnessUtxo.script");const s=a.startsWith("bc1p")||a.startsWith("tb1p"),l={hash:pn(Buffer.from(n.txid,"hex").reverse(),"parent input hash"),index:n.vout,sequence:4294967293,witnessUtxo:{script:o,value:n.value}};if("string"==typeof l.hash)throw new Error(`Parent input hash must be Buffer, got string: ${l.hash.substring(0,16)}...`);if("number"!=typeof l.index||l.index<0)throw new Error(`Parent input index must be non-negative number, got: ${l.index}`);if(s&&i){const e=64===i.length?i:i.slice(2);l.tapInternalKey=Buffer.from(e,"hex")}const d=c.inputCount;c.addInput(l);const p=f.includes("xverse")&&m?m:a||m||g;u.push({index:d,address:p,sighashType:h}),y.push(n)}),r.forEach((e,t)=>{const r=c.inputCount,i=e.reinscriptionUtxo?Math.ceil(e.reinscriptionUtxo.value||0):Math.ceil(e.revealFundingValue),a={hash:pn(n,"commitTxHashLE"),index:"number"==typeof e.commitVoutIndex?e.commitVoutIndex:t,sequence:4294967293,witnessUtxo:{script:pn(e.taprootPayment.output,"taprootPayment.output"),value:i},tapLeafScript:[{controlBlock:pn(e.controlBlock,"controlBlock"),leafVersion:e.leafVersion,script:pn(e.witnessScript,"witnessScript")}]};c.addInput(a),u.push({index:r,address:e.taprootPayment.address,disableTweakSigner:!0,tapLeafHash:e.leafHash.toString("hex")})})),l&&r.some(e=>!!e.reinscriptionUtxo)&&"number"==typeof l.commitVoutIndex&&Math.ceil(l.value||0)>0){const e=c.inputCount;c.addInput({hash:pn(n,"commitTxHashLE"),index:l.commitVoutIndex,sequence:4294967293,witnessUtxo:{script:pn(l.taprootPayment.output,"feePool.taprootPayment.output"),value:Math.ceil(l.value||0)},tapLeafScript:[{controlBlock:pn(l.controlBlock,"feePool.controlBlock"),leafVersion:l.leafVersion,script:pn(l.witnessScript,"feePool.witnessScript")}]}),u.push({index:e,address:l.taprootPayment.address,disableTweakSigner:!0,tapLeafHash:l.leafHash.toString("hex")})}E||v&&S?(r.forEach(e=>{if(!e.reinscriptionUtxo)return;const t=Math.ceil(e.reinscriptionUtxo.value||0);if(t<=0)throw new Error("Reinscription target missing valid value");const n=e.recipientAddress||e.reinscriptionUtxo.address;c.addOutput({address:n,value:t}),d.push({address:n,value:t,purpose:"reinscription-output",itemIndex:e.__index})}),y.length>0&&y.forEach(e=>{c.addOutput({address:e.address,value:e.value}),d.push({address:e.address,value:e.value,purpose:"parent-return"})}),sr({bitcoinLib:e,net:t,revealPsbt:c,outputs:d,items:r,commitTxHashLE:n}),r.forEach(e=>{if(e.reinscriptionUtxo)return;const t=Math.ceil(e.postage??a?.postage??546);c.addOutput({address:e.recipientAddress,value:t}),d.push({address:e.recipientAddress,value:t,purpose:"inscription-output",itemIndex:e.__index})})):(y.length>0&&y.forEach(e=>{c.addOutput({address:e.address,value:e.value}),d.push({address:e.address,value:e.value,purpose:"parent-return"})}),sr({bitcoinLib:e,net:t,revealPsbt:c,outputs:d,items:r,commitTxHashLE:n}),r.forEach(e=>{if(!e.reinscriptionUtxo)return;const t=Math.ceil(e.reinscriptionUtxo.value||0);if(t<=0)throw new Error("Reinscription target missing valid value");const n=e.recipientAddress||e.reinscriptionUtxo.address;c.addOutput({address:n,value:t}),d.push({address:n,value:t,purpose:"reinscription-output",itemIndex:e.__index})}),r.forEach(e=>{if(e.reinscriptionUtxo)return;const t=Math.ceil(e.postage??a?.postage??546);c.addOutput({address:e.recipientAddress,value:t}),d.push({address:e.recipientAddress,value:t,purpose:"inscription-output",itemIndex:e.__index})}));const N=E||v&&S;return{psbt:c,base64:c.toBase64(),inputsToSign:u,outputs:d,parentInputCount:y.length,isMixedBatch:N}}async function pr(e){const{wallet:t,network:n="mainnet",strictUtxoValidation:r=!0,onProgress:i=null}=e||{};if(!t)throw new Error("Wallet is required");const a="function"==typeof i?i:()=>{};a({step:1,totalSteps:6,label:"Validate UTXOs",status:"active"});const o=await In(),s=yn(o,n),l=Number(e?.feeRate||0);let c={...e};try{if(r){if(Array.isArray(e.paymentUtxos)&&e.paymentUtxos.length>0){const{unspent:t,spent:n}=await async function(e){const t=[],n=[];for(let r=0;r<e.length;r++){const i=e[r];await or(i.txid,i.vout)?t.push(i):n.push(i),r<e.length-1&&await new Promise(e=>setTimeout(e,50))}return n.length>0&&n.forEach(e=>{}),{unspent:t,spent:n}}(e.paymentUtxos);n.length,c.paymentUtxos=t}if(Array.isArray(e.items)&&e.items.some(e=>e?.reinscriptionUtxo)){const{valid:t,invalid:n}=await async function(e){const t=e.filter(e=>e.reinscriptionUtxo).map(e=>({item:e,txid:e.reinscriptionUtxo.txid,vout:e.reinscriptionUtxo.vout}));if(0===t.length)return{valid:e,invalid:[]};const n=[],r=[];for(const a of t)await or(a.txid,a.vout)?n.push(a.item):r.push(a.item),await new Promise(e=>setTimeout(e,50));const i=e.filter(e=>!e.reinscriptionUtxo);return n.push(...i),r.length,{valid:n,invalid:r}}(e.items);if(n.length>0){const e=n.map(e=>`${e?.reinscriptionUtxo?.txid?.substring(0,12)}:${e?.reinscriptionUtxo?.vout}`).join(", "),t=new Error(`One or more reinscription targets are already spent: ${e}`);throw t.code="REINSCRIPTION_TARGET_SPENT",t}}}}catch(I){throw I}try{const e=Array.isArray(c.paymentUtxos)?c.paymentUtxos:[];if(e.length>0){const t=e.map(e=>e?.address).filter(Boolean);t.length,e.length;const n=new Set(t);if(n.size>1){const e=new Error("Funding UTXOs span multiple addresses. Select UTXOs from a single address/account and retry.");throw e.code="MIXED_FUNDING_ADDRESSES",e.addresses=Array.from(n),e}}}catch(A){throw A}a({step:1,totalSteps:6,label:"Validate UTXOs",status:"done"}),a({step:2,totalSteps:6,label:"Build PSBTs",status:"active"});const u=await async function(e){const{wallet:t,paymentUtxos:n,items:r,changeAddress:i,network:a="mainnet",fees:o,feeRate:s,paymentPublicKey:l=null,ordinalsPublicKey:c=null,batchLimits:u={maxInputs:40,maxVsize:85e3},strictReinscriptionFunding:d=!0}=e||{};if(!t)throw new Error("Wallet is required");if(!Array.isArray(r)||0===r.length)throw new Error("At least one item is required");if(!Array.isArray(n)||0===n.length)throw new Error("Payment UTXOs required");const p=await In(),f=yn(p,a),m=function(e){const t=["commitFee","revealFee","postage","totalRequired"];if(!e||"object"!=typeof e)throw new Error("Fees object is required");for(const n of t)if("number"!=typeof e[n])throw new Error(`Missing or invalid required fee field: ${n}`);if(void 0!==e.platformFee){if("number"!=typeof e.platformFee||e.platformFee<0)throw new Error("platformFee must be a non-negative number");e.platformFee>0&&!e.platformFeeAddress&&Qt.warn("\u26a0\ufe0f platformFee provided but no platformFeeAddress specified")}return e}(o),{normalizedItems:g,sharedOutputItems:h}=function(e,t,n){if(n=n||{},!Array.isArray(e)||0===e.length)throw new Error("At least one item is required");const r=e.map(e=>{const t=e.mode||"standard",n=e.satpoint&&e.satpoint.txid&&void 0!==e.satpoint.vout?{txid:e.satpoint.txid,vout:e.satpoint.vout,offset:Number(e.satpoint.offset||0)}:null,r=e.sharedGroupId||null;return{...e,mode:t,satpoint:n,sharedGroupId:r}});r.forEach((e,t)=>{const n=!(!e.satpoint||!e.satpoint.txid||void 0===e.satpoint.vout),i=e.mode||"";if(n&&"same-sat"!==i){const e=new Error(`SATPOINT_INVALID_MODE: item #${t} provided satpoint but mode is '${i||"unset"}'. satpoint is only valid in 'same-sat' mode.`);throw e.code="SATPOINT_INVALID_MODE",e}if("same-sat"===i){if(r.length>1){const e=new Error(`SAME_SAT_BATCH_UNSUPPORTED: item #${t} in 'same-sat' mode cannot be batched. Use a single-item flow.`);throw e.code="SAME_SAT_BATCH_UNSUPPORTED",e}if(!n){const e=new Error(`SAME_SAT_MISSING_SATPOINT: item #${t} in 'same-sat' mode must include satpoint {txid,vout,offset}`);throw e.code="SAME_SAT_MISSING_SATPOINT",e}if(e.parentUtxo||e.parentUtxos&&e.parentUtxos.length>0){const e=new Error(`SAME_SAT_DISALLOWED_PARENTS: item #${t} cannot use parents in 'same-sat' mode.`);throw e.code="SAME_SAT_DISALLOWED_PARENTS",e}if(e.delegateId){const e=new Error(`SAME_SAT_DISALLOWED_DELEGATION: item #${t} cannot use delegation in 'same-sat' mode.`);throw e.code="SAME_SAT_DISALLOWED_DELEGATION",e}if(!e.reinscriptionUtxo||!e.reinscriptionUtxo.txid||void 0===e.reinscriptionUtxo.vout){const e=new Error(`SAME_SAT_REQUIRES_TARGET: item #${t} must include reinscriptionUtxo matching satpoint in 'same-sat' mode.`);throw e.code="SAME_SAT_REQUIRES_TARGET",e}if(e.satpoint.txid!==e.reinscriptionUtxo.txid||e.satpoint.vout!==e.reinscriptionUtxo.vout){const n=new Error(`SAME_SAT_MISMATCHED_TARGET: item #${t} satpoint ${e.satpoint.txid}:${e.satpoint.vout} does not match reinscriptionUtxo ${e.reinscriptionUtxo.txid}:${e.reinscriptionUtxo.vout}`);throw n.code="SAME_SAT_MISMATCHED_TARGET",n}const i=Number(e.satpoint.offset||0),a=Number(e.reinscriptionUtxo.value||0);if(!Number.isFinite(i)||i<0){const e=new Error(`SAME_SAT_OFFSET_INVALID: item #${t} satpoint.offset must be >= 0`);throw e.code="SAME_SAT_OFFSET_INVALID",e}if(a<=0){const e=new Error(`SAME_SAT_TARGET_VALUE_MISSING: item #${t} reinscriptionUtxo missing value for satpoint validation`);throw e.code="SAME_SAT_TARGET_VALUE_MISSING",e}if(i>=a){const e=new Error(`SAME_SAT_OFFSET_OUT_OF_RANGE: item #${t} satpoint.offset=${i} >= targetValue=${a}`);throw e.code="SAME_SAT_OFFSET_OUT_OF_RANGE",e}}if("shared-output"===i){if(!e.sharedGroupId||0===String(e.sharedGroupId).trim().length){const e=new Error(`SHARED_OUTPUT_MISSING_GROUP: item #${t} in 'shared-output' mode requires non-empty sharedGroupId`);throw e.code="SHARED_OUTPUT_MISSING_GROUP",e}if(e.parentUtxo||e.parentUtxos&&e.parentUtxos.length>0){const e=new Error(`SHARED_OUTPUT_DISALLOWED_PARENTS: item #${t} cannot use parents in 'shared-output' mode.`);throw e.code="SHARED_OUTPUT_DISALLOWED_PARENTS",e}if(e.reinscriptionUtxo){const e=new Error(`SHARED_OUTPUT_DISALLOWED_REINSCRIPTION: item #${t} cannot be a reinscription in 'shared-output' mode.`);throw e.code="SHARED_OUTPUT_DISALLOWED_REINSCRIPTION",e}if(e.delegateId){const e=new Error(`SHARED_OUTPUT_DISALLOWED_DELEGATION: item #${t} cannot use delegation in 'shared-output' mode.`);throw e.code="SHARED_OUTPUT_DISALLOWED_DELEGATION",e}const n=new Error(`SHARED_OUTPUT_NOT_IMPLEMENTED: item #${t} requested shared-output mode; this mode is not available in batch builder`);throw n.code="SHARED_OUTPUT_NOT_IMPLEMENTED",n}if("same-sat"!==e.mode&&e.satpoint){const e=new Error(`SATPOINT_REUSED_BY_STANDARD_ITEM: item #${t} provided satpoint but is not in 'same-sat' mode.`);throw e.code="SATPOINT_REUSED_BY_STANDARD_ITEM",e}if(void 0!==e.pointer&&null!==e.pointer&&String(e.pointer).length>0){const n="number"==typeof e.pointer?e.pointer:Number(String(e.pointer).trim());if(!Number.isInteger(n)||n<0){const e=new Error(`POINTER_INVALID: item #${t} pointer must be a non-negative integer`);throw e.code="POINTER_INVALID",e}if(e.reinscriptionUtxo&&void 0!==e.reinscriptionUtxo.txid){const r=Number(e.reinscriptionUtxo.value||0);if(Number.isFinite(r)&&r>0&&n>=r){const e=new Error(`POINTER_OUT_OF_RANGE: item #${t} pointer (${n}) must be < reinscription target value (${r})`);throw e.code="POINTER_OUT_OF_RANGE",e}}}});const i=new Map;r.forEach((e,t)=>{if(!e.reinscriptionUtxo||void 0===e.reinscriptionUtxo.txid)return;const n=`${e.reinscriptionUtxo.txid}:${e.reinscriptionUtxo.vout}`;if(i.has(n)){const e=i.get(n),r=new Error(`Duplicate reinscription targets: item #${t} shares reinscription target ${n} already used by item #${e}`);throw r.code="REINSCRIPTION_TARGET_REUSED",r}i.set(n,t)}),r.forEach((e,t)=>{if(!e.reinscriptionUtxo||void 0===e.reinscriptionUtxo.txid)return;const n=`${e.reinscriptionUtxo.txid}:${e.reinscriptionUtxo.vout}`;if((Array.isArray(e.parentUtxos)?e.parentUtxos:e.parentUtxo?[e.parentUtxo]:[]).some(e=>`${e.txid}:${e.vout}`===n)){const e=new Error(`REINSCRIPTION_TARGET_AS_PARENT: item #${t} lists reinscription target ${n} as a parent. Use a different parent UTXO or drop the parent reference.`);throw e.code="REINSCRIPTION_TARGET_AS_PARENT",e}});const a=r.map((e,r)=>{const i=Math.ceil((e.inscriptionScript?.length||0)/2),a=Array.isArray(e.parentUtxos)?e.parentUtxos.length:e.parentUtxo?1:0,o=!!e.reinscriptionUtxo,s=Math.max(330,e.postage??n.postage??546),l=e=>{try{return(new TextEncoder).encode(e).length}catch{return Buffer.from(e,"utf8").length}},c="string"==typeof e.metadata?e.metadata:e.metadata?JSON.stringify(e.metadata):"",u="string"==typeof e.properties?e.properties:e.properties?JSON.stringify(e.properties):"",d=!!c&&c.trim().length>0,p=!!u&&u.trim().length>0,f=d?l(c):0,m=p?l(u):0,g=void 0!==e.pointer&&String(e.pointer).length>0,h=!!e.contentEncoding,b=new Set([0,1,2,3,5,7,9,11,17]),y=Array.isArray(e.customTags)?e.customTags.length:e.customTags&&"object"==typeof e.customTags?Object.keys(e.customTags).filter(e=>{const t=Number(e);return Number.isInteger(t)&&t>=0&&t<=255&&!b.has(t)}).length:Array.isArray(e.tags)?e.tags.length:0,x=e.commitFeeRateOverride,w=Hn(i,t,a,{scriptSizeExact:i,hasMetadata:d,metadataSize:f,hasProperties:p,propertiesSize:m,hasPointer:g,hasContentEncoding:h,customTagCount:y,commitFeeRate:x,postage:o?0:s,isReinscription:o}),v=void 0!==e.revealFundingValue&&null!==e.revealFundingValue&&e.revealFundingValue>0,S=o?w.revealFee:v?Number(e.revealFundingValue):w.revealFunding;if(o){const t=Math.ceil(w.revealFee),n=Math.ceil(e.revealFundingValue??w.revealFunding);n>t+100&&(Qt.warn(`\u26a0\ufe0f Item ${r}: Reinscription funding seems too high (${n} sats)`),Qt.warn(`   Expected ~${t} sats (reveal fee only)`),Qt.warn(`   Postage (${e.reinscriptionUtxo.value} sats) comes from target UTXO`))}return{...e,revealFundingValue:S,itemFeeDetail:{scriptSize:i,parentCount:a,isReinscription:o,revealFee:w.revealFee,revealFunding:w.revealFunding,hasMetadata:d,metadataSize:f,hasProperties:p,propertiesSize:m,hasPointer:g,hasContentEncoding:h,customTagCount:y},recipientAddress:e.recipientAddress||e.defaultRecipient,postage:s,__index:r}}),o=a.filter(e=>"shared-output"===e.mode);return{normalizedItems:a,sharedOutputItems:o}}(r,s,m),b=Xn(r.length,r),y=Kn(r.length,r);b.length>0&&(m.platformFee=y,m.platformFeeAddress=b[0].address,m.platformFeeOutputs=b);const x=[];for(let oe=0;oe<g.length;oe++){const e=g[oe],t="undefined"!=typeof globalThis&&globalThis.__TEST_OVERRIDE_BUILD_TAPROOT_ARTIFACTS__?globalThis.__TEST_OVERRIDE_BUILD_TAPROOT_ARTIFACTS__:Pn,n=await t(p,e.inscriptionScript,f),r=Math.ceil((e.inscriptionScript?.length||0)/2),i=Array.isArray(e.parentUtxos)?e.parentUtxos.length:e.parentUtxo?1:0,a=!!e.reinscriptionUtxo,o=e.postage??m.postage??546,l=e=>{try{return(new TextEncoder).encode(e).length}catch{return Buffer.from(e,"utf8").length}},c="string"==typeof e.metadata?e.metadata:e.metadata?JSON.stringify(e.metadata):"",u="string"==typeof e.properties?e.properties:e.properties?JSON.stringify(e.properties):"",d=!!c&&c.trim().length>0,h=!!u&&u.trim().length>0,b=d?l(c):0,y=h?l(u):0,w=void 0!==e.pointer&&String(e.pointer).length>0,v=!!e.contentEncoding,S=new Set([0,1,2,3,5,7,9,11,17]),E=(()=>Array.isArray(e.customTags)?e.customTags.length:e.customTags&&"object"==typeof e.customTags?Object.keys(e.customTags).filter(e=>{const t=Number(e);return Number.isInteger(t)&&t>=0&&t<=255&&!S.has(t)}).length:Array.isArray(e.tags)?e.tags.length:0)(),N=e.commitFeeRateOverride,I=Hn(r,s,i,{scriptSizeExact:r,hasMetadata:d,metadataSize:b,hasProperties:h,propertiesSize:y,hasPointer:w,hasContentEncoding:v,customTagCount:E,commitFeeRate:N,postage:a?0:o,isReinscription:a}),A=void 0!==e.revealFundingValue&&null!==e.revealFundingValue&&e.revealFundingValue>0,k=a?I.revealFee:A?Number(e.revealFundingValue):I.revealFunding;if(x.push({...e,...n,revealFundingValue:k,itemFeeDetail:{scriptSize:r,parentCount:i,isReinscription:a,revealFee:I.revealFee,revealFunding:I.revealFunding,hasMetadata:d,metadataSize:b,hasProperties:h,propertiesSize:y,hasPointer:w,hasContentEncoding:v,customTagCount:E},recipientAddress:e.recipientAddress&&e.recipientAddress.trim()?e.recipientAddress.trim():e.defaultRecipient||n.taprootPayment.address,postage:o,__index:oe}),a){const t=Math.ceil(I.revealFee),n=Math.ceil(e.revealFundingValue??I.revealFunding);n>t+100&&(Qt.warn(`\u26a0\ufe0f Item ${oe}: Reinscription funding seems too high (${n} sats)`),Qt.warn(`   Expected ~${t} sats (reveal fee only)`),Qt.warn(`   Postage (${e.reinscriptionUtxo.value} sats) comes from target UTXO`))}}const w=x.filter(e=>!!e.reinscriptionUtxo),v=x.filter(e=>!e.reinscriptionUtxo),S=w;Qt.debug("\ud83d\udd0d DEBUG reinItemsOrdered:",{count:S.length,items:S.map(e=>({index:e.__index,targetTxid:e.reinscriptionUtxo?.txid?.substring(0,12),targetVout:e.reinscriptionUtxo?.vout,targetValue:e.reinscriptionUtxo?.value,hasUtxo:!!e.reinscriptionUtxo}))});const E=new Map;if(h.length>0){const e=new Map(x.map(e=>[e.__index,e]));for(const n of g){if("shared-output"!==n.mode)continue;const t=e.get(n.__index);E.has(n.sharedGroupId)||E.set(n.sharedGroupId,{items:[],pseudo:null}),E.get(n.sharedGroupId).items.push(t)}const t="undefined"!=typeof globalThis&&globalThis.__TEST_OVERRIDE_BUILD_SHARED_TAPROOT_ARTIFACTS__?globalThis.__TEST_OVERRIDE_BUILD_SHARED_TAPROOT_ARTIFACTS__:Ln;for(const[n,r]of E.entries()){r.items.sort((e,t)=>e.__index-t.__index);const e=r.items.map(e=>e.inscriptionScript),i=await t(p,e,f),a=r.items.reduce((e,t)=>e+Math.ceil(t.revealFundingValue),0);r.pseudo={mode:"shared-output",__sharedGroup:!0,__groupId:n,__groupItems:r.items,__index:r.items[0]?.__index??0,taprootPayment:i.taprootPayment,controlBlock:i.controlBlock,witnessScript:i.witnessScript,leafVersion:i.leafVersion,leafHash:i.leafHash,local:i.local,revealFundingValue:a,postage:0}}}const N=[],I=new Set;for(const oe of v)if("shared-output"===oe.mode){const e=oe.sharedGroupId;if(!I.has(e)){const t=E.get(e);t&&t.pseudo&&(N.push(t.pseudo),I.add(e))}}else N.push(oe);const A=[...S,...N],k=A.map(e=>e.__index),T=S.map(e=>`${e.reinscriptionUtxo.txid}:${e.reinscriptionUtxo.vout}`),C=[],B=A.filter(e=>"shared-output"===e.mode&&e.__sharedGroup),P=function(e){const t=[],n=[];return e.forEach((e,r)=>{const i=e.parentUtxo||e.parentUtxos&&e.parentUtxos.length>0,a=!!e.reinscriptionUtxo,o=!!e.delegateId,s=!!e.etching,l="same-sat"===e.mode;(i||a||o||s||l?n:t).push(e)}),{simple:t,complex:n}}(A.filter(e=>!("shared-output"===e.mode&&e.__sharedGroup))),_=P.simple,O=P.complex,L=O.filter(e=>!!e.reinscriptionUtxo),F=O.filter(e=>!e.reinscriptionUtxo);if(_.length>0){const e=function(e,t={maxInputs:40,maxVsize:85e3}){if(!e||0===e.length)return[];const n=[];let r=[],i=0;for(const a of e){const e=164+(66+(2+Math.ceil((a.inscriptionScript?.length||0)/2))+34)+172;jn(r.length+1,i+e,t.maxInputs,4*t.maxVsize)&&r.length>0?(n.push(r),r=[a],i=40+e):(r.push(a),i+=e)}return r.length>0&&n.push(r),n}(_,u);for(const t of e)C.push({type:"simple-multi",items:t,parentInputCount:0})}if(L.length>0&&C.push({type:1===L.length?"reinscription-single":"reinscription-multi",items:L}),F.length>0){const e=function(e,t={maxInputs:40,maxVsize:85e3}){if(!e||0===e.length)return[];const n=function(e){const t=new Map;return e.forEach(e=>{const n=function(e){if(e.reinscriptionUtxo&&void 0!==e.reinscriptionUtxo.txid)return`REINSCRIPTION:${e.reinscriptionUtxo.txid}:${e.reinscriptionUtxo.vout}`;const t=Array.isArray(e.parentUtxos)?e.parentUtxos:e.parentUtxo?[e.parentUtxo]:[];return 0===t.length?"NO_PARENTS":t.map(e=>`${e.txid}:${e.vout}`).sort().join("|")}(e);t.has(n)||t.set(n,[]),t.get(n).push(e)}),Array.from(t.values())}(e),r=[];for(const i of n){const e=Wn(i).length,n=402*e,a=40,o=172;let s=[],l=a+n;for(const c of i){const i=164+(66+(2+Math.ceil((c.inscriptionScript?.length||0)/2))+34)+o;c.reinscriptionUtxo?(s.length>0&&(r.push(s),s=[],l=a+n),r.push([c])):jn(e+s.length+1,l+i,t.maxInputs,4*t.maxVsize)&&s.length>0?(r.push(s),s=[c],l=a+n+i):(s.push(c),l+=i)}s.length>0&&r.push(s)}return r}(F,u);for(const t of e)C.push({type:1===t.length?"complex-single":"complex-multi",items:t})}if(B.length>0)for(const oe of B)C.push({type:"shared-output",items:[oe],__sharedPseudo:oe,parentInputCount:0});0===C.length&&C.push({type:"multi-all",items:A});const M=e=>{const t=new Set;return(e||[]).forEach(e=>{(Array.isArray(e?.parentUtxos)?e.parentUtxos:[]).forEach(e=>{e&&e.txid&&"number"==typeof e.vout&&t.add(`${e.txid}:${e.vout}`)});const n=e?.parentUtxo;n&&n.txid&&"number"==typeof n.vout&&t.add(`${n.txid}:${n.vout}`)}),t},R=new Map,$=new Map,U=e=>{let t=$.get(e);if(void 0===t)return $.set(e,e),e;if(t===e)return e;const n=U(t);return $.set(e,n),n},z=(e,t)=>{const n=U(e),r=U(t);n!==r&&$.set(r,n)};for(let oe=0;oe<C.length;oe++){const e=M(C[oe].items);if(0!==e.size)for(const t of e)R.has(t)?z(oe,R.get(t)):R.set(t,oe)}const D=new Map;for(let oe=0;oe<C.length;oe++){if(!$.has(oe))continue;const e=U(oe),t=D.get(e)||[];t.push(oe),D.set(e,t)}let H=!1;for(const oe of D.values())if(oe.length>1){H=!0;break}if(H){const e=new Set,t=[];for(let n=0;n<C.length;n++){if(e.has(n))continue;if(!$.has(n)){t.push(C[n]),e.add(n);continue}const r=U(n),i=(D.get(r)||[]).slice().sort((e,t)=>e-t);if(i.forEach(t=>e.add(t)),1===i.length){t.push(C[n]);continue}const a=[];i.forEach(e=>{const t=C[e]?.items;Array.isArray(t)&&a.push(...t)});const o=a.some(e=>!!e?.reinscriptionUtxo)?1===a.filter(e=>!!e?.reinscriptionUtxo).length&&1===a.length?"reinscription-single":"reinscription-multi":1===a.length?"complex-single":"multi-all";Qt.warn(`\u26a0\ufe0f Merging ${i.length} reveal segments because they share at least one parent UTXO input.`),Qt.warn(`   Merged segment type: ${o} (items=${a.length})`),t.push({type:o,items:a})}C.length=0,t.forEach(e=>C.push(e))}const W=C.filter(e=>(e.items||[]).some(e=>!!e.reinscriptionUtxo));if(w.length>0&&1!==W.length){const e=new Error(`Reinscription fee-pool requires exactly 1 segment containing reinscriptions; found ${W.length}. Reduce batch size or increase batchLimits to avoid splitting reinscriptions.`);throw e.code="REINSCRIPTION_FEEPOOL_SPLIT_REQUIRED",e}C.forEach(e=>{if((e.items||[]).some(e=>!!e.reinscriptionUtxo)||!e.items||e.items.length<=1)return;const t=new Set;e.items.forEach(e=>{(Array.isArray(e.parentUtxos)?e.parentUtxos:[]).forEach(e=>{e&&e.txid&&"number"==typeof e.vout&&t.add(`${e.txid}:${e.vout}`)});const n=e.parentUtxo;n&&n.txid&&"number"==typeof n.vout&&t.add(`${n.txid}:${n.vout}`)});const n=t.size;if(0===n)return;if(n>=e.items.reduce((e,t)=>e+(Array.isArray(t.parentUtxos)?t.parentUtxos.length:0)+(t.parentUtxo?1:0),0))return;const r=Dn(e.items.map(e=>{const t=e?.itemFeeDetail?.scriptSize??e?.scriptSizeBytes??0;return Math.max(0,Math.floor(t))}),s,{parentCount:n,includeFeePoolInput:!1,parentInputType:"p2wpkh"}),i=e.items.reduce((e,t)=>e+(t.postage||546),0),a=Math.max(0,Math.ceil(r.fee)),o=e.items.map((t,n)=>{const r=t.postage||546,o=i>0?r/i:1/e.items.length,s=a*o,l=Math.floor(s);return{idx:n,itemPostage:r,floor:l,frac:s-l}});let l=a-o.reduce((e,t)=>e+t.floor,0);l<0&&(l=0),o.sort((e,t)=>{const n=t.frac-e.frac;return 0!==n?n:e.idx-t.idx}).forEach(e=>{l<=0||(e.floor+=1,l-=1)}),o.sort((e,t)=>e.idx-t.idx),o.forEach(t=>{const n=e.items[t.idx],r=t.floor;n.revealFundingValue=t.itemPostage+r,n.itemFeeDetail&&(n.itemFeeDetail.revealFee=r,n.itemFeeDetail.revealFunding=n.revealFundingValue,n.itemFeeDetail.adjustedForSharedParents=!0)}),Qt.info(`\u2705 Adjusted fees for segment with ${e.items.length} items sharing ${n} parents`),Qt.info(`   Batch reveal fee: ${a} sats (${r.vsize} vB @ ${s} sat/vB)`)});let j=0;if(w.length>0){const e=W[0],t=e&&Array.isArray(e.items)&&e.items.length>0?e.items:w,n=new Set(t.filter(e=>!!e.reinscriptionUtxo).map(e=>`${e.reinscriptionUtxo.txid}:${e.reinscriptionUtxo.vout}`)),r=new Set;t.forEach(e=>{(Array.isArray(e.parentUtxos)?e.parentUtxos:[]).forEach(e=>{if(!e||!e.txid||"number"!=typeof e.vout)return;const t=`${e.txid}:${e.vout}`;n.has(t)||r.add(t)})});const i=r.size,a=Dn(t.map(e=>{const t=e?.itemFeeDetail?.scriptSize??e?.scriptSizeBytes??0;return Math.max(0,Math.floor(t))}),s,{parentCount:i,includeFeePoolInput:!0,parentInputType:"p2wpkh"});j=Math.max(0,Math.ceil(a.fee||0)),j>0&&j<330&&(j=330),j>0&&t.forEach(e=>{if(!e||e.reinscriptionUtxo)return;const t=Math.ceil(e.postage??546);e.revealFundingValue=t,e.itemFeeDetail&&(e.itemFeeDetail.revealFee=0,e.itemFeeDetail.revealFunding=t,e.itemFeeDetail.fundedByFeePool=!0)})}const V="undefined"!=typeof globalThis&&globalThis.__TEST_OVERRIDE_BUILD_TAPROOT_FEEPOOL_ARTIFACTS__?globalThis.__TEST_OVERRIDE_BUILD_TAPROOT_FEEPOOL_ARTIFACTS__:_n,q=j>0?{...await V(p,f),value:j,commitVoutIndex:A.length}:null;A.forEach((e,t)=>{e.commitVoutIndex=t}),function({bitcoinLib:e,net:t,commitOrderItems:n,feeRate:r}){const i=(n||[]).filter(e=>e&&e.nxsParcelManifestSelfHint&&!e.reinscriptionUtxo);0!==i.length&&i.forEach(n=>{const i=n.nxsParcelManifestSelfHint||{},a=String(i.indexingAddress||"").trim(),o=Math.ceil(Number(i.feeSats||0));if(!a)throw new Error("nxsParcelManifestSelfHint: indexingAddress is required");if(!Number.isFinite(o)||o<=0)throw new Error("nxsParcelManifestSelfHint: feeSats must be > 0");const s=function({bitcoinLib:e,net:t,indexingAddress:n}){var r,i;return 8+((i=r=e.address.toOutputScript(String(n||"").trim(),t).length)<253?1:i<=65535?3:i<=4294967295?5:9)+r}({bitcoinLib:e,net:t,indexingAddress:a}),l=Math.max(0,Math.ceil(Number(r||0)*s)),c=Math.ceil(n.revealFundingValue||0)+o+l;n.revealFundingValue=c,n.itemFeeDetail&&(n.itemFeeDetail.revealFee=Math.ceil((n.itemFeeDetail.revealFee||0)+l),n.itemFeeDetail.revealFunding=c,n.itemFeeDetail.nxsParcelManifestSelfHint={feeSats:o,extraVbytes:s,extraMinerFeeSats:l})})}({bitcoinLib:p,net:f,commitOrderItems:A,feeRate:s});const X=function(e,t,n,r,i,a,o,s=10,l=null,c=null){const u=new Map;r.forEach((e,t)=>{if(!e.reinscriptionUtxo||void 0===e.reinscriptionUtxo.txid)return;const n=`${e.reinscriptionUtxo.txid}:${e.reinscriptionUtxo.vout}`;if(u.has(n)){const e=u.get(n),r=new Error(`Duplicate reinscription targets: item #${t} shares reinscription target ${n} already used by item #${e}`);throw r.code="REINSCRIPTION_TARGET_REUSED_COMMIT",r}u.set(n,t)});const d=r.filter(e=>!e.reinscriptionUtxo).reduce((e,t)=>e+Math.ceil(t.revealFundingValue),0),p=l?Math.ceil(l.value||0):0,f=[],m=new Set;for(const Y of r)if(Y.reinscriptionUtxo&&void 0!==Y.reinscriptionUtxo.txid){const e=`${Y.reinscriptionUtxo.txid}:${Y.reinscriptionUtxo.vout}`;m.has(e)||(m.add(e),f.push(Y.reinscriptionUtxo))}const g=f.length,h=f.reduce((e,t)=>e+(t.value||0),0),b=r.filter(e=>!!e.reinscriptionUtxo).reduce((e,t)=>e+(t.reinscriptionUtxo?.value||0),0),y=new Map;r.forEach(e=>{if(!e.reinscriptionUtxo)return;const t=`${e.reinscriptionUtxo.txid}:${e.reinscriptionUtxo.vout}`;y.has(t)||y.set(t,[]),y.get(t).push(e)});const x=Array.from(y.entries()).filter(([e,t])=>t.length>1);x.length>0&&(Qt.warn("\ud83d\udce6 Detected multiple items referencing the same reinscription UTXO (should be blocked earlier):"),x.forEach(([e,t])=>{Qt.warn(`   ${e}: ${t.length} items`)}));const w=new e.Psbt({network:t}),v=[],S=[],E=a.platformFeeOutputs&&Array.isArray(a.platformFeeOutputs)?a.platformFeeOutputs.reduce((e,t)=>e+Math.ceil(t.value),0):Math.ceil(a.platformFee||0),N=new Set(f.map(e=>`${e.txid}:${e.vout}`)),I=[...n].filter(e=>!N.has(`${e.txid}:${e.vout}`)).sort((e,t)=>e.value-t.value),A=[];let k=0;const T=r.length+(E>0?a.platformFeeOutputs?.length||1:0);function C(e,t){const n=Un(e,T+(t?1:0),!0,0,{isReveal:!1});return Math.ceil(n*s)}let B=!0;const P=I.filter(e=>!N.has(`${e.txid}:${e.vout}`)).sort((e,t)=>t.value-e.value),_=b+d+p+E;for(const Y of P){const e=_+C(1+g,!0);if(Y.value>=e){A.push(Y),k+=Y.value;const e=I.findIndex(e=>e.txid===Y.txid&&e.vout===Y.vout);e>=0&&I.splice(e,1),B=!1;break}}for(;B;){const e=I.shift();if(!e){const e=A.length,t=b+d+p+E,n=C(e+g,!0),r=t+n;throw Qt.error(`\u274c Insufficient payment UTXOs:\n  - Commit outputs need: ${t} sats\n    * Target output value (per item): ${b} sats\n    * Target inputs provided: ${h} sats (from ${g} unique reinscription targets)\n    * Normal reveal funding: ${d} sats\n    * Reinscription fee pool: ${p} sats\n    * Platform fees: ${E} sats\n  - Commit fee: ${n} sats\n  - Total need: ${r} sats\n  - Have: ${k} sats from ${e} payment UTXOs\n  - Missing: ${r-k} sats`),new Error(`Insufficient funds: need ${r} sats, have ${k} sats (missing ${r-k} sats)`)}A.push(e),k+=e.value;const t=A.length,n=C(t+g,!1),r=b+d+p+E;if(k>=r+n){const e=k+h-r-n;if(e>0&&e<546&&I.length>0&&k+h<r+C(t+g,!0)+546)continue;B=!1}}let O=0;new Set(A.map(e=>`${e.txid}:${e.vout}`));const L=r.filter(e=>!!e.reinscriptionUtxo);f.forEach(e=>{const t=A.findIndex(t=>t.txid===e.txid&&t.vout===e.vout);t>=0&&A.splice(t,1)});const F=[...A].sort((e,t)=>e.value-t.value);function M(n,r="payment"){let i,a={};const s=(n.address||"").toString();if("target"===r)if(n.scriptHex)i=pn(Buffer.from(n.scriptHex,"hex"),"reinscription witnessUtxo.script");else{if(!s)throw new Error("Reinscription target requires scriptHex or address");i=e.address.toOutputScript(s,t)}else if(o&&s.startsWith("3")){const n=Buffer.from(o,"hex"),r=e.payments.p2wpkh({pubkey:n,network:t});i=e.payments.p2sh({redeem:r,network:t}).output,a.redeemScript=r.output}else if(i=e.address.toOutputScript(s,t),(s.startsWith("bc1p")||s.startsWith("tb1p")||s.startsWith("bcrt1p"))&&c)try{const e=64===c.length?c:c.slice(2);a.tapInternalKey=Buffer.from(e,"hex")}catch(l){}w.addInput({hash:pn(Buffer.from(n.txid,"hex").reverse(),"commit input hash"),index:n.vout,sequence:4294967293,witnessUtxo:{script:i,value:n.value},...a}),v.push({index:O,address:n.address}),S.push({txid:n.txid,vout:n.vout,value:n.value,label:r,isTarget:N.has(`${n.txid}:${n.vout}`)}),O+=1}const R=new Set;if(L.length>0){for(let e=0;e<L.length;e++){const t=L[e].reinscriptionUtxo;if(!t)continue;const n=`${t.txid}:${t.vout}`;R.has(n)||(M(t,"target"),R.add(n))}F.forEach(e=>M(e,"payment"))}else A.forEach(e=>M(e,"payment"));k=A.reduce((e,t)=>e+t.value,0);const $=r.filter(e=>!e.reinscriptionUtxo);if(L.forEach((e,t)=>{const n=e.reinscriptionUtxo;if(!n||!n.value)throw new Error("Reinscription item missing valid target UTXO value");const r=Math.ceil(n.value),i=r;if(r<=0)throw new Error("Reinscription target value must be positive");if(void 0!==e.pointer&&null!==e.pointer){const n="number"==typeof e.pointer?e.pointer:parseInt(e.pointer);if(!isNaN(n)&&n>=r)throw new Error(`Batch item ${t}: CRITICAL sat alignment error!\nPointer ${n} >= target UTXO value ${r}\nPointer must be < ${r} to stay within original UTXO's sat range.`)}w.addOutput({address:e.taprootPayment.address,value:i})}),$.forEach(e=>{w.addOutput({address:e.taprootPayment.address,value:Math.ceil(e.revealFundingValue)})}),l&&p>0&&w.addOutput({address:l.taprootPayment.address,value:p}),a.platformFeeOutputs&&Array.isArray(a.platformFeeOutputs))a.platformFeeOutputs.forEach(e=>{w.addOutput({address:e.address,value:Math.ceil(e.value)})});else if("number"==typeof a.platformFee&&a.platformFee>0){const e=a.platformFeeAddress||i;w.addOutput({address:e,value:Math.ceil(a.platformFee)})}const U=w.txOutputs.reduce((e,t)=>e+t.value,0),z=k+h,D=A.length+g,H=w.txOutputs.length,W=[...Array.from({length:g},()=>"p2tr"),...A.map(e=>(e=>{const t=String(e||"").trim().toLowerCase();return t?t.startsWith("bc1p")||t.startsWith("tb1p")||t.startsWith("bcrt1p")?"p2tr":t.startsWith("bc1q")||t.startsWith("tb1q")||t.startsWith("bcrt1q")?"p2wpkh":t.startsWith("3")||t.startsWith("2")?"p2sh-p2wpkh":"p2wpkh":"p2wpkh"})(e.address))],j=function(e,t,n,r,i,a=546){const o=i(e,t),s=n-r-o.fee;if(s<=a){const e=n-r,t=o.vsize>0?e/o.vsize:o.achievedFeeRate;return{shouldAddChange:!1,changeValue:0,fee:e,vsize:o.vsize,achievedFeeRate:t,requestedFeeRate:o.requestedFeeRate,dustReason:s<0?`Insufficient funds (need ${-s} more sats)`:`Change would be ${s} sats (below ${a} dust)`}}const l=i(e,t+1),c=n-r-l.fee;if(c<=a){const e=n-r,t=o.vsize>0?e/o.vsize:o.achievedFeeRate;return{shouldAddChange:!1,changeValue:0,fee:e,vsize:o.vsize,achievedFeeRate:t,requestedFeeRate:o.requestedFeeRate,dustReason:`Change would be ${c} sats after fee increase (below ${a} dust)`}}return{shouldAddChange:!0,changeValue:c,fee:l.fee,vsize:l.vsize,achievedFeeRate:l.achievedFeeRate,requestedFeeRate:l.requestedFeeRate}}(D,H,z,U,(e,t)=>function(e,t,n,r={}){const i=Un(e,t,!0,0,{isReveal:!1,...r}),a=Math.ceil(i*n);return{fee:a,vsize:i,achievedFeeRate:a/i,requestedFeeRate:n}}(D,t,s,{inputTypes:W,parentInputType:"p2wpkh"}),546);if(j.shouldAddChange&&j.changeValue>0)w.addOutput({address:i,value:j.changeValue});else if(j.dustReason&&j.dustReason.startsWith("Insufficient funds"))throw new Error(`Insufficient funds for commit: ${j.dustReason}`);const V=j.fee,q=j.vsize,X=j.changeValue||0,K=j.achievedFeeRate;Math.abs(K-s)>.05&&Qt.warn(`\u26a0\ufe0f Commit fee rate deviation: requested ${s} sat/vB, achieved ${K.toFixed(2)} sat/vB`);const G=z-U-V;return(X>0||G!==X)&&(Qt.debug(`\ud83e\uddee Commit accounting:\n  totalInputsValue=${z} sats\n  sumOutputsBeforeChange=${U} sats\n  finalCommitFee=${V} sats\n  expectedChange=${G} sats\n  changeOutputAdded=${X} sats\n  feeRateAchieved=${K.toFixed(2)} sat/vB`),X!==G&&Qt.debug(`   \u21aa\ufe0f Delta (expectedChange - changeOutput) = ${G-X} sats treated as implicit fee pad / rounding`)),r.forEach((e,t)=>{const n=e.reinscriptionUtxo?e.reinscriptionUtxo.value:0,r=Math.ceil(e.revealFundingValue),i=e.recipientAddress||e.taprootPayment.address,a=n>0?n:r,o=n>0?`${n} (target passthrough) -> ${i}`:`${r} (postage+revealFee) -> ${i}`;Qt.debug(`   \u2022 Commit output #${t}: ${a} sats = ${o}`)}),{psbt:w,base64:w.toBase64(),inputsToSign:v,revealFundingValues:r.map(e=>e.revealFundingValue),commitFee:V,commitVsize:q,achievedFeeRate:K,selectedInputs:A}}(p,f,n,A,i||n[0].address,m,l,s,q,c);if(d)try{const e=[],t=w.length;A.forEach(t=>{const n=t.reinscriptionUtxo?Math.ceil(t.reinscriptionUtxo.value||0):Math.ceil(t.revealFundingValue);e.push(n)});for(let n=0;n<e.length;n++){const r=X.psbt.txOutputs[n];if(!r)throw new Error(`Missing commit output #${n}`);const i=e[n];if(r.value!==i)throw new Error(`Strict check failed: commit output #${n} (${n<t?"reinscription":"normal"}) value=${r.value} != expected=${i}`)}if(q){const e=X.psbt.txOutputs[q.commitVoutIndex];if(!e)throw new Error(`Missing reinscription fee-pool output #${q.commitVoutIndex}`);const t=Math.ceil(q.value||0);if(e.value!==t)throw new Error(`Strict check failed: fee-pool output value=${e.value} != expected=${t}`)}}catch(ae){const e=new Error(`REINSCRIPTION_STRICT_CHECK_FAILED (commit): ${ae.message}`);throw e.code="REINSCRIPTION_STRICT_MISMATCH_COMMIT",e}const K=p.Psbt.fromBase64(X.base64,{network:f}).data.globalMap.unsignedTx.tx.getHash(),G=(n||[]).some(e=>{const t=(e?.address||"").toLowerCase();return t.startsWith("1")||t.startsWith("3")||t.startsWith("2")||t.startsWith("m")||t.startsWith("n")});let Y=X,J=K;if(G){const e=lr(X.psbt,"commit (pre-sign)"),n=X.psbt.toHex(),r=await t.signPsbt(n,{autoFinalized:!0,toSignInputs:X.inputsToSign}),i=p.Psbt.fromHex(r,{network:f});cr({expectedUnsignedTxid:e,psbt:i,label:"commit (post-sign)"});try{i.finalizeAllInputs()}catch{}const a=i.extractTransaction(),o=a.getId();J=Buffer.from(a.getHash()),Y={psbt:i,base64:i.toBase64(),txHex:a.toHex(),txId:o,inputsToSign:X.inputsToSign}}const Q=new Set(A.filter(e=>e.reinscriptionUtxo&&void 0!==e.reinscriptionUtxo.txid).map(e=>`${e.reinscriptionUtxo.txid}:${e.reinscriptionUtxo.vout}`)),Z=[];function ee({bitcoinLib:e,network:t,commitTxHashLE:n,pseudo:r}){const i=new e.Psbt({network:t}),a=[],o=[];return i.addInput({hash:pn(n,"commitTxHashLE"),index:"number"==typeof r.commitVoutIndex?r.commitVoutIndex:0,sequence:4294967293,witnessUtxo:{script:pn(r.taprootPayment.output,"taprootPayment.output"),value:Math.ceil(r.revealFundingValue)},tapLeafScript:[{controlBlock:pn(r.controlBlock,"controlBlock"),leafVersion:r.leafVersion,script:pn(r.witnessScript,"witnessScript")}]}),a.push({index:0,address:r.taprootPayment.address,disableTweakSigner:!0,tapLeafHash:r.leafHash.toString("hex")}),(r.__groupItems||[]).forEach(e=>{const t=Math.ceil(e.postage);i.addOutput({address:e.recipientAddress,value:t}),o.push({address:e.recipientAddress,value:t,purpose:"inscription-output",itemIndex:e.__index})}),{psbt:i,base64:i.toBase64(),inputsToSign:a,outputs:o}}for(let oe=0;oe<C.length;oe++){const e=C[oe],n=e.items;if("simple-multi"===e.type){const e=ur({bitcoinLib:p,network:f,commitTxHashLE:J,items:n});Z.push({type:"simple-multi",...e,itemIndexes:n.map(e=>e.__index),parentInputCount:0});continue}if("shared-output"===e.type){const t=e.__sharedPseudo||n[0],r=ee({bitcoinLib:p,network:f,commitTxHashLE:J,pseudo:t});Z.push({type:"shared-output",...r,itemIndexes:(t.__groupItems||[]).map(e=>e.__index),parentInputCount:0,__sharedPseudo:t});continue}const r=dr({bitcoinLib:p,network:f,commitTxHashLE:J,items:n,ordinalsPublicKey:c,fees:m,wallet:t,globalReinscriptionTargets:Q,reinscriptionFeePool:q});Z.push({type:"multi-all"===e.type?"multi-all":"reinscription-single"===e.type||"reinscription-multi"===e.type?e.type:1===n.length?"complex-single":"complex-multi",...r,itemIndexes:n.map(e=>e.__index),isMixedBatch:r.isMixedBatch})}try{const e=new Set,t=pn(J,"commitTxHashLE");for(let n=0;n<Z.length;n++){const r=Z[n],i=r?.psbt?.data?.globalMap?.unsignedTx?.tx,a=i?.ins;if(Array.isArray(a))for(const n of a){if(!n||!Buffer.isBuffer(n.hash))continue;if(n.hash.equals(t))continue;const r=`${Buffer.from(n.hash).reverse().toString("hex")}:${n.index}`;if(e.has(r)){const e=new Error(`PARENT_INPUT_REUSED_ACROSS_REVEALS: outpoint ${r} appears in multiple reveal segments`);throw e.code="PARENT_INPUT_REUSED_ACROSS_REVEALS",e}e.add(r)}}}catch(ae){throw ae}if(1===Z.length&&"multi-all"===Z[0].type){const e=Z[0];if(d)try{for(let e=0;e<A.length;e++){const t=A[e].taprootPayment.address,n=X.psbt.txOutputs[e]?.script;if(!n)throw new Error(`Missing commit output script at index ${e}`);const r=p.address.fromOutputScript(n,f);if(t!==r)throw new Error(`Commit output order mismatch at index ${e}: expected ${t}, got ${r}`)}}catch(ae){const e=new Error(`COMMIT_OUTPUT_ORDER_MISMATCH: ${ae.message}`);throw e.code="COMMIT_OUTPUT_ORDER_MISMATCH",e}if(d)try{const t=A.filter(e=>!!e.reinscriptionUtxo),n=(e.outputs||[]).filter(e=>"reinscription-output"===e.purpose);if(n.length!==t.length)throw new Error(`Reinscription output count mismatch: found ${n.length}, expected ${t.length}`);t.forEach(e=>{const t=n.find(t=>t.itemIndex===e.__index);if(!t)throw new Error(`Missing reinscription output for item #${e.__index}`);const r=Math.ceil(e.reinscriptionUtxo.value||0);if(t.value!==r)throw new Error(`Strict check failed: item #${e.__index} reinscription output value=${t.value} != expected=${r}`)})}catch(ae){const e=new Error(`REINSCRIPTION_STRICT_CHECK_FAILED (reveal): ${ae.message}`);throw e.code="REINSCRIPTION_STRICT_MISMATCH_REVEAL",e}}if(d)try{Z.forEach((e,t)=>{if(!Array.isArray(e.itemIndexes)||0===e.itemIndexes.length)return;if("shared-output"===e.type)return;const n=e.itemIndexes.map(e=>A.find(t=>t.__index===e)).filter(e=>e&&e.reinscriptionUtxo);if(0===n.length)return;const r=(Array.isArray(e.outputs)?e.outputs:[]).filter(e=>"reinscription-output"===e.purpose);if(r.length!==n.length)throw new Error(`Segment ${t} reinscription outputs=${r.length} != expected=${n.length}`);n.forEach((e,n)=>{const i=r[n],a=Math.ceil(e.reinscriptionUtxo.value||0);if(!i)throw new Error(`Segment ${t} missing reinscription output #${n}`);if(i.value!==a)throw new Error(`Segment ${t} reinscription output #${n} value=${i.value} != expected=${a}`)})})}catch(ae){const e=new Error(`REINSCRIPTION_STRICT_MISMATCH_SEGMENT: ${ae.message}`);throw e.code="REINSCRIPTION_STRICT_MISMATCH_SEGMENT",e}const te=[J,K].filter(Boolean),ne=e=>te.some(t=>((e,t)=>{if(!Buffer.isBuffer(e)||!Buffer.isBuffer(t))return!1;if(e.equals(t))return!0;const n=(r=t,Buffer.isBuffer(r)&&32===r.length?Buffer.from(r).reverse():null);var r;return!!n&&e.equals(n)})(e,t)),re=[];for(let oe=0;oe<Z.length;oe++){const e=Z[oe],t=e.psbt,n=t?.data?.globalMap?.unsignedTx?.tx;if(!n||!Array.isArray(n.ins))throw new Error(`Missing unsignedTx.ins for reveal segment ${oe}`);if("shared-output"===e.type){const t=e.__sharedPseudo.commitVoutIndex,r=n.ins.findIndex(e=>e.index===t&&Buffer.isBuffer(e.hash)&&ne(e.hash));if(-1===r)throw new Error(`Shared-output segment ${oe}: no input spends commit vout ${t}`);e.itemIndexes.forEach(e=>{re.push({itemIndex:e,segment:oe,inputIndex:r})})}else e.itemIndexes.forEach(e=>{const t=A.find(t=>t.__index===e);if(!t)throw new Error(`Item #${e} not found in commitOrderItems`);const r="number"==typeof t.commitVoutIndex?t.commitVoutIndex:A.indexOf(t),i=n.ins.findIndex(e=>e.index===r&&Buffer.isBuffer(e.hash)&&ne(e.hash));if(-1===i)throw new Error(`Reveal seg ${oe}: no input spends commit vout ${r} for item #${e}`);re.push({itemIndex:e,segment:oe,inputIndex:i})})}if(re.length!==g.length)throw new Error(`Mapping mismatch: ${re.length} mapped items vs ${g.length} original items`);try{A.forEach((e,t)=>{const n="number"==typeof e.commitVoutIndex?e.commitVoutIndex:t,r=X.psbt.txOutputs[n];if(!r)throw new Error(`Missing commit output at vout ${n} (item #${e.__index})`);const i=e.reinscriptionUtxo?Math.ceil(e.reinscriptionUtxo.value||0):Math.ceil(e.revealFundingValue);if(r.value!==i)throw new Error(`Commit vout ${n} value=${r.value} != expected=${i} (item #${e.__index})`);const a=p.address.toOutputScript(e.taprootPayment.address,f),o=pn(r.script,"commit.txOut.script");if(!a.equals(o)){const t=e.taprootPayment.address,r=p.address.fromOutputScript(o,f);throw new Error(`Commit vout ${n} script addr=${r} != expected addr=${t} (item #${e.__index})`)}})}catch(ae){const e=new Error(`COMMIT_OUTPUT_MISMATCH: ${ae.message}`);throw e.code="COMMIT_OUTPUT_MISMATCH",e}try{Z.forEach((e,t)=>{const n=e.psbt,r=n?.data?.globalMap?.unsignedTx?.tx;if(r&&Array.isArray(r.ins)){if("shared-output"===e.type){const n=e.__sharedPseudo.commitVoutIndex;if(-1===r.ins.findIndex(e=>e.index===n&&Buffer.isBuffer(e.hash)&&ne(e.hash)))throw new Error(`Reveal seg ${t}: no input spends commit vout ${n} (shared-output group)`);return}e.itemIndexes.forEach(e=>{const n=A.find(t=>t.__index===e);if(!n)throw new Error(`Item #${e} not found in commitOrderItems`);const i="number"==typeof n.commitVoutIndex?n.commitVoutIndex:A.indexOf(n),a=r.ins.findIndex(e=>e.index===i&&Buffer.isBuffer(e.hash)&&ne(e.hash));if(-1===a)throw new Error(`Reveal seg ${t}: no input spends commit vout ${i} (item #${e})`);const o=r.ins[a];if(o.index!==i)throw new Error(`Reveal seg ${t} input ${a} prevoutIndex=${o.index} != expectedCommitVout=${i} (item #${e})`)})}else Qt.warn(`\u26a0\ufe0f Skipping prevout index check for seg ${t} (no unsignedTx.ins)`)})}catch(ae){const e=new Error(`REVEAL_INPUT_INDEX_MISMATCH: ${ae.message}`);throw e.code="REVEAL_INPUT_INDEX_MISMATCH",e}const ie=x.map(e=>({itemIndex:e.__index,revealFee:e.itemFeeDetail?.revealFee,revealFunding:e.itemFeeDetail?.revealFunding,scriptSize:e.itemFeeDetail?.scriptSize}));return{commit:Y,reveals:Z,mapping:re,feeSummary:ie,limits:u,enrichedItems:x,commitOrder:k,reinscriptionOrder:T}}(c);let{commit:d,reveals:p,mapping:f,enrichedItems:m}=u;const g=t?.walletType||t?.name?.toLowerCase()||"",h="function"==typeof t.signPsbts&&"magiceden"!==g;"magiceden"===g&&t.signPsbts;let b=d.txId,y=d.txHex,x=d.psbt;const w=[];if(a({step:2,totalSteps:6,label:"Build PSBTs",status:"done"}),a({step:3,totalSteps:6,label:"Sign PSBTs",status:"active",detail:"signing only, not broadcasting"}),h&&!y){const e=(()=>{try{return o.Psbt.fromBase64(d.base64,{network:s})}catch{return null}})();if(!e)throw new Error("Commit PSBT could not be parsed for signing");const n=[lr(e,"commit (pre-batch-sign)")],r=[(()=>{try{return e.toHex()}catch{return d.base64}})()],i=[{autoFinalized:!0,toSignInputs:(d.inputsToSign||[]).map(e=>({index:e.index,address:e.address,useTweakedSigner:e.address?.startsWith("bc1p")||e.address?.startsWith("tb1p")}))}],l=[];for(let t=0;t<p.length;t++){const e=p[t],a=o.Psbt.fromBase64(e.base64,{network:s}),c=(()=>{try{return a.toHex()}catch{return e.base64}})(),u=(e.inputsToSign||[]).filter(e=>!e.tapLeafHash&&"number"==typeof e.index);u.length>0&&(r.push(c),l.push(t),n.push(lr(a,`reveal ${t} (pre-batch-sign)`)),i.push({autoFinalized:!1,toSignInputs:u.map(e=>({index:e.index,address:e.address,useTweakedSigner:!0}))}))}const c=await V(t,r,i);if(a({step:3,totalSteps:6,label:"Sign PSBTs",status:"done"}),a({step:4,totalSteps:6,label:"Finalize",status:"active"}),c.length!==n.length)throw new Error(`Wallet returned ${c.length} signed PSBTs, expected ${n.length}`);const u=c[0];x=(()=>{try{return o.Psbt.fromHex(u,{network:s})}catch{return o.Psbt.fromBase64(u,{network:s})}})(),cr({expectedUnsignedTxid:n[0],psbt:x,label:"commit (post-batch-sign)"});const g=x.data.inputs.length;if(x.data.inputs.filter(e=>e.finalScriptWitness||e.finalScriptSig).length<g)for(let t=0;t<g;t++){const e=x.data.inputs[t];if(!e.finalScriptWitness&&!e.finalScriptSig)try{e.tapInternalKey||e.tapMerkleRoot?x.finalizeInput(t,Fn):x.finalizeInput(t)}catch(k){throw new Error(`Commit input ${t} finalization failed: ${k.message}`)}}const h=x.extractTransaction();b=h.getId(),y=h.toHex(),d={...d,psbt:x,signedBase64:x.toBase64(),signedHex:x.toHex(),txHex:y,txId:b};let v=1;for(let t=0;t<p.length;t++){const e=p[t];let r=o.Psbt.fromBase64(e.base64,{network:s});if(l.includes(t)){const i=c[v];r=(()=>{try{return o.Psbt.fromHex(i,{network:s})}catch{return o.Psbt.fromBase64(i,{network:s})}})(),cr({expectedUnsignedTxid:n[v],psbt:r,label:`reveal ${t} (post-batch-sign)`}),v++,(e.inputsToSign||[]).filter(e=>!e.tapLeafHash&&"number"==typeof e.index)}if("shared-output"===e.type){const t=e.__sharedPseudo,n=t?.leafHash,i=t?.local?.privateKey;if(!n||!i)throw new Error("Missing composite leafHash or private key for shared-output segment");await Bn(0,r,0,i,n),r.finalizeInput(0,Rn)}else if("complex-single"!==e.type){const n=(e.inputsToSign||[]).filter(e=>!e.tapLeafHash&&"number"==typeof e.index);for(const e of n){const t=e.address&&(e.address.startsWith("bc1q")||e.address.startsWith("tb1q"))?Mn:Fn;try{r.finalizeInput(e.index,t)}catch{}}const i=new Set;for(let o=0;o<e.itemIndexes.length;o++){const n=e.itemIndexes[o],a=m.find(e=>e.__index===n)||{},s=a.leafHash,l=a.local?.privateKey;if(!s||!l)throw new Error("Missing leafHash or local private key for multi-item segment");const c=(f||[]).find(e=>e.itemIndex===n&&e.segment===t),u="number"==typeof c?.inputIndex?c.inputIndex:void 0;if("number"!=typeof u)throw new Error(`Mapping not found for itemIndex ${n} in segment ${t}`);await Bn(0,r,u,l,s),r.finalizeInput(u,Rn),i.add(u)}const a=(e.inputsToSign||[]).filter(e=>e.tapLeafHash&&"number"==typeof e.index&&!i.has(e.index));if(a.length>0){const e=m.find(e=>e?.local?.privateKey)?.local?.privateKey;if(!e)throw new Error("Missing local private key for extra tapscript inputs");for(const t of a){const n=Buffer.from(String(t.tapLeafHash),"hex");await Bn(0,r,t.index,e,n),r.finalizeInput(t.index,Rn)}}}else{const t=(e.inputsToSign||[]).find(e=>e.tapLeafHash);if(t&&"number"==typeof t.index){const n=e.itemIndexes[0],i=m.find(e=>e.__index===n)||{},a=i.leafHash,o=i.local?.privateKey;if(!a||!o)throw new Error("Missing leafHash or local private key for complex segment");await Bn(0,r,t.index,o,a)}const n=(e.inputsToSign||[]).filter(e=>!e.tapLeafHash&&"number"==typeof e.index);for(const e of n){const t=e.address&&(e.address.startsWith("bc1q")||e.address.startsWith("tb1q"))?Mn:Fn;try{r.finalizeInput(e.index,t)}catch{}}t&&"number"==typeof t.index&&r.finalizeInput(t.index,Rn)}const i=r.extractTransaction();w.push({segment:t,txHex:i.toHex(),txId:i.getId(),psbt:r,psbtHex:r.toHex(),psbtBase64:r.toBase64()}),p[t]={...e,signedBase64:r.toBase64(),signedHex:r.toHex(),txHex:i.toHex(),txId:i.getId()}}}else{if(!y){const e=(()=>{try{return o.Psbt.fromBase64(d.base64,{network:s}).toHex()}catch{return d.base64}})(),n=[{autoFinalized:!0,toSignInputs:(d.inputsToSign||[]).map(e=>({index:e.index,address:e.address,useTweakedSigner:e.address?.startsWith("bc1p")||e.address?.startsWith("tb1p")}))}],[r]=await V(t,[e],n);x=(()=>{try{return o.Psbt.fromHex(r,{network:s})}catch{return o.Psbt.fromBase64(r,{network:s})}})();const i=x.data.inputs.length;if(x.data.inputs.filter(e=>e.finalScriptWitness||e.finalScriptSig).length<i)for(let t=0;t<i;t++){const e=x.data.inputs[t];if(!e.finalScriptWitness&&!e.finalScriptSig)try{e.tapInternalKey||e.tapMerkleRoot?x.finalizeInput(t,Fn):x.finalizeInput(t)}catch(k){throw new Error(`Commit input ${t} finalization failed: ${k.message}. This usually means the wallet didn't sign the input properly.`)}}const a=x.extractTransaction();b=a.getId(),y=a.toHex(),d={...d,psbt:x,signedBase64:x.toBase64(),signedHex:x.toHex(),txHex:y,txId:b}}a({step:3,totalSteps:6,label:"Sign PSBTs",status:"done"}),a({step:4,totalSteps:6,label:"Finalize",status:"active"});for(let e=0;e<p.length;e++){const n=p[e];let r=o.Psbt.fromBase64(n.base64,{network:s});const i=(n.inputsToSign||[]).filter(e=>!e.tapLeafHash&&"number"==typeof e.index);if(i.length>0){const e=(()=>{try{return r.toHex()}catch{return n.base64}})(),a=[{autoFinalized:!1,toSignInputs:i.map(e=>({index:e.index,address:e.address,useTweakedSigner:!0}))}],[l]=await V(t,[e],a);r=(()=>{try{return o.Psbt.fromHex(l,{network:s})}catch{return o.Psbt.fromBase64(l,{network:s})}})()}if("shared-output"===n.type){const e=n.__sharedPseudo,t=e?.leafHash,i=e?.local?.privateKey;if(!t||!i)throw new Error("Missing composite leafHash or private key for shared-output segment");await Bn(0,r,0,i,t),r.finalizeInput(0,Rn)}else if("complex-single"!==n.type){const t=(n.inputsToSign||[]).filter(e=>!e.tapLeafHash&&"number"==typeof e.index);for(const e of t){const t=e.address&&(e.address.startsWith("bc1q")||e.address.startsWith("tb1q"))?Mn:Fn;try{r.finalizeInput(e.index,t)}catch{}}const i=new Set;for(let o=0;o<n.itemIndexes.length;o++){const t=n.itemIndexes[o],a=m.find(e=>e.__index===t)||{},s=a.leafHash,l=a.local?.privateKey;if(!s||!l)throw new Error("Missing leafHash or local private key for multi-item segment");const c=(f||[]).find(n=>n.itemIndex===t&&n.segment===e),u="number"==typeof c?.inputIndex?c.inputIndex:void 0;if("number"!=typeof u)throw new Error(`Mapping not found for itemIndex ${t} in segment ${e}`);await Bn(0,r,u,l,s),r.finalizeInput(u,Rn),i.add(u)}const a=(n.inputsToSign||[]).filter(e=>e.tapLeafHash&&"number"==typeof e.index&&!i.has(e.index));if(a.length>0){const e=m.find(e=>e?.local?.privateKey)?.local?.privateKey;if(!e)throw new Error("Missing local private key for extra tapscript inputs");for(const t of a){const n=Buffer.from(String(t.tapLeafHash),"hex");await Bn(0,r,t.index,e,n),r.finalizeInput(t.index,Rn)}}}else{const e=(n.inputsToSign||[]).find(e=>e.tapLeafHash);if(e&&"number"==typeof e.index){const t=n.itemIndexes[0],i=m.find(e=>e.__index===t)||{},a=i.leafHash,o=i.local?.privateKey;if(!a||!o)throw new Error("Missing leafHash or local private key for complex segment");await Bn(0,r,e.index,o,a)}const t=(n.inputsToSign||[]).filter(e=>!e.tapLeafHash&&"number"==typeof e.index);for(const n of t){const e=n.address&&(n.address.startsWith("bc1q")||n.address.startsWith("tb1q"))?Mn:Fn;try{r.finalizeInput(n.index,e)}catch{}}e&&"number"==typeof e.index&&r.finalizeInput(e.index,Rn)}const a=r.extractTransaction();w.push({segment:e,txHex:a.toHex(),txId:a.getId(),psbt:r,psbtHex:r.toHex(),psbtBase64:r.toBase64()}),p[e]={...n,signedBase64:r.toBase64(),signedHex:r.toHex(),txHex:a.toHex(),txId:a.getId()}}}a({step:4,totalSteps:6,label:"Finalize",status:"done"}),a({step:5,totalSteps:6,label:"Broadcast commit",status:"active",detail:"all signed, now broadcasting"});const v=[y,...w.map(e=>e.txHex)],S=[];for(let T=0;T<v.length;T++){const e=v[T].length/2;e>4e5&&S.push({index:T,label:0===T?"Commit":`Reveal #${T}`,sizeBytes:e,sizeKB:(e/1e3).toFixed(1)})}if(S.length>0){const e=S.map(e=>`${e.label} (${e.sizeKB} KB)`).join(", ");return a({step:5,totalSteps:6,label:"Broadcast commit",status:"skipped",detail:"too large, use Slipstream"}),a({step:6,totalSteps:6,label:"Broadcast reveals",status:"skipped",detail:"too large, use Slipstream"}),{success:!0,method:"no_broadcast_oversized",oversizedTx:!0,oversizedDetails:S,commitTxId:null,revealTxIds:[],commitTxHex:y,revealTxHexes:w.map(e=>e.txHex),mapping:f,warning:`Transaction(s) exceed 400 KB standard relay limit (${e}). Broadcast skipped \u2014 submit manually via MARA Slipstream or similar service.`}}const E=[];let N="sequential";if("undefined"!=typeof window&&!zt()&&window.NexusBitcoinProxy&&window.NexusBitcoinProxy.isEnabled())try{const e=await window.NexusBitcoinProxy.broadcastPackage(v);let t,n;if(e&&e.commit&&e.reveal?(t=e.commit.txid,n=e.reveal.txid):e&&e.commitTxId&&e.revealTxId&&(t=e.commitTxId,n=e.revealTxId),!t||!n)throw new Error("Unexpected package relay response format");E.push(t,n),N="bitcoin_proxy_package_relay",a({step:5,totalSteps:6,label:"Broadcast commit",status:"done"}),a({step:6,totalSteps:6,label:"Broadcast reveals",status:"done"})}catch(k){Qt.warn("Package relay failed, falling back to sequential broadcast:",k?.message)}if(0===E.length){const e=w.some(e=>{const t=e.psbt||(e.psbtHex?(()=>{try{return o.Psbt.fromHex(e.psbtHex,{network:s})}catch{return o.Psbt.fromBase64(e.psbtHex,{network:s})}})():null);return!!t&&t.txOutputs.some(e=>e.value<330)});e&&l>0&&(Qt.warn("\u26a0\ufe0f DUST POLICY WARNING: Transaction has outputs < 330 sats with non-zero fees."),Qt.warn("   Bitcoin nodes will reject this. Solutions:"),Qt.warn("   1. Use postage >= 330 sats (recommended)"),Qt.warn("   2. Set fee rate to 0 (risky, may never confirm)"));const r=await rr(t,{txHex:y,psbtBase64:x?.toBase64?.()},n,"commit");if(!r)return a({step:5,totalSteps:6,label:"Broadcast commit",status:"done",detail:"failed"}),{success:!1,method:N,commitTxId:null,revealTxIds:[],error:e&&l>0?"Commit broadcast failed: dust output with non-zero fee (Bitcoin policy violation)":"Commit broadcast failed",manualBroadcast:{commitTxHex:y,revealTxHexes:w.map(e=>e.txHex)}};E.push(r),a({step:5,totalSteps:6,label:"Broadcast commit",status:"done"}),a({step:6,totalSteps:6,label:"Broadcast reveals",status:"active"});for(const i of w){const e=i.psbt?.toBase64?.(),r=e?{txHex:i.txHex,psbtBase64:e}:i.txHex,a=await rr(t,r,n,"reveal");a&&E.push(a)}a({step:6,totalSteps:6,label:"Broadcast reveals",status:"done"})}return{success:E.length>=1+w.length||E.length>=2,method:N,commitTxId:E[0],revealTxIds:E.slice(1),commitTxHex:y,revealTxHexes:w.map(e=>e.txHex),mapping:f,warning:E.length<1+w.length?"Some reveal txids missing - check mempool manually":void 0}}function fr(e){const t=new AbortController,n=setTimeout(()=>t.abort(),e);return{signal:t.signal,cancel:()=>clearTimeout(n)}}function mr(e){const t="number"==typeof e?e:Number(e);return Number.isFinite(t)?t:null}async function gr({timeoutMs:e=8e3}={}){await async function(){if("undefined"!=typeof window&&window.__NEXUS_ORDINALS_ORIGIN_PROMISE__)try{await window.__NEXUS_ORDINALS_ORIGIN_PROMISE__}catch{}}();const t=kt("/r/blockheight"),n=await async function(e,{timeoutMs:t=8e3}={}){const{signal:n,cancel:r}=fr(t);try{const t=await fetch(e,{signal:n,cache:"no-store"}),r=await t.text().catch(()=>"");if(!t.ok)throw new Error(`HTTP ${t.status}${r?`: ${r}`:""}`);return r}finally{r()}}(t,{timeoutMs:e}),r=Number(String(n).trim());if(!Number.isFinite(r)||r<=0)throw new Error("Unexpected /r/blockheight response");const i=kt(`/r/blockinfo/${r}`),a=await async function(e,{timeoutMs:t=8e3}={}){const{signal:n,cancel:r}=fr(t);try{const t=await fetch(e,{signal:n,cache:"no-store"});if(!t.ok){const e=await t.text().catch(()=>"");throw new Error(`HTTP ${t.status}${e?`: ${e}`:""}`)}return await t.json()}finally{r()}}(i,{timeoutMs:e}),o=mr(a?.min_fee_rate)??mr(a?.minimum_fee_rate)??1,s=Array.isArray(a?.feerate_percentiles)?a.feerate_percentiles.map(mr):[],l=s[0]??null,c=s[2]??null,u=s[4]??null,d=mr(a?.average_fee_rate)??null,p=function({slow:e,medium:t,fast:n,minimumFee:r}){const i=mr(r)??1,a=Math.max(i,mr(e)??i),o=Math.max(a,mr(t)??a);return{slow:a,medium:o,fast:Math.max(o,mr(n)??o),minimumFee:i}}({slow:l??c??d??o,medium:c??d??o,fast:u??c??d??o,minimumFee:o});return{...p,economyFee:p.slow,isDefault:!1,provider:"ordinals /r/blockinfo",blockHeight:r,raw:{feerate_percentiles:a?.feerate_percentiles,average_fee_rate:a?.average_fee_rate,min_fee_rate:a?.min_fee_rate}}}const hr=Object.freeze(Object.defineProperty({__proto__:null,fetchFeeRatesFromOrdinals:gr},Symbol.toStringTag,{value:"Module"}));async function br(e,{timeoutMs:t=12e3}={}){const{signal:n,cancel:r}=function(e){const t=new AbortController,n=setTimeout(()=>t.abort(),e);return{signal:t.signal,cancel:()=>clearTimeout(n)}}(t);try{const t=await fetch(e,{signal:n});if(!t.ok){const e=await t.text().catch(()=>"");throw new Error(`HTTP ${t.status} ${t.statusText}${e?`: ${e}`:""}`)}return await t.json()}finally{r()}}function yr(e="mainnet"){const t=String(e||"mainnet").toLowerCase();return"testnet"===t?"testnet":"signet"===t||"regtest"===t?"signet":"mainnet"}function xr(e){return"testnet"===e?"/testnet/api":"signet"===e?"/signet/api":"/api"}async function wr(e,t="mainnet"){const n=`${"testnet"===yr(t)?"https://blockstream.info/testnet":"https://blockstream.info"}/api/address/${e}/utxo`;return function(e,t){return Array.isArray(e)?e.map(e=>({txid:e.txid,vout:e.vout,value:"number"==typeof e.value?e.value:Number(e.value)||0,address:t,status:e.status||null})):[]}(await br(n,{timeoutMs:12e3}),e)}async function vr(e,t="mainnet"){if("mainnet"!==t)throw new Error("blockchain.info only supports mainnet in this fallback");const n=`https://blockchain.info/unspent?active=${encodeURIComponent(e)}&limit=1000`,r=await br(n,{timeoutMs:15e3});return(Array.isArray(r?.unspent_outputs)?r.unspent_outputs:[]).map(t=>({txid:t.tx_hash_big_endian,vout:t.tx_output_n,value:"number"==typeof t.value?t.value:Number(t.value)||0,address:e,status:{confirmed:!0,block_height:void t.confirmations}}))}async function Sr(e,t="mainnet"){if("mainnet"!==t)throw new Error("blockchair fallback only wired for mainnet");const n=`https://api.blockchair.com/bitcoin/dashboards/address/${encodeURIComponent(e)}?limit=0`,r=await br(n,{timeoutMs:15e3}),i=r?.data?.[e]?.utxo;if(!Array.isArray(i))throw new Error("Blockchair: unexpected response");return i.map(t=>({txid:t.transaction_hash,vout:t.index,value:"number"==typeof t.value?t.value:Number(t.value)||0,address:e,status:{confirmed:!0,block_height:t.block_id??null}}))}async function Er(e,t="mainnet"){let n;new Map([[wr,"blockstream.info (esplora)"],[Sr,"blockchair.com"],[vr,"blockchain.info"]]);for(const i of[wr,Sr,vr])try{return await i(e,t)}catch(r){n=r}throw n||new Error("Failed to fetch UTXOs (direct)")}async function Nr(e="mainnet"){const t=yr(e),n=Tt(`${xr(t)}/v1/fees/recommended`);try{const e=await br(n,{timeoutMs:1e4});return{fast:Number(e.fastestFee)||25,medium:Number(e.halfHourFee)||15,slow:Number(e.hourFee)||10,minimumFee:Number(e.minimumFee)||1,economyFee:Number(e.economyFee)||void 0,isDefault:!1,provider:"mempool.space"}}catch(r){try{const e=await gr({timeoutMs:8e3});return{fast:Number(e.fast)||25,medium:Number(e.medium)||15,slow:Number(e.slow)||10,minimumFee:Number(e.minimumFee)||1,economyFee:Number(e.economyFee)||void 0,isDefault:!1,provider:e.provider||"ordinals /r/blockinfo"}}catch(i){}const t=("testnet"===e?"https://blockstream.info/testnet":"https://blockstream.info")+"/api/fee-estimates",n=await br(t,{timeoutMs:1e4});return{fast:Number(n[1])||Number(n[2])||25,medium:Number(n[3])||Number(n[4])||15,slow:Number(n[6])||Number(n[10])||10,minimumFee:1,isDefault:!1,provider:"blockstream.info"}}}async function Ir(e,t="mainnet"){const n=Array.isArray(e)?e:[e],r=yr(t),i=await Promise.all(n.map(async e=>({addr:e,utxos:await Er(e,r)}))),a=await Promise.all(i.map(async({addr:e,utxos:t})=>{try{const n=await async function(e,t="mainnet"){const n=yr(t),r=Tt(`${xr(n)}/address/${e}/txs/mempool`),i=await br(r,{timeoutMs:12e3});return Array.isArray(i)?i:[]}(e,r),i=function({confirmedUtxos:e,mempoolTxs:t,address:n}){const r=new Map;for(const o of e)o&&o.txid&&"number"==typeof o.vout&&r.set(`${o.txid}:${o.vout}`,o);const i=new Set,a=[];for(const o of t||[]){const e=o?.txid,t=Array.isArray(o?.vin)?o.vin:[],s=Array.isArray(o?.vout)?o.vout:[];for(const n of t){const e=n?.txid||n?.prevout?.txid,t="number"==typeof n?.vout?n.vout:n?.prevout?.vout;if(!e||"number"!=typeof t)continue;const a=`${e}:${t}`;r.has(a)&&(i.add(a),r.delete(a))}if(e)for(let r=0;r<s.length;r++){const t=s[r];if((t?.scriptpubkey_address||t?.scriptPubKey?.address||t?.address)!==n)continue;const i="number"==typeof t?.value?t.value:Number(t?.value)||0;a.push({txid:e,vout:"number"==typeof t?.n?t.n:r,value:i,address:n,status:{confirmed:!1}})}}return{confirmedAdjusted:Array.from(r.values()),mempoolUtxos:a,spentOutpoints:i}}({confirmedUtxos:t,mempoolTxs:n,address:e});return{addr:e,utxos:[...i.confirmedAdjusted,...i.mempoolUtxos],overlayApplied:!0,overlaySpent:i.spentOutpoints.size,overlayCreated:i.mempoolUtxos.length}}catch{return{addr:e,utxos:t,overlayApplied:!1,overlaySpent:0,overlayCreated:0}}})),o=a.flatMap(e=>e.utxos),s={};for(const c of o)c&&c.txid&&"number"==typeof c.vout&&(s[`${c.txid}:${c.vout}`]=c.address);const l=await Nr(t);return{utxos:o,addresses:n,addressCount:n.length,addressUtxoMap:s,fees:l,providers:{utxos:"blockstream.info (confirmed) + mempool.space (mempool overlay) + fallbacks (direct)",fees:`${l.provider||"mempool.space"} (direct)`},overlay:a.map(e=>({address:e.addr,applied:e.overlayApplied,spentRemoved:e.overlaySpent,unconfirmedAdded:e.overlayCreated})),cached:!1,fetchedAt:(new Date).toISOString(),source:"direct"}}const Ar=Object.freeze(Object.defineProperty({__proto__:null,fetchCompleteWalletDataDirect:Ir,fetchFeeRatesDirect:Nr,fetchUtxosDirect:Er},Symbol.toStringTag,{value:"Module"})),kr=3e5;let Tr="COMPLETE-v1";const Cr=(()=>{try{return window.sessionStorage}catch{return null}})(),Br=new Map;function Pr(e){return`${Tr}:${e}`}function _r(e){return function(e){const t=Pr(e);if(Br.has(t)){const e=Br.get(t);if(e._cacheTimestamp&&Date.now()-e._cacheTimestamp>kr){if(Br.delete(t),Cr)try{Cr.removeItem(t)}catch{}return}return e}if(Cr){const e=Cr.getItem(t);if(e)try{const n=JSON.parse(e);return n._cacheTimestamp&&Date.now()-n._cacheTimestamp>kr?void Cr.removeItem(t):(Br.set(t,n),n)}catch{}}}(`complete:${e}`)}function Or(e,t){!function(e,t){const n=Pr(e),r={...t,_cacheTimestamp:Date.now()};if(Br.set(n,r),Cr)try{Cr.setItem(n,JSON.stringify(r))}catch{}}(`complete:${e}`,t)}async function Lr(e,t={}){const{forceRefresh:r=!1,progressCallback:i,network:a}=t,o=Array.isArray(e)?e:[e],s=o.sort().join(",");if(!r){const e=_r(s);if(e)return i&&i({status:"cached",message:`Loaded from cache: ${e.utxos?.length||0} UTXOs`}),{...e,cached:!0}}i&&i({status:"fetching",message:"Fetching wallet data..."});const l=a||"undefined"!=typeof window&&window.__NEXUS_NETWORK__||"mainnet";if(function(){if("undefined"==typeof window)return{sandboxed:!1,storageAccess:!1,origin:null,frameSandboxAttr:null};Ut();let e=null;try{e=window.location?.origin??null}catch{e=null}let t=null;try{const e=window.frameElement;t=e&&e.getAttribute?e.getAttribute("sandbox"):null}catch{t="unreadable"}}(),zt())try{i&&i({status:"fetching",message:`Fetching UTXOs from ${o.length} address(es) via public APIs...`});const e=await Ir(o,l);return Or(s,e),{...e,cached:!1}}catch(c){}if(!window.NexusBitcoinProxy?.isEnabled())throw new Error("Unable to fetch wallet data: direct public API unavailable and Bitcoin Proxy not available.");try{i&&i({status:"fetching",message:`Fetching UTXOs from ${o.length} address(es) and fee rates...`});const e=await window.NexusBitcoinProxy.getUtxosWithFees(o);if((!Array.isArray(e?.utxos)||0===e.utxos.length)&&o.length>0)try{const e=await Ir(o,l);if(e?.utxos&&Array.isArray(e.utxos)&&e.utxos.length>0)return Or(s,e),{...e,cached:!1}}catch(u){}const t=e?.addressUtxoMap&&"object"==typeof e.addressUtxoMap?e.addressUtxoMap:{},r=(Array.isArray(e?.utxos)?e.utxos:[]).map(e=>{const n=e?.txid,r=e?.vout;if(e?.address)return e;if(!n&&""!==n)return e;if(!Number.isInteger(r)&&"number"!=typeof r)return e;const i=t[`${n}:${r}`];return i?{...e,address:i}:e}),a="93c4e4e66b508a36a4ed390cc674997e9e1b96d5a17785ca8081f09a8dbb3134",c=e.utxos?.filter(e=>e.txid===a)||[];c.length>0&&c.forEach(e=>{});const{filterPendingUtxos:d,getPendingUtxoCount:p}=await n(async()=>{const{filterPendingUtxos:e,getPendingUtxoCount:t}=await Promise.resolve().then(()=>ek);return{filterPendingUtxos:e,getPendingUtxoCount:t}},__VITE_PRELOAD__);let f=r,m=0;for(const n of o){const e=f.length;f=d(f,n),m+=e-f.length}const g={utxos:f,addresses:e.addresses||o,addressCount:e.addressCount||o.length,addressUtxoMap:t,fees:e.fees,providers:e.providers,cached:!1,fetchedAt:(new Date).toISOString(),pendingUtxosFiltered:m};return Or(s,g),i&&i({status:"success",message:`\u2705 Loaded ${g.utxos?.length||0} UTXOs from ${o.length} address(es)`}),g}catch(tn){const{isPopupBlocked:t,showPopupBlockedNotificationMinimal:r}=await n(async()=>{const{isPopupBlocked:e,showPopupBlockedNotificationMinimal:t}=await Promise.resolve().then(()=>Rr);return{isPopupBlocked:e,showPopupBlockedNotificationMinimal:t}},__VITE_PRELOAD__);throw t(tn)?(r("Please allow popups to fetch UTXOs (or switch to manual entry)."),i&&i({status:"error",message:"\ud83d\udeab Popup blocked \u2014 allow popups or paste UTXOs manually."})):i&&i({status:"error",message:`Error: ${tn.message}`}),tn}}const Fr=Object.freeze(Object.defineProperty({__proto__:null,bumpCompleteDataCache:function(e=""){Tr=`COMPLETE-v1:${Date.now()}${e?":"+e:""}`},clearCachedCompleteData:function(e){!function(e){const t=Pr(e);if(Br.delete(t),Cr)try{Cr.removeItem(t)}catch{}}(`complete:${e}`)},fetchCompleteWalletData:Lr,getCachedCompleteData:_r,setCachedCompleteData:Or},Symbol.toStringTag,{value:"Module"}));function Mr(e={}){const{includeLocalServerTip:t=!0,customMessage:n}=e,r=document.createElement("div");r.style.cssText="\n    position: fixed;\n    top: 20px;\n    right: 20px;\n    max-width: 400px;\n    background: #ff4757;\n    color: white;\n    padding: 20px;\n    border-radius: 8px;\n    box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n    z-index: 10000;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    font-size: 14px;\n    line-height: 1.5;\n  ";const i=t?'<div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.3); font-size: 12px;">\n      <strong>Alternative:</strong> Run a local server instead of file://\n    </div>':"",a=n?`<div style="margin: 8px 0 0 0; font-size: 13px;">${n}</div>`:"";return r.innerHTML=`\n    <div style="display: flex; align-items: center; margin-bottom: 12px;">\n      <span style="font-size: 24px; margin-right: 10px;">\ud83d\udeab</span>\n      <strong style="font-size: 16px;">Popup Blocked</strong>\n    </div>\n    <div style="margin-bottom: 12px;">${n||"Please allow popups to use Bitcoin Proxy features:"}</div>\n    <ol style="margin: 0 0 12px 20px; padding: 0;">\n      <li>Click the popup blocked icon (\ud83d\udeab) in your address bar</li>\n      <li>Select "Always allow popups"</li>\n      <li>Refresh and try again</li>\n    </ol>\n    ${i}\n    ${a}\n    <button id="closePopupNotification" style="\n      margin-top: 12px;\n      background: white;\n      color: #ff4757;\n      border: none;\n      padding: 8px 16px;\n      border-radius: 4px;\n      cursor: pointer;\n      font-weight: 600;\n      width: 100%;\n    ">\n      Got it\n    </button>\n  `,r.querySelector("#closePopupNotification").onclick=()=>r.remove(),setTimeout(()=>r.remove(),3e4),r}const Rr=Object.freeze(Object.defineProperty({__proto__:null,createPopupBlockedUI:Mr,isPopupBlocked:function(e){if(!e)return!1;const t=e.message||String(e);return t.includes("Popup blocked")||t.includes("popup blocked")},showPopupBlockedNotificationMinimal:function(e){const t=document.getElementById("nexus-popup-blocked-notification");t&&t.remove();const n=Mr({includeLocalServerTip:!1,customMessage:e});return n.id="nexus-popup-blocked-notification",document.body.appendChild(n),n}},Symbol.toStringTag,{value:"Module"})),$r=21e4,Ur=new Set([330,546,1e3,1e4]),zr=new Map;let Dr=function(){const e="NX-UTXO-v1",t="undefined"!=typeof window&&window.NexusBitcoinProxy?.endpointVersion||"";return t?`${e}:${t}`:e}();const Hr=(()=>{try{return"undefined"==typeof window?null:window.sessionStorage}catch{return null}})();function Wr(e){return`${Dr}:${e}`}function jr(e){const t=Wr(e);if(zr.has(t))return zr.get(t);if(Hr){const e=Hr.getItem(t);if(e)try{const n=JSON.parse(e);return zr.set(t,n),n}catch{}}}function Vr(e,t){const n=Wr(e);if(zr.set(n,t),Hr)try{Hr.setItem(n,JSON.stringify(t))}catch{}}function qr(e){return jr(`utxo:result:${e}`)}async function Xr(){return async function(e){return new Promise(t=>setTimeout(t,e))}(40+80*Math.random())}async function Kr(e,t={},n=5e3){const r=new AbortController,i=setTimeout(()=>r.abort(),n);try{return await fetch(e,{...t,signal:r.signal})}finally{clearTimeout(i)}}async function Gr(e){const t=`ord:tx:${e}`,n=jr(t);if(void 0!==n)return n;const{ok:r,status:i,text:a}=await async function(e){let t=0;for(;;)try{const t=await Kr(e);if(!t.ok)return{ok:!1,status:t.status,text:null};const n=await t.text();return{ok:!0,status:t.status,text:n}}catch(n){if(t>=2)return{ok:!1,status:0,text:null};t++,await Xr()}}(kt(`/r/tx/${e}`)),o=r?{ok:r,status:i,hex:a}:{ok:r,status:i,hex:null};return Vr(t,o),o}function Yr(e){const{height:t,offsetInBlock:n}=(e=>{let t=e;for(let n=0;n<64;n++){const e=n*$r,r=Math.floor(5e9/Math.pow(2,n));if(r<=0)break;const i=$r*r;if(t<i)return{height:e+Math.floor(t/r),offsetInBlock:t%r,subsidy:r};t-=i}return{height:0,offsetInBlock:0,subsidy:0}})(e),r=Math.floor(t/126e4),i=t%$r,a=t%2016,o=`${r}\xb0${i}\u2032${a}\u2033${n}\u2034`;return 0===t&&0===n?{rarity:"mythic",degree:o}:0===n?t%126e4==0&&r>0?{rarity:"legendary",degree:o}:0===i?{rarity:"epic",degree:o}:0===a?{rarity:"rare",degree:o}:{rarity:"uncommon",degree:o}:{rarity:"common",degree:o}}function Jr(e,t=!1){if(!e||0===e.length)return{hasRareSats:!1,rarities:[],allSats:[]};const n=e=>{let t=e;for(let n=0;n<64;n++){const e=n*$r,r=Math.floor(5e9/Math.pow(2,n));if(r<=0)break;const i=$r*r;if(t<i)return{height:e+Math.floor(t/r),offsetInBlock:t%r,subsidy:r};t-=i}return{height:0,offsetInBlock:0,subsidy:0}},r=(e,t,r=8)=>{const i=[];if(!Number.isFinite(e)||!Number.isFinite(t)||t<=e)return i;let a=e;for(let o=0;o<r;o++){const e=n(a);if(!e.subsidy)return i;let r=a+(e.subsidy-e.offsetInBlock);if(0===e.offsetInBlock&&(r=a+e.subsidy),r>=t)break;i.push(r),a=r}return i},i=[],a=[];let o=!1;for(const[s,l]of e)if(t)for(let e=s;e<l;e++){const t=Yr(e);a.push({sat:e,...t}),"common"!==t.rarity&&(o=!0,i.push({sat:e,...t}))}else{const e=Yr(s),t=Yr(l-1);if(i.push({sat:s,...e}),i.push({sat:l-1,...t}),"common"!==e.rarity||"common"!==t.rarity)o=!0;else{const e=r(s,l);if(e.length){o=!0;for(const t of e){const e=Yr(t);i.push({sat:t,...e})}}}}return{hasRareSats:o,rarities:i,allSats:a}}function Qr(e){if(!e||"string"!=typeof e)return{hasWitnessData:!1,hasOpReturn:!1,possibleAlkanes:!1,possibleProtoRunes:!1,hasEnvelope:!1,hasGenericData:!1,inscriptions:[]};const t="0001"===e.substring(8,12),n=e.match(/6a[0-9a-f]{2,}/g)||[],r=n.length>0,i=n.some(e=>e.length>20),a=e.includes("6a5d"),o=/0063.*?68/.test(e)||e.includes("6f7264"),s=r&&!o&&!a&&!i,l=[];if(o&&t){const t=e.match(/0063036f7264[0-9a-f]+?68/gi)||[];for(const e of t)try{const t=e.match(/036f7264(.{2,}?)00/);if(t){const n=t[1];let r="";for(let e=0;e<n.length;e+=2){const t=parseInt(n.substr(e,2),16);t>0&&(r+=String.fromCharCode(t))}l.push({contentType:r||"application/octet-stream",hasMetadata:e.includes("05")||e.includes("07"),rawEnvelope:e})}}catch(c){}}return{hasWitnessData:t,hasOpReturn:r,possibleAlkanes:i,possibleProtoRunes:a,hasEnvelope:o,hasGenericData:s,inscriptions:l}}async function Zr(e,t,r=0){const i=`${e}:${t}`,a=`check:${i}`,o=jr(a);if(o)return o;const s=Ur.has(r)||r<1e3,l={isSafe:!0,hasInscriptions:!1,hasRunes:!1,hasSatRanges:!1,hasRareSats:!1,hasAdvancedProtocols:!1,hasGenericData:!1,isSameSat:!1,inscriptionCount:0,inscriptionIds:[],details:{},error:null,notIndexed:!1,verified:!1};try{const r=await async function(e){const t=`ord:utxo:${e}`,n=jr(t);if(void 0!==n)return n;const{ok:r,status:i,json:a}=await async function(e){let t=0;for(;;)try{const t=await Kr(e);if(!t.ok)return{ok:!1,status:t.status,json:null};const n=await t.json().catch(()=>null);return null==n?{ok:!1,status:t.status,json:null}:{ok:!0,status:t.status,json:n}}catch{if(t>=2)return{ok:!1,status:0,json:null};t++,await Xr()}}(kt(`/r/utxo/${e}`)),o=r?{ok:r,status:i,data:a}:{ok:r,status:i,data:null};return Vr(t,o),o}(i);if(!r.ok&&404===r.status){if(l.notIndexed=!0,!s)return l.verified=!0,l.isSafe=!0,Vr(a,l),l;const t=await Gr(e);if(!t.ok||!t.hex)return l.error="Cannot verify (no TX hex available)",l.isSafe=!1,Vr(a,l),l;const n=Qr(t.hex);return l.details.protocols=n,n.inscriptions&&n.inscriptions.length>0&&(l.details.inscriptionData=n.inscriptions,l.hasInscriptions=!0),n.hasEnvelope||n.possibleProtoRunes?(l.hasAdvancedProtocols=!0,l.isSafe=!1,Vr(a,l),l):n.possibleAlkanes||n.hasGenericData?(l.hasGenericData=!0,l.isSafe=!0,l.verified=!0,Vr(a,l),l):(l.isSafe=!0,l.verified=!0,Vr(a,l),l)}if(!r.ok)throw new Error(`Ord API error ${r.status}`);const o=r.data||{},{validateOrdinalsUtxoData:c}=await n(async()=>{const{validateOrdinalsUtxoData:e}=await Promise.resolve().then(()=>nk);return{validateOrdinalsUtxoData:e}},__VITE_PRELOAD__),u=c(o,{txid:e,vout:t});u.warnings.length;const d=u.isValid?u.correctedData:o;if(l.details.utxoData=d,l.details.validationWarnings=u.warnings,l.hasInscriptions=!!d.inscriptions?.length,l.hasRunes=!(!d.runes||!Object.keys(d.runes).length),l.hasSatRanges=!!d.sat_ranges?.length,d.inscriptions?.length>1?(l.isSameSat=!0,l.inscriptionCount=d.inscriptions.length,l.inscriptionIds=d.inscriptions):1===d.inscriptions?.length&&(l.inscriptionCount=1,l.inscriptionIds=d.inscriptions),l.hasInscriptions||l.hasRunes)return l.isSafe=!1,Vr(a,l),l;if(l.hasSatRanges){const e=Jr(d.sat_ranges);if(l.hasRareSats=e.hasRareSats,l.details.rarityAnalysis=e,e.hasRareSats)return l.isSafe=!1,Vr(a,l),l}if(s){const t=await Gr(e);if(!t.ok||!t.hex)return l.isSafe=!0,l.verified=!0,Vr(a,l),l;const n=Qr(t.hex);if(l.details.protocols=n,n.inscriptions&&n.inscriptions.length>0&&(l.details.inscriptionData=n.inscriptions,l.hasInscriptions=!0),n.hasEnvelope||n.possibleProtoRunes)return l.hasAdvancedProtocols=!0,l.isSafe=!1,Vr(a,l),l;if(n.possibleAlkanes)return l.hasGenericData=!0,l.isSafe=!0,l.verified=!0,Vr(a,l),l;if(n.hasGenericData)return l.hasGenericData=!0,l.isSafe=!0,l.verified=!0,Vr(a,l),l}return l.isSafe=!0,l.verified=!0,Vr(a,l),l}catch(c){return l.error=c?.message||"unknown error",l.isSafe=!1,Vr(a,l),l}}async function ei(e,t){const n=[],r=[];let i=0;const a=e.slice(),o=Array(Math.min(20,Math.max(1,e.length))).fill(0).map(async function(){for(;a.length>0;){const o=a.shift();if(!o)break;if(o.value<330){r.push({...o,reason:"Dust (< 330 sats)",dangerous:!1}),i++,t&&t({current:i,total:e.length,percentage:Math.round(i/e.length*100)});continue}if(await Xr(),o.inscriptions?.length||o.runes&&Object.keys(o.runes).length||o.sat_ranges?.length){const a=!!o.sat_ranges?.length&&Jr(o.sat_ranges).hasRareSats;if(o.inscriptions?.length||o.runes&&Object.keys(o.runes).length||a){const e=o.inscriptions?.length>1,t=a?"Has rare sats":e?`Contains ${o.inscriptions.length} inscriptions (same-sat)`:"Contains assets";r.push({...o,reason:t,dangerous:!0,isSameSat:e,inscriptionCount:o.inscriptions?.length||0,inscriptionIds:o.inscriptions||[]})}else n.push({...o,verified:!0,checkedAt:Date.now(),safetyReason:"Proxy-indexed clean"});i++,t&&t({current:i,total:e.length,percentage:Math.round(i/e.length*100)});continue}const s=await Zr(o.txid,o.vout,o.value);if(s.isSafe){const e=s.hasGenericData?"Generic data only":s.notIndexed?"Not indexed (clean)":"Verified clean";n.push({...o,verified:!0,checkedAt:Date.now(),safetyReason:e})}else{const e=s.hasInscriptions&&s.isSameSat?`Contains ${s.inscriptionCount} inscriptions (same-sat)`:s.hasInscriptions?"Has inscriptions":s.hasRunes?"Has runes":s.hasRareSats?"Has rare sats":s.hasAdvancedProtocols?"Has advanced protocols":s.error||"Contains assets";r.push({...o,reason:e,dangerous:!0,assetCheck:s,isSameSat:s.isSameSat||!1,inscriptionCount:s.inscriptionCount||0,inscriptionIds:s.inscriptionIds||[]})}i++,t&&t({current:i,total:e.length,percentage:Math.round(i/e.length*100)})}});await Promise.all(o);const s=n.reduce((e,t)=>e+t.value,0),l=r.reduce((e,t)=>e+t.value,0),c={};return n.forEach(e=>{const t=e.address||"unknown";c[t]||(c[t]=[]),c[t].push(e)}),{spendable:n,unsafe:r,spendableByAddress:c,totalSpendable:s,totalUnsafe:l,summary:{total:e.length,spendableCount:n.length,unsafeCount:r.length,spendablePercentage:e.length?Math.round(n.length/e.length*100):0,addressCount:Object.keys(c).length}}}function ti(e){let t=[];const n=e.match(/\[[\s\S]*?\]/g);if(n&&n.length>0){for(const e of n)try{const n=JSON.parse(e);Array.isArray(n)&&(t=[...t,...n])}catch(r){}if(0===t.length)throw new Error("No valid UTXO arrays found in pasted content")}else{const n=JSON.parse(e);if(!Array.isArray(n))throw new Error("Input must be a JSON array (or multiple arrays)");t=n}return t.filter(e=>e.txid&&"number"==typeof e.vout&&"number"==typeof e.value)}function ni(e){return Tt(`/api/address/${e}/utxo`)}const ri=Object.freeze(Object.defineProperty({__proto__:null,analyzeSatRanges:Jr,analyzeTransaction:Qr,bumpSessionCacheNamespace:function(e=""){Dr=`NX-UTXO-v1:${Date.now()}${e?":"+e:""}`},calculateSatRarity:Yr,checkUtxoForAssets:Zr,filterSpendableUtxos:ei,getCachedUtxoResult:qr,getMempoolUtxoUrl:ni,parseUtxosFromMempool:ti,setCachedUtxoResult:function(e,t){Vr(`utxo:result:${e}`,t)}},Symbol.toStringTag,{value:"Module"})),ii="kv";let ai=null;function oi(){return ai||("undefined"==typeof indexedDB?(ai=Promise.resolve(null),ai):(ai=new Promise(e=>{const t=indexedDB.open("nexus-inscriber",1);t.onupgradeneeded=()=>{const e=t.result;e.objectStoreNames.contains(ii)||e.createObjectStore(ii,{keyPath:"k"})},t.onsuccess=()=>e(t.result),t.onerror=()=>e(null)}),ai))}function si(e){return new Promise(t=>{e.oncomplete=()=>t(!0),e.onerror=()=>t(!1),e.onabort=()=>t(!1)})}async function li(e,t){const n=String(e||"");if(!n)return!1;const r=await oi();if(!r)return!1;try{const e=r.transaction(ii,"readwrite");return e.objectStore(ii).put({k:n,v:t,t:Date.now()}),await si(e)}catch{return!1}}async function ci(e){const t=String(e||"");if(!t)return 0;const n=await oi();if(!n)return 0;try{const e=n.transaction(ii,"readwrite"),r=e.objectStore(ii);let i=0;return await new Promise(e=>{try{const n=r.openCursor();n.onsuccess=()=>{const r=n.result;if(!r)return e(!0);const a=String(r?.key||r?.value?.k||"");if(a&&a.startsWith(t))try{r.delete(),i++}catch{}r.continue()},n.onerror=()=>e(!1)}catch{e(!1)}}),await si(e),i}catch{return 0}}async function ui(e,{maxAgeMs:t=null}={}){const n=await async function(e){const t=String(e||"");if(!t)return null;const n=await oi();return n?await new Promise(e=>{try{const r=n.transaction(ii,"readonly").objectStore(ii).get(t);r.onsuccess=()=>e(r.result||null),r.onerror=()=>e(null)}catch{e(null)}}):null}(e);if(!n||"object"!=typeof n)return null;if(null!=t){const e=Date.now()-(n.t||0);if(!Number.isFinite(e)||e>t)return null}return n.v??null}const di=()=>"undefined"!=typeof window&&!0===window.__NEXUS_WEB_BUILD__,pi="https://nexus-bitcoin-proxy.getord.workers.dev",fi={WORKER_URL:pi,ENDPOINTS:{HEALTH:"/health",UTXO:"/utxo",ADDRESS_TXS:"/address-txs",ADDRESS_TXS_MEMPOOL:"/address-txs-mempool",TX:"/tx",TX_HEX:"/tx-hex",TX_STATUS:"/tx-status",BLOCK:"/block",BLOCK_TXS:"/block-txs",BLOCK_HEIGHT:"/block-height",PUSH:"/push",FEE_ESTIMATES:"/fee-estimates"},TIMEOUT:3e4,ENABLED:!0,_initialized:!1,_configSource:"fallback",_fallbackUrls:[pi]};async function mi(){if(fi._initialized)return fi.WORKER_URL;if("undefined"!=typeof window&&window.__NEXUS_WEB_BUILD__){if(!0!==window.__NEXUS_FORCE_BITCOIN_PROXY__)return fi.ENABLED=!1,fi._initialized=!0,fi._configSource="web-build-direct",null;fi.ENABLED=!0}try{const t=new AbortController,n=setTimeout(()=>t.abort(),5e3),r=await fetch("/r/sat/479489914957748/at/-1/content",{signal:t.signal});if(clearTimeout(n),!r.ok)throw new Error(`HTTP ${r.status}: ${r.statusText}`);const i=(await r.text()).trim();let a=[],o=null;if(i.startsWith("{")||i.startsWith("["))try{const e=JSON.parse(i);e.urls&&Array.isArray(e.urls)?(a=e.urls,o=e.timeout||null):Array.isArray(e)?a=e:e.url&&(a=[e.url],o=e.timeout||null)}catch(e){}if(0===a.length&&(a=[i]),a=a.map(e=>String(e).trim()).filter(e=>e.startsWith("http://")||e.startsWith("https://")),0===a.length)throw new Error("No valid URLs found in config");return o&&"number"==typeof o&&(fi.TIMEOUT=o),fi.WORKER_URL=a[0],fi._fallbackUrls=a,fi._configSource="sat",fi._initialized=!0,a.length,a[0]}catch(tn){return fi.WORKER_URL=pi,fi._fallbackUrls=[pi],fi._configSource="fallback",fi._initialized=!0,pi}}function gi(){return fi._fallbackUrls||[fi.WORKER_URL]}function hi(e){const t=String(e||"").trim().toLowerCase();return!t||"mainnet"!==t&&"testnet"!==t&&"signet"!==t&&"regtest"!==t?"":`?network=${encodeURIComponent(t)}`}async function bi(e){const t=String(e||"").trim();if(!t)throw new Error("fetchAddressTxsViaProxy: address is required");const n=`proxy:addr-txs:${t}`;try{const e=await ui(n,{maxAgeMs:3e4});if(Array.isArray(e))return e}catch{}let r;if(di()||!fi.ENABLED){try{const e=await fetch(`https://blockstream.info/api/address/${t}/txs`);if(e.ok){const t=await e.json();Array.isArray(t)&&(r=t)}}catch{}if(!r){const e=await fetch(Tt(`/api/address/${t}/txs`));if(!e.ok)throw new Error(`Failed to fetch address txs: ${e.statusText}`);const n=await e.json();r=Array.isArray(n)?n:[]}}else{const e=`${fi.WORKER_URL}${fi.ENDPOINTS.ADDRESS_TXS}/${encodeURIComponent(t)}`,n=new AbortController,i=setTimeout(()=>n.abort(),fi.TIMEOUT);try{const t=await fetch(e,{signal:n.signal});if(clearTimeout(i),!t.ok){const e=await t.text().catch(()=>"");throw new Error(`Proxy returned ${t.status}: ${e||t.statusText}`)}const a=await t.json();r=Array.isArray(a)?a:[]}catch(tn){if(clearTimeout(i),"AbortError"===tn.name)throw new Error("Address tx fetch timeout - please try again");throw tn}}try{li(n,r)}catch{}return r}async function yi(e,t=null){const n=String(e||"").trim();if(!n)throw new Error("fetchAddressMempoolTxsViaProxy: address is required");const r=hi(t),i=`proxy:addr-txs-mempool:${t||"mainnet"}:${n}`;try{const e=await ui(i,{maxAgeMs:15e3});if(Array.isArray(e))return e}catch{}let a;const o="testnet"===t?"/testnet/api":"signet"===t||"regtest"===t?"/signet/api":"/api";if(di()||!fi.ENABLED){const e=await fetch(Tt(`${o}/address/${n}/txs/mempool`));if(!e.ok)throw new Error(`Failed to fetch address mempool txs: ${e.statusText}`);const t=await e.json();a=Array.isArray(t)?t:[]}else{const e=`${fi.WORKER_URL}${fi.ENDPOINTS.ADDRESS_TXS_MEMPOOL}/${encodeURIComponent(n)}${r}`,t=new AbortController,i=setTimeout(()=>t.abort(),fi.TIMEOUT);try{const n=await fetch(e,{signal:t.signal});if(clearTimeout(i),!n.ok){const e=await n.text().catch(()=>"");throw new Error(`Proxy returned ${n.status}: ${e||n.statusText}`)}const r=await n.json();a=Array.isArray(r)?r:[]}catch(tn){if(clearTimeout(i),"AbortError"===tn.name)throw new Error("Address mempool tx fetch timeout - please try again");throw tn}}try{li(i,a)}catch{}return a}async function xi(e,t=null){const n=String(e||"").trim();if(!/^[0-9a-fA-F]{64}$/.test(n))throw new Error("fetchTxHexViaProxy: txid must be 64 hex chars");const r=hi(t),i=!t||"mainnet"===t;if(di()||!fi.ENABLED){if(i)try{const e=await fetch(`https://blockstream.info/api/tx/${n}/hex`);if(e.ok){const t=String(await e.text()).trim();if(t.length>100&&/^[0-9a-fA-F]+$/.test(t))return t}}catch{}const e="testnet"===t?"/testnet/api":"signet"===t||"regtest"===t?"/signet/api":"/api",r=await fetch(Tt(`${e}/tx/${n}/hex`));if(!r.ok)throw new Error(`Failed to fetch tx hex: ${await r.text().catch(()=>r.statusText)}`);return String(await r.text()).trim()}const a=`${fi.WORKER_URL}${fi.ENDPOINTS.TX_HEX}/${encodeURIComponent(n)}${r}`,o=new AbortController,s=setTimeout(()=>o.abort(),fi.TIMEOUT);try{const e=await fetch(a,{signal:o.signal});if(clearTimeout(s),!e.ok){const t=await e.text().catch(()=>"");throw new Error(`Proxy returned ${e.status}: ${t||e.statusText}`)}return String(await e.text()).trim()}catch(tn){if(clearTimeout(s),"AbortError"===tn.name||!i)throw new Error("Tx hex fetch failed \u2014 proxy timeout")}try{const e=await fetch(kt(`/r/tx/${n}`));if(e.ok){const t=String(await e.text()).trim();if(t.length>100&&/^[0-9a-fA-F]+$/.test(t)&&t.length%2==0)return t}}catch{}throw new Error(`Failed to fetch tx hex for ${n.slice(0,12)}\u2026 \u2014 all sources exhausted`)}function wi(e){fi.WORKER_URL=e}function vi(){return fi.WORKER_URL}async function Si(e=null){const t=hi(e);if(!e||"mainnet"===e)try{const e=await fetch(kt("/r/blockheight"));if(e.ok){const t=parseInt(String(await e.text()).trim(),10);if(Number.isFinite(t)&&t>0)return t}}catch{}if(di()||!fi.ENABLED){const t="testnet"===e?"/testnet/api":"signet"===e||"regtest"===e?"/signet/api":"/api",n=await fetch(Tt(`${t}/blocks/tip/height`));if(!n.ok)throw new Error(`Failed to fetch block height: ${n.statusText}`);const r=await n.text();return parseInt(r.trim(),10)}const n=`${fi.WORKER_URL}${fi.ENDPOINTS.BLOCK_HEIGHT}${t}`,r=new AbortController,i=setTimeout(()=>r.abort(),fi.TIMEOUT);try{const e=await fetch(n,{signal:r.signal});if(clearTimeout(i),!e.ok){const t=await e.text().catch(()=>"");throw new Error(`Proxy returned ${e.status}: ${t||e.statusText}`)}const t=await e.text();return parseInt(t.trim(),10)}catch(tn){if(clearTimeout(i),"AbortError"===tn.name)throw new Error("Block height fetch timeout - please try again");throw tn}}const Ei=Object.freeze(Object.defineProperty({__proto__:null,BITCOIN_PROXY_CONFIG:fi,broadcastTransactionViaProxy:async function(e){if(!fi.ENABLED){const t=await fetch(Tt("/api/tx"),{method:"POST",headers:{"Content-Type":"text/plain"},body:e});if(!t.ok)throw new Error(`Broadcast failed: ${await t.text()}`);return t.text()}const t=`${fi.WORKER_URL}${fi.ENDPOINTS.PUSH}`,n=new AbortController,r=setTimeout(()=>n.abort(),fi.TIMEOUT);try{const i=await fetch(t,{method:"POST",headers:{"Content-Type":"text/plain"},body:e,signal:n.signal});clearTimeout(r);const a=await i.json();if(!i.ok||!a.success)throw new Error(a.error||`Broadcast failed: ${i.statusText}`);return a.txid}catch(tn){if(clearTimeout(r),"AbortError"===tn.name)throw new Error("Broadcast timeout - transaction may still confirm");throw tn}},checkProxyHealth:async function(){const e=`${fi.WORKER_URL}${fi.ENDPOINTS.HEALTH}`;try{const t=await fetch(e);if(!t.ok)throw new Error(`Health check failed: ${t.status}`);return await t.json()}catch(tn){throw tn}},fetchAddressMempoolTxsViaProxy:yi,fetchAddressTxsViaProxy:bi,fetchBlockHeightViaProxy:Si,fetchBlockTxsViaProxy:async function(e,t=null){const n=String(e||"").trim();if(!n)throw new Error("fetchBlockTxsViaProxy: blockHash is required");if(!/^[0-9a-fA-F]{64}$/.test(n))throw new Error("fetchBlockTxsViaProxy: invalid hash format");const r=hi(t);if(!fi.ENABLED){const e="testnet"===t?"/testnet/api":"signet"===t||"regtest"===t?"/signet/api":"/api",r=await fetch(Tt(`${e}/block/${n}/txs`));if(!r.ok)throw new Error(`Failed to fetch block txs: ${r.statusText}`);const i=await r.json();return Array.isArray(i)?i:[]}const i=`${fi.WORKER_URL}${fi.ENDPOINTS.BLOCK_TXS}/${encodeURIComponent(n)}${r}`,a=new AbortController,o=setTimeout(()=>a.abort(),fi.TIMEOUT);try{const e=await fetch(i,{signal:a.signal});if(clearTimeout(o),!e.ok){const t=await e.text().catch(()=>"");throw new Error(`Proxy returned ${e.status}: ${t||e.statusText}`)}const t=await e.json();return Array.isArray(t)?t:[]}catch(tn){if(clearTimeout(o),"AbortError"===tn.name)throw new Error("Block txs fetch timeout - please try again");throw tn}},fetchBlockViaProxy:async function(e,t=null){const n=String(e||"").trim();if(!n)throw new Error("fetchBlockViaProxy: hash or height is required");const r=hi(t);if(!fi.ENABLED){const e="testnet"===t?"/testnet/api":"signet"===t||"regtest"===t?"/signet/api":"/api",r=await fetch(Tt(`${e}/block/${n}`));if(!r.ok)throw new Error(`Failed to fetch block: ${r.statusText}`);return await r.json()}const i=`${fi.WORKER_URL}${fi.ENDPOINTS.BLOCK}/${encodeURIComponent(n)}${r}`,a=new AbortController,o=setTimeout(()=>a.abort(),fi.TIMEOUT);try{const e=await fetch(i,{signal:a.signal});if(clearTimeout(o),!e.ok){const t=await e.text().catch(()=>"");throw new Error(`Proxy returned ${e.status}: ${t||e.statusText}`)}return await e.json()}catch(tn){if(clearTimeout(o),"AbortError"===tn.name)throw new Error("Block fetch timeout - please try again");throw tn}},fetchTxHexViaProxy:xi,fetchTxStatusViaProxy:async function(e,t=null){const n=String(e||"").trim();if(!/^[0-9a-fA-F]{64}$/.test(n))throw new Error("fetchTxStatusViaProxy: txid must be 64 hex chars");const r=hi(t);if(!fi.ENABLED){const e="testnet"===t?"/testnet/api":"signet"===t||"regtest"===t?"/signet/api":"/api",r=await fetch(Tt(`${e}/tx/${n}/status`));if(!r.ok)throw new Error(`Failed to fetch tx status: ${await r.text().catch(()=>r.statusText)}`);return r.json()}const i=`${fi.WORKER_URL}${fi.ENDPOINTS.TX_STATUS}/${encodeURIComponent(n)}${r}`,a=new AbortController,o=setTimeout(()=>a.abort(),fi.TIMEOUT);try{const e=await fetch(i,{signal:a.signal});if(clearTimeout(o),!e.ok){const t=await e.text().catch(()=>"");throw new Error(`Proxy returned ${e.status}: ${t||e.statusText}`)}return await e.json()}catch(tn){if(clearTimeout(o),"AbortError"===tn.name)throw new Error("Tx status fetch timeout - please try again");throw tn}},fetchTxViaProxy:async function(e,t=null){const n=String(e||"").trim();if(!n)throw new Error("fetchTxViaProxy: txid is required");if(!/^[0-9a-fA-F]{64}$/.test(n))throw new Error("fetchTxViaProxy: invalid txid format");const r=hi(t);if(!fi.ENABLED){const e="testnet"===t?"/testnet/api":"signet"===t||"regtest"===t?"/signet/api":"/api",r=await fetch(Tt(`${e}/tx/${n}`));if(!r.ok)throw new Error(`Failed to fetch tx: ${r.statusText}`);return await r.json()}const i=`${fi.WORKER_URL}${fi.ENDPOINTS.TX}/${encodeURIComponent(n)}${r}`,a=new AbortController,o=setTimeout(()=>a.abort(),fi.TIMEOUT);try{const e=await fetch(i,{signal:a.signal});if(clearTimeout(o),!e.ok){const t=await e.text().catch(()=>"");throw new Error(`Proxy returned ${e.status}: ${t||e.statusText}`)}return await e.json()}catch(tn){if(clearTimeout(o),"AbortError"===tn.name)throw new Error("Transaction fetch timeout - please try again");throw tn}},fetchUtxosViaProxy:async function(e){if(!fi.ENABLED){const t=await fetch(Tt(`/api/address/${e}/utxo`));if(!t.ok)throw new Error(`Failed to fetch UTXOs: ${t.statusText}`);return t.json()}const t=`${fi.WORKER_URL}${fi.ENDPOINTS.UTXO}/${e}`,n=new AbortController,r=setTimeout(()=>n.abort(),fi.TIMEOUT);try{const e=await fetch(t,{signal:n.signal});if(clearTimeout(r),!e.ok)throw new Error(`Proxy returned ${e.status}: ${e.statusText}`);return await e.json()}catch(tn){if(clearTimeout(r),"AbortError"===tn.name)throw new Error("UTXO fetch timeout - please try again");throw tn}},fetchWithProxyFallback:async function(e){const t=gi();let n=null;for(let r=0;r<t.length;r++){const i=t[r];try{const t=await e(i);if(t.ok)return t;n=new Error(`HTTP ${t.status}: ${t.statusText}`)}catch(tn){n=tn,t.length}}throw n||new Error("All proxy URLs failed")},getFeeEstimatesViaProxy:async function(){if(!fi.ENABLED){const e=await fetch(Tt("/api/v1/fees/recommended"));if(!e.ok)throw new Error(`Failed to fetch fees: ${e.statusText}`);const t=await e.json();return{fast:t.fastestFee,medium:t.halfHourFee,slow:t.hourFee}}const e=`${fi.WORKER_URL}${fi.ENDPOINTS.FEE_ESTIMATES}`,t=new AbortController,n=setTimeout(()=>t.abort(),fi.TIMEOUT);try{const r=await fetch(e,{signal:t.signal});if(clearTimeout(n),!r.ok)throw new Error(`Proxy returned ${r.status}: ${r.statusText}`);return await r.json()}catch(tn){if(clearTimeout(n),"AbortError"===tn.name)throw new Error("Fee fetch timeout - please try again");throw tn}},getProxyUrl:vi,getProxyUrls:gi,initBitcoinProxy:mi,setProxyUrl:wi},Symbol.toStringTag,{value:"Module"})),Ni={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};function Ii(){return window.NexusBitcoinProxy={config:fi,openPopup:async(e,t={},n={})=>new Promise((r,i)=>{const a=`req_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,o=vi();let s;try{s=new URL(o,window.location.href).origin}catch(I){return void i(new Error("Invalid Bitcoin proxy URL (origin parse failed)"))}const l=(()=>{try{const e=("undefined"!=typeof globalThis?globalThis.__NEXUS_BITCOIN_PROXY_ALLOWED_ORIGINS__:null)??null;if(!e)return null;const t=Array.isArray(e)?e:String(e).split(",").map(e=>e.trim()).filter(Boolean);if(0===t.length)return null;const n=t.map(e=>{try{return new URL(e,window.location.href).origin}catch{return null}}).filter(Boolean);return n.length>0?n:null}catch{return null}})();if(l&&!l.includes(s))return void i(new Error(`Bitcoin proxy origin not allowed: ${s}`));const c=Number.isFinite(n.pollMs)?n.pollMs:100,u=Number.isFinite(n.timeoutMs)?n.timeoutMs:{utxo:2e4,"utxo-with-fees":2e4,fees:15e3,inscriptions:2e4,ordinals:2e4,push:6e4,"push-package":6e4}[e]??2e4,d=`${o}/proxy-popup?requestId=${a}`,p=Math.round((window.screen.width-400)/2),f=Math.round((window.screen.height-300)/2),m=window.open(d,"NexusBitcoinProxy",`width=400,height=300,left=${p},top=${f},popup=yes,location=no,menubar=no,toolbar=no,scrollbars=no,resizable=no`);if(!m)return void i(new Error("Popup blocked. Please allow popups for this site."));let g=null,h=null,b=null,y=null,x=!1;const w=({closePopup:e=!1}={})=>{if(!x&&(x=!0,g&&(clearInterval(g),g=null),h&&(clearTimeout(h),h=null),b&&(clearTimeout(b),b=null),y&&(clearTimeout(y),y=null),window.removeEventListener("message",E),window.removeEventListener("message",N),e&&m&&!m.closed))try{m.close()}catch(t){}};let v=!1;const S=()=>{if(!v&&m&&!m.closed)try{m.postMessage({type:"NEXUS_PROXY_INIT",requestId:a,action:e,params:t},s),v=!0}catch{}};b=setTimeout(S,250),y=setTimeout(S,1e3);const E=n=>{n.data&&n.data.type&&"react-devtools-content-script"!==n.data.source&&n.origin===s&&n.source===m&&"NEXUS_PROXY_REQUEST_PARAMS"===n.data.type&&n.data.requestId===a&&(m.postMessage({type:"NEXUS_PROXY_INIT",requestId:a,action:e,params:t},s),v=!0,window.removeEventListener("message",E))};window.addEventListener("message",E);const N=e=>{e.data&&e.data.type&&"react-devtools-content-script"!==e.data.source&&e.origin===s&&e.source===m&&"NEXUS_PROXY_RESULT"===e.data.type&&e.data.requestId===a&&(w({closePopup:!1}),m&&!m.closed&&m.postMessage({type:"NEXUS_PROXY_ACK",requestId:a},s),e.data.success?r(e.data.result):i(new Error(e.data.error||"Unknown error")))};window.addEventListener("message",N),g=setInterval(()=>{m.closed&&(w({closePopup:!1}),i(new Error("Popup closed without completing request")))},c),h=setTimeout(()=>{w({closePopup:!0}),i(new Error(`Request timeout (${Math.round(u/1e3)}s)`))},u)}),async fetchUtxos(e){if(!this.config.ENABLED)throw new Error("Bitcoin Proxy disabled");return(await this.openPopup("utxo",{address:e},{timeoutMs:2e4,pollMs:100})).data},async broadcastTx(e){if(!this.config.ENABLED)throw new Error("Bitcoin Proxy disabled");return(await this.openPopup("push",{txHex:e},{timeoutMs:6e4,pollMs:100})).txid},async broadcastPackage(e,t=3e3){if(!this.config.ENABLED)throw new Error("Bitcoin Proxy disabled");if(!Array.isArray(e)||e.length<2)throw new Error("Package requires at least 2 transactions");const n=await this.openPopup("push-package",{transactions:e,waitMs:t},{timeoutMs:6e4,pollMs:100});return{commitTxId:n.commit.txid,revealTxId:n.reveal.txid,method:"package",details:n}},async getFees(){if(!this.config.ENABLED)throw new Error("Bitcoin Proxy disabled");return(await this.openPopup("fees",{},{timeoutMs:15e3,pollMs:100})).data},async getUtxosWithFees(e){if(!this.config.ENABLED)throw new Error("Bitcoin Proxy disabled");const t=Array.isArray(e)?e:[e],{FEE_CONFIG:r}=await n(async()=>{const{FEE_CONFIG:e}=await Promise.resolve().then(()=>Zn);return{FEE_CONFIG:e}},__VITE_PRELOAD__),{encodeAddresses:i}=await n(async()=>{const{encodeAddresses:e}=await Promise.resolve().then(()=>ik);return{encodeAddresses:e}},__VITE_PRELOAD__),a=i(t,r.platform.address),o=(()=>{try{const e="undefined"!=typeof globalThis?globalThis.__NEXUS_PROXY_PLAINTEXT_FALLBACK__:null;if(!0===e||"true"===e||1===e||"1"===e)return!0;const t=Ni?.VITE_PROXY_PLAINTEXT_FALLBACK;return"1"===t||"true"===String(t||"").toLowerCase()}catch{return!1}})();try{const e=await this.openPopup("utxo-with-fees",{address:a},{timeoutMs:2e4,pollMs:100});return{utxos:e.utxos||[],fees:e.fees,providers:e.providers,addresses:e.addresses||t,addressCount:e.addressCount||t.length,addressUtxoMap:e.addressUtxoMap||{},platformFee:e.platformFee}}catch(s){if(!o)throw s;const e=t.map(e=>String(e||"").trim()).filter(Boolean).join(","),n=await this.openPopup("utxo-with-fees",{address:e},{timeoutMs:2e4,pollMs:100});return{utxos:n.utxos||[],fees:n.fees,providers:n.providers,addresses:n.addresses||t,addressCount:n.addressCount||t.length,addressUtxoMap:n.addressUtxoMap||{},platformFee:n.platformFee}}},async fetchInscriptions(e){if(!this.config.ENABLED)throw new Error("Bitcoin Proxy disabled");return(await this.openPopup("inscriptions",{address:e},{timeoutMs:2e4,pollMs:100})).inscriptions||[]},async fetchOrdinals(e){if(!this.config.ENABLED)throw new Error("Bitcoin Proxy disabled");const t=String(e||"").trim();if(!t)throw new Error("fetchOrdinals: path is required");return await this.openPopup("ordinals",{path:t},{timeoutMs:2e4,pollMs:100})},async checkHealth(){const e=vi();try{const t=await fetch(`${e}/health`);if(!t.ok)throw new Error(`Health check failed: ${t.status}`);return await t.json()}catch(tn){throw tn}},setUrl:wi,getUrl:vi,getConfig:()=>({...fi}),enable:()=>{fi.ENABLED=!0},disable:()=>{fi.ENABLED=!1},isEnabled:()=>fi.ENABLED},window.NexusBitcoinProxy}const Ai=Object.freeze(Object.defineProperty({__proto__:null,initBitcoinProxy:Ii},Symbol.toStringTag,{value:"Module"}));function ki(e,t){if(!e||0===e.length)return null;const n=e=>{if("number"==typeof e.contentSize&&e.contentSize>0)return e.contentSize;if("string"==typeof e.content)try{return new Blob([e.content]).size}catch{return e.content.length}if(e.content&&"object"==typeof e.content){if(e.content.byteLength)return e.content.byteLength;if(e.content.length)return e.content.length}return 0};if(1===e.length){const r=e[0],i=n(r),a=!!r.reinscriptionTargetId||!!r.reinscriptionUtxo,o=Hn(i,t,r.parentIds?.length||0,{postage:a?0:r.postage||546,isReinscription:a,hasMetadata:!!r.metadata,hasMetaprotocol:!!r.metaprotocol,hasPointer:!!r.pointer,hasDelegate:!!r.delegateId}),s=(()=>{try{return Kn(1,[r])}catch{return 0}})();return{...o,itemCount:1,feeOutputsTotal:s,totalRequired:(o?.totalRequired??0)+s}}const r=e.filter(e=>!!e.reinscriptionTargetId||!!e.reinscriptionUtxo),i=e.filter(e=>!(e.reinscriptionTargetId||e.reinscriptionUtxo)).reduce((e,t)=>e+(t.postage||546),0),a=new Set;let o=!1;e.forEach(e=>{Array.isArray(e?.parentUtxos)&&e.parentUtxos.length>0&&(o=!0,e.parentUtxos.forEach(e=>{e&&e.txid&&"number"==typeof e.vout&&a.add(`${e.txid}:${e.vout}`)})),e?.parentUtxo&&e.parentUtxo.txid&&"number"==typeof e.parentUtxo.vout&&(o=!0,a.add(`${e.parentUtxo.txid}:${e.parentUtxo.vout}`))}),o||e.forEach(e=>(e.parentIds||[]).forEach(e=>a.add(e)));const s=a.size,l=new Set(r.map(e=>e?.reinscriptionUtxo).filter(e=>e&&e.txid&&"number"==typeof e.vout).map(e=>`${e.txid}:${e.vout}`)).size||r.length,c=(l>0?l:0)+1,u=(()=>{try{return Xn(e.length,e).length}catch{return 0}})(),d=(()=>{try{return Kn(e.length,e)}catch{return 0}})(),p=10+68*c+43*(e.length+u+(r.length>0?1:0)+1),f=Math.ceil(p*t),m=Dn(e.map(e=>"number"==typeof e.scriptSizeBytes&&e.scriptSizeBytes>0?Math.floor(e.scriptSizeBytes):"string"==typeof e.inscriptionScript&&e.inscriptionScript.length>0?Math.floor(e.inscriptionScript.length/2):Math.floor(n(e)+100)).map(e=>Math.max(0,e)),t,{parentCount:s,includeFeePoolInput:r.length>0,parentInputType:"p2wpkh"}),g=m.vsize,h=m.fee;return{commitFee:f,revealFee:h,postage:i,feeOutputsTotal:d,feeOutputsCount:u,itemCount:e.length,totalRequired:f+h+i+d,commitSize:p,revealSize:g,parentCount:s}}function Ti(e,t="value"){if(e instanceof Uint8Array)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(e&&e.buffer instanceof ArrayBuffer&&"number"==typeof e.byteLength)return new Uint8Array(e.buffer,e.byteOffset||0,e.byteLength);throw new Error(`${t} is not a byte array`)}let Ci=null;async function Bi(){if("undefined"==typeof window)throw new Error("loadBrotliOC: browser environment required");return window.BrotliOC&&"function"==typeof window.BrotliOC.compress?window.BrotliOC:(Ci||(Ci=(async()=>{await import("brotli-oc");const e=window.BrotliOC;if(!e||"function"!=typeof e.compress)throw new Error("BrotliOC did not load correctly (missing BrotliOC.compress)");return e})()),Ci)}async function Pi(e,t=void 0){const n=await Bi(),r=Ti(e,"input");return Ti(await n.compress(r,t||{}),"compressed")}async function _i(e,t=void 0){const n=await Bi();if("function"!=typeof n.decompress)throw new Error("BrotliOC is missing decompress(); cannot decode compressed payload");const r=Ti(e,"compressed");return Ti(await n.decompress(r,t||{}),"decompressed")}const Oi=Object.freeze(Object.defineProperty({__proto__:null,brotliCompressBytes:Pi,brotliDecompressBytes:_i,loadBrotliOC:Bi},Symbol.toStringTag,{value:"Module"}));function Li(e){try{return(new TextEncoder).encode(e)}catch{return Uint8Array.from(Buffer.from(String(e),"utf8"))}}function Fi(e){try{return new TextDecoder("utf-8",{fatal:!1}).decode(e)}catch{return Buffer.from(e).toString("utf8")}}function Mi(e,t,n){const r=t+n;return r>e.length?null:{value:e.slice(t,r),size:n}}function Ri(e,t){return t+4>e.length?null:{value:(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0,size:4}}function $i(e,t){if(t>=e.length)return null;const n=e[t];if(n<253)return{value:BigInt(n),size:1};if(253===n){if(t+2>=e.length)return null;const n=e[t+1]|e[t+2]<<8;return{value:BigInt(n>>>0),size:3}}if(254===n){const n=Ri(e,t+1);return n?{value:BigInt(n.value),size:1+n.size}:null}const r=function(e,t){if(t+8>e.length)return null;let n=0n;for(let r=7;r>=0;r--)n=n<<8n|BigInt(e[t+r]);return{value:n,size:8}}(e,t+1);return r?{value:r.value,size:1+r.size}:null}function Ui(e){let t=e;if("number"==typeof t&&(t=BigInt(Math.floor(t))),"string"==typeof t&&(t=BigInt(t)),"bigint"!=typeof t)throw new Error("encodeCompactSizeU64: n must be bigint|number|string");if(t<0n)throw new Error("encodeCompactSizeU64: n must be >= 0");if(t>(1n<<64n)-1n)throw new Error("encodeCompactSizeU64: n exceeds uint64");if(t<0xfdn)return Uint8Array.of(Number(t));if(t<=0xffffn){const e=Number(t);return Uint8Array.of(253,255&e,e>>8&255)}if(t<=0xffffffffn){const e=Number(t);return Uint8Array.of(254,255&e,e>>8&255,e>>16&255,e>>24&255)}const n=new Uint8Array(9);n[0]=255;let r=t;for(let i=0;i<8;i++)n[1+i]=Number(0xffn&r),r>>=8n;return n}function zi(e,t){if(e.length<t.length)return!1;for(let n=0;n<t.length;n++)if(e[n]!==t[n])return!1;return!0}function Di(e){if(!e||!(e instanceof Uint8Array)||e.length<4)return null;const t=Li("OODL"),n=Li("oodinals-sale-v1");if(zi(e,t)){let n=t.length;if(n>=e.length)return null;const r=e[n];if(n+=1,1===r){if(n>=e.length)return null;const t=e[n];n+=1;const r=Mi(e,n,t);if(!r)return null;if(n+=r.size,n>=e.length)return null;const i=e[n];n+=1;const a=Mi(e,n,i);if(!a)return null;n+=a.size;const o=function(e,t){if(t+8>e.length)return null;let n=0n;for(let r=0;r<8;r++)n=n<<8n|BigInt(e[t+r]);return{value:n,size:8}}(e,n);if(!o)return null;if(n+=o.size,n>=e.length)return null;const s=e[n];if(n+=1,0!==s&&1!==s)return null;let l=null;if(1===s){const t=Mi(e,n,32);if(!t)return null;l=Buffer.from(t.value).toString("hex"),n+=t.size}if(n!==e.length)return null;const c=Fi(r.value).trim(),u=Fi(a.value).trim();let d;return d=o.value<=BigInt(Number.MAX_SAFE_INTEGER)?Number(o.value):o.value.toString(),c&&u?{protocol:"oodinals-sale-v1",version:1,parentInscriptionId:c,sellerAddress:u,priceSats:d,psbtHashHex:l}:null}if(2===r){if(n+2>e.length)return null;const t=e[n];n+=1;const r=e[n];if(n+=1,!Number.isFinite(t)||t<1)return null;if(1!==r)return null;const i=Mi(e,n,32);if(!i)return null;n+=i.size;const a=function(e,t){return t+4>e.length?null:{value:(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0,size:4}}(e,n);if(!a)return null;n+=a.size;const o=Mi(e,n,32);if(!o)return null;n+=o.size;const s=$i(e,n);if(!s)return null;n+=s.size;const l=$i(e,n);if(!l)return null;if(n+=l.size,n>=e.length)return null;const c=e[n];if(n+=1,0!==c&&1!==c)return null;let u=null,d=null;if(1===c){const t=$i(e,n);if(!t)return null;n+=t.size;const r=Mi(e,n,32);if(!r)return null;n+=r.size,u=t.value<=BigInt(Number.MAX_SAFE_INTEGER)?Number(t.value):t.value.toString(),d=Buffer.from(r.value).toString("hex")}if(n>=e.length)return null;const p=e[n];if(n+=1,0!==p&&1!==p)return null;let f=null;if(1===p){const t=Mi(e,n,32);if(!t)return null;f=Buffer.from(t.value).toString("hex"),n+=t.size}let m=null;if(n<e.length){const t=e[n];if(n+=1,1&t){const t=Ri(e,n);if(!t)return null;m=t.value,n+=t.size}if(2&t){const t=Ri(e,n);if(!t)return null;n+=t.size}}const g=`${Buffer.from(i.value).toString("hex")}i${String(a.value)}`,h=s.value<=BigInt(Number.MAX_SAFE_INTEGER)?Number(s.value):s.value.toString(),b=l.value<=BigInt(Number.MAX_SAFE_INTEGER)?Number(l.value):l.value.toString();return{protocol:"oodinals-sale-v1",version:2,openStoreVersion:t,outputOrderVersion:r,parentInscriptionId:g,sellerScriptHashHex:Buffer.from(o.value).toString("hex"),priceSats:h,postageSats:b,platformFeeSats:u,platformFeeScriptHashHex:d,psbtHashHex:f,minBlockHeight:m}}return null}if(zi(e,n)){let t=n.length;0===e[t]&&(t+=1);const r=(e,t)=>{if(t>=e.length)return null;const n=e[t];return n<253?{value:n,size:1}:253===n?t+2>=e.length?null:{value:e[t+1]|e[t+2]<<8,size:3}:254===n?t+4>=e.length?null:{value:(e[t+1]|e[t+2]<<8|e[t+3]<<16|e[t+4]<<24)>>>0,size:5}:null},i=(e,t)=>{if(t+8>e.length)return null;let n=0n;for(let r=7;r>=0;r--)n=n<<8n|BigInt(e[t+r]);return{value:n,size:8}},a=r(e,t);if(!a)return null;t+=a.size;const o=Mi(e,t,a.value);if(!o)return null;t+=o.size;const s=r(e,t);if(!s)return null;t+=s.size;const l=Mi(e,t,s.value);if(!l)return null;t+=l.size;const c=i(e,t);if(!c)return null;t+=c.size;let u=null;if(t+32<=e.length){const n=Mi(e,t,32);n&&(u=Buffer.from(n.value).toString("hex"))}const d=Fi(o.value).trim(),p=Fi(l.value).trim();let f;return f=c.value<=BigInt(Number.MAX_SAFE_INTEGER)?Number(c.value):c.value.toString(),d&&p?{protocol:"oodinals-sale-v1",version:1,parentInscriptionId:d,sellerAddress:p,priceSats:f,psbtHashHex:u}:null}return null}function Hi({parentInscriptionId:e,sellerAddress:t,priceSats:n,psbtHashHex:r=null}){const i=Li("OODL"),a=Li(String(e||"")),o=Li(String(t||""));if(a.length>255||o.length>255)throw new Error("encodeOodinalsSaleMarker: string fields too long (max 255 bytes)");const s="string"==typeof r&&/^[0-9a-fA-F]{64}$/.test(r),l=6+a.length+1+o.length+8+1+(s?32:0),c=new Uint8Array(l);let u=0;c.set(i,u),u+=4,c[u]=1,u+=1,c[u]=a.length,u+=1,c.set(a,u),u+=a.length,c[u]=o.length,u+=1,c.set(o,u),u+=o.length;let d=n;if("number"==typeof d&&(d=BigInt(Math.floor(d))),"string"==typeof d&&(d=BigInt(d)),"bigint"!=typeof d)throw new Error("encodeOodinalsSaleMarker: priceSats must be bigint|number|string");if(d<0n)throw new Error("encodeOodinalsSaleMarker: priceSats must be >= 0");if(d>(1n<<64n)-1n)throw new Error("encodeOodinalsSaleMarker: priceSats exceeds uint64");for(let p=7;p>=0;p--)c[u+p]=Number(0xffn&d),d>>=8n;if(u+=8,c[u]=s?1:0,u+=1,s){const e=Uint8Array.from(Buffer.from(r,"hex"));c.set(e,u),u+=32}return c}function Wi({parentInscriptionId:e,sellerScriptHashHex:t,priceSats:n,postageSats:r,platformFeeSats:i=null,platformFeeScriptHashHex:a=null,psbtHashHex:o=null,openStoreVersion:s=1,minBlockHeight:l=null}){const c=Li("OODL"),u=Number(s);if(!Number.isFinite(u)||u<1||u>255||!Number.isInteger(u))throw new Error("encodeOpenStoreSaleMarkerV2: openStoreVersion must be an integer in [1,255]");const d=function(e){const t=String(e||"").trim().match(/^([0-9a-fA-F]{64})i(\d+)$/);if(!t)return null;const n=t[1].toLowerCase(),r=Number(t[2]);return!Number.isFinite(r)||r<0?null:{txid:n,index:r}}(e);if(!d)throw new Error("encodeOpenStoreSaleMarkerV2: invalid parentInscriptionId (expected <txid>i<index>)");const p=function(e){const t=Number(e);if(!Number.isFinite(t)||t<0||t>4294967295)return null;const n=new Uint8Array(4);return n[0]=t>>>24&255,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n}(d.index);if(!p)throw new Error("encodeOpenStoreSaleMarkerV2: invalid inscription index");if("string"!=typeof t||!/^[0-9a-fA-F]{64}$/.test(t))throw new Error("encodeOpenStoreSaleMarkerV2: sellerScriptHashHex must be 32-byte hex");const f=Ui(n),m=Ui(r),g=null!=i,h="string"==typeof a&&/^[0-9a-fA-F]{64}$/.test(a);if(g&&!h)throw new Error("encodeOpenStoreSaleMarkerV2: platformFeeScriptHashHex required when platformFeeSats is set");const b=g?Ui(i):null,y="string"==typeof o&&/^[0-9a-fA-F]{64}$/.test(o),x=null==l?null:Number(l),w=Number.isFinite(x)&&x>=0&&x<=4294967295&&Number.isInteger(x);if(null!=l&&!w)throw new Error("encodeOpenStoreSaleMarkerV2: minBlockHeight must be a uint32 when provided");let v=0;w&&(v|=1);const S=0!==v;if(u>=2){const e="string"==typeof o?o.toLowerCase():"";if(!y||e==="0".repeat(64))throw new Error("encodeOpenStoreSaleMarkerV2: Open Store v2+ requires a non-zero psbtHashHex commitment")}const E=75+f.length+m.length+1+(g?b.length+32:0)+1+(y?32:0)+(S?1+(w?4:0):0),N=new Uint8Array(E);let I=0;return N.set(c,I),I+=4,N[I]=2,I+=1,N[I]=u,I+=1,N[I]=1,I+=1,N.set(Uint8Array.from(Buffer.from(d.txid,"hex")),I),I+=32,N.set(p,I),I+=4,N.set(Uint8Array.from(Buffer.from(t,"hex")),I),I+=32,N.set(f,I),I+=f.length,N.set(m,I),I+=m.length,N[I]=g?1:0,I+=1,g&&(N.set(b,I),I+=b.length,N.set(Uint8Array.from(Buffer.from(a,"hex")),I),I+=32),N[I]=y?1:0,I+=1,y&&(N.set(Uint8Array.from(Buffer.from(o,"hex")),I),I+=32),S&&(N[I]=v,I+=1,w&&(function(e,t,n){const r=Number(n);if(!Number.isFinite(r)||r<0||r>4294967295||!Number.isInteger(r))throw new Error("writeU32LE: value must be a uint32");e[t]=255&r,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24&255}(N,I,x),I+=4)),N}async function ji(e,t=null){const n=t||await In(),r=!(!e||2!==e.version&&"number"!=typeof e.openStoreVersion),i=r?Wi(e):Hi(e);if(r&&e?.parentInscriptionId){const t=Di(Uint8Array.from(i));if(!t||2!==Number(t.version||0))throw new Error("buildSaleMarkerOpReturnScript: Open Store marker v2 did not decode after encode");if(String(t.parentInscriptionId||"").toLowerCase()!==String(e.parentInscriptionId).toLowerCase())throw new Error("buildSaleMarkerOpReturnScript: parentInscriptionId did not round-trip encode/decode. This likely indicates a txid endianness mismatch in marker v2 producer.")}return n.script.compile([n.opcodes.OP_RETURN,Buffer.from(i)])}Uint8Array.from([78,88,83,66,77]);const Vi=Uint8Array.from([78,88,83,80,76]);async function qi({parcelNumber:e,bitmapNumber:t}={},n=null){const r=n||await In(),i=function(e,t){const n=Number(e),r=Number(t);if(!Number.isFinite(n)||n<0||!Number.isInteger(n))throw new Error("encodeNexusParcelHintV1: parcelNumber must be a non-negative integer");if(!Number.isFinite(r)||r<0||!Number.isInteger(r))throw new Error("encodeNexusParcelHintV1: bitmapNumber must be a non-negative integer");if(n>4294967295)throw new Error("encodeNexusParcelHintV1: parcelNumber must fit in uint32");if(r>4294967295)throw new Error("encodeNexusParcelHintV1: bitmapNumber must fit in uint32");const i=new Uint8Array(Vi.length+1+4+4);i.set(Vi,0),i[Vi.length]=1;const a=Vi.length+1;return i[a+0]=n>>>0&255,i[a+1]=n>>>8&255,i[a+2]=n>>>16&255,i[a+3]=n>>>24&255,i[a+4]=r>>>0&255,i[a+5]=r>>>8&255,i[a+6]=r>>>16&255,i[a+7]=r>>>24&255,i}(e,t);return r.script.compile([r.opcodes.OP_RETURN,Buffer.from(i)])}async function Xi(e,t,n=null){if(!e||"string"!=typeof e)return null;const r=n||await In();let i;try{i=r.Transaction.fromHex(e)}catch(a){return null}for(let o=0;o<i.outs.length;o++){const e=i.outs[o],n=r.script.decompile(e.script)||[];if(n.length<2)continue;if(n[0]!==r.opcodes.OP_RETURN)continue;const a=n[1];if(!a||"number"==typeof a)continue;const s=Di(Uint8Array.from(a));if(s&&2===Number(s.version||0)&&1===Number(s.openStoreVersion||0))return{...s,txId:t,vout:o}}return null}let Ki=null;async function Gi(){return Ki||(Ki=await n(()=>Promise.resolve().then(()=>Zo),__VITE_PRELOAD__)),Ki}let Yi=null;async function Ji(){return Yi||(Yi=await n(()=>Promise.resolve().then(()=>fo),__VITE_PRELOAD__)),Yi}let Qi=null,Zi=null;function ea(e){const t=String(e||"mainnet").toLowerCase();return"testnet"===t||"signet"===t||"regtest"===t?"testnet":"mainnet"}function ta(e){const t=String(e||"mainnet").toLowerCase();return"testnet"===t?"/testnet":"signet"===t||"regtest"===t?"/signet":""}function na(e,t=null){const n=Number(e);return Number.isFinite(n)?Math.floor(n):t}function ra(e){return/^[0-9a-fA-F]{64}$/.test(String(e||"").trim())}function ia(){return{address:Vn.platform.address,amountSats:Vn.platform.amountSats,description:Vn.platform.description}}function aa(e){const t={...e||{}},n=ia();return t.platformFeeAddress=n.address,t.platformFeeSats=BigInt(n.amountSats||0),t}function oa(e){const t={...e||{}},n=String(t.marketplaceFeeAddress||t.fundingAddress||"").trim();if(!n)throw new Error("Marketplace config requires marketplaceFeeAddress");const r=na(t.marketplaceFeeSats??t.listingFeeSats??t.listingFee,600),i=na(t.minMarketplaceFeeSats??t.minListingFeeSats??t.minListingFee,600);if(!Number.isFinite(r)||r<0)throw new Error("marketplaceFeeSats must be a non-negative number");if(!Number.isFinite(i)||i<0)throw new Error("minMarketplaceFeeSats must be a non-negative number");const a=ea(t.network);return{id:t.id?String(t.id):void 0,name:t.name?String(t.name):void 0,description:t.description?String(t.description):void 0,network:a,marketplaceFeeAddress:n,marketplaceFeeSats:r,minMarketplaceFeeSats:i}}async function sa({address:e,network:t,cursorTxid:n=null}){const r=`${ta(t)}/api/address/${e}/txs`,i=Tt(n?`${r}/chain/${n}`:r),a=await fetch(i);if(!a.ok)throw new Error(`Failed to fetch address txs (${a.status})`);const o=await a.json();return Array.isArray(o)?o:[]}async function la(e){const t=kt(`/r/inscription/${e}`),n=await fetch(t);if(!n.ok)return null;const r=await n.json();return{id:e,inscriptionId:e,number:r.number,contentType:r.content_type,timestamp:r.timestamp,...r}}async function ca({revealTxid:e,network:t}){if(!ra(e))return null;const r=String(e).toLowerCase(),a=ta(t);let o=null;try{!function(){try{"undefined"==typeof globalThis||globalThis.Buffer||(globalThis.Buffer=i.Buffer)}catch{}}();const e=Tt(`${a}/api/tx/${r}/hex`),s=await fetch(e);if(s.ok){const e=await s.text(),r=String(e||"").trim().replace(/^"|"$/g,"");if(/^[0-9a-fA-F]+$/.test(r)&&r.length>10){const{loadBitcoinLibFromInscription:e}=await n(async()=>{const{loadBitcoinLibFromInscription:e}=await Promise.resolve().then(()=>An);return{loadBitcoinLibFromInscription:e}},__VITE_PRELOAD__),i=await e(),{extractOodlListingMetadataFromRevealTxWithBitcoinLib:a,extractSellerPsbtFromRevealTxWithBitcoinLib:s}=await n(async()=>{const{extractOodlListingMetadataFromRevealTxWithBitcoinLib:e,extractSellerPsbtFromRevealTxWithBitcoinLib:t}=await Promise.resolve().then(()=>fo);return{extractOodlListingMetadataFromRevealTxWithBitcoinLib:e,extractSellerPsbtFromRevealTxWithBitcoinLib:t}},__VITE_PRELOAD__);try{const e=await a(i,r),t=e?.priceSats,n="bigint"==typeof t?Number(t):"string"==typeof t?Number.parseInt(t,10):Number(t);if(Number.isFinite(n)&&n>0)return Math.floor(n)}catch{}const l="testnet"===ea(t)?i.networks.testnet:i.networks.bitcoin,c=await s(i,r,{requirePsbtMagic:!0});if(c&&c.length>0){let e;try{e="function"==typeof i.Psbt.fromBuffer?i.Psbt.fromBuffer(c,{network:l}):i.Psbt.fromBase64(globalThis.Buffer.from(c).toString("base64"),{network:l})}catch{e=null}const t=Array.isArray(e?.txOutputs)?e.txOutputs:[];if(t.length>=3){const n=Number(t?.[1]?.value),r=Number(t?.[2]?.value),i=Number.isFinite(n)&&n>0?Math.floor(n):0,a=Number(e?.data?.inputs?.[2]?.witnessUtxo?.value),s=Number.isFinite(a)&&a>0?Math.floor(a):null,l=null!==s&&s>i?s-i:0,c=Math.floor(r)-l;Number.isFinite(c)&&c>0&&(o=c)}}}}}catch{o=null}if(Number.isFinite(o)&&o>0)return o;try{const e=Tt(`${a}/api/tx/${r}`),t=await fetch(e);if(!t.ok)return null;const n=await t.json(),o=Array.isArray(n?.vout)?n.vout.find(e=>"op_return"===e?.scriptpubkey_type):null,s=o?.scriptpubkey?function(e){try{let t=String(e||"").trim();if(!t)return null;if(t.startsWith("6a")){t=t.substring(2);const e=parseInt(t.substring(0,2),16);Number.isFinite(e)&&(e<76?t=t.substring(2):76===e?t=t.substring(4):77===e?t=t.substring(6):78===e&&(t=t.substring(10)))}const n=Di(i.Buffer.from(t,"hex"));if(!n||2!==n.version||1!==Number(n.openStoreVersion||0))return null;const r=n.priceSats,a="string"==typeof r?parseInt(r,10):Number(r);return Number.isFinite(a)?a:null}catch{return null}}(o.scriptpubkey):null;return Number.isFinite(s)?s:null}catch{return null}}async function ua({commitTxid:e,network:t}){if(!ra(e))return null;const n=String(e).toLowerCase(),r=ta(t);for(const i of[1,2])try{const e=Tt(`${r}/api/tx/${n}/outspend/${i}`),t=await fetch(e);if(!t.ok)continue;const a=await t.json();if(!a?.spent||!a?.txid)continue;const o=String(a.txid||"").trim();if(ra(o))return o.toLowerCase()}catch{}return null}async function da(e){if(!ra(e))return null;const t=`${String(e).toLowerCase()}:0`,n=await async function(e){const t=kt(`/r/utxo/${e}`),n=await fetch(t);if(!n.ok)return null;const r=await n.json();return r?.inscriptions&&Array.isArray(r.inscriptions)&&0!==r.inscriptions.length?r.inscriptions[0]:null}(t);return n?{outpoint:t,inscriptionId:n}:null}async function pa(e){const t=String(e||"").trim();if(!t)throw new Error("loadMarketplaceConfigFromInscription: inscriptionId is required");const n=kt(`/content/${t}`),r=await fetch(n);if(!r.ok)throw new Error(`Failed to fetch marketplace config inscription (${r.status})`);const i=await r.text();let a;try{a=JSON.parse(i)}catch(o){throw new Error("Marketplace config inscription content must be valid JSON")}return oa(a)}function fa(e){const t=oa(e),r=new Map;return{config:t,getPlatformSellerFee:ia,applyPlatformSellerFeeToMarker:aa,getListingsPage:async({pageSize:e=100,cursorTxid:n=null,includeInscription:i=!0,includePrice:a=!0}={})=>{const o=Math.max(1,Math.min(200,na(e,100))),s=[];let l=n&&ra(n)?String(n).toLowerCase():null,c=null;for(;s.length<o;){let e;try{e=await sa({address:t.marketplaceFeeAddress,network:t.network,cursorTxid:l})}catch(u){if(l)break;throw u}if(!Array.isArray(e)||0===e.length)break;c=String(e[e.length-1]?.txid||"").toLowerCase();for(const n of e){if(s.length>=o)break;const e=String(n?.txid||"").toLowerCase();if(!ra(e))continue;if(!Array.isArray(n?.vout)||!n.vout.find(e=>{return n=e?.scriptpubkey_address,r=e?.value,String(n||"")===t.marketplaceFeeAddress&&Number(r)>=t.minMarketplaceFeeSats;var n,r}))continue;let l=null,c=null,u=await da(e);if(u)c=e;else{const n=await ua({commitTxid:e,network:t.network});if(!n)continue;if(l=e,c=n,u=await da(c),!u)continue}const d=u.inscriptionId,p=`${t.marketplaceFeeAddress}:${e}`;if(r.has(p)){s.push(r.get(p));continue}const f=i?await la(d):null,m=a?await ca({revealTxid:c,network:t.network}):null,g={marketplaceFeeAddress:t.marketplaceFeeAddress,feeTxid:e,commitTxid:l,inscriptionId:d,inscription:f,revealTxid:c,price:m,listedAt:n?.status?.block_time?1e3*n.status.block_time:Date.now(),status:"active"};r.set(p,g),s.push(g)}if(l=c&&ra(c)?c:null,!l)break;if(n&&l===String(n).toLowerCase())break}return{config:t,listings:s,nextCursorTxid:c&&ra(c)?c:null,pageSize:o}},clearCache:()=>r.clear(),buyListing:async(e,{walletProvider:t,fundingUtxos:n=null,feeRateSatPerVb:r=10,autoBroadcast:i=!0}={})=>{if(!t)throw new Error("marketplace.buyListing: walletProvider is required");if(!e?.revealTxid)throw new Error("marketplace.buyListing: listing.revealTxid is required");const a=await Gi();return await a.createAndBroadcastBuyFromRevealTx({walletProvider:t,revealTxid:e.revealTxid,fundingUtxos:n,feeRateSatPerVb:r,autoBroadcast:i})},estimateBuyListing:async(e,{walletProvider:t,buyerChangeAddress:n,feeRateSatPerVb:r=10}={})=>{if(!t)throw new Error("marketplace.estimateBuyListing: walletProvider is required");if(!e?.revealTxid)throw new Error("marketplace.estimateBuyListing: listing.revealTxid is required");const i=await Gi();return await i.estimateBuyNeedFromRevealTx({walletProvider:t,revealTxid:e.revealTxid,buyerChangeAddress:n||"",feeRateSatPerVb:r})},checkListingActive:async e=>{if(!e?.inscriptionId)return{active:!1,reason:"missing inscriptionId"};if(!e?.revealTxid)return{active:!1,reason:"missing revealTxid"};try{const r=await async function(){if(Zi)return Zi;const{initBitcoinProxy:e}=await n(async()=>{const{initBitcoinProxy:e}=await Promise.resolve().then(()=>Ai);return{initBitcoinProxy:e}},__VITE_PRELOAD__),{loadBitcoinLibFromInscription:t}=await n(async()=>{const{loadBitcoinLibFromInscription:e}=await Promise.resolve().then(()=>An);return{loadBitcoinLibFromInscription:e}},__VITE_PRELOAD__);try{e()}catch{}const r=await t();return Zi=r,r}(),i=(()=>{const e=String(t.network||"mainnet").toLowerCase();return"testnet"===e||"signet"===e||"regtest"===e?r.networks.testnet:r.networks.bitcoin})(),a=await fetch(kt(`/r/inscription/${e.inscriptionId}`));if(!a.ok)return{active:!1,reason:`ordinals lookup failed (${a.status})`};const o=await a.json(),s=o?.output||o?.satpoint||o?.location;if(!s)return{active:!1,reason:"inscription has no output/satpoint"};const l=String(s).split(":");if(l.length<2)return{active:!1,reason:"invalid satpoint format"};const c=`${l[0].toLowerCase()}:${Number(l[1])}`,u=await Ji(),d=ta(t.network),p=Tt(`${d}/api/tx/${String(e.revealTxid).toLowerCase()}/hex`),f=await fetch(p);if(!f.ok)return{active:!1,reason:`reveal tx hex fetch failed (${f.status})`};const m=await f.text(),g=String(m||"").trim().replace(/^"|"$/g,"");let h,b;try{h=await u.extractSellerPsbtFromRevealTxWithBitcoinLib(r,g,{requirePsbtMagic:!0})}catch{return{active:!1,reason:"reveal tx does not contain a valid embedded offer PSBT"}}if(!h||0===h.length)return{active:!1,reason:"empty offer PSBT in reveal"};try{b="function"==typeof r.Psbt.fromBuffer?r.Psbt.fromBuffer(globalThis.Buffer.from(h),{network:i}):r.Psbt.fromBase64(globalThis.Buffer.from(h).toString("base64"),{network:i})}catch{return{active:!1,reason:"could not parse embedded offer PSBT"}}const y=(await async function(){return Qi||(Qi=await n(()=>Promise.resolve().then(()=>cs),__VITE_PRELOAD__)),Qi}()).getPsbtInputOutpoint(b,2);return y?y!==c?{active:!1,reason:"inscription has moved since listing (stale)",psbtOutpoint:y,currentOutpoint:c}:{active:!0,psbtOutpoint:y,currentOutpoint:c}:{active:!1,reason:"offer PSBT missing seller input outpoint"}}catch(r){return{active:!1,reason:`validation error: ${r?.message||r}`}}},getListingByRevealTxid:async(e,{includeInscription:n=!0,includePrice:i=!0}={})=>{const a=String(e||"").trim().toLowerCase();if(!ra(a))throw new Error("marketplace.getListingByRevealTxid: invalid revealTxid");const o=`${t.marketplaceFeeAddress}:reveal:${a}`;if(r.has(o))return r.get(o);const s=await da(a);if(!s)return null;const l=n?await la(s.inscriptionId):null,c=i?await ca({revealTxid:a,network:t.network}):null,u={marketplaceFeeAddress:t.marketplaceFeeAddress,feeTxid:a,commitTxid:null,inscriptionId:s.inscriptionId,inscription:l,revealTxid:a,price:c,listedAt:Date.now(),status:"active"};return r.set(o,u),u},listInscription:async({walletProvider:e,inscriptionId:n,priceSats:r,feeRateSatPerVb:i=10,postage:a=546,...o}={})=>{if(!e)throw new Error("marketplace.listInscription: walletProvider is required");if(!n)throw new Error("marketplace.listInscription: inscriptionId is required");if(!r||Number(r)<=0)throw new Error("marketplace.listInscription: priceSats must be > 0");const s=await Ji();return await s.createAndBroadcast3TxSaleListingFlow({walletProvider:e,inscriptionId:n,priceSats:Number(r),feeRateSatPerVb:i,postage:a,platformFeeAddress:t.marketplaceFeeAddress,platformFeeSats:t.marketplaceFeeSats,...o})}}}async function ma(e){await new Promise(t=>setTimeout(t,e))}async function ga(e,t,{timeoutMs:n=2e4,pollMs:r=1500}={}){if(!zt())return!1;if("function"!=typeof fetch)return!1;if(!/^[0-9a-fA-F]{64}$/.test(String(e||"").trim()))return!1;const i=String(e).trim(),a=Date.now(),o=Tt("testnet"===t?`/testnet/api/tx/${i}`:"regtest"===t?`/signet/api/tx/${i}`:`/api/tx/${i}`);for(;Date.now()-a<n;){try{if((await fetch(o,{method:"GET"})).ok)return!0}catch(s){}await ma(r)}return!1}async function ha(e){const t=Xt(e);if(!t)return null;try{const e=await Kt(t),n=e?.satpoint||e?.location||e?.output||null;if(!n||"string"!=typeof n)return null;const r=n.split(":");if(r.length<3)return null;const i=Number(r[2]);return!Number.isFinite(i)||i<0?null:Math.floor(i)}catch{return null}}async function ba(e,t,n,r){const i="function"==typeof e?.getState&&e.getState()?.walletType||"",a=((i||e?.walletType||e?.name||"").toLowerCase?.()||"").includes("unisat");if("function"==typeof e?.pushTx&&!1!==e?.features?.pushTx){const n=String(t||"").trim();let r=null;const i=a?6:3,s=a?1500:800;for(let t=0;t<i;t+=1)try{const t=a?await e.pushTx({rawtx:n}):await e.pushTx(n);if("string"==typeof t&&64===t.length)return t}catch(o){r=o,await ma(s)}Ga()}return await rr(e,t,n,r)}function ya(e,t){if(!e)return null;const n=e?.fullUtxo||e?.utxo||e?.raw||e?.full||e,r=n.txid||n.txId||n.hash,i=n.vout??n.index??n.n,a=n.value??n.satoshis??n.amount,o=n.address||n.addr||t||null,s=n.scriptPubKey||n.scriptHex||n.script||null,l=n.satpoint||n.satPoint||null;let c=n.offset??n.satOffset??n.sat_offset;if(null==c&&l){const e=String(l).split(":");if(e.length>=3){const t=Number(e[2]);Number.isFinite(t)&&t>=0&&(c=t)}}return r&&null!=i&&Number.isFinite(Number(i))&&null!=a&&Number.isFinite(Number(a))?{txid:String(r),vout:Number(i),value:Number(a),address:o,scriptPubKey:s,satpoint:l,offset:c}:null}function xa(e){const t=new Map;return(e||[]).forEach(e=>{if(!e?.txid||void 0===e.vout||null===e.vout)return;const n=`${String(e.txid)}:${Number(e.vout)}`,r=t.get(n);if(!r)return void t.set(n,e);const i=Number(r.value||0);Number(e.value||0)>i&&t.set(n,e)}),Array.from(t.values())}function wa(e,t){const n=Number(e);return!Number.isFinite(n)||n<=0?1500:Math.max(250,Math.ceil(n*t))}function va(e){try{if("undefined"!=typeof window&&!0===window.__OODL_ALLOW_520__)return 520}catch{}const t=String(e||"").toLowerCase();return"mainnet"===t||"testnet"===t?80:520}const Sa=Buffer.from("OODL","utf8"),Ea=Buffer.from("OODL","utf8");function Na(e){let t;try{t="bigint"==typeof e?e:"number"==typeof e?BigInt(Math.floor(e)):"string"==typeof e?BigInt(String(e).trim()):null}catch{t=null}if(null===t||t<0n||t>0xffffffffffffffffn)return null;const n=Buffer.alloc(8);let r=t;for(let i=0;i<8;i+=1)n[i]=Number(0xffn&r),r>>=8n;return n}function Ia(e){const t=e&&"object"==typeof e?e:{},n=[];{const e=Na(t?.priceSats);e&&n.push({t:1,v:e})}{const e=String(t?.collectionKey||"").trim();e&&n.push({t:2,v:Buffer.from(e,"utf8")})}{const e=Number(t?.bitmapNumber);if(Number.isFinite(e)&&e>=0&&e<=4294967295){const t=Buffer.alloc(4);t.writeUInt32LE(Math.floor(e)>>>0,0),n.push({t:3,v:t})}}{const e=Number(t?.parcelNumber);if(Number.isFinite(e)&&e>=0&&e<=4294967295){const t=Buffer.alloc(4);t.writeUInt32LE(Math.floor(e)>>>0,0),n.push({t:4,v:t})}}{const e=Number(t?.minBlockHeight);if(Number.isFinite(e)&&e>=0&&e<=4294967295&&Number.isInteger(e)){const t=Buffer.alloc(4);t.writeUInt32LE(e>>>0,0),n.push({t:5,v:t})}}const r=Array.isArray(t?.multiAssetItems)?t.multiAssetItems:[];if(r.length>1){{const e=Buffer.alloc(2);e.writeUInt16LE(r.length,0),n.push({t:16,v:e})}{const e=Buffer.alloc(8*r.length);for(let t=0;t<r.length;t++){const n=Na(r[t]?.priceSats);n&&n.copy(e,8*t)}n.push({t:17,v:e})}if(r.some(e=>Number.isFinite(Number(e?.bitmapNumber))&&Number(e.bitmapNumber)>=0)){const e=Buffer.alloc(4*r.length);for(let t=0;t<r.length;t++){const n=Number(r[t]?.bitmapNumber);e.writeUInt32LE(Number.isFinite(n)&&n>=0?Math.floor(n)>>>0:4294967295,4*t)}n.push({t:18,v:e})}if(r.some(e=>Number.isFinite(Number(e?.parcelNumber))&&Number(e.parcelNumber)>=0)){const e=Buffer.alloc(4*r.length);for(let t=0;t<r.length;t++){const n=Number(r[t]?.parcelNumber);e.writeUInt32LE(Number.isFinite(n)&&n>=0?Math.floor(n)>>>0:4294967295,4*t)}n.push({t:21,v:e})}{const e=Buffer.alloc(2*r.length);for(let t=0;t<r.length;t++){const n=Number(r[t]?.outputIndex);e.writeUInt16LE(Number.isFinite(n)&&n>=0?n:t,2*t)}n.push({t:19,v:e})}{const e=r.map(e=>{const t=String(e?.inscriptionId||"").trim(),n=Buffer.from(t,"utf8"),r=Buffer.alloc(2);return r.writeUInt16LE(n.length,0),Buffer.concat([r,n])});n.push({t:20,v:Buffer.concat(e)})}}if(0===n.length)return Buffer.alloc(0);const i=Buffer.concat(n.map(({t:e,v:t})=>{const n=Buffer.isBuffer(t)?t:Buffer.from(t||[]),r=Math.min(65535,Math.max(0,n.length>>>0)),i=Buffer.alloc(3);return i[0]=e>>>0&255,i.writeUInt16LE(r,1),Buffer.concat([i,n.subarray(0,r)])})),a=Math.min(65535,i.length>>>0),o=Buffer.alloc(7);return Ea.copy(o,0),o[4]=3,o.writeUInt16LE(a,5),Buffer.concat([o,i.subarray(0,a)])}function Aa(e){const t=Buffer.isBuffer(e)?e:Buffer.from(e||[]);if(t.length<7)return null;if(!Qa(t.subarray(0,4),Ea)||3!==t[4])return null;const n=7+t.readUInt16LE(5);if(n>t.length)return null;const r={};let i=7;for(;i+3<=n;){const e=t[i],a=t.readUInt16LE(i+1);if(i+=3,i+a>n)break;const o=t.subarray(i,i+a);i+=a;try{if(1===e&&8===o.length){let e=0n;for(let t=7;t>=0;t-=1)e=e<<8n|BigInt(o[t]);r.priceSats=e}else if(2===e)r.collectionKey=o.toString("utf8");else if(3===e&&4===o.length)r.bitmapNumber=o.readUInt32LE(0);else if(4===e&&4===o.length)r.parcelNumber=o.readUInt32LE(0);else if(5===e&&4===o.length)r.minBlockHeight=o.readUInt32LE(0);else if(16===e&&2===o.length)r.listingCount=o.readUInt16LE(0);else if(17===e&&o.length>=8){const e=Math.floor(o.length/8);r.pricesArray=[];for(let t=0;t<e;t++){let e=0n;for(let n=7;n>=0;n-=1)e=e<<8n|BigInt(o[8*t+n]);r.pricesArray.push(e)}}else if(18===e&&o.length>=4){const e=Math.floor(o.length/4);r.bitmapNumbersArray=[];for(let t=0;t<e;t++){const e=o.readUInt32LE(4*t);r.bitmapNumbersArray.push(4294967295===e?null:e)}}else if(21===e&&o.length>=4){const e=Math.floor(o.length/4);r.parcelNumbersArray=[];for(let t=0;t<e;t++){const e=o.readUInt32LE(4*t);r.parcelNumbersArray.push(4294967295===e?null:e)}}else if(19===e&&o.length>=2){const e=Math.floor(o.length/2);r.outputIndicesArray=[];for(let t=0;t<e;t++)r.outputIndicesArray.push(o.readUInt16LE(2*t))}else if(20===e&&o.length>=2){r.inscriptionIdsArray=[];let e=0;for(;e+2<=o.length;){const t=o.readUInt16LE(e);if(e+=2,e+t>o.length)break;r.inscriptionIdsArray.push(o.subarray(e,e+t).toString("utf8")),e+=t}}}catch{}}return{meta:r,bytesConsumed:n}}function ka(e,t=0){const n=Buffer.isBuffer(e)?e:Buffer.from(e||[]),r=function(e,t=0){const n=Buffer.isBuffer(e)?e:Buffer.from(e||[]),r=Math.max(0,Math.floor(Number(t||0)));if(n.length<7||r>=n.length)return-1;for(let i=r;i+7<=n.length;i+=1)if(79===n[i]&&79===n[i+1]&&68===n[i+2]&&76===n[i+3]&&3===n[i+4])return i;return-1}(n,t);return r<0?null:Aa(n.subarray(r))}function Ta(e,t=0){const n=Buffer.isBuffer(e)?e:Buffer.from(e||[]),r=Math.max(0,Math.floor(Number(t||0)));if(n.length<5||r>=n.length)return-1;for(let i=r;i+5<=n.length;i+=1)if(n[i]===Sa[0]&&n[i+1]===Sa[1]&&n[i+2]===Sa[2]&&n[i+3]===Sa[3]&&(1===n[i+4]||2===n[i+4]))return i;return-1}async function Ca(e){const t=Buffer.isBuffer(e)?e:Buffer.from(e||[]);try{if("undefined"!=typeof window){const{brotliDecompressBytes:e}=await n(async()=>{const{brotliDecompressBytes:e}=await Promise.resolve().then(()=>Oi);return{brotliDecompressBytes:e}},__VITE_PRELOAD__),r=await e(Uint8Array.from(t));return Buffer.from(r)}}catch{}try{const e=await n(()=>Promise.resolve().then(()=>ak),__VITE_PRELOAD__);return Buffer.from(e.brotliDecompressSync(t))}catch(r){throw new Error(`brotliDecompressBytesUniversal: brotli unavailable (${r?.message||r})`)}}async function Ba(e,{compress:t=!1}={}){const r=Buffer.isBuffer(e)?e:Buffer.from(e||[]),i=(()=>{const e=r.length>>>0,t=Buffer.alloc(9);return Sa.copy(t,0),t[4]=1,t.writeUInt32LE(e,5),Buffer.concat([t,r])})();if(!t)return i;try{const e=await async function(e){const t=Buffer.isBuffer(e)?e:Buffer.from(e||[]);try{if("undefined"!=typeof window){const{brotliCompressBytes:e}=await n(async()=>{const{brotliCompressBytes:e}=await Promise.resolve().then(()=>Oi);return{brotliCompressBytes:e}},__VITE_PRELOAD__),r=await e(Uint8Array.from(t));return Buffer.from(r)}}catch{}try{const e=await n(()=>Promise.resolve().then(()=>ak),__VITE_PRELOAD__);return Buffer.from(e.brotliCompressSync(t))}catch(r){throw new Error(`brotliCompressBytesUniversal: brotli unavailable (${r?.message||r})`)}}(r),t=e.length>>>0,a=r.length>>>0,o=1,s=Buffer.alloc(14);Sa.copy(s,0),s[4]=2,s[5]=o,s.writeUInt32LE(a,6),s.writeUInt32LE(t,10);const l=Buffer.concat([s,e]);return l.length<i.length?l:i}catch{return i}}function Pa(e){const t=Buffer.isBuffer(e)?e:Buffer.from(e||[]);if(t.length<9)return null;if(!Qa(t.subarray(0,4),Sa))return null;const n=t[4];if(1===n){const e=t.readUInt32LE(5),r=9,i=r+e;return i>t.length?null:{version:n,flags:0,rawLen:e,payload:t.subarray(r,i)}}if(2===n){if(t.length<14)return null;const e=t[5]||0,r=t.readUInt32LE(6),i=14,a=i+t.readUInt32LE(10);return a>t.length?null:{version:n,flags:e,rawLen:r,payload:t.subarray(i,a)}}return null}async function _a(e,{requirePsbtMagic:t=!0}={}){const n=Buffer.isBuffer(e)?e:Buffer.from(e||[]),r=Aa(n),i=r?.bytesConsumed||0;let a=Pa(n.subarray(i));if(!a){const e=Ta(n,i);e>=0&&(a=Pa(n.subarray(e)))}if(!a)return t&&!Fa(n)?null:n;if(1===a.version){const e=a.payload;return t&&!Fa(e)?null:e}if(2===a.version){if(!(1&a.flags)){const e=a.payload;return t&&!Fa(e)?null:e}const e=await Ca(a.payload);return Number.isFinite(Number(a.rawLen))&&a.rawLen>0&&e.length!==a.rawLen||t&&!Fa(e)?null:e}return null}async function Oa(e,{marker:t=null,compress:n=!1}={}){const r=await Ba(e,{compress:n}),i=Ia(t);return i&&0!==i.length?Buffer.concat([i,r]):r}function La(e,t){const n=Buffer.isBuffer(t)?t:Buffer.from(t||[]),r=e?.script?.decompile?e.script.decompile(n):null;if(!Array.isArray(r)||r.length<2)return null;const i=e?.opcodes?.OP_DROP,a=e?.opcodes?.OP_CHECKSIG;if(void 0===i||void 0===a)return null;let o=0;for(;o<r.length&&r[o]===i;)o+=1;if(o<=0)return null;if(r.length!==o+2)return null;const s=r[o],l=r[o+1];return Buffer.isBuffer(s)&&32===s.length?l!==a?null:o:null}function Fa(e){const t=Buffer.isBuffer(e)?e:Buffer.from(e||[]);return!(t.length<5)&&t.subarray(0,5).equals(Buffer.from("70736274ff","hex"))}async function Ma(e,t,n={}){const{inputIndex:r=null,expectedWitnessScriptHex:i=null,expectedControlBlockHex:a=null,requirePsbtMagic:o=!0}=n||{};if(!e)throw new Error("extractSellerPsbtFromRevealTxWithBitcoinLib: bitcoinLib is required");if(!t||"string"!=typeof t)throw new Error("extractSellerPsbtFromRevealTxWithBitcoinLib: txHex string is required");const s=e.Transaction.fromHex(t),l=Array.isArray(s?.ins)?s.ins:[];if(0===l.length)throw new Error("extractSellerPsbtFromRevealTxWithBitcoinLib: tx has no inputs");const c=i?Buffer.from(i,"hex"):null,u=a?Buffer.from(a,"hex"):null,d=async t=>{if(!Array.isArray(t)||t.length<4)return null;const n=t[t.length-2],r=t[t.length-1];if(!Buffer.isBuffer(n)||0===n.length)return null;if(i=r,!Buffer.isBuffer(i)||i.length<33||(i.length-33)%32!=0)return null;var i;if(c&&!Qa(n,c))return null;if(u&&!Qa(r,u))return null;const a=La(e,n);if(!a)return null;const s=1+a+2;if(t.length!==s)return null;const l=e=>Buffer.isBuffer(e)?e:Buffer.from(e||[]),d=t.slice(1,1+a).map(l),p=Buffer.concat(d.filter(e=>(e?.length||0)>0)),f=await _a(p,{requirePsbtMagic:o});if(f)return{payload:f,maxChunks:a,layout:"legacy"};const m=t.slice(0,a).map(l),g=Buffer.concat(m.filter(e=>(e?.length||0)>0)),h=await _a(g,{requirePsbtMagic:o});return h?{payload:h,maxChunks:a,layout:"chunks-first"}:null};if("number"==typeof r&&r>=0){const e=l[r]?.witness||null,t=await d(e);if(!t)throw new Error(`extractSellerPsbtFromRevealTxWithBitcoinLib: input ${r} did not match data-carrier witness pattern`);return t.payload}for(let p=0;p<l.length;p++){const e=l[p]?.witness||null,t=await d(e);if(t)return t.payload}throw new Error("extractSellerPsbtFromRevealTxWithBitcoinLib: no input matched expected data-carrier witness layout")}async function Ra(e,t,n={}){const{inputIndex:r=null,expectedWitnessScriptHex:i=null,expectedControlBlockHex:a=null}=n||{};if(!e)throw new Error("extractOodlListingMetadataFromRevealTxWithBitcoinLib: bitcoinLib is required");if(!t||"string"!=typeof t)throw new Error("extractOodlListingMetadataFromRevealTxWithBitcoinLib: txHex string is required");const o=e.Transaction.fromHex(t),s=Array.isArray(o?.ins)?o.ins:[];if(0===s.length)throw new Error("extractOodlListingMetadataFromRevealTxWithBitcoinLib: tx has no inputs");const l=i?Buffer.from(i,"hex"):null,c=a?Buffer.from(a,"hex"):null,u=e=>Buffer.isBuffer(e)?e:Buffer.from(e||[]),d=t=>{if(!Array.isArray(t)||t.length<4)return null;const n=t[t.length-2],r=t[t.length-1];if(!Buffer.isBuffer(n)||0===n.length)return null;if(i=r,!Buffer.isBuffer(i)||i.length<33||(i.length-33)%32!=0)return null;var i;if(l&&!Qa(n,l))return null;if(c&&!Qa(r,c))return null;try{const r=La(e,n);if(r){const e=1+r+2;if(t.length===e){const e=t.slice(1,1+r).map(u),n=Buffer.concat(e.filter(e=>(e?.length||0)>0)),i=ka(n,0);if(i)return i.meta;const a=t.slice(0,r).map(u),o=Buffer.concat(a.filter(e=>(e?.length||0)>0)),s=ka(o,0);if(s)return s.meta}}}catch{}const a=t.slice(0,Math.max(0,t.length-2)).map(u),o=Buffer.concat(a.filter(e=>(e?.length||0)>0)),s=ka(o,0);return s?s.meta:null};if("number"==typeof r&&r>=0)return d(s[r]?.witness||null);for(let p=0;p<s.length;p+=1){const e=d(s[p]?.witness||null);if(e)return e}return null}async function $a(e,t={}){const n=await In();return await Ma(n,e,t)}function Ua(e,t=80){const n=Buffer.isBuffer(e)?e:Buffer.from(e),r=Math.max(1,Math.floor(Number(t||80))),i=[];for(let a=0;a<n.length;a+=r)i.push(n.subarray(a,a+r));return i}function za(e){const t=Math.max(0,Math.floor(Number(e||0)));return t<253?1:t<=65535?3:t<=4294967295?5:9}function Da(e){const t="undefined"!=typeof window&&window.__NEXUS_NETWORK__||"mainnet";return"testnet"===String(t).toLowerCase()||"signet"===String(t).toLowerCase()||"regtest"===String(t).toLowerCase()?e.networks.testnet:e.networks.bitcoin}function Ha(){const e="undefined"!=typeof window&&window.__NEXUS_NETWORK__||"mainnet",t=String(e).toLowerCase();return"testnet"===t||"signet"===t||"regtest"===t?"testnet":"mainnet"}function Wa(e,t){const n=(e||[]).map(e=>ya(e,null)).filter(Boolean);if(0===n.length)return null;const r=n.slice().sort((e,t)=>t.value-e.value),i=wa(t,180)+547;return r.find(e=>e.value>i)||r[0]}function ja(e,t,n,r){if(n?.scriptPubKey&&"string"==typeof n.scriptPubKey&&/^[0-9a-fA-F]+$/.test(n.scriptPubKey))return Buffer.from(n.scriptPubKey,"hex");const i=n?.address||r;if(!i)throw new Error("Missing address for input script");return e.address.toOutputScript(i,t)}function Va(e){const t=Number(e);return Number.isFinite(t)?Math.max(0,Math.floor(t)):null}function qa(e){if(!e)return null;if("function"==typeof e.toBuffer)return e.toBuffer();if("function"==typeof e.toBase64)try{return Buffer.from(e.toBase64(),"base64")}catch{return null}return null}function Xa(e){try{const t=e?.data?.globalMap;t&&(t.globalXpub&&delete t.globalXpub,Array.isArray(t.unknownKeyVals)&&(t.unknownKeyVals=[]));const n=Array.isArray(e?.data?.inputs)?e.data.inputs:[];for(const e of n)e&&(e.nonWitnessUtxo&&delete e.nonWitnessUtxo,e.bip32Derivation&&delete e.bip32Derivation,e.tapBip32Derivation&&delete e.tapBip32Derivation,e.redeemScript&&delete e.redeemScript,e.witnessScript&&delete e.witnessScript,e.tapInternalKey&&delete e.tapInternalKey,e.tapMerkleRoot&&delete e.tapMerkleRoot,e.tapLeafScript&&delete e.tapLeafScript,e.tapScriptSig&&delete e.tapScriptSig,Array.isArray(e.unknownKeyVals)&&(e.unknownKeyVals=[]),Array.isArray(e.proprietaryKeyVals)&&(e.proprietaryKeyVals=[]));const r=Array.isArray(e?.data?.outputs)?e.data.outputs:[];for(const e of r)e&&(e.bip32Derivation&&delete e.bip32Derivation,e.tapBip32Derivation&&delete e.tapBip32Derivation,Array.isArray(e.unknownKeyVals)&&(e.unknownKeyVals=[]),Array.isArray(e.proprietaryKeyVals)&&(e.proprietaryKeyVals=[]))}catch{}return e}function Ka(e,t){if("bigint"!=typeof e)throw new Error(`${t}: expected bigint`);if(e<0n)throw new Error(`${t}: negative value`);if(e>BigInt(Number.MAX_SAFE_INTEGER))throw new Error(`${t}: value too large for JS number (${e.toString()})`);return Number(e)}function Ga(){try{return"undefined"!=typeof window&&!!window.__OODL_DEBUG__}catch{return!1}}function Ya(e,t){const n=(e||[]).map(e=>String(e||"")).filter(Boolean),r=new Set,i=new Set;for(const a of n)r.has(a)?i.add(a):r.add(a);if(i.size>0){const e=`${t}: duplicate inputs detected: ${Array.from(i).join(", ")}`;throw Ga(),new Error(e)}}function Ja(e){return e?.__CACHE?.__TX||e?.data?.globalMap?.unsignedTx?.tx||null}function Qa(e,t){const n=Buffer.isBuffer(e)?e:Buffer.from(e||[]),r=Buffer.isBuffer(t)?t:Buffer.from(t||[]);return n.length===r.length&&n.equals(r)}function Za(e){try{const t=Ja(e);if(!t)return null;if("function"==typeof t.getId)return t.getId();if("function"==typeof t.getHash){const e=t.getHash();if(e&&32===Buffer.from(e).length)return Buffer.from(e).reverse().toString("hex")}return null}catch{return null}}function eo(e,t,n){const r=e.Psbt.fromHex(t,{network:n});try{r.finalizeAllInputs()}catch(a){for(let e=0;e<r.data.inputs.length;e++)try{r.data.inputs[e].finalScriptWitness||r.data.inputs[e].finalScriptSig||r.finalizeInput(e)}catch(o){}}const i=r.extractTransaction();return{txHex:i.toHex(),txid:i.getId()}}async function to(e,t,n){const r=await nr(e,t,{autoFinalized:!0,toSignInputs:n},!1);return r?.signedPsbt||null}async function no(e,t,n,r={}){const i=await nr(e,t,{autoFinalized:!1,toSignInputs:n,...r},!1);return i?.signedPsbt||null}async function ro(e,t,n,r,i){const{txHex:a,txid:o}=eo(n,t,r);return{txid:await rr(e,{txHex:a,psbtBase64:Buffer.from(t,"hex").toString("base64")},Ha(),i)||o,txHex:a,actualTxid:o}}async function io({parentUtxo:e,fundingUtxo:t,fundingUtxos:n,listingScriptAddress:r,markerValueSats:i,dummyScript:a,dummyValueSats:o,dummyCount:s=0,sellerChangeAddress:l,feeRateSatPerVb:c,paymentPublicKey:u=null,bitcoinLib:d=null,oodlFeeAddress:p=null,oodlFeeSats:f=null}){const m=d||await In(),g=Da(m),h=ya(e,l);if(!h)throw new Error("buildListingCommitTx: invalid parentUtxo");const b=[];t&&b.push(t),Array.isArray(n)&&b.push(...n);const y=`${h.txid}:${h.vout}`,x=xa(b.map(e=>ya(e,l)).filter(Boolean).filter(e=>`${e.txid}:${e.vout}`!==y));if(0===x.length)throw new Error("buildListingCommitTx: invalid fundingUtxo");if(!r||"string"!=typeof r)throw new Error("buildListingCommitTx: listingScriptAddress is required");const w=Va(h.value);if(!w||w<=0)throw new Error("buildListingCommitTx: parentUtxo.value must be > 0");const v=Va(i);if(!v||v<=0)throw new Error("buildListingCommitTx: markerValueSats must be > 0");const S=546,E=null==h?.offset?void 0:Number(h.offset);if(!Number.isFinite(E)||E<0||E>=w)throw new Error("buildListingCommitTx: parentUtxo.offset is required and must be within [0, value-1] to safely align the inscription for sale");const N=E,I=N>0&&N<S,A=Math.max(0,Math.floor(Number(s||0))),k=A>0?Va(o):0;if(A>0){if(!a||!Buffer.isBuffer(a)||0===a.length)throw new Error("buildListingCommitTx: dummyScript (Buffer) is required when dummyCount > 0");if(!k||k<=0)throw new Error("buildListingCommitTx: dummyValueSats must be > 0 when dummyCount > 0")}const T=e=>"string"==typeof e&&e.startsWith("bc1p")?"p2tr":"p2wpkh",C=e=>"p2tr"===T(e?.address)?58:68,B=e=>"p2tr"===T(e)?43:31,P=(e,{hasPrefix:t,prefixAddress:n=null,hasRemainder:r,hasChange:i,dummyCount:a})=>{const o=C(h),s=(e||[]).reduce((e,t)=>e+C(t),0);let c=0;return t&&(c+=B(n||h.address||l)),c+=B(h.address||l),c+=43,a&&Number(a)>0&&(c+=43*Math.max(0,Math.floor(Number(a||0)))),H>0&&(c+=43),i&&(c+=B(l)),10+o+s+c+6},_=w-N;if(_<S)throw new Error(`buildListingCommitTx: aligned inscription output would be dust. parentValue=${w} offset=${N} alignedValue=${_} dust=546`);const O=x.slice().sort((e,t)=>(t.value||0)-(e.value||0)),L=I?Math.max(1,S-N):0,F=I&&O.find(e=>Va(e?.value)>=L)||null;if(I&&!F)throw new Error(`buildListingCommitTx: inscription offset is too small to create a standard prefix output without OP_RETURN. Need a funding UTXO with >= ${L} sats to pad the prefix. Consolidate/split payment UTXOs and try again.`);const M=[];let R=0,$=0,U=!1,z=0,D=0;const H=f?Va(f):0,W=new Set,j=(e,{countsTowardCosts:t})=>{const n=Va(e?.value);if(!n||n<=0)return!1;const r=`${e.txid}:${e.vout}`;return!W.has(r)&&(W.add(r),M.push({...e,value:n}),R+=n,t&&($+=n),!0)};F&&j(F,{countsTowardCosts:!1});const V=I?l:h.address||l;for(const pe of O){if(F&&`${pe.txid}:${pe.vout}`==`${F.txid}:${F.vout}`)continue;if(!j(pe,{countsTowardCosts:!0}))continue;const e=E>0,t=!1,n=A>0?k*A:0,r=wa(c,P(M,{hasPrefix:e,prefixAddress:V,hasRemainder:t,hasChange:!1,dummyCount:A})),i=v+n+H+r;if(!($<i)){if($-i>S&&l){const r=wa(c,P(M,{hasPrefix:e,prefixAddress:V,hasRemainder:t,hasChange:!0,dummyCount:A})),i=$-v-n-H-r;if(i>S){U=!0,z=i,D=r;break}}U=!1,z=0,D=r;break}}if(0===M.length)throw new Error("buildListingCommitTx: no usable funding UTXOs (all invalid/zero)");if(I&&M.length<2)throw new Error("buildListingCommitTx: need at least one additional funding UTXO (besides the padding UTXO) to fund listing outputs/fees. Select more payment UTXOs or consolidate and try again.");if($<=v){const e=O[0],t=e?`${e.txid}:${e.vout}`:"unknown";throw new Error(`buildListingCommitTx: funding UTXO(s) are insufficient to fund marker output (fundingTotal=${$} sats, markerValue=${v} sats, largestFundingOutpoint=${t})`)}if(U&&(!l||"string"!=typeof l))throw new Error("buildListingCommitTx: sellerChangeAddress is required when change output is needed");const q=ja(m,g,h,l),X=m.address.toOutputScript(r,g),K=U?m.address.toOutputScript(l,g):null,G=new m.Psbt({network:g}),Y=F?`${F.txid}:${F.vout}`:null,J=Y?M.filter(e=>`${e.txid}:${e.vout}`!==Y):M;Ya([...Y?[Y]:[],`${h.txid}:${h.vout}`,...J.map(e=>`${e.txid}:${e.vout}`)],"buildListingCommitTx");const Q=[],Z=e=>{const t=e?.address||l;let n,r={};if(u&&(t.startsWith("3")||t.startsWith("2"))){const e=Buffer.from(u,"hex"),t=m.payments.p2wpkh({pubkey:e,network:g});n=m.payments.p2sh({redeem:t,network:g}).output,r.redeemScript=t.output,Ga()}else n=ja(m,g,e,l);const i=Array.isArray(G?.data?.inputs)?G.data.inputs.length:0;G.addInput({hash:e.txid,index:e.vout,witnessUtxo:{script:n,value:Va(e.value)},sequence:4294967293,...r}),Q.push({txid:e.txid,vout:e.vout,value:Va(e.value),address:e.address||l,inputIndex:i})};if(Y){const e=M.find(e=>`${e.txid}:${e.vout}`===Y);if(!e)throw new Error("buildListingCommitTx: internal error: padder missing from selected funding");Z(e)}const ee=Array.isArray(G?.data?.inputs)?G.data.inputs.length:0;G.addInput({hash:h.txid,index:h.vout,witnessUtxo:{script:q,value:w},sequence:4294967293}),J.forEach(Z);const te=N,ne=w-te;let re,ie=0;if(te>0){const e=Y?Va(F?.value):0,t=te+(I?e:0),n=I?m.address.toOutputScript(l,g):q;G.addOutput({script:n,value:t}),ie++}re=ie,G.addOutput({script:q,value:ne}),ie++;const ae=ie;G.addOutput({script:X,value:v}),ie++;const oe=[];if(A>0)for(let pe=0;pe<A;pe++)oe.push(ie),G.addOutput({script:a,value:k}),ie++;const se=oe[0];if(H>0&&p){const e=m.address.toOutputScript(p,g);G.addOutput({script:e,value:H}),ie++}let le;U&&(le=ie,G.addOutput({script:K,value:z}),ie++);const ce=Y?Va(F?.value):0,ue=R-ce-v-(A>0?k*A:0)-H-(U?z:0);if(ue<=0)throw new Error("buildListingCommitTx: computed fee <= 0 (insufficient funding)");const de=Za(G);if(Ga()){const e=qa(G);e&&e.length,(()=>{try{return e?m.crypto.sha256(e).toString("hex"):null}catch{return null}})()}return{psbt:G,summary:{commitPsbtBase64:G.toBase64(),unsignedCommitTxid:de,parentInputIndex:ee,parentInput:{txid:h.txid,vout:h.vout,value:w},fundingInputs:Q,parentOutputIndex:re,parentOutputValueSats:ne,listingScriptOutputIndex:ae,...A>0?{dummyOutputIndex:se}:{},dummyOutputIndexes:oe,dummyCount:A,...U?{changeOutputIndex:le}:{},feeSats:ue}}}async function ao({walletProvider:e,parentUtxo:t,fundingUtxo:n,fundingUtxos:r,listingScriptAddress:i,markerValueSats:a,sellerChangeAddress:o,feeRateSatPerVb:s,bitcoinLib:l=null,broadcast:c=!0,oodlFeeAddress:u=null,oodlFeeSats:d=null}){if(!e)throw new Error("createAndBroadcastListingCommitTx: walletProvider is required");if(!o)throw new Error("createAndBroadcastListingCommitTx: sellerChangeAddress is required");const p=l||await In(),f=Da(p),m=ya(t,o);if(!m)throw new Error("createAndBroadcastListingCommitTx: invalid parentUtxo");const g=ya(n,o),h=[];g&&h.push(g),Array.isArray(r)&&h.push(...r.map(e=>ya(e,o)).filter(Boolean));const b=xa(h).filter(e=>`${e.txid}:${e.vout}`!=`${m.txid}:${m.vout}`);if(0===b.length)throw new Error("createAndBroadcastListingCommitTx: invalid fundingUtxo");if(!m.address)throw new Error("createAndBroadcastListingCommitTx: parentUtxo.address is required");const y=e?.getState?.()||{};let x=y?.paymentPublicKey||y?.publicKey||null;x&&x.startsWith("0x")&&(x=x.slice(2));const{psbt:w,summary:v}=await io({parentUtxo:m,fundingUtxo:b[0],fundingUtxos:b,listingScriptAddress:i,markerValueSats:a,sellerChangeAddress:o,feeRateSatPerVb:s,paymentPublicKey:x,bitcoinLib:p,oodlFeeAddress:u,oodlFeeSats:d}),S=w.toHex();Ga();const E=v.unsignedCommitTxid;if(!E)throw new Error("createAndBroadcastListingCommitTx: failed to compute commit txid from unsigned tx");const N=await nr(e,S,{autoFinalized:!0,toSignInputs:[{index:v.parentInputIndex,address:m.address},...(v?.fundingInputs||[]).map(e=>({index:e.inputIndex,address:e.address||o}))]},!!c),I=N?.signedPsbt||null,A=c&&N?.txid||null;if(I)try{let e;try{e=p.Psbt.fromHex(I,{network:f})}catch{e=p.Psbt.fromBase64(I,{network:f})}const t=Za(e);if(t&&String(t).toLowerCase()!==String(E).toLowerCase())throw new Error(`createAndBroadcastListingCommitTx: commit txid changed after signing (predicted=${E} signed=${t}). This likely means a non-SegWit input/scriptSig is affecting the txid.`)}catch(B){throw B}const k=`${E}:${v.parentOutputIndex}`,T=`${E}:${v.listingScriptOutputIndex}`,C="number"==typeof v.changeOutputIndex?`${E}:${v.changeOutputIndex}`:null;return{...v,txid:A,predictedTxid:E,unsignedTxid:E,signedPsbt:I,method:N?.method,parentOutpointAfterCommit:k,listingFundingOutpoint:T,changeOutpoint:C}}async function oo({walletProvider:e,parentUtxo:t,fundingUtxo:r,fundingUtxos:i,listingScriptAddress:a,markerValueSats:o,sellerChangeAddress:s,feeRateSatPerVb:l,marker:c,bitcoinLib:u=null,broadcast:d=!0,batchSignOfferAndCommit:p=!1,batchSignCommitAndReveal:f=!1,oodlFeeAddress:m=null,oodlFeeSats:g=null,emitOpReturnMarker:h=!1,emitParcelHintOpReturn:b=!1,maxOfferBytesForFunding:y=5e3,compressEmbeddedOffer:x=!1,onProgress:w=null}){if(!e)throw new Error("createAndBroadcast3TxSaleListingFlow: walletProvider is required");const v="function"==typeof e?.getState&&e.getState()?.walletType||"";if(((v||e?.walletType||e?.name||"").toLowerCase?.()||"").includes("phantom"))throw new Error("Phantom wallet is not supported for creating Open Store listings (requires 0x83 SIGHASH_SINGLE|ANYONECANPAY offer signing).");if(!c||"object"!=typeof c)throw new Error("createAndBroadcast3TxSaleListingFlow: marker is required");const S=u||await In(),E=Da(S),N=e?.getState?.()||{},I=(()=>{const e=N?.ordinalsPublicKey||null;if(!e||"string"!=typeof e)return null;const t=e.startsWith("0x")?e.slice(2):e;return/^[0-9a-fA-F]{64}$/.test(t)||/^[0-9a-fA-F]{66}$/.test(t)?t:null})(),A=(()=>{const e=N?.paymentPublicKey||N?.publicKey||null;if(!e||"string"!=typeof e)return null;const t=e.startsWith("0x")?e.slice(2):e;return/^[0-9a-fA-F]{64}$/.test(t)||/^[0-9a-fA-F]{66}$/.test(t)?t:null})(),k=I?64===I.length?Buffer.from(I,"hex"):66===I.length?Buffer.from(I.slice(2),"hex"):null:null,T=A?64===A.length?Buffer.from(A,"hex"):66===A.length?Buffer.from(A.slice(2),"hex"):null:null,C=e=>{const t="string"==typeof e?e:"";if(!t)return null;const n=N?.ordinalsAddress||N?.address||"",r=N?.paymentAddress||N?.address||"";return t&&n&&t===n?k:t&&r&&t===r?T:null},B=ya(t,s);if(!B)throw new Error("createAndBroadcast3TxSaleListingFlow: invalid parentUtxo");const P=[];r&&P.push(r),Array.isArray(i)&&P.push(...i);const _=`${B.txid}:${B.vout}`,O=xa(P.map(e=>ya(e,s)).filter(Boolean).filter(e=>`${e.txid}:${e.vout}`!==_));if(0===O.length)throw new Error("createAndBroadcast3TxSaleListingFlow: invalid fundingUtxo");const L=O.slice().sort((e,t)=>(t.value||0)-(e.value||0))[0];if(!B.address)throw new Error("createAndBroadcast3TxSaleListingFlow: parentUtxo.address is required");L&&!L.address&&(L.address=s),!A&&O.some(e=>{const t=e?.address||s;return t&&(t.startsWith("3")||t.startsWith("2"))});let F=null,M=a&&"string"==typeof a?a:null;const R=!1!==x?14:9;if(!M){const t=va(Ha()),n=await(async()=>{try{const t=e?.getState?.()?.ordinalsAddress||s;if(!t)throw new Error("no reveal recipient address for sizing");const n=S.address.toOutputScript(t,E),r=1,i=new S.Psbt({network:E}),a=Buffer.alloc(32,0),o=4294967294,l=4294967295,u={script:Buffer.from("0014"+"00".repeat(20),"hex"),value:1};i.addInput({hash:a,index:o,sequence:4294967293,witnessUtxo:u}),i.addInput({hash:a,index:l,sequence:4294967293,witnessUtxo:u});const d="11".repeat(32),p=(S.Transaction?.SIGHASH_SINGLE??3)|(S.Transaction?.SIGHASH_ANYONECANPAY??128);i.addInput({hash:d,index:0,witnessUtxo:{script:Buffer.from(n),value:r},sighashType:p,sequence:4294967293});try{const e="string"==typeof B.address&&(B.address.startsWith("bc1p")||B.address.startsWith("tb1p")),t=C(B.address)||k;e&&t&&i?.data?.inputs?.[2]&&(i.data.inputs[2].tapInternalKey=t)}catch{}i.addOutput({address:W,value:0}),i.addOutput({address:W,value:1}),i.addOutput({address:W,value:1});try{i?.data?.inputs?.[2]&&(i.data.inputs[2].tapKeySig=Buffer.alloc(65,1))}catch{}Xa(i);const f=qa(i);if(!f)throw new Error("failed to serialize dummy offer PSBT");const m=await Oa(f,{marker:c,compress:!1!==x});return Math.max(0,m?.length||0)}catch{const e=Math.max(0,Math.floor(Number(y??5e3)));return R+e+64}})(),r=2,i=Math.max(1,Math.min(64,Math.ceil(n/t)+r));if(F=await On(S,E,i),M=F?.taprootPayment?.address||null,!M)throw new Error("createAndBroadcast3TxSaleListingFlow: failed to auto-generate listing script address")}if(!F)throw new Error("createAndBroadcast3TxSaleListingFlow: listingScriptAddress must be left blank. Full on-chain PSBT embedding requires an auto-generated Taproot data-carrier output.");const $=Math.max(1,Math.floor(Number(F?.maxChunks||64))),U=null==o;let z=U?2e3:o;const D=ja(S,E,B,s),H=Va(B.value);if(!H||H<=0)throw new Error("createAndBroadcast3TxSaleListingFlow: parentUtxo.value must be > 0");if(void 0===B.offset||null===B.offset){const e=await ha(c?.parentInscriptionId);null!=e&&(B.offset=e,Ga())}const W=(c?.sellerAddress&&"string"==typeof c.sellerAddress?c.sellerAddress:null)||s,j=Va(B.value),V=null==B?.offset?null:Number(B.offset);if(!j||j<=0)throw new Error("createAndBroadcast3TxSaleListingFlow: parentUtxo.value must be > 0");if(!Number.isFinite(V)||V<0||V>=j)throw new Error("createAndBroadcast3TxSaleListingFlow: parentUtxo.offset is required and must be within [0, value-1]");const q=BigInt(j-V);if(q<=0n)throw new Error("createAndBroadcast3TxSaleListingFlow: computed postage must be > 0");const X=va(Ha());let K=c?.postageSats;if("number"==typeof K&&(K=BigInt(Math.floor(K))),"string"==typeof K&&(K=BigInt(K)),null==K)K=q;else{if("bigint"!=typeof K)throw new Error("createAndBroadcast3TxSaleListingFlow: marker.postageSats must be bigint|number|string");if(K<=0n)throw new Error("createAndBroadcast3TxSaleListingFlow: marker.postageSats must be > 0");if(K!==q)throw new Error(`createAndBroadcast3TxSaleListingFlow: marker.postageSats must equal the actual inscription UTXO value after alignment (marker=${K.toString()} computed=${q.toString()})`)}let G=c?.priceSats;if("number"==typeof G&&(G=BigInt(Math.floor(G))),"string"==typeof G&&(G=BigInt(G)),"bigint"!=typeof G)throw new Error("createAndBroadcast3TxSaleListingFlow: marker.priceSats must be bigint|number|string");if(G<=0n)throw new Error("createAndBroadcast3TxSaleListingFlow: sale price must be > 0 sats");const Y=(S.Transaction?.SIGHASH_SINGLE??3)|(S.Transaction?.SIGHASH_ANYONECANPAY??128);let J=null,Q=null,Z=null;const ee=Math.max(0,Math.floor(Number(y??5e3))),te=R+ee,ne=await(async()=>{if(!h)return null;const e=S.address.toOutputScript(W,E),t=S.crypto.sha256(e).toString("hex");return ji({...c||{},version:2,openStoreVersion:1,sellerScriptHashHex:t,postageSats:K.toString(),psbtHashHex:"0".repeat(64)},S)})(),re=await(async()=>{if(!b)return null;if("parcel"!==String(c?.collectionKey||"").toLowerCase())return null;const e=Number(c?.parcelNumber),t=Number(c?.bitmapNumber);if(!Number.isFinite(e)||e<0)return null;if(!Number.isFinite(t)||t<0)return null;try{return await qi({parcelNumber:Math.floor(e),bitmapNumber:Math.floor(t)},S)}catch{return null}})();for(let n=0;n<6;n++){const e=await io({parentUtxo:B,fundingUtxo:L,fundingUtxos:O,listingScriptAddress:M,markerValueSats:z,dummyCount:0,sellerChangeAddress:s,feeRateSatPerVb:l,paymentPublicKey:A,bitcoinLib:S,oodlFeeAddress:null,oodlFeeSats:null});if(J=e.psbt,Q=e.summary,Z=Q?.unsignedCommitTxid,!Z)throw new Error("createAndBroadcast3TxSaleListingFlow: failed to compute commit txid");Q.changeOutputIndex;try{const e="string"==typeof B.address&&(B.address.startsWith("bc1p")||B.address.startsWith("tb1p")),t=C(B.address)||k;e&&t&&J?.data?.inputs?.[0]&&(J.data.inputs[0].tapInternalKey=t);for(const n of Q?.fundingInputs||[]){const e=Number(n?.inputIndex);if(!Number.isFinite(e)||e<0)continue;const t=n?.address||s,r="string"==typeof t&&(t.startsWith("bc1p")||t.startsWith("tb1p")),i=C(t)||T;r&&i&&J?.data?.inputs?.[e]&&(J.data.inputs[e].tapInternalKey=i)}}catch{}if(!U)break;const t=$*X,n=Math.min(te,t),r=Math.max(1,Math.ceil(n/X));!F||Buffer.from(F.witnessScript).length;const i=e=>{const t=new S.Transaction;t.version=2,t.addInput(Buffer.from(Z,"hex").reverse(),Q.parentOutputIndex,4294967293),t.addInput(Buffer.from(Z,"hex").reverse(),Q.listingScriptOutputIndex,4294967293),t.addOutput(Buffer.from(D),Va(Q.parentOutputValueSats));const n=g?Va(g):0;if(n>0&&m){const e=S.address.toOutputScript(m,E);t.addOutput(e,n)}if(ne&&t.addOutput(ne,0),re&&t.addOutput(re,0),e){const e=S.address.toOutputScript(s,E);t.addOutput(e,1e3)}t.ins[0].witness=[Buffer.alloc(65,0)];const i=Buffer.from(F.witnessScript),a=Buffer.from(F.controlBlock),o=Array.from({length:$},(e,t)=>t<r?Buffer.alloc(X,0):Buffer.alloc(0));t.ins[1].witness=[Buffer.alloc(65,0),...o,i,a];const l="function"==typeof t.virtualSize?t.virtualSize():"function"==typeof t.weight?Math.ceil(t.weight()/4):400;return Number(l)||400},a=546,o=25,c=wa(l,i(!1)),u=g?Va(g):0,d=c+u+o,p=wa(l,i(!0))+u+a+o,f=s?Math.max(d,p):d;if(f<=Va(z))break;z=f}const ie="function"==typeof w?w:()=>{};ie({step:1,totalSteps:7,label:"Sign commit",status:"active",detail:"signing only, not broadcasting"});let ae=null;const oe=[{index:Q?.parentInputIndex??0,address:B.address},...(Q?.fundingInputs||[]).map(e=>({index:e.inputIndex,address:e.address||s}))];if(ae=await to(e,J.toHex(),oe),!ae)throw new Error("createAndBroadcast3TxSaleListingFlow: wallet did not return signed commit PSBT");ie({step:1,totalSteps:7,label:"Sign commit",status:"done"}),ie({step:2,totalSteps:7,label:"Extract txid",status:"active"});let se=Z;try{S.Psbt.fromHex(ae,{network:E});const e=S.Psbt.fromHex(ae,{network:E});try{e.finalizeAllInputs()}catch(ze){for(let t=0;t<e.data.inputs.length;t++)try{e.data.inputs[t].finalScriptWitness||e.data.inputs[t].finalScriptSig||e.finalizeInput(t)}catch{}}se=e.extractTransaction().getId(),String(se).toLowerCase(),String(Z).toLowerCase(),String(se).toLowerCase(),String(Z).toLowerCase()}catch(De){throw new Error("createAndBroadcast3TxSaleListingFlow: failed to compute finalized commit txid")}Z=se;let le=null,ce=null,ue=null;{const e=eo(S,ae,E);ce=e?.txHex||e,ue=e?.txid||null}let de=ue||Z;const pe=`${de}:${Q.parentOutputIndex}`,fe=`${de}:${Q.listingScriptOutputIndex}`,me=Va(z);if(!me||me<=0)throw new Error("createAndBroadcast3TxSaleListingFlow: markerValueSats must be > 0");const ge=g?Va(g):0;if(ge>0&&!m)throw new Error("createAndBroadcast3TxSaleListingFlow: oodlFeeAddress is required when oodlFeeSats > 0");const he=e?.getState?.()?.ordinalsAddress||s,be=await(async()=>{if(!h)return null;const e=S.address.toOutputScript(W,E),t=S.crypto.sha256(e).toString("hex");return ji({...c||{},version:2,openStoreVersion:1,sellerScriptHashHex:t,postageSats:K.toString(),psbtHashHex:"0".repeat(64)},S)})(),ye=await(async()=>{if(!b)return null;if("parcel"!==String(c?.collectionKey||"").toLowerCase())return null;const e=Number(c?.parcelNumber),t=Number(c?.bitmapNumber);if(!Number.isFinite(e)||e<0)return null;if(!Number.isFinite(t)||t<0)return null;try{return await qi({parcelNumber:Math.floor(e),bitmapNumber:Math.floor(t)},S)}catch{return null}})(),xe=546,we=e=>{const t=new S.Psbt({network:E});{const e=C(B.address);t.addInput({hash:de,index:Q.parentOutputIndex,witnessUtxo:{script:D,value:Va(Q.parentOutputValueSats)},sequence:4294967293,...e?{tapInternalKey:Buffer.from(e)}:{}})}t.addInput({hash:de,index:Q.listingScriptOutputIndex,witnessUtxo:{script:Buffer.from(F.taprootPayment.output),value:me},sequence:4294967293,tapLeafScript:[{controlBlock:Buffer.from(F.controlBlock),leafVersion:F.leafVersion,script:Buffer.from(F.witnessScript)}]}),t.addOutput({address:he,value:Va(Q.parentOutputValueSats)}),ge>0&&t.addOutput({address:m,value:ge}),be&&t.addOutput({script:be,value:0}),ye&&t.addOutput({script:ye,value:0});const n=Va(e);s&&Number.isFinite(n)&&n>=xe&&t.addOutput({address:s,value:Math.floor(n)});const r=Ja(t),i=r?.outs||[];if(!i[0]||Va(i[0].value)!==Va(Q.parentOutputValueSats))throw new Error("createAndBroadcast3TxSaleListingFlow: TX2 invariant failed (output[0] must be listing output)");if(ge>0&&(!i[1]||Va(i[1].value)!==ge))throw new Error("createAndBroadcast3TxSaleListingFlow: TX2 invariant failed (output[1] must be indexing output)");return t},ve=({changeValueSats:e,paddedOfferChunks:t})=>{const n=new S.Transaction;if(n.version=2,n.addInput(Buffer.from(de,"hex").reverse(),Q.parentOutputIndex,4294967293),n.addInput(Buffer.from(de,"hex").reverse(),Q.listingScriptOutputIndex,4294967293),n.addOutput(Buffer.from(D),Va(Q.parentOutputValueSats)),ge>0){const e=S.address.toOutputScript(m,E);n.addOutput(e,ge)}be&&n.addOutput(be,0),ye&&n.addOutput(ye,0);const r=Va(e);if(s&&Number.isFinite(r)&&r>=xe){const e=S.address.toOutputScript(s,E);n.addOutput(e,Math.floor(r))}n.ins[0].witness=[Buffer.alloc(65,0)];const i=Buffer.from(F.witnessScript),a=Buffer.from(F.controlBlock);n.ins[1].witness=[Buffer.alloc(65,0),...t||[],i,a];const o="function"==typeof n.virtualSize?n.virtualSize():"function"==typeof n.weight?Math.ceil(n.weight()/4):400;return Number(o)||400},Se=async t=>{const r=((e,t,n)=>{const r=new S.Psbt({network:E});if(null!=c?.minBlockHeight){const e=Number(c.minBlockHeight);if(!Number.isFinite(e)||e<0||e>4294967295||!Number.isInteger(e))throw new Error("createAndBroadcast3TxSaleListingFlow: marker.minBlockHeight must be a uint32");try{"function"==typeof r.setLocktime?r.setLocktime(e>>>0):r.__CACHE?.__TX&&(r.__CACHE.__TX.locktime=e>>>0)}catch{throw new Error("createAndBroadcast3TxSaleListingFlow: failed to set offer PSBT locktime")}}const i=Buffer.alloc(32,0),a={script:Buffer.from("0014"+"00".repeat(20),"hex"),value:1};r.addInput({hash:i,index:4294967294,sequence:4294967293,witnessUtxo:a}),r.addInput({hash:i,index:4294967295,sequence:4294967293,witnessUtxo:a});const o=Va(n);if(!o||o<=0)throw new Error("createAndBroadcast3TxSaleListingFlow: listedUtxoValueSats must be > 0");r.addInput({hash:e,index:0,witnessUtxo:{script:Buffer.from(t),value:o},sighashType:Y,sequence:4294967293});try{const e="string"==typeof B.address&&(B.address.startsWith("bc1p")||B.address.startsWith("tb1p")),t=C(B.address)||k;e&&t&&r?.data?.inputs?.[2]&&(r.data.inputs[2].tapInternalKey=t)}catch{}Ya([`${Buffer.from(i).toString("hex")}:4294967294`,`${Buffer.from(i).toString("hex")}:4294967295`,`${Buffer.isBuffer(e)?Buffer.from(e).reverse().toString("hex"):e}:0`],"createAndBroadcast3TxSaleListingFlow:offerPsbt"),r.addOutput({address:W,value:0}),r.addOutput({address:W,value:Ka(K,"postageSats")});const s=BigInt(o),l=G+(s>K?s-K:0n);return r.addOutput({address:W,value:Ka(l,"sellerPayout")}),r})(t,S.address.toOutputScript(he,E),Va(Q.parentOutputValueSats)),{assertOpenStoreSellerOfferSignedCorrectly:i}=await n(async()=>{const{assertOpenStoreSellerOfferSignedCorrectly:e}=await Promise.resolve().then(()=>cs);return{assertOpenStoreSellerOfferSignedCorrectly:e}},__VITE_PRELOAD__),a={index:2,address:B.address,...I?{publicKey:I}:{},sighashType:Y,sighashTypes:[Y]};let o=null;try{o=await no(e,r.toHex(),[a],{sighashTypes:[Y]})}catch{o=null}if(!o)return{ok:!1,offerPsbt:r};const s=S.Psbt.fromHex(o,{network:E});try{i({unsignedOfferPsbt:r,signedOfferPsbt:s,sellerInputIndex:2,expectedSighashByte:Y})}catch{return{ok:!1,offerPsbt:r}}try{s?.data?.inputs?.[2]&&(s.data.inputs[2].sighashType=Y)}catch{}Xa(s);const l=qa(s);if(!l)throw new Error("createAndBroadcast3TxSaleListingFlow: failed to serialize signed offer PSBT");const u=await Oa(l,{marker:c,compress:!1!==x}),d=Ua(u,X);if(d.length>$){const e=$*X;throw new Error(`Signed seller PSBT too large to embed on-chain. bytes=${u.length} capacity\u2248${e} (chunks=${d.length} maxChunks=${$} chunkSize=${X}). Reduce PSBT size (wallet metadata can bloat it) or increase the carrier maxChunks and re-list.`)}const p=Array.from({length:$},(e,t)=>d[t]||Buffer.alloc(0)),f=S.crypto.sha256(u).toString("hex");return{ok:!0,offerPsbt:r,signedOfferPsbtHex:o,signedOfferPsbt:s,framedOfferBytes:u,offerChunks:d,paddedOfferChunks:p,offerHashHex:f}};ie({step:2,totalSteps:7,label:"Extract txid",status:"done"}),ie({step:3,totalSteps:7,label:"Sign offer PSBT",status:"active",detail:"signing only, not broadcasting"});let Ee=we(0),Ne=Za(Ee);if(!Ne)throw new Error("createAndBroadcast3TxSaleListingFlow: failed to compute TX2 txid (phase A provisional)");let Ie=await Se(Ne);if(!Ie?.ok)return{mode:"needs-external-signer",predictedCommitTxid:de,predictedRevealTxid:Ne,unsignedCommitPsbtBase64:J.toBase64(),unsignedSellerListingPsbtBase64:Ie.offerPsbt.toBase64(),unsignedSellerListingPsbtHex:Ie.offerPsbt.toHex(),requiredSighashType:Y,message:"Wallet refused to sign seller offer PSBT (SIGHASH_SINGLE|ANYONECANPAY)."};ve({changeValueSats:0,paddedOfferChunks:Ie.paddedOfferChunks});const Ae=wa(l,ve({changeValueSats:xe,paddedOfferChunks:Ie.paddedOfferChunks}))+5,ke=me-ge-Ae;let Te=0;if(s&&Number.isFinite(ke)&&ke>=xe&&(Te=ke),Te>0){const e=we(Te),t=Za(e);if(!t)throw new Error("createAndBroadcast3TxSaleListingFlow: failed to compute TX2 txid (phase A rebuilt)");if(String(t).toLowerCase()!==String(Ne).toLowerCase()){if(Ee=e,Ne=t,Ie=await Se(Ne),!Ie?.ok)return{mode:"needs-external-signer",predictedCommitTxid:de,predictedRevealTxid:Ne,unsignedCommitPsbtBase64:J.toBase64(),unsignedSellerListingPsbtBase64:Ie.offerPsbt.toBase64(),unsignedSellerListingPsbtHex:Ie.offerPsbt.toHex(),requiredSighashType:Y,message:"Wallet refused to sign seller offer PSBT (SIGHASH_SINGLE|ANYONECANPAY)."}}else Ee=e}const Ce=`${Ne}:0`,Be=Ie.signedOfferPsbtHex,Pe=Ie.signedOfferPsbt,_e=Ie.offerChunks,Oe=Ie.paddedOfferChunks,Le=Ie.offerHashHex;ie({step:3,totalSteps:7,label:"Sign offer PSBT",status:"done"}),ie({step:4,totalSteps:7,label:"Sign reveal",status:"active",detail:"signing only, not broadcasting"});const Fe=await no(e,Ee.toHex(),[{index:0,address:B.address}]);if(!Fe)throw new Error("createAndBroadcast3TxSaleListingFlow: wallet did not return signed reveal PSBT");ie({step:4,totalSteps:7,label:"Sign reveal",status:"done"}),ie({step:5,totalSteps:7,label:"Local-sign carrier",status:"active"});const Me=S.Psbt.fromHex(Fe,{network:E});if(!Me?.data?.inputs?.[1])throw new Error("createAndBroadcast3TxSaleListingFlow: missing TX2 carrier input[1]");Me.data.inputs[1].extraWitnessStack=Oe,await Bn(0,Me,1,F.local.privateKey,F.leafHash),Me.finalizeInput(1,Rn);try{Me.data.inputs[0].finalScriptWitness||Me.data.inputs[0].finalScriptSig||Me.finalizeInput(0)}catch{}let Re=null;try{Re=Me.extractTransaction().getId()}catch{Re=Za(Me)}if(!Re||String(Re).toLowerCase()!==String(Ne).toLowerCase())throw new Error("createAndBroadcast3TxSaleListingFlow: TX2 txid changed after witness injection (should be impossible)");try{const e=Me.extractTransaction(),t="function"==typeof e?.virtualSize?e.virtualSize():"function"==typeof e?.weight?Math.ceil(e.weight()/4):null;(e?.outs||[]).reduce((e,t)=>e+Number(t?.value||0),0),Number(Me?.data?.inputs?.[0]?.witnessUtxo?.value||0);Number(Me?.data?.inputs?.[1]?.witnessUtxo?.value||0),Number.isFinite(t)}catch{}!function({btc:e,revealPsbt:t,listingArtifacts:n,paddedOfferChunks:r,offerHashHex:i,psbtCarrierMaxChunks:a,carrierInputIndex:o=0}){const s=t.extractTransaction(),l=Number.isFinite(Number(o))?Number(o):0,c=s?.ins?.[l]?.witness||null;if(!Array.isArray(c)||0===c.length)throw new Error(`reveal: missing witness on input ${l} (expected tapscript-path spend)`);const u=Buffer.from(n.witnessScript),d=Buffer.from(n.controlBlock),p=1+a+2;if(c.length!==p)throw new Error(`reveal: unexpected witness item count (got=${c.length} expected=${p})`);const f=c[c.length-2],m=c[c.length-1];if(!Qa(f,u))throw new Error("reveal: witness script mismatch (payload not anchored to expected tapscript)");if(!Qa(m,d))throw new Error("reveal: control block mismatch");for(let b=0;b<a;b++){const e=c[1+b],t=r[b]||Buffer.alloc(0);if(!Qa(e,t))throw new Error(`reveal: witness chunk ${b} mismatch (len=${e?.length??0} expectedLen=${t.length})`)}const g=Buffer.concat((r||[]).filter(e=>(e?.length||0)>0)),h=e.crypto.sha256(g).toString("hex");if(String(h).toLowerCase()!==String(i).toLowerCase())throw new Error(`reveal: embedded offer hash mismatch (embedded=${h} expected=${i})`);s.getId(),c.length,g.length}({btc:S,revealPsbt:Me,listingArtifacts:F,paddedOfferChunks:Oe,offerHashHex:Le,psbtCarrierMaxChunks:$,carrierInputIndex:1}),Ga();const $e=Me.extractTransaction().toHex();let Ue=Me.extractTransaction().getId();if(ie({step:5,totalSteps:7,label:"Local-sign carrier",status:"done"}),d){ie({step:6,totalSteps:7,label:"Broadcast commit",status:"active",detail:"all signed, now broadcasting"});const t=String(de||"").toLowerCase(),n=await ro(e,ae,S,E,"oodl-listing-commit");if(le=n?.txid||null,ce=n?.txHex||ce,de=n?.actualTxid||n?.txid||de,String(de).toLowerCase(),!de||String(de).toLowerCase()!==t)throw new Error("createAndBroadcast3TxSaleListingFlow: commit txid mismatch after broadcast; aborting reveal broadcast");await ga(de,Ha(),{timeoutMs:2e4,pollMs:1500}),ie({step:6,totalSteps:7,label:"Broadcast commit",status:"done"}),ie({step:7,totalSteps:7,label:"Broadcast reveal",status:"active",detail:"broadcasting reveal"});try{Ue=await ba(e,$e,Ha(),"oodl-sale-reveal")}catch(He){let t=null;try{const n=new S.Psbt({network:E});n.addInput({hash:de,index:Q.listingScriptOutputIndex,witnessUtxo:{script:Buffer.from(F.taprootPayment.output),value:me},sequence:4294967293,tapLeafScript:[{controlBlock:Buffer.from(F.controlBlock),leafVersion:F.leafVersion,script:Buffer.from(F.witnessScript)}]}),n.data.inputs[0].extraWitnessStack=Array.from({length:$},()=>Buffer.alloc(0));const r=220+$,i=Math.max(250,wa(l,r)+20),a=Va(me-i);if(!Number.isFinite(a)||a<xe)throw new Error("recovery output would be dust");n.addOutput({address:s||he,value:a}),await Bn(0,n,0,F.local.privateKey,F.leafHash),n.finalizeInput(0,Rn);const o=n.extractTransaction().toHex();t=await ba(e,o,Ha(),"oodl-carrier-recovery")}catch{t=null}if(t)throw new Error(`Reveal broadcast failed after commit broadcast (commit=${String(de).slice(0,12)}\u2026). Emergency carrier recovery broadcasted: ${String(t)}.`);throw new Error(`Reveal broadcast failed after commit broadcast (commit=${String(de).slice(0,12)}\u2026). Carrier funds may be stranded; keep this session open and retry. Error: ${He?.message||String(He)}`)}ie({step:7,totalSteps:7,label:"Broadcast reveal",status:"done"})}else ie({step:6,totalSteps:7,label:"Broadcast commit",status:"skipped",detail:"dry run"}),ie({step:7,totalSteps:7,label:"Broadcast reveal",status:"skipped",detail:"dry run"});return{mode:"3tx-complete",commitTxid:de,commitTxHex:ce,predictedCommitTxid:Z,parentOutpointAfterCommit:pe,listingFundingOutpoint:fe,listedOutpoint:Ce,sellerListingPsbtBase64:Pe.toBase64(),sellerListingPsbtHashHex:Le,signedSellerListingPsbtHex:Be,markerTxid:Ue||null,markerTxHex:$e,revealTxid:Ue||null,revealTxHex:$e,revealTxidLocal:d?null:Ue,markerValueSats:me,listingScriptAddress:M,listingScriptAutoGenerated:!!F,sellerPsbtEmbeddedOnChain:!0,sellerPsbtWitnessChunks:_e.length,sellerPsbtWitnessChunkSize:X,broadcasted:!!d}}async function so({walletProvider:e,parentUtxo:t,fundingUtxo:r,fundingUtxos:i,changeAddress:a,feeRate:o,marker:s,broadcastMarkerTx:l=!1}){if(!e)throw new Error("createAndBroadcastSaleListingTx: walletProvider is required");const c="function"==typeof e?.getState&&e.getState()?.walletType||"";if(((c||e?.walletType||e?.name||"").toLowerCase?.()||"").includes("phantom"))throw new Error("Phantom wallet is not supported for creating Open Store listings (requires 0x83 SIGHASH_SINGLE|ANYONECANPAY seller listing PSBT signing).");if(!a)throw new Error("createAndBroadcastSaleListingTx: changeAddress is required");if(!s||"object"!=typeof s)throw new Error("createAndBroadcastSaleListingTx: marker is required");const u=await In(),d=Da(u),p=e?.getState?.()||{},f=(()=>{const e=p?.ordinalsPublicKey||p?.publicKey||null;if(!e||"string"!=typeof e)return null;const t=e.startsWith("0x")?e.slice(2):e;return/^[0-9a-fA-F]{64}$/.test(t)||/^[0-9a-fA-F]{66}$/.test(t)?t:null})(),m=f?64===f.length?Buffer.from(f,"hex"):66===f.length?Buffer.from(f.slice(2),"hex"):null:null;if(t){const c=ya(t,a);if(!c)throw new Error("createAndBroadcastSaleListingTx: invalid parentUtxo");if(!c.address)throw new Error("createAndBroadcastSaleListingTx: parentUtxo.address is required");const p=(s?.sellerAddress&&"string"==typeof s.sellerAddress?s.sellerAddress:null)||a,f=ja(u,d,c,a),g=Va(c.value);if(!g||g<=0)throw new Error("createAndBroadcastSaleListingTx: parentUtxo.value must be > 0");const h=BigInt(g);if(null!=s?.postageSats){let e=s.postageSats;if("number"==typeof e&&(e=BigInt(Math.floor(e))),"string"==typeof e&&(e=BigInt(e)),"bigint"!=typeof e)throw new Error("createAndBroadcastSaleListingTx: marker.postageSats must be bigint|number|string");if(e!==h)throw new Error(`createAndBroadcastSaleListingTx: marker.postageSats must equal the actual inscription UTXO value (marker=${e.toString()} expected=${h.toString()})`)}let b=s?.priceSats;if("number"==typeof b&&(b=BigInt(Math.floor(b))),"string"==typeof b&&(b=BigInt(b)),"bigint"!=typeof b)throw new Error("createAndBroadcastSaleListingTx: marker.priceSats must be bigint|number|string");if(b<=0n)throw new Error("createAndBroadcastSaleListingTx: sale price must be > 0 sats to produce a price-enforcing seller offer");const y=b,x=(u.Transaction?.SIGHASH_SINGLE??3)|(u.Transaction?.SIGHASH_ANYONECANPAY??128),w=new u.Psbt({network:d});w.addInput({hash:c.txid,index:c.vout,witnessUtxo:{script:f,value:g},sighashType:x,sequence:4294967293});try{"string"==typeof c.address&&(c.address.startsWith("bc1p")||c.address.startsWith("tb1p"))&&m&&w?.data?.inputs?.[0]&&(w.data.inputs[0].tapInternalKey=m)}catch{}if(w.addOutput({address:p,value:Ka(y,"sellerPayout")}),Ga()){const e=qa(w);e&&e.length,(()=>{try{return e?u.crypto.sha256(e).toString("hex"):null}catch{return null}})()}let v=null,S=null;try{const t=await nr(e,w.toHex(),{autoFinalized:!0,toSignInputs:[{index:0,address:c.address,sighashType:x}]},!1);v=t?.signedPsbt||null}catch(N){try{const t=await nr(e,w.toHex(),{autoFinalized:!1,toSignInputs:[{index:0,address:c.address,sighashType:x}]},!1);v=t?.signedPsbt||null}catch{v=null}}if(!v)return{mode:"needs-external-signer",unsignedSellerListingPsbtHex:w.toHex(),unsignedSellerListingPsbtBase64:w.toBase64(),parentOutpoint:`${c.txid}:${c.vout}`,requiredSighashType:x,message:"Wallet refused to sign seller listing PSBT (SIGHASH_SINGLE|ANYONECANPAY)."};Ga();try{S=u.Psbt.fromHex(v,{network:d})}catch{S=u.Psbt.fromBase64(v,{network:d})}try{const{assertOpenStoreSellerOfferSignedCorrectly:e}=await n(async()=>{const{assertOpenStoreSellerOfferSignedCorrectly:e}=await Promise.resolve().then(()=>cs);return{assertOpenStoreSellerOfferSignedCorrectly:e}},__VITE_PRELOAD__);e({unsignedOfferPsbt:w,signedOfferPsbt:S,sellerInputIndex:0,expectedSighashByte:x})}catch{return{mode:"needs-external-signer",unsignedSellerListingPsbtHex:w.toHex(),unsignedSellerListingPsbtBase64:w.toBase64(),parentOutpoint:`${c.txid}:${c.vout}`,requiredSighashType:x,message:"Wallet returned a seller listing PSBT that failed strict 0x83 validation (signature or template mutated)."}}const E=(()=>{try{return S?.toBase64?.()||null}catch{return null}})();if(!E)throw new Error("createAndBroadcastSaleListingTx: failed to serialize signed listing PSBT to base64");const I=qa(S);if(!I)throw new Error("createAndBroadcastSaleListingTx: failed to serialize signed listing PSBT");const A=u.crypto.sha256(I).toString("hex");return Ga(),s={...s||{},psbtHashHex:A},(r||Array.isArray(i)&&i.length>0)&&l?{mode:"seller-psbt+marker",sellerListingPsbtBase64:E,sellerListingPsbtHashHex:A,signedSellerListingPsbtHex:v,parentOutpoint:`${c.txid}:${c.vout}`,...await(async()=>{const t=r?ya(r,a):Wa(i,o);if(!t)throw new Error("createAndBroadcastSaleListingTx: fundingUtxo or fundingUtxos is required");const n=ja(u,d,t,a),l=await ji(s,u),c=await(async()=>{if("parcel"!==String(s?.collectionKey||"").toLowerCase())return null;const e=Number(s?.parcelNumber),t=Number(s?.bitmapNumber);if(!Number.isFinite(e)||e<0)return null;if(!Number.isFinite(t)||t<0)return null;try{return await qi({parcelNumber:Math.floor(e),bitmapNumber:Math.floor(t)},u)}catch{return null}})(),p=wa(o,c?200:180),f=t.value-p;if(f<=546)throw new Error(`createAndBroadcastSaleListingTx: insufficient funds. input=${t.value} fee\u2248${p} change=${f}`);const m=new u.Psbt({network:d});m.addInput({hash:t.txid,index:t.vout,witnessUtxo:{script:n,value:t.value}}),m.addOutput({script:l,value:0}),c&&m.addOutput({script:c,value:0}),m.addOutput({address:a,value:f});const g=Za(m);if(Ga()){const e=qa(m);e&&e.length,(()=>{try{return e?u.crypto.sha256(e).toString("hex"):null}catch{return null}})()}const h=m.toHex(),b=await nr(e,h,{autoFinalized:!0,toSignInputs:[{index:0,address:t.address||a}]},!0);return{txid:b?.txid||null,unsignedTxid:g,fee:p,changeValue:f,method:b?.method}})()}:{mode:"seller-psbt-only",sellerListingPsbtBase64:E,sellerListingPsbtHashHex:A,signedSellerListingPsbtHex:v,parentOutpoint:`${c.txid}:${c.vout}`,...l?{}:{message:"OP_RETURN marker broadcasting is disabled (markerless listings). Use the 3-tx flow or explicitly set broadcastMarkerTx=true."}}}const g=r?ya(r,a):Wa(i,o);if(!g)throw new Error("createAndBroadcastSaleListingTx: fundingUtxo or fundingUtxos is required");if(!l)throw new Error("createAndBroadcastSaleListingTx: OP_RETURN marker broadcasting is disabled (markerless listings).");const h=ja(u,d,g,a),b=await ji(s,u),y=await(async()=>{if("parcel"!==String(s?.collectionKey||"").toLowerCase())return null;const e=Number(s?.parcelNumber),t=Number(s?.bitmapNumber);if(!Number.isFinite(e)||e<0)return null;if(!Number.isFinite(t)||t<0)return null;try{return await qi({parcelNumber:Math.floor(e),bitmapNumber:Math.floor(t)},u)}catch{return null}})(),x=wa(o,y?200:180),w=g.value-x;if(w<=546)throw new Error(`createAndBroadcastSaleListingTx: insufficient funds. input=${g.value} fee\u2248${x} change=${w}`);const v=new u.Psbt({network:d});v.addInput({hash:g.txid,index:g.vout,witnessUtxo:{script:h,value:g.value}}),v.addOutput({script:b,value:0}),y&&v.addOutput({script:y,value:0}),v.addOutput({address:a,value:w});const S=v.toHex(),E=await nr(e,S,{autoFinalized:!0,toSignInputs:[{index:0,address:g.address||a}]},!0);return{txid:E?.txid||null,fee:x,changeValue:w,method:E?.method}}async function lo(e,{marker:t=null,compress:n=!1}={}){const r=[];for(const o of e){const e=await Ba(o,{compress:n});r.push(e)}const i=Ia(t),a=[];return i&&i.length>0&&a.push(i),a.push(...r),Buffer.concat(a)}async function co(e,t,n={}){const{inputIndex:r=null,requirePsbtMagic:i=!0}=n;if(!e)throw new Error("extractMultiOfferFromRevealTxWithBitcoinLib: bitcoinLib is required");if(!t||"string"!=typeof t)throw new Error("extractMultiOfferFromRevealTxWithBitcoinLib: txHex string is required");const a=e.Transaction.fromHex(t.trim()).ins||[];if(0===a.length)throw new Error("extractMultiOfferFromRevealTxWithBitcoinLib: tx has no inputs");const o=e=>Buffer.isBuffer(e)?e:e instanceof Uint8Array?Buffer.from(e):Buffer.alloc(0),s=e=>{const t=a[e]?.witness;if(!Array.isArray(t)||t.length<3)return null;const n=t.slice(1,t.length-2).map(o),r=Buffer.concat(n.filter(e=>(e?.length||0)>0));return 0===r.length?null:r};let l=null;if("number"==typeof r&&r>=0)l=s(r);else for(let f=0;f<a.length&&(l=s(f),!l);f++);if(!l)return[];const c=Aa(l),u=c?.meta?.listingCount||1,d=[];let p=c?.bytesConsumed||0;for(let f=0;f<u;f++){const e=Ta(l,p);if(e<0)break;const t=Pa(l.subarray(e));if(!t)break;let n;if(n=2===t.version&&1&t.flags?await Ca(t.payload):t.payload,i&&!Fa(n))break;const r=(2===t.version?14:9)+(2===t.version?t.payload?.length||0:n?.length||0);d.push({index:f,psbtBytes:Buffer.from(n),outputIndex:c?.meta?.outputIndicesArray?.[f]??f,priceSats:c?.meta?.pricesArray?.[f]??c?.meta?.priceSats??null,inscriptionId:c?.meta?.inscriptionIdsArray?.[f]??null,bitmapNumber:c?.meta?.bitmapNumbersArray?.[f]??null}),p=e+r}return d}async function uo({parentUtxos:e,fundingUtxos:t,listingScriptAddress:n,markerValueSats:r,sellerChangeAddress:i,feeRateSatPerVb:a,paymentPublicKey:o=null,bitcoinLib:s=null,oodlFeeAddress:l=null,oodlFeeSats:c=null}){const u=s||await In(),d=Da(u),p=(e||[]).map(e=>ya(e,i)).filter(Boolean);if(0===p.length)throw new Error("buildMultiAssetListingCommitTx: no valid parentUtxos");if(p.length<2)throw new Error("buildMultiAssetListingCommitTx: need at least 2 parents for multi-asset listing");for(let L=0;L<p.length;L++){const e=p[L],t=Va(e.value);if(!t||t<=0)throw new Error(`buildMultiAssetListingCommitTx: parent[${L}].value must be > 0`);const n=null==e?.offset?void 0:Number(e.offset);if(!Number.isFinite(n)||n<0||n>=t)throw new Error(`buildMultiAssetListingCommitTx: parent[${L}].offset is required and must be within [0, value-1]`);if(!e.address)throw new Error(`buildMultiAssetListingCommitTx: parent[${L}].address is required`)}if(!n||"string"!=typeof n)throw new Error("buildMultiAssetListingCommitTx: listingScriptAddress is required");const f=Va(r);if(!f||f<=0)throw new Error("buildMultiAssetListingCommitTx: markerValueSats must be > 0");const m=546,g=c?Va(c):0,h=new Set(p.map(e=>`${e.txid}:${e.vout}`)),b=xa((t||[]).map(e=>ya(e,i)).filter(Boolean).filter(e=>!h.has(`${e.txid}:${e.vout}`)));if(0===b.length)throw new Error("buildMultiAssetListingCommitTx: no valid funding UTXOs");const y=b.slice().sort((e,t)=>(t.value||0)-(e.value||0)),x=[],w=[];for(let L=0;L<p.length;L++){const e=p[L],t=Va(e.value),n=Number(e.offset),r=t-n;if(r<m)throw new Error(`buildMultiAssetListingCommitTx: parent[${L}] aligned value would be dust (${r})`);const i={parentIndex:L,alignedValue:r};n>0&&(i.prefixOutputIndex=x.length,x.push({type:"prefix",parentIndex:L,value:Math.max(n,m),needsPadding:n<m,rawPrefixValue:n})),i.alignedOutputIndex=x.length,x.push({type:"aligned",parentIndex:L,value:r}),w.push(i)}const v=x.length;x.push({type:"carrier",value:f}),g>0&&l&&x.push({type:"fee",value:g});const S=x.reduce((e,t)=>e+t.value,0),E=[];let N=0;const I=new Set;for(const L of y){const e=Va(L?.value);if(!e||e<=0)continue;const t=`${L.txid}:${L.vout}`;if(I.has(t))continue;I.add(t),E.push({...L,value:e}),N+=e;const n=p.length+E.length,r=x.length+1,o=wa(a,10+68*n+43*r+6),s=S+o;if(N>=s){if(N-s>m&&i)break;if(N>=s)break}}if(0===E.length)throw new Error("buildMultiAssetListingCommitTx: no usable funding UTXOs");const A=p.length+E.length,k=(()=>{const e=x.length+1,t=wa(a,10+68*A+43*e+6);return N-S-t>m&&!!i})(),T=x.length+(k?1:0),C=wa(a,10+68*A+43*T+6),B=k?N-S-C:0;if(N<S+C)throw new Error(`buildMultiAssetListingCommitTx: insufficient funds (funding=${N} required=${S+C})`);for(const L of x)"prefix"===L.type&&L.needsPadding&&(L.value=m);const P=new u.Psbt({network:d}),_=[];for(const L of p){const e=ja(u,d,L,i);P.addInput({hash:L.txid,index:L.vout,witnessUtxo:{script:e,value:Va(L.value)},sequence:4294967293})}for(let L=0;L<E.length;L++){const e=E[L],t=e?.address||i,n=ja(u,d,e,i);let r={};if(o&&(t.startsWith("3")||t.startsWith("2")))try{const e=Buffer.from(String(o),"hex"),t=u.payments.p2wpkh({pubkey:e,network:d});t?.output&&(r.redeemScript=t.output)}catch{}P.addInput({hash:e.txid,index:e.vout,witnessUtxo:{script:n,value:Va(e.value)},sequence:4294967293,...r}),_.push({inputIndex:p.length+L,address:t,txid:e.txid,vout:e.vout,value:e.value})}for(const L of x)if("prefix"===L.type||"aligned"===L.type){const e=ja(u,d,p[L.parentIndex],i);P.addOutput({script:e,value:L.value})}else if("carrier"===L.type){const e=u.address.toOutputScript(n,d);P.addOutput({script:e,value:f})}else"fee"===L.type&&P.addOutput({address:l,value:g});let O=null;return k&&B>m&&(O=x.length,P.addOutput({address:i,value:Math.floor(B)})),{psbt:P,summary:{unsignedCommitTxid:Za(P),parentOutputMap:w,carrierOutputIndex:v,carrierOutputValueSats:f,changeOutputIndex:O,fundingInputs:_,parentCount:p.length,feeSats:C}}}async function po({walletProvider:e,parentUtxos:t,assetItems:r,fundingUtxos:i,sellerChangeAddress:a,feeRateSatPerVb:o,bitcoinLib:s=null,broadcast:l=!0,oodlFeeAddress:c=null,oodlFeeSats:u=null,compressEmbeddedOffer:d=!0,maxOfferBytesForFunding:p=5e3,minBlockHeight:f=null,onProgress:m=null}){if(!e)throw new Error("createAndBroadcastMultiAsset3TxSaleListingFlow: walletProvider is required");const g="function"==typeof e?.getState&&e.getState()?.walletType||"";if(((g||e?.walletType||e?.name||"").toLowerCase?.()||"").includes("phantom"))throw new Error("Phantom wallet is not supported for creating multi-asset listings (requires 0x83 SIGHASH_SINGLE|ANYONECANPAY).");if(!Array.isArray(t)||t.length<2)throw new Error("createAndBroadcastMultiAsset3TxSaleListingFlow: need at least 2 parentUtxos");if(!Array.isArray(r)||r.length!==t.length)throw new Error("createAndBroadcastMultiAsset3TxSaleListingFlow: assetItems must match parentUtxos length");const h=s||await In(),b=Da(h),y=e?.getState?.()||{},x=(()=>{const e=y?.ordinalsPublicKey||null;if(!e||"string"!=typeof e)return null;const t=e.startsWith("0x")?e.slice(2):e;return/^[0-9a-fA-F]{64,66}$/.test(t)?t:null})(),w=(()=>{const e=y?.paymentPublicKey||y?.publicKey||null;if(!e||"string"!=typeof e)return null;const t=e.startsWith("0x")?e.slice(2):e;return/^[0-9a-fA-F]{64,66}$/.test(t)?t:null})(),v=x?64===x.length?Buffer.from(x,"hex"):66===x.length?Buffer.from(x.slice(2),"hex"):null:null,S=w?64===w.length?Buffer.from(w,"hex"):66===w.length?Buffer.from(w.slice(2),"hex"):null:null,E=e=>{const t="string"==typeof e?e:"";if(!t)return null;const n=y?.ordinalsAddress||y?.address||"",r=y?.paymentAddress||y?.address||"";return t&&n&&t===n?v:t&&r&&t===r?S:null},N=[];for(let n=0;n<t.length;n++){const e=ya(t[n],a);if(!e)throw new Error(`createAndBroadcastMultiAsset3TxSaleListingFlow: invalid parentUtxo[${n}]`);if(e.address||(e.address=y?.ordinalsAddress||a),void 0===e.offset||null===e.offset){const t=await ha(r[n]?.inscriptionId);null!=t&&(e.offset=t)}N.push(e)}const I=(h.Transaction?.SIGHASH_SINGLE??3)|(h.Transaction?.SIGHASH_ANYONECANPAY??128),A=N.length,k=A*((d?14:9)+Math.max(0,Math.floor(Number(p??5e3))))+128,T=va(Ha()),C=Math.max(1,Math.min(64*A,Math.ceil(k/T)+4)),B=await On(h,b,C),P=B?.taprootPayment?.address;if(!P)throw new Error("createAndBroadcastMultiAsset3TxSaleListingFlow: failed to auto-generate listing script address");const _=Math.max(1,Math.floor(Number(B?.maxChunks||C)));let O=3e3*A,L=null,F=null,M=null;for(let n=0;n<6;n++){const e=await uo({parentUtxos:N,fundingUtxos:i,listingScriptAddress:P,markerValueSats:O,sellerChangeAddress:a,feeRateSatPerVb:o,paymentPublicKey:w,bitcoinLib:h,oodlFeeAddress:null,oodlFeeSats:null});if(L=e.psbt,F=e.summary,M=F?.unsignedCommitTxid,!M)throw new Error("createAndBroadcastMultiAsset3TxSaleListingFlow: failed to compute commit txid");const t=_*T,n=Math.min(k,t),r=Math.max(1,Math.ceil(n/T)),s=Buffer.from(B.witnessScript).length,l=12+41*(A+1)+43*(A+(u?1:0)+1);let c=0;for(let i=0;i<A;i++)c+=66;c+=za(1+r+2),c+=za(65)+65;for(let i=0;i<r;i++)c+=za(T)+T;c+=za(s)+s,c+=za(33)+33;const d=4*l+c,p=Math.ceil(d/4),f=546,m=50,g=u?Va(u):0,b=wa(o,p)+g+f+m;if(b<=O)break;O=b}for(let n=0;n<F.parentOutputMap.length;n++)F.parentOutputMap[n];for(let n=0;n<N.length;n++){const e=N[n],t="string"==typeof e.address&&(e.address.startsWith("bc1p")||e.address.startsWith("tb1p")),r=E(e.address)||v;t&&r&&L?.data?.inputs?.[n]&&(L.data.inputs[n].tapInternalKey=r)}for(const n of F?.fundingInputs||[]){const e=Number(n?.inputIndex);if(!Number.isFinite(e)||e<0)continue;const t=n?.address||a,r="string"==typeof t&&(t.startsWith("bc1p")||t.startsWith("tb1p")),i=E(t)||S;r&&i&&L?.data?.inputs?.[e]&&(L.data.inputs[e].tapInternalKey=i)}const R="function"==typeof m?m:()=>{};R({step:1,totalSteps:7,label:"Sign commit",status:"active",detail:"signing only, not broadcasting"});const $=[...N.map((e,t)=>({index:t,address:e.address})),...F.fundingInputs.map(e=>({index:e.inputIndex,address:e.address||a}))],U=await to(e,L.toHex(),$);if(!U)throw new Error("createAndBroadcastMultiAsset3TxSaleListingFlow: wallet did not sign commit");R({step:1,totalSteps:7,label:"Sign commit",status:"done"}),R({step:2,totalSteps:7,label:"Extract txid",status:"active"});let z=M;try{const e=h.Psbt.fromHex(U,{network:b});try{e.finalizeAllInputs()}catch{for(let t=0;t<e.data.inputs.length;t++)try{e.data.inputs[t].finalScriptWitness||e.data.inputs[t].finalScriptSig||e.finalizeInput(t)}catch{}}z=e.extractTransaction().getId()}catch(be){throw new Error("createAndBroadcastMultiAsset3TxSaleListingFlow: failed to compute finalized commit txid")}R({step:2,totalSteps:7,label:"Extract txid",status:"done"});let D=null;{const e=eo(h,U,b);D=e?.txHex||null,z=e?.txid||z}const H=Va(O),W=u?Va(u):0,j=546,q=y?.ordinalsAddress||a,X=(e,t,n,i,o)=>{const s=new h.Psbt({network:b});if(null!=f){const e=Number(f);if(Number.isFinite(e)&&e>=0&&e<=4294967295&&Number.isInteger(e))try{"function"==typeof s.setLocktime?s.setLocktime(e>>>0):s.__CACHE?.__TX&&(s.__CACHE.__TX.locktime=e>>>0)}catch{}}const l=Buffer.alloc(32,0),c={script:Buffer.from("0014"+"00".repeat(20),"hex"),value:1},u=4294967294-2*t,d=4294967294-2*t-1;s.addInput({hash:l,index:u,sequence:4294967293,witnessUtxo:c}),s.addInput({hash:l,index:d,sequence:4294967293,witnessUtxo:c});const p=Va(o);s.addInput({hash:e,index:n,witnessUtxo:{script:Buffer.from(i),value:p},sighashType:I,sequence:4294967293});try{const e=N[t],n="string"==typeof e?.address&&(e.address.startsWith("bc1p")||e.address.startsWith("tb1p")),r=E(e?.address)||v;n&&r&&s?.data?.inputs?.[2]&&(s.data.inputs[2].tapInternalKey=r)}catch{}const m=r[t],g=(()=>{let e=m?.priceSats;return"number"==typeof e&&(e=BigInt(Math.floor(e))),"string"==typeof e&&(e=BigInt(e)),e})(),y=BigInt(p),x=m?.sellerAddress||a;s.addOutput({address:x,value:0}),s.addOutput({address:x,value:Ka(y,"postageSats")});const w=BigInt(p),S=g+(w>y?w-y:0n);return s.addOutput({address:x,value:Ka(S,"sellerPayout")}),s},K=e=>{const t=new h.Psbt({network:b});for(let r=0;r<N.length;r++){const e=F.parentOutputMap[r],n=N[r],i=ja(h,b,n,a),o=E(n.address);t.addInput({hash:z,index:e.alignedOutputIndex,witnessUtxo:{script:i,value:e.alignedValue},sequence:4294967293,...o?{tapInternalKey:Buffer.from(o)}:{}})}t.addInput({hash:z,index:F.carrierOutputIndex,witnessUtxo:{script:Buffer.from(B.taprootPayment.output),value:H},sequence:4294967293,tapLeafScript:[{controlBlock:Buffer.from(B.controlBlock),leafVersion:B.leafVersion,script:Buffer.from(B.witnessScript)}]});for(let r=0;r<N.length;r++){const e=F.parentOutputMap[r];t.addOutput({address:q,value:e.alignedValue})}W>0&&c&&t.addOutput({address:c,value:W});const n=Va(e);return a&&Number.isFinite(n)&&n>=j&&t.addOutput({address:a,value:Math.floor(n)}),t};let G=K(0),Y=Za(G);if(!Y)throw new Error("createAndBroadcastMultiAsset3TxSaleListingFlow: failed to compute TX2 txid");const J=async t=>{const{assertOpenStoreSellerOfferSignedCorrectly:r}=await n(async()=>{const{assertOpenStoreSellerOfferSignedCorrectly:e}=await Promise.resolve().then(()=>cs);return{assertOpenStoreSellerOfferSignedCorrectly:e}},__VITE_PRELOAD__),i=[],a=[];for(let e=0;e<N.length;e++){const n=e,r=h.address.toOutputScript(q,b),o=F.parentOutputMap[e].alignedValue,s=X(t,e,n,r,o);i.push(s),a.push({autoFinalized:!1,sighashTypes:[I],toSignInputs:[{index:2,address:N[e].address,...x?{publicKey:x}:{},sighashType:I,sighashTypes:[I]}]})}let o=null;try{o=await async function(e,t,n){if(!e)throw new Error("signOnlyPsbtsBatch: walletProvider is required");if(!Array.isArray(t)||0===t.length)throw new Error("signOnlyPsbtsBatch: psbtHexes must be a non-empty array");const r=await V(e,t,n);if(!Array.isArray(r)||r.length!==t.length)throw new Error("signOnlyPsbtsBatch: wallet returned unexpected result");return r}(e,i.map(e=>e.toHex()),a)}catch(be){const t=String(be?.message||be).match(/index\s+(\d+)/i);return{ok:!1,failedIndex:t?Number(t[1]):null}}if(!Array.isArray(o)||o.length!==i.length)return{ok:!1,failedIndex:null};const s=[];for(let e=0;e<i.length;e++){const t=i[e],n=o[e];if(!n)return{ok:!1,failedIndex:e};let a;try{a=h.Psbt.fromHex(n,{network:b})}catch{return{ok:!1,failedIndex:e}}try{r({unsignedOfferPsbt:t,signedOfferPsbt:a,sellerInputIndex:2,expectedSighashByte:I})}catch{return{ok:!1,failedIndex:e}}try{a?.data?.inputs?.[2]&&(a.data.inputs[2].sighashType=I)}catch{}Xa(a);const l=qa(a);if(!l)throw new Error(`createAndBroadcastMultiAsset3TxSaleListingFlow: failed to serialize offer PSBT[${e}]`);s.push({index:e,signedOfferPsbt:a,signedOfferPsbtHex:n,offerPsbtBytesRaw:l})}return{ok:!0,offerResults:s}};R({step:3,totalSteps:7,label:"Sign offers",status:"active",detail:"signing only, not broadcasting"});let Q=await J(Y);if(!Q?.ok)return{mode:"needs-external-signer",failedAssetIndex:Q?.failedIndex,message:`Wallet refused to sign offer PSBT for asset[${Q?.failedIndex??"?"}] (SIGHASH_SINGLE|ANYONECANPAY).`};R({step:3,totalSteps:7,label:"Sign offers",status:"done"});const Z={collectionKey:r[0]?.collectionKey||null,priceSats:r[0]?.priceSats,...null!==f?{minBlockHeight:f}:{},multiAssetItems:r.map((e,t)=>({inscriptionId:e.inscriptionId,priceSats:e.priceSats,bitmapNumber:e.bitmapNumber??null,parcelNumber:e.parcelNumber??null,outputIndex:t}))},ee=Q.offerResults.map(e=>e.offerPsbtBytesRaw),te=await lo(ee,{marker:Z,compress:!1!==d}),ne=Ua(te,T);if(ne.length>_)throw new Error(`Multi-asset listing too large for carrier. bytes=${te.length} chunks=${ne.length} maxChunks=${_}. Reduce the number of assets or increase carrier capacity.`);const re=Array.from({length:_},(e,t)=>ne[t]||Buffer.alloc(0)),ie=h.crypto.sha256(te).toString("hex"),ae=(()=>{const e=new h.Transaction;e.version=2;for(let n=0;n<N.length;n++){const t=F.parentOutputMap[n];e.addInput(Buffer.from(z,"hex").reverse(),t.alignedOutputIndex,4294967293)}e.addInput(Buffer.from(z,"hex").reverse(),F.carrierOutputIndex,4294967293);for(let n=0;n<N.length;n++){const t=F.parentOutputMap[n],r=ja(h,b,N[n],a);e.addOutput(r,t.alignedValue)}W>0&&c&&e.addOutput(h.address.toOutputScript(c,b),W);const t=Va(546);a&&Number.isFinite(t)&&t>=j&&e.addOutput(h.address.toOutputScript(a,b),Math.floor(t));for(let n=0;n<N.length;n++)e.ins[n].witness=[Buffer.alloc(65,0)];return e.ins[N.length].witness=[Buffer.alloc(65,0),...re,Buffer.from(B.witnessScript),Buffer.from(B.controlBlock)],"function"==typeof e.virtualSize?e.virtualSize():Math.ceil(e.weight()/4)})(),oe=wa(o,ae)+10,se=H-W-oe;let le=0;if(a&&se>=j&&(le=se),le>0){const e=K(le),t=Za(e);if(t&&String(t).toLowerCase()!==String(Y).toLowerCase()){if(G=e,Y=t,Q=await J(Y),!Q?.ok)return{mode:"needs-external-signer",failedAssetIndex:Q?.failedIndex,message:"Wallet refused to re-sign offer after TX2 change adjustment."};const n=Q.offerResults.map(e=>e.offerPsbtBytesRaw),r=Ua(await lo(n,{marker:Z,compress:!1!==d}),T);for(let e=0;e<_;e++)re[e]=r[e]||Buffer.alloc(0)}else G=e}R({step:4,totalSteps:7,label:"Sign reveal",status:"active",detail:"signing only, not broadcasting"});const ce=N.map((e,t)=>({index:t,address:e.address})),ue=await no(e,G.toHex(),ce);if(!ue)throw new Error("createAndBroadcastMultiAsset3TxSaleListingFlow: wallet did not sign reveal");R({step:4,totalSteps:7,label:"Sign reveal",status:"done"});const de=h.Psbt.fromHex(ue,{network:b}),pe=N.length;if(!de?.data?.inputs?.[pe])throw new Error("createAndBroadcastMultiAsset3TxSaleListingFlow: missing carrier input");de.data.inputs[pe].extraWitnessStack=re,R({step:5,totalSteps:7,label:"Local-sign carrier",status:"active"}),await Bn(0,de,pe,B.local.privateKey,B.leafHash),de.finalizeInput(pe,Rn);for(let n=0;n<N.length;n++)try{de.data.inputs[n].finalScriptWitness||de.data.inputs[n].finalScriptSig||de.finalizeInput(n)}catch{}let fe=null;try{fe=de.extractTransaction().getId()}catch{fe=Za(de)}if(!fe||String(fe).toLowerCase()!==String(Y).toLowerCase())throw new Error("createAndBroadcastMultiAsset3TxSaleListingFlow: TX2 txid changed after witness injection");R({step:5,totalSteps:7,label:"Local-sign carrier",status:"done"});const me=de.extractTransaction().toHex();let ge=de.extractTransaction().getId();if(l){R({step:6,totalSteps:7,label:"Broadcast commit",status:"active",detail:"all signed, now broadcasting"});let t=null;try{const e=new h.Psbt({network:b});e.addInput({hash:z,index:F.carrierOutputIndex,witnessUtxo:{script:Buffer.from(B.taprootPayment.output),value:H},sequence:4294967293,tapLeafScript:[{controlBlock:Buffer.from(B.controlBlock),leafVersion:B.leafVersion,script:Buffer.from(B.witnessScript)}]}),e.data.inputs[0].extraWitnessStack=Array.from({length:_},()=>Buffer.alloc(0));const n=220+_,r=Math.max(250,wa(o,n)+20),i=Va(H-r);Number.isFinite(i)&&i>=j&&(e.addOutput({address:a||q,value:i}),await Bn(0,e,0,B.local.privateKey,B.leafHash),e.finalizeInput(0,Rn),t=e.extractTransaction().toHex())}catch{}try{"undefined"!=typeof window&&window.localStorage&&window.localStorage.setItem("oodl.pendingMultiCommit",JSON.stringify({kind:"oodl-multi-asset",createdAt:Date.now(),network:Ha(),commitTxid:z,recoveryTxHex:t||null,revealTxHex:me}))}catch{}const n=String(z||"").toLowerCase(),r=await ro(e,U,h,b,"oodl-multi-listing-commit");if(D=r?.txHex||D,z=r?.actualTxid||r?.txid||z,!z||String(z).toLowerCase()!==n)throw new Error("createAndBroadcastMultiAsset3TxSaleListingFlow: commit txid mismatch after broadcast; aborting reveal broadcast");await ga(z,Ha(),{timeoutMs:2e4,pollMs:1500}),R({step:6,totalSteps:7,label:"Broadcast commit",status:"done"}),R({step:7,totalSteps:7,label:"Broadcast reveal",status:"active",detail:"broadcasting reveal"});try{ge=await ba(e,me,Ha(),"oodl-multi-sale-reveal");try{"undefined"!=typeof window&&window.localStorage&&window.localStorage.removeItem("oodl.pendingMultiCommit")}catch{}}catch(ye){let n=null;if(t)try{n=await ba(e,t,Ha(),"oodl-multi-carrier-recovery");try{"undefined"!=typeof window&&window.localStorage&&window.localStorage.removeItem("oodl.pendingMultiCommit")}catch{}}catch{n=null}if(n)throw new Error(`Reveal broadcast failed after commit broadcast (commit=${String(z).slice(0,12)}\u2026). Emergency carrier recovery broadcasted: ${String(n)}.`);throw new Error(`Reveal broadcast failed after commit broadcast (commit=${String(z).slice(0,12)}\u2026). Carrier funds may be stranded; keep this session open and retry. Error: ${ye?.message||String(ye)}`)}}l?R({step:7,totalSteps:7,label:"Broadcast reveal",status:"done"}):(R({step:6,totalSteps:7,label:"Broadcast commit",status:"skipped",detail:"dry run"}),R({step:7,totalSteps:7,label:"Broadcast reveal",status:"skipped",detail:"dry run"}));for(let n=0;n<r.length;n++)r[n];const he=r.map((e,t)=>({index:t,inscriptionId:e.inscriptionId,priceSats:String(e.priceSats),listedOutpoint:`${ge}:${t}`,bitmapNumber:e.bitmapNumber??null,collectionKey:e.collectionKey??null,offerPsbtBase64:Q.offerResults[t]?.signedOfferPsbt?.toBase64?.()||null}));return{mode:"multi-asset-3tx-complete",assetCount:A,commitTxid:z,commitTxHex:D,revealTxid:ge||null,revealTxHex:me,listedAssets:he,embeddedPayloadBytes:te.length,embeddedOfferHashHex:ie,carrierChunksUsed:ne.length,carrierChunksMax:_,listingScriptAddress:P,broadcasted:!!l,compressed:!1!==d}}const fo=Object.freeze(Object.defineProperty({__proto__:null,OODL_LISTING_TLV_MAGIC:Ea,OODL_LISTING_TLV_VERSION:3,buildListingCommitTx:io,buildMultiAssetListingCommitTx:uo,createAndBroadcast3TxSaleListingFlow:oo,createAndBroadcastListingCommitTx:ao,createAndBroadcastMultiAsset3TxSaleListingFlow:po,createAndBroadcastSaleListingTx:so,extractMultiOfferFromRevealTxWithBitcoinLib:co,extractOodlListingMetadataFromRevealTxWithBitcoinLib:Ra,extractSellerPsbtFromRevealTx:$a,extractSellerPsbtFromRevealTxWithBitcoinLib:Ma},Symbol.toStringTag,{value:"Module"}));function mo(e){return(null==e?"":String(e)).trim()}async function go({walletState:e,walletProvider:t,offers:r,sellerPayoutAddress:i,minBlockHeight:a=null}){if(!e?.isConnected)throw new Error("Wallet not connected");if(!t)throw new Error("Wallet provider not available");if(!i)throw new Error("Wallet payout address not available");if(!Array.isArray(r)||0===r.length)return[];if(String(e?.walletType||t?.walletType||t?.name||"").toLowerCase().includes("phantom"))throw new Error("Phantom wallet is not supported for creating signed Open Store seller offers (requires 0x83 SIGHASH_SINGLE|ANYONECANPAY).");const{loadBitcoinLibFromInscription:o}=await n(async()=>{const{loadBitcoinLibFromInscription:e}=await Promise.resolve().then(()=>An);return{loadBitcoinLibFromInscription:e}},__VITE_PRELOAD__),{sanitizePsbtForSharing:s}=await n(async()=>{const{sanitizePsbtForSharing:e}=await Promise.resolve().then(()=>ps);return{sanitizePsbtForSharing:e}},__VITE_PRELOAD__),{assertOpenStoreSellerOfferSignedCorrectly:l}=await n(async()=>{const{assertOpenStoreSellerOfferSignedCorrectly:e}=await Promise.resolve().then(()=>cs);return{assertOpenStoreSellerOfferSignedCorrectly:e}},__VITE_PRELOAD__),{signPsbtsWithFallback:c}=await n(async()=>{const{signPsbtsWithFallback:e}=await Promise.resolve().then(()=>er);return{signPsbtsWithFallback:e}},__VITE_PRELOAD__),u=await o(),d=await async function(e){const t="undefined"!=typeof window&&window.__NEXUS_NETWORK__||"mainnet",n=String(t).toLowerCase();return"testnet"===n||"signet"===n||"regtest"===n?e.networks.testnet:e.networks.bitcoin}(u),p=r.map(n=>function({btc:e,network:t,walletState:n,walletProvider:r,parentUtxo:i,priceSats:a,sellerPayoutAddress:o,minBlockHeight:s=null}){const l=i&&"object"==typeof i?i:null;if(!l?.txid||null==l?.vout)throw new Error("Selected inscription is missing UTXO data. Refresh inscriptions/UTXOs and try again.");const c=Number(l?.value);if(!Number.isFinite(c)||c<=0)throw new Error("Selected inscription UTXO is missing value. Refresh UTXOs/inscriptions and try again.");const u=mo(l?.address||l?.addr||n?.ordinalsAddress);if(!u)throw new Error("Parent UTXO missing address. Ensure wallet ordinalsAddress is available.");const d=(e.Transaction?.SIGHASH_SINGLE??3)|(e.Transaction?.SIGHASH_ANYONECANPAY??128),p=new e.Psbt({network:t});if(null!=s){const e=Number(s);if(!Number.isFinite(e)||e<0||e>4294967295||!Number.isInteger(e))throw new Error("minBlockHeight must be a uint32 block height");try{"function"==typeof p.setLocktime?p.setLocktime(e>>>0):p.__CACHE?.__TX&&(p.__CACHE.__TX.locktime=e>>>0)}catch{throw new Error("Wallet/bitcoinjs-lib does not support setting PSBT locktime")}}const f=Buffer.alloc(32,0),m={script:Buffer.from("0014"+"00".repeat(20),"hex"),value:1};p.addInput({hash:f,index:4294967294,sequence:4294967293,witnessUtxo:m}),p.addInput({hash:f,index:4294967295,sequence:4294967293,witnessUtxo:m});const g=e.address.toOutputScript(u,t);p.addInput({hash:l.txid,index:Number(l.vout),witnessUtxo:{script:g,value:Math.floor(c)},sighashType:d,sequence:4294967293});try{const e=r?.getState?.()?.ordinalsPublicKey||r?.getState?.()?.publicKey||n?.ordinalsPublicKey||n?.publicKey||null,t="string"==typeof e?e.startsWith("0x")?e.slice(2):e:null;if("string"==typeof u&&(u.startsWith("bc1p")||u.startsWith("tb1p"))&&t&&(64===t.length||66===t.length)&&p?.data?.inputs?.[2]){const e=66===t.length?t.slice(2):t;p.data.inputs[2].tapInternalKey=Buffer.from(e,"hex")}}catch{}p.addOutput({address:o,value:0}),p.addOutput({address:o,value:546});const h=c>546?BigInt(c)-BigInt(546):0n,b=BigInt(Math.floor(Number(a)))+h;return p.addOutput({address:o,value:Number(b)}),{offerPsbt:p,sellerInputIndex:2,address:u,sellerSighash:d}}({btc:u,network:d,walletState:e,walletProvider:t,parentUtxo:n?.parentUtxo,priceSats:n?.priceSats,sellerPayoutAddress:i,minBlockHeight:null!=n?.minBlockHeight?n.minBlockHeight:a})),f=p.map(e=>e.offerPsbt.toHex()),m=p.map(e=>({autoFinalized:!1,toSignInputs:[{index:e.sellerInputIndex,address:e.address,sighashType:e.sellerSighash}],sighashTypes:[e.sellerSighash]})),g=await c(t,f,m);if(!Array.isArray(g)||g.length!==f.length)throw new Error("Wallet returned unexpected signed PSBT result");const h=[];for(let n=0;n<g.length;n++){const e=p[n].offerPsbt,t=g[n];let r;try{r=u.Psbt.fromHex(t,{network:d})}catch{r=u.Psbt.fromBase64(t,{network:d})}l({unsignedOfferPsbt:e,signedOfferPsbt:r,sellerInputIndex:p[n].sellerInputIndex,expectedSighashByte:131}),h.push(await s(r.toBase64(),{profile:"publish"}))}return h}function ho(e){const t=Number(e);return Number.isFinite(t)?Math.max(0,Math.floor(t)):null}function bo(e,t){try{if("bigint"==typeof e)return e;if("number"==typeof e){if(!Number.isFinite(e))throw new Error("not finite");return BigInt(Math.floor(e))}if("string"==typeof e){const t=String(e).trim();if(!t)throw new Error("empty");return BigInt(t)}throw new Error("unsupported type")}catch(n){throw new Error(`${t}: invalid bigint (${n?.message||n})`)}}function yo(e){if("string"!=typeof e)return!1;const t=e.trim();return t.length>0&&t.length%2==0&&/^[0-9a-fA-F]+$/.test(t)}function xo(e){const t="undefined"!=typeof window&&window.__NEXUS_NETWORK__||"mainnet";return"testnet"===String(t).toLowerCase()||"signet"===String(t).toLowerCase()||"regtest"===String(t).toLowerCase()?e.networks.testnet:e.networks.bitcoin}function wo(){const e="undefined"!=typeof window&&window.__NEXUS_NETWORK__||"mainnet",t=String(e).toLowerCase();return"testnet"===t||"signet"===t||"regtest"===t?"testnet":"mainnet"}function vo(e){return e?String(e).split(":")[0].trim():e}function So(e){const t=e?.output||e?.location||e?.satpoint;if(!t||"string"!=typeof t)return null;const n=t.split(":");if(n.length<2)return null;const r=String(n[0]||"").trim(),i=Number(n[1]);return/^[0-9a-f]{64}$/i.test(r)?!Number.isFinite(i)||i<0?null:{txid:r.toLowerCase(),vout:Math.floor(i)}:null}async function Eo(e){const t=vo(e);if(!t)throw new Error("fetchOrdinalsInscriptionDetails: inscriptionId is required");const n=kt(`/r/inscription/${t}`),r=await fetch(n);if(!r.ok)throw new Error(`Failed to fetch /r/inscription/${t} (status ${r.status})`);return await r.json()}function No(e){const t=vo(e);if(!t)return null;const n=/^([0-9a-f]{64})i(\d+)$/i.exec(t);return n?{revealTxid:String(n[1]).toLowerCase(),inscriptionIndex:Number(n[2]),inscriptionId:t}:null}async function Io(e){const t=String(e||"").trim();if(!/^[0-9a-fA-F]{64}$/.test(t))throw new Error("fetchRawTxHexByTxid: txid must be 64 hex chars");const n=async e=>{const t=String(e?.headers?.get?.("content-type")||"").toLowerCase(),n=String(await e.text()||"").trim();if(yo(n))return n;if(t.includes("application/json")||n.startsWith("{")||n.startsWith("["))try{const e=JSON.parse(n),t=[e?.hex,e?.txHex,e?.rawtx,e?.rawTx,e?.data?.hex,e?.result?.hex].filter(e=>"string"==typeof e);for(const n of t){const e=String(n).trim();if(yo(e))return e}}catch{}const r=n.slice(0,200).toLowerCase();if(r.includes("<!doctype")||r.includes("<html")||r.includes("<head")||r.includes("<body"))return null;const i=n.match(/\b[0-9a-fA-F]{200,}\b/);return i&&yo(i[0])?i[0]:null},r=kt(`/r/tx/${t}`),i=await fetch(r);if(i.ok){const e=await n(i);if(e)return e}try{const e="undefined"!=typeof window&&"string"==typeof window.__NEXUS_ORDINALS_ORIGIN__?String(window.__NEXUS_ORDINALS_ORIGIN__||"").trim():"";if(e){const r=await fetch(`${e}/r/tx/${t}`,{headers:{Accept:"text/plain"}});if(!r.ok)throw new Error(`fetchRawTxHexByTxid: failed (${r.status})`);const i=await n(r);if(i)return i}}catch{}throw new Error("fetchRawTxHexByTxid: response did not look like raw tx hex. This usually means your host is not proxying /r/tx to ordinals.com (it returned HTML/JSON).")}async function Ao(e,t={}){const n=String(e||"").trim().toLowerCase();if(!/^[0-9a-f]{64}$/.test(n))throw new Error("getSellerOfferPsbtBase64FromRevealTxid: revealTxid must be 64 hex");const r=String(t?.inscriptionId||"").trim()||null,i=Number.isFinite(Number(t?.outputIndex))?Number(t.outputIndex):null,a=await In(),o=await Io(n);let s=null;try{const e=await co(a,o,{requirePsbtMagic:!0});if(Array.isArray(e)&&e.length>0){const t=r?e.find(e=>String(e?.inscriptionId||"").toLowerCase()===String(r).toLowerCase()):null,n=null!==i?e.find(e=>Number(e?.outputIndex)===Number(i)):null;s=t?.psbtBytes||n?.psbtBytes||e[0]?.psbtBytes||null}}catch{s=null}if(s||(s=await Ma(a,o,{requirePsbtMagic:!0})),!s||0===s.length)throw new Error("No embedded seller offer PSBT found in reveal tx");return Buffer.from(s).toString("base64")}function ko(e){const t=Buffer.isBuffer(e)?e:Buffer.from(e||[]);return 34===t.length&&81===t[0]&&32===t[1]?"p2tr":22===t.length&&0===t[0]&&20===t[1]?"p2wpkh":34===t.length&&0===t[0]&&32===t[1]?"p2wsh":23===t.length&&169===t[0]&&20===t[1]&&135===t[22]?"p2sh":"unknown"}function To(e){const t=String(e||"").toLowerCase();return t.startsWith("bc1p")||t.startsWith("tb1p")?"p2tr":"p2wpkh"}function Co(e){return"p2tr"===ko(e)?"p2tr":"p2wpkh"}function Bo(e,t,n,r){const i=String(t||"").toLowerCase(),a=String(r||"").trim(),o=n?.getState?.()?.paymentPublicKey||null,s=a.startsWith("3")||a.startsWith("2");if(!("p2sh-p2wpkh"===i||s&&o))return{};try{const t=xo(e),n=Buffer.from(String(o),"hex"),r=e.payments.p2wpkh({pubkey:n,network:t});return r?.output?{redeemScript:r.output}:{}}catch{return{}}}function Po(e,t){const n=e.Transaction.fromHex(String(t||"").trim());for(let r=0;r<n.outs.length;r++){const t=n.outs[r],i=e.script.decompile(t.script)||[];if(i.length<2)continue;if(i[0]!==e.opcodes.OP_RETURN)continue;const a=i[1];if(!a||"number"==typeof a)continue;const o=Di(Uint8Array.from(a));if(o&&2===o.version&&!(Number(o.openStoreVersion||0)<1)&&1===Number(o.outputOrderVersion||0))return o}return null}function _o(e){if(!e)return null;const t=e?.locktime;if("number"==typeof t&&Number.isFinite(t))return t>>>0;const n=e?.__CACHE?.__TX;if(n&&"number"==typeof n.locktime&&Number.isFinite(n.locktime))return n.locktime>>>0;const r=e?.data?.globalMap?.unsignedTx;return r&&"number"==typeof r.locktime&&Number.isFinite(r.locktime)?r.locktime>>>0:null}async function Oo(e){const t=e?.minBlockHeight,n=null!=t;if(!n)return null;const r=await Si(wo());if(!Number.isFinite(r))throw new Error("createAndBroadcastBuyFromRevealTx: failed to fetch current block height");if(n){const e=Number(t);if(!Number.isFinite(e)||e<0||!Number.isInteger(e))throw new Error("createAndBroadcastBuyFromRevealTx: invalid marker.minBlockHeight");if(r<e)throw new Error("createAndBroadcastBuyFromRevealTx: OODL_LISTING_NOT_YET_VALID")}return r}async function Lo(e){if(null==e)return null;const t=Number(e);if(!Number.isFinite(t)||t<0||!Number.isInteger(t))throw new Error("createAndBroadcastBuyFromRevealTx: invalid minBlockHeight");const n=await Si(wo());if(!Number.isFinite(n))throw new Error("createAndBroadcastBuyFromRevealTx: failed to fetch current block height");if(n<t)throw new Error("createAndBroadcastBuyFromRevealTx: OODL_LISTING_NOT_YET_VALID");return n}function Fo(e,t,{script:n,value:r}){const i=n?Buffer.from(n).toString("hex"):null,a=ho(r);"function"==typeof e.updateOutput&&e.updateOutput(t,{script:n,value:r});const o=e?.txOutputs?.[t]||null,s=o?.script?Buffer.from(o.script).toString("hex"):null,l=ho(o?.value);if(!(i&&s!==i||null!==a&&l!==a))return;const c=e?.__CACHE?.__TX;if(!c?.outs?.[t])throw new Error(`createAndBroadcastBuyFromRevealTx: cannot update output[${t}] on this bitcoinjs-lib version`);c.outs[t].script=Buffer.from(n),c.outs[t].value=Number(r);const u=e?.txOutputs?.[t]||c?.outs?.[t]||null,d=u?.script?Buffer.from(u.script).toString("hex"):null,p=ho(u?.value);if(i&&d!==i||null!==a&&p!==a)throw new Error(`createAndBroadcastBuyFromRevealTx: output[${t}] did not update as expected`)}function Mo(e,t,n,r){const i=String(n||"").trim().toLowerCase();if(!/^[0-9a-f]{64}$/.test(i))throw new Error("forceReplaceInputOutpoint: txid must be 64 hex");const a=Number(r);if(!Number.isFinite(a)||a<0)throw new Error("forceReplaceInputOutpoint: vout must be >=0");const o=Buffer.from(i,"hex").reverse(),s=e?.__CACHE?.__TX||e?.data?.globalMap?.unsignedTx?.tx||null;if(!s?.ins?.[t])throw new Error(`forceReplaceInputOutpoint: missing unsigned tx input[${t}]`);s.ins[t].hash=o,s.ins[t].index=a,Array.isArray(e?.txInputs)&&e.txInputs[t]&&(e.txInputs[t].hash=o,e.txInputs[t].index=a)}function Ro(e){if(!e)return null;try{return Buffer.from(e).toString("hex")}catch{return null}}function $o(e,t){try{const n=e?.txInputs?.[t];if(!n)return null;const r=n?.hash?Buffer.from(n.hash).reverse().toString("hex"):null,i="number"==typeof n?.index?n.index:"number"==typeof n?.vout?n.vout:null;return r&&null!==i?`${r.toLowerCase()}:${Math.floor(Number(i))}`:null}catch{return null}}function Uo(e){const t=[];for(let r=0;r<(e?.inputCount||0);r+=1)t.push($o(e,r));const n=(e?.txOutputs||[]).map(e=>({value:Number(e?.value??NaN),scriptHex:Ro(e?.script)}));return{inputCount:Number(e?.inputCount||0),outputCount:Number(e?.txOutputs?.length||0),prevouts:t,outputs:n}}function zo(e,t,n,r){const i=e?.txInputs?.[t]||null;if(!i)throw new Error(`${r}: Open Store offer missing input[${t}]`);const a=i?.hash?Buffer.from(i.hash):null,o=!(!a||32!==a.length||!a.equals(Buffer.alloc(32,0))),s="number"==typeof i?.index?i.index:null,l=s===n,c=Number.isInteger(s)&&s>=4294901760&&s<=4294967295;if(!o||!l&&!c)throw new Error(`${r}: Open Store offer input[${t}] is not a placeholder sentinel`)}function Do(e,{marker:t=null,context:n}){const r=n||"Open Store offer";if(3!==Number(e?.inputCount||0))throw new Error(`${r}: Open Store offer must have exactly 3 inputs`);const i=Number(e?.txOutputs?.length||0);if(t){const n=t?.platformFeeSats,a=(null==n?0n:bo(n,"marker.platformFeeSats"))>0n,o=a?4:3;if(i!==o)throw new Error(`${r}: Open Store offer output count mismatch (expected ${o}, got ${i})`);if(!a&&e?.txOutputs?.[3])throw new Error(`${r}: Open Store offer unexpectedly includes output[3] (platform fee)`)}else if(3!==i&&4!==i)throw new Error(`${r}: Open Store offer must have exactly 3 or 4 outputs`);zo(e,0,4294967294,r),zo(e,1,4294967295,r);const a=e?.txInputs?.[0]||null,o=e?.txInputs?.[1]||null,s=Number(a?.index),l=Number(o?.index);if(Number.isFinite(s)&&Number.isFinite(l)&&s===l)throw new Error(`${r}: Open Store offer placeholder inputs must use distinct sentinel outpoints`)}function Ho(e,{sellerInputIndex:t=2,inscriptionOutputIndex:n=1,sellerPayoutOutputIndex:r=2,platformFeeOutputIndex:i=3}={}){const a=$o(e,t),o=Uo(e),s=e?.txOutputs?.[n]||null,l=e?.txOutputs?.[r]||null,c=e?.txOutputs?.[0]||null,u=e?.txOutputs?.[i]||null;return{inputCount:o.inputCount,outputCount:o.outputCount,prevouts:o.prevouts,outputs:o.outputs,sellerPrevout:a,buyerChangeOut:c?{idx:0,value:Number(c?.value??NaN),scriptHex:Ro(c?.script)}:null,inscriptionOut:{idx:n,value:Number(s?.value??NaN),scriptHex:Ro(s?.script)},sellerPayoutOut:{idx:r,value:Number(l?.value??NaN),scriptHex:Ro(l?.script)},platformFeeOut:u?{idx:i,value:Number(u?.value??NaN),scriptHex:Ro(u?.script)}:null}}function Wo(e,t,{sellerInputIndex:n=2,inscriptionOutputIndex:r=1,sellerPayoutOutputIndex:i=2,platformFeeOutputIndex:a=3}={}){!function(e,t){if(!e||!t)throw new Error("OODL_BUY_WALLET_MUTATED_UNKNOWN");if(Number(e?.inputCount||0)!==Number(t?.inputCount||0))throw new Error("OODL_BUY_WALLET_MUTATED_INPUT_COUNT");if(Number(e?.outputCount||0)!==Number(t?.txOutputs?.length||0))throw new Error("OODL_BUY_WALLET_MUTATED_OUTPUT_COUNT");const n=Uo(t),r=Array.isArray(e?.prevouts)?e.prevouts:[],i=Array.isArray(n?.prevouts)?n.prevouts:[];if(r.length!==i.length)throw new Error("OODL_BUY_WALLET_MUTATED_INPUTS");for(let s=0;s<r.length;s+=1)if(!r[s]||!i[s]||r[s]!==i[s])throw new Error("OODL_BUY_WALLET_MUTATED_INPUTS");const a=Array.isArray(e?.outputs)?e.outputs:[],o=Array.isArray(n?.outputs)?n.outputs:[];if(a.length!==o.length)throw new Error("OODL_BUY_WALLET_MUTATED_OUTPUTS");for(let s=0;s<a.length;s+=1){const e=a[s]||{},t=o[s]||{};if(!Number.isFinite(Number(e?.value))||!Number.isFinite(Number(t?.value))||Number(e.value)!==Number(t.value))throw new Error("OODL_BUY_WALLET_MUTATED_OUTPUTS");if(!e?.scriptHex||!t?.scriptHex||e.scriptHex!==t.scriptHex)throw new Error("OODL_BUY_WALLET_MUTATED_OUTPUTS")}}(e,t);const o=$o(t,n);if(!e?.sellerPrevout||!o||e.sellerPrevout!==o)throw new Error("OODL_BUY_WALLET_MUTATED_SELLER_INPUT_OUTPOINT");const s=t?.txOutputs?.[r]||null,l=t?.txOutputs?.[i]||null,c=t?.txOutputs?.[0]||null,u=t?.txOutputs?.[a]||null,d=Ro(s?.script),p=Ro(l?.script),f=Ro(c?.script),m=Ro(u?.script);if(e?.buyerChangeOut){if(!e.buyerChangeOut.scriptHex||!f||e.buyerChangeOut.scriptHex!==f)throw new Error("OODL_BUY_WALLET_MUTATED_BUYER_CHANGE_OUTPUT_SCRIPT");if(!Number.isFinite(e.buyerChangeOut.value)||!Number.isFinite(Number(c?.value))||e.buyerChangeOut.value!==Number(c.value))throw new Error("OODL_BUY_WALLET_MUTATED_BUYER_CHANGE_OUTPUT_VALUE")}if(!e?.inscriptionOut?.scriptHex||!d||e.inscriptionOut.scriptHex!==d)throw new Error("OODL_BUY_WALLET_MUTATED_INSCRIPTION_OUTPUT_SCRIPT");if(!Number.isFinite(e?.inscriptionOut?.value)||!Number.isFinite(Number(s?.value))||e.inscriptionOut.value!==Number(s.value))throw new Error("OODL_BUY_WALLET_MUTATED_INSCRIPTION_OUTPUT_VALUE");if(!e?.sellerPayoutOut?.scriptHex||!p||e.sellerPayoutOut.scriptHex!==p)throw new Error("OODL_BUY_WALLET_MUTATED_SELLER_PAYOUT_SCRIPT");if(!Number.isFinite(e?.sellerPayoutOut?.value)||!Number.isFinite(Number(l?.value))||e.sellerPayoutOut.value!==Number(l.value))throw new Error("OODL_BUY_WALLET_MUTATED_SELLER_PAYOUT_VALUE");if(e?.platformFeeOut){if(!u)throw new Error("OODL_BUY_WALLET_MUTATED_PLATFORM_FEE_MISSING");if(!e.platformFeeOut.scriptHex||!m||e.platformFeeOut.scriptHex!==m)throw new Error("OODL_BUY_WALLET_MUTATED_PLATFORM_FEE_SCRIPT");if(!Number.isFinite(e.platformFeeOut.value)||!Number.isFinite(Number(u?.value))||e.platformFeeOut.value!==Number(u.value))throw new Error("OODL_BUY_WALLET_MUTATED_PLATFORM_FEE_VALUE")}}function jo(e,t){const n=function(e,t){if(!e)return null;const n=e?.fullUtxo||e?.utxo||e?.raw||e?.full||e,r=n.txid||n.txId||n.hash,i=n.vout??n.index??n.n,a=n.value??n.satoshis??n.amount,o=n.address||n.addr||t||null,s=n.scriptPubKey||n.scriptHex||n.script||null;return r&&null!=i&&Number.isFinite(Number(i))&&null!=a&&Number.isFinite(Number(a))?{txid:String(r),vout:Number(i),value:Number(a),address:o,scriptPubKey:s}:null}(e,t);return n&&n.address?n:null}async function Vo({walletProvider:e,revealTxid:t,buyerPaymentUtxos:n=null,buyerChangeAddress:r=null,buyerReceiveAddress:i=null,expectedPostageSats:a=null,expectedInscriptionInputOffset:o=null,targetInscriptionId:s=null,targetRevealOutputIndex:l=null,feeRateSatPerVb:c=10,broadcast:u=!0,onProgress:d=null}){if(!e)throw new Error("createAndBroadcastBuyFromRevealTx: walletProvider is required");const p=String(t||"").trim();if(!/^[0-9a-fA-F]{64}$/.test(p))throw new Error("createAndBroadcastBuyFromRevealTx: revealTxid must be 64 hex chars");const f="function"==typeof d?d:()=>{},m=await In(),g=xo(m);f({step:1,totalSteps:6,label:"Fetch listing",status:"active"});const h=e?.getState?.()||{},b=(e=>{if(!Array.isArray(e)||0===e.length)return{payment:null,ordinals:null,all:[]};if("object"==typeof e[0]&&null!==e[0])return{payment:e.find(e=>"payment"===String(e?.purpose||"").toLowerCase())?.address||null,ordinals:e.find(e=>"ordinals"===String(e?.purpose||"").toLowerCase())?.address||null,all:e.map(e=>e?.address).filter(e=>"string"==typeof e)};const t=e.filter(e=>"string"==typeof e);return{payment:t[0]||null,ordinals:t[0]||null,all:t}})(await(async()=>{try{if("function"==typeof e?.getAccounts){const t=await e.getAccounts();return Array.isArray(t)?t:null}if("function"==typeof e?.requestAccounts){const t=await e.requestAccounts();return Array.isArray(t)?t:null}}catch{}return null})()),y=r||b?.payment||h?.paymentAddress||h?.address||h?.ordinalsAddress;if(!y)throw new Error("createAndBroadcastBuyFromRevealTx: buyerChangeAddress is required");const x=await Io(p);let w=null;try{w=await Ra(m,x)}catch{w=null}let v,S=null;{const e=await co(m,x,{requirePsbtMagic:!0}).catch(()=>[]);if(Array.isArray(e)&&e.length>0){const t=String(s||"").trim().toLowerCase(),n=t?e.find(e=>String(e?.inscriptionId||"").trim().toLowerCase()===t):null,r=Number.isFinite(Number(l))?e.find(e=>Number(e?.outputIndex)===Number(l)):null;S=n||r||e[0]||null}}f({step:1,totalSteps:6,label:"Fetch listing",status:"done"}),f({step:2,totalSteps:6,label:"Extract offer",status:"active"});try{v=S?.psbtBytes?S.psbtBytes:await Ma(m,x,{requirePsbtMagic:!0})}catch(Pe){throw new Error("createAndBroadcastBuyFromRevealTx: reveal tx does not contain an embedded seller offer PSBT (OODL frame). This does not look like an OODL listing reveal tx.")}const E=Po(m,x),N=w&&Number.isFinite(Number(w?.minBlockHeight))?Number(w.minBlockHeight):null;let I,A=null;null!=E?.minBlockHeight?A=await Oo(E):null!=N&&(A=await Lo(N));try{I="function"==typeof m.Psbt.fromBuffer?m.Psbt.fromBuffer(v,{network:g}):m.Psbt.fromBase64(v.toString("base64"),{network:g})}catch(Pe){throw new Error(`createAndBroadcastBuyFromRevealTx: failed to parse embedded seller PSBT (${Pe?.message||Pe})`)}if(null===A){const e=function(e){const t=Number(e);if(!Number.isFinite(t)||t<0)return null;const n=Math.floor(t)>>>0;return n>=5e8?null:n}(_o(I));null!==e&&(A=await Lo(e))}if(I.inputCount<1)throw new Error("createAndBroadcastBuyFromRevealTx: seller PSBT had no inputs");if(!I.txOutputs||I.txOutputs.length<1)throw new Error("createAndBroadcastBuyFromRevealTx: seller PSBT had no outputs");Do(I,{marker:E||null,context:"createAndBroadcastBuyFromRevealTx"});{const e=null!=E?.minBlockHeight?Number(E.minBlockHeight):null!=N?Number(N):null;if(null!==e){const t=_o(I);if(null===t)throw new Error("createAndBroadcastBuyFromRevealTx: OODL_LISTING_LOCKTIME_UNAVAILABLE");if(t>>>0!=e>>>0)throw new Error("createAndBroadcastBuyFromRevealTx: OODL_LISTING_LOCKTIME_MISMATCH");if(null!==A&&Number.isFinite(A)&&A<e)throw new Error("createAndBroadcastBuyFromRevealTx: OODL_LISTING_NOT_YET_VALID")}}try{const e=m.Transaction.fromHex(x).getId(),t=I?.txInputs?.[2],n=t?.hash?Buffer.from(t.hash).reverse().toString("hex"):null,r="number"==typeof t?.index?t.index:null;if(n&&e&&n.toLowerCase()!==e.toLowerCase())throw new Error(`createAndBroadcastBuyFromRevealTx: listing is inconsistent (offer does not spend reveal txid). offerPrevTxid=${n} revealTxid=${e}.`);const i=Number.isFinite(Number(S?.outputIndex))?Number(S.outputIndex):Number.isFinite(Number(l))?Number(l):0;if(null!==r&&r!==i)throw new Error(`createAndBroadcastBuyFromRevealTx: listing is inconsistent (offer prevout vout mismatch). offerPrevVout=${r} expected=${i}`)}catch(Pe){throw new Error(String(Pe?.message||Pe))}{const e=I?.data?.inputs?.[2]||{},t=e?.sighashType,n="number"==typeof t&&131==(255&t),r=e?.tapKeySig,i=(e=>{if(!e)return!1;const t=Buffer.isBuffer(e)?e:Buffer.from(e);return t.length>=65&&131===t[t.length-1]})(r);if(!n&&!i)throw new Error("createAndBroadcastBuyFromRevealTx: Open Store offer missing 0x83 seller signature on input[2]")}if(!I.txOutputs[2])throw new Error("createAndBroadcastBuyFromRevealTx: seller payout output[2] missing");if(E){const e=Number(E?.openStoreVersion||0),t=Number.isFinite(e)&&e>=2,n=String(E?.psbtHashHex||"").toLowerCase(),r=/^[0-9a-f]{64}$/.test(n),i=n==="0".repeat(64);if(t&&(!r||i))throw new Error("createAndBroadcastBuyFromRevealTx: OODL_LISTING_PSBT_HASH_MISSING");if(r&&!i){const e=function(e){if(!e)return null;if("function"==typeof e.toBuffer)return e.toBuffer();if("function"==typeof e.toBase64)try{return Buffer.from(e.toBase64(),"base64")}catch{return null}return null}(I);if(!e)throw new Error("createAndBroadcastBuyFromRevealTx: failed to serialize offer PSBT for hashing");if(n!==m.crypto.sha256(e).toString("hex").toLowerCase())throw new Error("createAndBroadcastBuyFromRevealTx: OODL_LISTING_PSBT_HASH_MISMATCH")}}if(!I?.txOutputs?.[1])throw new Error("createAndBroadcastBuyFromRevealTx: offer missing output[1] (inscription output)");const k=bo(ho(I.txOutputs[1]?.value)||0,"offer.output[1].value");if(k<=0n)throw new Error("createAndBroadcastBuyFromRevealTx: offer output[1] postage must be > 0");const T=null!=a?bo(a,"expectedPostageSats"):null;if(null!==T&&T<=0n)throw new Error("createAndBroadcastBuyFromRevealTx: expectedPostageSats must be > 0 when provided");if(null!==T&&k!==T)throw new Error(`createAndBroadcastBuyFromRevealTx: offer output[1] postage does not match inscription UTXO postage. offerPostageSats=${k.toString()} expectedPostageSats=${T.toString()}`);if(null!=E?.postageSats){const e=bo(E.postageSats,"marker.postageSats");if(e<=0n)throw new Error("createAndBroadcastBuyFromRevealTx: marker.postageSats must be > 0");if(e!==k)throw new Error("createAndBroadcastBuyFromRevealTx: offer output[1] value does not match marker postage");if(null!==T&&e!==T)throw new Error("createAndBroadcastBuyFromRevealTx: marker postage does not match inscription UTXO postage")}const C=null!==T?T:k;let B=0n;if(null!=E?.platformFeeSats){if(B=bo(E.platformFeeSats,"marker.platformFeeSats"),B<0n)throw new Error("createAndBroadcastBuyFromRevealTx: marker.platformFeeSats must be >= 0");if(!I?.txOutputs?.[3])throw new Error("createAndBroadcastBuyFromRevealTx: marker commits to platform fee but offer missing output[3]");if(bo(ho(I.txOutputs[3].value)||0,"offer.output[3].value")!==B)throw new Error("createAndBroadcastBuyFromRevealTx: offer output[3] value does not match marker platform fee");const e=m.crypto.sha256(Buffer.from(I.txOutputs[3].script)).toString("hex").toLowerCase(),t=String(E?.platformFeeScriptHashHex||"").toLowerCase();if(t&&t!==e)throw new Error("createAndBroadcastBuyFromRevealTx: platformFeeScriptHash commitment mismatch")}else I?.txOutputs?.[3]&&(B=bo(ho(I.txOutputs[3].value)||0,"offer.output[3].value"),B<0n&&(B=0n));if(E){const e=I?.txOutputs?.[2]?.script;if(!e)throw new Error("createAndBroadcastBuyFromRevealTx: offer missing seller payout script at output[2]");const t=m.crypto.sha256(Buffer.from(e)).toString("hex").toLowerCase(),n=String(E?.sellerScriptHashHex||"").toLowerCase();if(n&&n!==t)throw new Error("createAndBroadcastBuyFromRevealTx: sellerScriptHash commitment mismatch")}const P=bo(ho(I.txOutputs?.[2]?.value)||0,"offer.output[2].value")+B,_=w&&null!=w?.priceSats?bo(w.priceSats,"meta.priceSats"):null;if(E&&null!==_&&bo(E?.priceSats,"marker.priceSats")!==_)throw new Error("createAndBroadcastBuyFromRevealTx: OODL_LISTING_PRICE_MISMATCH");const O=E?bo(E?.priceSats,"marker.priceSats"):null!==_?_:P;if(!E&&null!==_&&_!==P)throw new Error("createAndBroadcastBuyFromRevealTx: OODL_LISTING_PRICE_MISMATCH");if(O<=0n)throw new Error("createAndBroadcastBuyFromRevealTx: priceSats must be > 0");const L=I?.txOutputs?.[2]?.script,F=L?Buffer.from(L).toString("hex"):null,M=e=>Buffer.from(m.address.toOutputScript(String(e),g)).toString("hex");let R=null;try{const e=[i,b?.ordinals,b?.payment,...Array.isArray(b?.all)?b.all:[],h?.ordinalsAddress,h?.address,h?.paymentAddress,y].map(e=>e?String(e).trim():null).filter(Boolean);for(const t of e){if(!F){R=t;break}if(M(t)!==F){R=t;break}}if(!R)throw new Error("Could not choose a buyer receive address that differs from the seller inscription script. You are likely still connected to the seller wallet/account, or the app has not refreshed addresses after switching accounts. ")}catch(Pe){throw new Error(`createAndBroadcastBuyFromRevealTx: invalid buyer receive/change address (${Pe?.message||Pe})`)}const $=(e,t)=>{const n=e?.data?.inputs?.[t]||null;return!(!n||!n.finalScriptWitness&&!n.finalScriptSig)},U=(e,t,n)=>{void 0!==e[n]&&null!==e[n]||void 0!==t[n]&&null!==t[n]&&(e[n]=t[n])},z=I?.data?.inputs?.[2]||{},D=ho(I.txOutputs[2]?.value);if(!D)throw new Error("createAndBroadcastBuyFromRevealTx: seller PSBT output[2] had invalid value");const H=ho(I?.data?.inputs?.[2]?.witnessUtxo?.value);if(!H||H<=0)throw new Error("createAndBroadcastBuyFromRevealTx: seller input[2] missing witnessUtxo.value");{const e=O+(BigInt(H)>C?BigInt(H)-C:0n);if(BigInt(D)!==e)throw new Error("createAndBroadcastBuyFromRevealTx: seller payout output[2] does not match marker price + reclaim")}{const e=m.address.toOutputScript(R,g),t=m.address.toOutputScript(y,g);Fo(I,1,{script:e,value:Number(C)}),Fo(I,0,{script:t,value:ho(I.txOutputs?.[0]?.value)||0})}try{if(F){const e=I?.txOutputs?.[1],t=e?.script?Buffer.from(e.script).toString("hex"):null;if(t&&t===F){const e=e=>"string"==typeof e&&e.length>16?`${e.slice(0,16)}\u2026${e.slice(-8)}`:e;let n=null,r=null;try{n=M(R)}catch{}try{r=M(y)}catch{}throw new Error(`Output[1] (inscription receive) is still the seller inscription script after overwrite. Refusing to proceed to avoid returning the inscription to the seller. Details: receiveAddr=${String(R)} changeAddr=${String(y)} sellerScript=${e(F)} out1Script=${e(t)} receiveScript=${e(n)} changeScript=${e(r)}`)}}}catch(Pe){throw new Error(`createAndBroadcastBuyFromRevealTx: ${Pe?.message||Pe}`)}f({step:2,totalSteps:6,label:"Extract offer",status:"done"}),f({step:3,totalSteps:6,label:"Build transaction",status:"active"});const W=Array.isArray(n)?n:h?.utxos||h?.paymentUtxos||null,j=(Array.isArray(W)?W:[]).map(e=>jo(e,y)).filter(Boolean);if(0===j.length)throw new Error("createAndBroadcastBuyFromRevealTx: buyerPaymentUtxos is required (fetch UTXOs first)");const V=j.slice().sort((e,t)=>t.value-e.value),q=[],X=[];let K=0;const G=h?.paymentPublicKey||null,Y=546,J=e=>{const t=String(e||"").trim();let n,r={},i="p2wpkh";if(G&&(t.startsWith("3")||t.startsWith("2"))){const e=Buffer.from(G,"hex"),t=m.payments.p2wpkh({pubkey:e,network:g});n=m.payments.p2sh({redeem:t,network:g}).output,r.redeemScript=t.output,i="p2sh-p2wpkh"}else n=m.address.toOutputScript(t,g),i=t.startsWith("bc1p")||t.startsWith("tb1p")?"p2tr":"p2wpkh";return{witnessScriptPubKey:n,extraFields:r,inputType:i}},Q=e=>{const t=String(e.address||"").trim(),{witnessScriptPubKey:n,extraFields:r,inputType:i}=J(t),a=I.inputCount;I.addInput({hash:Buffer.from(e.txid,"hex").reverse(),index:e.vout,sequence:4294967293,witnessUtxo:{script:n,value:e.value},...r}),q.push({index:a,address:t}),X.push(i),K+=e.value},Z=(e,t)=>{const n=String(t.address||"").trim(),{witnessScriptPubKey:r,extraFields:i,inputType:a}=J(n);Mo(I,e,t.txid,t.vout);const o=I?.data?.inputs?.[e];if(!o)throw new Error(`createAndBroadcastBuyFromRevealTx: missing psbt.data.inputs[${e}] to replace`);o.witnessUtxo={script:r,value:t.value},i.redeemScript&&(o.redeemScript=i.redeemScript),q.push({index:e,address:n}),X.push(a),K+=t.value},ee=V.slice(),te=e=>{const t=ee[e];return ee.splice(e,1),t},ne=(()=>{if(ee.length<2)return null;const e=ee.slice().sort((e,t)=>e.value-t.value);for(let n=0;n<e.length;n++)for(let t=n+1;t<e.length;t++)if(e[n].value+e[t].value>=Y)return[e[n],e[t]];const t=ee.slice().sort((e,t)=>t.value-e.value);return[t[0],t[1]]})();if(!ne)throw new Error("createAndBroadcastBuyFromRevealTx: need at least 2 buyer UTXOs to fill Open Store dummy input slots");const re=te(ee.findIndex(e=>e.txid===ne[0].txid&&e.vout===ne[0].vout)),ie=te(ee.findIndex(e=>e.txid===ne[1].txid&&e.vout===ne[1].vout));Z(0,re),Z(1,ie);const ae=BigInt(re.value+ie.value);{const e=m.address.toOutputScript(y,g);Fo(I,0,{script:e,value:Number(ae)})}const oe=BigInt(H)>=C?0n:C-BigInt(H),se=BigInt(D),le=se+B+oe,ce=I?.data?.inputs?.[2]?.witnessUtxo?.script,ue=ko(ce),de=[X[0]||"p2wpkh",X[1]||"p2wpkh","p2wpkh"===ue?"p2wpkh":"p2tr"],pe=(I?.txOutputs||[]).map(e=>Co(e?.script)),fe=Number(c||10);let me=0n;for(const _e of ee){Q(_e),me+=BigInt(_e.value);const e=I.inputCount,t=Un(e,I.txOutputs.length,!0,0,{isReveal:!1,inputTypes:[...de,...X.slice(2)].slice(0,e),outputTypes:pe});if(me>=le+BigInt(Math.ceil(fe*t)))break}const ge=I.inputCount,he=I.txOutputs.length,be=[...de,...X.slice(2)].slice(0,ge),ye=Un(ge,he,!0,0,{isReveal:!1,inputTypes:be,outputTypes:pe}),xe=BigInt(Math.ceil(fe*ye)),we=me-(le+xe);let ve=xe,Se=we;if(we>=BigInt(Y)){const e=Un(ge,he+1,!0,0,{isReveal:!1,inputTypes:be,outputTypes:[...pe,To(y)]}),t=BigInt(Math.ceil(fe*e)),n=me-(le+t);n>=BigInt(Y)&&(ve=t,Se=n)}if(me<le+ve){const e=le+ve,t=e-me;throw new Error(`createAndBroadcastBuyFromRevealTx: insufficient buyer funds. Need >= ${e.toString()} sats (price+reclaim=${se.toString()}, platformFee=${B.toString()}, postageTopUp=${oe.toString()}, estFee=${ve.toString()}). Have ${me.toString()} sats. Short ${t.toString()} sats. Note: split-funding can increase UTXO count for Open Store, but it cannot create sats; fund your payment address and retry.`)}if(Se>=BigInt(Y)&&I.addOutput({address:y,value:Number(Se)}),null!=o){const e=Number(o);if(!Number.isFinite(e)||e<0)throw new Error("createAndBroadcastBuyFromRevealTx: expectedInscriptionInputOffset must be >= 0 when provided");const t=[];for(let a=0;a<I.inputCount;a+=1){const e=I?.data?.inputs?.[a]?.witnessUtxo?.value;if(!Number.isFinite(Number(e))||Number(e)<0)throw new Error("createAndBroadcastBuyFromRevealTx: cannot verify satpoint routing (missing witnessUtxo.value)");t.push(BigInt(Math.floor(Number(e))))}const n=(I?.txOutputs||[]).map(e=>BigInt(Math.floor(Number(e?.value||0)))),r=t[2]||0n;if(BigInt(e)>=r)throw new Error("createAndBroadcastBuyFromRevealTx: inscription offset is out of bounds for seller input value");const i=function({inputValues:e,outputValues:t,targetInputIndex:n,targetInputOffset:r}){if(!Array.isArray(e)||!Array.isArray(t))return null;const i=Number(n),a=Number(r);if(!Number.isFinite(i)||i<0)return null;if(!Number.isFinite(a)||a<0)return null;let o=0n;for(let s=0;s<i;s+=1){const t=e[s];if("bigint"!=typeof t||t<0n)return null;o+=t}o+=BigInt(a);for(let s=0;s<t.length;s+=1){const e=t[s];if("bigint"!=typeof e||e<0n)return null;if(o<e)return{outIndex:s,outOffset:o};o-=e}return null}({inputValues:t,outputValues:n,targetInputIndex:2,targetInputOffset:e});if(!i)throw new Error("createAndBroadcastBuyFromRevealTx: could not verify inscription sat routing");if(1!==i.outIndex)throw new Error("createAndBroadcastBuyFromRevealTx: INSCRIPTION_SATPOINT_ROUTING_MISMATCH");if(i.outOffset<0n||i.outOffset>=C)throw new Error("createAndBroadcastBuyFromRevealTx: INSCRIPTION_SATPOINT_ROUTING_OUT_OF_POSTAGE")}try{$(I,2)||I.finalizeInput(2)}catch(Pe){throw new Error(`createAndBroadcastBuyFromRevealTx: non-buyer input(s) could not be finalized locally. Embedded seller offer PSBT may be missing required Taproot data. Underlying error: ${Pe?.message||Pe}`)}const Ee=I.toHex(),Ne=Ho(I,{sellerInputIndex:2,inscriptionOutputIndex:1,sellerPayoutOutputIndex:2,platformFeeOutputIndex:3});f({step:3,totalSteps:6,label:"Build transaction",status:"done"}),f({step:4,totalSteps:6,label:"Sign inputs",status:"active",detail:"signing only, not broadcasting"});const Ie=await nr(e,Ee,{autoFinalized:!1,toSignInputs:q},!1),Ae=Ie?.signedPsbt||null;if(!Ae)throw new Error("createAndBroadcastBuyFromRevealTx: wallet did not return signed buyer PSBT");const ke=m.Psbt.fromHex(Ae,{network:g});try{Wo(Ne,ke,{sellerInputIndex:2,inscriptionOutputIndex:1,sellerPayoutOutputIndex:2,platformFeeOutputIndex:3})}catch(Pe){throw new Error(`createAndBroadcastBuyFromRevealTx: ${Pe?.message||Pe}`)}f({step:4,totalSteps:6,label:"Sign inputs",status:"done"}),f({step:5,totalSteps:6,label:"Finalize",status:"active"});try{const e=m.Psbt.fromHex(Ee,{network:g}),t=e?.data?.inputs?.[2]||{},n=ke?.data?.inputs?.[2]||{};U(n,t,"finalScriptWitness"),U(n,t,"finalScriptSig"),U(n,t,"tapKeySig"),U(n,t,"tapScriptSig"),U(n,t,"tapLeafScript"),U(n,t,"tapInternalKey"),U(n,t,"tapMerkleRoot"),U(n,t,"tapBip32Derivation"),U(n,z,"finalScriptWitness"),U(n,z,"finalScriptSig"),U(n,z,"tapKeySig"),U(n,z,"tapScriptSig"),U(n,z,"tapLeafScript"),U(n,z,"tapInternalKey"),U(n,z,"tapMerkleRoot"),U(n,z,"tapBip32Derivation")}catch{}const Te=[2,...q.map(e=>e.index)];for(const _e of Te)if(!$(ke,_e))try{ke.finalizeInput(_e)}catch(Pe){if(2===_e)throw new Error(`createAndBroadcastBuyFromRevealTx: cannot finalize seller taproot input #2. No usable Taproot signature present after wallet signing. Underlying error: ${Pe?.message||Pe}`);throw Pe}for(let _e=0;_e<ke.inputCount;_e+=1)if(!$(ke,_e))throw new Error(`createAndBroadcastBuyFromRevealTx: input #${_e} is not finalized after signing`);const Ce=ke.extractTransaction().toHex();f({step:5,totalSteps:6,label:"Finalize",status:"done"}),u&&f({step:6,totalSteps:6,label:"Broadcast",status:"active",detail:"all signed, now broadcasting"});const Be=u?await rr(e,{txHex:Ce,psbtBase64:Buffer.from(Ae,"hex").toString("base64")},wo(),"oodl-buy"):ke.extractTransaction().getId();return f(u?{step:6,totalSteps:6,label:"Broadcast",status:"done"}:{step:6,totalSteps:6,label:"Broadcast",status:"skipped",detail:"dry run"}),{mode:"buy-complete",revealTxid:p,inferredPriceSats:O.toString(),postageSats:C.toString(),sellerInputValueSats:String(H),buyerPostageTopUpSats:oe.toString(),sellerPayoutOutputSats:D,buyerInputsSats:K,feeSats:ve.toString(),changeSats:Se>=BigInt(Y)?Se.toString():"0",buyTxid:Be||null,buyTxHex:Ce,signedBuyerPsbtHex:Ae}}function qo({btc:e,network:t,walletProvider:n,offerPsbt:r,buyerChangeAddress:i,postageSats:a,platformFeeSats:o,feeRateSatPerVb:s}){if(!r)throw new Error("estimateMinSatsForOpenStoreBuy: offerPsbt is required");const l=String(i||"").trim();if(!l)throw new Error("estimateMinSatsForOpenStoreBuy: buyerChangeAddress is required");const c=ho(r.txOutputs?.[2]?.value);if(!c||c<=0)throw new Error("estimateMinSatsForOpenStoreBuy: offer missing/invalid seller payout output[2]");const u=ho(r?.data?.inputs?.[2]?.witnessUtxo?.value);if(!u||u<=0)throw new Error("estimateMinSatsForOpenStoreBuy: offer missing seller input[2] witnessUtxo.value");const d=bo(a,"postageSats"),p=bo(o||0n,"platformFeeSats"),f=BigInt(u)>=d?0n:d-BigInt(u),m=BigInt(c),g=m+p+f,h=n?.getState?.()?.paymentPublicKey||null,b=r?.data?.inputs?.[2]?.witnessUtxo?.script,y=ko(b),x=(e=>{const t=String(e||"").trim();return h&&(t.startsWith("3")||t.startsWith("2"))?"p2sh-p2wpkh":To(t)})(l)||"p2wpkh",w=[x,x,"p2wpkh"===y?"p2wpkh":"p2tr",x],v=[...(r?.txOutputs||[]).map(e=>Co(e?.script)),To(l)],S=Number(s||10),E=Un(4,(r?.txOutputs?.length||0)+1,!0,0,{isReveal:!1,inputTypes:w,outputTypes:v}),N=BigInt(Math.ceil(S*E));return{fixedNeedNoFee:g,feeEstimateSats:N,needTotalSats:g+N,breakdown:{sellerLockedOutSats:m,platformFeeSats:p,postageTopUpSats:f,postageSats:d,sellerInputValueSats:BigInt(u)}}}async function Xo({walletProvider:e,revealTxid:t,buyerChangeAddress:n,expectedPostageSats:r=null,feeRateSatPerVb:i=10}){if(!e)throw new Error("estimateBuyNeedFromRevealTx: walletProvider is required");const a=String(t||"").trim();if(!/^[0-9a-fA-F]{64}$/.test(a))throw new Error("estimateBuyNeedFromRevealTx: revealTxid must be 64 hex chars");const o=String(n||"").trim();if(!o)throw new Error("estimateBuyNeedFromRevealTx: buyerChangeAddress is required");const s=await In(),l=xo(s),c=await Io(a);let u,d=null;try{d=await Ra(s,c)}catch{d=null}try{u=await Ma(s,c,{requirePsbtMagic:!0})}catch{throw new Error("estimateBuyNeedFromRevealTx: reveal tx does not contain an embedded seller offer PSBT (OODL frame)")}const p=Po(s,c),f=d&&Number.isFinite(Number(d?.minBlockHeight))?Number(d.minBlockHeight):null;let m;null!=p?.minBlockHeight?await Oo(p):null!=f&&await Lo(f);try{m="function"==typeof s.Psbt.fromBuffer?s.Psbt.fromBuffer(u,{network:l}):s.Psbt.fromBase64(u.toString("base64"),{network:l})}catch(y){throw new Error(`estimateBuyNeedFromRevealTx: failed to parse embedded seller PSBT (${y?.message||y})`)}Do(m,{marker:p||null,context:"estimateBuyNeedFromRevealTx"});{const e=null!=p?.minBlockHeight?Number(p.minBlockHeight):null!=f?Number(f):null;if(null!==e){const t=_o(m);if(null===t)throw new Error("estimateBuyNeedFromRevealTx: OODL_LISTING_LOCKTIME_UNAVAILABLE");if(t>>>0!=e>>>0)throw new Error("estimateBuyNeedFromRevealTx: OODL_LISTING_LOCKTIME_MISMATCH")}}const g=bo(ho(m?.txOutputs?.[1]?.value)||0,"offer.output[1].value");if(g<=0n)throw new Error("estimateBuyNeedFromRevealTx: offer output[1] postage must be > 0");const h=null!=r?bo(r,"expectedPostageSats"):g;let b=0n;return null!=p?.platformFeeSats?b=bo(p.platformFeeSats,"marker.platformFeeSats"):m?.txOutputs?.[3]&&(b=bo(ho(m.txOutputs[3].value)||0,"offer.output[3].value"),b<0n&&(b=0n)),qo({btc:s,network:l,walletProvider:e,offerPsbt:m,buyerChangeAddress:o,postageSats:h,platformFeeSats:b,feeRateSatPerVb:i})}async function Ko({walletProvider:e,inscriptionId:t,buyerChangeAddress:n,feeRateSatPerVb:r=10}){if(!e)throw new Error("estimateBuyNeedFromInscriptionId: walletProvider is required");const i=No(t);if(!i?.inscriptionId)throw new Error("estimateBuyNeedFromInscriptionId: inscriptionId must look like <txid>i<index>");let a=null,o=null;try{a=await Eo(i.inscriptionId),o=So(a)}catch{}let s=null;{const e=ho(a?.value);null!=e&&e>0&&(s=e)}if(null==s&&o?.txid)try{const e=await In(),t=await Io(o.txid),n=e.Transaction.fromHex(t),r=n?.outs?.[o.vout],i=ho(r?.value);null!=i&&i>0&&(s=i)}catch{}if(null==s||s<=0)throw new Error("estimateBuyNeedFromInscriptionId: could not determine inscription postage");const l=String(o?.txid||i.revealTxid||"").toLowerCase().trim();if(!l)throw new Error("estimateBuyNeedFromInscriptionId: failed to resolve a txid");return await Xo({walletProvider:e,revealTxid:l,buyerChangeAddress:n,expectedPostageSats:s,feeRateSatPerVb:r})}async function Go({walletProvider:e,sellerOfferPsbt:t,buyerChangeAddress:n,feeRateSatPerVb:r=10}){if(!e)throw new Error("estimateBuyNeedFromSellerOfferPsbt: walletProvider is required");const i=String(t||"").trim();if(!i)throw new Error("estimateBuyNeedFromSellerOfferPsbt: sellerOfferPsbt is required");const a=String(n||"").trim();if(!a)throw new Error("estimateBuyNeedFromSellerOfferPsbt: buyerChangeAddress is required");const o=await In(),s=xo(o);let l;try{l=o.Psbt.fromBase64(i,{network:s})}catch{l=o.Psbt.fromHex(i,{network:s})}Do(l,{marker:null,context:"estimateBuyNeedFromSellerOfferPsbt"});const c=bo(ho(l?.txOutputs?.[1]?.value)||0,"offer.output[1].value");if(c<=0n)throw new Error("estimateBuyNeedFromSellerOfferPsbt: offer output[1] postage must be > 0");let u=0n;return l?.txOutputs?.[3]&&(u=bo(ho(l.txOutputs[3].value)||0,"offer.output[3].value"),u<0n&&(u=0n)),qo({btc:o,network:s,walletProvider:e,offerPsbt:l,buyerChangeAddress:a,postageSats:c,platformFeeSats:u,feeRateSatPerVb:r})}async function Yo({walletProvider:e,sellerOfferPsbt:t,buyerPaymentUtxos:n=null,buyerChangeAddress:r=null,buyerReceiveAddress:i=null,feeRateSatPerVb:a=10,broadcast:o=!0,onProgress:s=null}){if(!e)throw new Error("createAndBroadcastBuyFromSellerOfferPsbt: walletProvider is required");const l=String(t||"").trim();if(!l)throw new Error("createAndBroadcastBuyFromSellerOfferPsbt: sellerOfferPsbt is required");const c="function"==typeof s?s:()=>{};c({step:1,totalSteps:5,label:"Parse offer",status:"active"});const u=await In(),d=xo(u),p=e?.getState?.()||{},f=(e=>{if(!Array.isArray(e)||0===e.length)return{payment:null,ordinals:null,all:[]};if("object"==typeof e[0]&&null!==e[0])return{payment:e.find(e=>"payment"===String(e?.purpose||"").toLowerCase())?.address||null,ordinals:e.find(e=>"ordinals"===String(e?.purpose||"").toLowerCase())?.address||null,all:e.map(e=>e?.address).filter(e=>"string"==typeof e)};const t=e.filter(e=>"string"==typeof e);return{payment:t[0]||null,ordinals:t[0]||null,all:t}})(await(async()=>{try{if("function"==typeof e?.getAccounts){const t=await e.getAccounts();return Array.isArray(t)?t:null}if("function"==typeof e?.requestAccounts){const t=await e.requestAccounts();return Array.isArray(t)?t:null}}catch{}return null})()),m=r||f?.payment||p?.paymentAddress||p?.address||p?.ordinalsAddress;if(!m)throw new Error("createAndBroadcastBuyFromSellerOfferPsbt: buyerChangeAddress is required");let g;try{g=yo(l)?u.Psbt.fromHex(l,{network:d}):u.Psbt.fromBase64(l,{network:d})}catch(ye){throw new Error(`createAndBroadcastBuyFromSellerOfferPsbt: failed to parse seller offer PSBT (${ye?.message||ye})`)}if(g.inputCount<1)throw new Error("createAndBroadcastBuyFromSellerOfferPsbt: seller PSBT had no inputs");if(!g.txOutputs||g.txOutputs.length<1)throw new Error("createAndBroadcastBuyFromSellerOfferPsbt: seller PSBT had no outputs");Do(g,{marker:null,context:"createAndBroadcastBuyFromSellerOfferPsbt"});{const e=g?.data?.inputs?.[2]||{},t=e?.sighashType,n="number"==typeof t&&131==(255&t),r=e?.tapKeySig,i=(e=>{if(!e)return!1;const t=Buffer.isBuffer(e)?e:Buffer.from(e);return t.length>=65&&131===t[t.length-1]})(r);if(!n&&!i)throw new Error("createAndBroadcastBuyFromSellerOfferPsbt: offer missing 0x83 seller signature on input[2]")}if(!g.txOutputs[2])throw new Error("createAndBroadcastBuyFromSellerOfferPsbt: seller payout output[2] missing");const h=(()=>{const e=ho(g?.txOutputs?.[1]?.value);if(null==e||e<=0)throw new Error("createAndBroadcastBuyFromSellerOfferPsbt: offer missing output[1] postage value");return BigInt(e)})(),b=(()=>{const e=ho(g?.txOutputs?.[3]?.value);return BigInt(null!=e&&e>0?e:0)})(),y=ho(g.txOutputs[2]?.value);if(!y)throw new Error("createAndBroadcastBuyFromSellerOfferPsbt: seller PSBT output[2] had invalid value");const x=ho(g?.data?.inputs?.[2]?.witnessUtxo?.value);if(!x||x<=0)throw new Error("createAndBroadcastBuyFromSellerOfferPsbt: seller input[2] missing witnessUtxo.value");const w=BigInt(x)>h?BigInt(x)-h:0n,v=BigInt(y)-w;if(v<=0n)throw new Error("createAndBroadcastBuyFromSellerOfferPsbt: could not infer a valid price from seller offer PSBT");const S=v,E=(e,t)=>{const n=e?.data?.inputs?.[t]||null;return!(!n||!n.finalScriptWitness&&!n.finalScriptSig)},N=(e,t,n)=>{void 0!==e[n]&&null!==e[n]||void 0!==t[n]&&null!==t[n]&&(e[n]=t[n])},I=g?.data?.inputs?.[2]||{},A=g?.txOutputs?.[2]?.script,k=A?Buffer.from(A).toString("hex"):null,T=e=>Buffer.from(u.address.toOutputScript(String(e),d)).toString("hex");let C=null;try{const e=[i,f?.ordinals,f?.payment,...Array.isArray(f?.all)?f.all:[],p?.ordinalsAddress,p?.address,p?.paymentAddress,m].map(e=>e?String(e).trim():null).filter(Boolean);for(const t of e){if(!k){C=t;break}if(T(t)!==k){C=t;break}}if(!C)throw new Error("Could not choose a buyer receive address that differs from the seller inscription script. You are likely still connected to the seller wallet/account, or the app has not refreshed addresses after switching accounts.")}catch(ye){throw new Error(`createAndBroadcastBuyFromSellerOfferPsbt: invalid buyer receive/change address (${ye?.message||ye})`)}{const e=u.address.toOutputScript(C,d),t=u.address.toOutputScript(m,d);Fo(g,1,{script:e,value:Number(h)}),Fo(g,0,{script:t,value:ho(g.txOutputs?.[0]?.value)||0})}try{if(k){const e=g?.txOutputs?.[1],t=e?.script?Buffer.from(e.script).toString("hex"):null;if(t&&t===k){const e=e=>"string"==typeof e&&e.length>16?`${e.slice(0,16)}\u2026${e.slice(-8)}`:e;let n=null,r=null;try{n=T(C)}catch{}try{r=T(m)}catch{}throw new Error(`Output[1] (inscription receive) is still the seller inscription script after overwrite. Refusing to proceed to avoid returning the inscription to the seller. Details: receiveAddr=${String(C)} changeAddr=${String(m)} sellerScript=${e(k)} out1Script=${e(t)} receiveScript=${e(n)} changeScript=${e(r)}`)}}}catch(ye){throw new Error(`createAndBroadcastBuyFromSellerOfferPsbt: ${ye?.message||ye}`)}c({step:1,totalSteps:5,label:"Parse offer",status:"done"}),c({step:2,totalSteps:5,label:"Build transaction",status:"active"});const B=Array.isArray(n)?n:p?.utxos||p?.paymentUtxos||null,P=(Array.isArray(B)?B:[]).map(e=>jo(e,m)).filter(Boolean);if(0===P.length)throw new Error("createAndBroadcastBuyFromSellerOfferPsbt: buyerPaymentUtxos is required (fetch UTXOs first)");const _=P.slice().sort((e,t)=>t.value-e.value),O=[],L=[];let F=0;const M=p?.paymentPublicKey||null,R=546,$=e=>{const t=String(e||"").trim();let n,r={},i="p2wpkh";if(M&&(t.startsWith("3")||t.startsWith("2"))){const e=Buffer.from(M,"hex"),t=u.payments.p2wpkh({pubkey:e,network:d});n=u.payments.p2sh({redeem:t,network:d}).output,r.redeemScript=t.output,i="p2sh-p2wpkh"}else n=u.address.toOutputScript(t,d),i=t.startsWith("bc1p")||t.startsWith("tb1p")?"p2tr":"p2wpkh";return{witnessScriptPubKey:n,extraFields:r,inputType:i}},U=e=>{const t=String(e.address||"").trim(),{witnessScriptPubKey:n,extraFields:r,inputType:i}=$(t),a=g.inputCount;g.addInput({hash:Buffer.from(e.txid,"hex").reverse(),index:e.vout,sequence:4294967293,witnessUtxo:{script:n,value:e.value},...r}),O.push({index:a,address:t}),L.push(i),F+=e.value},z=(e,t)=>{const n=String(t.address||"").trim(),{witnessScriptPubKey:r,extraFields:i,inputType:a}=$(n);Mo(g,e,t.txid,t.vout);const o=g?.data?.inputs?.[e];if(!o)throw new Error(`createAndBroadcastBuyFromSellerOfferPsbt: missing psbt.data.inputs[${e}] to replace`);o.witnessUtxo={script:r,value:t.value},i.redeemScript&&(o.redeemScript=i.redeemScript),O.push({index:e,address:n}),L.push(a),F+=t.value},D=_.slice(),H=e=>{const t=D[e];return D.splice(e,1),t},W=(()=>{if(D.length<2)return null;const e=D.slice().sort((e,t)=>e.value-t.value);for(let n=0;n<e.length;n++)for(let t=n+1;t<e.length;t++)if(e[n].value+e[t].value>=R)return[e[n],e[t]];const t=D.slice().sort((e,t)=>t.value-e.value);return[t[0],t[1]]})();if(!W)throw new Error("createAndBroadcastBuyFromSellerOfferPsbt: need at least 2 buyer UTXOs to fill Open Store dummy input slots");const j=H(D.findIndex(e=>e.txid===W[0].txid&&e.vout===W[0].vout)),V=H(D.findIndex(e=>e.txid===W[1].txid&&e.vout===W[1].vout));z(0,j),z(1,V);const q=BigInt(j.value+V.value);{const e=u.address.toOutputScript(m,d);Fo(g,0,{script:e,value:Number(q)})}const X=BigInt(x)>=h?0n:h-BigInt(x),K=BigInt(y),G=K+b+X,Y=g?.data?.inputs?.[2]?.witnessUtxo?.script,J=ko(Y),Q=[L[0]||"p2wpkh",L[1]||"p2wpkh","p2wpkh"===J?"p2wpkh":"p2tr"],Z=(g?.txOutputs||[]).map(e=>Co(e?.script)),ee=Number(a||10);let te=0n;for(const xe of D){U(xe),te+=BigInt(xe.value);const e=g.inputCount,t=Un(e,g.txOutputs.length,!0,0,{isReveal:!1,inputTypes:[...Q,...L.slice(2)].slice(0,e),outputTypes:Z});if(te>=G+BigInt(Math.ceil(ee*t)))break}const ne=g.inputCount,re=g.txOutputs.length,ie=[...Q,...L.slice(2)].slice(0,ne),ae=Un(ne,re,!0,0,{isReveal:!1,inputTypes:ie,outputTypes:Z}),oe=BigInt(Math.ceil(ee*ae)),se=te-(G+oe);let le=oe,ce=se;if(se>=BigInt(R)){const e=Un(ne,re+1,!0,0,{isReveal:!1,inputTypes:ie,outputTypes:[...Z,To(m)]}),t=BigInt(Math.ceil(ee*e)),n=te-(G+t);n>=BigInt(R)&&(le=t,ce=n)}if(te<G+le){const e=G+le,t=e-te;throw new Error(`createAndBroadcastBuyFromSellerOfferPsbt: insufficient buyer funds. Need >= ${e.toString()} sats (price+reclaim=${K.toString()}, platformFee=${b.toString()}, postageTopUp=${X.toString()}, estFee=${le.toString()}). Have ${te.toString()} sats. Short ${t.toString()} sats. Note: split-funding can increase UTXO count for Open Store, but it cannot create sats; fund your payment address and retry.`)}ce>=BigInt(R)&&g.addOutput({address:m,value:Number(ce)});try{E(g,2)||g.finalizeInput(2)}catch(ye){throw new Error(`createAndBroadcastBuyFromSellerOfferPsbt: non-buyer input(s) could not be finalized locally. Seller offer PSBT may be missing required Taproot data. Underlying error: ${ye?.message||ye}`)}const ue=g.toHex(),de=Ho(g,{sellerInputIndex:2,inscriptionOutputIndex:1,sellerPayoutOutputIndex:2,platformFeeOutputIndex:3});c({step:2,totalSteps:5,label:"Build transaction",status:"done"}),c({step:3,totalSteps:5,label:"Sign inputs",status:"active",detail:"signing only, not broadcasting"});const pe=await nr(e,ue,{autoFinalized:!1,toSignInputs:O},!1),fe=pe?.signedPsbt||null;if(!fe)throw new Error("createAndBroadcastBuyFromSellerOfferPsbt: wallet did not return signed buyer PSBT");const me=u.Psbt.fromHex(fe,{network:d});try{Wo(de,me,{sellerInputIndex:2,inscriptionOutputIndex:1,sellerPayoutOutputIndex:2,platformFeeOutputIndex:3})}catch(ye){throw new Error(`createAndBroadcastBuyFromSellerOfferPsbt: ${ye?.message||ye}`)}c({step:3,totalSteps:5,label:"Sign inputs",status:"done"}),c({step:4,totalSteps:5,label:"Finalize",status:"active"});try{const e=u.Psbt.fromHex(ue,{network:d}),t=e?.data?.inputs?.[2]||{},n=me?.data?.inputs?.[2]||{};N(n,t,"finalScriptWitness"),N(n,t,"finalScriptSig"),N(n,t,"tapKeySig"),N(n,t,"tapScriptSig"),N(n,t,"tapLeafScript"),N(n,t,"tapInternalKey"),N(n,t,"tapMerkleRoot"),N(n,t,"tapBip32Derivation"),N(n,I,"finalScriptWitness"),N(n,I,"finalScriptSig"),N(n,I,"tapKeySig"),N(n,I,"tapScriptSig"),N(n,I,"tapLeafScript"),N(n,I,"tapInternalKey"),N(n,I,"tapMerkleRoot"),N(n,I,"tapBip32Derivation")}catch{}const ge=[2,...O.map(e=>e.index)];for(const xe of ge)if(!E(me,xe))try{me.finalizeInput(xe)}catch(ye){if(2===xe)throw new Error(`createAndBroadcastBuyFromSellerOfferPsbt: cannot finalize seller taproot input #2. No usable Taproot signature present after wallet signing. Underlying error: ${ye?.message||ye}`);throw ye}for(let xe=0;xe<me.inputCount;xe+=1)if(!E(me,xe))throw new Error(`createAndBroadcastBuyFromSellerOfferPsbt: input #${xe} is not finalized after signing`);const he=me.extractTransaction().toHex();c({step:4,totalSteps:5,label:"Finalize",status:"done"}),o&&c({step:5,totalSteps:5,label:"Broadcast",status:"active",detail:"all signed, now broadcasting"});const be=o?await rr(e,{txHex:he,psbtBase64:Buffer.from(fe,"hex").toString("base64")},wo(),"oodl-buy-manual"):me.extractTransaction().getId();return c(o?{step:5,totalSteps:5,label:"Broadcast",status:"done"}:{step:5,totalSteps:5,label:"Broadcast",status:"skipped",detail:"dry run"}),{mode:"buy-complete",source:"seller-offer-psbt",inferredPriceSats:S.toString(),postageSats:h.toString(),platformFeeSats:b.toString(),sellerInputValueSats:String(x),buyerPostageTopUpSats:X.toString(),sellerPayoutOutputSats:y,buyerInputsSats:F,feeSats:le.toString(),changeSats:ce>=BigInt(R)?ce.toString():"0",buyTxid:be||null,buyTxHex:he,signedBuyerPsbtHex:fe}}async function Jo({walletProvider:e,sellerOfferPsbt:t,buyerPaymentUtxos:n=null,buyerChangeAddress:r=null,buyerReceiveAddress:i=null,feeRateSatPerVb:a=10}){if(!e)throw new Error("createBuyerFundedPsbtForSellerCountersign: walletProvider is required");const o=String(t||"").trim();if(!o)throw new Error("createBuyerFundedPsbtForSellerCountersign: sellerOfferPsbt is required");const s=await In(),l=xo(s),c=e?.getState?.()||{},u=(e=>{if(!Array.isArray(e)||0===e.length)return{payment:null,ordinals:null,all:[]};if("object"==typeof e[0]&&null!==e[0])return{payment:e.find(e=>"payment"===String(e?.purpose||"").toLowerCase())?.address||null,ordinals:e.find(e=>"ordinals"===String(e?.purpose||"").toLowerCase())?.address||null,all:e.map(e=>e?.address).filter(e=>"string"==typeof e)};const t=e.filter(e=>"string"==typeof e);return{payment:t[0]||null,ordinals:t[0]||null,all:t}})(await(async()=>{try{if("function"==typeof e?.getAccounts){const t=await e.getAccounts();return Array.isArray(t)?t:null}if("function"==typeof e?.requestAccounts){const t=await e.requestAccounts();return Array.isArray(t)?t:null}}catch{}return null})()),d=r||u?.payment||c?.paymentAddress||c?.address||c?.ordinalsAddress;if(!d)throw new Error("createBuyerFundedPsbtForSellerCountersign: buyerChangeAddress is required");let p;try{p=yo(o)?s.Psbt.fromHex(o,{network:l}):s.Psbt.fromBase64(o,{network:l})}catch(ce){throw new Error(`createBuyerFundedPsbtForSellerCountersign: failed to parse seller offer PSBT (${ce?.message||ce})`)}if(p.inputCount<1)throw new Error("createBuyerFundedPsbtForSellerCountersign: seller PSBT had no inputs");if(!p.txOutputs||p.txOutputs.length<1)throw new Error("createBuyerFundedPsbtForSellerCountersign: seller PSBT had no outputs");if(Do(p,{marker:null,context:"createBuyerFundedPsbtForSellerCountersign"}),!p.txOutputs[2])throw new Error("createBuyerFundedPsbtForSellerCountersign: seller payout output[2] missing");const f=(()=>{const e=ho(p?.txOutputs?.[1]?.value);if(null==e||e<=0)throw new Error("createBuyerFundedPsbtForSellerCountersign: offer missing output[1] postage value");return BigInt(e)})(),m=(()=>{const e=ho(p?.txOutputs?.[3]?.value);return BigInt(null!=e&&e>0?e:0)})(),g=ho(p.txOutputs[2]?.value);if(!g)throw new Error("createBuyerFundedPsbtForSellerCountersign: seller PSBT output[2] had invalid value");const h=ho(p?.data?.inputs?.[2]?.witnessUtxo?.value);if(!h||h<=0)throw new Error("createBuyerFundedPsbtForSellerCountersign: seller input[2] missing witnessUtxo.value");const b=BigInt(h)>f?BigInt(h)-f:0n,y=BigInt(g)-b;if(y<=0n)throw new Error("createBuyerFundedPsbtForSellerCountersign: could not infer a valid price from seller offer PSBT");const x=y,w=(e,t,n)=>{void 0!==e[n]&&null!==e[n]||void 0!==t[n]&&null!==t[n]&&(e[n]=t[n])},v=p?.data?.inputs?.[2]||{},S=p?.txOutputs?.[2]?.script,E=S?Buffer.from(S).toString("hex"):null,N=e=>Buffer.from(s.address.toOutputScript(String(e),l)).toString("hex");let I=null;try{const e=[i,u?.ordinals,u?.payment,...Array.isArray(u?.all)?u.all:[],c?.ordinalsAddress,c?.address,c?.paymentAddress,d].map(e=>e?String(e).trim():null).filter(Boolean);for(const t of e){if(!E){I=t;break}if(N(t)!==E){I=t;break}}if(!I)throw new Error("Could not choose a buyer receive address that differs from the seller inscription script. You are likely still connected to the seller wallet/account, or the app has not refreshed addresses after switching accounts.")}catch(ce){throw new Error(`createBuyerFundedPsbtForSellerCountersign: invalid buyer receive/change address (${ce?.message||ce})`)}{const e=s.address.toOutputScript(I,l),t=s.address.toOutputScript(d,l);Fo(p,1,{script:e,value:Number(f)}),Fo(p,0,{script:t,value:ho(p.txOutputs?.[0]?.value)||0})}try{if(E){const e=p?.txOutputs?.[1],t=e?.script?Buffer.from(e.script).toString("hex"):null;if(t&&t===E)throw new Error("Output[1] (inscription receive) is still the seller inscription script after overwrite.")}}catch(ce){throw new Error(`createBuyerFundedPsbtForSellerCountersign: ${ce?.message||ce}`)}const A=Array.isArray(n)?n:c?.utxos||c?.paymentUtxos||null,k=(Array.isArray(A)?A:[]).map(e=>jo(e,d)).filter(Boolean);if(0===k.length)throw new Error("createBuyerFundedPsbtForSellerCountersign: buyerPaymentUtxos is required (fetch UTXOs first)");const T=k.slice().sort((e,t)=>t.value-e.value),C=[],B=[];let P=0;const _=t=>{const n=String(t||"").trim();return e?.getState?.()?.paymentPublicKey&&(n.startsWith("3")||n.startsWith("2"))?"p2sh-p2wpkh":To(n)},O=(t,n)=>{const r=String(n.address||d),i=s.address.toOutputScript(r,l),a=_(r);Mo(p,t,n.txid,n.vout);const o=p?.data?.inputs?.[t];if(!o)throw new Error(`createBuyerFundedPsbtForSellerCountersign: missing psbt.data.inputs[${t}] to replace`);o.witnessUtxo={script:i,value:n.value};const c=Bo(s,a,e,r);c.redeemScript&&(o.redeemScript=c.redeemScript),C.push({index:t,address:r}),B.push(a),P+=n.value},L=t=>{const n=String(t.address||d),r=s.address.toOutputScript(n,l),i=_(n),a=Bo(s,i,e,n);p.addInput({hash:Buffer.from(String(t.txid).trim(),"hex").reverse(),index:t.vout,witnessUtxo:{script:r,value:t.value},sequence:4294967293,...a.redeemScript?{redeemScript:a.redeemScript}:{}}),C.push({index:p.inputCount-1,address:n}),B.push(i),P+=t.value},F=T.slice(),M=e=>{const t=F[e];return F.splice(e,1),t},R=(()=>{if(F.length<2)return null;const e=F.slice().sort((e,t)=>e.value-t.value);for(let n=0;n<e.length;n++)for(let t=n+1;t<e.length;t++)if(e[n].value+e[t].value>=P2TR_DUST)return[e[n],e[t]];const t=F.slice().sort((e,t)=>t.value-e.value);return[t[0],t[1]]})();if(!R)throw new Error("createBuyerFundedPsbtForSellerCountersign: need at least 2 buyer UTXOs to fill Open Store dummy input slots");const $=M(F.findIndex(e=>e.txid===R[0].txid&&e.vout===R[0].vout)),U=M(F.findIndex(e=>e.txid===R[1].txid&&e.vout===R[1].vout));O(0,$),O(1,U);const z=BigInt($.value+U.value);{const e=s.address.toOutputScript(d,l);Fo(p,0,{script:e,value:Number(z)})}const D=BigInt(h)>=f?0n:f-BigInt(h),H=BigInt(g),W=H+m+D,j=p?.data?.inputs?.[2]?.witnessUtxo?.script,V=ko(j),q=[B[0]||"p2wpkh",B[1]||"p2wpkh","p2wpkh"===V?"p2wpkh":"p2tr"],X=(p?.txOutputs||[]).map(e=>Co(e?.script)),K=Number(a||10);let G=0n;for(const ue of F){L(ue),G+=BigInt(ue.value);const e=p.inputCount,t=Un(e,p.txOutputs.length,!0,0,{isReveal:!1,inputTypes:[...q,...B.slice(2)].slice(0,e),outputTypes:X});if(G>=W+BigInt(Math.ceil(K*t)))break}const Y=p.inputCount,J=p.txOutputs.length,Q=[...q,...B.slice(2)].slice(0,Y),Z=Un(Y,J,!0,0,{isReveal:!1,inputTypes:Q,outputTypes:X}),ee=BigInt(Math.ceil(K*Z)),te=G-(W+ee);let ne=ee,re=te;if(te>=BigInt(P2TR_DUST)){const e=Un(Y,J+1,!0,0,{isReveal:!1,inputTypes:Q,outputTypes:[...X,To(d)]}),t=BigInt(Math.ceil(K*e)),n=G-(W+t);n>=BigInt(P2TR_DUST)&&(ne=t,re=n)}if(G<W+ne){const e=W+ne,t=e-G;throw new Error(`createBuyerFundedPsbtForSellerCountersign: insufficient buyer funds. Need >= ${e.toString()} sats (price+reclaim=${H.toString()}, platformFee=${m.toString()}, postageTopUp=${D.toString()}, estFee=${ne.toString()}). Have ${G.toString()} sats. Short ${t.toString()} sats. Note: split-funding can increase UTXO count for Open Store, but it cannot create sats; fund your payment address and retry.`)}re>=BigInt(P2TR_DUST)&&p.addOutput({address:d,value:Number(re)});const ie=p.toHex(),ae=Ho(p,{sellerInputIndex:2,inscriptionOutputIndex:1,sellerPayoutOutputIndex:2,platformFeeOutputIndex:3}),oe=await nr(e,ie,{autoFinalized:!1,toSignInputs:C},!1),se=oe?.signedPsbt||null;if(!se)throw new Error("createBuyerFundedPsbtForSellerCountersign: wallet did not return signed buyer PSBT");const le=s.Psbt.fromHex(se,{network:l});try{Wo(ae,le,{sellerInputIndex:2,inscriptionOutputIndex:1,sellerPayoutOutputIndex:2,platformFeeOutputIndex:3})}catch(ce){throw new Error(`createBuyerFundedPsbtForSellerCountersign: ${ce?.message||ce}`)}try{const e=s.Psbt.fromHex(ie,{network:l}),t=e?.data?.inputs?.[2]||{},n=le?.data?.inputs?.[2]||{};w(n,t,"tapInternalKey"),w(n,t,"tapMerkleRoot"),w(n,t,"tapBip32Derivation"),w(n,t,"witnessUtxo"),w(n,t,"nonWitnessUtxo"),w(n,v,"tapInternalKey"),w(n,v,"tapMerkleRoot"),w(n,v,"tapBip32Derivation"),w(n,v,"witnessUtxo"),w(n,v,"nonWitnessUtxo")}catch{}return{mode:"buyer-funded-psbt",source:"seller-offer-psbt",sellerInputIndex:2,sellerPayoutOutputIndex:2,inferredPriceSats:x.toString(),postageSats:f.toString(),platformFeeSats:m.toString(),sellerInputValueSats:String(h),buyerPostageTopUpSats:D.toString(),buyerInputsSats:P,feeSats:ne.toString(),changeSats:re>=BigInt(P2TR_DUST)?re.toString():"0",signedBuyerPsbtHex:se,signedBuyerPsbtBase64:Buffer.from(se,"hex").toString("base64")}}async function Qo({walletProvider:e,inscriptionId:t,buyerPaymentUtxos:n=null,buyerChangeAddress:r=null,buyerReceiveAddress:i=null,feeRateSatPerVb:a=10,broadcast:o=!0,onProgress:s=null}){if(!e)throw new Error("createAndBroadcastBuyFromInscriptionId: walletProvider is required");const l=No(t);if(!l?.inscriptionId)throw new Error("createAndBroadcastBuyFromInscriptionId: inscriptionId must look like <txid>i<index>");let c=null,u=null,d=null;try{c=await Eo(l.inscriptionId),u=So(c),d=function(e){const t=e?.output||e?.location||e?.satpoint;if(!t||"string"!=typeof t)return null;const n=t.split(":");if(n.length<3)return null;const r=Number(n[2]);return!Number.isFinite(r)||r<0?null:Math.floor(r)}(c)}catch{}let p=null;{const e=ho(c?.value);null!=e&&e>0&&(p=e)}if(null==p&&u?.txid)try{const e=await In(),t=await Io(u.txid),n=e.Transaction.fromHex(t),r=n?.outs?.[u.vout],i=ho(r?.value);null!=i&&i>0&&(p=i)}catch{}if(null==p||p<=0)throw new Error("createAndBroadcastBuyFromInscriptionId: could not determine inscription postage from ordinals latest output; refusing to default");const f=[u?.txid,l.revealTxid].map(e=>e?String(e).toLowerCase().trim():null).filter(Boolean)[0];if(!f)throw new Error("createAndBroadcastBuyFromInscriptionId: failed to resolve a txid to buy from");return{...await Vo({walletProvider:e,revealTxid:f,buyerPaymentUtxos:n,buyerChangeAddress:r,buyerReceiveAddress:i,expectedPostageSats:p,expectedInscriptionInputOffset:null!=d?d:null,targetInscriptionId:l.inscriptionId,targetRevealOutputIndex:u&&Number.isFinite(Number(u.vout))?Number(u.vout):null,feeRateSatPerVb:a,broadcast:o,onProgress:s}),discovery:{inscriptionId:l.inscriptionId,inscriptionIndex:l.inscriptionIndex,revealTxid:f,method:u?.txid?"ordinals-latest-output":"inscription-id-txid",latestOutpoint:u?`${u.txid}:${u.vout}`:null,latestOffset:null!=d?String(d):null,expectedPostageSats:String(p)}}}const Zo=Object.freeze(Object.defineProperty({__proto__:null,createAndBroadcastBuyFromInscriptionId:Qo,createAndBroadcastBuyFromRevealTx:Vo,createAndBroadcastBuyFromSellerOfferPsbt:Yo,createBuyerFundedPsbtForSellerCountersign:Jo,estimateBuyNeedFromInscriptionId:Ko,estimateBuyNeedFromRevealTx:Xo,estimateBuyNeedFromSellerOfferPsbt:Go,getSellerOfferPsbtBase64FromRevealTxid:Ao},Symbol.toStringTag,{value:"Module"}));function es(e){if(!e)return null;try{return(Buffer.isBuffer(e)?e:Buffer.from(e)).toString("hex")}catch{return null}}function ts(e){return("string"==typeof e?e.trim().toLowerCase():"")||null}function ns(e,t){const n=e?.data?.inputs?.[t];return n&&"object"==typeof n?n:null}function rs(e,{sellerInputIndex:t=2}={}){if(!e)throw new Error("snapshotOpenStoreOfferCriticalShape: psbt is required");const n=Array.isArray(e?.txInputs)?e.txInputs:[],r=Array.from({length:n.length}).map((t,n)=>os(e,n)),i=Array.isArray(e?.txOutputs)?e.txOutputs:[],a=i.map(e=>function(e){if(!e)return{value:null,scriptHex:null};const t=Number(e.value);return{value:Number.isFinite(t)?Math.floor(t):null,scriptHex:ts(es(e.script))}}(e)),o=os(e,t),s=ns(e,t)||{},l=s?.witnessUtxo||null;return{sellerInputIndex:Number(t),sellerOutpoint:o||null,sellerWitnessUtxoValue:Number.isFinite(Number(l?.value))?Math.floor(Number(l.value)):null,sellerWitnessUtxoScriptHex:ts(es(l?.script)),inputCount:n.length,outputCount:i.length,inputOutpoints:r,outputs:a}}function is(e,t){if(!e)return!1;try{const n=Buffer.isBuffer(e)?e:Buffer.from(e);return n.length>=65&&(255&n[n.length-1])==(255&t)}catch{return!1}}function as({unsignedOfferPsbt:e,signedOfferPsbt:t,sellerInputIndex:n=2,expectedSighashByte:r=131}={}){if(!e)throw new Error("assertOpenStoreSellerOfferSignedCorrectly: unsignedOfferPsbt is required");if(!t)throw new Error("assertOpenStoreSellerOfferSignedCorrectly: signedOfferPsbt is required");const i=Number(n);if(!Number.isFinite(i)||i<0)throw new Error("assertOpenStoreSellerOfferSignedCorrectly: invalid sellerInputIndex");const a=function(e,t){const n=[];if(!e||!t)return["missing snapshot"];"number"==typeof e.inputCount&&"number"==typeof t.inputCount&&e.inputCount!==t.inputCount&&n.push(`input count changed (${e.inputCount} -> ${t.inputCount})`),"number"==typeof e.outputCount&&"number"==typeof t.outputCount&&e.outputCount!==t.outputCount&&n.push(`output count changed (${e.outputCount} -> ${t.outputCount})`);const r=Math.max(e.inputOutpoints?.length||0,t.inputOutpoints?.length||0);for(let a=0;a<r;a++){const r=e.inputOutpoints?.[a]||null,i=t.inputOutpoints?.[a]||null;r&&i&&r!==i&&n.push(`input[${a}] outpoint changed (${r} -> ${i})`)}e.sellerOutpoint&&t.sellerOutpoint&&e.sellerOutpoint!==t.sellerOutpoint&&n.push(`seller outpoint changed (${e.sellerOutpoint} -> ${t.sellerOutpoint})`),null!==e.sellerWitnessUtxoValue&&null!==t.sellerWitnessUtxoValue&&e.sellerWitnessUtxoValue!==t.sellerWitnessUtxoValue&&n.push(`seller witnessUtxo.value changed (${e.sellerWitnessUtxoValue} -> ${t.sellerWitnessUtxoValue})`),e.sellerWitnessUtxoScriptHex&&t.sellerWitnessUtxoScriptHex&&e.sellerWitnessUtxoScriptHex!==t.sellerWitnessUtxoScriptHex&&n.push("seller witnessUtxo.script changed");const i=Math.max(e.outputs?.length||0,t.outputs?.length||0);for(let a=0;a<i;a++){const r=e.outputs?.[a]??{value:null,scriptHex:null},i=t.outputs?.[a]??{value:null,scriptHex:null};(null!==r.value&&void 0!==r.value||null!==r.scriptHex&&void 0!==r.scriptHex)==(null!==i.value&&void 0!==i.value||null!==i.scriptHex&&void 0!==i.scriptHex)?(null!==r.value&&void 0!==r.value&&null!==i.value&&void 0!==i.value&&r.value!==i.value&&n.push(`output[${a}] value changed (${r.value} -> ${i.value})`),null!==r.scriptHex&&void 0!==r.scriptHex&&null!==i.scriptHex&&void 0!==i.scriptHex&&r.scriptHex!==i.scriptHex&&n.push(`output[${a}] script changed`)):n.push(`output[${a}] presence changed`)}return n}(rs(e,{sellerInputIndex:i}),rs(t,{sellerInputIndex:i}));if(a.length>0)throw new Error(`OODL_OFFER_SIGNING_TEMPLATE_MUTATED: ${a.join("; ")}`);const o=function(e,t,n){const r=ns(e,t)||{},i=r?.sighashType,a="number"==typeof i&&(255&i)==(255&n),o=r?.tapKeySig,s=is(o,n),l=Array.isArray(r?.partialSig)?r.partialSig:[];return{okType:a,okTap:s,okPartial:l.some(e=>is(e?.signature,n)),hasAnySig:Boolean(o)||l.length>0}}(t,i,r);if(!o.hasAnySig)throw new Error("OODL_OFFER_SIGNING_MISSING_SIGNATURE");if(!o.okTap&&!o.okPartial)throw new Error("OODL_OFFER_SIGNING_SIGHASH_INVALID");try{const e=t?.data?.inputs?.[i];e&&e.sighashType!==r&&(e.sighashType=r)}catch{}return!0}function os(e,t=0){const n=function(e,t=0){if(!e)return null;if(Array.isArray(e.txInputs)&&e.txInputs[t])return e.txInputs[t];const n=e?.data?.globalMap?.unsignedTx?.tx?.ins;return Array.isArray(n)&&n[t]?n[t]:null}(e,t);if(!n)return null;const r=n.index??n.vout,i=function(e){if(!e)return null;const t=Buffer.isBuffer(e)?e:Buffer.from(e);return 32!==t.length?null:Buffer.from(t).reverse().toString("hex")}(n.hash)||("string"==typeof n.hash?n.hash:null);return i&&Number.isFinite(Number(r))?`${i.toLowerCase()}:${Math.floor(Number(r))}`:null}function ss(e,t){if(!t?.crypto?.sha256)throw new Error("computePsbtHashHex: bitcoinLib.crypto.sha256 not available");const n=function(e){if(!e)return null;if("function"==typeof e.toBuffer)return e.toBuffer();if("function"==typeof e.toBase64)try{return Buffer.from(e.toBase64(),"base64")}catch{return null}return null}(e);if(!n)throw new Error("computePsbtHashHex: failed to serialize PSBT");return t.crypto.sha256(n).toString("hex")}async function ls({inscriptionOutpoint:e,marker:t,sellerListingPsbt:n,bitcoinLib:r=null}){const i=function(e){if(!e||"string"!=typeof e)return null;const t=e.split(":");if(t.length<2)return null;const n=t[0],r=Number(t[1]);return/^[0-9a-f]{64}$/i.test(n)?!Number.isFinite(r)||r<0?null:`${n.toLowerCase()}:${Math.floor(r)}`:null}(e);if(!i)throw new Error("validateOodinalsSaleListing: invalid inscriptionOutpoint");if(!t||"object"!=typeof t)throw new Error("validateOodinalsSaleListing: marker is required");if(!n)throw new Error("validateOodinalsSaleListing: sellerListingPsbt is required");const a=r||await In();await async function(e){const t=null!=e?.minBlockHeight;if(!t)return null;const n=await Si(function(){const e="undefined"!=typeof window&&window.__NEXUS_NETWORK__||"mainnet",t=String(e).toLowerCase();return"testnet"===t||"signet"===t||"regtest"===t?"testnet":"mainnet"}());if(!Number.isFinite(n))throw new Error("OODL_LISTING_HEIGHT_UNAVAILABLE");if(t){const t=Number(e.minBlockHeight);if(!Number.isFinite(t)||t<0||!Number.isInteger(t))throw new Error("OODL_LISTING_MIN_BLOCK_HEIGHT_INVALID");if(n<t)throw new Error("OODL_LISTING_NOT_YET_VALID")}return n}(t);const o=(()=>{if("object"==typeof n)return n;const e=String(n);try{return a.Psbt.fromHex(e)}catch{return a.Psbt.fromBase64(e)}})(),s=ss(o,a);if(2!==Number(t?.version||0))throw new Error("validateOodinalsSaleListing: only Open Store marker version 2 is supported");const l=Number(t?.openStoreVersion||0),c=Number.isFinite(l)&&l>=2,u=String(t?.psbtHashHex||"").toLowerCase(),d=/^[0-9a-f]{64}$/.test(u),p=u==="0".repeat(64);if(c&&(!d||p))throw new Error("OODL_LISTING_PSBT_HASH_MISSING");if(d&&!p&&u!==s.toLowerCase())throw new Error("OODL_LISTING_PSBT_HASH_MISMATCH");if(null!=t?.minBlockHeight){const e=Number(t.minBlockHeight),n=function(e){if(!e)return null;const t=e?.locktime;if("number"==typeof t&&Number.isFinite(t))return t>>>0;const n=e?.__CACHE?.__TX;if(n&&"number"==typeof n.locktime&&Number.isFinite(n.locktime))return n.locktime>>>0;const r=e?.data?.globalMap?.unsignedTx;return r&&"number"==typeof r.locktime&&Number.isFinite(r.locktime)?r.locktime>>>0:null}(o);if(null===n)throw new Error("OODL_LISTING_LOCKTIME_UNAVAILABLE");if(n>>>0!=e>>>0)throw new Error("OODL_LISTING_LOCKTIME_MISMATCH")}const f=os(o,2);if(!f)throw new Error("OODL_LISTING_PSBT_OUTPOINT_UNAVAILABLE");if(f!==i)throw new Error("OODL_LISTING_STALE_INSCRIPTION_MOVED");{const e=o?.data?.inputs?.[2]||{},t=e?.sighashType,n="number"==typeof t&&131==(255&t),r=e?.tapKeySig,i=(()=>{if(!r)return!1;try{const e=Buffer.isBuffer(r)?r:Buffer.from(r);return e.length>=65&&131===e[e.length-1]}catch{return!1}})(),a=(Array.isArray(e?.partialSig)?e.partialSig:[]).some(e=>{const t=e?.signature;if(!t)return!1;try{const e=Buffer.isBuffer(t)?t:Buffer.from(t);return e.length>=1&&131===e[e.length-1]}catch{return!1}});if(!n&&!i&&!a)throw new Error("validateOodinalsSaleListing: offer missing 0x83 seller signature on input[2]")}const m=o?.txOutputs?.[2]||null;if(!m?.script)throw new Error("validateOodinalsSaleListing: offer missing output[2] seller payout");const g=a.crypto.sha256(Buffer.from(m.script)).toString("hex").toLowerCase(),h=String(t?.sellerScriptHashHex||"").toLowerCase();if(!h||h!==g)throw new Error("validateOodinalsSaleListing: sellerScriptHash commitment mismatch");const b=(()=>{try{const e=t?.postageSats;if("bigint"==typeof e)return e;if("number"==typeof e)return BigInt(Math.floor(e));if("string"==typeof e)return BigInt(String(e).trim())}catch{return null}return null})();if(null===b||b<=0n)throw new Error("validateOodinalsSaleListing: marker.postageSats is required and must be > 0");const y=o?.txOutputs?.[1]||null;if(!y)throw new Error("validateOodinalsSaleListing: offer missing output[1]");if(BigInt(Math.floor(Number(y.value||0)))!==b)throw new Error("validateOodinalsSaleListing: offer output[1] value does not match marker postage");{let e=t?.priceSats;try{"bigint"==typeof e||(e="number"==typeof e?BigInt(Math.floor(e)):"string"==typeof e?BigInt(String(e).trim()):null)}catch{e=null}if(null===e||e<=0n)throw new Error("validateOodinalsSaleListing: marker.priceSats is required and must be > 0");const n=BigInt(Math.floor(Number(o?.data?.inputs?.[2]?.witnessUtxo?.value||0)));if(n<=0n)throw new Error("validateOodinalsSaleListing: offer input[2] missing witnessUtxo.value");const r=e+(n>b?n-b:0n),i=o?.txOutputs?.[2]||null;if(BigInt(Math.floor(Number(i?.value||0)))!==r)throw new Error("validateOodinalsSaleListing: offer output[2] value does not match marker price + reclaim")}if(null!=t?.platformFeeSats){const e=o?.txOutputs?.[3]||null;if(!e)throw new Error("validateOodinalsSaleListing: marker commits to platform fee but offer missing output[3]");const n=String(t?.platformFeeScriptHashHex||"").toLowerCase();if(!n)throw new Error("validateOodinalsSaleListing: marker.platformFeeScriptHashHex required when platformFeeSats set");if(a.crypto.sha256(Buffer.from(e.script)).toString("hex").toLowerCase()!==n)throw new Error("validateOodinalsSaleListing: platformFeeScriptHash commitment mismatch")}return{psbtHashHex:s,psbtOutpoint:f,inscriptionOutpoint:i}}const cs=Object.freeze(Object.defineProperty({__proto__:null,assertOpenStoreSellerOfferSignedCorrectly:as,computePsbtHashHex:ss,getPsbtInputOutpoint:os,snapshotOpenStoreOfferCriticalShape:rs,validateOodinalsSaleListing:ls},Symbol.toStringTag,{value:"Module"}));function us(e){return!(!e||"object"!=typeof e&&"function"!=typeof e)&&(e instanceof Uint8Array||"undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&ArrayBuffer.isView(e))}async function ds(e,t={}){const n=String(e||"").trim();if(!n)throw new Error("sanitizePsbtForSharing: psbt is required");const r=await In(),i=!0===t?.parseWithNetwork,a=i?function(e){const t="undefined"!=typeof window&&window.__NEXUS_NETWORK__||"mainnet",n=String(t).toLowerCase();return"testnet"===n||"signet"===n||"regtest"===n?e.networks.testnet:e.networks.bitcoin}(r):null;let o;try{o=function(e){if("string"!=typeof e)return!1;const t=e.trim();return t.length>0&&t.length%2==0&&/^[0-9a-fA-F]+$/.test(t)}(n)?i?r.Psbt.fromHex(n,{network:a}):r.Psbt.fromHex(n):i?r.Psbt.fromBase64(n,{network:a}):r.Psbt.fromBase64(n)}catch(s){throw new Error(`sanitizePsbtForSharing: could not parse psbt (${s?.message||s})`)}return function(e,{removeGlobalXpub:t=!0,removeUnknownAndProprietary:n=!1,removeInputDerivations:r=!1,removeOutputDerivations:i=!0,removeNonWitnessUtxoWhenWitnessUtxoPresent:a=!0}={}){const o=e?.data;if(!o)return;o.globalMap&&(t&&o.globalMap.globalXpub&&delete o.globalMap.globalXpub,n&&(o.globalMap.unknownKeyVals&&delete o.globalMap.unknownKeyVals,o.globalMap.proprietaryKeyVals&&delete o.globalMap.proprietaryKeyVals));const s=Array.isArray(o.inputs)?o.inputs:[];for(const c of s)if(c&&"object"==typeof c){if(a&&c.nonWitnessUtxo){const e=c.witnessUtxo;e&&us(e.script)&&e.script.length>0&&"number"==typeof e.value&&Number.isSafeInteger(e.value)&&e.value>=0&&delete c.nonWitnessUtxo}r&&(c.bip32Derivation&&delete c.bip32Derivation,c.tapBip32Derivation&&delete c.tapBip32Derivation),n&&(c.unknownKeyVals&&delete c.unknownKeyVals,c.proprietaryKeyVals&&delete c.proprietaryKeyVals)}const l=Array.isArray(o.outputs)?o.outputs:[];for(const c of l)c&&"object"==typeof c&&(i&&(c.bip32Derivation&&delete c.bip32Derivation,c.tapBip32Derivation&&delete c.tapBip32Derivation),n&&(c.unknownKeyVals&&delete c.unknownKeyVals,c.proprietaryKeyVals&&delete c.proprietaryKeyVals))}(o,{..."publish"===(t?.profile?String(t.profile):null)?{removeGlobalXpub:!0,removeOutputDerivations:!0,removeNonWitnessUtxoWhenWitnessUtxoPresent:!0,removeUnknownAndProprietary:!0,removeInputDerivations:!0}:{removeGlobalXpub:!0,removeOutputDerivations:!0,removeNonWitnessUtxoWhenWitnessUtxoPresent:!0,removeUnknownAndProprietary:!1,removeInputDerivations:!1},...t||{}}),o.toBase64()}const ps=Object.freeze(Object.defineProperty({__proto__:null,sanitizePsbtForSharing:ds},Symbol.toStringTag,{value:"Module"}));async function fs({walletProvider:e,networkName:t,paymentAddress:n,paymentPublicKeyHex:r=null,paymentCandidates:i,feeRateSatPerVb:a,dummySats:o=600,minRemainderSats:s=546,label:l="funding-split"}={}){if(!e)throw new Error("Missing walletProvider");if(!n)throw new Error("Missing paymentAddress");if(!Array.isArray(i)||i.length<1)throw new Error("No payment UTXOs available to split. Fund your payment address first.");const c=Number(a||0);if(!Number.isFinite(c)||c<=0)throw new Error("Set a fee rate first (sat/vB) before creating a split funding transaction.");const u=await In(),d=function(e){const t=String(e||"").toLowerCase().trim();return"testnet"===t||"signet"===t||"regtest"===t?t:"mainnet"}(t),p="testnet"===d||"signet"===d||"regtest"===d?u.networks.testnet:u.networks.bitcoin,f=i.slice().sort((e,t)=>Number(t?.value||0)-Number(e?.value||0))[0];if(!f?.txid||null==f?.vout)throw new Error("Selected payment UTXO is missing txid/vout");const m=`${String(f.txid)}:${Number(f.vout)}`,g=String(f.address||"").trim();if(!g)throw new Error("Funding input is missing an address");let h,b=r;b||(b=await async function(e){try{let t=null;if(e?.getAccounts){const n=await e.getAccounts(),r=Array.isArray(n)?n.find(e=>"payment"===e?.purpose):null;t=r?.publicKey||null}else e?.getPublicKey&&(t=await e.getPublicKey());return"string"==typeof t&&t.startsWith("0x")&&(t=t.slice(2)),(!t||/^[0-9a-fA-F]{66}$/.test(t)||/^[0-9a-fA-F]{130}$/.test(t))&&t||null}catch{return null}}(e));const y={};let x="p2wpkh";if(g.startsWith("3")||g.startsWith("2")){if(x="p2sh-p2wpkh",!b)throw new Error("Cannot create funding tx with nested SegWit address (3.../2...) without payment public key. Try disconnecting and reconnecting your wallet, or switch to a native SegWit (bc1...) payment address.");const e=Buffer.from(b,"hex"),t=u.payments.p2wpkh({pubkey:e,network:p});h=u.payments.p2sh({redeem:t,network:p}).output,y.redeemScript=t.output}else h=u.address.toOutputScript(g,p),x=g.startsWith("bc1p")||g.startsWith("tb1p")?"p2tr":"p2wpkh";const w=String(n).trim(),v=u.address.toOutputScript(w,p),S=w.startsWith("bc1p")||w.startsWith("tb1p")?"p2tr":"p2wpkh",E=Un(1,3,!0,0,{isReveal:!1,inputTypes:[x],outputTypes:[S,S,S]}),N=Math.ceil(E*c),I=Number(f.value),A=I-2*Number(o)-N;if(!Number.isFinite(A)||A<Number(s))throw new Error(`Selected payment UTXO is too small to split. Need > ${2*Number(o)+N+Number(s)} sats, got ${I}.`);const k=new u.Psbt({network:p});k.addInput({hash:Buffer.from(String(f.txid),"hex").reverse(),index:Number(f.vout),sequence:4294967293,witnessUtxo:{script:h,value:Number(f.value)},...y}),k.addOutput({script:v,value:Number(o)}),k.addOutput({script:v,value:Number(o)}),k.addOutput({script:v,value:Math.floor(A)});const T=await nr(e,k.toHex(),{autoFinalized:!0,toSignInputs:[{index:0,address:g}],network:d,label:l},!0),C=T?.txid||null;if(!C)throw new Error("Funding transaction broadcast did not return a txid.");return{txid:C,spentOutpoint:m,splitUtxos:[{txid:C,vout:0,value:Number(o),address:String(n).trim()},{txid:C,vout:1,value:Number(o),address:String(n).trim()},{txid:C,vout:2,value:Math.floor(A),address:String(n).trim()}],feeSats:N}}const ms=Object.freeze(Object.defineProperty({__proto__:null,createSplitFundingTransaction:fs},Symbol.toStringTag,{value:"Module"})),gs={fundingAddress:"bc1pckp60lxtas9vr94esqyku6wr670udm8q9k5y5x7vjv7szfh03vpqsh8282",listingFee:600,minListingFee:600,feeDescription:"OODL Indexing Fee",enabled:!0},hs={bitmap:{address:"bc1px29j0hxajxp69tmzy8vstd2fmqphxkrrt74rt098ap2cha4vgplqwfhv7d",feeSats:600,minFeeSats:600,description:"Bitmap Provenance Fee"},parcel:{address:"bc1pstcg0w3w5tqh9dlcw98lxfl9s8xmglj0dkxl5y8nf20xcwawmujsw63ah0",feeSats:600,minFeeSats:600,description:"Parcel Provenance Fee"},parcel_manifest:{address:"bc1puxgqpadwdfdx8wah5y8e990e96847uhmaummcqrnarl0tpc9u0zq64trt6",feeSats:600,minFeeSats:600,description:"Parcel Manifest Registration Fee"}};let bs=[];const ys=330;function xs(e){bs=Array.isArray(e)?e.map(e=>({key:e?.key?String(e.key):null,address:e?.indexingAddress?String(e.indexingAddress):null,feeSats:(()=>{const t=Number(e?.feeSats);return Number.isFinite(t)?Math.max(ys,Math.floor(t)):ys})(),minFeeSats:(()=>{const t=Number(e?.minFeeSats);if(Number.isFinite(t))return Math.max(ys,Math.floor(t));const n=Number(e?.feeSats);return Number.isFinite(n)?Math.max(ys,Math.floor(n)):ys})(),description:e?.description?String(e.description):void 0,name:e?.name?String(e.name):void 0,imageInscriptionId:e?.imageInscriptionId?String(e.imageInscriptionId):void 0,sourceInscriptionId:e?.sourceInscriptionId?String(e.sourceInscriptionId):void 0})).filter(e=>!!e.key&&!!e.address):[]}function ws(){return Array.isArray(bs)?bs.slice():[]}function vs(){return gs.enabled?{address:gs.fundingAddress,value:gs.listingFee,description:gs.feeDescription}:null}function Ss(e){if(!gs.enabled)return null;if(!e)return null;const t=function(e){const t=String(e||"").trim();return t&&ws().find(e=>e?.key===t)||null}(e);if(t?.address){const e=Number.isFinite(t.feeSats)?t.feeSats:gs.listingFee,n=Number.isFinite(t.minFeeSats)?t.minFeeSats:e,r=Math.max(Number(e),Number(n)),i=Math.max(ys,Math.floor(Number(r)));return{address:t.address,value:i,description:t.description||t.name||"Collection Provenance Fee"}}const n=hs?.[e];return n?.address?{address:n.address,value:Math.max(ys,Math.floor(Number(Math.max(Number(n.feeSats??0),Number(n.minFeeSats??0))))),description:n.description||"Collection Provenance Fee"}:null}function Es(){const e=[];gs?.fundingAddress&&e.push(gs.fundingAddress);for(const t of ws())t?.address&&e.push(t.address);for(const t of Object.keys(hs||{})){const n=hs?.[t]?.address;n&&e.push(n)}return Array.from(new Set(e))}function Ns(e,t){const n=Number(t),r=function(e,t){const n=String(e||"").trim(),r=Number(t);if(!n||!Number.isFinite(r))return null;const i=ws();for(const a of i){const e=Number.isFinite(a?.minFeeSats)?a.minFeeSats:Number.isFinite(a?.feeSats)?a.feeSats:ys,t=Math.max(ys,Math.floor(Number(e)));if(n===a.address&&r>=t)return a.key}return null}(e,n);if(r)return r;for(const i of Object.keys(hs||{})){const t=hs?.[i];if(!t?.address)continue;const r=Number(t.minFeeSats??1);if(e===t.address&&Number.isFinite(n)&&n>=r)return i}return null}function Is(e,t){const n=Number(t);return!!Number.isFinite(n)&&(e===gs.fundingAddress&&n>=Number(gs.minListingFee||0)||!!Ns(e,n))}const As=Object.freeze(Object.defineProperty({__proto__:null,OODL_COLLECTION_FEES:hs,OODL_CONFIG:gs,getDynamicOODLCollections:ws,getOODLCollectionFeeOutput:Ss,getOODLCollectionKeyFromFee:Ns,getOODLFeeOutput:vs,getOODLIndexingAddresses:Es,isValidOODLFee:Is,setDynamicOODLCollections:xs},Symbol.toStringTag,{value:"Module"})),ks=216e5,Ts=e=>`bitmap:verify:${String(e||"").trim()}`,Cs=new Map,Bs=new Map,Ps=Array(10).fill(null),_s=[kt("/content/01bba6c58af39d7f199aa2bceeaaba1ba91b23d2663bc4ef079a4b5e442dbf74i0"),kt("/content/bb01dfa977a5cd0ee6e900f1d1f896b5ec4b1e3c7b18f09c952f25af6591809fi0"),kt("/content/bb02e94f3062facf6aa2e47eeed348d017fd31c97614170dddb58fc59da304efi0"),kt("/content/bb037ec98e6700e8415f95d1f5ca1fe1ba23a3f0c5cb7284d877e9ac418d0d32i0"),kt("/content/bb9438f4345f223c6f4f92adf6db12a82c45d1724019ecd7b6af4fcc3f5786cei0"),kt("/content/bb0542d4606a9e7eb4f31051e91f7696040db06ca1383dff98505618c34d7df7i0"),kt("/content/bb06a4dffba42b6b513ddee452b40a67688562be4a1345127e4d57269e6b2ab6i0"),kt("/content/bb076934c1c22007b315dd1dc0f8c4a2f9d52f348320cfbadc7c0bd99eaa5e18i0"),kt("/content/bb986a1208380ec7db8df55a01c88c73a581069a51b5a2eb2734b41ba10b65c2i0"),kt("/content/b907b51a239e3a37f29f8222fb274f828c6ebf7b93ce501a55b7171daaa75758i0")],Os={92871:1,92970:1,123132:1,365518:1,700181:1,826151:1,827151:1,828151:1,828239:1,828661:1,829151:1,830151:1,832104:2,832249:2,832252:2,832385:4,833067:1,833101:3,833105:4,833109:4,833121:8,834030:2,834036:2,834051:17,834073:4,836151:1,837115:2,837120:2,837151:1,837183:3,837188:2,838058:5,838068:2,838076:2,838096:1,838151:1,838821:1,839151:1,839377:1,839378:2,839382:2,839397:1,840151:1,841151:1,842151:1,845151:1};let Ls={};function Fs(e){let t;try{t=JSON.parse(e)}catch{t=void 0}if("string"==typeof t)try{t=JSON.parse(t)}catch{}return t}async function Ms(e){if("number"!=typeof e||!Number.isFinite(e))return null;if(e<0||e>906999)return null;const t=e>=84e4&&e<907e3?9:Math.floor(e/1e5);await async function(e){if(Ps[e])return;if(9===e){const t=await Ht(_s[e]);if(!t?.ok)throw new Error(`Failed to fetch OCI page ${e}: ${t?.status}`);const n=await t.json();Ls=n.satIndexMap||{};const r=[];return(n.deltaEncodedSats||[]).forEach((e,t)=>{0===t?r.push(parseInt(e)):r.push(parseInt(r[t-1])+parseInt(e))}),void(Ps[e]=r)}const t=await Ht(_s[e]);if(!t?.ok)throw new Error(`Failed to fetch OCI page ${e}: ${t?.status}`);let n,r=await t.text();if(2===e||3===e?(n=Fs("["+r+"]"),n=[n.slice(0,99999),n.slice(1e5,199999)]):(n=Fs(r),n||(n=Fs(r.replaceAll("\\n  ",""))),n||(n=Fs(r.replaceAll("\n  ",""))),n||(n=Fs(r.replaceAll("  ","")))),!Array.isArray(n)||!Array.isArray(n[0])||!Array.isArray(n[1]))return void(Ps[e]=null);const i=[];n[0].forEach((e,t)=>{0===t?i.push(parseInt(e)):i.push(parseInt(i[t-1])+parseInt(e))});const a=Array(1e5).fill(0);n[1].forEach((e,t)=>{a[e]=i[t]}),Ps[e]=a}(t);const n=Ps[t];return n?e>=84e4?n[e-84e4]:n[e%1e5]:null}function Rs(e){return e>=84e4?Ls[e]||0:Os[e]||0}async function $s(e){const t=Bs.get(e);if(t&&Date.now()-t.checkedAt<ks)return t.inscriptionId;const n=await Ms(e);if(!n)return Bs.set(e,{checkedAt:Date.now(),inscriptionId:null}),null;const r=Rs(e);try{const t=await Ht(kt(`/r/sat/${n}/at/${r}`));if(!t?.ok)throw new Error(`Failed sat lookup: ${t?.status}`);const i=await t.json(),a=i?.id?String(i.id):null;return Bs.set(e,{checkedAt:Date.now(),inscriptionId:a}),a}catch{return Bs.set(e,{checkedAt:Date.now(),inscriptionId:null}),null}}async function Us(e){if(!e)return null;try{const t=await ui(Ts(e),{maxAgeMs:15552e6});if(t&&"bitmap"===t.type&&!0===t.verified&&Number.isFinite(Number(t.bitmapNumber)))return t.key||(t.key="bitmap"),Cs.set(String(e),{checkedAt:Date.now(),result:t}),t}catch{}const t=Cs.get(e);if(t&&Date.now()-t.checkedAt<ks)return t.result;try{const t=await Ht(kt(`/content/${e}`));if(!t?.ok)throw new Error(`Failed to fetch content: ${t?.status}`);const n=await t.text(),r=String(n||"").trim().match(/^(\d+)\.bitmap/);if(!r)return Cs.set(e,{checkedAt:Date.now(),result:null}),null;const i=Number.parseInt(r[1],10);if(!Number.isFinite(i))return Cs.set(e,{checkedAt:Date.now(),result:null}),null;const a=await $s(i);if(!a||a!==e)return Cs.set(e,{checkedAt:Date.now(),result:null}),null;const o={type:"bitmap",key:"bitmap",bitmapNumber:i,verified:!0};Cs.set(e,{checkedAt:Date.now(),result:o});try{await li(Ts(e),o)}catch{}return o}catch{return Cs.set(e,{checkedAt:Date.now(),result:null}),null}}const zs=Object.freeze(Object.defineProperty({__proto__:null,clearBitmapCollectionCache:function(){Cs.clear(),Bs.clear();for(let e=0;e<Ps.length;e++)Ps[e]=null;Ls={}},detectAndVerifyBitmapByInscriptionId:Us,getBitmapSat:Ms,getBitmapSatIndex:Rs,getOciBitmapInscriptionId:$s},Symbol.toStringTag,{value:"Module"})),Ds=e=>`parcel:verify:${String(e||"").trim()}`,Hs=new Map;async function Ws(e,t){const n=await async function(e,t){const n=await async function(e){const t=String(e||"").trim();if(!t)return null;const n=[];try{let e=0;for(;;){const r=0===e?`/r/parents/${t}`:`/r/parents/${t}/${e}`,i=await Ht(kt(r));if(!i?.ok)return null;const a=await i.json(),o=Array.isArray(a?.ids)?a.ids:null;if(!o||0===o.length)break;if(n.push(...o.map(e=>String(e))),!a.more)break;if(e++,e>50)break}return n}catch{return null}}(e);if(!Array.isArray(n))return null;const r=String(t||"").trim();return!!r&&n.some(e=>String(e).trim()===r)}(e,t);return"boolean"==typeof n?n:await async function(e,t){const n=String(e||"").trim(),r=String(t||"").trim();if(!n||!r)return!1;try{let e=0;for(;;){const t=0===e?`/r/children/${r}`:`/r/children/${r}/${e}`,i=await Ht(kt(t));if(!i?.ok)return!1;const a=await i.json();if((Array.isArray(a?.ids)?a.ids:[]).some(e=>String(e).trim()===n))return!0;if(!a.more)break;if(e++,e>50)break}return!1}catch{return!1}}(e,t)}async function js(e,t){const n=Number(e);if(!Number.isFinite(n)||n<0)return null;const r=Number(t);if(!Number.isFinite(r))return null;try{const e=await Ht(kt(`/r/sat/${Math.floor(n)}/at/${r}`));if(!e?.ok)return null;const t=await e.json();return(t?.id?String(t.id).trim():null)||null}catch{return null}}async function Vs(e){if(!e)return null;try{const t=await ui(Ds(e),{maxAgeMs:15552e6});if(t&&"parcel"===t.type&&!0===t.verified&&Number.isFinite(Number(t.parcelNumber))&&Number.isFinite(Number(t.bitmapNumber)))return t.key||(t.key="parcel"),Hs.set(String(e),{checkedAt:Date.now(),result:t}),t}catch{}const t=Hs.get(e);if(t&&Date.now()-t.checkedAt<216e5)return t.result;try{const t=await Ht(kt(`/content/${e}`));if(!t?.ok)throw new Error(`Failed to fetch content: ${t?.status}`);const n=function(e){const t=String(e||"").trim().match(/^(\d+)\.(\d+)\.bitmap$/i);if(!t)return null;const n=Number.parseInt(t[1],10),r=Number.parseInt(t[2],10);return!Number.isFinite(n)||n<0||n>4294967295||!Number.isFinite(r)||r<0||r>906999?null:{parcelNumber:Math.floor(n),bitmapNumber:Math.floor(r)}}(await t.text());if(!n)return Hs.set(e,{checkedAt:Date.now(),result:null}),null;const{parcelNumber:r,bitmapNumber:i}=n,a=await Ms(i),o=new Set,s=await $s(i);if(s&&o.add(String(s)),Number.isFinite(Number(a))){const e=await js(a,0);e&&o.add(String(e));const t=await js(a,-1);t&&o.add(String(t))}if(0===o.size)return Hs.set(e,{checkedAt:Date.now(),result:null}),null;let l=null;for(const u of o)if(await Ws(e,u)){l=u;break}if(!l)return Hs.set(e,{checkedAt:Date.now(),result:null}),null;if(0!==i){const t=await async function(e){const t=Number(e);if(!Number.isFinite(t)||t<0)return null;try{const e=await Ht(kt(`/r/blockinfo/${Math.floor(t)}`));if(!e?.ok)return null;const n=await e.json(),r=Number(n?.transaction_count);return!Number.isFinite(r)||r<0?null:Math.floor(r)}catch{return null}}(i);if(Number.isFinite(t)&&r>=t)return Hs.set(e,{checkedAt:Date.now(),result:null}),null}const c={type:"parcel",key:"parcel",verified:!0,parcelNumber:r,bitmapNumber:i,bitmapInscriptionId:String(l)};Hs.set(e,{checkedAt:Date.now(),result:c});try{await li(Ds(e),c)}catch{}return c}catch{return Hs.set(e,{checkedAt:Date.now(),result:null}),null}}const qs=Object.freeze(Object.defineProperty({__proto__:null,detectAndVerifyParcelByInscriptionId:Vs},Symbol.toStringTag,{value:"Module"})),Xs="71fe313069192623570516e34a2f5746aaab04853ea607a5c9656412cfdbf077i0",Ks="a06144a8c57304e78dde41c0ba90cc6178893df42b7a7ab9b1529c8668dbd079i0",Gs="nexus_collections_registry_inscription_id";let Ys={registryId:null,fetchedAt:0,collections:[]};const Js=new Map,Qs=new Map,Zs=new Map,el=6e5,tl=new Map,nl=6e5,rl=new Map;function il(e){return(null==e?"":String(e)).trim()}function al(e){const t=e&&"object"==typeof e?e:null;if(!t)return!1;const n=il(t.type).toLowerCase();return!!n&&("gallery"===n?!!il(t.id):"parent"===n&&Array.isArray(t.ids)&&t.ids.length>0)}function ol(e){return!(!Array.isArray(e)||0===e.length)&&e.some(al)}function sl(e){const t=il(e).toLowerCase();return t?t.replace(/\s+/g,"-").replace(/[^a-z0-9_-]/g,"").replace(/-+/g,"-").replace(/^[-_]+|[-_]+$/g,""):""}function ll(e){if("string"==typeof e){const t=il(e).match(/^([a-f0-9]{64})i(\d+)(?:-(\d+))?$/i);if(!t)return null;const n=il(t[1]).toLowerCase(),r=ul(t[2],null),i=ul(t[3]??t[2],null);return/^[a-f0-9]{64}$/i.test(n)&&Number.isFinite(r)&&Number.isFinite(i)?r<0||i<0||i<r?null:{baseTxid:n,from:r,to:i}:null}if(Array.isArray(e)){const t=[];for(const n of e){const e=ll(n);e&&t.push(e)}return t.length>0?t:null}const t=e&&"object"==typeof e?e:null;if(!t)return null;const n=il(t.type);if(n&&"sequential_inscription_range"!==n)return null;let r=il(t.base_txid||t.baseTxid),i=ul(t.from_i??t.from??t.start??t.min,null),a=ul(t.to_i??t.to??t.end??t.max,null);const o=il(t.notation);if((!r||null===i||null===a)&&o){const e=o.match(/^([a-f0-9]{64})i(\d+)(?:-(\d+))?$/i);e&&(r=il(e[1]),i=ul(e[2],null),a=ul(e[3]??e[2],null))}return/^[a-f0-9]{64}$/i.test(r)&&Number.isFinite(i)&&Number.isFinite(a)?i<0||a<0||a<i?null:{baseTxid:r.toLowerCase(),from:i,to:a}:null}function cl(e,t){if(Array.isArray(t)){for(const n of t)if(cl(e,n))return!0;return!1}const n=t&&"object"==typeof t?t:null;if(!n)return!1;const r=function(e){const t=il(e).match(/^([a-f0-9]{64})i(\d+)$/i);if(!t)return null;const n=il(t[1]).toLowerCase(),r=Number.parseInt(t[2],10);return!Number.isFinite(r)||r<0?null:{txid:n,i:r}}(e);if(!r)return!1;if(r.txid!==String(n.baseTxid||"").toLowerCase())return!1;const i=Number(n.from),a=Number(n.to);return!(!Number.isFinite(i)||!Number.isFinite(a))&&r.i>=i&&r.i<=a}function ul(e,t=null){const n=Number(e);return Number.isFinite(n)?Math.floor(n):t}function dl(e,t){for(const n of t){const t=e?.[n],r=il(t);if(r)return r}return""}function pl(e,t=null){if(null==e)return t;const n=Number(e);if(!Number.isFinite(n))return t;if(n<0)return t;const r=n>0&&n<1?Math.round(1e8*n):Math.round(n);return!Number.isFinite(r)||r<0||r>Number.MAX_SAFE_INTEGER?t:r}function fl(e,t,n=null){for(const r of t){const t=pl(e?.[r],null);if(Number.isFinite(t))return t}return n}function ml(e,t,n){const r=e?.[t];return r&&"object"==typeof r?dl(r,n):""}function gl(e){if(!e)return null;if("string"==typeof e){const t=il(e);return t?{inscriptionId:t}:null}if("object"!=typeof e)return null;const t=dl(e,["inscriptionId","id","inscription_id","inscription"]);return t?{inscriptionId:t,title:dl(e,["title","name","label"])||void 0,description:dl(e,["description","desc"])||void 0,type:dl(e,["type","kind"])||void 0,required:!0===e?.required}:null}function hl(e){if(!e||"object"!=typeof e)return null;const t=sl(dl(e,["key","id","slug","name"]));if(!t)return null;const n=dl(e,["label","title","name"])||t,r=dl(e,["type","kind"])||"boolean",i=dl(e,["sourcePath","path","field"]),a=e?.default,o=(()=>{const t=Array.isArray(e?.options)?e.options:null;if(!t)return;const n=t.map(e=>{if(e&&"object"==typeof e){const t=e?.value,n=dl(e,["label","title","name"])||(void 0!==t?String(t):"");return void 0===t?null:{value:t,label:n}}return null==e?null:{value:e,label:String(e)}}).filter(Boolean);return n.length>0?n:void 0})();return{key:t,label:n,type:r,sourcePath:i||void 0,default:a,options:o}}function bl(e,t){const n=il(t);if(!n)return;const r=n.split(".").filter(Boolean);let i=e;for(const a of r){if(null==i)return;i=i?.[a]}return i}function yl(){try{const e=il(localStorage.getItem(Gs));if(e)return e}catch(e){}return Xs}function xl(){const e=yl();try{const e=il(localStorage.getItem(Gs));if(e)return[e]}catch(n){}const t=[e];return Ks!==e&&t.push(Ks),t}function wl(e){const t=il(e);try{t?localStorage.setItem(Gs,t):localStorage.removeItem(Gs)}catch(n){}}async function vl(e){const t=await fetch(e);if(!t.ok)throw new Error(`HTTP ${t.status}`);return await t.json()}function Sl(e){const t=Number(e);return Number.isFinite(t)?t<0?null:Math.floor(t):null}async function El(e){const t=il(e);if(!t)return"";const n=rl.get(t);if(n&&Date.now()-n.fetchedAt<6e5)return n.address;try{const e=kt(`/r/inscription/${t}`),n=await vl(e),r=il(n?.address);return rl.set(t,{fetchedAt:Date.now(),address:r}),r}catch{return""}}function Nl(e,t){try{const n=e&&"object"==typeof e?e:{};let r=n;if("OODL-COLLECTION"===il(n?.p)&&n?.registry_entry&&"object"==typeof n.registry_entry){r={...n.registry_entry||{}};const e=il(n?.meta?.image?.id||n?.meta?.imageId);!e||il(r.imageInscriptionId)||il(r.imageId)||(r.imageInscriptionId=e)}const i=sl(dl(r,["key","collectionKey","id","slug","name"])||il(t));if(!i)return;if(Qs.has(i))return;const a=r?.catalogImage??r?.catalog_image??r?.catalog,o=dl(r,["imageInscriptionId","image","imageId","iconInscriptionId","catalogImageInscriptionId"])||("string"==typeof a?il(a):a&&"object"==typeof a?dl(a,["inscriptionId","id","inscription_id"]):"");o&&Qs.set(i,o)}catch{}}function Il(e){const t=sl(String(e||""));return t&&Qs.get(t)||null}function Al(e,t){const n=t&&"object"==typeof t?t:null;if(!n)return null;const r=il(n.type).toLowerCase(),i=il(n.slug),a=il(n.name),o=sl(i||a||e);if(!o)return null;const s=il(n.indexingAddress||n.address||n.wallet||n.walletAddress)||il(n.addresses?.indexing||n.addresses?.fee||n.addresses?.marketplace),l=il(n.imageInscriptionId||n.imageId||n.image)||("gallery"===r?il(n.id):"parent"===r?il(Array.isArray(n.ids)?n.ids[0]:""):""),c=(()=>{if("gallery"===r){const e=il(n.id);return e&&/^[a-f0-9]{64}i\d+$/i.test(e)?{galleryInscriptionId:e}:null}if("parent"===r){const e=(Array.isArray(n.ids)?n.ids:[]).map(e=>il(e)).filter(e=>/^[a-f0-9]{64}i\d+$/i.test(e));return e.length>0?{parentInscriptionIds:e}:null}return null})();return{key:o,name:a||o,description:il(n.description||n.desc||n.about)||"",indexingAddress:s||"",feeSats:600,minFeeSats:600,imageInscriptionId:l||void 0,match:c,sort:void 0,sourceInscriptionId:e,raw:n,__galleryListType:r,__galleryListSourceId:il("gallery"===r?n.id:Array.isArray(n.ids)?n.ids[0]:"")}}async function kl(e){const t=Sl(e);if(null===t)return"";try{const e=kt(`/r/sat/${t}/at/-1`);return function(e){if(!e)return"";if("string"==typeof e)return il(e);if(Array.isArray(e)){const t=e[0];if("string"==typeof t)return il(t);if(t&&"object"==typeof t)return il(t.id||t.inscription||t.inscription_id)}if("object"==typeof e){const t=il(e.id||e.inscription||e.inscription_id);if(t)return t;if(Array.isArray(e.ids)&&e.ids.length>0)return il(e.ids[0])}return""}(await vl(e))}catch{return""}}async function Tl(e){const t=[];let n=0;for(;;){const r=kt(0===n?`/r/children/${e}`:`/r/children/${e}/${n}`),i=await vl(r);if(!i?.ids||!Array.isArray(i.ids)||0===i.ids.length)break;if(t.push(...i.ids),!i.more)break;if(n++,n>50)break}return t}async function Cl(e){const t=il(e);if(!t)return"";const n=Js.get(t);if(n&&Date.now()-n.fetchedAt<6e5)return n.text;if(!zt())return"";const r=kt(`/content/${t}`),i=await fetch(r);if(!i.ok)return"";const a=await i.text(),o=a.length>25e4?a.slice(0,25e4):a;return Js.set(t,{fetchedAt:Date.now(),text:o}),o}function Bl(e,t){const n=t&&"object"==typeof t?t:{};let r=n;const i="OODL-COLLECTION"===il(n?.p)&&n?.registry_entry&&"object"==typeof n.registry_entry?n:null;if(i){r={...i.registry_entry||{}};const e=il(i?.meta?.title),t=il(i?.meta?.description);!e||il(r.title)||il(r.name)||(r.title=e),t&&!il(r.description)&&(r.description=t);const n=il(i?.meta?.image?.id);!n||il(r.imageInscriptionId)||il(r.imageId)||il(r.image)||(r.imageInscriptionId=n)}const a=sl(dl(r,["key","collectionKey","id","slug","name"])||e),o=dl(r,["name","title","label"])||a,s=dl(r,["description","desc","about"])||"",l=dl(r,["indexingAddress","indexing_address","marketplaceFeeAddress","provenanceAddress","feeAddress","address"])||ml(r,"addresses",["indexing","index","provenance","fee","listing","marketplace"])||ml(r,"address",["indexing","index","provenance","fee","listing","marketplace"]),c=fl(r,["feeSats","fee_sats","listingFeeSats","fee","listingFee"],null)??fl(r?.fee&&"object"==typeof r.fee?r.fee:null,["sats","value","feeSats","listingFeeSats"],null),u=fl(r,["minFeeSats","min_fee_sats","minListingFeeSats","minFee","minListingFee"],null)??fl(r?.fee&&"object"==typeof r.fee?r.fee:null,["minSats","min","minFeeSats","minListingFeeSats"],null),d=r?.catalogImage??r?.catalog_image??r?.catalog,p="string"==typeof d?il(d):d&&"object"==typeof d?dl(d,["inscriptionId","id","inscription_id"]):"",f=dl(r,["imageInscriptionId","image_inscription_id","image","imageId","iconInscriptionId","catalogImageInscriptionId"])||p,m=(()=>{const e=r?.addresses;if(!e||"object"!=typeof e)return;const t={};for(const[n,r]of Object.entries(e)){const e=il(n),i=il(r);e&&i&&(t[e]=i)}return Object.keys(t).length>0?t:void 0})(),g=void 0!==r?.rules?r.rules:void 0!==r?.ruels?r.ruels:void 0,h=r?.indexLinks??r?.indexes??r?.index_links??void 0,b=(()=>{const e=(Array.isArray(r?.scripts)?r.scripts:null)||(Array.isArray(r?.scriptInscriptionIds)?r.scriptInscriptionIds:null)||(Array.isArray(r?.scriptIds)?r.scriptIds:null);if(!e)return;const t=e.map(gl).filter(Boolean);return t.length>0?t:void 0})(),y=(()=>{const e=(Array.isArray(r?.filters)?r.filters:null)||(Array.isArray(r?.filterBy)?r.filterBy:null)||(Array.isArray(r?.filtersBy)?r.filtersBy:null);if(!e)return;const t=e.map(hl).filter(Boolean);return t.length>0?t:void 0})(),x=function(e,t,n=null){for(const r of t){const t=ul(e?.[r],null);if(Number.isFinite(t))return t}return n}(r,["sort","order","priority"],null),w=(()=>{const e=(r?.match&&"object"==typeof r.match?r.match:null)||(i?.match&&"object"==typeof i.match?i.match:null),t={},n=ll(i?.indexing?.children?.include??r?.indexing?.children?.include??r?.include);if(n&&(t.inscriptionIdRange=n),!e&&0===Object.keys(t).length)return null;if(e){const n=Array.isArray(e.inscriptionIds)?e.inscriptionIds:Array.isArray(e.inscription_ids)?e.inscription_ids:null;if(n&&n.length>0){const e=n.map(e=>il(e)).filter(Boolean);e.length>0&&(t.inscriptionIds=e)}!0===e.bitmapOci&&(t.bitmapOci=!0);const r=il(e.contentRegex);r&&(t.contentRegex=r);const i=il(e.contentTypeStartsWith);i&&(t.contentTypeStartsWith=i);const a=Array.isArray(e.jsonPathEquals)?e.jsonPathEquals:null;a&&a.length>0&&(t.jsonPathEquals=a.map(e=>({path:il(e?.path),equals:e?.equals})).filter(e=>e.path));const o=(Array.isArray(e.parentInscriptionIds)?e.parentInscriptionIds:null)||(Array.isArray(e.parent_inscription_ids)?e.parent_inscription_ids:null)||(Array.isArray(e.parentIds)?e.parentIds:null)||(Array.isArray(e.parent_ids)?e.parent_ids:null);if(o&&o.length>0){const e=o.map(e=>il(e)).filter(e=>/^[a-f0-9]{64}i\d+$/i.test(e));e.length>0&&(t.parentInscriptionIds=e)}const s=il(e.galleryInscriptionId||e.gallery_inscription_id||e.galleryId||e.gallery_id);s&&/^[a-f0-9]{64}i\d+$/i.test(s)&&(t.galleryInscriptionId=s)}return Object.keys(t).length>0?t:null})();return a&&l?{key:a,name:o,description:s,indexingAddress:l,feeSats:Number.isFinite(c)?c:void 0,minFeeSats:Number.isFinite(u)?u:void 0,imageInscriptionId:f||void 0,catalogImage:d||void 0,addresses:m,rules:g,indexLinks:h,scripts:b,filters:y,match:w,sort:Number.isFinite(x)?x:void 0,sourceInscriptionId:e,manifest:i||void 0,raw:r}:null}async function Pl({forceRefresh:e=!1}={}){const t=yl();if(!e&&Ys.registryId===t&&Date.now()-Ys.fetchedAt<3e5&&Array.isArray(Ys.collections)&&Ys.collections.length>0)return{...Ys};if(!zt())return{registryId:t,fetchedAt:Date.now(),collections:[]};const n=xl();let r=[];try{const e=await Promise.all(n.map(e=>async function(e){const t=il(e);if(!t)return[];try{const e=[];let n=0;for(;;){const r=kt(0===n?`/r/children/${t}/inscriptions`:`/r/children/${t}/inscriptions/${n}`),i=await vl(r),a=Array.isArray(i?.children)?i.children:null;if(!a||0===a.length)break;if(e.push(...a),!i.more)break;if(n++,n>50)break}if(e.length>0)return e}catch{}return(await Tl(t)).map(e=>({id:e}))}(e).catch(e=>[])));for(const t of e)r.push(...t)}catch(s){return{registryId:t,fetchedAt:Date.now(),collections:[]}}const i=[];await Promise.all(r.map(async e=>{try{const n=il(e?.id),r=Sl(e?.sat);let a="";if(null!==r&&(a=await kl(r)),!a&&n){const e=await async function(e){const t=il(e);if(!t)return null;try{const e=kt(`/r/inscription/${t}`),n=await vl(e);return Sl(n?.sat)}catch{return null}}(n);null!==e&&(a=await kl(e))}a||(a=n);const o=il(await Cl(a));if(!o)return;let s;try{s=JSON.parse(o)}catch(t){return}if(ol(s)||Nl(s,a),ol(s)){const e=await async function(e,t){const n=Array.isArray(t)?t:[],r=[];for(const a of n){Nl(a,il(a?.slug||a?.name||e));const t=Al(e,a);t&&r.push(t)}let i=0;return await Promise.all(Array.from({length:Math.min(6,r.length)},()=>async function(){for(;;){const e=i++;if(e>=r.length)return;const t=r[e];if(il(t.indexingAddress))continue;const n=il(t.__galleryListSourceId);if(!n)continue;const a=await El(n);a&&(t.indexingAddress=a)}}())),r.map(e=>{const t={...e};return delete t.__galleryListType,delete t.__galleryListSourceId,t}).filter(e=>!!e.key&&!!il(e.indexingAddress))}(a,s);for(const t of e)t.sourceChildInscriptionId=n||void 0,t.sourceSat=null!==r?r:void 0,t.resolvedLatestInscriptionId=a||void 0,i.push(t)}else{const e=Bl(a,s);e&&(e.sourceChildInscriptionId=n||void 0,e.sourceSat=null!==r?r:void 0,e.resolvedLatestInscriptionId=a||void 0,i.push(e))}}catch(t){}}));const a=new Map;for(const l of i){if(!l?.key)continue;const e=il(l?.imageInscriptionId||"");e&&!Qs.has(l.key)&&Qs.set(l.key,e),a.has(l.key)||a.set(l.key,l)}const o=Array.from(a.values()).sort((e,t)=>{const n=Number.isFinite(e.sort)?e.sort:1e4,r=Number.isFinite(t.sort)?t.sort:1e4;return n!==r?n-r:String(e.name||e.key).localeCompare(String(t.name||t.key))});return Ys={registryId:t,fetchedAt:Date.now(),collections:o},{...Ys}}async function _l(e,t){const r=il(e);if(!r)return null;const i=Array.isArray(t)?t:[];if(0===i.length)return null;let a=null;const o=i.some(e=>{const t=e?.match;return!!(t?.contentRegex||t?.jsonPathEquals&&t.jsonPathEquals.length>0)})?await Cl(r):"";let s=null;if(i.some(e=>e?.match?.jsonPathEquals&&e.match.jsonPathEquals.length>0)&&o)try{s=JSON.parse(o)}catch(c){s=null}let l=null;for(const u of i){const e=u?.match;if(e){if(Array.isArray(e.inscriptionIds)&&e.inscriptionIds.length>0&&e.inscriptionIds.includes(r))return u.key;if(e.inscriptionIdRange&&cl(r,e.inscriptionIdRange))return u.key;if(Array.isArray(e.parentInscriptionIds)&&e.parentInscriptionIds.length>0)try{for(const t of e.parentInscriptionIds){const e=il(t);if(!e)continue;if(!/^[a-f0-9]{64}i\d+$/i.test(e))continue;const n=tl.get(e);let i=null;if(n&&Date.now()-n.fetchedAt<nl?i=n.ids:(i=await Tl(e),tl.set(e,{fetchedAt:Date.now(),ids:i})),Array.isArray(i)&&i.includes(r))return u.key}}catch{}if(e.galleryInscriptionId)try{const t=il(e.galleryInscriptionId),i=Zs.get(t);let a=null;if(i&&Date.now()-i.fetchedAt<el?a=i.ids:(l||(l=await n(()=>Promise.resolve().then(()=>mk),__VITE_PRELOAD__)),a=await l.getGalleryInscriptionIds(t),Zs.set(t,{fetchedAt:Date.now(),ids:a})),Array.isArray(a)&&a.includes(r))return u.key}catch(c){}if(!0===e.bitmapOci)try{a||(a=await n(()=>Promise.resolve().then(()=>zs),__VITE_PRELOAD__));const e=await a.detectAndVerifyBitmapByInscriptionId(r);if("bitmap"===e?.type&&e?.verified)return u.key}catch(c){}if(e.contentRegex&&o)try{if(new RegExp(e.contentRegex).test(o))return u.key}catch(c){}if(e.jsonPathEquals&&e.jsonPathEquals.length>0&&s&&e.jsonPathEquals.every(e=>bl(s,e.path)===e.equals))return u.key}}return null}const Ol=Object.freeze(Object.defineProperty({__proto__:null,DEFAULT_COLLECTIONS_REGISTRY_INSCRIPTION_ID:Xs,LEGACY_COLLECTIONS_REGISTRY_INSCRIPTION_ID:Ks,getAllRegistryParentIds:xl,getCollectionImageInscriptionId:Il,getCollectionsRegistryInscriptionId:yl,loadCollectionsRegistry:Pl,matchCollectionForInscription:_l,resolveGalleryIds:async function(e){const t=il(e?.match?.galleryInscriptionId);if(!t)return[];const r=Zs.get(t);if(r&&Date.now()-r.fetchedAt<el)return r.ids||[];try{const e=await async function(e){const t=il(e);if(!t)return null;try{const e=kt(`/content/${t}`),n=await fetch(e);if(!n.ok)return null;const r=(await n.text()).trim();if(!r||r.length>5e6)return null;if("["!==r[0]&&"{"!==r[0])return null;const i=JSON.parse(r),a=/^[a-f0-9]{64}i\d+$/i,o=e=>a.test(String(e||"").trim()),s=e=>String(e||"").trim();if(Array.isArray(i)){const e=i.map(e=>"string"==typeof e?s(e):e&&"object"==typeof e?s(e.id||e.inscriptionId||e.inscription_id||""):"").filter(o);return e.length>0?e:null}if(i&&"object"==typeof i)for(const t of["ids","inscriptions","members","items","gallery"])if(Array.isArray(i[t])){const e=i[t].map(e=>"string"==typeof e?s(e):e&&"object"==typeof e?s(e.id||e.inscriptionId||e.inscription_id||""):"").filter(o);if(e.length>0)return e}return null}catch{return null}}(t);if(e&&e.length>0)return Zs.set(t,{fetchedAt:Date.now(),ids:e}),e;const{getGalleryInscriptionIds:r}=await n(async()=>{const{getGalleryInscriptionIds:e}=await Promise.resolve().then(()=>mk);return{getGalleryInscriptionIds:e}},__VITE_PRELOAD__),i=await r(t);return Zs.set(t,{fetchedAt:Date.now(),ids:i}),i}catch(i){return[]}},resolveParentChildrenIds:async function(e){const t=e?.match?.parentInscriptionIds,n=(Array.isArray(t)?t.map(e=>il(e)).filter(Boolean):[]).filter(e=>/^[a-f0-9]{64}i\d+$/i.test(e));if(0===n.length)return[];const r=new Set;let i=0;const a=async e=>{const t=il(e);if(!t)return;const n=tl.get(t);if(n&&Date.now()-n.fetchedAt<nl){for(const e of n.ids||[])r.add(e);return}const i=await Tl(t);tl.set(t,{fetchedAt:Date.now(),ids:i});for(const a of i||[])r.add(a)},o=Array.from({length:Math.min(3,n.length)}).map(async()=>{for(;;){const e=i++;if(e>=n.length)return;await a(n[e])}});return await Promise.all(o),Array.from(r)},resolveParentChildrenIdsProgressive:async function(e,t){const n=e?.match?.parentInscriptionIds,r=(Array.isArray(n)?n.map(e=>il(e)).filter(Boolean):[]).filter(e=>/^[a-f0-9]{64}i\d+$/i.test(e));if(0===r.length)return;const i=new Set,a=e=>{const n=(e||[]).filter(e=>e&&!i.has(e));if(0!==n.length){n.forEach(e=>i.add(e));try{t(n)}catch{}}},o=[];for(const p of r){const e=tl.get(p);e&&Date.now()-e.fetchedAt<nl?a(e.ids||[]):o.push(p)}if(0===o.length)return;const s=new Map;await Promise.all(o.map(async e=>{try{const t=kt(`/r/children/${e}`),n=await vl(t),r=Array.isArray(n?.ids)?n.ids:[];s.set(e,{ids:r,more:!!n?.more}),a(r)}catch{s.set(e,{ids:[],more:!1})}}));for(const p of o){const e=s.get(p);e&&!e.more&&tl.set(p,{fetchedAt:Date.now(),ids:e.ids})}const l=o.filter(e=>s.get(e)?.more);if(0===l.length)return;let c=0;const u=async e=>{const t=[...s.get(e)?.ids||[]];let n=1;for(;;)try{const r=kt(`/r/children/${e}/${n}`),i=await vl(r),o=Array.isArray(i?.ids)?i.ids:[];if(0===o.length)break;if(a(o),t.push(...o),!i.more)break;if(n++,n>50)break}catch{break}tl.set(e,{fetchedAt:Date.now(),ids:t})},d=Array.from({length:Math.min(3,l.length)}).map(async()=>{for(;;){const e=c++;if(e>=l.length)return;await u(l[e])}});await Promise.all(d)},setCollectionsRegistryInscriptionIdOverride:wl},Symbol.toStringTag,{value:"Module"})),Ll=new Map;function Fl(e){const t=e?.output||e?.satpoint||e?.location;if(!t||"string"!=typeof t)return null;const n=t.split(":");if(n.length<2)return null;const r=n[0],i=n[1];if(!/^[0-9a-f]{64}$/i.test(r))return null;const a=Number(i);return!Number.isFinite(a)||a<0?null:`${String(r).toLowerCase()}:${Math.floor(a)}`}function Ml(e){if("string"!=typeof e)return!1;const t=e.trim();return t.length>0&&t.length%2==0&&/^[0-9a-fA-F]+$/.test(t)}async function Rl(e){const t=String(e||"").trim().toLowerCase();if(!/^[0-9a-f]{64}$/.test(t))throw new Error("fetchRawTxHexByTxid: txid must be 64 hex chars");try{const e=await xi(t,null);if("string"==typeof e&&e.trim())return e.trim()}catch{}try{const e=kt(`/r/tx/${t}`),n=await fetch(e);if(n.ok){const e=String(n?.headers?.get?.("content-type")||"").toLowerCase(),t=String(await n.text()||"").trim();if(Ml(t))return t;if(e.includes("application/json")||t.startsWith("{")||t.startsWith("["))try{const e=JSON.parse(t),n=[e?.hex,e?.txHex,e?.rawtx,e?.rawTx,e?.data?.hex,e?.result?.hex].filter(e=>"string"==typeof e);for(const t of n){const e=String(t).trim();if(Ml(e))return e}}catch{}const r=t.slice(0,200).toLowerCase();if(!(r.includes("<!doctype")||r.includes("<html")||r.includes("<head")||r.includes("<body"))){const e=t.match(/\b[0-9a-fA-F]{200,}\b/);if(e&&Ml(e[0]))return e[0]}}}catch{}throw new Error("fetchRawTxHexByTxid: all sources exhausted")}async function $l(e){try{const t=kt(`/r/inscription/${e}`),n=await fetch(t);if(!n.ok)return null;const r=await n.json();return{id:e,inscriptionId:e,number:r.number,contentType:r.content_type,timestamp:r.timestamp,...r}}catch(tn){return null}}async function Ul(e=!1){const t="object"==typeof e&&null!==e?e:{forceRefresh:!!e},r=!!t.forceRefresh,i="string"==typeof t.collection?t.collection.trim():null,a=(()=>{if(t.address)return[String(t.address).trim()].filter(Boolean);if(Array.isArray(t.addresses)&&t.addresses.length>0)return t.addresses.map(e=>String(e).trim()).filter(Boolean);if(i){const e=Ss(i);if(e?.address)return[e.address]}return Es()})(),o=/^(bc1[a-z0-9]{25,90}|[13][a-km-zA-HJ-NP-Z1-9]{25,34})$/;for(const n of a)if(!o.test(n))return[];const s=function(e){const t=String(e||"").trim();if(!t)return null;if(!Ll.has(t)){if(Ll.size>=50){let e=null,t=1/0;for(const[n,r]of Ll)r.lastFetchTime<t&&(t=r.lastFetchTime,e=n);e&&Ll.delete(e)}Ll.set(t,{listingsCache:new Map,lastFetchTime:0})}return Ll.get(t)}(1===a.length?`addr:${a[0]}`:`multi:${a.slice().sort().join("|")}`);if(!s)return[];try{const e=await Pl({forceRefresh:!1}),t=Array.isArray(e?.collections)?e.collections:[];t.length>0&&xs(t)}catch{}if(!r&&Date.now()-s.lastFetchTime<6e4&&s.listingsCache.size>0){let e=Array.from(s.listingsCache.values());if(i){const t=i.toLowerCase();e=e.filter(e=>String(e?.collection?.key||"").toLowerCase()===t)}return e.slice().sort((e,t)=>{const n=Number(e?.listedAt||0),r=Number(t?.listedAt||0);return r!==n?r-n:String(t?.commitTxid||t?.inscriptionId||"").localeCompare(String(e?.commitTxid||e?.inscriptionId||""))})}const l=await async function(e){try{const t=Array.isArray(e)?e:[];if(0===t.length)return[];const n=[];for(let e=0;e<t.length;e+=3){const r=t.slice(e,e+3),i=await Promise.all(r.map(async e=>{const[t,n]=await Promise.all([bi(e).catch(()=>[]),yi(e).catch(()=>[])]);return[...Array.isArray(t)?t:[],...Array.isArray(n)?n:[]]}));n.push(...i)}const r=n.flat(),i=new Map;for(const e of r)e?.txid&&i.set(e.txid,e);return Array.from(i.values())}catch(tn){return[]}}(a);if(!Array.isArray(l))return Array.from(s.listingsCache.values());const c=[];for(const n of l){const e=(()=>{const e=Array.isArray(n?.vout)?n.vout:[];for(const t of e){const e=t.scriptpubkey_address||t.scriptPubKey?.address,n=t.value,r=e?Ns(String(e),n):null;if(r)return{output:t,key:r}}return null})(),t=(()=>(Array.isArray(n?.vout)?n.vout:[]).find(e=>Is(e.scriptpubkey_address||e.scriptPubKey?.address,e.value))||null)(),r=e?"collection":t?"legacy":null;if(!r)continue;if(n.status?.confirmed&&n.status?.block_height&&n.status.block_height<908e3)continue;const i=String(n?.txid||"").trim().toLowerCase();if(!/^[0-9a-f]{64}$/.test(i))continue;const a="collection"===r?e.output:t;c.push({tx:n,txid:i,mode:r,collectionFeeHit:e,oodlFeeOutput:a})}const u=await In().catch(()=>null),d=await n(()=>Promise.resolve().then(()=>fo),__VITE_PRELOAD__).catch(()=>null),p=new Map;if(u&&d){let e=0;const t=async()=>{for(;;){const t=e++;if(t>=c.length)return;const{txid:n}=c[t];try{const e=await Rl(n),t=await d.extractOodlListingMetadataFromRevealTxWithBitcoinLib(u,e);t&&p.set(n,t)}catch{}}},n=[];for(let r=0;r<Math.min(6,c.length);r++)n.push(t());await Promise.all(n)}for(const{tx:n,txid:m,mode:g,collectionFeeHit:h}of c){const e=p.get(m);if(!e)continue;const t=e=>{try{if(null==e)return null;const t="bigint"==typeof e?e:BigInt(String(e));if(t<=0n||t>BigInt(Number.MAX_SAFE_INTEGER))return null;const n=Number(t);return Number.isFinite(n)&&n>0?Math.trunc(n):null}catch{const t=Number(e);return Number.isFinite(t)&&t>0?Math.trunc(t):null}};Math.max(Number.isFinite(Number(e?.listingCount))?Number(e.listingCount):0,Array.isArray(e?.outputIndicesArray)?e.outputIndicesArray.length:0,Array.isArray(e?.inscriptionIdsArray)?e.inscriptionIdsArray.length:0,Array.isArray(e?.pricesArray)?e.pricesArray.length:0,1);const r=(()=>Array.isArray(e?.outputIndicesArray)&&e.outputIndicesArray.length>0?e.outputIndicesArray.map((e,t)=>Number.isFinite(Number(e))?Number(e):t):[0])();for(let i=0;i<r.length;i++){const a=Number(r[i]);if(!Number.isFinite(a)||a<0)continue;const o=`${m}:${a}`,l=String(e?.inscriptionIdsArray?.[i]||"").trim(),c=await zl(o)||l;if(!c)continue;const u=await $l(c);if(!u)continue;let d=null;try{if(d=Fl(u),d||(d=await Gt(c)),d&&String(d).toLowerCase()!==o){s.listingsCache.delete(c);continue}}catch{d=null}let p=null,f=!1;if("collection"===g){const e=String(h.key||"").trim().toLowerCase();if("parcel"===e){try{p=await Vs(c)}catch{p=null}if("parcel"!==String(p?.key||"").toLowerCase())continue}else if("bitmap"===e)try{const e=await Us(c);p="bitmap"===String(e?.key||"").toLowerCase()?e:{key:h.key}}catch{p={key:h.key}}else p={key:h.key}}else{try{p=await Us(c)}catch{p=null}"bitmap"!==String(p?.key||"").toLowerCase()&&(p=null,f=!0)}const b=m,y=t(e?.pricesArray?.[i]??e?.priceSats??null),x={inscriptionId:c,inscription:u,commitTxid:Array.isArray(n?.vin)&&n.vin[0]?.txid?String(n.vin[0].txid).toLowerCase():m,revealTxid:b,revealOutputIndex:a,price:y,listedAt:n.status?.block_time?1e3*n.status.block_time:Date.now(),status:"active",collection:p,uncategorized:!!f,inscriptionOutpoint:d||null,bitmapNumberHint:Number.isFinite(Number(e?.bitmapNumbersArray?.[i]))?Number(e.bitmapNumbersArray[i]):null,parcelNumberHint:Number.isFinite(Number(e?.parcelNumbersArray?.[i]))?Number(e.parcelNumbersArray[i]):Number.isFinite(Number(e?.parcelNumber))?Number(e.parcelNumber):null,minBlockHeight:n.status?.block_height||null},w=s.listingsCache.get(x.inscriptionId);if(w){const e=Number(w?.listedAt||0);if(Number(x?.listedAt||0)>=e){const e=Number(w?.price);Number.isFinite(e)&&e>0&&null===x.price&&(x.price=w.price,w.priceAsOf&&(x.priceAsOf=w.priceAsOf)),null!==w.bitmapNumberHint&&null===x.bitmapNumberHint&&(x.bitmapNumberHint=w.bitmapNumberHint),null!==w.parcelNumberHint&&null===x.parcelNumberHint&&(x.parcelNumberHint=w.parcelNumberHint),void 0!==w.minBlockHeight&&void 0===x.minBlockHeight&&(x.minBlockHeight=w.minBlockHeight),s.listingsCache.set(x.inscriptionId,x)}}else s.listingsCache.set(x.inscriptionId,x)}}s.lastFetchTime=Date.now();let f=Array.from(s.listingsCache.values());if(i){const e=i.toLowerCase();f=f.filter(t=>String(t?.collection?.key||"").toLowerCase()===e)}return f.slice().sort((e,t)=>{const n=Number(e?.listedAt||0),r=Number(t?.listedAt||0);return r!==n?r-n:String(t?.commitTxid||t?.inscriptionId||"").localeCompare(String(e?.commitTxid||e?.inscriptionId||""))})}async function zl(e){try{const t=kt(`/r/utxo/${e}`),n=await fetch(t);if(!n.ok)return null;const r=await n.json();return r.inscriptions&&Array.isArray(r.inscriptions)&&0!==r.inscriptions.length?r.inscriptions[0]:null}catch(tn){return null}}function Dl(){const e=[];for(const n of Ll.values())e.push(...Array.from(n.listingsCache.values()));const t=new Map;for(const n of e)n?.inscriptionId&&t.set(n.inscriptionId,n);return Array.from(t.values())}async function Hl(e,t={}){const n=(Array.isArray(e)?e:[]).map(String).filter(Boolean);if(0===n.length)return new Map;const r=Array.isArray(t?.fetchCollections)?t.fetchCollections:[];r.length>0&&await Promise.all(r.map(e=>Ul({collection:String(e).trim(),forceRefresh:!1}).catch(()=>[])));const i=new Set(n),a=new Map;for(const o of Ll.values())for(const[e,t]of o.listingsCache)i.has(e)&&!a.has(e)&&a.set(e,t);return a}function Wl(){Ll.clear()}async function jl(e,t={}){const n=String(e||"").trim();if(!n)throw new Error("indexCollectionListings: collectionKey is required");return await Ul({collection:n,forceRefresh:!!t.forceRefresh})}async function Vl(e={}){return await Ul({forceRefresh:!!e.forceRefresh})}async function ql(e={}){const t=!1!==e.loadRegistry,n=!!e.forceRefresh;if(t)try{const e=await Pl({forceRefresh:n}),t=Array.isArray(e?.collections)?e.collections:[];t.length>0&&xs(t)}catch{}const r=[],i=new Set;for(const[a,o]of Object.entries(hs||{}))o?.address&&(i.add(a),r.push({key:a,indexingAddress:o.address,feeSats:Number(o.feeSats)||600,minFeeSats:Number(o.minFeeSats)||Number(o.feeSats)||600,description:o.description||a,name:a.charAt(0).toUpperCase()+a.slice(1),source:"builtin"}));for(const a of ws())a?.key&&a?.address&&(i.has(a.key)||(i.add(a.key),r.push({key:a.key,indexingAddress:a.address,feeSats:Number(a.feeSats)||600,minFeeSats:Number(a.minFeeSats)||Number(a.feeSats)||600,description:a.description||a.name||a.key,name:a.name||a.key,imageInscriptionId:a.imageInscriptionId||void 0,source:"registry"})));return gs?.fundingAddress&&r.push({key:"__uncategorized",indexingAddress:gs.fundingAddress,feeSats:Number(gs.listingFee)||600,minFeeSats:Number(gs.minListingFee)||600,description:gs.feeDescription||"OODL Indexing Fee",name:"Uncategorized",source:"builtin"}),r}const Xl=Object.freeze(Object.defineProperty({__proto__:null,clearListingsCache:Wl,getActiveListingsByInscriptionIds:Hl,getAvailableCollections:ql,getCachedListings:Dl,indexAllListings:Vl,indexCollectionListings:jl,indexOODLListings:Ul},Symbol.toStringTag,{value:"Module"}));async function Kl(e,t={}){const{defaultRecipient:n,walletInscriptions:r=[]}=t;let i;try{i=JSON.parse(String(e||""))}catch(_){throw new Error(`Invalid JSON: ${_.message}`)}if(!i||"object"!=typeof i)throw new Error("JSON must be an object");const a=i.defaults||{},o=i.items||(i.item?[i.item]:[]);if(0===o.length)throw new Error('JSON must contain "items" array or "item" object');const s=e=>{if(null!=e){if("string"==typeof e){const t=e.trim();if(!t)return;return JSON.parse(t)}return e}},l=e=>String(e??""),c=e=>{if(null==e)return"";if("string"==typeof e)return e;try{return JSON.stringify(e)}catch{return String(e)}},u=new Set;o.forEach(e=>{(Array.isArray(e.parentIds)?e.parentIds:Array.isArray(a.parentIds)?a.parentIds:[]).forEach(e=>u.add(e))});let d=0;u.size>0&&(d=(await Promise.all(Array.from(u).map(async e=>{try{return await Yt(e,{walletInscriptions:r})}catch(_){const n=_&&_.message?_.message:String(_);throw new Error(`Cannot fetch exact parent UTXO value for ${e}. Refusing to assume 546 sats because that can misplace pointers/inscriptions. Error: ${n}`)}}))).reduce((e,t)=>e+t,0));const p=o.filter(e=>!!e.reinscriptionTargetId),f=Array.from(new Set(p.map(e=>e.reinscriptionTargetId).filter(Boolean))),m=new Map;f.length>0&&(await Promise.all(f.map(async e=>{try{return[e,await Yt(e,{walletInscriptions:r})]}catch(_){const n=_&&_.message?_.message:String(_);throw new Error(`Cannot fetch exact reinscription target UTXO value for ${e}. Refusing to assume 546 sats because that can misplace pointers/inscriptions. Error: ${n}`)}}))).forEach(([e,t])=>m.set(e,t));const g=e=>Math.max(330,parseInt(e.postage||a.postage||546,10)),h=e=>!!o[e]?.reinscriptionTargetId,b=d>0,y=o.some(e=>!!e.reinscriptionTargetId),x=o.some(e=>!e.reinscriptionTargetId),w=b&&y&&x,v=[],S=[],E=new Array(o.length).fill(546),N=new Array(o.length).fill(0);for(let O=0;O<o.length;O++){const e=o[O];if(E[O]=g(e),h(O)){v.push(O);const t=e.reinscriptionTargetId;N[O]=m.has(t)?m.get(t):546}else S.push(O)}const I=v.reduce((e,t)=>e+(N[t]||0),0),A=d+I+S.reduce((e,t)=>e+(E[t]||0),0),k=w?0:d,T=w?I+d:d+I,C=new Array(o.length).fill(void 0);let B=0;for(const O of v)C[O]=k+B,B+=N[O]||0;B=0;for(const O of S)C[O]=T+B,B+=E[O]||0;const P=await Promise.all(o.map(async(e,t)=>{let r=e.content;if(e.contentBase64&&(r=(e=>{const t=atob(String(e||"")),n=new Uint8Array(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n})(e.contentBase64)),!r)throw new Error(`Item #${t+1}: No content provided`);const i="string"==typeof r||r instanceof Uint8Array?r:new Uint8Array(r),o=e.contentType||a.contentType||"text/plain",u=e.metaprotocol??a.metaprotocol,d=e.recipientAddress||a.recipientAddress||n||void 0,p=Math.max(330,parseInt(e.postage||a.postage||546,10)),f=void 0!==e.commitFeeRateOverride?Number(e.commitFeeRateOverride):void 0,m=s(e.metadata??a.metadata),g=s(e.properties??a.properties),h=Array.isArray(e.parentIds)?e.parentIds:Array.isArray(a.parentIds)?a.parentIds:[];let b=void 0!==e.pointer?e.pointer:a.pointer;if(e.reinscriptionTargetId,(void 0===b||""===b)&&Array.isArray(C)&&"number"==typeof C[t]){const e=C[t];e>0&&(b=e)}const y=0===(x=b)?0:x??"";var x;const w=(e=>{if(0===e)return 0;if(null==e)return;const t=String(e).trim();if(!t)return;const n=parseInt(t,10);return Number.isFinite(n)?n:void 0})(y);if(null!=w&&"number"==typeof w){if(w<0)throw new Error(`Item #${t+1}: Pointer must be >= 0, got ${w}`);if(A>0&&w>=A)throw new Error(`Item #${t+1}: Pointer ${w} is outside planned outputs (total=${A}). This would likely create an unbound inscription (fee/miner).`)}const v=e.delegateId??a.delegateId,S=e.contentEncoding??a.contentEncoding,E=e.compressBeforeInscribe??a.compressBeforeInscribe??!1,N=bt({content:i,contentType:String(o),parentIds:h&&h.length>0?h:void 0,delegateId:v?String(v):void 0,metaprotocol:u?String(u):void 0,pointer:w,metadata:m,properties:g,customTags:void 0,contentEncoding:S?String(S):void 0}),I=c(m),k=c(g),T=l(u),B=l(S),P=l(v),_=!!E,O=0===y?0:y||void 0;return{inscriptionScript:N,mode:"standard",recipientAddress:d||void 0,content:i,contentSize:"string"==typeof i?(new TextEncoder).encode(i).length:i.length,contentType:String(o),commitFeeRateOverride:f,postage:p,metadata:I,properties:k,metaprotocol:T,pointer:O,contentEncoding:B,compressBeforeInscribe:_,customTags:null,delegateId:P,parentIds:h,...void 0!==e.revealFundingValue?{revealFundingValue:Number(e.revealFundingValue)}:{}}}));return{items:P}}const Gl=Object.freeze(Object.defineProperty({__proto__:null,OODL_COLLECTION_FEES:hs,OODL_CONFIG:gs,OodinalsOfferService:class{constructor({sellerSigner:e,buyerSigner:t}={}){this.sellerSigner=e||null,this.buyerSigner=t||null}async createSellerOffer(e){if(!this.sellerSigner||"function"!=typeof this.sellerSigner.createSellerOffer)throw new Error("OodinalsOfferService.createSellerOffer: sellerSigner.createSellerOffer(...) not configured");return await this.sellerSigner.createSellerOffer(e)}async createOpenStoreListing(e){if(!this.sellerSigner||"function"!=typeof this.sellerSigner.createOpenStoreListing){if(this.sellerSigner&&"function"==typeof this.sellerSigner.createSellerOffer)return await this.sellerSigner.createSellerOffer(e);throw new Error("OodinalsOfferService.createOpenStoreListing: sellerSigner.createOpenStoreListing(...) not configured")}return await this.sellerSigner.createOpenStoreListing(e)}async createBuyerPsbt(e){if(!this.buyerSigner||"function"!=typeof this.buyerSigner.createBuyerPsbt)throw new Error("OodinalsOfferService.createBuyerPsbt: buyerSigner.createBuyerPsbt(...) not configured");return await this.buyerSigner.createBuyerPsbt(e)}async buyFromRevealTx(e){if(!this.buyerSigner||"function"!=typeof this.buyerSigner.buyFromRevealTx)throw new Error("OodinalsOfferService.buyFromRevealTx: buyerSigner.buyFromRevealTx(...) not configured");return await this.buyerSigner.buyFromRevealTx(e)}async mergeAndFinalize(e){if(!this.buyerSigner||"function"!=typeof this.buyerSigner.mergeAndFinalize)throw new Error("OodinalsOfferService.mergeAndFinalize: buyerSigner.mergeAndFinalize(...) not configured");return await this.buyerSigner.mergeAndFinalize(e)}},addCustomFee:Gn,applyPlatformSellerFeeToMarker:aa,assertOpenStoreSellerOfferSignedCorrectly:as,broadcastTransaction:rr,brotliCompressBytes:Pi,brotliDecompressBytes:_i,buildItemsFromJson:Kl,buildListingCommitTx:io,buildMultiAssetListingCommitTx:uo,buildSaleMarkerOpReturnScript:ji,calculateInscriptionFees:Hn,clearCustomFees:Yn,clearListingsCache:Wl,computeFeeEstimateForBatch:ki,computePsbtHashHex:ss,createAndBroadcast3TxSaleListingFlow:oo,createAndBroadcastBuyFromInscriptionId:Qo,createAndBroadcastBuyFromRevealTx:Vo,createAndBroadcastBuyFromSellerOfferPsbt:Yo,createAndBroadcastListingCommitTx:ao,createAndBroadcastMultiAsset3TxSaleListingFlow:po,createAndBroadcastSaleListingTx:so,createBuyerFundedPsbtForSellerCountersign:Jo,createMarketplaceClient:fa,createMarketplaceClientFromInscription:async function(e,t={}){return fa({...await pa(e),...t||{}})},createSignedOpenStoreSellerOfferPsbt:async function({walletState:e,walletProvider:t,parentUtxo:n,priceSats:r,sellerPayoutAddress:i,minBlockHeight:a=null}){if(!e?.isConnected)throw new Error("Wallet not connected");if(!t)throw new Error("Wallet provider not available");if(!i)throw new Error("Wallet payout address not available");const o=n&&"object"==typeof n?n:null;if(!o?.txid||null==o?.vout)throw new Error("Selected inscription is missing UTXO data. Refresh inscriptions/UTXOs and try again.");const s=Number(o?.value);if(!Number.isFinite(s)||s<=0)throw new Error("Selected inscription UTXO is missing value. Refresh UTXOs/inscriptions and try again.");if(!mo(o?.address||o?.addr||e?.ordinalsAddress))throw new Error("Parent UTXO missing address. Ensure wallet ordinalsAddress is available.");const[l]=await go({walletState:e,walletProvider:t,offers:[{parentUtxo:n,priceSats:r,minBlockHeight:a}],sellerPayoutAddress:i,minBlockHeight:a});if(!l)throw new Error("Wallet refused to sign the 0x83 offer PSBT. This wallet cannot auto-generate buyable offers.");return l},createSignedOpenStoreSellerOfferPsbtsBatch:go,createSplitFundingTransaction:fs,decodeOodinalsSaleMarker:Di,encodeOodinalsSaleMarker:Hi,encodeOpenStoreSaleMarkerV2:Wi,estimateBuyNeedFromInscriptionId:Ko,estimateBuyNeedFromRevealTx:Xo,estimateBuyNeedFromSellerOfferPsbt:Go,executeBatchInscription:pr,extractMultiOfferFromRevealTxWithBitcoinLib:co,extractOodlListingMetadataFromRevealTxWithBitcoinLib:Ra,extractSellerPsbtFromRevealTx:$a,extractSellerPsbtFromRevealTxWithBitcoinLib:Ma,fetchCompleteWalletData:Lr,filterSpendableUtxos:ei,findOodinalsSaleListingInTx:Xi,findSaleListingForInscription:async function(e,t,n,r=null){if(!e)return null;if("function"!=typeof n)throw new Error("findSaleListingForInscription: fetchRawTxHex(txid) is required");const i=(()=>{if(!t)return null;if("string"==typeof t){const[e,n]=t.split(":"),r=Number.parseInt(n,10);return e&&Number.isFinite(r)?{txid:e,vout:r}:null}return t.txid&&void 0!==t.vout?{txid:t.txid,vout:Number(t.vout)}:null})();if(!i?.txid)throw new Error('findSaleListingForInscription: invalid currentOutput (expected "txid:vout" or {txid, vout})');const a=await n(i.txid),o=await Xi(a,i.txid,r);return o?o.parentInscriptionId!==e?null:{...o,outpoint:i,discoveryScope:"current-output-tx-only"}:null},getActiveFeeOutputsForBatch:Xn,getAvailableCollections:ql,getCachedListings:Dl,getCollectionsRegistryInscriptionId:yl,getDynamicOODLCollections:ws,getInscriptionDetails:Kt,getInscriptionOutpoint:Gt,getOODLCollectionFeeOutput:Ss,getOODLFeeOutput:vs,getOODLIndexingAddresses:Es,getPlatformSellerFee:ia,getPsbtInputOutpoint:os,getSellerOfferPsbtBase64FromRevealTxid:Ao,getTotalFeeAmount:Qn,getTotalFeeAmountForBatch:Kn,indexAllListings:Vl,indexCollectionListings:jl,indexOODLListings:Ul,initBitcoinProxy:Ii,isValidOODLFee:Is,loadBitcoinLibFromInscription:In,loadBrotliOC:Bi,loadCollectionsRegistry:Pl,loadMarketplaceConfigFromInscription:pa,matchCollectionForInscription:_l,parseAndValidateJson:function(e){let t;try{t=JSON.parse(String(e||""))}catch(n){throw new Error(`Invalid JSON: ${n.message}`)}if(!t||"object"!=typeof t)throw new Error("JSON must be an object");if(!t.items||!Array.isArray(t.items)||0===t.items.length)throw new Error('JSON must contain an "items" array with at least one item');return t.items.forEach((e,t)=>{if(!e.content&&!e.contentBase64)throw new Error(`Item #${t+1}: Missing "content" or "contentBase64"`)}),t},sanitizePsbtForSharing:ds,setCollectionsRegistryInscriptionIdOverride:wl,setDeveloperFee:qn,setDynamicOODLCollections:xs,signPsbtsWithFallback:V,snapshotOpenStoreOfferCriticalShape:rs,validateOodinalsSaleListing:ls},Symbol.toStringTag,{value:"Module"}));var Yl={exports:{}},Jl={},Ql=Symbol.for("react.transitional.element"),Zl=Symbol.for("react.portal"),ec=Symbol.for("react.fragment"),tc=Symbol.for("react.strict_mode"),nc=Symbol.for("react.profiler"),rc=Symbol.for("react.consumer"),ic=Symbol.for("react.context"),ac=Symbol.for("react.forward_ref"),oc=Symbol.for("react.suspense"),sc=Symbol.for("react.memo"),lc=Symbol.for("react.lazy"),cc=Symbol.iterator,uc={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},dc=Object.assign,pc={};function fc(e,t,n){this.props=e,this.context=t,this.refs=pc,this.updater=n||uc}function mc(){}function gc(e,t,n){this.props=e,this.context=t,this.refs=pc,this.updater=n||uc}fc.prototype.isReactComponent={},fc.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},fc.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},mc.prototype=fc.prototype;var hc=gc.prototype=new mc;hc.constructor=gc,dc(hc,fc.prototype),hc.isPureReactComponent=!0;var bc=Array.isArray,yc={H:null,A:null,T:null,S:null,V:null},xc=Object.prototype.hasOwnProperty;function wc(e,t,n,r,i,a){return n=a.ref,{$$typeof:Ql,type:e,key:t,ref:void 0!==n?n:null,props:a}}function vc(e){return"object"==typeof e&&null!==e&&e.$$typeof===Ql}var Sc=/\/+/g;function Ec(e,t){return"object"==typeof e&&null!==e&&null!=e.key?(n=""+e.key,r={"=":"=0",":":"=2"},"$"+n.replace(/[=:]/g,function(e){return r[e]})):t.toString(36);var n,r}function Nc(){}function Ic(e,t,n,r,i){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var o,s,l=!1;if(null===e)l=!0;else switch(a){case"bigint":case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case Ql:case Zl:l=!0;break;case lc:return Ic((l=e._init)(e._payload),t,n,r,i)}}if(l)return i=i(e),l=""===r?"."+Ec(e,0):r,bc(i)?(n="",null!=l&&(n=l.replace(Sc,"$&/")+"/"),Ic(i,t,n,"",function(e){return e})):null!=i&&(vc(i)&&(o=i,s=n+(null==i.key||e&&e.key===i.key?"":(""+i.key).replace(Sc,"$&/")+"/")+l,i=wc(o.type,s,void 0,0,0,o.props)),t.push(i)),1;l=0;var c,u=""===r?".":r+":";if(bc(e))for(var d=0;d<e.length;d++)l+=Ic(r=e[d],t,n,a=u+Ec(r,d),i);else if("function"==typeof(d=null===(c=e)||"object"!=typeof c?null:"function"==typeof(c=cc&&c[cc]||c["@@iterator"])?c:null))for(e=d.call(e),d=0;!(r=e.next()).done;)l+=Ic(r=r.value,t,n,a=u+Ec(r,d++),i);else if("object"===a){if("function"==typeof e.then)return Ic(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"==typeof e.status?e.then(Nc,Nc):(e.status="pending",e.then(function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)},function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(e),t,n,r,i);throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return l}function Ac(e,t,n){if(null==e)return e;var r=[],i=0;return Ic(e,r,"","",function(e){return t.call(n,e,i++)}),r}function kc(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var Tc="function"==typeof reportError?reportError:function(e){if("object"==typeof window&&"function"==typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"==typeof e&&null!==e&&"string"==typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"==typeof process&&"function"==typeof process.emit)return void process.emit("uncaughtException",e)};function Cc(){}Jl.Children={map:Ac,forEach:function(e,t,n){Ac(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return Ac(e,function(){t++}),t},toArray:function(e){return Ac(e,function(e){return e})||[]},only:function(e){if(!vc(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},Jl.Component=fc,Jl.Fragment=ec,Jl.Profiler=nc,Jl.PureComponent=gc,Jl.StrictMode=tc,Jl.Suspense=oc,Jl.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=yc,Jl.__COMPILER_RUNTIME={__proto__:null,c:function(e){return yc.H.useMemoCache(e)}},Jl.cache=function(e){return function(){return e.apply(null,arguments)}},Jl.cloneElement=function(e,t,n){if(null==e)throw Error("The argument must be a React element, but you passed "+e+".");var r=dc({},e.props),i=e.key;if(null!=t)for(a in t.ref,void 0!==t.key&&(i=""+t.key),t)!xc.call(t,a)||"key"===a||"__self"===a||"__source"===a||"ref"===a&&void 0===t.ref||(r[a]=t[a]);var a=arguments.length-2;if(1===a)r.children=n;else if(1<a){for(var o=Array(a),s=0;s<a;s++)o[s]=arguments[s+2];r.children=o}return wc(e.type,i,void 0,0,0,r)},Jl.createContext=function(e){return(e={$$typeof:ic,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:rc,_context:e},e},Jl.createElement=function(e,t,n){var r,i={},a=null;if(null!=t)for(r in void 0!==t.key&&(a=""+t.key),t)xc.call(t,r)&&"key"!==r&&"__self"!==r&&"__source"!==r&&(i[r]=t[r]);var o=arguments.length-2;if(1===o)i.children=n;else if(1<o){for(var s=Array(o),l=0;l<o;l++)s[l]=arguments[l+2];i.children=s}if(e&&e.defaultProps)for(r in o=e.defaultProps)void 0===i[r]&&(i[r]=o[r]);return wc(e,a,void 0,0,0,i)},Jl.createRef=function(){return{current:null}},Jl.forwardRef=function(e){return{$$typeof:ac,render:e}},Jl.isValidElement=vc,Jl.lazy=function(e){return{$$typeof:lc,_payload:{_status:-1,_result:e},_init:kc}},Jl.memo=function(e,t){return{$$typeof:sc,type:e,compare:void 0===t?null:t}},Jl.startTransition=function(e){var t=yc.T,n={};yc.T=n;try{var r=e(),i=yc.S;null!==i&&i(n,r),"object"==typeof r&&null!==r&&"function"==typeof r.then&&r.then(Cc,Tc)}catch(tn){Tc(tn)}finally{yc.T=t}},Jl.unstable_useCacheRefresh=function(){return yc.H.useCacheRefresh()},Jl.use=function(e){return yc.H.use(e)},Jl.useActionState=function(e,t,n){return yc.H.useActionState(e,t,n)},Jl.useCallback=function(e,t){return yc.H.useCallback(e,t)},Jl.useContext=function(e){return yc.H.useContext(e)},Jl.useDebugValue=function(){},Jl.useDeferredValue=function(e,t){return yc.H.useDeferredValue(e,t)},Jl.useEffect=function(e,t,n){var r=yc.H;if("function"==typeof n)throw Error("useEffect CRUD overload is not enabled in this build of React.");return r.useEffect(e,t)},Jl.useId=function(){return yc.H.useId()},Jl.useImperativeHandle=function(e,t,n){return yc.H.useImperativeHandle(e,t,n)},Jl.useInsertionEffect=function(e,t){return yc.H.useInsertionEffect(e,t)},Jl.useLayoutEffect=function(e,t){return yc.H.useLayoutEffect(e,t)},Jl.useMemo=function(e,t){return yc.H.useMemo(e,t)},Jl.useOptimistic=function(e,t){return yc.H.useOptimistic(e,t)},Jl.useReducer=function(e,t,n){return yc.H.useReducer(e,t,n)},Jl.useRef=function(e){return yc.H.useRef(e)},Jl.useState=function(e){return yc.H.useState(e)},Jl.useSyncExternalStore=function(e,t,n){return yc.H.useSyncExternalStore(e,t,n)},Jl.useTransition=function(){return yc.H.useTransition()},Jl.version="19.1.1",Yl.exports=Jl;var Bc=Yl.exports;const Pc=r(Bc);var _c={exports:{}},Oc={},Lc={exports:{}},Fc={};!function(e){function t(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,a=e[r];if(!(0<i(a,t)))break e;e[r]=t,e[n]=a,n=r}}function n(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,a=e.length,o=a>>>1;r<o;){var s=2*(r+1)-1,l=e[s],c=s+1,u=e[c];if(0>i(l,n))c<a&&0>i(u,l)?(e[r]=u,e[c]=n,r=c):(e[r]=l,e[s]=n,r=s);else{if(!(c<a&&0>i(u,n)))break e;e[r]=u,e[c]=n,r=c}}}return t}function i(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if(e.unstable_now=void 0,"object"==typeof performance&&"function"==typeof performance.now){var a=performance;e.unstable_now=function(){return a.now()}}else{var o=Date,s=o.now();e.unstable_now=function(){return o.now()-s}}var l=[],c=[],u=1,d=null,p=3,f=!1,m=!1,g=!1,h=!1,b="function"==typeof setTimeout?setTimeout:null,y="function"==typeof clearTimeout?clearTimeout:null,x="undefined"!=typeof setImmediate?setImmediate:null;function w(e){for(var i=n(c);null!==i;){if(null===i.callback)r(c);else{if(!(i.startTime<=e))break;r(c),i.sortIndex=i.expirationTime,t(l,i)}i=n(c)}}function v(e){if(g=!1,w(e),!m)if(null!==n(l))m=!0,E||(E=!0,S());else{var t=n(c);null!==t&&P(v,t.startTime-e)}}var S,E=!1,N=-1,I=5,A=-1;function k(){return!(!h&&e.unstable_now()-A<I)}function T(){if(h=!1,E){var t=e.unstable_now();A=t;var i=!0;try{e:{m=!1,g&&(g=!1,y(N),N=-1),f=!0;var a=p;try{t:{for(w(t),d=n(l);null!==d&&!(d.expirationTime>t&&k());){var o=d.callback;if("function"==typeof o){d.callback=null,p=d.priorityLevel;var s=o(d.expirationTime<=t);if(t=e.unstable_now(),"function"==typeof s){d.callback=s,w(t),i=!0;break t}d===n(l)&&r(l),w(t)}else r(l);d=n(l)}if(null!==d)i=!0;else{var u=n(c);null!==u&&P(v,u.startTime-t),i=!1}}break e}finally{d=null,p=a,f=!1}i=void 0}}finally{i?S():E=!1}}}if("function"==typeof x)S=function(){x(T)};else if("undefined"!=typeof MessageChannel){var C=new MessageChannel,B=C.port2;C.port1.onmessage=T,S=function(){B.postMessage(null)}}else S=function(){b(T,0)};function P(t,n){N=b(function(){t(e.unstable_now())},n)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(e){e.callback=null},e.unstable_forceFrameRate=function(e){0>e||125<e||(I=0<e?Math.floor(1e3/e):5)},e.unstable_getCurrentPriorityLevel=function(){return p},e.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},e.unstable_requestPaint=function(){h=!0},e.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},e.unstable_scheduleCallback=function(r,i,a){var o=e.unstable_now();switch(a="object"==typeof a&&null!==a&&"number"==typeof(a=a.delay)&&0<a?o+a:o,r){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return r={id:u++,callback:i,priorityLevel:r,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>o?(r.sortIndex=a,t(c,r),null===n(l)&&r===n(c)&&(g?(y(N),N=-1):g=!0,P(v,a-o))):(r.sortIndex=s,t(l,r),m||f||(m=!0,E||(E=!0,S()))),r},e.unstable_shouldYield=k,e.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}}(Fc),Lc.exports=Fc;var Mc=Lc.exports,Rc={exports:{}},$c={},Uc=Bc;function zc(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function Dc(){}var Hc={d:{f:Dc,r:function(){throw Error(zc(522))},D:Dc,C:Dc,L:Dc,m:Dc,X:Dc,S:Dc,M:Dc},p:0,findDOMNode:null},Wc=Symbol.for("react.portal"),jc=Uc.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function Vc(e,t){return"font"===e?"":"string"==typeof t?"use-credentials"===t?t:"":void 0}$c.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Hc,$c.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)throw Error(zc(299));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:Wc,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},$c.flushSync=function(e){var t=jc.T,n=Hc.p;try{if(jc.T=null,Hc.p=2,e)return e()}finally{jc.T=t,Hc.p=n,Hc.d.f()}},$c.preconnect=function(e,t){"string"==typeof e&&(t=t?"string"==typeof(t=t.crossOrigin)?"use-credentials"===t?t:"":void 0:null,Hc.d.C(e,t))},$c.prefetchDNS=function(e){"string"==typeof e&&Hc.d.D(e)},$c.preinit=function(e,t){if("string"==typeof e&&t&&"string"==typeof t.as){var n=t.as,r=Vc(n,t.crossOrigin),i="string"==typeof t.integrity?t.integrity:void 0,a="string"==typeof t.fetchPriority?t.fetchPriority:void 0;"style"===n?Hc.d.S(e,"string"==typeof t.precedence?t.precedence:void 0,{crossOrigin:r,integrity:i,fetchPriority:a}):"script"===n&&Hc.d.X(e,{crossOrigin:r,integrity:i,fetchPriority:a,nonce:"string"==typeof t.nonce?t.nonce:void 0})}},$c.preinitModule=function(e,t){if("string"==typeof e)if("object"==typeof t&&null!==t){if(null==t.as||"script"===t.as){var n=Vc(t.as,t.crossOrigin);Hc.d.M(e,{crossOrigin:n,integrity:"string"==typeof t.integrity?t.integrity:void 0,nonce:"string"==typeof t.nonce?t.nonce:void 0})}}else null==t&&Hc.d.M(e)},$c.preload=function(e,t){if("string"==typeof e&&"object"==typeof t&&null!==t&&"string"==typeof t.as){var n=t.as,r=Vc(n,t.crossOrigin);Hc.d.L(e,n,{crossOrigin:r,integrity:"string"==typeof t.integrity?t.integrity:void 0,nonce:"string"==typeof t.nonce?t.nonce:void 0,type:"string"==typeof t.type?t.type:void 0,fetchPriority:"string"==typeof t.fetchPriority?t.fetchPriority:void 0,referrerPolicy:"string"==typeof t.referrerPolicy?t.referrerPolicy:void 0,imageSrcSet:"string"==typeof t.imageSrcSet?t.imageSrcSet:void 0,imageSizes:"string"==typeof t.imageSizes?t.imageSizes:void 0,media:"string"==typeof t.media?t.media:void 0})}},$c.preloadModule=function(e,t){if("string"==typeof e)if(t){var n=Vc(t.as,t.crossOrigin);Hc.d.m(e,{as:"string"==typeof t.as&&"script"!==t.as?t.as:void 0,crossOrigin:n,integrity:"string"==typeof t.integrity?t.integrity:void 0})}else Hc.d.m(e)},$c.requestFormReset=function(e){Hc.d.r(e)},$c.unstable_batchedUpdates=function(e,t){return e(t)},$c.useFormState=function(e,t,n){return jc.H.useFormState(e,t,n)},$c.useFormStatus=function(){return jc.H.useHostTransitionStatus()},$c.version="19.1.1",function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){}}(),Rc.exports=$c;var qc=Rc.exports;const Xc=r(qc);var Kc=Mc,Gc=Bc,Yc=qc;function Jc(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function Qc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Zc(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{!!(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function eu(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&null!==(e=e.alternate)&&(t=e.memoizedState),null!==t)return t.dehydrated}return null}function tu(e){if(Zc(e)!==e)throw Error(Jc(188))}function nu(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e;for(e=e.child;null!==e;){if(null!==(t=nu(e)))return t;e=e.sibling}return null}var ru=Object.assign,iu=Symbol.for("react.element"),au=Symbol.for("react.transitional.element"),ou=Symbol.for("react.portal"),su=Symbol.for("react.fragment"),lu=Symbol.for("react.strict_mode"),cu=Symbol.for("react.profiler"),uu=Symbol.for("react.provider"),du=Symbol.for("react.consumer"),pu=Symbol.for("react.context"),fu=Symbol.for("react.forward_ref"),mu=Symbol.for("react.suspense"),gu=Symbol.for("react.suspense_list"),hu=Symbol.for("react.memo"),bu=Symbol.for("react.lazy"),yu=Symbol.for("react.activity"),xu=Symbol.for("react.memo_cache_sentinel"),wu=Symbol.iterator;function vu(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=wu&&e[wu]||e["@@iterator"])?e:null}var Su=Symbol.for("react.client.reference");function Eu(e){if(null==e)return null;if("function"==typeof e)return e.$$typeof===Su?null:e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case su:return"Fragment";case cu:return"Profiler";case lu:return"StrictMode";case mu:return"Suspense";case gu:return"SuspenseList";case yu:return"Activity"}if("object"==typeof e)switch(e.$$typeof){case ou:return"Portal";case pu:return(e.displayName||"Context")+".Provider";case du:return(e._context.displayName||"Context")+".Consumer";case fu:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case hu:return null!==(t=e.displayName||null)?t:Eu(e.type)||"Memo";case bu:t=e._payload,e=e._init;try{return Eu(e(t))}catch(n){}}return null}var Nu=Array.isArray,Iu=Gc.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Au=Yc.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ku={pending:!1,data:null,method:null,action:null},Tu=[],Cu=-1;function Bu(e){return{current:e}}function Pu(e){0>Cu||(e.current=Tu[Cu],Tu[Cu]=null,Cu--)}function _u(e,t){Cu++,Tu[Cu]=e.current,e.current=t}var Ou=Bu(null),Lu=Bu(null),Fu=Bu(null),Mu=Bu(null);function Ru(e,t){switch(_u(Fu,t),_u(Lu,e),_u(Ou,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?Kv(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)e=Gv(t=Kv(t),e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}Pu(Ou),_u(Ou,e)}function $u(){Pu(Ou),Pu(Lu),Pu(Fu)}function Uu(e){null!==e.memoizedState&&_u(Mu,e);var t=Ou.current,n=Gv(t,e.type);t!==n&&(_u(Lu,e),_u(Ou,n))}function zu(e){Lu.current===e&&(Pu(Ou),Pu(Lu)),Mu.current===e&&(Pu(Mu),$S._currentValue=ku)}var Du=Object.prototype.hasOwnProperty,Hu=Kc.unstable_scheduleCallback,Wu=Kc.unstable_cancelCallback,ju=Kc.unstable_shouldYield,Vu=Kc.unstable_requestPaint,qu=Kc.unstable_now,Xu=Kc.unstable_getCurrentPriorityLevel,Ku=Kc.unstable_ImmediatePriority,Gu=Kc.unstable_UserBlockingPriority,Yu=Kc.unstable_NormalPriority,Ju=Kc.unstable_LowPriority,Qu=Kc.unstable_IdlePriority,Zu=Kc.log,ed=Kc.unstable_setDisableYieldValue,td=null,nd=null;function rd(e){if("function"==typeof Zu&&ed(e),nd&&"function"==typeof nd.setStrictMode)try{nd.setStrictMode(td,e)}catch(t){}}var id=Math.clz32?Math.clz32:function(e){return 0==(e>>>=0)?32:31-(ad(e)/od|0)|0},ad=Math.log,od=Math.LN2,sd=256,ld=4194304;function cd(e){var t=42&e;if(0!==t)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194048&e;case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&e;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function ud(e,t,n){var r=e.pendingLanes;if(0===r)return 0;var i=0,a=e.suspendedLanes,o=e.pingedLanes;e=e.warmLanes;var s=134217727&r;return 0!==s?0!==(r=s&~a)?i=cd(r):0!==(o&=s)?i=cd(o):n||0!==(n=s&~e)&&(i=cd(n)):0!==(s=r&~a)?i=cd(s):0!==o?i=cd(o):n||0!==(n=r&~e)&&(i=cd(n)),0===i?0:0!==t&&t!==i&&0===(t&a)&&((a=i&-i)>=(n=t&-t)||32===a&&4194048&n)?t:i}function dd(e,t){return 0===(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)}function pd(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function fd(){var e=sd;return!(4194048&(sd<<=1))&&(sd=256),e}function md(){var e=ld;return!(62914560&(ld<<=1))&&(ld=4194304),e}function gd(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function hd(e,t){e.pendingLanes|=t,268435456!==t&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function bd(e,t,n){e.pendingLanes|=t,e.suspendedLanes&=~t;var r=31-id(t);e.entangledLanes|=t,e.entanglements[r]=1073741824|e.entanglements[r]|4194090&n}function yd(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-id(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}function xd(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function wd(e){return 2<(e&=-e)?8<e?134217727&e?32:268435456:8:2}function vd(){var e=Au.p;return 0!==e?e:void 0===(e=window.event)?32:ZS(e.type)}var Sd=Math.random().toString(36).slice(2),Ed="__reactFiber$"+Sd,Nd="__reactProps$"+Sd,Id="__reactContainer$"+Sd,Ad="__reactEvents$"+Sd,kd="__reactListeners$"+Sd,Td="__reactHandles$"+Sd,Cd="__reactResources$"+Sd,Bd="__reactMarker$"+Sd;function Pd(e){delete e[Ed],delete e[Nd],delete e[Ad],delete e[kd],delete e[Td]}function _d(e){var t=e[Ed];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Id]||n[Ed]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=cS(e);null!==e;){if(n=e[Ed])return n;e=cS(e)}return t}n=(e=n).parentNode}return null}function Od(e){if(e=e[Ed]||e[Id]){var t=e.tag;if(5===t||6===t||13===t||26===t||27===t||3===t)return e}return null}function Ld(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e.stateNode;throw Error(Jc(33))}function Fd(e){var t=e[Cd];return t||(t=e[Cd]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function Md(e){e[Bd]=!0}var Rd=new Set,$d={};function Ud(e,t){zd(e,t),zd(e+"Capture",t)}function zd(e,t){for($d[e]=t,e=0;e<t.length;e++)Rd.add(t[e])}var Dd,Hd,Wd=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),jd={},Vd={};function qd(e,t,n){if(i=t,Du.call(Vd,i)||!Du.call(jd,i)&&(Wd.test(i)?Vd[i]=!0:(jd[i]=!0,0)))if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":return void e.removeAttribute(t);case"boolean":var r=t.toLowerCase().slice(0,5);if("data-"!==r&&"aria-"!==r)return void e.removeAttribute(t)}e.setAttribute(t,""+n)}var i}function Xd(e,t,n){if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(t)}e.setAttribute(t,""+n)}}function Kd(e,t,n,r){if(null===r)e.removeAttribute(n);else{switch(typeof r){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(n)}e.setAttributeNS(t,n,""+r)}}function Gd(e){if(void 0===Dd)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);Dd=t&&t[1]||"",Hd=-1<n.stack.indexOf("\n    at")?" (<anonymous>)":-1<n.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+Dd+e+Hd}var Yd=!1;function Jd(e,t){if(!e||Yd)return"";Yd=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var r={DetermineComponentFrameRoot:function(){try{if(t){var n=function(){throw Error()};if(Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(n,[])}catch(i){var r=i}Reflect.construct(e,[],n)}else{try{n.call()}catch(a){r=a}e.call(n.prototype)}}else{try{throw Error()}catch(o){r=o}(n=e())&&"function"==typeof n.catch&&n.catch(function(){})}}catch(s){if(s&&r&&"string"==typeof s.stack)return[s.stack,r.stack]}return[null,null]}};r.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var i=Object.getOwnPropertyDescriptor(r.DetermineComponentFrameRoot,"name");i&&i.configurable&&Object.defineProperty(r.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var a=r.DetermineComponentFrameRoot(),o=a[0],s=a[1];if(o&&s){var l=o.split("\n"),c=s.split("\n");for(i=r=0;r<l.length&&!l[r].includes("DetermineComponentFrameRoot");)r++;for(;i<c.length&&!c[i].includes("DetermineComponentFrameRoot");)i++;if(r===l.length||i===c.length)for(r=l.length-1,i=c.length-1;1<=r&&0<=i&&l[r]!==c[i];)i--;for(;1<=r&&0<=i;r--,i--)if(l[r]!==c[i]){if(1!==r||1!==i)do{if(r--,0>--i||l[r]!==c[i]){var u="\n"+l[r].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=r&&0<=i);break}}}finally{Yd=!1,Error.prepareStackTrace=n}return(n=e?e.displayName||e.name:"")?Gd(n):""}function Qd(e){switch(e.tag){case 26:case 27:case 5:return Gd(e.type);case 16:return Gd("Lazy");case 13:return Gd("Suspense");case 19:return Gd("SuspenseList");case 0:case 15:return Jd(e.type,!1);case 11:return Jd(e.type.render,!1);case 1:return Jd(e.type,!0);case 31:return Gd("Activity");default:return""}}function Zd(e){try{var t="";do{t+=Qd(e),e=e.return}while(e);return t}catch(n){return"\nError generating stack: "+n.message+"\n"+n.stack}}function ep(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function tp(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function np(e){e._valueTracker||(e._valueTracker=function(e){var t=tp(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var i=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function rp(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=tp(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function ip(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}var ap=/[\n"\\]/g;function op(e){return e.replace(ap,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function sp(e,t,n,r,i,a,o,s){e.name="",null!=o&&"function"!=typeof o&&"symbol"!=typeof o&&"boolean"!=typeof o?e.type=o:e.removeAttribute("type"),null!=t?"number"===o?(0===t&&""===e.value||e.value!=t)&&(e.value=""+ep(t)):e.value!==""+ep(t)&&(e.value=""+ep(t)):"submit"!==o&&"reset"!==o||e.removeAttribute("value"),null!=t?cp(e,o,ep(t)):null!=n?cp(e,o,ep(n)):null!=r&&e.removeAttribute("value"),null==i&&null!=a&&(e.defaultChecked=!!a),null!=i&&(e.checked=i&&"function"!=typeof i&&"symbol"!=typeof i),null!=s&&"function"!=typeof s&&"symbol"!=typeof s&&"boolean"!=typeof s?e.name=""+ep(s):e.removeAttribute("name")}function lp(e,t,n,r,i,a,o,s){if(null!=a&&"function"!=typeof a&&"symbol"!=typeof a&&"boolean"!=typeof a&&(e.type=a),null!=t||null!=n){if(("submit"===a||"reset"===a)&&null==t)return;n=null!=n?""+ep(n):"",t=null!=t?""+ep(t):n,s||t===e.value||(e.value=t),e.defaultValue=t}r="function"!=typeof(r=null!=r?r:i)&&"symbol"!=typeof r&&!!r,e.checked=s?e.checked:!!r,e.defaultChecked=!!r,null!=o&&"function"!=typeof o&&"symbol"!=typeof o&&"boolean"!=typeof o&&(e.name=o)}function cp(e,t,n){"number"===t&&ip(e.ownerDocument)===e||e.defaultValue===""+n||(e.defaultValue=""+n)}function up(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+ep(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function dp(e,t,n){null==t||((t=""+ep(t))!==e.value&&(e.value=t),null!=n)?e.defaultValue=null!=n?""+ep(n):"":e.defaultValue!==t&&(e.defaultValue=t)}function pp(e,t,n,r){if(null==t){if(null!=r){if(null!=n)throw Error(Jc(92));if(Nu(r)){if(1<r.length)throw Error(Jc(93));r=r[0]}n=r}null==n&&(n=""),t=n}n=ep(t),e.defaultValue=n,(r=e.textContent)===n&&""!==r&&null!==r&&(e.value=r)}function fp(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var mp=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function gp(e,t,n){var r=0===t.indexOf("--");null==n||"boolean"==typeof n||""===n?r?e.setProperty(t,""):"float"===t?e.cssFloat="":e[t]="":r?e.setProperty(t,n):"number"!=typeof n||0===n||mp.has(t)?"float"===t?e.cssFloat=n:e[t]=(""+n).trim():e[t]=n+"px"}function hp(e,t,n){if(null!=t&&"object"!=typeof t)throw Error(Jc(62));if(e=e.style,null!=n){for(var r in n)!n.hasOwnProperty(r)||null!=t&&t.hasOwnProperty(r)||(0===r.indexOf("--")?e.setProperty(r,""):"float"===r?e.cssFloat="":e[r]="");for(var i in t)r=t[i],t.hasOwnProperty(i)&&n[i]!==r&&gp(e,i,r)}else for(var a in t)t.hasOwnProperty(a)&&gp(e,a,t[a])}function bp(e){if(-1===e.indexOf("-"))return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var yp=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),xp=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function wp(e){return xp.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var vp=null;function Sp(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Ep=null,Np=null;function Ip(e){var t=Od(e);if(t&&(e=t.stateNode)){var n=e[Nd]||null;e:switch(e=t.stateNode,t.type){case"input":if(sp(e,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll('input[name="'+op(""+t)+'"][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=r[Nd]||null;if(!i)throw Error(Jc(90));sp(r,i.value,i.defaultValue,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name)}}for(t=0;t<n.length;t++)(r=n[t]).form===e.form&&rp(r)}break e;case"textarea":dp(e,n.value,n.defaultValue);break e;case"select":null!=(t=n.value)&&up(e,!!n.multiple,t,!1)}}}var Ap=!1;function kp(e,t,n){if(Ap)return e(t,n);Ap=!0;try{return e(t)}finally{if(Ap=!1,(null!==Ep||null!==Np)&&(Pw(),Ep&&(t=Ep,e=Np,Np=Ep=null,Ip(t),e)))for(t=0;t<e.length;t++)Ip(e[t])}}function Tp(e,t){var n=e.stateNode;if(null===n)return null;var r=n[Nd]||null;if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!=typeof n)throw Error(Jc(231,t,typeof n));return n}var Cp=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),Bp=!1;if(Cp)try{var Pp={};Object.defineProperty(Pp,"passive",{get:function(){Bp=!0}}),window.addEventListener("test",Pp,Pp),window.removeEventListener("test",Pp,Pp)}catch(Pk){Bp=!1}var _p=null,Op=null,Lp=null;function Fp(){if(Lp)return Lp;var e,t,n=Op,r=n.length,i="value"in _p?_p.value:_p.textContent,a=i.length;for(e=0;e<r&&n[e]===i[e];e++);var o=r-e;for(t=1;t<=o&&n[r-t]===i[a-t];t++);return Lp=i.slice(e,1<t?1-t:void 0)}function Mp(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function Rp(){return!0}function $p(){return!1}function Up(e){function t(t,n,r,i,a){for(var o in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(i):i[o]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?Rp:$p,this.isPropagationStopped=$p,this}return ru(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=Rp)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=Rp)},persist:function(){},isPersistent:Rp}),t}var zp,Dp,Hp,Wp={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},jp=Up(Wp),Vp=ru({},Wp,{view:0,detail:0}),qp=Up(Vp),Xp=ru({},Vp,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:af,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Hp&&(Hp&&"mousemove"===e.type?(zp=e.screenX-Hp.screenX,Dp=e.screenY-Hp.screenY):Dp=zp=0,Hp=e),zp)},movementY:function(e){return"movementY"in e?e.movementY:Dp}}),Kp=Up(Xp),Gp=Up(ru({},Xp,{dataTransfer:0})),Yp=Up(ru({},Vp,{relatedTarget:0})),Jp=Up(ru({},Wp,{animationName:0,elapsedTime:0,pseudoElement:0})),Qp=Up(ru({},Wp,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),Zp=Up(ru({},Wp,{data:0})),ef={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},tf={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},nf={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function rf(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=nf[e])&&!!t[e]}function af(){return rf}var of=Up(ru({},Vp,{key:function(e){if(e.key){var t=ef[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=Mp(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?tf[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:af,charCode:function(e){return"keypress"===e.type?Mp(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?Mp(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),sf=Up(ru({},Xp,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),lf=Up(ru({},Vp,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:af})),cf=Up(ru({},Wp,{propertyName:0,elapsedTime:0,pseudoElement:0})),uf=Up(ru({},Xp,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),df=Up(ru({},Wp,{newState:0,oldState:0})),pf=[9,13,27,32],ff=Cp&&"CompositionEvent"in window,mf=null;Cp&&"documentMode"in document&&(mf=document.documentMode);var gf=Cp&&"TextEvent"in window&&!mf,hf=Cp&&(!ff||mf&&8<mf&&11>=mf),bf=String.fromCharCode(32),yf=!1;function xf(e,t){switch(e){case"keyup":return-1!==pf.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function wf(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var vf=!1,Sf={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ef(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Sf[e.type]:"textarea"===t}function Nf(e,t,n,r){Ep?Np?Np.push(r):Np=[r]:Ep=r,0<(t=Lv(t,"onChange")).length&&(n=new jp("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var If=null,Af=null;function kf(e){Av(e,0)}function Tf(e){if(rp(Ld(e)))return e}function Cf(e,t){if("change"===e)return t}var Bf=!1;if(Cp){var Pf;if(Cp){var _f="oninput"in document;if(!_f){var Of=document.createElement("div");Of.setAttribute("oninput","return;"),_f="function"==typeof Of.oninput}Pf=_f}else Pf=!1;Bf=Pf&&(!document.documentMode||9<document.documentMode)}function Lf(){If&&(If.detachEvent("onpropertychange",Ff),Af=If=null)}function Ff(e){if("value"===e.propertyName&&Tf(Af)){var t=[];Nf(t,Af,e,Sp(e)),kp(kf,t)}}function Mf(e,t,n){"focusin"===e?(Lf(),Af=n,(If=t).attachEvent("onpropertychange",Ff)):"focusout"===e&&Lf()}function Rf(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Tf(Af)}function $f(e,t){if("click"===e)return Tf(t)}function Uf(e,t){if("input"===e||"change"===e)return Tf(t)}var zf="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t};function Df(e,t){if(zf(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!Du.call(t,i)||!zf(e[i],t[i]))return!1}return!0}function Hf(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Wf(e,t){var n,r=Hf(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=Hf(r)}}function jf(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?jf(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function Vf(e){for(var t=ip((e=null!=e&&null!=e.ownerDocument&&null!=e.ownerDocument.defaultView?e.ownerDocument.defaultView:window).document);t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=ip((e=t.contentWindow).document)}return t}function qf(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var Xf=Cp&&"documentMode"in document&&11>=document.documentMode,Kf=null,Gf=null,Yf=null,Jf=!1;function Qf(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;Jf||null==Kf||Kf!==ip(r)||(r="selectionStart"in(r=Kf)&&qf(r)?{start:r.selectionStart,end:r.selectionEnd}:{anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},Yf&&Df(Yf,r)||(Yf=r,0<(r=Lv(Gf,"onSelect")).length&&(t=new jp("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=Kf)))}function Zf(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var em={animationend:Zf("Animation","AnimationEnd"),animationiteration:Zf("Animation","AnimationIteration"),animationstart:Zf("Animation","AnimationStart"),transitionrun:Zf("Transition","TransitionRun"),transitionstart:Zf("Transition","TransitionStart"),transitioncancel:Zf("Transition","TransitionCancel"),transitionend:Zf("Transition","TransitionEnd")},tm={},nm={};function rm(e){if(tm[e])return tm[e];if(!em[e])return e;var t,n=em[e];for(t in n)if(n.hasOwnProperty(t)&&t in nm)return tm[e]=n[t];return e}Cp&&(nm=document.createElement("div").style,"AnimationEvent"in window||(delete em.animationend.animation,delete em.animationiteration.animation,delete em.animationstart.animation),"TransitionEvent"in window||delete em.transitionend.transition);var im=rm("animationend"),am=rm("animationiteration"),om=rm("animationstart"),sm=rm("transitionrun"),lm=rm("transitionstart"),cm=rm("transitioncancel"),um=rm("transitionend"),dm=new Map,pm="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function fm(e,t){dm.set(e,t),Ud(t,[e])}pm.push("scrollEnd");var mm=new WeakMap;function gm(e,t){if("object"==typeof e&&null!==e){var n=mm.get(e);return void 0!==n?n:(t={value:e,source:t,stack:Zd(t)},mm.set(e,t),t)}return{value:e,source:t,stack:Zd(t)}}var hm=[],bm=0,ym=0;function xm(){for(var e=bm,t=ym=bm=0;t<e;){var n=hm[t];hm[t++]=null;var r=hm[t];hm[t++]=null;var i=hm[t];hm[t++]=null;var a=hm[t];if(hm[t++]=null,null!==r&&null!==i){var o=r.pending;null===o?i.next=i:(i.next=o.next,o.next=i),r.pending=i}0!==a&&Em(n,i,a)}}function wm(e,t,n,r){hm[bm++]=e,hm[bm++]=t,hm[bm++]=n,hm[bm++]=r,ym|=r,e.lanes|=r,null!==(e=e.alternate)&&(e.lanes|=r)}function vm(e,t,n,r){return wm(e,t,n,r),Nm(e)}function Sm(e,t){return wm(e,null,null,t),Nm(e)}function Em(e,t,n){e.lanes|=n;var r=e.alternate;null!==r&&(r.lanes|=n);for(var i=!1,a=e.return;null!==a;)a.childLanes|=n,null!==(r=a.alternate)&&(r.childLanes|=n),22===a.tag&&(null===(e=a.stateNode)||1&e._visibility||(i=!0)),e=a,a=a.return;return 3===e.tag?(a=e.stateNode,i&&null!==t&&(i=31-id(n),null===(r=(e=a.hiddenUpdates)[i])?e[i]=[t]:r.push(t),t.lane=536870912|n),a):null}function Nm(e){if(50<Sw)throw Sw=0,Ew=null,Error(Jc(185));for(var t=e.return;null!==t;)t=(e=t).return;return 3===e.tag?e.stateNode:null}var Im={};function Am(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function km(e,t,n,r){return new Am(e,t,n,r)}function Tm(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Cm(e,t){var n=e.alternate;return null===n?((n=km(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=65011712&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n.refCleanup=e.refCleanup,n}function Bm(e,t){e.flags&=65011714;var n=e.alternate;return null===n?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=n.childLanes,e.lanes=n.lanes,e.child=n.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,e.type=n.type,t=n.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function Pm(e,t,n,r,i,a){var o=0;if(r=e,"function"==typeof e)Tm(e)&&(o=1);else if("string"==typeof e)o=function(e,t){if(1===Ou.current||null!=t.itemProp)return!1;switch(e){case"meta":case"title":return!0;case"style":if("string"!=typeof t.precedence||"string"!=typeof t.href||""===t.href)break;return!0;case"link":if("string"!=typeof t.rel||"string"!=typeof t.href||""===t.href||t.onLoad||t.onError)break;return"stylesheet"!==t.rel||(e=t.disabled,"string"==typeof t.precedence&&null==e);case"script":if(t.async&&"function"!=typeof t.async&&"symbol"!=typeof t.async&&!t.onLoad&&!t.onError&&t.src&&"string"==typeof t.src)return!0}return!1}(e,n)?26:"html"===e||"head"===e||"body"===e?27:5;else e:switch(e){case yu:return(e=km(31,n,t,i)).elementType=yu,e.lanes=a,e;case su:return _m(n.children,i,a,t);case lu:o=8,i|=24;break;case cu:return(e=km(12,n,t,2|i)).elementType=cu,e.lanes=a,e;case mu:return(e=km(13,n,t,i)).elementType=mu,e.lanes=a,e;case gu:return(e=km(19,n,t,i)).elementType=gu,e.lanes=a,e;default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case uu:case pu:o=10;break e;case du:o=9;break e;case fu:o=11;break e;case hu:o=14;break e;case bu:o=16,r=null;break e}o=29,n=Error(Jc(130,null===e?"null":typeof e,"")),r=null}return(t=km(o,n,t,i)).elementType=e,t.type=r,t.lanes=a,t}function _m(e,t,n,r){return(e=km(7,e,r,t)).lanes=n,e}function Om(e,t,n){return(e=km(6,e,null,t)).lanes=n,e}function Lm(e,t,n){return(t=km(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var Fm=[],Mm=0,Rm=null,$m=0,Um=[],zm=0,Dm=null,Hm=1,Wm="";function jm(e,t){Fm[Mm++]=$m,Fm[Mm++]=Rm,Rm=e,$m=t}function Vm(e,t,n){Um[zm++]=Hm,Um[zm++]=Wm,Um[zm++]=Dm,Dm=e;var r=Hm;e=Wm;var i=32-id(r)-1;r&=~(1<<i),n+=1;var a=32-id(t)+i;if(30<a){var o=i-i%5;a=(r&(1<<o)-1).toString(32),r>>=o,i-=o,Hm=1<<32-id(t)+i|n<<i|r,Wm=a+e}else Hm=1<<a|n<<i|r,Wm=e}function qm(e){null!==e.return&&(jm(e,1),Vm(e,1,0))}function Xm(e){for(;e===Rm;)Rm=Fm[--Mm],Fm[Mm]=null,$m=Fm[--Mm],Fm[Mm]=null;for(;e===Dm;)Dm=Um[--zm],Um[zm]=null,Wm=Um[--zm],Um[zm]=null,Hm=Um[--zm],Um[zm]=null}var Km=null,Gm=null,Ym=!1,Jm=null,Qm=!1,Zm=Error(Jc(519));function eg(e){throw og(gm(Error(Jc(418,"")),e)),Zm}function tg(e){var t=e.stateNode,n=e.type,r=e.memoizedProps;switch(t[Ed]=e,t[Nd]=r,n){case"dialog":kv("cancel",t),kv("close",t);break;case"iframe":case"object":case"embed":kv("load",t);break;case"video":case"audio":for(n=0;n<Nv.length;n++)kv(Nv[n],t);break;case"source":kv("error",t);break;case"img":case"image":case"link":kv("error",t),kv("load",t);break;case"details":kv("toggle",t);break;case"input":kv("invalid",t),lp(t,r.value,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name,!0),np(t);break;case"select":kv("invalid",t);break;case"textarea":kv("invalid",t),pp(t,r.value,r.defaultValue,r.children),np(t)}"string"!=typeof(n=r.children)&&"number"!=typeof n&&"bigint"!=typeof n||t.textContent===""+n||!0===r.suppressHydrationWarning||zv(t.textContent,n)?(null!=r.popover&&(kv("beforetoggle",t),kv("toggle",t)),null!=r.onScroll&&kv("scroll",t),null!=r.onScrollEnd&&kv("scrollend",t),null!=r.onClick&&(t.onclick=Dv),t=!0):t=!1,t||eg(e)}function ng(e){for(Km=e.return;Km;)switch(Km.tag){case 5:case 13:return void(Qm=!1);case 27:case 3:return void(Qm=!0);default:Km=Km.return}}function rg(e){if(e!==Km)return!1;if(!Ym)return ng(e),Ym=!0,!1;var t,n=e.tag;if((t=3!==n&&27!==n)&&((t=5===n)&&(t=!("form"!==(t=e.type)&&"button"!==t)||Yv(e.type,e.memoizedProps)),t=!t),t&&Gm&&eg(e),ng(e),13===n){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(Jc(317));e:{for(e=e.nextSibling,n=0;e;){if(8===e.nodeType)if("/$"===(t=e.data)){if(0===n){Gm=sS(e.nextSibling);break e}n--}else"$"!==t&&"$!"!==t&&"$?"!==t||n++;e=e.nextSibling}Gm=null}}else 27===n?(n=Gm,rS(e.type)?(e=lS,lS=null,Gm=e):Gm=n):Gm=Km?sS(e.stateNode.nextSibling):null;return!0}function ig(){Gm=Km=null,Ym=!1}function ag(){var e=Jm;return null!==e&&(null===cw?cw=e:cw.push.apply(cw,e),Jm=null),e}function og(e){null===Jm?Jm=[e]:Jm.push(e)}var sg=Bu(null),lg=null,cg=null;function ug(e,t,n){_u(sg,t._currentValue),t._currentValue=n}function dg(e){e._currentValue=sg.current,Pu(sg)}function pg(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function fg(e,t,n,r){var i=e.child;for(null!==i&&(i.return=e);null!==i;){var a=i.dependencies;if(null!==a){var o=i.child;a=a.firstContext;e:for(;null!==a;){var s=a;a=i;for(var l=0;l<t.length;l++)if(s.context===t[l]){a.lanes|=n,null!==(s=a.alternate)&&(s.lanes|=n),pg(a.return,n,e),r||(o=null);break e}a=s.next}}else if(18===i.tag){if(null===(o=i.return))throw Error(Jc(341));o.lanes|=n,null!==(a=o.alternate)&&(a.lanes|=n),pg(o,n,e),o=null}else o=i.child;if(null!==o)o.return=i;else for(o=i;null!==o;){if(o===e){o=null;break}if(null!==(i=o.sibling)){i.return=o.return,o=i;break}o=o.return}i=o}}function mg(e,t,n,r){e=null;for(var i=t,a=!1;null!==i;){if(!a)if(524288&i.flags)a=!0;else if(262144&i.flags)break;if(10===i.tag){var o=i.alternate;if(null===o)throw Error(Jc(387));if(null!==(o=o.memoizedProps)){var s=i.type;zf(i.pendingProps.value,o.value)||(null!==e?e.push(s):e=[s])}}else if(i===Mu.current){if(null===(o=i.alternate))throw Error(Jc(387));o.memoizedState.memoizedState!==i.memoizedState.memoizedState&&(null!==e?e.push($S):e=[$S])}i=i.return}null!==e&&fg(t,e,n,r),t.flags|=262144}function gg(e){for(e=e.firstContext;null!==e;){if(!zf(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function hg(e){lg=e,cg=null,null!==(e=e.dependencies)&&(e.firstContext=null)}function bg(e){return xg(lg,e)}function yg(e,t){return null===lg&&hg(e),xg(e,t)}function xg(e,t){var n=t._currentValue;if(t={context:t,memoizedValue:n,next:null},null===cg){if(null===e)throw Error(Jc(308));cg=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else cg=cg.next=t;return n}var wg="undefined"!=typeof AbortController?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach(function(e){return e()})}},vg=Kc.unstable_scheduleCallback,Sg=Kc.unstable_NormalPriority,Eg={$$typeof:pu,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Ng(){return{controller:new wg,data:new Map,refCount:0}}function Ig(e){e.refCount--,0===e.refCount&&vg(Sg,function(){e.controller.abort()})}var Ag=null,kg=0,Tg=0,Cg=null;function Bg(){if(0===--kg&&null!==Ag){null!==Cg&&(Cg.status="fulfilled");var e=Ag;Ag=null,Tg=0,Cg=null;for(var t=0;t<e.length;t++)(0,e[t])()}}var Pg=Iu.S;Iu.S=function(e,t){"object"==typeof t&&null!==t&&"function"==typeof t.then&&function(e,t){if(null===Ag){var n=Ag=[];kg=0,Tg=xv(),Cg={status:"pending",value:void 0,then:function(e){n.push(e)}}}kg++,t.then(Bg,Bg)}(0,t),null!==Pg&&Pg(e,t)};var _g=Bu(null);function Og(){var e=_g.current;return null!==e?e:Xx.pooledCache}function Lg(e,t){_u(_g,null===t?_g.current:t.pool)}function Fg(){var e=Og();return null===e?null:{parent:Eg._currentValue,pool:e}}var Mg=Error(Jc(460)),Rg=Error(Jc(474)),$g=Error(Jc(542)),Ug={then:function(){}};function zg(e){return"fulfilled"===(e=e.status)||"rejected"===e}function Dg(){}function Hg(e,t,n){switch(void 0===(n=e[n])?e.push(t):n!==t&&(t.then(Dg,Dg),t=n),t.status){case"fulfilled":return t.value;case"rejected":throw Vg(e=t.reason),e;default:if("string"==typeof t.status)t.then(Dg,Dg);else{if(null!==(e=Xx)&&100<e.shellSuspendCounter)throw Error(Jc(482));(e=t).status="pending",e.then(function(e){if("pending"===t.status){var n=t;n.status="fulfilled",n.value=e}},function(e){if("pending"===t.status){var n=t;n.status="rejected",n.reason=e}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw Vg(e=t.reason),e}throw Wg=t,Mg}}var Wg=null;function jg(){if(null===Wg)throw Error(Jc(459));var e=Wg;return Wg=null,e}function Vg(e){if(e===Mg||e===$g)throw Error(Jc(483))}var qg=!1;function Xg(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Kg(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function Gg(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function Yg(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,2&qx){var i=r.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,t=Nm(e),Em(e,null,n),t}return wm(e,r,t,n),Nm(e)}function Jg(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,4194048&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yd(e,n)}}function Qg(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var o={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};null===a?i=a=o:a=a.next=o,n=n.next}while(null!==n);null===a?i=a=t:a=a.next=t}else i=a=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:r.shared,callbacks:r.callbacks},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}var Zg=!1;function eh(){if(Zg&&null!==Cg)throw Cg}function th(e,t,n,r){Zg=!1;var i=e.updateQueue;qg=!1;var a=i.firstBaseUpdate,o=i.lastBaseUpdate,s=i.shared.pending;if(null!==s){i.shared.pending=null;var l=s,c=l.next;l.next=null,null===o?a=c:o.next=c,o=l;var u=e.alternate;null!==u&&(s=(u=u.updateQueue).lastBaseUpdate)!==o&&(null===s?u.firstBaseUpdate=c:s.next=c,u.lastBaseUpdate=l)}if(null!==a){var d=i.baseState;for(o=0,u=c=l=null,s=a;;){var p=-536870913&s.lane,f=p!==s.lane;if(f?(Gx&p)===p:(r&p)===p){0!==p&&p===Tg&&(Zg=!0),null!==u&&(u=u.next={lane:0,tag:s.tag,payload:s.payload,callback:null,next:null});e:{var m=e,g=s;p=t;var h=n;switch(g.tag){case 1:if("function"==typeof(m=g.payload)){d=m.call(h,d,p);break e}d=m;break e;case 3:m.flags=-65537&m.flags|128;case 0:if(null==(p="function"==typeof(m=g.payload)?m.call(h,d,p):m))break e;d=ru({},d,p);break e;case 2:qg=!0}}null!==(p=s.callback)&&(e.flags|=64,f&&(e.flags|=8192),null===(f=i.callbacks)?i.callbacks=[p]:f.push(p))}else f={lane:p,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===u?(c=u=f,l=d):u=u.next=f,o|=p;if(null===(s=s.next)){if(null===(s=i.shared.pending))break;s=(f=s).next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}null===u&&(l=d),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,null===a&&(i.shared.lanes=0),rw|=o,e.lanes=o,e.memoizedState=d}}function nh(e,t){if("function"!=typeof e)throw Error(Jc(191,e));e.call(t)}function rh(e,t){var n=e.callbacks;if(null!==n)for(e.callbacks=null,e=0;e<n.length;e++)nh(n[e],t)}var ih=Bu(null),ah=Bu(0);function oh(e,t){_u(ah,e=tw),_u(ih,t),tw=e|t.baseLanes}function sh(){_u(ah,tw),_u(ih,ih.current)}function lh(){tw=ah.current,Pu(ih),Pu(ah)}var ch=0,uh=null,dh=null,ph=null,fh=!1,mh=!1,gh=!1,hh=0,bh=0,yh=null,xh=0;function wh(){throw Error(Jc(321))}function vh(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!zf(e[n],t[n]))return!1;return!0}function Sh(e,t,n,r,i,a){return ch=a,uh=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Iu.H=null===e||null===e.memoizedState?Mb:Rb,gh=!1,a=n(r,i),gh=!1,mh&&(a=Nh(t,n,r,i)),Eh(e),a}function Eh(e){Iu.H=Fb;var t=null!==dh&&null!==dh.next;if(ch=0,ph=dh=uh=null,fh=!1,bh=0,yh=null,t)throw Error(Jc(300));null===e||by||null!==(e=e.dependencies)&&gg(e)&&(by=!0)}function Nh(e,t,n,r){uh=e;var i=0;do{if(mh&&(yh=null),bh=0,mh=!1,25<=i)throw Error(Jc(301));if(i+=1,ph=dh=null,null!=e.updateQueue){var a=e.updateQueue;a.lastEffect=null,a.events=null,a.stores=null,null!=a.memoCache&&(a.memoCache.index=0)}Iu.H=$b,a=t(n,r)}while(mh);return a}function Ih(){var e=Iu.H,t=e.useState()[0];return t="function"==typeof t.then?Ph(t):t,e=e.useState()[0],(null!==dh?dh.memoizedState:null)!==e&&(uh.flags|=1024),t}function Ah(){var e=0!==hh;return hh=0,e}function kh(e,t,n){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n}function Th(e){if(fh){for(e=e.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}fh=!1}ch=0,ph=dh=uh=null,mh=!1,bh=hh=0,yh=null}function Ch(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===ph?uh.memoizedState=ph=e:ph=ph.next=e,ph}function Bh(){if(null===dh){var e=uh.alternate;e=null!==e?e.memoizedState:null}else e=dh.next;var t=null===ph?uh.memoizedState:ph.next;if(null!==t)ph=t,dh=e;else{if(null===e){if(null===uh.alternate)throw Error(Jc(467));throw Error(Jc(310))}e={memoizedState:(dh=e).memoizedState,baseState:dh.baseState,baseQueue:dh.baseQueue,queue:dh.queue,next:null},null===ph?uh.memoizedState=ph=e:ph=ph.next=e}return ph}function Ph(e){var t=bh;return bh+=1,null===yh&&(yh=[]),e=Hg(yh,e,t),t=uh,null===(null===ph?t.memoizedState:ph.next)&&(t=t.alternate,Iu.H=null===t||null===t.memoizedState?Mb:Rb),e}function _h(e){if(null!==e&&"object"==typeof e){if("function"==typeof e.then)return Ph(e);if(e.$$typeof===pu)return bg(e)}throw Error(Jc(438,String(e)))}function Oh(e){var t=null,n=uh.updateQueue;if(null!==n&&(t=n.memoCache),null==t){var r=uh.alternate;null!==r&&null!==(r=r.updateQueue)&&null!=(r=r.memoCache)&&(t={data:r.data.map(function(e){return e.slice()}),index:0})}if(null==t&&(t={data:[],index:0}),null===n&&(n={lastEffect:null,events:null,stores:null,memoCache:null},uh.updateQueue=n),n.memoCache=t,void 0===(n=t.data[t.index]))for(n=t.data[t.index]=Array(e),r=0;r<e;r++)n[r]=xu;return t.index++,n}function Lh(e,t){return"function"==typeof t?t(e):t}function Fh(e){return Mh(Bh(),dh,e)}function Mh(e,t,n){var r=e.queue;if(null===r)throw Error(Jc(311));r.lastRenderedReducer=n;var i=e.baseQueue,a=r.pending;if(null!==a){if(null!==i){var o=i.next;i.next=a.next,a.next=o}t.baseQueue=i=a,r.pending=null}if(a=e.baseState,null===i)e.memoizedState=a;else{var s=o=null,l=null,c=t=i.next,u=!1;do{var d=-536870913&c.lane;if(d!==c.lane?(Gx&d)===d:(ch&d)===d){var p=c.revertLane;if(0===p)null!==l&&(l=l.next={lane:0,revertLane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),d===Tg&&(u=!0);else{if((ch&p)===p){c=c.next,p===Tg&&(u=!0);continue}d={lane:0,revertLane:c.revertLane,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null},null===l?(s=l=d,o=a):l=l.next=d,uh.lanes|=p,rw|=p}d=c.action,gh&&n(a,d),a=c.hasEagerState?c.eagerState:n(a,d)}else p={lane:d,revertLane:c.revertLane,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null},null===l?(s=l=p,o=a):l=l.next=p,uh.lanes|=d,rw|=d;c=c.next}while(null!==c&&c!==t);if(null===l?o=a:l.next=s,!zf(a,e.memoizedState)&&(by=!0,u&&null!==(n=Cg)))throw n;e.memoizedState=a,e.baseState=o,e.baseQueue=l,r.lastRenderedState=a}return null===i&&(r.lanes=0),[e.memoizedState,r.dispatch]}function Rh(e){var t=Bh(),n=t.queue;if(null===n)throw Error(Jc(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,a=t.memoizedState;if(null!==i){n.pending=null;var o=i=i.next;do{a=e(a,o.action),o=o.next}while(o!==i);zf(a,t.memoizedState)||(by=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,r]}function $h(e,t,n){var r=uh,i=Bh(),a=Ym;if(a){if(void 0===n)throw Error(Jc(407));n=n()}else n=t();var o=!zf((dh||i).memoizedState,n);if(o&&(i.memoizedState=n,by=!0),i=i.queue,sb(2048,8,Dh.bind(null,r,i,e),[e]),i.getSnapshot!==t||o||null!==ph&&1&ph.memoizedState.tag){if(r.flags|=2048,ib(9,{destroy:void 0,resource:void 0},zh.bind(null,r,i,n,t),null),null===Xx)throw Error(Jc(349));a||124&ch||Uh(r,t,n)}return n}function Uh(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=uh.updateQueue)?(t={lastEffect:null,events:null,stores:null,memoCache:null},uh.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function zh(e,t,n,r){t.value=n,t.getSnapshot=r,Hh(t)&&Wh(e)}function Dh(e,t,n){return n(function(){Hh(t)&&Wh(e)})}function Hh(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!zf(e,n)}catch(tn){return!0}}function Wh(e){var t=Sm(e,2);null!==t&&Aw(t,0,2)}function jh(e){var t=Ch();if("function"==typeof e){var n=e;if(e=n(),gh){rd(!0);try{n()}finally{rd(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Lh,lastRenderedState:e},t}function Vh(e,t,n,r){return e.baseState=n,Mh(e,dh,"function"==typeof r?r:Lh)}function qh(e,t,n,r,i){if(_b(e))throw Error(Jc(485));if(null!==(e=t.action)){var a={payload:i,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(e){a.listeners.push(e)}};null!==Iu.T?n(!0):a.isTransition=!1,r(a),null===(n=t.pending)?(a.next=t.pending=a,Xh(t,a)):(a.next=n.next,t.pending=n.next=a)}}function Xh(e,t){var n=t.action,r=t.payload,i=e.state;if(t.isTransition){var a=Iu.T,o={};Iu.T=o;try{var s=n(i,r),l=Iu.S;null!==l&&l(o,s),Kh(e,t,s)}catch(tn){Yh(e,t,tn)}finally{Iu.T=a}}else try{Kh(e,t,a=n(i,r))}catch(c){Yh(e,t,c)}}function Kh(e,t,n){null!==n&&"object"==typeof n&&"function"==typeof n.then?n.then(function(n){Gh(e,t,n)},function(n){return Yh(e,t,n)}):Gh(e,t,n)}function Gh(e,t,n){t.status="fulfilled",t.value=n,Jh(t),e.state=n,null!==(t=e.pending)&&((n=t.next)===t?e.pending=null:(n=n.next,t.next=n,Xh(e,n)))}function Yh(e,t,n){var r=e.pending;if(e.pending=null,null!==r){r=r.next;do{t.status="rejected",t.reason=n,Jh(t),t=t.next}while(t!==r)}e.action=null}function Jh(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function Qh(e,t){return t}function Zh(e,t){if(Ym){var n=Xx.formState;if(null!==n){e:{var r=uh;if(Ym){if(Gm){t:{for(var i=Gm,a=Qm;8!==i.nodeType;){if(!a){i=null;break t}if(null===(i=sS(i.nextSibling))){i=null;break t}}i="F!"===(a=i.data)||"F"===a?i:null}if(i){Gm=sS(i.nextSibling),r="F!"===i.data;break e}}eg(r)}r=!1}r&&(t=n[0])}}return(n=Ch()).memoizedState=n.baseState=t,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qh,lastRenderedState:t},n.queue=r,n=Cb.bind(null,uh,r),r.dispatch=n,r=jh(!1),a=Pb.bind(null,uh,!1,r.queue),i={state:t,dispatch:null,action:e,pending:null},(r=Ch()).queue=i,n=qh.bind(null,uh,i,a,n),i.dispatch=n,r.memoizedState=e,[t,n,!1]}function eb(e){return tb(Bh(),dh,e)}function tb(e,t,n){if(t=Mh(e,t,Qh)[0],e=Fh(Lh)[0],"object"==typeof t&&null!==t&&"function"==typeof t.then)try{var r=Ph(t)}catch(o){if(o===Mg)throw $g;throw o}else r=t;var i=(t=Bh()).queue,a=i.dispatch;return n!==t.memoizedState&&(uh.flags|=2048,ib(9,{destroy:void 0,resource:void 0},nb.bind(null,i,n),null)),[r,a,e]}function nb(e,t){e.action=t}function rb(e){var t=Bh(),n=dh;if(null!==n)return tb(t,n,e);Bh(),t=t.memoizedState;var r=(n=Bh()).queue.dispatch;return n.memoizedState=e,[t,r,!1]}function ib(e,t,n,r){return e={tag:e,create:n,deps:r,inst:t,next:null},null===(t=uh.updateQueue)&&(t={lastEffect:null,events:null,stores:null,memoCache:null},uh.updateQueue=t),null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function ab(){return Bh().memoizedState}function ob(e,t,n,r){var i=Ch();r=void 0===r?null:r,uh.flags|=e,i.memoizedState=ib(1|t,{destroy:void 0,resource:void 0},n,r)}function sb(e,t,n,r){var i=Bh();r=void 0===r?null:r;var a=i.memoizedState.inst;null!==dh&&null!==r&&vh(r,dh.memoizedState.deps)?i.memoizedState=ib(t,a,n,r):(uh.flags|=e,i.memoizedState=ib(1|t,a,n,r))}function lb(e,t){ob(8390656,8,e,t)}function cb(e,t){sb(2048,8,e,t)}function ub(e,t){return sb(4,2,e,t)}function db(e,t){return sb(4,4,e,t)}function pb(e,t){if("function"==typeof t){e=e();var n=t(e);return function(){"function"==typeof n?n():t(null)}}if(null!=t)return e=e(),t.current=e,function(){t.current=null}}function fb(e,t,n){n=null!=n?n.concat([e]):null,sb(4,4,pb.bind(null,t,e),n)}function mb(){}function gb(e,t){var n=Bh();t=void 0===t?null:t;var r=n.memoizedState;return null!==t&&vh(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function hb(e,t){var n=Bh();t=void 0===t?null:t;var r=n.memoizedState;if(null!==t&&vh(t,r[1]))return r[0];if(r=e(),gh){rd(!0);try{e()}finally{rd(!1)}}return n.memoizedState=[r,t],r}function bb(e,t,n){return void 0===n||1073741824&ch?e.memoizedState=t:(e.memoizedState=n,e=Iw(),uh.lanes|=e,rw|=e,n)}function yb(e,t,n,r){return zf(n,t)?n:null!==ih.current?(e=bb(e,n,r),zf(e,t)||(by=!0),e):42&ch?(e=Iw(),uh.lanes|=e,rw|=e,t):(by=!0,e.memoizedState=n)}function xb(e,t,n,r,i){var a=Au.p;Au.p=0!==a&&8>a?a:8;var o,s,l,c=Iu.T,u={};Iu.T=u,Pb(e,!1,t,n);try{var d=i(),p=Iu.S;if(null!==p&&p(u,d),null!==d&&"object"==typeof d&&"function"==typeof d.then){var f=(o=r,s=[],l={status:"pending",value:null,reason:null,then:function(e){s.push(e)}},d.then(function(){l.status="fulfilled",l.value=o;for(var e=0;e<s.length;e++)(0,s[e])(o)},function(e){for(l.status="rejected",l.reason=e,e=0;e<s.length;e++)(0,s[e])(void 0)}),l);Bb(e,t,f,Nw())}else Bb(e,t,r,Nw())}catch(tn){Bb(e,t,{then:function(){},status:"rejected",reason:tn},Nw())}finally{Au.p=a,Iu.T=c}}function wb(){}function vb(e,t,n,r){if(5!==e.tag)throw Error(Jc(476));var i=Sb(e).queue;xb(e,i,t,ku,null===n?wb:function(){return Eb(e),n(r)})}function Sb(e){var t=e.memoizedState;if(null!==t)return t;var n={};return(t={memoizedState:ku,baseState:ku,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Lh,lastRenderedState:ku},next:null}).next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Lh,lastRenderedState:n},next:null},e.memoizedState=t,null!==(e=e.alternate)&&(e.memoizedState=t),t}function Eb(e){Bb(e,Sb(e).next.queue,{},Nw())}function Nb(){return bg($S)}function Ib(){return Bh().memoizedState}function Ab(){return Bh().memoizedState}function kb(e){for(var t=e.return;null!==t;){switch(t.tag){case 24:case 3:var n=Nw(),r=Yg(t,e=Gg(n),n);return null!==r&&(Aw(r,0,n),Jg(r,t,n)),t={cache:Ng()},void(e.payload=t)}t=t.return}}function Tb(e,t,n){var r=Nw();n={lane:r,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null},_b(e)?Ob(t,n):null!==(n=vm(e,t,n,r))&&(Aw(n,0,r),Lb(n,t,r))}function Cb(e,t,n){Bb(e,t,n,Nw())}function Bb(e,t,n,r){var i={lane:r,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null};if(_b(e))Ob(t,i);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var o=t.lastRenderedState,s=a(o,n);if(i.hasEagerState=!0,i.eagerState=s,zf(s,o))return wm(e,t,i,0),null===Xx&&xm(),!1}catch(tn){}if(null!==(n=vm(e,t,i,r)))return Aw(n,0,r),Lb(n,t,r),!0}return!1}function Pb(e,t,n,r){if(r={lane:2,revertLane:xv(),action:r,hasEagerState:!1,eagerState:null,next:null},_b(e)){if(t)throw Error(Jc(479))}else null!==(t=vm(e,n,r,2))&&Aw(t,0,2)}function _b(e){var t=e.alternate;return e===uh||null!==t&&t===uh}function Ob(e,t){mh=fh=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Lb(e,t,n){if(4194048&n){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yd(e,n)}}var Fb={readContext:bg,use:_h,useCallback:wh,useContext:wh,useEffect:wh,useImperativeHandle:wh,useLayoutEffect:wh,useInsertionEffect:wh,useMemo:wh,useReducer:wh,useRef:wh,useState:wh,useDebugValue:wh,useDeferredValue:wh,useTransition:wh,useSyncExternalStore:wh,useId:wh,useHostTransitionStatus:wh,useFormState:wh,useActionState:wh,useOptimistic:wh,useMemoCache:wh,useCacheRefresh:wh},Mb={readContext:bg,use:_h,useCallback:function(e,t){return Ch().memoizedState=[e,void 0===t?null:t],e},useContext:bg,useEffect:lb,useImperativeHandle:function(e,t,n){n=null!=n?n.concat([e]):null,ob(4194308,4,pb.bind(null,t,e),n)},useLayoutEffect:function(e,t){return ob(4194308,4,e,t)},useInsertionEffect:function(e,t){ob(4,2,e,t)},useMemo:function(e,t){var n=Ch();t=void 0===t?null:t;var r=e();if(gh){rd(!0);try{e()}finally{rd(!1)}}return n.memoizedState=[r,t],r},useReducer:function(e,t,n){var r=Ch();if(void 0!==n){var i=n(t);if(gh){rd(!0);try{n(t)}finally{rd(!1)}}}else i=t;return r.memoizedState=r.baseState=i,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:i},r.queue=e,e=e.dispatch=Tb.bind(null,uh,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Ch().memoizedState=e},useState:function(e){var t=(e=jh(e)).queue,n=Cb.bind(null,uh,t);return t.dispatch=n,[e.memoizedState,n]},useDebugValue:mb,useDeferredValue:function(e,t){return bb(Ch(),e,t)},useTransition:function(){var e=jh(!1);return e=xb.bind(null,uh,e.queue,!0,!1),Ch().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,n){var r=uh,i=Ch();if(Ym){if(void 0===n)throw Error(Jc(407));n=n()}else{if(n=t(),null===Xx)throw Error(Jc(349));124&Gx||Uh(r,t,n)}i.memoizedState=n;var a={value:n,getSnapshot:t};return i.queue=a,lb(Dh.bind(null,r,a,e),[e]),r.flags|=2048,ib(9,{destroy:void 0,resource:void 0},zh.bind(null,r,a,n,t),null),n},useId:function(){var e=Ch(),t=Xx.identifierPrefix;if(Ym){var n=Wm;t="\xab"+t+"R"+(n=(Hm&~(1<<32-id(Hm)-1)).toString(32)+n),0<(n=hh++)&&(t+="H"+n.toString(32)),t+="\xbb"}else t="\xab"+t+"r"+(n=xh++).toString(32)+"\xbb";return e.memoizedState=t},useHostTransitionStatus:Nb,useFormState:Zh,useActionState:Zh,useOptimistic:function(e){var t=Ch();t.memoizedState=t.baseState=e;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=n,t=Pb.bind(null,uh,!0,n),n.dispatch=t,[e,t]},useMemoCache:Oh,useCacheRefresh:function(){return Ch().memoizedState=kb.bind(null,uh)}},Rb={readContext:bg,use:_h,useCallback:gb,useContext:bg,useEffect:cb,useImperativeHandle:fb,useInsertionEffect:ub,useLayoutEffect:db,useMemo:hb,useReducer:Fh,useRef:ab,useState:function(){return Fh(Lh)},useDebugValue:mb,useDeferredValue:function(e,t){return yb(Bh(),dh.memoizedState,e,t)},useTransition:function(){var e=Fh(Lh)[0],t=Bh().memoizedState;return["boolean"==typeof e?e:Ph(e),t]},useSyncExternalStore:$h,useId:Ib,useHostTransitionStatus:Nb,useFormState:eb,useActionState:eb,useOptimistic:function(e,t){return Vh(Bh(),0,e,t)},useMemoCache:Oh,useCacheRefresh:Ab},$b={readContext:bg,use:_h,useCallback:gb,useContext:bg,useEffect:cb,useImperativeHandle:fb,useInsertionEffect:ub,useLayoutEffect:db,useMemo:hb,useReducer:Rh,useRef:ab,useState:function(){return Rh(Lh)},useDebugValue:mb,useDeferredValue:function(e,t){var n=Bh();return null===dh?bb(n,e,t):yb(n,dh.memoizedState,e,t)},useTransition:function(){var e=Rh(Lh)[0],t=Bh().memoizedState;return["boolean"==typeof e?e:Ph(e),t]},useSyncExternalStore:$h,useId:Ib,useHostTransitionStatus:Nb,useFormState:rb,useActionState:rb,useOptimistic:function(e,t){var n=Bh();return null!==dh?Vh(n,0,e,t):(n.baseState=e,[e,n.queue.dispatch])},useMemoCache:Oh,useCacheRefresh:Ab},Ub=null,zb=0;function Db(e){var t=zb;return zb+=1,null===Ub&&(Ub=[]),Hg(Ub,e,t)}function Hb(e,t){t=t.props.ref,e.ref=void 0!==t?t:null}function Wb(e,t){if(t.$$typeof===iu)throw Error(Jc(525));throw e=Object.prototype.toString.call(t),Error(Jc(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function jb(e){return(0,e._init)(e._payload)}function Vb(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e){for(var t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function i(e,t){return(e=Cm(e,t)).index=0,e.sibling=null,e}function a(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=67108866,n):r:(t.flags|=67108866,n):(t.flags|=1048576,n)}function o(t){return e&&null===t.alternate&&(t.flags|=67108866),t}function s(e,t,n,r){return null===t||6!==t.tag?((t=Om(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function l(e,t,n,r){var a=n.type;return a===su?u(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===a||"object"==typeof a&&null!==a&&a.$$typeof===bu&&jb(a)===t.type)?(Hb(t=i(t,n.props),n),t.return=e,t):(Hb(t=Pm(n.type,n.key,n.props,null,e.mode,r),n),t.return=e,t)}function c(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Lm(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function u(e,t,n,r,a){return null===t||7!==t.tag?((t=_m(n,e.mode,r,a)).return=e,t):((t=i(t,n)).return=e,t)}function d(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t||"bigint"==typeof t)return(t=Om(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case au:return Hb(n=Pm(t.type,t.key,t.props,null,e.mode,n),t),n.return=e,n;case ou:return(t=Lm(t,e.mode,n)).return=e,t;case bu:return d(e,t=(0,t._init)(t._payload),n)}if(Nu(t)||vu(t))return(t=_m(t,e.mode,n,null)).return=e,t;if("function"==typeof t.then)return d(e,Db(t),n);if(t.$$typeof===pu)return d(e,yg(e,t),n);Wb(e,t)}return null}function p(e,t,n,r){var i=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n||"bigint"==typeof n)return null!==i?null:s(e,t,""+n,r);if("object"==typeof n&&null!==n){switch(n.$$typeof){case au:return n.key===i?l(e,t,n,r):null;case ou:return n.key===i?c(e,t,n,r):null;case bu:return p(e,t,n=(i=n._init)(n._payload),r)}if(Nu(n)||vu(n))return null!==i?null:u(e,t,n,r,null);if("function"==typeof n.then)return p(e,t,Db(n),r);if(n.$$typeof===pu)return p(e,t,yg(e,n),r);Wb(e,n)}return null}function f(e,t,n,r,i){if("string"==typeof r&&""!==r||"number"==typeof r||"bigint"==typeof r)return s(t,e=e.get(n)||null,""+r,i);if("object"==typeof r&&null!==r){switch(r.$$typeof){case au:return l(t,e=e.get(null===r.key?n:r.key)||null,r,i);case ou:return c(t,e=e.get(null===r.key?n:r.key)||null,r,i);case bu:return f(e,t,n,r=(0,r._init)(r._payload),i)}if(Nu(r)||vu(r))return u(t,e=e.get(n)||null,r,i,null);if("function"==typeof r.then)return f(e,t,n,Db(r),i);if(r.$$typeof===pu)return f(e,t,n,yg(t,r),i);Wb(t,r)}return null}function m(s,l,c,u){if("object"==typeof c&&null!==c&&c.type===su&&null===c.key&&(c=c.props.children),"object"==typeof c&&null!==c){switch(c.$$typeof){case au:e:{for(var g=c.key;null!==l;){if(l.key===g){if((g=c.type)===su){if(7===l.tag){n(s,l.sibling),(u=i(l,c.props.children)).return=s,s=u;break e}}else if(l.elementType===g||"object"==typeof g&&null!==g&&g.$$typeof===bu&&jb(g)===l.type){n(s,l.sibling),Hb(u=i(l,c.props),c),u.return=s,s=u;break e}n(s,l);break}t(s,l),l=l.sibling}c.type===su?((u=_m(c.props.children,s.mode,u,c.key)).return=s,s=u):(Hb(u=Pm(c.type,c.key,c.props,null,s.mode,u),c),u.return=s,s=u)}return o(s);case ou:e:{for(g=c.key;null!==l;){if(l.key===g){if(4===l.tag&&l.stateNode.containerInfo===c.containerInfo&&l.stateNode.implementation===c.implementation){n(s,l.sibling),(u=i(l,c.children||[])).return=s,s=u;break e}n(s,l);break}t(s,l),l=l.sibling}(u=Lm(c,s.mode,u)).return=s,s=u}return o(s);case bu:return m(s,l,c=(g=c._init)(c._payload),u)}if(Nu(c))return function(i,o,s,l){for(var c=null,u=null,m=o,g=o=0,h=null;null!==m&&g<s.length;g++){m.index>g?(h=m,m=null):h=m.sibling;var b=p(i,m,s[g],l);if(null===b){null===m&&(m=h);break}e&&m&&null===b.alternate&&t(i,m),o=a(b,o,g),null===u?c=b:u.sibling=b,u=b,m=h}if(g===s.length)return n(i,m),Ym&&jm(i,g),c;if(null===m){for(;g<s.length;g++)null!==(m=d(i,s[g],l))&&(o=a(m,o,g),null===u?c=m:u.sibling=m,u=m);return Ym&&jm(i,g),c}for(m=r(m);g<s.length;g++)null!==(h=f(m,i,g,s[g],l))&&(e&&null!==h.alternate&&m.delete(null===h.key?g:h.key),o=a(h,o,g),null===u?c=h:u.sibling=h,u=h);return e&&m.forEach(function(e){return t(i,e)}),Ym&&jm(i,g),c}(s,l,c,u);if(vu(c)){if("function"!=typeof(g=vu(c)))throw Error(Jc(150));return function(i,o,s,l){if(null==s)throw Error(Jc(151));for(var c=null,u=null,m=o,g=o=0,h=null,b=s.next();null!==m&&!b.done;g++,b=s.next()){m.index>g?(h=m,m=null):h=m.sibling;var y=p(i,m,b.value,l);if(null===y){null===m&&(m=h);break}e&&m&&null===y.alternate&&t(i,m),o=a(y,o,g),null===u?c=y:u.sibling=y,u=y,m=h}if(b.done)return n(i,m),Ym&&jm(i,g),c;if(null===m){for(;!b.done;g++,b=s.next())null!==(b=d(i,b.value,l))&&(o=a(b,o,g),null===u?c=b:u.sibling=b,u=b);return Ym&&jm(i,g),c}for(m=r(m);!b.done;g++,b=s.next())null!==(b=f(m,i,g,b.value,l))&&(e&&null!==b.alternate&&m.delete(null===b.key?g:b.key),o=a(b,o,g),null===u?c=b:u.sibling=b,u=b);return e&&m.forEach(function(e){return t(i,e)}),Ym&&jm(i,g),c}(s,l,c=g.call(c),u)}if("function"==typeof c.then)return m(s,l,Db(c),u);if(c.$$typeof===pu)return m(s,l,yg(s,c),u);Wb(s,c)}return"string"==typeof c&&""!==c||"number"==typeof c||"bigint"==typeof c?(c=""+c,null!==l&&6===l.tag?(n(s,l.sibling),(u=i(l,c)).return=s,s=u):(n(s,l),(u=Om(c,s.mode,u)).return=s,s=u),o(s)):n(s,l)}return function(e,t,n,r){try{zb=0;var i=m(e,t,n,r);return Ub=null,i}catch(o){if(o===Mg||o===$g)throw o;var a=km(29,o,null,e.mode);return a.lanes=r,a.return=e,a}}}var qb=Vb(!0),Xb=Vb(!1),Kb=Bu(null),Gb=null;function Yb(e){var t=e.alternate;_u(ey,1&ey.current),_u(Kb,e),null===Gb&&(null===t||null!==ih.current||null!==t.memoizedState)&&(Gb=e)}function Jb(e){if(22===e.tag){if(_u(ey,ey.current),_u(Kb,e),null===Gb){var t=e.alternate;null!==t&&null!==t.memoizedState&&(Gb=e)}}else Qb()}function Qb(){_u(ey,ey.current),_u(Kb,Kb.current)}function Zb(e){Pu(Kb),Gb===e&&(Gb=null),Pu(ey)}var ey=Bu(0);function ty(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||oS(n)))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(128&t.flags)return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function ny(e,t,n,r){n=null==(n=n(r,t=e.memoizedState))?t:ru({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var ry={enqueueSetState:function(e,t,n){e=e._reactInternals;var r=Nw(),i=Gg(r);i.payload=t,null!=n&&(i.callback=n),null!==(t=Yg(e,i,r))&&(Aw(t,0,r),Jg(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=Nw(),i=Gg(r);i.tag=1,i.payload=t,null!=n&&(i.callback=n),null!==(t=Yg(e,i,r))&&(Aw(t,0,r),Jg(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Nw(),r=Gg(n);r.tag=2,null!=t&&(r.callback=t),null!==(t=Yg(e,r,n))&&(Aw(t,0,n),Jg(t,e,n))}};function iy(e,t,n,r,i,a,o){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,o):!(t.prototype&&t.prototype.isPureReactComponent&&Df(n,r)&&Df(i,a))}function ay(e,t,n,r){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&ry.enqueueReplaceState(t,t.state,null)}function oy(e,t){var n=t;if("ref"in t)for(var r in n={},t)"ref"!==r&&(n[r]=t[r]);if(e=e.defaultProps)for(var i in n===t&&(n=ru({},n)),e)void 0===n[i]&&(n[i]=e[i]);return n}var sy="function"==typeof reportError?reportError:function(e){if("object"==typeof window&&"function"==typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"==typeof e&&null!==e&&"string"==typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"==typeof process&&"function"==typeof process.emit)return void process.emit("uncaughtException",e)};function ly(e){sy(e)}function cy(e){}function uy(e){sy(e)}function dy(e,t){try{(0,e.onUncaughtError)(t.value,{componentStack:t.stack})}catch(n){setTimeout(function(){throw n})}}function py(e,t,n){try{(0,e.onCaughtError)(n.value,{componentStack:n.stack,errorBoundary:1===t.tag?t.stateNode:null})}catch(r){setTimeout(function(){throw r})}}function fy(e,t,n){return(n=Gg(n)).tag=3,n.payload={element:null},n.callback=function(){dy(e,t)},n}function my(e){return(e=Gg(e)).tag=3,e}function gy(e,t,n,r){var i=n.type.getDerivedStateFromError;if("function"==typeof i){var a=r.value;e.payload=function(){return i(a)},e.callback=function(){py(t,n,r)}}var o=n.stateNode;null!==o&&"function"==typeof o.componentDidCatch&&(e.callback=function(){py(t,n,r),"function"!=typeof i&&(null===mw?mw=new Set([this]):mw.add(this));var e=r.stack;this.componentDidCatch(r.value,{componentStack:null!==e?e:""})})}var hy=Error(Jc(461)),by=!1;function yy(e,t,n,r){t.child=null===e?Xb(t,null,n,r):qb(t,e.child,n,r)}function xy(e,t,n,r,i){n=n.render;var a=t.ref;if("ref"in r){var o={};for(var s in r)"ref"!==s&&(o[s]=r[s])}else o=r;return hg(t),r=Sh(e,t,n,o,a,i),s=Ah(),null===e||by?(Ym&&s&&qm(t),t.flags|=1,yy(e,t,r,i),t.child):(kh(e,t,i),Uy(e,t,i))}function wy(e,t,n,r,i){if(null===e){var a=n.type;return"function"!=typeof a||Tm(a)||void 0!==a.defaultProps||null!==n.compare?((e=Pm(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,vy(e,t,a,r,i))}if(a=e.child,!zy(e,i)){var o=a.memoizedProps;if((n=null!==(n=n.compare)?n:Df)(o,r)&&e.ref===t.ref)return Uy(e,t,i)}return t.flags|=1,(e=Cm(a,r)).ref=t.ref,e.return=t,t.child=e}function vy(e,t,n,r,i){if(null!==e){var a=e.memoizedProps;if(Df(a,r)&&e.ref===t.ref){if(by=!1,t.pendingProps=r=a,!zy(e,i))return t.lanes=e.lanes,Uy(e,t,i);131072&e.flags&&(by=!0)}}return Iy(e,t,n,r,i)}function Sy(e,t,n){var r=t.pendingProps,i=r.children,a=null!==e?e.memoizedState:null;if("hidden"===r.mode){if(128&t.flags){if(r=null!==a?a.baseLanes|n:n,null!==e){for(i=t.child=e.child,a=0;null!==i;)a=a|i.lanes|i.childLanes,i=i.sibling;t.childLanes=a&~r}else t.childLanes=0,t.child=null;return Ey(e,t,r,n)}if(!(536870912&n))return t.lanes=t.childLanes=536870912,Ey(e,t,null!==a?a.baseLanes|n:n,n);t.memoizedState={baseLanes:0,cachePool:null},null!==e&&Lg(0,null!==a?a.cachePool:null),null!==a?oh(t,a):sh(),Jb(t)}else null!==a?(Lg(0,a.cachePool),oh(t,a),Qb(),t.memoizedState=null):(null!==e&&Lg(0,null),sh(),Qb());return yy(e,t,i,n),t.child}function Ey(e,t,n,r){var i=Og();return i=null===i?null:{parent:Eg._currentValue,pool:i},t.memoizedState={baseLanes:n,cachePool:i},null!==e&&Lg(0,null),sh(),Jb(t),null!==e&&mg(e,t,r,!0),null}function Ny(e,t){var n=t.ref;if(null===n)null!==e&&null!==e.ref&&(t.flags|=4194816);else{if("function"!=typeof n&&"object"!=typeof n)throw Error(Jc(284));null!==e&&e.ref===n||(t.flags|=4194816)}}function Iy(e,t,n,r,i){return hg(t),n=Sh(e,t,n,r,void 0,i),r=Ah(),null===e||by?(Ym&&r&&qm(t),t.flags|=1,yy(e,t,n,i),t.child):(kh(e,t,i),Uy(e,t,i))}function Ay(e,t,n,r,i,a){return hg(t),t.updateQueue=null,n=Nh(t,r,n,i),Eh(e),r=Ah(),null===e||by?(Ym&&r&&qm(t),t.flags|=1,yy(e,t,n,a),t.child):(kh(e,t,a),Uy(e,t,a))}function ky(e,t,n,r,i){if(hg(t),null===t.stateNode){var a=Im,o=n.contextType;"object"==typeof o&&null!==o&&(a=bg(o)),a=new n(r,a),t.memoizedState=null!==a.state&&void 0!==a.state?a.state:null,a.updater=ry,t.stateNode=a,a._reactInternals=t,(a=t.stateNode).props=r,a.state=t.memoizedState,a.refs={},Xg(t),o=n.contextType,a.context="object"==typeof o&&null!==o?bg(o):Im,a.state=t.memoizedState,"function"==typeof(o=n.getDerivedStateFromProps)&&(ny(t,n,o,r),a.state=t.memoizedState),"function"==typeof n.getDerivedStateFromProps||"function"==typeof a.getSnapshotBeforeUpdate||"function"!=typeof a.UNSAFE_componentWillMount&&"function"!=typeof a.componentWillMount||(o=a.state,"function"==typeof a.componentWillMount&&a.componentWillMount(),"function"==typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount(),o!==a.state&&ry.enqueueReplaceState(a,a.state,null),th(t,r,a,i),eh(),a.state=t.memoizedState),"function"==typeof a.componentDidMount&&(t.flags|=4194308),r=!0}else if(null===e){a=t.stateNode;var s=t.memoizedProps,l=oy(n,s);a.props=l;var c=a.context,u=n.contextType;o=Im,"object"==typeof u&&null!==u&&(o=bg(u));var d=n.getDerivedStateFromProps;u="function"==typeof d||"function"==typeof a.getSnapshotBeforeUpdate,s=t.pendingProps!==s,u||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(s||c!==o)&&ay(t,a,r,o),qg=!1;var p=t.memoizedState;a.state=p,th(t,r,a,i),eh(),c=t.memoizedState,s||p!==c||qg?("function"==typeof d&&(ny(t,n,d,r),c=t.memoizedState),(l=qg||iy(t,n,l,r,p,c,o))?(u||"function"!=typeof a.UNSAFE_componentWillMount&&"function"!=typeof a.componentWillMount||("function"==typeof a.componentWillMount&&a.componentWillMount(),"function"==typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"==typeof a.componentDidMount&&(t.flags|=4194308)):("function"==typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=c),a.props=r,a.state=c,a.context=o,r=l):("function"==typeof a.componentDidMount&&(t.flags|=4194308),r=!1)}else{a=t.stateNode,Kg(e,t),u=oy(n,o=t.memoizedProps),a.props=u,d=t.pendingProps,p=a.context,c=n.contextType,l=Im,"object"==typeof c&&null!==c&&(l=bg(c)),(c="function"==typeof(s=n.getDerivedStateFromProps)||"function"==typeof a.getSnapshotBeforeUpdate)||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(o!==d||p!==l)&&ay(t,a,r,l),qg=!1,p=t.memoizedState,a.state=p,th(t,r,a,i),eh();var f=t.memoizedState;o!==d||p!==f||qg||null!==e&&null!==e.dependencies&&gg(e.dependencies)?("function"==typeof s&&(ny(t,n,s,r),f=t.memoizedState),(u=qg||iy(t,n,u,r,p,f,l)||null!==e&&null!==e.dependencies&&gg(e.dependencies))?(c||"function"!=typeof a.UNSAFE_componentWillUpdate&&"function"!=typeof a.componentWillUpdate||("function"==typeof a.componentWillUpdate&&a.componentWillUpdate(r,f,l),"function"==typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(r,f,l)),"function"==typeof a.componentDidUpdate&&(t.flags|=4),"function"==typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof a.componentDidUpdate||o===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),"function"!=typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=f),a.props=r,a.state=f,a.context=l,r=u):("function"!=typeof a.componentDidUpdate||o===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),"function"!=typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),r=!1)}return a=r,Ny(e,t),r=!!(128&t.flags),a||r?(a=t.stateNode,n=r&&"function"!=typeof n.getDerivedStateFromError?null:a.render(),t.flags|=1,null!==e&&r?(t.child=qb(t,e.child,null,i),t.child=qb(t,null,n,i)):yy(e,t,n,i),t.memoizedState=a.state,e=t.child):e=Uy(e,t,i),e}function Ty(e,t,n,r){return ig(),t.flags|=256,yy(e,t,n,r),t.child}var Cy={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function By(e){return{baseLanes:e,cachePool:Fg()}}function Py(e,t,n){return e=null!==e?e.childLanes&~n:0,t&&(e|=ow),e}function _y(e,t,n){var r,i=t.pendingProps,a=!1,o=!!(128&t.flags);if((r=o)||(r=(null===e||null!==e.memoizedState)&&!!(2&ey.current)),r&&(a=!0,t.flags&=-129),r=!!(32&t.flags),t.flags&=-33,null===e){if(Ym){if(a?Yb(t):Qb(),Ym){var s,l=Gm;if(s=l){e:{for(s=l,l=Qm;8!==s.nodeType;){if(!l){l=null;break e}if(null===(s=sS(s.nextSibling))){l=null;break e}}l=s}null!==l?(t.memoizedState={dehydrated:l,treeContext:null!==Dm?{id:Hm,overflow:Wm}:null,retryLane:536870912,hydrationErrors:null},(s=km(18,null,null,0)).stateNode=l,s.return=t,t.child=s,Km=t,Gm=null,s=!0):s=!1}s||eg(t)}if(null!==(l=t.memoizedState)&&null!==(l=l.dehydrated))return oS(l)?t.lanes=32:t.lanes=536870912,null;Zb(t)}return l=i.children,i=i.fallback,a?(Qb(),l=Ly({mode:"hidden",children:l},a=t.mode),i=_m(i,a,n,null),l.return=t,i.return=t,l.sibling=i,t.child=l,(a=t.child).memoizedState=By(n),a.childLanes=Py(e,r,n),t.memoizedState=Cy,i):(Yb(t),Oy(t,l))}if(null!==(s=e.memoizedState)&&null!==(l=s.dehydrated)){if(o)256&t.flags?(Yb(t),t.flags&=-257,t=Fy(e,t,n)):null!==t.memoizedState?(Qb(),t.child=e.child,t.flags|=128,t=null):(Qb(),a=i.fallback,l=t.mode,i=Ly({mode:"visible",children:i.children},l),(a=_m(a,l,n,null)).flags|=2,i.return=t,a.return=t,i.sibling=a,t.child=i,qb(t,e.child,null,n),(i=t.child).memoizedState=By(n),i.childLanes=Py(e,r,n),t.memoizedState=Cy,t=a);else if(Yb(t),oS(l)){if(r=l.nextSibling&&l.nextSibling.dataset)var c=r.dgst;r=c,(i=Error(Jc(419))).stack="",i.digest=r,og({value:i,source:null,stack:null}),t=Fy(e,t,n)}else if(by||mg(e,t,n,!1),r=0!==(n&e.childLanes),by||r){if(null!==(r=Xx)&&0!==(i=0!==((i=42&(i=n&-n)?1:xd(i))&(r.suspendedLanes|n))?0:i)&&i!==s.retryLane)throw s.retryLane=i,Sm(e,i),Aw(r,0,i),hy;"$?"===l.data||Rw(),t=Fy(e,t,n)}else"$?"===l.data?(t.flags|=192,t.child=e.child,t=null):(e=s.treeContext,Gm=sS(l.nextSibling),Km=t,Ym=!0,Jm=null,Qm=!1,null!==e&&(Um[zm++]=Hm,Um[zm++]=Wm,Um[zm++]=Dm,Hm=e.id,Wm=e.overflow,Dm=t),(t=Oy(t,i.children)).flags|=4096);return t}return a?(Qb(),a=i.fallback,l=t.mode,c=(s=e.child).sibling,(i=Cm(s,{mode:"hidden",children:i.children})).subtreeFlags=65011712&s.subtreeFlags,null!==c?a=Cm(c,a):(a=_m(a,l,n,null)).flags|=2,a.return=t,i.return=t,i.sibling=a,t.child=i,i=a,a=t.child,null===(l=e.child.memoizedState)?l=By(n):(null!==(s=l.cachePool)?(c=Eg._currentValue,s=s.parent!==c?{parent:c,pool:c}:s):s=Fg(),l={baseLanes:l.baseLanes|n,cachePool:s}),a.memoizedState=l,a.childLanes=Py(e,r,n),t.memoizedState=Cy,i):(Yb(t),e=(n=e.child).sibling,(n=Cm(n,{mode:"visible",children:i.children})).return=t,n.sibling=null,null!==e&&(null===(r=t.deletions)?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n)}function Oy(e,t){return(t=Ly({mode:"visible",children:t},e.mode)).return=e,e.child=t}function Ly(e,t){return(e=km(22,e,null,t)).lanes=0,e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},e}function Fy(e,t,n){return qb(t,e.child,null,n),(e=Oy(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function My(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),pg(e.return,t,n)}function Ry(e,t,n,r,i){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=i)}function $y(e,t,n){var r=t.pendingProps,i=r.revealOrder,a=r.tail;if(yy(e,t,r.children,n),2&(r=ey.current))r=1&r|2,t.flags|=128;else{if(null!==e&&128&e.flags)e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&My(e,n,t);else if(19===e.tag)My(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}switch(_u(ey,r),i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===ty(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Ry(t,!1,i,n,a);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===ty(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Ry(t,!0,n,null,a);break;case"together":Ry(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Uy(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),rw|=t.lanes,0===(n&t.childLanes)){if(null===e)return null;if(mg(e,t,n,!1),0===(n&t.childLanes))return null}if(null!==e&&t.child!==e.child)throw Error(Jc(153));if(null!==t.child){for(n=Cm(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Cm(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function zy(e,t){return 0!==(e.lanes&t)||!(null===(e=e.dependencies)||!gg(e))}function Dy(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps)by=!0;else{if(!(zy(e,n)||128&t.flags))return by=!1,function(e,t,n){switch(t.tag){case 3:Ru(t,t.stateNode.containerInfo),ug(0,Eg,e.memoizedState.cache),ig();break;case 27:case 5:Uu(t);break;case 4:Ru(t,t.stateNode.containerInfo);break;case 10:ug(0,t.type,t.memoizedProps.value);break;case 13:var r=t.memoizedState;if(null!==r)return null!==r.dehydrated?(Yb(t),t.flags|=128,null):0!==(n&t.child.childLanes)?_y(e,t,n):(Yb(t),null!==(e=Uy(e,t,n))?e.sibling:null);Yb(t);break;case 19:var i=!!(128&e.flags);if((r=0!==(n&t.childLanes))||(mg(e,t,n,!1),r=0!==(n&t.childLanes)),i){if(r)return $y(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),_u(ey,ey.current),r)break;return null;case 22:case 23:return t.lanes=0,Sy(e,t,n);case 24:ug(0,Eg,e.memoizedState.cache)}return Uy(e,t,n)}(e,t,n);by=!!(131072&e.flags)}else by=!1,Ym&&1048576&t.flags&&Vm(t,$m,t.index);switch(t.lanes=0,t.tag){case 16:e:{e=t.pendingProps;var r=t.elementType,i=r._init;if(r=i(r._payload),t.type=r,"function"!=typeof r){if(null!=r){if((i=r.$$typeof)===fu){t.tag=11,t=xy(null,t,r,e,n);break e}if(i===hu){t.tag=14,t=wy(null,t,r,e,n);break e}}throw t=Eu(r)||r,Error(Jc(306,t,""))}Tm(r)?(e=oy(r,e),t.tag=1,t=ky(null,t,r,e,n)):(t.tag=0,t=Iy(null,t,r,e,n))}return t;case 0:return Iy(e,t,t.type,t.pendingProps,n);case 1:return ky(e,t,r=t.type,i=oy(r,t.pendingProps),n);case 3:e:{if(Ru(t,t.stateNode.containerInfo),null===e)throw Error(Jc(387));r=t.pendingProps;var a=t.memoizedState;i=a.element,Kg(e,t),th(t,r,null,n);var o=t.memoizedState;if(r=o.cache,ug(0,Eg,r),r!==a.cache&&fg(t,[Eg],n,!0),eh(),r=o.element,a.isDehydrated){if(a={element:r,isDehydrated:!1,cache:o.cache},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=Ty(e,t,r,n);break e}if(r!==i){og(i=gm(Error(Jc(424)),t)),t=Ty(e,t,r,n);break e}for(e=9===(e=t.stateNode.containerInfo).nodeType?e.body:"HTML"===e.nodeName?e.ownerDocument.body:e,Gm=sS(e.firstChild),Km=t,Ym=!0,Jm=null,Qm=!0,n=Xb(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(ig(),r===i){t=Uy(e,t,n);break e}yy(e,t,r,n)}t=t.child}return t;case 26:return Ny(e,t),null===e?(n=yS(t.type,null,t.pendingProps,null))?t.memoizedState=n:Ym||(n=t.type,e=t.pendingProps,(r=Xv(Fu.current).createElement(n))[Ed]=t,r[Nd]=e,jv(r,n,e),Md(r),t.stateNode=r):t.memoizedState=yS(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return Uu(t),null===e&&Ym&&(r=t.stateNode=uS(t.type,t.pendingProps,Fu.current),Km=t,Qm=!0,i=Gm,rS(t.type)?(lS=i,Gm=sS(r.firstChild)):Gm=i),yy(e,t,t.pendingProps.children,n),Ny(e,t),null===e&&(t.flags|=4194304),t.child;case 5:return null===e&&Ym&&((i=r=Gm)&&(null!==(r=function(e,t,n,r){for(;1===e.nodeType;){var i=n;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!r&&("INPUT"!==e.nodeName||"hidden"!==e.type))break}else if(r){if(!e[Bd])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if("stylesheet"===(a=e.getAttribute("rel"))&&e.hasAttribute("data-precedence"))break;if(a!==i.rel||e.getAttribute("href")!==(null==i.href||""===i.href?null:i.href)||e.getAttribute("crossorigin")!==(null==i.crossOrigin?null:i.crossOrigin)||e.getAttribute("title")!==(null==i.title?null:i.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(((a=e.getAttribute("src"))!==(null==i.src?null:i.src)||e.getAttribute("type")!==(null==i.type?null:i.type)||e.getAttribute("crossorigin")!==(null==i.crossOrigin?null:i.crossOrigin))&&a&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else{if("input"!==t||"hidden"!==e.type)return e;var a=null==i.name?null:""+i.name;if("hidden"===i.type&&e.getAttribute("name")===a)return e}if(null===(e=sS(e.nextSibling)))break}return null}(r,t.type,t.pendingProps,Qm))?(t.stateNode=r,Km=t,Gm=sS(r.firstChild),Qm=!1,i=!0):i=!1),i||eg(t)),Uu(t),i=t.type,a=t.pendingProps,o=null!==e?e.memoizedProps:null,r=a.children,Yv(i,a)?r=null:null!==o&&Yv(i,o)&&(t.flags|=32),null!==t.memoizedState&&(i=Sh(e,t,Ih,null,null,n),$S._currentValue=i),Ny(e,t),yy(e,t,r,n),t.child;case 6:return null===e&&Ym&&((e=n=Gm)&&(null!==(n=function(e,t,n){if(""===t)return null;for(;3!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!n)return null;if(null===(e=sS(e.nextSibling)))return null}return e}(n,t.pendingProps,Qm))?(t.stateNode=n,Km=t,Gm=null,e=!0):e=!1),e||eg(t)),null;case 13:return _y(e,t,n);case 4:return Ru(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=qb(t,null,r,n):yy(e,t,r,n),t.child;case 11:return xy(e,t,t.type,t.pendingProps,n);case 7:return yy(e,t,t.pendingProps,n),t.child;case 8:case 12:return yy(e,t,t.pendingProps.children,n),t.child;case 10:return r=t.pendingProps,ug(0,t.type,r.value),yy(e,t,r.children,n),t.child;case 9:return i=t.type._context,r=t.pendingProps.children,hg(t),r=r(i=bg(i)),t.flags|=1,yy(e,t,r,n),t.child;case 14:return wy(e,t,t.type,t.pendingProps,n);case 15:return vy(e,t,t.type,t.pendingProps,n);case 19:return $y(e,t,n);case 31:return r=t.pendingProps,n=t.mode,r={mode:r.mode,children:r.children},null===e?((n=Ly(r,n)).ref=t.ref,t.child=n,n.return=t,t=n):((n=Cm(e.child,r)).ref=t.ref,t.child=n,n.return=t,t=n),t;case 22:return Sy(e,t,n);case 24:return hg(t),r=bg(Eg),null===e?(null===(i=Og())&&(i=Xx,a=Ng(),i.pooledCache=a,a.refCount++,null!==a&&(i.pooledCacheLanes|=n),i=a),t.memoizedState={parent:r,cache:i},Xg(t),ug(0,Eg,i)):(0!==(e.lanes&n)&&(Kg(e,t),th(t,null,null,n),eh()),i=e.memoizedState,a=t.memoizedState,i.parent!==r?(i={parent:r,cache:r},t.memoizedState=i,0===t.lanes&&(t.memoizedState=t.updateQueue.baseState=i),ug(0,Eg,r)):(r=a.cache,ug(0,Eg,r),r!==i.cache&&fg(t,[Eg],n,!0))),yy(e,t,t.pendingProps.children,n),t.child;case 29:throw t.pendingProps}throw Error(Jc(156,t.tag))}function Hy(e){e.flags|=4}function Wy(e,t){if("stylesheet"!==t.type||4&t.state.loading)e.flags&=-16777217;else if(e.flags|=16777216,!PS(t)){if(null!==(t=Kb.current)&&((4194048&Gx)===Gx?null!==Gb:(62914560&Gx)!==Gx&&!(536870912&Gx)||t!==Gb))throw Wg=Ug,Rg;e.flags|=8192}}function jy(e,t){null!==t&&(e.flags|=4),16384&e.flags&&(t=22!==e.tag?md():536870912,e.lanes|=t,sw|=t)}function Vy(e,t){if(!Ym)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function qy(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=65011712&i.subtreeFlags,r|=65011712&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Xy(e,t,n){var r=t.pendingProps;switch(Xm(t),t.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return qy(t),null;case 3:return n=t.stateNode,r=null,null!==e&&(r=e.memoizedState.cache),t.memoizedState.cache!==r&&(t.flags|=2048),dg(Eg),$u(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(rg(t)?Hy(t):null===e||e.memoizedState.isDehydrated&&!(256&t.flags)||(t.flags|=1024,ag())),qy(t),null;case 26:return n=t.memoizedState,null===e?(Hy(t),null!==n?(qy(t),Wy(t,n)):(qy(t),t.flags&=-16777217)):n?n!==e.memoizedState?(Hy(t),qy(t),Wy(t,n)):(qy(t),t.flags&=-16777217):(e.memoizedProps!==r&&Hy(t),qy(t),t.flags&=-16777217),null;case 27:zu(t),n=Fu.current;var i=t.type;if(null!==e&&null!=t.stateNode)e.memoizedProps!==r&&Hy(t);else{if(!r){if(null===t.stateNode)throw Error(Jc(166));return qy(t),null}e=Ou.current,rg(t)?tg(t):(e=uS(i,r,n),t.stateNode=e,Hy(t))}return qy(t),null;case 5:if(zu(t),n=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==r&&Hy(t);else{if(!r){if(null===t.stateNode)throw Error(Jc(166));return qy(t),null}if(e=Ou.current,rg(t))tg(t);else{switch(i=Xv(Fu.current),e){case 1:e=i.createElementNS("http://www.w3.org/2000/svg",n);break;case 2:e=i.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;default:switch(n){case"svg":e=i.createElementNS("http://www.w3.org/2000/svg",n);break;case"math":e=i.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;case"script":(e=i.createElement("div")).innerHTML="\x3Cscript><\/script>",e=e.removeChild(e.firstChild);break;case"select":e="string"==typeof r.is?i.createElement("select",{is:r.is}):i.createElement("select"),r.multiple?e.multiple=!0:r.size&&(e.size=r.size);break;default:e="string"==typeof r.is?i.createElement(n,{is:r.is}):i.createElement(n)}}e[Ed]=t,e[Nd]=r;e:for(i=t.child;null!==i;){if(5===i.tag||6===i.tag)e.appendChild(i.stateNode);else if(4!==i.tag&&27!==i.tag&&null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break e;for(;null===i.sibling;){if(null===i.return||i.return===t)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}t.stateNode=e;e:switch(jv(e,n,r),n){case"button":case"input":case"select":case"textarea":e=!!r.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&Hy(t)}}return qy(t),t.flags&=-16777217,null;case 6:if(e&&null!=t.stateNode)e.memoizedProps!==r&&Hy(t);else{if("string"!=typeof r&&null===t.stateNode)throw Error(Jc(166));if(e=Fu.current,rg(t)){if(e=t.stateNode,n=t.memoizedProps,r=null,null!==(i=Km))switch(i.tag){case 27:case 5:r=i.memoizedProps}e[Ed]=t,(e=!!(e.nodeValue===n||null!==r&&!0===r.suppressHydrationWarning||zv(e.nodeValue,n)))||eg(t)}else(e=Xv(e).createTextNode(r))[Ed]=t,t.stateNode=e}return qy(t),null;case 13:if(r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(i=rg(t),null!==r&&null!==r.dehydrated){if(null===e){if(!i)throw Error(Jc(318));if(!(i=null!==(i=t.memoizedState)?i.dehydrated:null))throw Error(Jc(317));i[Ed]=t}else ig(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;qy(t),i=!1}else i=ag(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=i),i=!0;if(!i)return 256&t.flags?(Zb(t),t):(Zb(t),null)}if(Zb(t),128&t.flags)return t.lanes=n,t;if(n=null!==r,e=null!==e&&null!==e.memoizedState,n){i=null,null!==(r=t.child).alternate&&null!==r.alternate.memoizedState&&null!==r.alternate.memoizedState.cachePool&&(i=r.alternate.memoizedState.cachePool.pool);var a=null;null!==r.memoizedState&&null!==r.memoizedState.cachePool&&(a=r.memoizedState.cachePool.pool),a!==i&&(r.flags|=2048)}return n!==e&&n&&(t.child.flags|=8192),jy(t,t.updateQueue),qy(t),null;case 4:return $u(),null===e&&Bv(t.stateNode.containerInfo),qy(t),null;case 10:return dg(t.type),qy(t),null;case 19:if(Pu(ey),null===(i=t.memoizedState))return qy(t),null;if(r=!!(128&t.flags),null===(a=i.rendering))if(r)Vy(i,!1);else{if(0!==nw||null!==e&&128&e.flags)for(e=t.child;null!==e;){if(null!==(a=ty(e))){for(t.flags|=128,Vy(i,!1),e=a.updateQueue,t.updateQueue=e,jy(t,e),t.subtreeFlags=0,e=n,n=t.child;null!==n;)Bm(n,e),n=n.sibling;return _u(ey,1&ey.current|2),t.child}e=e.sibling}null!==i.tail&&qu()>pw&&(t.flags|=128,r=!0,Vy(i,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=ty(a))){if(t.flags|=128,r=!0,e=e.updateQueue,t.updateQueue=e,jy(t,e),Vy(i,!0),null===i.tail&&"hidden"===i.tailMode&&!a.alternate&&!Ym)return qy(t),null}else 2*qu()-i.renderingStartTime>pw&&536870912!==n&&(t.flags|=128,r=!0,Vy(i,!1),t.lanes=4194304);i.isBackwards?(a.sibling=t.child,t.child=a):(null!==(e=i.last)?e.sibling=a:t.child=a,i.last=a)}return null!==i.tail?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=qu(),t.sibling=null,e=ey.current,_u(ey,r?1&e|2:1&e),t):(qy(t),null);case 22:case 23:return Zb(t),lh(),r=null!==t.memoizedState,null!==e?null!==e.memoizedState!==r&&(t.flags|=8192):r&&(t.flags|=8192),r?!!(536870912&n)&&!(128&t.flags)&&(qy(t),6&t.subtreeFlags&&(t.flags|=8192)):qy(t),null!==(n=t.updateQueue)&&jy(t,n.retryQueue),n=null,null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),r=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(r=t.memoizedState.cachePool.pool),r!==n&&(t.flags|=2048),null!==e&&Pu(_g),null;case 24:return n=null,null!==e&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),dg(Eg),qy(t),null;case 25:case 30:return null}throw Error(Jc(156,t.tag))}function Ky(e,t){switch(Xm(t),t.tag){case 1:return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return dg(Eg),$u(),65536&(e=t.flags)&&!(128&e)?(t.flags=-65537&e|128,t):null;case 26:case 27:case 5:return zu(t),null;case 13:if(Zb(t),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(Jc(340));ig()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Pu(ey),null;case 4:return $u(),null;case 10:return dg(t.type),null;case 22:case 23:return Zb(t),lh(),null!==e&&Pu(_g),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 24:return dg(Eg),null;default:return null}}function Gy(e,t){switch(Xm(t),t.tag){case 3:dg(Eg),$u();break;case 26:case 27:case 5:zu(t);break;case 4:$u();break;case 13:Zb(t);break;case 19:Pu(ey);break;case 10:dg(t.type);break;case 22:case 23:Zb(t),lh(),null!==e&&Pu(_g);break;case 24:dg(Eg)}}function Yy(e,t){try{var n=t.updateQueue,r=null!==n?n.lastEffect:null;if(null!==r){var i=r.next;n=i;do{if((n.tag&e)===e){r=void 0;var a=n.create,o=n.inst;r=a(),o.destroy=r}n=n.next}while(n!==i)}}catch(tn){ev(t,t.return,tn)}}function Jy(e,t,n){try{var r=t.updateQueue,i=null!==r?r.lastEffect:null;if(null!==i){var a=i.next;r=a;do{if((r.tag&e)===e){var o=r.inst,s=o.destroy;if(void 0!==s){o.destroy=void 0,i=t;var l=n,c=s;try{c()}catch(tn){ev(i,l,tn)}}}r=r.next}while(r!==a)}}catch(tn){ev(t,t.return,tn)}}function Qy(e){var t=e.updateQueue;if(null!==t){var n=e.stateNode;try{rh(t,n)}catch(tn){ev(e,e.return,tn)}}}function Zy(e,t,n){n.props=oy(e.type,e.memoizedProps),n.state=e.memoizedState;try{n.componentWillUnmount()}catch(tn){ev(e,t,tn)}}function ex(e,t){try{var n=e.ref;if(null!==n){switch(e.tag){case 26:case 27:case 5:var r=e.stateNode;break;default:r=e.stateNode}"function"==typeof n?e.refCleanup=n(r):n.current=r}}catch(tn){ev(e,t,tn)}}function tx(e,t){var n=e.ref,r=e.refCleanup;if(null!==n)if("function"==typeof r)try{r()}catch(tn){ev(e,t,tn)}finally{e.refCleanup=null,null!=(e=e.alternate)&&(e.refCleanup=null)}else if("function"==typeof n)try{n(null)}catch(i){ev(e,t,i)}else n.current=null}function nx(e){var t=e.type,n=e.memoizedProps,r=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":n.autoFocus&&r.focus();break e;case"img":n.src?r.src=n.src:n.srcSet&&(r.srcset=n.srcSet)}}catch(tn){ev(e,e.return,tn)}}function rx(e,t,n){try{var r=e.stateNode;!function(e,t,n,r){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var i=null,a=null,o=null,s=null,l=null,c=null,u=null;for(f in n){var d=n[f];if(n.hasOwnProperty(f)&&null!=d)switch(f){case"checked":case"value":break;case"defaultValue":l=d;default:r.hasOwnProperty(f)||Hv(e,t,f,null,r,d)}}for(var p in r){var f=r[p];if(d=n[p],r.hasOwnProperty(p)&&(null!=f||null!=d))switch(p){case"type":a=f;break;case"name":i=f;break;case"checked":c=f;break;case"defaultChecked":u=f;break;case"value":o=f;break;case"defaultValue":s=f;break;case"children":case"dangerouslySetInnerHTML":if(null!=f)throw Error(Jc(137,t));break;default:f!==d&&Hv(e,t,p,f,r,d)}}return void sp(e,o,s,l,c,u,a,i);case"select":for(a in f=o=s=p=null,n)if(l=n[a],n.hasOwnProperty(a)&&null!=l)switch(a){case"value":break;case"multiple":f=l;default:r.hasOwnProperty(a)||Hv(e,t,a,null,r,l)}for(i in r)if(a=r[i],l=n[i],r.hasOwnProperty(i)&&(null!=a||null!=l))switch(i){case"value":p=a;break;case"defaultValue":s=a;break;case"multiple":o=a;default:a!==l&&Hv(e,t,i,a,r,l)}return t=s,n=o,r=f,void(null!=p?up(e,!!n,p,!1):!!r!=!!n&&(null!=t?up(e,!!n,t,!0):up(e,!!n,n?[]:"",!1)));case"textarea":for(s in f=p=null,n)if(i=n[s],n.hasOwnProperty(s)&&null!=i&&!r.hasOwnProperty(s))switch(s){case"value":case"children":break;default:Hv(e,t,s,null,r,i)}for(o in r)if(i=r[o],a=n[o],r.hasOwnProperty(o)&&(null!=i||null!=a))switch(o){case"value":p=i;break;case"defaultValue":f=i;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=i)throw Error(Jc(91));break;default:i!==a&&Hv(e,t,o,i,r,a)}return void dp(e,p,f);case"option":for(var m in n)p=n[m],n.hasOwnProperty(m)&&null!=p&&!r.hasOwnProperty(m)&&("selected"===m?e.selected=!1:Hv(e,t,m,null,r,p));for(l in r)p=r[l],f=n[l],!r.hasOwnProperty(l)||p===f||null==p&&null==f||("selected"===l?e.selected=p&&"function"!=typeof p&&"symbol"!=typeof p:Hv(e,t,l,p,r,f));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var g in n)p=n[g],n.hasOwnProperty(g)&&null!=p&&!r.hasOwnProperty(g)&&Hv(e,t,g,null,r,p);for(c in r)if(p=r[c],f=n[c],r.hasOwnProperty(c)&&p!==f&&(null!=p||null!=f))switch(c){case"children":case"dangerouslySetInnerHTML":if(null!=p)throw Error(Jc(137,t));break;default:Hv(e,t,c,p,r,f)}return;default:if(bp(t)){for(var h in n)p=n[h],n.hasOwnProperty(h)&&void 0!==p&&!r.hasOwnProperty(h)&&Wv(e,t,h,void 0,r,p);for(u in r)p=r[u],f=n[u],!r.hasOwnProperty(u)||p===f||void 0===p&&void 0===f||Wv(e,t,u,p,r,f);return}}for(var b in n)p=n[b],n.hasOwnProperty(b)&&null!=p&&!r.hasOwnProperty(b)&&Hv(e,t,b,null,r,p);for(d in r)p=r[d],f=n[d],!r.hasOwnProperty(d)||p===f||null==p&&null==f||Hv(e,t,d,p,r,f)}(r,e.type,n,t),r[Nd]=t}catch(tn){ev(e,e.return,tn)}}function ix(e){return 5===e.tag||3===e.tag||26===e.tag||27===e.tag&&rS(e.type)||4===e.tag}function ax(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||ix(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(27===e.tag&&rS(e.type))continue e;if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ox(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?(9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).insertBefore(e,t):((t=9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).appendChild(e),null!=(n=n._reactRootContainer)||null!==t.onclick||(t.onclick=Dv));else if(4!==r&&(27===r&&rS(e.type)&&(n=e.stateNode,t=null),null!==(e=e.child)))for(ox(e,t,n),e=e.sibling;null!==e;)ox(e,t,n),e=e.sibling}function sx(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&(27===r&&rS(e.type)&&(n=e.stateNode),null!==(e=e.child)))for(sx(e,t,n),e=e.sibling;null!==e;)sx(e,t,n),e=e.sibling}function lx(e){var t=e.stateNode,n=e.memoizedProps;try{for(var r=e.type,i=t.attributes;i.length;)t.removeAttributeNode(i[0]);jv(t,r,n),t[Ed]=e,t[Nd]=n}catch(tn){ev(e,e.return,tn)}}var cx=!1,ux=!1,dx=!1,px="function"==typeof WeakSet?WeakSet:Set,fx=null;function mx(e,t,n){var r=n.flags;switch(n.tag){case 0:case 11:case 15:kx(e,n),4&r&&Yy(5,n);break;case 1:if(kx(e,n),4&r)if(e=n.stateNode,null===t)try{e.componentDidMount()}catch(tn){ev(n,n.return,tn)}else{var i=oy(n.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(i,t,e.__reactInternalSnapshotBeforeUpdate)}catch(o){ev(n,n.return,o)}}64&r&&Qy(n),512&r&&ex(n,n.return);break;case 3:if(kx(e,n),64&r&&null!==(e=n.updateQueue)){if(t=null,null!==n.child)switch(n.child.tag){case 27:case 5:case 1:t=n.child.stateNode}try{rh(e,t)}catch(tn){ev(n,n.return,tn)}}break;case 27:null===t&&4&r&&lx(n);case 26:case 5:kx(e,n),null===t&&4&r&&nx(n),512&r&&ex(n,n.return);break;case 12:kx(e,n);break;case 13:kx(e,n),4&r&&wx(e,n),64&r&&null!==(e=n.memoizedState)&&null!==(e=e.dehydrated)&&function(e,t){var n=e.ownerDocument;if("$?"!==e.data||"complete"===n.readyState)t();else{var r=function(){t(),n.removeEventListener("DOMContentLoaded",r)};n.addEventListener("DOMContentLoaded",r),e._reactRetry=r}}(e,n=iv.bind(null,n));break;case 22:if(!(r=null!==n.memoizedState||cx)){t=null!==t&&null!==t.memoizedState||ux,i=cx;var a=ux;cx=r,(ux=t)&&!a?Cx(e,n,!!(8772&n.subtreeFlags)):kx(e,n),cx=i,ux=a}break;case 30:break;default:kx(e,n)}}function gx(e){var t=e.alternate;null!==t&&(e.alternate=null,gx(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&null!==(t=e.stateNode)&&Pd(t),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var hx=null,bx=!1;function yx(e,t,n){for(n=n.child;null!==n;)xx(e,t,n),n=n.sibling}function xx(e,t,n){if(nd&&"function"==typeof nd.onCommitFiberUnmount)try{nd.onCommitFiberUnmount(td,n)}catch(a){}switch(n.tag){case 26:ux||tx(n,t),yx(e,t,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode).parentNode.removeChild(n);break;case 27:ux||tx(n,t);var r=hx,i=bx;rS(n.type)&&(hx=n.stateNode,bx=!1),yx(e,t,n),dS(n.stateNode),hx=r,bx=i;break;case 5:ux||tx(n,t);case 6:if(r=hx,i=bx,hx=null,yx(e,t,n),bx=i,null!==(hx=r))if(bx)try{(9===hx.nodeType?hx.body:"HTML"===hx.nodeName?hx.ownerDocument.body:hx).removeChild(n.stateNode)}catch(tn){ev(n,t,tn)}else try{hx.removeChild(n.stateNode)}catch(tn){ev(n,t,tn)}break;case 18:null!==hx&&(bx?(iS(9===(e=hx).nodeType?e.body:"HTML"===e.nodeName?e.ownerDocument.body:e,n.stateNode),bE(e)):iS(hx,n.stateNode));break;case 4:r=hx,i=bx,hx=n.stateNode.containerInfo,bx=!0,yx(e,t,n),hx=r,bx=i;break;case 0:case 11:case 14:case 15:ux||Jy(2,n,t),ux||Jy(4,n,t),yx(e,t,n);break;case 1:ux||(tx(n,t),"function"==typeof(r=n.stateNode).componentWillUnmount&&Zy(n,t,r)),yx(e,t,n);break;case 21:yx(e,t,n);break;case 22:ux=(r=ux)||null!==n.memoizedState,yx(e,t,n),ux=r;break;default:yx(e,t,n)}}function wx(e,t){if(null===t.memoizedState&&null!==(e=t.alternate)&&null!==(e=e.memoizedState)&&null!==(e=e.dehydrated))try{bE(e)}catch(tn){ev(t,t.return,tn)}}function vx(e,t){var n=function(e){switch(e.tag){case 13:case 19:var t=e.stateNode;return null===t&&(t=e.stateNode=new px),t;case 22:return null===(t=(e=e.stateNode)._retryCache)&&(t=e._retryCache=new px),t;default:throw Error(Jc(435,e.tag))}}(e);t.forEach(function(t){var r=av.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))})}function Sx(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var i=n[r],a=e,o=t,s=o;e:for(;null!==s;){switch(s.tag){case 27:if(rS(s.type)){hx=s.stateNode,bx=!1;break e}break;case 5:hx=s.stateNode,bx=!1;break e;case 3:case 4:hx=s.stateNode.containerInfo,bx=!0;break e}s=s.return}if(null===hx)throw Error(Jc(160));xx(a,o,i),hx=null,bx=!1,null!==(a=i.alternate)&&(a.return=null),i.return=null}if(13878&t.subtreeFlags)for(t=t.child;null!==t;)Nx(t,e),t=t.sibling}var Ex=null;function Nx(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Sx(t,e),Ix(e),4&r&&(Jy(3,e,e.return),Yy(3,e),Jy(5,e,e.return));break;case 1:Sx(t,e),Ix(e),512&r&&(ux||null===n||tx(n,n.return)),64&r&&cx&&null!==(e=e.updateQueue)&&null!==(r=e.callbacks)&&(n=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=null===n?r:n.concat(r));break;case 26:var i=Ex;if(Sx(t,e),Ix(e),512&r&&(ux||null===n||tx(n,n.return)),4&r){var a=null!==n?n.memoizedState:null;if(r=e.memoizedState,null===n)if(null===r)if(null===e.stateNode){e:{r=e.type,n=e.memoizedProps,i=i.ownerDocument||i;t:switch(r){case"title":(!(a=i.getElementsByTagName("title")[0])||a[Bd]||a[Ed]||"http://www.w3.org/2000/svg"===a.namespaceURI||a.hasAttribute("itemprop"))&&(a=i.createElement(r),i.head.insertBefore(a,i.querySelector("head > title"))),jv(a,r,n),a[Ed]=e,Md(a),r=a;break e;case"link":var o=CS("link","href",i).get(r+(n.href||""));if(o)for(var s=0;s<o.length;s++)if((a=o[s]).getAttribute("href")===(null==n.href||""===n.href?null:n.href)&&a.getAttribute("rel")===(null==n.rel?null:n.rel)&&a.getAttribute("title")===(null==n.title?null:n.title)&&a.getAttribute("crossorigin")===(null==n.crossOrigin?null:n.crossOrigin)){o.splice(s,1);break t}jv(a=i.createElement(r),r,n),i.head.appendChild(a);break;case"meta":if(o=CS("meta","content",i).get(r+(n.content||"")))for(s=0;s<o.length;s++)if((a=o[s]).getAttribute("content")===(null==n.content?null:""+n.content)&&a.getAttribute("name")===(null==n.name?null:n.name)&&a.getAttribute("property")===(null==n.property?null:n.property)&&a.getAttribute("http-equiv")===(null==n.httpEquiv?null:n.httpEquiv)&&a.getAttribute("charset")===(null==n.charSet?null:n.charSet)){o.splice(s,1);break t}jv(a=i.createElement(r),r,n),i.head.appendChild(a);break;default:throw Error(Jc(468,r))}a[Ed]=e,Md(a),r=a}e.stateNode=r}else BS(i,e.type,e.stateNode);else e.stateNode=NS(i,r,e.memoizedProps);else a!==r?(null===a?null!==n.stateNode&&(n=n.stateNode).parentNode.removeChild(n):a.count--,null===r?BS(i,e.type,e.stateNode):NS(i,r,e.memoizedProps)):null===r&&null!==e.stateNode&&rx(e,e.memoizedProps,n.memoizedProps)}break;case 27:Sx(t,e),Ix(e),512&r&&(ux||null===n||tx(n,n.return)),null!==n&&4&r&&rx(e,e.memoizedProps,n.memoizedProps);break;case 5:if(Sx(t,e),Ix(e),512&r&&(ux||null===n||tx(n,n.return)),32&e.flags){i=e.stateNode;try{fp(i,"")}catch(tn){ev(e,e.return,tn)}}4&r&&null!=e.stateNode&&rx(e,i=e.memoizedProps,null!==n?n.memoizedProps:i),1024&r&&(dx=!0);break;case 6:if(Sx(t,e),Ix(e),4&r){if(null===e.stateNode)throw Error(Jc(162));r=e.memoizedProps,n=e.stateNode;try{n.nodeValue=r}catch(tn){ev(e,e.return,tn)}}break;case 3:if(TS=null,i=Ex,Ex=mS(t.containerInfo),Sx(t,e),Ex=i,Ix(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{bE(t.containerInfo)}catch(tn){ev(e,e.return,tn)}dx&&(dx=!1,Ax(e));break;case 4:r=Ex,Ex=mS(e.stateNode.containerInfo),Sx(t,e),Ix(e),Ex=r;break;case 12:default:Sx(t,e),Ix(e);break;case 13:Sx(t,e),Ix(e),8192&e.child.flags&&null!==e.memoizedState!=(null!==n&&null!==n.memoizedState)&&(dw=qu()),4&r&&null!==(r=e.updateQueue)&&(e.updateQueue=null,vx(e,r));break;case 22:i=null!==e.memoizedState;var l=null!==n&&null!==n.memoizedState,c=cx,u=ux;if(cx=c||i,ux=u||l,Sx(t,e),ux=u,cx=c,Ix(e),8192&r)e:for(t=e.stateNode,t._visibility=i?-2&t._visibility:1|t._visibility,i&&(null===n||l||cx||ux||Tx(e)),n=null,t=e;;){if(5===t.tag||26===t.tag){if(null===n){l=n=t;try{if(a=l.stateNode,i)"function"==typeof(o=a.style).setProperty?o.setProperty("display","none","important"):o.display="none";else{s=l.stateNode;var d=l.memoizedProps.style,p=null!=d&&d.hasOwnProperty("display")?d.display:null;s.style.display=null==p||"boolean"==typeof p?"":(""+p).trim()}}catch(tn){ev(l,l.return,tn)}}}else if(6===t.tag){if(null===n){l=t;try{l.stateNode.nodeValue=i?"":l.memoizedProps}catch(tn){ev(l,l.return,tn)}}}else if((22!==t.tag&&23!==t.tag||null===t.memoizedState||t===e)&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;null===t.sibling;){if(null===t.return||t.return===e)break e;n===t&&(n=null),t=t.return}n===t&&(n=null),t.sibling.return=t.return,t=t.sibling}4&r&&null!==(r=e.updateQueue)&&null!==(n=r.retryQueue)&&(r.retryQueue=null,vx(e,n));break;case 19:Sx(t,e),Ix(e),4&r&&null!==(r=e.updateQueue)&&(e.updateQueue=null,vx(e,r));case 30:case 21:}}function Ix(e){var t=e.flags;if(2&t){try{for(var n,r=e.return;null!==r;){if(ix(r)){n=r;break}r=r.return}if(null==n)throw Error(Jc(160));switch(n.tag){case 27:var i=n.stateNode;sx(e,ax(e),i);break;case 5:var a=n.stateNode;32&n.flags&&(fp(a,""),n.flags&=-33),sx(e,ax(e),a);break;case 3:case 4:var o=n.stateNode.containerInfo;ox(e,ax(e),o);break;default:throw Error(Jc(161))}}catch(tn){ev(e,e.return,tn)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function Ax(e){if(1024&e.subtreeFlags)for(e=e.child;null!==e;){var t=e;Ax(t),5===t.tag&&1024&t.flags&&t.stateNode.reset(),e=e.sibling}}function kx(e,t){if(8772&t.subtreeFlags)for(t=t.child;null!==t;)mx(e,t.alternate,t),t=t.sibling}function Tx(e){for(e=e.child;null!==e;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:Jy(4,t,t.return),Tx(t);break;case 1:tx(t,t.return);var n=t.stateNode;"function"==typeof n.componentWillUnmount&&Zy(t,t.return,n),Tx(t);break;case 27:dS(t.stateNode);case 26:case 5:tx(t,t.return),Tx(t);break;case 22:null===t.memoizedState&&Tx(t);break;default:Tx(t)}e=e.sibling}}function Cx(e,t,n){for(n=n&&!!(8772&t.subtreeFlags),t=t.child;null!==t;){var r=t.alternate,i=e,a=t,o=a.flags;switch(a.tag){case 0:case 11:case 15:Cx(i,a,n),Yy(4,a);break;case 1:if(Cx(i,a,n),"function"==typeof(i=(r=a).stateNode).componentDidMount)try{i.componentDidMount()}catch(tn){ev(r,r.return,tn)}if(null!==(i=(r=a).updateQueue)){var s=r.stateNode;try{var l=i.shared.hiddenCallbacks;if(null!==l)for(i.shared.hiddenCallbacks=null,i=0;i<l.length;i++)nh(l[i],s)}catch(tn){ev(r,r.return,tn)}}n&&64&o&&Qy(a),ex(a,a.return);break;case 27:lx(a);case 26:case 5:Cx(i,a,n),n&&null===r&&4&o&&nx(a),ex(a,a.return);break;case 12:Cx(i,a,n);break;case 13:Cx(i,a,n),n&&4&o&&wx(i,a);break;case 22:null===a.memoizedState&&Cx(i,a,n),ex(a,a.return);break;case 30:break;default:Cx(i,a,n)}t=t.sibling}}function Bx(e,t){var n=null;null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),e=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(e=t.memoizedState.cachePool.pool),e!==n&&(null!=e&&e.refCount++,null!=n&&Ig(n))}function Px(e,t){e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Ig(e))}function _x(e,t,n,r){if(10256&t.subtreeFlags)for(t=t.child;null!==t;)Ox(e,t,n,r),t=t.sibling}function Ox(e,t,n,r){var i=t.flags;switch(t.tag){case 0:case 11:case 15:_x(e,t,n,r),2048&i&&Yy(9,t);break;case 1:case 13:default:_x(e,t,n,r);break;case 3:_x(e,t,n,r),2048&i&&(e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Ig(e)));break;case 12:if(2048&i){_x(e,t,n,r),e=t.stateNode;try{var a=t.memoizedProps,o=a.id,s=a.onPostCommit;"function"==typeof s&&s(o,null===t.alternate?"mount":"update",e.passiveEffectDuration,-0)}catch(tn){ev(t,t.return,tn)}}else _x(e,t,n,r);break;case 23:break;case 22:a=t.stateNode,o=t.alternate,null!==t.memoizedState?2&a._visibility?_x(e,t,n,r):Fx(e,t):2&a._visibility?_x(e,t,n,r):(a._visibility|=2,Lx(e,t,n,r,!!(10256&t.subtreeFlags))),2048&i&&Bx(o,t);break;case 24:_x(e,t,n,r),2048&i&&Px(t.alternate,t)}}function Lx(e,t,n,r,i){for(i=i&&!!(10256&t.subtreeFlags),t=t.child;null!==t;){var a=e,o=t,s=n,l=r,c=o.flags;switch(o.tag){case 0:case 11:case 15:Lx(a,o,s,l,i),Yy(8,o);break;case 23:break;case 22:var u=o.stateNode;null!==o.memoizedState?2&u._visibility?Lx(a,o,s,l,i):Fx(a,o):(u._visibility|=2,Lx(a,o,s,l,i)),i&&2048&c&&Bx(o.alternate,o);break;case 24:Lx(a,o,s,l,i),i&&2048&c&&Px(o.alternate,o);break;default:Lx(a,o,s,l,i)}t=t.sibling}}function Fx(e,t){if(10256&t.subtreeFlags)for(t=t.child;null!==t;){var n=e,r=t,i=r.flags;switch(r.tag){case 22:Fx(n,r),2048&i&&Bx(r.alternate,r);break;case 24:Fx(n,r),2048&i&&Px(r.alternate,r);break;default:Fx(n,r)}t=t.sibling}}var Mx=8192;function Rx(e){if(e.subtreeFlags&Mx)for(e=e.child;null!==e;)$x(e),e=e.sibling}function $x(e){switch(e.tag){case 26:Rx(e),e.flags&Mx&&null!==e.memoizedState&&function(e,t,n){if(null===_S)throw Error(Jc(475));var r=_S;if(!("stylesheet"!==t.type||"string"==typeof n.media&&!1===matchMedia(n.media).matches||4&t.state.loading)){if(null===t.instance){var i=xS(n.href),a=e.querySelector(wS(i));if(a)return null!==(e=a._p)&&"object"==typeof e&&"function"==typeof e.then&&(r.count++,r=LS.bind(r),e.then(r,r)),t.state.loading|=4,t.instance=a,void Md(a);a=e.ownerDocument||e,n=vS(n),(i=pS.get(i))&&AS(n,i),Md(a=a.createElement("link"));var o=a;o._p=new Promise(function(e,t){o.onload=e,o.onerror=t}),jv(a,"link",n),t.instance=a}null===r.stylesheets&&(r.stylesheets=new Map),r.stylesheets.set(t,e),(e=t.state.preload)&&!(3&t.state.loading)&&(r.count++,t=LS.bind(r),e.addEventListener("load",t),e.addEventListener("error",t))}}(Ex,e.memoizedState,e.memoizedProps);break;case 5:default:Rx(e);break;case 3:case 4:var t=Ex;Ex=mS(e.stateNode.containerInfo),Rx(e),Ex=t;break;case 22:null===e.memoizedState&&(null!==(t=e.alternate)&&null!==t.memoizedState?(t=Mx,Mx=16777216,Rx(e),Mx=t):Rx(e))}}function Ux(e){var t=e.alternate;if(null!==t&&null!==(e=t.child)){t.child=null;do{t=e.sibling,e.sibling=null,e=t}while(null!==e)}}function zx(e){var t=e.deletions;if(16&e.flags){if(null!==t)for(var n=0;n<t.length;n++){var r=t[n];fx=r,Wx(r,e)}Ux(e)}if(10256&e.subtreeFlags)for(e=e.child;null!==e;)Dx(e),e=e.sibling}function Dx(e){switch(e.tag){case 0:case 11:case 15:zx(e),2048&e.flags&&Jy(9,e,e.return);break;case 3:case 12:default:zx(e);break;case 22:var t=e.stateNode;null!==e.memoizedState&&2&t._visibility&&(null===e.return||13!==e.return.tag)?(t._visibility&=-3,Hx(e)):zx(e)}}function Hx(e){var t=e.deletions;if(16&e.flags){if(null!==t)for(var n=0;n<t.length;n++){var r=t[n];fx=r,Wx(r,e)}Ux(e)}for(e=e.child;null!==e;){switch((t=e).tag){case 0:case 11:case 15:Jy(8,t,t.return),Hx(t);break;case 22:2&(n=t.stateNode)._visibility&&(n._visibility&=-3,Hx(t));break;default:Hx(t)}e=e.sibling}}function Wx(e,t){for(;null!==fx;){var n=fx;switch(n.tag){case 0:case 11:case 15:Jy(8,n,t);break;case 23:case 22:if(null!==n.memoizedState&&null!==n.memoizedState.cachePool){var r=n.memoizedState.cachePool.pool;null!=r&&r.refCount++}break;case 24:Ig(n.memoizedState.cache)}if(null!==(r=n.child))r.return=n,fx=r;else e:for(n=e;null!==fx;){var i=(r=fx).sibling,a=r.return;if(gx(r),r===n){fx=null;break e}if(null!==i){i.return=a,fx=i;break e}fx=a}}}var jx={getCacheForType:function(e){var t=bg(Eg),n=t.data.get(e);return void 0===n&&(n=e(),t.data.set(e,n)),n}},Vx="function"==typeof WeakMap?WeakMap:Map,qx=0,Xx=null,Kx=null,Gx=0,Yx=0,Jx=null,Qx=!1,Zx=!1,ew=!1,tw=0,nw=0,rw=0,iw=0,aw=0,ow=0,sw=0,lw=null,cw=null,uw=!1,dw=0,pw=1/0,fw=null,mw=null,gw=0,hw=null,bw=null,yw=0,xw=0,ww=null,vw=null,Sw=0,Ew=null;function Nw(){return 2&qx&&0!==Gx?Gx&-Gx:null!==Iu.T?0!==Tg?Tg:xv():vd()}function Iw(){0===ow&&(ow=536870912&Gx&&!Ym?536870912:fd());var e=Kb.current;return null!==e&&(e.flags|=32),ow}function Aw(e,t,n){(e!==Xx||2!==Yx&&9!==Yx)&&null===e.cancelPendingCommit||(Ow(e,0),Bw(e,Gx,ow,!1)),hd(e,n),2&qx&&e===Xx||(e===Xx&&(!(2&qx)&&(iw|=n),4===nw&&Bw(e,Gx,ow,!1)),pv(e))}function kw(e,t,n){if(6&qx)throw Error(Jc(327));for(var r=!n&&!(124&t)&&0===(t&e.expiredLanes)||dd(e,t),i=r?function(e,t){var n=qx;qx|=2;var r=Fw(),i=Mw();Xx!==e||Gx!==t?(fw=null,pw=qu()+500,Ow(e,t)):Zx=dd(e,t);e:for(;;)try{if(0!==Yx&&null!==Kx){t=Kx;var a=Jx;t:switch(Yx){case 1:Yx=0,Jx=null,Ww(e,t,a,1);break;case 2:case 9:if(zg(a)){Yx=0,Jx=null,Hw(t);break}t=function(){2!==Yx&&9!==Yx||Xx!==e||(Yx=7),pv(e)},a.then(t,t);break e;case 3:Yx=7;break e;case 4:Yx=5;break e;case 7:zg(a)?(Yx=0,Jx=null,Hw(t)):(Yx=0,Jx=null,Ww(e,t,a,7));break;case 5:var o=null;switch(Kx.tag){case 26:o=Kx.memoizedState;case 5:case 27:var s=Kx;if(!o||PS(o)){Yx=0,Jx=null;var l=s.sibling;if(null!==l)Kx=l;else{var c=s.return;null!==c?(Kx=c,jw(c)):Kx=null}break t}}Yx=0,Jx=null,Ww(e,t,a,5);break;case 6:Yx=0,Jx=null,Ww(e,t,a,6);break;case 8:_w(),nw=6;break e;default:throw Error(Jc(462))}}zw();break}catch(u){Lw(e,u)}return cg=lg=null,Iu.H=r,Iu.A=i,qx=n,null!==Kx?0:(Xx=null,Gx=0,xm(),nw)}(e,t):$w(e,t,!0),a=r;;){if(0===i){Zx&&!r&&Bw(e,t,0,!1);break}if(n=e.current.alternate,!a||Cw(n)){if(2===i){if(a=t,e.errorRecoveryDisabledLanes&a)var o=0;else o=0!=(o=-536870913&e.pendingLanes)?o:536870912&o?536870912:0;if(0!==o){t=o;e:{var s=e;i=lw;var l=s.current.memoizedState.isDehydrated;if(l&&(Ow(s,o).flags|=256),2!==(o=$w(s,o,!1))){if(ew&&!l){s.errorRecoveryDisabledLanes|=a,iw|=a,i=4;break e}a=cw,cw=i,null!==a&&(null===cw?cw=a:cw.push.apply(cw,a))}i=o}if(a=!1,2!==i)continue}}if(1===i){Ow(e,0),Bw(e,t,0,!0);break}e:{switch(r=e,a=i){case 0:case 1:throw Error(Jc(345));case 4:if((4194048&t)!==t)break;case 6:Bw(r,t,ow,!Qx);break e;case 2:cw=null;break;case 3:case 5:break;default:throw Error(Jc(329))}if((62914560&t)===t&&10<(i=dw+300-qu())){if(Bw(r,t,ow,!Qx),0!==ud(r,0,!0))break e;r.timeoutHandle=Qv(Tw.bind(null,r,n,cw,fw,uw,t,ow,iw,sw,Qx,a,2,-0,0),i)}else Tw(r,n,cw,fw,uw,t,ow,iw,sw,Qx,a,0,-0,0)}break}i=$w(e,t,!1),a=!1}pv(e)}function Tw(e,t,n,r,i,a,o,s,l,c,u,d,p,f){if(e.timeoutHandle=-1,(8192&(d=t.subtreeFlags)||!(16785408&~d))&&(_S={stylesheets:null,count:0,unsuspend:OS},$x(t),null!==(d=function(){if(null===_S)throw Error(Jc(475));var e=_S;return e.stylesheets&&0===e.count&&MS(e,e.stylesheets),0<e.count?function(t){var n=setTimeout(function(){if(e.stylesheets&&MS(e,e.stylesheets),e.unsuspend){var t=e.unsuspend;e.unsuspend=null,t()}},6e4);return e.unsuspend=t,function(){e.unsuspend=null,clearTimeout(n)}}:null}())))return e.cancelPendingCommit=d(qw.bind(null,e,t,a,n,r,i,o,s,l,u,1,p,f)),void Bw(e,a,o,!c);qw(e,t,a,n,r,i,o,s,l)}function Cw(e){for(var t=e;;){var n=t.tag;if((0===n||11===n||15===n)&&16384&t.flags&&null!==(n=t.updateQueue)&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],a=i.getSnapshot;i=i.value;try{if(!zf(a(),i))return!1}catch(tn){return!1}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Bw(e,t,n,r){t&=~aw,t&=~iw,e.suspendedLanes|=t,e.pingedLanes&=~t,r&&(e.warmLanes|=t),r=e.expirationTimes;for(var i=t;0<i;){var a=31-id(i),o=1<<a;r[a]=-1,i&=~o}0!==n&&bd(e,n,t)}function Pw(){return!!(6&qx)||(fv(0),!1)}function _w(){if(null!==Kx){if(0===Yx)var e=Kx.return;else cg=lg=null,Th(e=Kx),Ub=null,zb=0,e=Kx;for(;null!==e;)Gy(e.alternate,e),e=e.return;Kx=null}}function Ow(e,t){var n=e.timeoutHandle;-1!==n&&(e.timeoutHandle=-1,Zv(n)),null!==(n=e.cancelPendingCommit)&&(e.cancelPendingCommit=null,n()),_w(),Xx=e,Kx=n=Cm(e.current,null),Gx=t,Yx=0,Jx=null,Qx=!1,Zx=dd(e,t),ew=!1,sw=ow=aw=iw=rw=nw=0,cw=lw=null,uw=!1,8&t&&(t|=32&t);var r=e.entangledLanes;if(0!==r)for(e=e.entanglements,r&=t;0<r;){var i=31-id(r),a=1<<i;t|=e[i],r&=~a}return tw=t,xm(),n}function Lw(e,t){uh=null,Iu.H=Fb,t===Mg||t===$g?(t=jg(),Yx=3):t===Rg?(t=jg(),Yx=4):Yx=t===hy?8:null!==t&&"object"==typeof t&&"function"==typeof t.then?6:1,Jx=t,null===Kx&&(nw=1,dy(e,gm(t,e.current)))}function Fw(){var e=Iu.H;return Iu.H=Fb,null===e?Fb:e}function Mw(){var e=Iu.A;return Iu.A=jx,e}function Rw(){nw=4,Qx||(4194048&Gx)!==Gx&&null!==Kb.current||(Zx=!0),!(134217727&rw)&&!(134217727&iw)||null===Xx||Bw(Xx,Gx,ow,!1)}function $w(e,t,n){var r=qx;qx|=2;var i=Fw(),a=Mw();Xx===e&&Gx===t||(fw=null,Ow(e,t)),t=!1;var o=nw;e:for(;;)try{if(0!==Yx&&null!==Kx){var s=Kx,l=Jx;switch(Yx){case 8:_w(),o=6;break e;case 3:case 2:case 9:case 6:null===Kb.current&&(t=!0);var c=Yx;if(Yx=0,Jx=null,Ww(e,s,l,c),n&&Zx){o=0;break e}break;default:c=Yx,Yx=0,Jx=null,Ww(e,s,l,c)}}Uw(),o=nw;break}catch(u){Lw(e,u)}return t&&e.shellSuspendCounter++,cg=lg=null,qx=r,Iu.H=i,Iu.A=a,null===Kx&&(Xx=null,Gx=0,xm()),o}function Uw(){for(;null!==Kx;)Dw(Kx)}function zw(){for(;null!==Kx&&!ju();)Dw(Kx)}function Dw(e){var t=Dy(e.alternate,e,tw);e.memoizedProps=e.pendingProps,null===t?jw(e):Kx=t}function Hw(e){var t=e,n=t.alternate;switch(t.tag){case 15:case 0:t=Ay(n,t,t.pendingProps,t.type,void 0,Gx);break;case 11:t=Ay(n,t,t.pendingProps,t.type.render,t.ref,Gx);break;case 5:Th(t);default:Gy(n,t),t=Dy(n,t=Kx=Bm(t,tw),tw)}e.memoizedProps=e.pendingProps,null===t?jw(e):Kx=t}function Ww(e,t,n,r){cg=lg=null,Th(t),Ub=null,zb=0;var i=t.return;try{if(function(e,t,n,r,i){if(n.flags|=32768,null!==r&&"object"==typeof r&&"function"==typeof r.then){if(null!==(t=n.alternate)&&mg(t,n,i,!0),null!==(n=Kb.current)){switch(n.tag){case 13:return null===Gb?Rw():null===n.alternate&&0===nw&&(nw=3),n.flags&=-257,n.flags|=65536,n.lanes=i,r===Ug?n.flags|=16384:(null===(t=n.updateQueue)?n.updateQueue=new Set([r]):t.add(r),tv(e,r,i)),!1;case 22:return n.flags|=65536,r===Ug?n.flags|=16384:(null===(t=n.updateQueue)?(t={transitions:null,markerInstances:null,retryQueue:new Set([r])},n.updateQueue=t):null===(n=t.retryQueue)?t.retryQueue=new Set([r]):n.add(r),tv(e,r,i)),!1}throw Error(Jc(435,n.tag))}return tv(e,r,i),Rw(),!1}if(Ym)return null!==(t=Kb.current)?(!(65536&t.flags)&&(t.flags|=256),t.flags|=65536,t.lanes=i,r!==Zm&&og(gm(e=Error(Jc(422),{cause:r}),n))):(r!==Zm&&og(gm(t=Error(Jc(423),{cause:r}),n)),(e=e.current.alternate).flags|=65536,i&=-i,e.lanes|=i,r=gm(r,n),Qg(e,i=fy(e.stateNode,r,i)),4!==nw&&(nw=2)),!1;var a=Error(Jc(520),{cause:r});if(a=gm(a,n),null===lw?lw=[a]:lw.push(a),4!==nw&&(nw=2),null===t)return!0;r=gm(r,n),n=t;do{switch(n.tag){case 3:return n.flags|=65536,e=i&-i,n.lanes|=e,Qg(n,e=fy(n.stateNode,r,e)),!1;case 1:if(t=n.type,a=n.stateNode,!(128&n.flags||"function"!=typeof t.getDerivedStateFromError&&(null===a||"function"!=typeof a.componentDidCatch||null!==mw&&mw.has(a))))return n.flags|=65536,i&=-i,n.lanes|=i,gy(i=my(i),e,n,r),Qg(n,i),!1}n=n.return}while(null!==n);return!1}(e,i,t,n,Gx))return nw=1,dy(e,gm(n,e.current)),void(Kx=null)}catch(tn){if(null!==i)throw Kx=i,tn;return nw=1,dy(e,gm(n,e.current)),void(Kx=null)}32768&t.flags?(Ym||1===r?e=!0:Zx||536870912&Gx?e=!1:(Qx=e=!0,(2===r||9===r||3===r||6===r)&&null!==(r=Kb.current)&&13===r.tag&&(r.flags|=16384)),Vw(t,e)):jw(t)}function jw(e){var t=e;do{if(32768&t.flags)return void Vw(t,Qx);e=t.return;var n=Xy(t.alternate,t,tw);if(null!==n)return void(Kx=n);if(null!==(t=t.sibling))return void(Kx=t);Kx=t=e}while(null!==t);0===nw&&(nw=5)}function Vw(e,t){do{var n=Ky(e.alternate,e);if(null!==n)return n.flags&=32767,void(Kx=n);if(null!==(n=e.return)&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!t&&null!==(e=e.sibling))return void(Kx=e);Kx=e=n}while(null!==e);nw=6,Kx=null}function qw(e,t,n,r,i,a,o,s,l){e.cancelPendingCommit=null;do{Jw()}while(0!==gw);if(6&qx)throw Error(Jc(327));if(null!==t){if(t===e.current)throw Error(Jc(177));if(a=t.lanes|t.childLanes,function(e,t,n,r,i,a){var o=e.pendingLanes;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=n,e.entangledLanes&=n,e.errorRecoveryDisabledLanes&=n,e.shellSuspendCounter=0;var s=e.entanglements,l=e.expirationTimes,c=e.hiddenUpdates;for(n=o&~n;0<n;){var u=31-id(n),d=1<<u;s[u]=0,l[u]=-1;var p=c[u];if(null!==p)for(c[u]=null,u=0;u<p.length;u++){var f=p[u];null!==f&&(f.lane&=-536870913)}n&=~d}0!==r&&bd(e,r,0),0!==a&&0===i&&0!==e.tag&&(e.suspendedLanes|=a&~(o&~t))}(e,n,a|=ym,o,s,l),e===Xx&&(Kx=Xx=null,Gx=0),bw=t,hw=e,yw=n,xw=a,ww=i,vw=r,10256&t.subtreeFlags||10256&t.flags?(e.callbackNode=null,e.callbackPriority=0,Hu(Yu,function(){return Qw(),null})):(e.callbackNode=null,e.callbackPriority=0),r=!!(13878&t.flags),13878&t.subtreeFlags||r){r=Iu.T,Iu.T=null,i=Au.p,Au.p=2,o=qx,qx|=4;try{!function(e,t){if(e=e.containerInfo,Vv=qS,qf(e=Vf(e))){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var i=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{n.nodeType,a.nodeType}catch(g){n=null;break e}var o=0,s=-1,l=-1,c=0,u=0,d=e,p=null;t:for(;;){for(var f;d!==n||0!==i&&3!==d.nodeType||(s=o+i),d!==a||0!==r&&3!==d.nodeType||(l=o+r),3===d.nodeType&&(o+=d.nodeValue.length),null!==(f=d.firstChild);)p=d,d=f;for(;;){if(d===e)break t;if(p===n&&++c===i&&(s=o),p===a&&++u===r&&(l=o),null!==(f=d.nextSibling))break;p=(d=p).parentNode}d=f}n=-1===s||-1===l?null:{start:s,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(qv={focusedElem:e,selectionRange:n},qS=!1,fx=t;null!==fx;)if(e=(t=fx).child,1024&t.subtreeFlags&&null!==e)e.return=t,fx=e;else for(;null!==fx;){switch(a=(t=fx).alternate,e=t.flags,t.tag){case 0:case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(1024&e&&null!==a){e=void 0,n=t,i=a.memoizedProps,a=a.memoizedState,r=n.stateNode;try{var m=oy(n.type,i,(n.elementType,n.type));e=r.getSnapshotBeforeUpdate(m,a),r.__reactInternalSnapshotBeforeUpdate=e}catch(tn){ev(n,n.return,tn)}}break;case 3:if(1024&e)if(9===(n=(e=t.stateNode.containerInfo).nodeType))aS(e);else if(1===n)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":aS(e);break;default:e.textContent=""}break;default:if(1024&e)throw Error(Jc(163))}if(null!==(e=t.sibling)){e.return=t.return,fx=e;break}fx=t.return}}(e,t)}finally{qx=o,Au.p=i,Iu.T=r}}gw=1,Xw(),Kw(),Gw()}}function Xw(){if(1===gw){gw=0;var e=hw,t=bw,n=!!(13878&t.flags);if(13878&t.subtreeFlags||n){n=Iu.T,Iu.T=null;var r=Au.p;Au.p=2;var i=qx;qx|=4;try{Nx(t,e);var a=qv,o=Vf(e.containerInfo),s=a.focusedElem,l=a.selectionRange;if(o!==s&&s&&s.ownerDocument&&jf(s.ownerDocument.documentElement,s)){if(null!==l&&qf(s)){var c=l.start,u=l.end;if(void 0===u&&(u=c),"selectionStart"in s)s.selectionStart=c,s.selectionEnd=Math.min(u,s.value.length);else{var d=s.ownerDocument||document,p=d&&d.defaultView||window;if(p.getSelection){var f=p.getSelection(),m=s.textContent.length,g=Math.min(l.start,m),h=void 0===l.end?g:Math.min(l.end,m);!f.extend&&g>h&&(o=h,h=g,g=o);var b=Wf(s,g),y=Wf(s,h);if(b&&y&&(1!==f.rangeCount||f.anchorNode!==b.node||f.anchorOffset!==b.offset||f.focusNode!==y.node||f.focusOffset!==y.offset)){var x=d.createRange();x.setStart(b.node,b.offset),f.removeAllRanges(),g>h?(f.addRange(x),f.extend(y.node,y.offset)):(x.setEnd(y.node,y.offset),f.addRange(x))}}}}for(d=[],f=s;f=f.parentNode;)1===f.nodeType&&d.push({element:f,left:f.scrollLeft,top:f.scrollTop});for("function"==typeof s.focus&&s.focus(),s=0;s<d.length;s++){var w=d[s];w.element.scrollLeft=w.left,w.element.scrollTop=w.top}}qS=!!Vv,qv=Vv=null}finally{qx=i,Au.p=r,Iu.T=n}}e.current=t,gw=2}}function Kw(){if(2===gw){gw=0;var e=hw,t=bw,n=!!(8772&t.flags);if(8772&t.subtreeFlags||n){n=Iu.T,Iu.T=null;var r=Au.p;Au.p=2;var i=qx;qx|=4;try{mx(e,t.alternate,t)}finally{qx=i,Au.p=r,Iu.T=n}}gw=3}}function Gw(){if(4===gw||3===gw){gw=0,Vu();var e=hw,t=bw,n=yw,r=vw;10256&t.subtreeFlags||10256&t.flags?gw=5:(gw=0,bw=hw=null,Yw(e,e.pendingLanes));var i=e.pendingLanes;if(0===i&&(mw=null),wd(n),t=t.stateNode,nd&&"function"==typeof nd.onCommitFiberRoot)try{nd.onCommitFiberRoot(td,t,void 0,!(128&~t.current.flags))}catch(l){}if(null!==r){t=Iu.T,i=Au.p,Au.p=2,Iu.T=null;try{for(var a=e.onRecoverableError,o=0;o<r.length;o++){var s=r[o];a(s.value,{componentStack:s.stack})}}finally{Iu.T=t,Au.p=i}}3&yw&&Jw(),pv(e),i=e.pendingLanes,4194090&n&&42&i?e===Ew?Sw++:(Sw=0,Ew=e):Sw=0,fv(0)}}function Yw(e,t){0===(e.pooledCacheLanes&=t)&&null!=(t=e.pooledCache)&&(e.pooledCache=null,Ig(t))}function Jw(e){return Xw(),Kw(),Gw(),Qw()}function Qw(){if(5!==gw)return!1;var e=hw,t=xw;xw=0;var n=wd(yw),r=Iu.T,i=Au.p;try{Au.p=32>n?32:n,Iu.T=null,n=ww,ww=null;var a=hw,o=yw;if(gw=0,bw=hw=null,yw=0,6&qx)throw Error(Jc(331));var s=qx;if(qx|=4,Dx(a.current),Ox(a,a.current,o,n),qx=s,fv(0),nd&&"function"==typeof nd.onPostCommitFiberRoot)try{nd.onPostCommitFiberRoot(td,a)}catch(l){}return!0}finally{Au.p=i,Iu.T=r,Yw(e,t)}}function Zw(e,t,n){t=gm(n,t),null!==(e=Yg(e,t=fy(e.stateNode,t,2),2))&&(hd(e,2),pv(e))}function ev(e,t,n){if(3===e.tag)Zw(e,e,n);else for(;null!==t;){if(3===t.tag){Zw(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof r.componentDidCatch&&(null===mw||!mw.has(r))){e=gm(n,e),null!==(r=Yg(t,n=my(2),2))&&(gy(n,r,t,e),hd(r,2),pv(r));break}}t=t.return}}function tv(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new Vx;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(ew=!0,i.add(n),e=nv.bind(null,e,t,n),t.then(e,e))}function nv(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),e.pingedLanes|=e.suspendedLanes&n,e.warmLanes&=~n,Xx===e&&(Gx&n)===n&&(4===nw||3===nw&&(62914560&Gx)===Gx&&300>qu()-dw?!(2&qx)&&Ow(e,0):aw|=n,sw===Gx&&(sw=0)),pv(e)}function rv(e,t){0===t&&(t=md()),null!==(e=Sm(e,t))&&(hd(e,t),pv(e))}function iv(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),rv(e,n)}function av(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:r=e.stateNode;break;case 22:r=e.stateNode._retryCache;break;default:throw Error(Jc(314))}null!==r&&r.delete(t),rv(e,n)}var ov=null,sv=null,lv=!1,cv=!1,uv=!1,dv=0;function pv(e){e!==sv&&null===e.next&&(null===sv?ov=sv=e:sv=sv.next=e),cv=!0,lv||(lv=!0,tS(function(){6&qx?Hu(Ku,mv):gv()}))}function fv(e,t){if(!uv&&cv){uv=!0;do{for(var n=!1,r=ov;null!==r;){if(0!==e){var i=r.pendingLanes;if(0===i)var a=0;else{var o=r.suspendedLanes,s=r.pingedLanes;a=(1<<31-id(42|e)+1)-1,a=201326741&(a&=i&~(o&~s))?201326741&a|1:a?2|a:0}0!==a&&(n=!0,yv(r,a))}else a=Gx,!(3&(a=ud(r,r===Xx?a:0,null!==r.cancelPendingCommit||-1!==r.timeoutHandle)))||dd(r,a)||(n=!0,yv(r,a));r=r.next}}while(n);uv=!1}}function mv(){gv()}function gv(){cv=lv=!1;var e,t=0;0!==dv&&(((e=window.event)&&"popstate"===e.type?e!==Jv&&(Jv=e,!0):(Jv=null,!1))&&(t=dv),dv=0);for(var n=qu(),r=null,i=ov;null!==i;){var a=i.next,o=hv(i,n);0===o?(i.next=null,null===r?ov=a:r.next=a,null===a&&(sv=r)):(r=i,(0!==t||3&o)&&(cv=!0)),i=a}fv(t)}function hv(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,a=-62914561&e.pendingLanes;0<a;){var o=31-id(a),s=1<<o,l=i[o];-1===l?0!==(s&n)&&0===(s&r)||(i[o]=pd(s,t)):l<=t&&(e.expiredLanes|=s),a&=~s}if(n=Gx,n=ud(e,e===(t=Xx)?n:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle),r=e.callbackNode,0===n||e===t&&(2===Yx||9===Yx)||null!==e.cancelPendingCommit)return null!==r&&null!==r&&Wu(r),e.callbackNode=null,e.callbackPriority=0;if(!(3&n)||dd(e,n)){if((t=n&-n)===e.callbackPriority)return t;switch(null!==r&&Wu(r),wd(n)){case 2:case 8:n=Gu;break;case 32:default:n=Yu;break;case 268435456:n=Qu}return r=bv.bind(null,e),n=Hu(n,r),e.callbackPriority=t,e.callbackNode=n,t}return null!==r&&null!==r&&Wu(r),e.callbackPriority=2,e.callbackNode=null,2}function bv(e,t){if(0!==gw&&5!==gw)return e.callbackNode=null,e.callbackPriority=0,null;var n=e.callbackNode;if(Jw()&&e.callbackNode!==n)return null;var r=Gx;return 0===(r=ud(e,e===Xx?r:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle))?null:(kw(e,r,t),hv(e,qu()),null!=e.callbackNode&&e.callbackNode===n?bv.bind(null,e):null)}function yv(e,t){if(Jw())return null;kw(e,t,!0)}function xv(){return 0===dv&&(dv=fd()),dv}function wv(e){return null==e||"symbol"==typeof e||"boolean"==typeof e?null:"function"==typeof e?e:wp(""+e)}function vv(e,t){var n=t.ownerDocument.createElement("input");return n.name=t.name,n.value=t.value,e.id&&n.setAttribute("form",e.id),t.parentNode.insertBefore(n,t),e=new FormData(e),n.parentNode.removeChild(n),e}for(var Sv=0;Sv<pm.length;Sv++){var Ev=pm[Sv];fm(Ev.toLowerCase(),"on"+(Ev[0].toUpperCase()+Ev.slice(1)))}fm(im,"onAnimationEnd"),fm(am,"onAnimationIteration"),fm(om,"onAnimationStart"),fm("dblclick","onDoubleClick"),fm("focusin","onFocus"),fm("focusout","onBlur"),fm(sm,"onTransitionRun"),fm(lm,"onTransitionStart"),fm(cm,"onTransitionCancel"),fm(um,"onTransitionEnd"),zd("onMouseEnter",["mouseout","mouseover"]),zd("onMouseLeave",["mouseout","mouseover"]),zd("onPointerEnter",["pointerout","pointerover"]),zd("onPointerLeave",["pointerout","pointerover"]),Ud("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ud("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ud("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ud("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ud("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ud("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Nv="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Iv=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Nv));function Av(e,t){t=!!(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var o=r.length-1;0<=o;o--){var s=r[o],l=s.instance,c=s.currentTarget;if(s=s.listener,l!==a&&i.isPropagationStopped())break e;a=s,i.currentTarget=c;try{a(i)}catch(tn){sy(tn)}i.currentTarget=null,a=l}else for(o=0;o<r.length;o++){if(l=(s=r[o]).instance,c=s.currentTarget,s=s.listener,l!==a&&i.isPropagationStopped())break e;a=s,i.currentTarget=c;try{a(i)}catch(tn){sy(tn)}i.currentTarget=null,a=l}}}}function kv(e,t){var n=t[Ad];void 0===n&&(n=t[Ad]=new Set);var r=e+"__bubble";n.has(r)||(Pv(t,e,2,!1),n.add(r))}function Tv(e,t,n){var r=0;t&&(r|=4),Pv(n,e,r,t)}var Cv="_reactListening"+Math.random().toString(36).slice(2);function Bv(e){if(!e[Cv]){e[Cv]=!0,Rd.forEach(function(t){"selectionchange"!==t&&(Iv.has(t)||Tv(t,!1,e),Tv(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Cv]||(t[Cv]=!0,Tv("selectionchange",!1,t))}}function Pv(e,t,n,r){switch(ZS(t)){case 2:var i=XS;break;case 8:i=KS;break;default:i=GS}n=i.bind(null,t,n,e),i=void 0,!Bp||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function _v(e,t,n,r,i){var a=r;if(!(1&t||2&t||null===r))e:for(;;){if(null===r)return;var o=r.tag;if(3===o||4===o){var s=r.stateNode.containerInfo;if(s===i)break;if(4===o)for(o=r.return;null!==o;){var l=o.tag;if((3===l||4===l)&&o.stateNode.containerInfo===i)return;o=o.return}for(;null!==s;){if(null===(o=_d(s)))return;if(5===(l=o.tag)||6===l||26===l||27===l){r=a=o;continue e}s=s.parentNode}}r=r.return}kp(function(){var r=a,i=Sp(n),o=[];e:{var s=dm.get(e);if(void 0!==s){var l=jp,c=e;switch(e){case"keypress":if(0===Mp(n))break e;case"keydown":case"keyup":l=of;break;case"focusin":c="focus",l=Yp;break;case"focusout":c="blur",l=Yp;break;case"beforeblur":case"afterblur":l=Yp;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=Kp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=Gp;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=lf;break;case im:case am:case om:l=Jp;break;case um:l=cf;break;case"scroll":case"scrollend":l=qp;break;case"wheel":l=uf;break;case"copy":case"cut":case"paste":l=Qp;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=sf;break;case"toggle":case"beforetoggle":l=df}var u=!!(4&t),d=!u&&("scroll"===e||"scrollend"===e),p=u?null!==s?s+"Capture":null:s;u=[];for(var f,m=r;null!==m;){var g=m;if(f=g.stateNode,5!==(g=g.tag)&&26!==g&&27!==g||null===f||null===p||null!=(g=Tp(m,p))&&u.push(Ov(m,g,f)),d)break;m=m.return}0<u.length&&(s=new l(s,c,null,n,i),o.push({event:s,listeners:u}))}}if(!(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===vp||!(c=n.relatedTarget||n.fromElement)||!_d(c)&&!c[Id])&&(l||s)&&(s=i.window===i?i:(s=i.ownerDocument)?s.defaultView||s.parentWindow:window,l?(l=r,null!==(c=(c=n.relatedTarget||n.toElement)?_d(c):null)&&(d=Zc(c),u=c.tag,c!==d||5!==u&&27!==u&&6!==u)&&(c=null)):(l=null,c=r),l!==c)){if(u=Kp,g="onMouseLeave",p="onMouseEnter",m="mouse","pointerout"!==e&&"pointerover"!==e||(u=sf,g="onPointerLeave",p="onPointerEnter",m="pointer"),d=null==l?s:Ld(l),f=null==c?s:Ld(c),(s=new u(g,m+"leave",l,n,i)).target=d,s.relatedTarget=f,g=null,_d(i)===r&&((u=new u(p,m+"enter",c,n,i)).target=f,u.relatedTarget=d,g=u),d=g,l&&c)e:{for(p=c,m=0,f=u=l;f;f=Fv(f))m++;for(f=0,g=p;g;g=Fv(g))f++;for(;0<m-f;)u=Fv(u),m--;for(;0<f-m;)p=Fv(p),f--;for(;m--;){if(u===p||null!==p&&u===p.alternate)break e;u=Fv(u),p=Fv(p)}u=null}else u=null;null!==l&&Mv(o,s,l,u,!1),null!==c&&null!==d&&Mv(o,d,c,u,!0)}if("select"===(l=(s=r?Ld(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===l&&"file"===s.type)var h=Cf;else if(Ef(s))if(Bf)h=Uf;else{h=Rf;var b=Mf}else!(l=s.nodeName)||"input"!==l.toLowerCase()||"checkbox"!==s.type&&"radio"!==s.type?r&&bp(r.elementType)&&(h=Cf):h=$f;switch(h&&(h=h(e,r))?Nf(o,h,n,i):(b&&b(e,s,r),"focusout"===e&&r&&"number"===s.type&&null!=r.memoizedProps.value&&cp(s,"number",s.value)),b=r?Ld(r):window,e){case"focusin":(Ef(b)||"true"===b.contentEditable)&&(Kf=b,Gf=r,Yf=null);break;case"focusout":Yf=Gf=Kf=null;break;case"mousedown":Jf=!0;break;case"contextmenu":case"mouseup":case"dragend":Jf=!1,Qf(o,n,i);break;case"selectionchange":if(Xf)break;case"keydown":case"keyup":Qf(o,n,i)}var y;if(ff)e:{switch(e){case"compositionstart":var x="onCompositionStart";break e;case"compositionend":x="onCompositionEnd";break e;case"compositionupdate":x="onCompositionUpdate";break e}x=void 0}else vf?xf(e,n)&&(x="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(x="onCompositionStart");x&&(hf&&"ko"!==n.locale&&(vf||"onCompositionStart"!==x?"onCompositionEnd"===x&&vf&&(y=Fp()):(Op="value"in(_p=i)?_p.value:_p.textContent,vf=!0)),0<(b=Lv(r,x)).length&&(x=new Zp(x,e,null,n,i),o.push({event:x,listeners:b}),(y||null!==(y=wf(n)))&&(x.data=y))),(y=gf?function(e,t){switch(e){case"compositionend":return wf(t);case"keypress":return 32!==t.which?null:(yf=!0,bf);case"textInput":return(e=t.data)===bf&&yf?null:e;default:return null}}(e,n):function(e,t){if(vf)return"compositionend"===e||!ff&&xf(e,t)?(e=Fp(),Lp=Op=_p=null,vf=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return hf&&"ko"!==t.locale?null:t.data}}(e,n))&&0<(x=Lv(r,"onBeforeInput")).length&&(b=new Zp("onBeforeInput","beforeinput",null,n,i),o.push({event:b,listeners:x}),b.data=y),function(e,t,n,r,i){if("submit"===t&&n&&n.stateNode===i){var a=wv((i[Nd]||null).action),o=r.submitter;o&&null!==(t=(t=o[Nd]||null)?wv(t.formAction):o.getAttribute("formAction"))&&(a=t,o=null);var s=new jp("action","action",null,r,i);e.push({event:s,listeners:[{instance:null,listener:function(){if(r.defaultPrevented){if(0!==dv){var e=o?vv(i,o):new FormData(i);vb(n,{pending:!0,data:e,method:i.method,action:a},null,e)}}else"function"==typeof a&&(s.preventDefault(),e=o?vv(i,o):new FormData(i),vb(n,{pending:!0,data:e,method:i.method,action:a},a,e))},currentTarget:i}]})}}(o,e,r,n,i)}Av(o,t)})}function Ov(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Lv(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,a=i.stateNode;if(5!==(i=i.tag)&&26!==i&&27!==i||null===a||(null!=(i=Tp(e,n))&&r.unshift(Ov(e,i,a)),null!=(i=Tp(e,t))&&r.push(Ov(e,i,a))),3===e.tag)return r;e=e.return}return[]}function Fv(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag&&27!==e.tag);return e||null}function Mv(e,t,n,r,i){for(var a=t._reactName,o=[];null!==n&&n!==r;){var s=n,l=s.alternate,c=s.stateNode;if(s=s.tag,null!==l&&l===r)break;5!==s&&26!==s&&27!==s||null===c||(l=c,i?null!=(c=Tp(n,a))&&o.unshift(Ov(n,c,l)):i||null!=(c=Tp(n,a))&&o.push(Ov(n,c,l))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}var Rv=/\r\n?/g,$v=/\u0000|\uFFFD/g;function Uv(e){return("string"==typeof e?e:""+e).replace(Rv,"\n").replace($v,"")}function zv(e,t){return t=Uv(t),Uv(e)===t}function Dv(){}function Hv(e,t,n,r,i,a){switch(n){case"children":"string"==typeof r?"body"===t||"textarea"===t&&""===r||fp(e,r):("number"==typeof r||"bigint"==typeof r)&&"body"!==t&&fp(e,""+r);break;case"className":Xd(e,"class",r);break;case"tabIndex":Xd(e,"tabindex",r);break;case"dir":case"role":case"viewBox":case"width":case"height":Xd(e,n,r);break;case"style":hp(e,r,a);break;case"data":if("object"!==t){Xd(e,"data",r);break}case"src":case"href":if(""===r&&("a"!==t||"href"!==n)){e.removeAttribute(n);break}if(null==r||"function"==typeof r||"symbol"==typeof r||"boolean"==typeof r){e.removeAttribute(n);break}r=wp(""+r),e.setAttribute(n,r);break;case"action":case"formAction":if("function"==typeof r){e.setAttribute(n,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"==typeof a&&("formAction"===n?("input"!==t&&Hv(e,t,"name",i.name,i,null),Hv(e,t,"formEncType",i.formEncType,i,null),Hv(e,t,"formMethod",i.formMethod,i,null),Hv(e,t,"formTarget",i.formTarget,i,null)):(Hv(e,t,"encType",i.encType,i,null),Hv(e,t,"method",i.method,i,null),Hv(e,t,"target",i.target,i,null))),null==r||"symbol"==typeof r||"boolean"==typeof r){e.removeAttribute(n);break}r=wp(""+r),e.setAttribute(n,r);break;case"onClick":null!=r&&(e.onclick=Dv);break;case"onScroll":null!=r&&kv("scroll",e);break;case"onScrollEnd":null!=r&&kv("scrollend",e);break;case"dangerouslySetInnerHTML":if(null!=r){if("object"!=typeof r||!("__html"in r))throw Error(Jc(61));if(null!=(n=r.__html)){if(null!=i.children)throw Error(Jc(60));e.innerHTML=n}}break;case"multiple":e.multiple=r&&"function"!=typeof r&&"symbol"!=typeof r;break;case"muted":e.muted=r&&"function"!=typeof r&&"symbol"!=typeof r;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":break;case"xlinkHref":if(null==r||"function"==typeof r||"boolean"==typeof r||"symbol"==typeof r){e.removeAttribute("xlink:href");break}n=wp(""+r),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=r&&"function"!=typeof r&&"symbol"!=typeof r?e.setAttribute(n,""+r):e.removeAttribute(n);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":r&&"function"!=typeof r&&"symbol"!=typeof r?e.setAttribute(n,""):e.removeAttribute(n);break;case"capture":case"download":!0===r?e.setAttribute(n,""):!1!==r&&null!=r&&"function"!=typeof r&&"symbol"!=typeof r?e.setAttribute(n,r):e.removeAttribute(n);break;case"cols":case"rows":case"size":case"span":null!=r&&"function"!=typeof r&&"symbol"!=typeof r&&!isNaN(r)&&1<=r?e.setAttribute(n,r):e.removeAttribute(n);break;case"rowSpan":case"start":null==r||"function"==typeof r||"symbol"==typeof r||isNaN(r)?e.removeAttribute(n):e.setAttribute(n,r);break;case"popover":kv("beforetoggle",e),kv("toggle",e),qd(e,"popover",r);break;case"xlinkActuate":Kd(e,"http://www.w3.org/1999/xlink","xlink:actuate",r);break;case"xlinkArcrole":Kd(e,"http://www.w3.org/1999/xlink","xlink:arcrole",r);break;case"xlinkRole":Kd(e,"http://www.w3.org/1999/xlink","xlink:role",r);break;case"xlinkShow":Kd(e,"http://www.w3.org/1999/xlink","xlink:show",r);break;case"xlinkTitle":Kd(e,"http://www.w3.org/1999/xlink","xlink:title",r);break;case"xlinkType":Kd(e,"http://www.w3.org/1999/xlink","xlink:type",r);break;case"xmlBase":Kd(e,"http://www.w3.org/XML/1998/namespace","xml:base",r);break;case"xmlLang":Kd(e,"http://www.w3.org/XML/1998/namespace","xml:lang",r);break;case"xmlSpace":Kd(e,"http://www.w3.org/XML/1998/namespace","xml:space",r);break;case"is":qd(e,"is",r);break;case"innerText":case"textContent":break;default:(!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])&&qd(e,n=yp.get(n)||n,r)}}function Wv(e,t,n,r,i,a){switch(n){case"style":hp(e,r,a);break;case"dangerouslySetInnerHTML":if(null!=r){if("object"!=typeof r||!("__html"in r))throw Error(Jc(61));if(null!=(n=r.__html)){if(null!=i.children)throw Error(Jc(60));e.innerHTML=n}}break;case"children":"string"==typeof r?fp(e,r):("number"==typeof r||"bigint"==typeof r)&&fp(e,""+r);break;case"onScroll":null!=r&&kv("scroll",e);break;case"onScrollEnd":null!=r&&kv("scrollend",e);break;case"onClick":null!=r&&(e.onclick=Dv);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break;default:$d.hasOwnProperty(n)||("o"!==n[0]||"n"!==n[1]||(i=n.endsWith("Capture"),t=n.slice(2,i?n.length-7:void 0),"function"==typeof(a=null!=(a=e[Nd]||null)?a[n]:null)&&e.removeEventListener(t,a,i),"function"!=typeof r)?n in e?e[n]=r:!0===r?e.setAttribute(n,""):qd(e,n,r):("function"!=typeof a&&null!==a&&(n in e?e[n]=null:e.hasAttribute(n)&&e.removeAttribute(n)),e.addEventListener(t,r,i)))}}function jv(e,t,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":kv("error",e),kv("load",e);var r,i=!1,a=!1;for(r in n)if(n.hasOwnProperty(r)){var o=n[r];if(null!=o)switch(r){case"src":i=!0;break;case"srcSet":a=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(Jc(137,t));default:Hv(e,t,r,o,n,null)}}return a&&Hv(e,t,"srcSet",n.srcSet,n,null),void(i&&Hv(e,t,"src",n.src,n,null));case"input":kv("invalid",e);var s=r=o=a=null,l=null,c=null;for(i in n)if(n.hasOwnProperty(i)){var u=n[i];if(null!=u)switch(i){case"name":a=u;break;case"type":o=u;break;case"checked":l=u;break;case"defaultChecked":c=u;break;case"value":r=u;break;case"defaultValue":s=u;break;case"children":case"dangerouslySetInnerHTML":if(null!=u)throw Error(Jc(137,t));break;default:Hv(e,t,i,u,n,null)}}return lp(e,r,s,l,c,o,a,!1),void np(e);case"select":for(a in kv("invalid",e),i=o=r=null,n)if(n.hasOwnProperty(a)&&null!=(s=n[a]))switch(a){case"value":r=s;break;case"defaultValue":o=s;break;case"multiple":i=s;default:Hv(e,t,a,s,n,null)}return t=r,n=o,e.multiple=!!i,void(null!=t?up(e,!!i,t,!1):null!=n&&up(e,!!i,n,!0));case"textarea":for(o in kv("invalid",e),r=a=i=null,n)if(n.hasOwnProperty(o)&&null!=(s=n[o]))switch(o){case"value":i=s;break;case"defaultValue":a=s;break;case"children":r=s;break;case"dangerouslySetInnerHTML":if(null!=s)throw Error(Jc(91));break;default:Hv(e,t,o,s,n,null)}return pp(e,i,a,r),void np(e);case"option":for(l in n)n.hasOwnProperty(l)&&null!=(i=n[l])&&("selected"===l?e.selected=i&&"function"!=typeof i&&"symbol"!=typeof i:Hv(e,t,l,i,n,null));return;case"dialog":kv("beforetoggle",e),kv("toggle",e),kv("cancel",e),kv("close",e);break;case"iframe":case"object":kv("load",e);break;case"video":case"audio":for(i=0;i<Nv.length;i++)kv(Nv[i],e);break;case"image":kv("error",e),kv("load",e);break;case"details":kv("toggle",e);break;case"embed":case"source":case"link":kv("error",e),kv("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(c in n)if(n.hasOwnProperty(c)&&null!=(i=n[c]))switch(c){case"children":case"dangerouslySetInnerHTML":throw Error(Jc(137,t));default:Hv(e,t,c,i,n,null)}return;default:if(bp(t)){for(u in n)n.hasOwnProperty(u)&&void 0!==(i=n[u])&&Wv(e,t,u,i,n,void 0);return}}for(s in n)n.hasOwnProperty(s)&&null!=(i=n[s])&&Hv(e,t,s,i,n,null)}var Vv=null,qv=null;function Xv(e){return 9===e.nodeType?e:e.ownerDocument}function Kv(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Gv(e,t){if(0===e)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return 1===e&&"foreignObject"===t?0:e}function Yv(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"bigint"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var Jv=null,Qv="function"==typeof setTimeout?setTimeout:void 0,Zv="function"==typeof clearTimeout?clearTimeout:void 0,eS="function"==typeof Promise?Promise:void 0,tS="function"==typeof queueMicrotask?queueMicrotask:void 0!==eS?function(e){return eS.resolve(null).then(e).catch(nS)}:Qv;function nS(e){setTimeout(function(){throw e})}function rS(e){return"head"===e}function iS(e,t){var n=t,r=0,i=0;do{var a=n.nextSibling;if(e.removeChild(n),a&&8===a.nodeType)if("/$"===(n=a.data)){if(0<r&&8>r){n=r;var o=e.ownerDocument;if(1&n&&dS(o.documentElement),2&n&&dS(o.body),4&n)for(dS(n=o.head),o=n.firstChild;o;){var s=o.nextSibling,l=o.nodeName;o[Bd]||"SCRIPT"===l||"STYLE"===l||"LINK"===l&&"stylesheet"===o.rel.toLowerCase()||n.removeChild(o),o=s}}if(0===i)return e.removeChild(a),void bE(t);i--}else"$"===n||"$?"===n||"$!"===n?i++:r=n.charCodeAt(0)-48;else r=0;n=a}while(n);bE(t)}function aS(e){var t=e.firstChild;for(t&&10===t.nodeType&&(t=t.nextSibling);t;){var n=t;switch(t=t.nextSibling,n.nodeName){case"HTML":case"HEAD":case"BODY":aS(n),Pd(n);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===n.rel.toLowerCase())continue}e.removeChild(n)}}function oS(e){return"$!"===e.data||"$?"===e.data&&"complete"===e.ownerDocument.readyState}function sS(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t||"F!"===t||"F"===t)break;if("/$"===t)return null}}return e}var lS=null;function cS(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}function uS(e,t,n){switch(t=Xv(n),e){case"html":if(!(e=t.documentElement))throw Error(Jc(452));return e;case"head":if(!(e=t.head))throw Error(Jc(453));return e;case"body":if(!(e=t.body))throw Error(Jc(454));return e;default:throw Error(Jc(451))}}function dS(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);Pd(e)}var pS=new Map,fS=new Set;function mS(e){return"function"==typeof e.getRootNode?e.getRootNode():9===e.nodeType?e:e.ownerDocument}var gS=Au.d;Au.d={f:function(){var e=gS.f(),t=Pw();return e||t},r:function(e){var t=Od(e);null!==t&&5===t.tag&&"form"===t.type?Eb(t):gS.r(e)},D:function(e){gS.D(e),bS("dns-prefetch",e,null)},C:function(e,t){gS.C(e,t),bS("preconnect",e,t)},L:function(e,t,n){gS.L(e,t,n);var r=hS;if(r&&e&&t){var i='link[rel="preload"][as="'+op(t)+'"]';"image"===t&&n&&n.imageSrcSet?(i+='[imagesrcset="'+op(n.imageSrcSet)+'"]',"string"==typeof n.imageSizes&&(i+='[imagesizes="'+op(n.imageSizes)+'"]')):i+='[href="'+op(e)+'"]';var a=i;switch(t){case"style":a=xS(e);break;case"script":a=SS(e)}pS.has(a)||(e=ru({rel:"preload",href:"image"===t&&n&&n.imageSrcSet?void 0:e,as:t},n),pS.set(a,e),null!==r.querySelector(i)||"style"===t&&r.querySelector(wS(a))||"script"===t&&r.querySelector(ES(a))||(jv(t=r.createElement("link"),"link",e),Md(t),r.head.appendChild(t)))}},m:function(e,t){gS.m(e,t);var n=hS;if(n&&e){var r=t&&"string"==typeof t.as?t.as:"script",i='link[rel="modulepreload"][as="'+op(r)+'"][href="'+op(e)+'"]',a=i;switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":a=SS(e)}if(!pS.has(a)&&(e=ru({rel:"modulepreload",href:e},t),pS.set(a,e),null===n.querySelector(i))){switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(n.querySelector(ES(a)))return}jv(r=n.createElement("link"),"link",e),Md(r),n.head.appendChild(r)}}},X:function(e,t){gS.X(e,t);var n=hS;if(n&&e){var r=Fd(n).hoistableScripts,i=SS(e),a=r.get(i);a||((a=n.querySelector(ES(i)))||(e=ru({src:e,async:!0},t),(t=pS.get(i))&&kS(e,t),Md(a=n.createElement("script")),jv(a,"link",e),n.head.appendChild(a)),a={type:"script",instance:a,count:1,state:null},r.set(i,a))}},S:function(e,t,n){gS.S(e,t,n);var r=hS;if(r&&e){var i=Fd(r).hoistableStyles,a=xS(e);t=t||"default";var o=i.get(a);if(!o){var s={loading:0,preload:null};if(o=r.querySelector(wS(a)))s.loading=5;else{e=ru({rel:"stylesheet",href:e,"data-precedence":t},n),(n=pS.get(a))&&AS(e,n);var l=o=r.createElement("link");Md(l),jv(l,"link",e),l._p=new Promise(function(e,t){l.onload=e,l.onerror=t}),l.addEventListener("load",function(){s.loading|=1}),l.addEventListener("error",function(){s.loading|=2}),s.loading|=4,IS(o,t,r)}o={type:"stylesheet",instance:o,count:1,state:s},i.set(a,o)}}},M:function(e,t){gS.M(e,t);var n=hS;if(n&&e){var r=Fd(n).hoistableScripts,i=SS(e),a=r.get(i);a||((a=n.querySelector(ES(i)))||(e=ru({src:e,async:!0,type:"module"},t),(t=pS.get(i))&&kS(e,t),Md(a=n.createElement("script")),jv(a,"link",e),n.head.appendChild(a)),a={type:"script",instance:a,count:1,state:null},r.set(i,a))}}};var hS="undefined"==typeof document?null:document;function bS(e,t,n){var r=hS;if(r&&"string"==typeof t&&t){var i=op(t);i='link[rel="'+e+'"][href="'+i+'"]',"string"==typeof n&&(i+='[crossorigin="'+n+'"]'),fS.has(i)||(fS.add(i),e={rel:e,crossOrigin:n,href:t},null===r.querySelector(i)&&(jv(t=r.createElement("link"),"link",e),Md(t),r.head.appendChild(t)))}}function yS(e,t,n,r){var i,a,o,s,l=(l=Fu.current)?mS(l):null;if(!l)throw Error(Jc(446));switch(e){case"meta":case"title":return null;case"style":return"string"==typeof n.precedence&&"string"==typeof n.href?(t=xS(n.href),(r=(n=Fd(l).hoistableStyles).get(t))||(r={type:"style",instance:null,count:0,state:null},n.set(t,r)),r):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===n.rel&&"string"==typeof n.href&&"string"==typeof n.precedence){e=xS(n.href);var c=Fd(l).hoistableStyles,u=c.get(e);if(u||(l=l.ownerDocument||l,u={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},c.set(e,u),(c=l.querySelector(wS(e)))&&!c._p&&(u.instance=c,u.state.loading=5),pS.has(e)||(n={rel:"preload",as:"style",href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},pS.set(e,n),c||(i=l,a=e,o=n,s=u.state,i.querySelector('link[rel="preload"][as="style"]['+a+"]")?s.loading=1:(a=i.createElement("link"),s.preload=a,a.addEventListener("load",function(){return s.loading|=1}),a.addEventListener("error",function(){return s.loading|=2}),jv(a,"link",o),Md(a),i.head.appendChild(a))))),t&&null===r)throw Error(Jc(528,""));return u}if(t&&null!==r)throw Error(Jc(529,""));return null;case"script":return t=n.async,"string"==typeof(n=n.src)&&t&&"function"!=typeof t&&"symbol"!=typeof t?(t=SS(n),(r=(n=Fd(l).hoistableScripts).get(t))||(r={type:"script",instance:null,count:0,state:null},n.set(t,r)),r):{type:"void",instance:null,count:0,state:null};default:throw Error(Jc(444,e))}}function xS(e){return'href="'+op(e)+'"'}function wS(e){return'link[rel="stylesheet"]['+e+"]"}function vS(e){return ru({},e,{"data-precedence":e.precedence,precedence:null})}function SS(e){return'[src="'+op(e)+'"]'}function ES(e){return"script[async]"+e}function NS(e,t,n){if(t.count++,null===t.instance)switch(t.type){case"style":var r=e.querySelector('style[data-href~="'+op(n.href)+'"]');if(r)return t.instance=r,Md(r),r;var i=ru({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return Md(r=(e.ownerDocument||e).createElement("style")),jv(r,"style",i),IS(r,n.precedence,e),t.instance=r;case"stylesheet":i=xS(n.href);var a=e.querySelector(wS(i));if(a)return t.state.loading|=4,t.instance=a,Md(a),a;r=vS(n),(i=pS.get(i))&&AS(r,i),Md(a=(e.ownerDocument||e).createElement("link"));var o=a;return o._p=new Promise(function(e,t){o.onload=e,o.onerror=t}),jv(a,"link",r),t.state.loading|=4,IS(a,n.precedence,e),t.instance=a;case"script":return a=SS(n.src),(i=e.querySelector(ES(a)))?(t.instance=i,Md(i),i):(r=n,(i=pS.get(a))&&kS(r=ru({},n),i),Md(i=(e=e.ownerDocument||e).createElement("script")),jv(i,"link",r),e.head.appendChild(i),t.instance=i);case"void":return null;default:throw Error(Jc(443,t.type))}else"stylesheet"===t.type&&!(4&t.state.loading)&&(r=t.instance,t.state.loading|=4,IS(r,n.precedence,e));return t.instance}function IS(e,t,n){for(var r=n.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),i=r.length?r[r.length-1]:null,a=i,o=0;o<r.length;o++){var s=r[o];if(s.dataset.precedence===t)a=s;else if(a!==i)break}a?a.parentNode.insertBefore(e,a.nextSibling):(t=9===n.nodeType?n.head:n).insertBefore(e,t.firstChild)}function AS(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.title&&(e.title=t.title)}function kS(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.integrity&&(e.integrity=t.integrity)}var TS=null;function CS(e,t,n){if(null===TS){var r=new Map,i=TS=new Map;i.set(n,r)}else(r=(i=TS).get(n))||(r=new Map,i.set(n,r));if(r.has(e))return r;for(r.set(e,null),n=n.getElementsByTagName(e),i=0;i<n.length;i++){var a=n[i];if(!(a[Bd]||a[Ed]||"link"===e&&"stylesheet"===a.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==a.namespaceURI){var o=a.getAttribute(t)||"";o=e+o;var s=r.get(o);s?s.push(a):r.set(o,[a])}}return r}function BS(e,t,n){(e=e.ownerDocument||e).head.insertBefore(n,"title"===t?e.querySelector("head > title"):null)}function PS(e){return!!("stylesheet"!==e.type||3&e.state.loading)}var _S=null;function OS(){}function LS(){if(this.count--,0===this.count)if(this.stylesheets)MS(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}var FS=null;function MS(e,t){e.stylesheets=null,null!==e.unsuspend&&(e.count++,FS=new Map,t.forEach(RS,e),FS=null,LS.call(e))}function RS(e,t){if(!(4&t.state.loading)){var n=FS.get(e);if(n)var r=n.get(null);else{n=new Map,FS.set(e,n);for(var i=e.querySelectorAll("link[data-precedence],style[data-precedence]"),a=0;a<i.length;a++){var o=i[a];"LINK"!==o.nodeName&&"not all"===o.getAttribute("media")||(n.set(o.dataset.precedence,o),r=o)}r&&n.set(null,r)}o=(i=t.instance).getAttribute("data-precedence"),(a=n.get(o)||r)===r&&n.set(null,i),n.set(o,i),this.count++,r=LS.bind(this),i.addEventListener("load",r),i.addEventListener("error",r),a?a.parentNode.insertBefore(i,a.nextSibling):(e=9===e.nodeType?e.head:e).insertBefore(i,e.firstChild),t.state.loading|=4}}var $S={$$typeof:pu,Provider:null,Consumer:null,_currentValue:ku,_currentValue2:ku,_threadCount:0};function US(e,t,n,r,i,a,o,s){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=gd(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gd(0),this.hiddenUpdates=gd(null),this.identifierPrefix=r,this.onUncaughtError=i,this.onCaughtError=a,this.onRecoverableError=o,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=s,this.incompleteTransitions=new Map}function zS(e,t,n,r,i,a,o,s,l,c,u,d){return e=new US(e,t,n,o,s,l,c,d),t=1,!0===a&&(t|=24),a=km(3,null,null,t),e.current=a,a.stateNode=e,(t=Ng()).refCount++,e.pooledCache=t,t.refCount++,a.memoizedState={element:r,isDehydrated:n,cache:t},Xg(a),e}function DS(e){return e?e=Im:Im}function HS(e,t,n,r,i,a){i=DS(i),null===r.context?r.context=i:r.pendingContext=i,(r=Gg(t)).payload={element:n},null!==(a=void 0===a?null:a)&&(r.callback=a),null!==(n=Yg(e,r,t))&&(Aw(n,0,t),Jg(n,e,t))}function WS(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function jS(e,t){WS(e,t),(e=e.alternate)&&WS(e,t)}function VS(e){if(13===e.tag){var t=Sm(e,67108864);null!==t&&Aw(t,0,67108864),jS(e,67108864)}}var qS=!0;function XS(e,t,n,r){var i=Iu.T;Iu.T=null;var a=Au.p;try{Au.p=2,GS(e,t,n,r)}finally{Au.p=a,Iu.T=i}}function KS(e,t,n,r){var i=Iu.T;Iu.T=null;var a=Au.p;try{Au.p=8,GS(e,t,n,r)}finally{Au.p=a,Iu.T=i}}function GS(e,t,n,r){if(qS){var i=YS(r);if(null===i)_v(e,t,r,JS,n),lE(e,r);else if(function(e,t,n,r,i){switch(t){case"focusin":return tE=cE(tE,e,t,n,r,i),!0;case"dragenter":return nE=cE(nE,e,t,n,r,i),!0;case"mouseover":return rE=cE(rE,e,t,n,r,i),!0;case"pointerover":var a=i.pointerId;return iE.set(a,cE(iE.get(a)||null,e,t,n,r,i)),!0;case"gotpointercapture":return a=i.pointerId,aE.set(a,cE(aE.get(a)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r))r.stopPropagation();else if(lE(e,r),4&t&&-1<sE.indexOf(e)){for(;null!==i;){var a=Od(i);if(null!==a)switch(a.tag){case 3:if((a=a.stateNode).current.memoizedState.isDehydrated){var o=cd(a.pendingLanes);if(0!==o){var s=a;for(s.pendingLanes|=2,s.entangledLanes|=2;o;){var l=1<<31-id(o);s.entanglements[1]|=l,o&=~l}pv(a),!(6&qx)&&(pw=qu()+500,fv(0))}}break;case 13:null!==(s=Sm(a,2))&&Aw(s,0,2),Pw(),jS(a,2)}if(null===(a=YS(r))&&_v(e,t,r,JS,n),a===i)break;i=a}null!==i&&r.stopPropagation()}else _v(e,t,r,null,n)}}function YS(e){return QS(e=Sp(e))}var JS=null;function QS(e){if(JS=null,null!==(e=_d(e))){var t=Zc(e);if(null===t)e=null;else{var n=t.tag;if(13===n){if(null!==(e=eu(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return JS=e,null}function ZS(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Xu()){case Ku:return 2;case Gu:return 8;case Yu:case Ju:return 32;case Qu:return 268435456;default:return 32}default:return 32}}var eE=!1,tE=null,nE=null,rE=null,iE=new Map,aE=new Map,oE=[],sE="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function lE(e,t){switch(e){case"focusin":case"focusout":tE=null;break;case"dragenter":case"dragleave":nE=null;break;case"mouseover":case"mouseout":rE=null;break;case"pointerover":case"pointerout":iE.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":aE.delete(t.pointerId)}}function cE(e,t,n,r,i,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[i]},null!==t&&null!==(t=Od(t))&&VS(t),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function uE(e){var t=_d(e.target);if(null!==t){var n=Zc(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=eu(n)))return e.blockedOn=t,void function(e){var t=Au.p;try{return Au.p=e,function(){if(13===n.tag){var e=Nw();e=xd(e);var t=Sm(n,e);null!==t&&Aw(t,0,e),jS(n,e)}}()}finally{Au.p=t}}(e.priority)}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function dE(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=YS(e.nativeEvent);if(null!==n)return null!==(t=Od(n))&&VS(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);vp=r,n.target.dispatchEvent(r),vp=null,t.shift()}return!0}function pE(e,t,n){dE(e)&&n.delete(t)}function fE(){eE=!1,null!==tE&&dE(tE)&&(tE=null),null!==nE&&dE(nE)&&(nE=null),null!==rE&&dE(rE)&&(rE=null),iE.forEach(pE),aE.forEach(pE)}function mE(e,t){e.blockedOn===t&&(e.blockedOn=null,eE||(eE=!0,Kc.unstable_scheduleCallback(Kc.unstable_NormalPriority,fE)))}var gE=null;function hE(e){gE!==e&&(gE=e,Kc.unstable_scheduleCallback(Kc.unstable_NormalPriority,function(){gE===e&&(gE=null);for(var t=0;t<e.length;t+=3){var n=e[t],r=e[t+1],i=e[t+2];if("function"!=typeof r){if(null===QS(r||n))continue;break}var a=Od(n);null!==a&&(e.splice(t,3),t-=3,vb(a,{pending:!0,data:i,method:n.method,action:r},r,i))}}))}function bE(e){function t(t){return mE(t,e)}null!==tE&&mE(tE,e),null!==nE&&mE(nE,e),null!==rE&&mE(rE,e),iE.forEach(t),aE.forEach(t);for(var n=0;n<oE.length;n++){var r=oE[n];r.blockedOn===e&&(r.blockedOn=null)}for(;0<oE.length&&null===(n=oE[0]).blockedOn;)uE(n),null===n.blockedOn&&oE.shift();if(null!=(n=(e.ownerDocument||e).$$reactFormReplay))for(r=0;r<n.length;r+=3){var i=n[r],a=n[r+1],o=i[Nd]||null;if("function"==typeof a)o||hE(n);else if(o){var s=null;if(a&&a.hasAttribute("formAction")){if(i=a,o=a[Nd]||null)s=o.formAction;else if(null!==QS(i))continue}else s=o.action;"function"==typeof s?n[r+1]=s:(n.splice(r,3),r-=3),hE(n)}}}function yE(e){this._internalRoot=e}function xE(e){this._internalRoot=e}xE.prototype.render=yE.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(Jc(409));HS(t.current,Nw(),e,t,null,null)},xE.prototype.unmount=yE.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;HS(e.current,2,null,e,null,null),Pw(),t[Id]=null}},xE.prototype.unstable_scheduleHydration=function(e){if(e){var t=vd();e={blockedOn:null,target:e,priority:t};for(var n=0;n<oE.length&&0!==t&&t<oE[n].priority;n++);oE.splice(n,0,e),0===n&&uE(e)}};var wE=Gc.version;if("19.1.1"!==wE)throw Error(Jc(527,wE,"19.1.1"));Au.findDOMNode=function(e){var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(Jc(188));throw e=Object.keys(e).join(","),Error(Jc(268,e))}return e=function(e){var t=e.alternate;if(!t){if(null===(t=Zc(e)))throw Error(Jc(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var a=i.alternate;if(null===a){if(null!==(r=i.return)){n=r;continue}break}if(i.child===a.child){for(a=i.child;a;){if(a===n)return tu(i),e;if(a===r)return tu(i),t;a=a.sibling}throw Error(Jc(188))}if(n.return!==r.return)n=i,r=a;else{for(var o=!1,s=i.child;s;){if(s===n){o=!0,n=i,r=a;break}if(s===r){o=!0,r=i,n=a;break}s=s.sibling}if(!o){for(s=a.child;s;){if(s===n){o=!0,n=a,r=i;break}if(s===r){o=!0,r=a,n=i;break}s=s.sibling}if(!o)throw Error(Jc(189))}}if(n.alternate!==r)throw Error(Jc(190))}if(3!==n.tag)throw Error(Jc(188));return n.stateNode.current===n?e:t}(t),null===(e=null!==e?nu(e):null)?null:e.stateNode};var vE={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:Iu,reconcilerVersion:"19.1.1"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var SE=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!SE.isDisabled&&SE.supportsFiber)try{td=SE.inject(vE),nd=SE}catch(_k){}}Oc.createRoot=function(e,t){if(!Qc(e))throw Error(Jc(299));var n=!1,r="",i=ly,a=cy,o=uy;return null!=t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onUncaughtError&&(i=t.onUncaughtError),void 0!==t.onCaughtError&&(a=t.onCaughtError),void 0!==t.onRecoverableError&&(o=t.onRecoverableError),void 0!==t.unstable_transitionCallbacks&&t.unstable_transitionCallbacks),t=zS(e,1,!1,null,0,n,r,i,a,o,0,null),e[Id]=t.current,Bv(e),new yE(t)},Oc.hydrateRoot=function(e,t,n){if(!Qc(e))throw Error(Jc(299));var r=!1,i="",a=ly,o=cy,s=uy,l=null;return null!=n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(i=n.identifierPrefix),void 0!==n.onUncaughtError&&(a=n.onUncaughtError),void 0!==n.onCaughtError&&(o=n.onCaughtError),void 0!==n.onRecoverableError&&(s=n.onRecoverableError),void 0!==n.unstable_transitionCallbacks&&n.unstable_transitionCallbacks,void 0!==n.formState&&(l=n.formState)),(t=zS(e,1,!0,t,0,r,i,a,o,s,0,l)).context=DS(null),n=t.current,(i=Gg(r=xd(r=Nw()))).callback=null,Yg(n,i,r),n=r,t.current.lanes=n,hd(t,n),pv(t),e[Id]=t.current,Bv(e),new xE(t)},Oc.version="19.1.1",function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(_k){}}(),_c.exports=Oc;const EE=r(_c.exports);function NE({steps:e=[],title:t=null}){return e&&0!==e.length?Pc.createElement("div",{className:"rounded-xl border border-neutral-800/70 bg-neutral-950/80 backdrop-blur-sm px-4 py-3"},t&&Pc.createElement("div",{className:"text-[11px] font-semibold text-neutral-500 mb-3 uppercase tracking-wider"},t),Pc.createElement("div",{className:"relative flex flex-col"},e.map((t,n)=>{const r="done"===t.status,i="active"===t.status,a="skipped"===t.status,o=n===e.length-1;return Pc.createElement("div",{key:n,className:"flex items-start gap-3 relative"},!o&&Pc.createElement("div",{className:"absolute left-[9px] top-5 w-[2px] bottom-0 "+(r?"bg-green-500/40":"bg-neutral-800")}),Pc.createElement("div",{className:"relative z-10 flex-shrink-0 mt-[3px]"},r?Pc.createElement("div",{className:"w-[18px] h-[18px] rounded-full bg-green-500/20 border-2 border-green-500 flex items-center justify-center"},Pc.createElement("svg",{className:"w-2.5 h-2.5 text-green-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3},Pc.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"}))):i?Pc.createElement("div",{className:"w-[18px] h-[18px] rounded-full bg-blue-500/20 border-2 border-blue-400 flex items-center justify-center"},Pc.createElement("div",{className:"w-2 h-2 rounded-full bg-blue-400 animate-pulse"})):a?Pc.createElement("div",{className:"w-[18px] h-[18px] rounded-full bg-yellow-500/15 border-2 border-yellow-500/50 flex items-center justify-center"},Pc.createElement("div",{className:"w-1.5 h-[2px] bg-yellow-400/70 rounded-full"})):Pc.createElement("div",{className:"w-[18px] h-[18px] rounded-full border-2 border-neutral-700/50 bg-neutral-900/50"})),Pc.createElement("div",{className:o?"pb-0":"pb-3"},Pc.createElement("div",{className:"text-[13px] font-medium leading-5 "+(r?"text-green-400":i?"text-white":a?"text-yellow-400/70":"text-neutral-600")},t.label),i&&t.detail&&Pc.createElement("div",{className:"text-[11px] text-blue-300/70 mt-0.5 leading-4"},t.detail),a&&t.detail&&Pc.createElement("div",{className:"text-[11px] text-yellow-300/50 mt-0.5 leading-4"},t.detail)))}))):null}function IE(e,{step:t,status:n,detail:r}){return e.map((e,i)=>{const a=i+1;return a<t||a===t&&"done"===n?{label:e,status:"done"}:a===t&&"active"===n?{label:e,status:"active",detail:r}:a===t&&"skipped"===n?{label:e,status:"skipped",detail:r}:{label:e,status:"pending"}})}const AE="nexus_fee_rates";function kE(){sessionStorage.removeItem(AE),sessionStorage.removeItem("nexus_utxo_cache"),Object.keys(sessionStorage).filter(e=>e.startsWith("nexus_complete_")).forEach(e=>sessionStorage.removeItem(e)),Object.keys(sessionStorage).filter(e=>e.startsWith("nexus_inscriptions_")).forEach(e=>sessionStorage.removeItem(e)),Object.keys(localStorage).filter(e=>e.startsWith("nexus_proxy_")).forEach(e=>localStorage.removeItem(e)),Object.keys(sessionStorage).filter(e=>e.startsWith("nexus_ordinals_")).forEach(e=>sessionStorage.removeItem(e))}const TE="bg-neutral-900/95 backdrop-blur-sm border-b border-neutral-800/60",CE="px-1.5 sm:px-3 md:px-4";function BE({enabled:e=!0,mobileOnly:t=!0,minScrollToHidePx:n=40,minScrollToShowPx:r=20}={}){const[i,a]=Bc.useState(!1),[o,s]=Bc.useState(()=>"undefined"!=typeof window&&window.innerWidth<640),l=Bc.useRef(null),c=Bc.useRef(0),u=Bc.useRef(0);return Bc.useEffect(()=>{if("undefined"==typeof window)return;const e=window.matchMedia("(max-width: 639px)"),t=()=>s(e.matches);return t(),e.addEventListener("change",t),()=>e.removeEventListener("change",t)},[]),Bc.useEffect(()=>{(!e||t&&!o)&&a(!1)},[e,t,o]),Bc.useEffect(()=>{if(!e)return;if(t&&!o)return;const i=l.current||window,s=()=>{const e=i===window?window.scrollY||window.pageYOffset||0:i.scrollTop||0,t=e-c.current;if(c.current=e,e<10)return a(!1),void(u.current=0);t>0?(u.current=Math.max(u.current+t,0),u.current>n&&a(!0)):t<0&&(u.current=Math.min(u.current+t,0),Math.abs(u.current)>r&&(a(!1),u.current=0))};return i.addEventListener("scroll",s,{passive:!0}),()=>i.removeEventListener("scroll",s)},[e,t,o,n,r]),{hidden:i,setHidden:a,isMobile:o,ref:l}}function PE({show:e,label:t="Show",onShow:n,top:r="46px"}){return e?Pc.createElement("div",{className:"sticky z-[200] flex justify-center pointer-events-none",style:{top:r}},Pc.createElement("button",{type:"button",onClick:n,className:"pointer-events-auto px-4 py-1.5 text-[11px] font-semibold rounded-full bg-neutral-900/90 backdrop-blur-sm border border-neutral-700/60 text-neutral-300 shadow-lg hover:bg-neutral-800/90 hover:text-neutral-100 transition-all active:scale-95 touch-manipulation"},t)):null}function _E({walletAddress:e,walletType:t,isConnected:n,onConnect:r,onDisconnect:i,connectDisabled:a=!1,activeSection:o="inscribe",oodlSection:s="marketplace",onSectionChange:l,utxoCount:c=0,scrollContainerRef:u=null}){const[d,p]=Bc.useState(!1),f=Bc.useRef(null),m=Bc.useRef(null),g=BE({enabled:!0,mobileOnly:!0,minScrollToHidePx:50,minScrollToShowPx:25});Bc.useEffect(()=>{u?.current&&(g.ref.current=u.current)},[u?.current]);const h=g.hidden&&g.isMobile;Bc.useEffect(()=>{if(!d)return;const e=e=>{m.current&&!m.current.contains(e.target)&&f.current&&!f.current.contains(e.target)&&p(!1)},t=e=>{"Escape"===e.key&&p(!1)};return document.addEventListener("pointerdown",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("pointerdown",e),document.removeEventListener("keydown",t)}},[d]);const b=e=>e?`${e.slice(0,6)}...${e.slice(-4)}`:"",y=async()=>{i&&await i()},x=async()=>{i&&await i(),r&&r()},w="utxos"===o,v="inscribe"===o,S="oodl"===o&&"marketplace"===s,E="oodl"===o&&("hub"===s||"oodl"===s||"offer"===s),N=[{key:"utxos",label:"UTXOs"+(Number.isFinite(c)?` (${c})`:""),active:w,section:"utxos"},{key:"inscribe",label:"Inscribe",active:v,section:"inscribe"},{key:"marketplace",label:"Marketplace",active:S,section:"marketplace"},{key:"hub",label:"List & Trade",active:E,section:"hub"}],I="shrink-0 px-2.5 sm:px-3 py-1.5 text-xs sm:text-sm font-semibold rounded-lg border whitespace-nowrap transition-colors";return Pc.createElement(Pc.Fragment,null,Pc.createElement("div",{className:"relative z-[99999] transition-all duration-300 ease-in-out "+(h?"max-sm:-translate-y-full max-sm:h-0 max-sm:overflow-hidden max-sm:opacity-0 max-sm:pointer-events-none":"")},Pc.createElement("div",{className:"flex items-center gap-1.5 sm:gap-3 px-2 sm:px-6 py-1.5 sm:py-4 border-b border-neutral-800/60 bg-gradient-to-b from-neutral-900/80 to-neutral-900/50 backdrop-blur-md overflow-hidden"},Pc.createElement("div",{className:"flex items-center gap-1.5 sm:gap-2 shrink-0"},Pc.createElement("h1",{className:"text-lg sm:text-xl font-bold bg-gradient-to-r from-purple-300 via-purple-400 to-purple-500 bg-clip-text text-transparent drop-shadow-lg whitespace-nowrap"},"Oodinals"),Pc.createElement("span",{className:"hidden sm:inline-flex text-[11px] font-semibold uppercase tracking-wide text-neutral-200 bg-neutral-800/40 px-2 py-1 rounded-md border border-neutral-700/40"},"Alpha")),"function"==typeof l?Pc.createElement("div",{className:"hidden sm:flex items-center gap-1.5 sm:gap-2"},N.map(e=>{return Pc.createElement("button",{key:e.key,onClick:()=>l(e.section),className:(t=e.active,t?`${I} bg-purple-500/20 text-purple-300 border-purple-500/40`:`${I} bg-neutral-800/40 text-neutral-300 border-neutral-700/40 hover:bg-neutral-700/50`),"aria-label":`${e.label} section`,"aria-current":e.active?"page":void 0,title:e.label},e.label);var t})):null,Pc.createElement("div",{className:"flex-1 min-w-0"}),Pc.createElement("div",{className:"flex items-center gap-2 shrink-0"},n?Pc.createElement(Pc.Fragment,null,t&&Pc.createElement("div",{className:"hidden sm:flex items-center gap-2 text-xs text-neutral-300 font-semibold bg-neutral-800/40 px-3 py-1.5 rounded-lg border border-neutral-700/40"},t),e&&Pc.createElement("div",{className:"hidden sm:flex items-center gap-2 text-xs text-neutral-400 font-mono bg-neutral-800/40 px-2.5 sm:px-3 py-1.5 rounded-lg border border-neutral-700/40 hover:border-neutral-600/60 transition-colors max-w-[120px] sm:max-w-[160px]"},Pc.createElement("span",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse shrink-0"}),Pc.createElement("span",{className:"truncate"},b(e))),Pc.createElement("button",{onClick:x,className:"hidden sm:inline-flex px-2.5 sm:px-3 py-1.5 text-xs sm:text-sm font-medium rounded-lg bg-purple-500/10 hover:bg-purple-500/20 border border-purple-500/40 hover:border-purple-500/60 text-purple-300 hover:text-purple-200 transition-colors whitespace-nowrap","aria-label":"Switch Wallet",title:"Switch to a different wallet"},"Switch"),Pc.createElement("button",{onClick:y,className:"hidden sm:inline-flex px-2.5 sm:px-3 py-1.5 text-xs sm:text-sm font-medium rounded-lg bg-red-500/10 hover:bg-red-500/20 border border-red-500/40 hover:border-red-500/60 text-red-300 hover:text-red-200 transition-colors whitespace-nowrap","aria-label":"Disconnect Wallet",title:"Disconnect wallet"},"Disconnect"),Pc.createElement("div",{className:"sm:hidden flex items-center gap-1 text-[10px] text-neutral-400 font-mono bg-neutral-800/40 px-1.5 py-1 rounded-md border border-neutral-700/40"},Pc.createElement("span",{className:"w-1.5 h-1.5 rounded-full bg-green-500 shrink-0"}),Pc.createElement("span",{className:"truncate max-w-[60px]"},b(e)))):Pc.createElement("button",{onClick:()=>{a||r&&r()},disabled:a,className:a?"px-5 py-2 text-sm font-semibold rounded-lg bg-neutral-800 text-neutral-400 cursor-not-allowed":"px-5 py-2 text-sm font-semibold rounded-lg bg-purple-600 hover:bg-purple-500 text-white transition-colors","aria-label":"Connect Wallet"},"Connect Wallet")),"function"==typeof l?Pc.createElement("div",{className:"sm:hidden"},Pc.createElement("button",{ref:m,onClick:()=>p(e=>!e),className:"p-2.5 rounded-lg bg-neutral-800/60 border border-neutral-700/40 text-neutral-300 hover:bg-neutral-700/50 transition-colors touch-manipulation","aria-label":d?"Close navigation menu":"Open navigation menu","aria-expanded":d,"aria-controls":"mobile-nav-menu"},Pc.createElement("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2},d?Pc.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"}):Pc.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"}))),d&&Xc.createPortal(Pc.createElement("div",{ref:f},Pc.createElement("div",{className:"fixed inset-0 bg-black/40 sm:hidden",style:{zIndex:2147483646},"aria-hidden":"true",onClick:()=>p(!1)}),Pc.createElement("div",{id:"mobile-nav-menu",role:"menu",className:"fixed right-2 top-14 w-52 bg-neutral-900 border border-neutral-700/60 rounded-xl shadow-2xl overflow-hidden animate-in fade-in slide-in-from-top-2 duration-150",style:{zIndex:2147483647}},N.map(e=>Pc.createElement("button",{key:e.key,role:"menuitem",onClick:()=>{l(e.section),p(!1)},"aria-current":e.active?"page":void 0,className:e.active?"w-full text-left px-4 py-3.5 text-sm font-semibold bg-purple-500/15 text-purple-300 border-l-2 border-purple-400 touch-manipulation":"w-full text-left px-4 py-3.5 text-sm font-medium text-neutral-300 hover:bg-neutral-800/60 border-l-2 border-transparent transition-colors touch-manipulation"},e.label)),n&&Pc.createElement("div",{className:"border-t border-neutral-700/40"},Pc.createElement("button",{role:"menuitem",onClick:()=>{x(),p(!1)},className:"w-full text-left px-4 py-3.5 text-sm font-medium text-purple-300 hover:bg-neutral-800/60 transition-colors touch-manipulation"},"Switch Wallet"),Pc.createElement("button",{role:"menuitem",onClick:()=>{y(),p(!1)},className:"w-full text-left px-4 py-3.5 text-sm font-medium text-red-300 hover:bg-neutral-800/60 transition-colors touch-manipulation"},"Disconnect")))),document.body)):null)),Pc.createElement(PE,{show:h,label:"\u2630 Menu",onShow:()=>g.setHidden(!1),top:"calc(env(safe-area-inset-top, 0px) + 4px)"}))}const OE={PAYMENT:"payment",ORDINALS:"ordinals",ANY:"any"};function LE(e){return!!e&&!!(e.address||e.paymentAddress||e.ordinalsAddress)}function FE(e){if(!LE(e))throw new Error("Invalid wallet state: no address available");return e.paymentAddress||e.address}function ME(e){if(!LE(e))throw new Error("Invalid wallet state: no address available");return e.ordinalsAddress||e.address}function RE(e){if(!LE(e))throw new Error("Invalid wallet state: no address available");const t=[];return e.address&&t.push(e.address),e.ordinalsAddress&&t.push(e.ordinalsAddress),e.paymentAddress&&t.push(e.paymentAddress),[...new Set(t)]}const $E=Object.freeze(Object.defineProperty({__proto__:null,AddressType:OE,getAddressForOperation:function(e,t){if(!LE(e))throw new Error("Invalid wallet state: no address available");switch(t){case OE.PAYMENT:return FE(e);case OE.ORDINALS:return ME(e);case OE.ANY:return e.address||e.ordinalsAddress||e.paymentAddress;default:throw new Error(`Unknown address type: ${t}`)}},getAllAddresses:RE,getOrdinalsAddress:ME,getPaymentAddress:FE,isValidWalletState:LE},Symbol.toStringTag,{value:"Module"}));function UE({walletAddress:e,onAutoFetch:t,onManualMode:n,isLoading:r=!1}){const[i,a]=Bc.useState(!1),[o,s]=Bc.useState(!1);return Bc.createElement("div",{className:"utxo-fetch-control",style:{display:"flex",flexDirection:"column",gap:"var(--spacing-lg)",padding:"var(--spacing-lg)"}},Bc.createElement("div",{className:"inscription-card",style:{background:"linear-gradient(135deg, var(--accentPurple) 0%, var(--accentBlue) 100%)",color:"white",padding:"var(--spacing-lg)",textAlign:"center"}},Bc.createElement("h2",{style:{margin:0,marginBottom:"var(--spacing-sm)",fontSize:"var(--fontSize-xl)",fontWeight:"var(--fontWeight-bold)"}},"\ud83d\udcb0 Select Payment UTXOs")),Bc.createElement("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(240px, 1fr))",gap:"var(--spacing-md)"}},Bc.createElement("div",{className:"inscription-card",style:{borderLeft:"4px solid var(--accentGreen)",cursor:r?"not-allowed":"pointer",opacity:r?.6:1,transition:"all 0.2s ease",position:"relative",overflow:"hidden"},onMouseEnter:e=>!r&&(e.currentTarget.style.transform="translateY(-4px)"),onMouseLeave:e=>!r&&(e.currentTarget.style.transform="translateY(0)"),onClick:r?void 0:()=>{a(!0)}},Bc.createElement("div",{style:{position:"absolute",top:"10px",right:"10px",fontSize:"2rem",opacity:.2}},"\ud83d\ude80"),Bc.createElement("h3",{style:{margin:0,marginBottom:"var(--spacing-sm)",fontSize:"var(--fontSize-lg)",fontWeight:"var(--fontWeight-bold)",color:"var(--accentGreen)",display:"flex",alignItems:"center",gap:"var(--spacing-sm)"}},Bc.createElement("span",null,"\ud83d\ude80"),Bc.createElement("span",null,"Auto-Fetch")),Bc.createElement("p",{style:{margin:0,marginBottom:"var(--spacing-md)",fontSize:"var(--fontSize-sm)",color:"var(--textSecondary)",lineHeight:"1.5"}},"Automatically fetch UTXOs using our secure Bitcoin Proxy"),Bc.createElement("div",{style:{padding:"var(--spacing-sm)",background:"var(--successBg)",borderRadius:"var(--radius-sm)",marginBottom:"var(--spacing-sm)"}},Bc.createElement("p",{style:{margin:0,fontSize:"var(--fontSize-xs)",color:"var(--textSecondary)",fontWeight:"var(--fontWeight-semibold)"}},"\u2705 Fast and automatic",Bc.createElement("br",null),"\u2705 Filters out inscriptions",Bc.createElement("br",null),"\u2705 Secure CSP-compliant")),Bc.createElement("button",{disabled:r,className:"btn-primary",style:{width:"100%",padding:"var(--spacing-md)",fontSize:"var(--fontSize-sm)",fontWeight:"var(--fontWeight-semibold)",pointerEvents:"none"}},"Choose Auto-Fetch")),Bc.createElement("div",{className:"inscription-card",style:{borderLeft:"4px solid var(--accentAmber)",cursor:r?"not-allowed":"pointer",opacity:r?.6:1,transition:"all 0.2s ease",position:"relative",overflow:"hidden"},onMouseEnter:e=>!r&&(e.currentTarget.style.transform="translateY(-4px)"),onMouseLeave:e=>!r&&(e.currentTarget.style.transform="translateY(0)"),onClick:r?void 0:()=>{s(!0)}},Bc.createElement("div",{style:{position:"absolute",top:"10px",right:"10px",fontSize:"2rem",opacity:.2}},"\ud83d\udccb"),Bc.createElement("h3",{style:{margin:0,marginBottom:"var(--spacing-sm)",fontSize:"var(--fontSize-lg)",fontWeight:"var(--fontWeight-bold)",color:"var(--accentAmber)",display:"flex",alignItems:"center",gap:"var(--spacing-sm)"}},Bc.createElement("span",null,"\ud83d\udccb"),Bc.createElement("span",null,"Manual Paste")),Bc.createElement("p",{style:{margin:0,marginBottom:"var(--spacing-md)",fontSize:"var(--fontSize-sm)",color:"var(--textSecondary)",lineHeight:"1.5"}},"Manually paste UTXOs from mempool.space"),Bc.createElement("div",{style:{padding:"var(--spacing-sm)",background:"var(--warningBg)",borderRadius:"var(--radius-sm)",marginBottom:"var(--spacing-sm)"}},Bc.createElement("p",{style:{margin:0,fontSize:"var(--fontSize-xs)",color:"var(--textSecondary)",fontWeight:"var(--fontWeight-semibold)"}},"\u2705 Full control",Bc.createElement("br",null),"\u2705 Works if popups blocked",Bc.createElement("br",null),"\u26a0\ufe0f Requires manual steps")),Bc.createElement("button",{disabled:r,className:"btn-secondary",style:{width:"100%",padding:"var(--spacing-md)",fontSize:"var(--fontSize-sm)",fontWeight:"var(--fontWeight-semibold)",pointerEvents:"none"}},"Choose Manual"))),i&&Bc.createElement("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4,padding:"var(--spacing-lg)",animation:"fadeIn 0.2s ease"},onClick:()=>a(!1)},Bc.createElement("div",{className:"inscription-card",style:{maxWidth:"500px",width:"100%",background:"var(--bgPrimary)",border:"2px solid var(--accentGreen)",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.5)",animation:"scaleIn 0.2s ease"},onClick:e=>e.stopPropagation()},Bc.createElement("div",{style:{padding:"var(--spacing-lg)",borderBottom:"1px solid var(--borderMedium)"}},Bc.createElement("h3",{style:{margin:0,marginBottom:"var(--spacing-sm)",fontSize:"var(--fontSize-lg)",fontWeight:"var(--fontWeight-bold)",color:"var(--accentGreen)",display:"flex",alignItems:"center",gap:"var(--spacing-sm)"}},Bc.createElement("span",{style:{fontSize:"1.5rem"}},"\ud83e\ude9f"),Bc.createElement("span",null,"Popup Window Required"))),Bc.createElement("div",{style:{padding:"var(--spacing-lg)"}},Bc.createElement("p",{style:{margin:0,marginBottom:"var(--spacing-md)",fontSize:"var(--fontSize-base)",color:"var(--textPrimary)",lineHeight:"1.6"}},"When you click ",Bc.createElement("strong",null,'"Fetch UTXOs"'),", a popup window will open to securely fetch your UTXOs."),Bc.createElement("div",{style:{background:"var(--successBg)",padding:"var(--spacing-md)",borderRadius:"var(--radius-md)",marginBottom:"var(--spacing-md)",border:"1px solid var(--accentGreen)"}},Bc.createElement("p",{style:{margin:0,fontSize:"var(--fontSize-sm)",color:"var(--textSecondary)",fontWeight:"var(--fontWeight-semibold)",lineHeight:"1.6"}},Bc.createElement("strong",{style:{color:"var(--accentGreen)"}},"What will happen:"),Bc.createElement("br",null),"1\ufe0f\u20e3 A small popup window will open",Bc.createElement("br",null),"2\ufe0f\u20e3 It will fetch your UTXOs via our Bitcoin Proxy",Bc.createElement("br",null),"3\ufe0f\u20e3 The window will close automatically",Bc.createElement("br",null),"4\ufe0f\u20e3 Your UTXOs will be filtered and displayed")),Bc.createElement("div",{style:{background:"var(--warningBg)",padding:"var(--spacing-md)",borderRadius:"var(--radius-md)",marginBottom:"var(--spacing-lg)",border:"1px solid var(--accentAmber)"}},Bc.createElement("p",{style:{margin:0,fontSize:"var(--fontSize-sm)",color:"var(--textSecondary)",lineHeight:"1.6"}},"\u26a0\ufe0f ",Bc.createElement("strong",null,"Allow popups for this site")," if your browser blocks them")),Bc.createElement("div",{style:{display:"flex",gap:"var(--spacing-md)"}},Bc.createElement("button",{onClick:()=>a(!1),className:"btn-secondary",style:{flex:1,padding:"var(--spacing-md)"}},"Cancel"),Bc.createElement("button",{onClick:()=>{a(!1),t&&t()},className:"btn-primary",style:{flex:2,padding:"var(--spacing-md)",fontWeight:"var(--fontWeight-bold)"}},"\ud83d\ude80 Fetch UTXOs"))))),o&&Bc.createElement("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4,padding:"var(--spacing-lg)",animation:"fadeIn 0.2s ease"},onClick:()=>s(!1)},Bc.createElement("div",{className:"inscription-card",style:{maxWidth:"600px",width:"100%",background:"var(--bgPrimary)",border:"2px solid var(--accentAmber)",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.5)",animation:"scaleIn 0.2s ease"},onClick:e=>e.stopPropagation()},Bc.createElement("div",{style:{padding:"var(--spacing-lg)",borderBottom:"1px solid var(--borderMedium)"}},Bc.createElement("h3",{style:{margin:0,marginBottom:"var(--spacing-sm)",fontSize:"var(--fontSize-lg)",fontWeight:"var(--fontWeight-bold)",color:"var(--accentAmber)",display:"flex",alignItems:"center",gap:"var(--spacing-sm)"}},Bc.createElement("span",{style:{fontSize:"1.5rem"}},"\ud83d\udccb"),Bc.createElement("span",null,"Manual UTXO Input"))),Bc.createElement("div",{style:{padding:"var(--spacing-lg)"}},Bc.createElement("p",{style:{margin:0,marginBottom:"var(--spacing-md)",fontSize:"var(--fontSize-base)",color:"var(--textPrimary)",lineHeight:"1.6"}},"You'll be able to paste UTXOs directly from mempool.space."),Bc.createElement("div",{style:{background:"var(--bgSecondary)",padding:"var(--spacing-md)",borderRadius:"var(--radius-md)",marginBottom:"var(--spacing-md)",border:"1px solid var(--borderMedium)"}},Bc.createElement("p",{style:{margin:0,marginBottom:"var(--spacing-sm)",fontSize:"var(--fontSize-sm)",color:"var(--textPrimary)",fontWeight:"var(--fontWeight-semibold)"}},"\ud83d\udcdd Steps you'll follow:"),Bc.createElement("ol",{style:{margin:0,paddingLeft:"1.5rem",fontSize:"var(--fontSize-sm)",color:"var(--textSecondary)",lineHeight:"1.8"}},Bc.createElement("li",null,"Visit mempool.space UTXO API for your address"),Bc.createElement("li",null,"Copy the entire JSON array response"),Bc.createElement("li",null,"Paste it into the text area"),Bc.createElement("li",null,'Click "Parse & Filter UTXOs"'),Bc.createElement("li",null,"Wait for verification (filters out inscriptions)"),Bc.createElement("li",null,"Select spendable UTXOs"))),Bc.createElement("div",{style:{background:"var(--successBg)",padding:"var(--spacing-md)",borderRadius:"var(--radius-md)",marginBottom:"var(--spacing-lg)",border:"1px solid var(--accentGreen)"}},Bc.createElement("p",{style:{margin:0,fontSize:"var(--fontSize-sm)",color:"var(--textSecondary)",lineHeight:"1.6"}},"\u2705 ",Bc.createElement("strong",null,"Benefits:")," Works without popups, full control over which UTXOs to use")),Bc.createElement("div",{style:{display:"flex",gap:"var(--spacing-md)"}},Bc.createElement("button",{onClick:()=>s(!1),className:"btn-secondary",style:{flex:1,padding:"var(--spacing-md)"}},"Cancel"),Bc.createElement("button",{onClick:()=>{s(!1),n&&n()},className:"btn-primary",style:{flex:2,padding:"var(--spacing-md)",fontWeight:"var(--fontWeight-bold)"}},"\ud83d\udccb Continue to Manual Input"))))),Bc.createElement("style",{jsx:!0},"\n        @keyframes fadeIn {\n          from { opacity: 0; }\n          to { opacity: 1; }\n        }\n        \n        @keyframes scaleIn {\n          from { \n            opacity: 0;\n            transform: scale(0.9);\n          }\n          to { \n            opacity: 1;\n            transform: scale(1);\n          }\n        }\n      "))}let zE=null,DE=!1,HE=null,WE=[];function jE(e){if("function"!=typeof e)throw new Error("Callback must be a function");return WE.push(e),()=>{const t=WE.indexOf(e);t>-1&&WE.splice(t,1)}}async function VE(){const e=await async function(){try{if("undefined"!=typeof window&&window.__NEXUS_ORDINALS_ORIGIN_PROMISE__)try{await window.__NEXUS_ORDINALS_ORIGIN_PROMISE__}catch{}const e=kt("/r/blockheight"),t=await fetch(e);if(!t.ok)return null;const n=await t.text(),r=parseInt(n.trim());return isNaN(r)?null:r}catch(tn){return null}}();if(null!==e)if(null!==zE){if(e>zE){const t=zE;zE=e;for(const n of WE)try{n(e,t)}catch(tn){}}else if(e<zE){zE=e;for(const t of WE)try{t(e,zE,!0)}catch(tn){}}}else zE=e}function qE(e=!0){DE||(DE=!0,e&&VE(),HE=setInterval(VE,6e4))}function XE(){DE&&(DE=!1,HE&&(clearInterval(HE),HE=null))}const KE=Object.freeze(Object.defineProperty({__proto__:null,onBlockChange:jE,startBlockHeightMonitor:qE,stopBlockHeightMonitor:XE},Symbol.toStringTag,{value:"Module"}));function GE({walletState:e=null,selectedUtxos:t=[],onUtxosChange:r,onUtxoSelect:i,onFeesLoaded:a,onFilteredUtxosLoaded:o,onScanStateChange:s,rescanRequestId:l=0,requiredAmount:c=0}){const[u,d]=Bc.useState(null),[p,f]=Bc.useState(!1),[m,g]=Bc.useState(null),[h,b]=Bc.useState(null),[y,x]=Bc.useState(""),[w,v]=Bc.useState(""),[S,E]=Bc.useState(""),[N,I]=Bc.useState(!1),[A,k]=Bc.useState(!0),[T,C]=Bc.useState(null),[B,P]=Bc.useState(new Set),_=Bc.useRef(l),O=Pc.useMemo(()=>{if(!e||!e.isConnected)return null;try{return FE(e)}catch(_k){return null}},[e]),L=e=>{d(e),e&&o&&o(e)};Bc.useEffect(()=>{const t=Number(l),n=Number(_.current);if(Number.isFinite(t)&&t!==n&&(_.current=t,e?.isConnected&&O)){try{s?.({status:"loading",phase:"utxos",message:"Rescanning wallet UTXOs\u2026",ts:Date.now(),forceRefresh:!0})}catch(r){}U(!0).catch(e=>{try{s?.({status:"error",phase:"utxos",message:e?.message||String(e),ts:Date.now()})}catch(r){}})}},[l,e?.isConnected,O]);const[F,M]=Bc.useState(null);Bc.useEffect(()=>{if(!e||!e.isConnected)return void(F&&(d(null),C(null),k(!0),I(!1),x(""),v(""),E(""),g(null),M(null),P(new Set)));const t=O;F&&t!==F&&(d(null),C("auto"),k(!1),I(!1),x(""),v(""),E(""),g(null),P(new Set),U(!0).catch(t=>{try{const t=RE(e),n=qr(t.sort().join(","));n&&(t.length>1?t.length:t[0].substring(0,20),L(n),r&&n.spendable&&n.spendable.length>0&&r(n.spendable))}catch(Pk){}})),t&&t!==F&&M(t)},[e,O]);const[R,$]=Pc.useState(!1);Bc.useEffect(()=>{e&&e.isConnected?O&&(R||(C("auto"),k(!1),U(!0).then(e=>{e&&$(!0)}).catch(e=>{}))):$(!1)},[e?.isConnected,O,R]),Bc.useEffect(()=>{if(!e||!e.isConnected)return;if(u)return;if(F)return;const t=RE(e),n=qr(t.sort().join(","));n&&(t.length>1?t.length:t[0].substring(0,20),L(n),C("auto"),k(!1),r&&n.spendable&&n.spendable.length>0&&r(n.spendable))},[e]),Bc.useEffect(()=>{if(!e?.isConnected||!O)return void XE();const t=jE(async(e,t)=>{await U(!0)});return qE(),()=>{t(),XE()}},[e?.isConnected,O]);const U=async(t=!1)=>{if(!e)return g("No wallet connected"),!1;f(!0),g(null),b(null);try{s?.({status:"loading",phase:"utxos",message:t?"Fetching fresh wallet data\u2026":"Fetching wallet data\u2026",ts:Date.now(),forceRefresh:!!t})}catch(o){}let i=!1;try{const{getAddressForOperation:c,AddressType:u}=await n(async()=>{const{getAddressForOperation:e,AddressType:t}=await Promise.resolve().then(()=>$E);return{getAddressForOperation:e,AddressType:t}},__VITE_PRELOAD__),d=c(e,u.PAYMENT),p=e?.ordinalsAddress;if(!d)throw new Error("No payment address available");const f=[...new Set([d,p].filter(Boolean))];if(t)try{const{clearAllCachesForWallet:e}=await n(async()=>{const{clearAllCachesForWallet:e}=await Promise.resolve().then(()=>gk);return{clearAllCachesForWallet:e}},__VITE_PRELOAD__);await e(f)}catch(l){}const m=await Lr(f,{forceRefresh:t,progressCallback:e=>{}});m.utxos.length>0&&m.utxos[0];const h=m.utxos.filter(e=>{const t=`${e.txid}:${e.vout}`;return(m.addressUtxoMap?.[t]||e.address)===d}),y=p&&p!==d?m.utxos.filter(e=>{const t=`${e.txid}:${e.vout}`;return(m.addressUtxoMap?.[t]||e.address)===p}):[];if(y.length,a&&m.fees){const e={...m.fees,timestamp:Date.now()};a(e)}const x=await ei(h,e=>{b(e);try{s?.({status:"loading",phase:"filter",message:e?.message||e?.status||"Filtering UTXOs\u2026",progress:e,ts:Date.now()})}catch(o){}}),{getCachedInscriptions:w,setCachedInscriptions:v}=await n(async()=>{const{getCachedInscriptions:e,setCachedInscriptions:t}=await Promise.resolve().then(()=>kk);return{getCachedInscriptions:e,setCachedInscriptions:t}},__VITE_PRELOAD__),S=p&&p!==d?w(p):null;let E=null;y.length>0&&p&&p!==d&&(0===x.spendable.length||!(S&&S.length>0))&&(E=await ei(y,null));const N=0===x.spendable.length&&(E?.spendable?.length??0)>0?E:x;if(p&&p!==d)if(S&&S.length>0);else if(E){const e=E.unsafe||[],{extractInscriptionsFromUtxos:t}=await n(async()=>{const{extractInscriptionsFromUtxos:e}=await Promise.resolve().then(()=>wk);return{extractInscriptionsFromUtxos:e}},__VITE_PRELOAD__),r=await t(e);r.length>0&&v(p,r)}const{setCachedUtxoResult:I}=await n(async()=>{const{setCachedUtxoResult:e}=await Promise.resolve().then(()=>ri);return{setCachedUtxoResult:e}},__VITE_PRELOAD__);I(f.sort().join(","),N),L(N),b(null),i=!0,0===N.spendable.length?g("No spendable UTXOs found (all contain inscriptions/runes)"):r&&r(N.spendable);try{s?.({status:"utxos-ready",phase:"utxos",message:"Wallet UTXOs loaded. Verifying wallet assets\u2026",ts:Date.now(),spendableCount:N?.spendable?.length||0,unsafeCount:N?.unsafe?.length||0})}catch(o){}}catch(_k){g(`Failed to fetch: ${_k.message}`),d(null);try{s?.({status:"error",phase:"utxos",message:_k?.message||String(_k),ts:Date.now()})}catch(o){}}finally{f(!1),b(null)}return i},z=u?.spendable||[],D=u?.unsafe||[],H=[...z,...D.filter(e=>B.has(`${e.txid}:${e.vout}`))],W=D.filter(e=>!B.has(`${e.txid}:${e.vout}`)),j=H.reduce((e,t)=>e+t.value,0),V=t.reduce((e,t)=>e+t.value,0),q=V>=c,X=e=>e.toLocaleString(),K=O?ni(O):"";return e&&e.isConnected?Pc.createElement("div",{className:"utxo-manager",style:{display:"flex",flexDirection:"column",height:"100%",minHeight:0,overflow:"hidden"}},Pc.createElement("div",{style:{flexShrink:0,padding:"var(--spacing-sm) var(--spacing-md)",borderBottom:"1px solid var(--borderMedium)",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"var(--spacing-sm)"}},Pc.createElement("div",{style:{display:"flex",alignItems:"center",gap:"var(--spacing-sm)",flex:1,minWidth:0}},Pc.createElement("h4",{style:{margin:0,fontSize:"var(--fontSize-sm)",fontWeight:"var(--fontWeight-semibold)",color:"var(--textPrimary)",whiteSpace:"nowrap"}},"\ud83d\udcb0 Select Payment UTXOs"),O&&Pc.createElement("div",{style:{display:"flex",alignItems:"center",gap:"var(--spacing-xs)",padding:"2px 8px",background:"var(--bgTertiary)",borderRadius:"var(--borderRadius-sm)",border:"1px solid var(--borderMedium)",fontSize:"10px",fontFamily:"var(--fontFamily-mono)",color:"var(--accentCyan)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"300px"}},Pc.createElement("span",{style:{color:"var(--textMuted)"}},"\ud83d\udccd"),Pc.createElement("span",{title:O},O.substring(0,12),"...",O.substring(O.length-8)))),Pc.createElement("button",{className:"btn-icon",onClick:e=>{const t=e.shiftKey||e.ctrlKey||e.metaKey;u?U(t):(k(!0),C(null))},disabled:p||!O,style:{fontSize:"var(--fontSize-base)",flexShrink:0},title:u?"Refresh UTXOs (Shift+Click to clear cache)":"Show Fetch Options"},p?"\u23f3":"\ud83d\udd04")),Pc.createElement("div",{style:{flex:1,minHeight:0,overflowY:"auto",padding:"var(--spacing-md)"}},A&&!u&&O&&Pc.createElement(UE,{walletAddress:O,onAutoFetch:async()=>{k(!1),C("auto");try{await U()}catch(_k){}},onManualMode:()=>{k(!1),C("manual"),I(!0)},isLoading:p}),(!A||u)&&Pc.createElement("div",{style:{marginBottom:"var(--spacing-md)"}},Pc.createElement("button",{className:"btn-secondary",onClick:()=>I(!N),style:{width:"100%",fontSize:"var(--fontSize-xs)",padding:"var(--spacing-sm)"}},N?"\u25bc":"\u25b6"," Paste UTXOs from Mempool.space"),N&&Pc.createElement("div",{className:"fade-in",style:{marginTop:"var(--spacing-sm)"}},Pc.createElement("div",{style:{marginBottom:"var(--spacing-md)",padding:"var(--spacing-sm)",background:"var(--bgSecondary)",borderRadius:"var(--radius-md)",border:"1px solid var(--borderMedium)"}},Pc.createElement("p",{style:{margin:0,marginBottom:"var(--spacing-sm)",fontSize:"var(--fontSize-xs)",color:"var(--textSecondary)",fontWeight:"var(--fontWeight-semibold)"}},"\ud83d\udccb Fetch UTXOs from BOTH addresses:"),O&&Pc.createElement("div",{style:{marginBottom:"var(--spacing-xs)"}},Pc.createElement("div",{style:{fontSize:"9px",color:"var(--textSecondary)",marginBottom:"2px",fontWeight:"var(--fontWeight-semibold)"}},"\ud83d\udcb0 Payment Address:"),Pc.createElement("div",{style:{display:"flex",gap:"var(--spacing-xs)",alignItems:"stretch"}},Pc.createElement("div",{style:{flex:1,fontSize:"10px",color:"var(--accentCyan)",padding:"var(--spacing-xs)",background:"var(--bgTertiary)",borderRadius:"var(--radius-sm)",border:"1px solid var(--borderLight)",wordBreak:"break-all",fontFamily:"var(--fontFamily-mono)"}},"mempool.space/api/address/",O,"/utxo"),Pc.createElement("button",{className:"btn-secondary",onClick:()=>{navigator.clipboard.writeText(K(`/api/address/${O}/utxo`))},style:{fontSize:"10px",padding:"0 var(--spacing-sm)",whiteSpace:"nowrap"},title:"Copy URL to clipboard"},"\ud83d\udccb Copy"))),e?.ordinalsAddress&&e.ordinalsAddress!==O&&Pc.createElement("div",{style:{marginBottom:"var(--spacing-xs)"}},Pc.createElement("div",{style:{fontSize:"9px",color:"var(--textSecondary)",marginBottom:"2px",fontWeight:"var(--fontWeight-semibold)"}},"\ud83c\udfa8 Ordinals Address:"),Pc.createElement("div",{style:{display:"flex",gap:"var(--spacing-xs)",alignItems:"stretch"}},Pc.createElement("div",{style:{flex:1,fontSize:"10px",color:"var(--accentPurple)",padding:"var(--spacing-xs)",background:"var(--bgTertiary)",borderRadius:"var(--radius-sm)",border:"1px solid var(--borderLight)",wordBreak:"break-all",fontFamily:"var(--fontFamily-mono)"}},"mempool.space/api/address/",e.ordinalsAddress,"/utxo"),Pc.createElement("button",{className:"btn-secondary",onClick:()=>{navigator.clipboard.writeText(K(`/api/address/${e.ordinalsAddress}/utxo`))},style:{fontSize:"10px",padding:"0 var(--spacing-sm)",whiteSpace:"nowrap"},title:"Copy URL to clipboard"},"\ud83d\udccb Copy"))),Pc.createElement("div",{style:{marginTop:"var(--spacing-sm)",padding:"var(--spacing-xs)",background:"var(--warningBg)",borderRadius:"var(--radius-sm)",border:"1px solid var(--accentAmber)"}},Pc.createElement("p",{style:{margin:0,fontSize:"9px",color:"var(--textSecondary)",lineHeight:"1.4"}},"\ud83d\udca1 Copy JSON from both URLs and paste together (will auto-merge)"))),Pc.createElement("textarea",{className:"form-input form-textarea",value:w,onChange:e=>v(e.target.value),placeholder:"Paste Payment address UTXOs JSON array from mempool.space",style:{minHeight:"150px",maxHeight:"300px",fontFamily:"var(--fontFamily-mono)",fontSize:"10px",resize:"vertical"}}),e?.ordinalsAddress&&e.ordinalsAddress!==O&&Pc.createElement("textarea",{className:"form-input form-textarea",value:S,onChange:e=>E(e.target.value),placeholder:"Paste Ordinals address UTXOs JSON array from mempool.space",style:{marginTop:"var(--spacing-sm)",minHeight:"150px",maxHeight:"300px",fontFamily:"var(--fontFamily-mono)",fontSize:"10px",resize:"vertical"}}),Pc.createElement("textarea",{className:"form-input form-textarea",value:y,onChange:e=>x(e.target.value),placeholder:"(Legacy) Paste combined JSON arrays (address source may be ambiguous)",style:{marginTop:"var(--spacing-sm)",minHeight:"90px",maxHeight:"200px",fontFamily:"var(--fontFamily-mono)",fontSize:"10px",resize:"vertical"}}),Pc.createElement("button",{className:"btn-primary-purple",onClick:async()=>{const t=w.trim().length>0||S.trim().length>0,n=y.trim().length>0;if(t||n){f(!0),g(null),b(null);try{const n=e?.ordinalsAddress,i=n&&n!==O;let a=[],o=[];t?(w.trim()&&(a=ti(w)),i&&S.trim()&&(o=ti(S))):a=ti(y);const s=(a||[]).map(e=>({...e,address:O})),l=i?(o||[]).map(e=>({...e,address:n})):[],c=await ei(s,e=>{b(e)});let u=null;i&&l.length>0&&0===c.spendable.length&&(u=await ei(l,null));const d=0===c.spendable.length&&(u?.spendable?.length??0)>0?u:c;L(d),b(null),d&&0!==d.spendable.length?r&&r(d.spendable):g("\u274c No spendable UTXOs found! All UTXOs contain assets or are dust.")}catch(_k){g(`Failed to parse UTXOs: ${_k.message}`),d(null)}finally{f(!1),b(null)}}else g("Please paste UTXOs from mempool.space")},disabled:p||!w.trim()&&!S.trim()&&!y.trim(),style:{marginTop:"var(--spacing-sm)",width:"100%",fontSize:"var(--fontSize-xs)",padding:"var(--spacing-sm)"}},p?"\u23f3 Filtering...":"\ud83d\udd0d Parse & Filter UTXOs"))),h&&Pc.createElement("div",{className:"validation-info",style:{marginBottom:"var(--spacing-md)"}},Pc.createElement("span",null,"\u23f3"),Pc.createElement("div",{style:{flex:1}},Pc.createElement("strong",{style:{fontSize:"var(--fontSize-xs)"}},"Checking ordinals.com... ",h.current,"/",h.total," UTXOs"),Pc.createElement("div",{style:{width:"100%",height:"4px",background:"var(--borderMedium)",borderRadius:"2px",marginTop:"var(--spacing-xs)",overflow:"hidden"}},Pc.createElement("div",{style:{width:`${h.percentage}%`,height:"100%",background:"var(--gradientPurplePink)",transition:"width 0.3s ease"}})))),m&&Pc.createElement("div",{className:"validation-error",style:{marginBottom:"var(--spacing-md)"}},Pc.createElement("span",null,"\u274c"),Pc.createElement("span",{style:{fontSize:"var(--fontSize-xs)"}},m)),u&&Pc.createElement("div",{style:{display:"grid",gridTemplateColumns:t.length>0?"repeat(2, 1fr)":"1fr",gap:"var(--spacing-sm)",marginBottom:"var(--spacing-md)"}},Pc.createElement("div",{style:{padding:"var(--spacing-sm)",background:"var(--bgSecondary)",borderRadius:"var(--radius-md)",border:"1px solid var(--borderMedium)"}},Pc.createElement("div",{style:{fontSize:"10px",color:"var(--textMuted)",marginBottom:"var(--spacing-xs)",textTransform:"uppercase"}},"Available"),Pc.createElement("div",{style:{fontSize:"var(--fontSize-base)",fontWeight:"var(--fontWeight-bold)",color:"var(--accentCyan)",fontFamily:"var(--fontFamily-mono)"}},X(j)," sats"),Pc.createElement("div",{style:{fontSize:"10px",color:"var(--textMuted)",marginTop:"var(--spacing-xs)"}},H.length," spendable")),t.length>0&&Pc.createElement("div",{style:{padding:"var(--spacing-sm)",background:"var(--bgSecondary)",borderRadius:"var(--radius-md)",border:"1px solid "+(q?"var(--accentGreen)":"var(--accentRed)")}},Pc.createElement("div",{style:{fontSize:"10px",color:"var(--textMuted)",marginBottom:"var(--spacing-xs)",textTransform:"uppercase"}},"Selected"),Pc.createElement("div",{style:{fontSize:"var(--fontSize-base)",fontWeight:"var(--fontWeight-bold)",color:q?"var(--accentGreen)":"var(--accentRed)",fontFamily:"var(--fontFamily-mono)"}},X(V)," sats"),Pc.createElement("div",{style:{fontSize:"10px",color:"var(--textMuted)",marginTop:"var(--spacing-xs)"}},t.length," selected",c>0&&` / ${X(c)} needed`))),H.length>0&&Pc.createElement("div",{style:{marginBottom:"var(--spacing-md)"}},Pc.createElement("h5",{style:{margin:0,marginBottom:"var(--spacing-sm)",fontSize:"var(--fontSize-xs)",fontWeight:"var(--fontWeight-semibold)",color:"var(--accentGreen)",textTransform:"uppercase",letterSpacing:"0.5px"}},"\u2705 Spendable UTXOs (",H.length,")"),Pc.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"var(--spacing-xs)"}},H.map((e,n)=>{const r=t.some(t=>t.txid===e.txid&&t.vout===e.vout);return Pc.createElement("div",{key:`${e.txid}:${e.vout}`,onClick:()=>i&&i(e),style:{padding:"var(--spacing-sm)",background:r?"rgba(139, 92, 246, 0.1)":"var(--bgSecondary)",border:"1px solid "+(r?"var(--accentPurple)":"var(--borderMedium)"),borderRadius:"var(--radius-sm)",cursor:"pointer",transition:"var(--transition-fast)"}},Pc.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"var(--spacing-xs)"}},Pc.createElement("span",{style:{fontSize:"11px",fontWeight:"var(--fontWeight-semibold)",color:"var(--textSecondary)"}},r?"\u2611\ufe0f":"\u2b1c"," UTXO #",n+1),Pc.createElement("span",{style:{fontSize:"var(--fontSize-sm)",fontWeight:"var(--fontWeight-bold)",color:"var(--accentPurple)",fontFamily:"var(--fontFamily-mono)"}},X(e.value)," sats")),Pc.createElement("div",{style:{fontSize:"10px",color:"var(--textMuted)",fontFamily:"var(--fontFamily-mono)",wordBreak:"break-all"}},e.txid.substring(0,12),"...",e.txid.substring(52),":",e.vout))}))),(W.length>0||D.length>0)&&Pc.createElement("details",{style:{marginBottom:"var(--spacing-md)"}},Pc.createElement("summary",{style:{fontSize:"var(--fontSize-xs)",fontWeight:"var(--fontWeight-semibold)",color:"var(--accentRed)",textTransform:"uppercase",cursor:"pointer",padding:"var(--spacing-sm)",background:"rgba(239, 68, 68, 0.05)",borderRadius:"var(--radius-sm)",border:"1px solid rgba(239, 68, 68, 0.2)"}},"\u26a0\ufe0f Unsafe UTXOs (",D.length,") - Contains Assets",B.size>0&&Pc.createElement("span",{style:{marginLeft:"8px",color:"var(--accentGreen)"}},"(",B.size," marked spendable)")),Pc.createElement("div",{style:{marginTop:"var(--spacing-sm)",fontSize:"10px",color:"var(--textMuted)"}},D.map((e,t)=>{const n=`${e.txid}:${e.vout}`,r=B.has(n);return Pc.createElement("div",{key:t,style:{padding:"var(--spacing-xs)",background:r?"rgba(34, 197, 94, 0.05)":"rgba(239, 68, 68, 0.05)",marginBottom:"var(--spacing-xs)",borderRadius:"var(--radius-sm)",border:"1px solid "+(r?"rgba(34, 197, 94, 0.2)":"rgba(239, 68, 68, 0.2)"),display:"flex",flexDirection:"column",gap:"4px"}},Pc.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},Pc.createElement("div",{style:{flex:1}},Pc.createElement("div",{style:{fontFamily:"var(--fontFamily-mono)",fontSize:"10px",color:"var(--textSecondary)"}},e.txid.substring(0,16),"...:",e.vout),Pc.createElement("div",{style:{color:r?"var(--accentGreen)":"var(--accentRed)",fontSize:"9px",marginTop:"2px"}},r?"\u2705 Marked as spendable by user":`\u26a0\ufe0f ${e.reason||"Contains assets"}`),Pc.createElement("div",{style:{color:"var(--textMuted)",fontSize:"9px",marginTop:"2px"}},X(e.value)," sats")),Pc.createElement("button",{onClick:t=>{t.stopPropagation(),(e=>{const t=`${e.txid}:${e.vout}`;P(e=>{const n=new Set(e);return n.has(t)?n.delete(t):n.add(t),n})})(e)},style:{padding:"4px 8px",fontSize:"9px",fontWeight:"var(--fontWeight-semibold)",color:r?"var(--accentRed)":"var(--accentGreen)",background:r?"rgba(239, 68, 68, 0.1)":"rgba(34, 197, 94, 0.1)",border:"1px solid "+(r?"var(--accentRed)":"var(--accentGreen)"),borderRadius:"var(--radius-sm)",cursor:"pointer",transition:"var(--transition-fast)",whiteSpace:"nowrap"},onMouseEnter:e=>{e.target.style.background=r?"rgba(239, 68, 68, 0.2)":"rgba(34, 197, 94, 0.2)"},onMouseLeave:e=>{e.target.style.background=r?"rgba(239, 68, 68, 0.1)":"rgba(34, 197, 94, 0.1)"}},r?"\u274c Unmark":"\u2705 Mark Safe")))}))),Pc.createElement("div",{className:"validation-info",style:{marginTop:"var(--spacing-md)",fontSize:"10px"}},Pc.createElement("span",null,"\u2139\ufe0f"),Pc.createElement("div",null,"UTXOs are checked against ",Pc.createElement("strong",null,"ordinals.com")," to filter out inscriptions, runes, and rare sats. Click UTXOs above to select/deselect.",B.size>0&&Pc.createElement("div",{style:{marginTop:"var(--spacing-xs)",color:"var(--accentOrange)",fontWeight:"var(--fontWeight-semibold)"}},"\u26a0\ufe0f ",B.size," UTXO",B.size>1?"s":""," manually marked as spendable. Use with caution - you may lose assets if ordinals.com detection is correct."))))):Pc.createElement("div",{className:"utxo-manager",style:{display:"flex",flexDirection:"column",height:"100%",minHeight:0,overflow:"hidden",alignItems:"center",justifyContent:"center",padding:"var(--spacing-lg)"}},Pc.createElement("div",{style:{textAlign:"center",color:"var(--textMuted)",fontSize:"var(--fontSize-sm)"}},Pc.createElement("div",{style:{fontSize:"2rem",marginBottom:"var(--spacing-sm)"}},"\ud83d\udd0c"),Pc.createElement("div",null,"Connect your wallet to select UTXOs")))}const YE="0d013bb60fc5bf5a6c77da7371b07dc162ebc7d7f3af0ff3bd00ae5f0c546445i0";let JE=null,QE=null,ZE=null,eN=!1;function tN(){return QE?Promise.resolve(QE):JE||(JE=(async()=>{!function(){if(eN)return;const e=document.querySelector('script[type="importmap"]');if(e)try{const t=JSON.parse(e.textContent);if(t?.imports?.three||t?.imports?.three)return void(eN=!0)}catch(r){}const t=kt(`/content/${YE}`),n=document.createElement("script");n.type="importmap",n.textContent=JSON.stringify({imports:{three:t}}),document.head.prepend(n),eN=!0}();const e=kt(`/content/${YE}`),t=await import(e);return QE=t,window.THREE||(window.THREE=t),QE})(),JE)}let nN=null;function rN({content:e,contentType:t,maxHeight:n="240px"}){const r=Bc.useRef(null),i=Bc.useRef(null),a=Bc.useRef(null),o=Bc.useRef(null),s=Bc.useRef(null),l=Bc.useRef(!1),c=Bc.useRef({x:0,y:0}),u=Bc.useRef({x:0,y:0}),d=Bc.useRef({x:0,y:0}),p=Bc.useRef(1),f=Bc.useRef(1),[m,g]=Bc.useState(!0),[h,b]=Bc.useState(null),y=Bc.useCallback(()=>{s.current&&(cancelAnimationFrame(s.current),s.current=null),i.current&&(i.current.dispose(),i.current=null),a.current=null,o.current=null},[]);return Bc.useEffect(()=>{if(!e||!r.current)return;let n=!1;return(async()=>{try{g(!0),b(null);const h=await tN();if(n)return;const y=r.current;if(!y)return;const x=y.clientWidth||300,w=y.clientHeight||240,v=new h.Scene;v.background=new h.Color(1710618),a.current=v;const S=new h.PerspectiveCamera(50,x/w,.01,1e3);o.current=S;const E=new h.WebGLRenderer({antialias:!0,alpha:!1});E.setSize(x,w),E.setPixelRatio(Math.min(window.devicePixelRatio,2)),E.outputColorSpace=h.SRGBColorSpace||h.sRGBEncoding,E.toneMapping=h.ACESFilmicToneMapping,E.toneMappingExposure=1.2,i.current=E,y.appendChild(E.domElement);const N=new h.AmbientLight(16777215,.6);v.add(N);const I=new h.DirectionalLight(16777215,1);I.position.set(5,8,5),v.add(I);const A=new h.DirectionalLight(8947967,.4);A.position.set(-3,4,-5),v.add(A);const k=new h.HemisphereLight(16772795,526368,.5);v.add(k);let T=null;const C=(t||"").toLowerCase(),B=C.includes("gltf-binary")||C.includes("glb"),P=C.includes("gltf+json")||C.includes("gltf-json");let _;if(e instanceof ArrayBuffer)_=e;else if("undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(e))_=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);else{if("string"!=typeof e)throw new Error("Unsupported content format for 3D preview");{const t=new TextEncoder;_=t.encode(e).buffer}}if(B||P){try{const e=await(ZE?Promise.resolve(ZE):nN||(nN=(async()=>{await tN();const e=kt("/content/d3d336842ef829556f1c76f12e6ed13e272fe0274f29bd1dfc46e2112304d3ffi0"),t=kt(`/content/${YE}`);let n;try{n=await import(e)}catch(a){const r=await fetch(e);let i=await r.text();i=i.replace(/from\s*"three"/g,`from "${t}"`),i=i.replace(/from\s*'three'/g,`from '${t}'`);const o=new URL(t,window.location.origin).origin;i=i.replace(/from\s*"(\/content\/[^"]+)"/g,(e,t)=>`from "${o}${t}"`),i=i.replace(/from\s*'(\/content\/[^']+)'/g,(e,t)=>`from '${o}${t}'`),i=i.replace(/import\(\s*"(\/content\/[^"]+)"\s*\)/g,(e,t)=>`import("${o}${t}")`),i=i.replace(/import\(\s*'(\/content\/[^']+)'\s*\)/g,(e,t)=>`import('${o}${t}')`);const s=new Blob([i],{type:"application/javascript"}),l=URL.createObjectURL(s);try{n=await import(l)}finally{URL.revokeObjectURL(l)}}const r=n.GLTFLoader||n._||n.default?.GLTFLoader,i=n.DRACOLoader||n.k||n.default?.DRACOLoader;return ZE={GLTFLoader:r,DRACOLoader:i},ZE})(),nN));if(n)return;if(e.GLTFLoader){const t=new e.GLTFLoader;if(e.DRACOLoader){const n=new e.DRACOLoader;t.setDRACOLoader(n)}T=(await new Promise((e,n)=>{t.parse(_,"",e,n)})).scene}}catch(c){}if(!T&&B)try{const e=await function(e,t){return new Promise((n,r)=>{try{const i=new DataView(t);if(1179937895!==i.getUint32(0,!0))return void r(new Error("Not a valid GLB file"));i.getUint32(4,!0);const a=i.getUint32(8,!0);let o=null,s=null,l=12;for(;l<a;){const e=i.getUint32(l,!0),n=i.getUint32(l+4,!0),r=new Uint8Array(t,l+8,e);if(l+=8+e,1313821514===n){const e=new TextDecoder;o=JSON.parse(e.decode(r))}5130562===n&&(s=r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength))}if(!o)return void r(new Error("GLB missing JSON chunk"));const c=new e.Group;c.name="GLB_Root";const u=(o.bufferViews||[]).map(e=>{const t=e.byteOffset||0,n=e.byteLength;return new Uint8Array(s,t,n)}),d=e=>{if(null==e)return null;const t=o.accessors[e],n=u[t.bufferView],r=t.byteOffset||0,i=t.count*({SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT4:16}[t.type]||1);return new({5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array}[t.componentType]||Float32Array)(n.buffer,n.byteOffset+r,i)},p=(o.meshes||[]).map(t=>{const n=new e.Group;return n.name=t.name||"Mesh",(t.primitives||[]).forEach(t=>{const r=new e.BufferGeometry;if(null!=t.attributes?.POSITION){const n=d(t.attributes.POSITION);n&&r.setAttribute("position",new e.BufferAttribute(new Float32Array(n),3))}if(null!=t.attributes?.NORMAL){const n=d(t.attributes.NORMAL);n&&r.setAttribute("normal",new e.BufferAttribute(new Float32Array(n),3))}if(null!=t.attributes?.TEXCOORD_0){const n=d(t.attributes.TEXCOORD_0);n&&r.setAttribute("uv",new e.BufferAttribute(new Float32Array(n),2))}if(null!=t.indices){const n=d(t.indices);n&&r.setIndex(new e.BufferAttribute(n instanceof Uint32Array?n:new Uint16Array(n),1))}let i;if(r.computeBoundingSphere(),null!=t.material&&o.materials?.[t.material]){const n=o.materials[t.material],r=n.pbrMetallicRoughness||{},a=r.baseColorFactor||[.8,.8,.8,1];i=new e.MeshStandardMaterial({color:new e.Color(a[0],a[1],a[2]),metalness:r.metallicFactor??0,roughness:r.roughnessFactor??1,transparent:a[3]<1,opacity:a[3],side:n.doubleSided?e.DoubleSide:e.FrontSide})}else i=new e.MeshStandardMaterial({color:8947848,roughness:.7,metalness:.3});const a=new e.Mesh(r,i);n.add(a)}),n}),f=(o.nodes||[]).map((t,n)=>{const r=t.mesh,i=null!=r&&p[r]?p[r].clone():new e.Group;if(i.name=t.name||`Node_${n}`,t.translation&&i.position.set(...t.translation),t.rotation&&i.quaternion.set(...t.rotation),t.scale&&i.scale.set(...t.scale),t.matrix){const n=new e.Matrix4;n.fromArray(t.matrix),n.decompose(i.position,i.quaternion,i.scale)}return i});(o.nodes||[]).forEach((e,t)=>{e.children&&e.children.forEach(e=>{f[e]&&f[t].add(f[e])})});const m=o.scene??0,g=o.scenes?.[m];g?.nodes?g.nodes.forEach(e=>{f[e]&&c.add(f[e])}):f.forEach(e=>c.add(e)),n({scene:c})}catch(Pk){r(Pk)}})}(h,_);T=e.scene}catch(m){throw new Error("Failed to parse GLB model")}}if(!T)throw new Error("Could not parse 3D model");if(n)return;v.add(T);const O=(new h.Box3).setFromObject(T),L=O.getCenter(new h.Vector3),F=O.getSize(new h.Vector3),M=Math.max(F.x,F.y,F.z),R=S.fov*(Math.PI/180);let $=M/2/Math.tan(R/2);$=Math.max(1.5*$,.1),T.position.sub(L),S.position.set(0,.3*M,$),S.lookAt(0,0,0),S.near=.01*$,S.far=100*$,S.updateProjectionMatrix(),p.current=$,f.current=$;const U=()=>{if(n)return;s.current=requestAnimationFrame(U),u.current.x+=.08*(d.current.x-u.current.x),u.current.y+=.08*(d.current.y-u.current.y),p.current+=.08*(f.current-p.current),l.current||(d.current.y+=.003);const e=u.current.x,t=u.current.y,r=p.current;S.position.x=r*Math.sin(t)*Math.cos(e),S.position.y=r*Math.sin(e),S.position.z=r*Math.cos(t)*Math.cos(e),S.lookAt(0,0,0),E.render(v,S)};U(),g(!1)}catch(Pk){n||(b(Pk.message||"Failed to load 3D model"),g(!1))}})(),()=>{if(n=!0,y(),r.current){const e=r.current.querySelector("canvas");e&&e.remove()}}},[e,t,y]),Bc.useEffect(()=>{const e=r.current;if(!e)return;const t=new ResizeObserver(()=>{const t=i.current,n=o.current;if(!t||!n)return;const r=e.clientWidth,a=e.clientHeight;t.setSize(r,a),n.aspect=r/a,n.updateProjectionMatrix()});return t.observe(e),()=>t.disconnect()},[]),Bc.useEffect(()=>{const e=r.current;if(!e)return;const t=e=>{l.current=!0;const t=e.touches?e.touches[0]:e;c.current={x:t.clientX,y:t.clientY},e.preventDefault()},n=e=>{if(!l.current)return;const t=e.touches?e.touches[0]:e,n=t.clientX-c.current.x,r=t.clientY-c.current.y;c.current={x:t.clientX,y:t.clientY},d.current.y+=.008*n,d.current.x=Math.max(-Math.PI/2.2,Math.min(Math.PI/2.2,d.current.x+.008*r)),e.preventDefault()},i=()=>{l.current=!1},a=e=>{const t=e.deltaY>0?1.1:.9;f.current=Math.max(.05,Math.min(500,f.current*t)),e.preventDefault()};return e.addEventListener("mousedown",t),e.addEventListener("mousemove",n),window.addEventListener("mouseup",i),e.addEventListener("touchstart",t,{passive:!1}),e.addEventListener("touchmove",n,{passive:!1}),window.addEventListener("touchend",i),e.addEventListener("wheel",a,{passive:!1}),()=>{e.removeEventListener("mousedown",t),e.removeEventListener("mousemove",n),window.removeEventListener("mouseup",i),e.removeEventListener("touchstart",t),e.removeEventListener("touchmove",n),window.removeEventListener("touchend",i),e.removeEventListener("wheel",a)}},[]),Pc.createElement("div",{style:{position:"relative",width:"100%",height:n,borderRadius:"6px",overflow:"hidden",background:"#1a1a1a",border:"1px solid var(--borderMedium)",cursor:l.current?"grabbing":"grab",touchAction:"none"}},Pc.createElement("div",{ref:r,style:{width:"100%",height:"100%"}}),m&&!h&&Pc.createElement("div",{style:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"rgba(26, 26, 26, 0.9)",zIndex:10}},Pc.createElement("div",{style:{width:"28px",height:"28px",border:"3px solid rgba(168, 85, 247, 0.3)",borderTopColor:"#a855f7",borderRadius:"50%",animation:"spin 0.8s linear infinite"}}),Pc.createElement("div",{style:{fontSize:"11px",color:"var(--textMuted)",marginTop:"8px"}},"Loading 3D model\u2026"),Pc.createElement("style",null,"@keyframes spin { to { transform: rotate(360deg); } }")),h&&Pc.createElement("div",{style:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"rgba(26, 26, 26, 0.95)",zIndex:10}},Pc.createElement("div",{style:{fontSize:"28px",marginBottom:"8px"}},"\u26a0\ufe0f"),Pc.createElement("div",{style:{fontSize:"12px",color:"#f87171",textAlign:"center",padding:"0 16px"}},h)),!m&&!h&&Pc.createElement("div",{style:{position:"absolute",top:"8px",right:"8px",padding:"2px 8px",borderRadius:"4px",background:"rgba(168, 85, 247, 0.25)",border:"1px solid rgba(168, 85, 247, 0.4)",fontSize:"10px",fontWeight:700,color:"#c084fc",pointerEvents:"none",zIndex:5}},"3D"))}class iN extends Pc.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(){}render(){return this.state.hasError?this.props.fallback||null:this.props.children}}function aN(e){if(!e)return 0;if("string"==typeof e)try{return(new TextEncoder).encode(e).length}catch{return e.length}if(e instanceof ArrayBuffer)return e.byteLength;if("undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(e))return e.byteLength;if("object"==typeof e){const t=e.byteLength;if("number"==typeof t&&Number.isFinite(t))return t}return 0}function oN({content:e,contentType:t,contentEncoding:n,maxHeight:r="240px",frame:i="default"}){const a=Bc.useRef(null),[o,s]=Pc.useState(!1),{ct:l}=Bc.useMemo(()=>function(e){const t=String(e||"").toLowerCase(),n=t.split(";")[0].trim();return{ctRaw:t,ct:n}}(t),[t]),c=Bc.useMemo(()=>function(e){return e?"image/svg+xml"===e?"svg":e.startsWith("image/")?"image":e.startsWith("audio/")?"audio":e.startsWith("video/")?"video":"text/html"===e?"html":e.includes("gltf")||e.includes("model/")||e.includes("glb")?"3d":e.includes("json")&&!e.includes("gltf")?"json":e.startsWith("text/")||e.includes("javascript")||e.includes("xml")||e.includes("yaml")||e.includes("typescript")||e.includes("css")?"text":"binary":"unknown"}(l),[l]);Bc.useEffect(()=>{"html"!==c&&o&&s(!1)},[c,o]);const u=Bc.useMemo(()=>{if(!e)return null;if("image"!==c&&"svg"!==c&&"html"!==c&&"audio"!==c&&"video"!==c)return null;try{if(e instanceof ArrayBuffer||"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(e)){const t=new Blob([e],{type:l||"application/octet-stream"});return URL.createObjectURL(t)}if("string"==typeof e&&("html"===c||"svg"===c)){const t=e.trim();if(t.startsWith("data:")||t.startsWith("blob:")||t.startsWith("http")||t.startsWith("/"))return null;const n=new Blob([e],{type:l||"text/plain"});return URL.createObjectURL(n)}}catch{}return null},[e,c,l]);if(Bc.useEffect(()=>{const e=a.current;if(a.current=u,e&&e!==u)try{URL.revokeObjectURL(e)}catch{}return()=>{if(a.current){try{URL.revokeObjectURL(a.current)}catch{}a.current=null}}},[u]),!e)return null;const d="none"===i?{borderRadius:"0px",overflow:"hidden",background:"transparent",border:"none"}:{borderRadius:"6px",overflow:"hidden",background:"rgba(0,0,0,0.25)",border:"1px solid var(--borderMedium)"},p={...d,width:"100%",height:r,maxHeight:r,display:"flex",alignItems:"stretch",justifyContent:"stretch"};if("image"===c||"svg"===c){const t=u||("string"==typeof e?e:null);return t?Pc.createElement("div",{style:{...p,background:"#111",alignItems:"center",justifyContent:"center"}},Pc.createElement("img",{src:t,alt:"Inscription preview",style:{width:"100%",height:"100%",maxWidth:"100%",maxHeight:"100%",objectFit:"contain",objectPosition:"center",display:"block"}})):null}if("html"===c){const t=u||("string"==typeof e&&(e.trim().startsWith("data:")||e.trim().startsWith("blob:"))?e.trim():null);return t?Pc.createElement("div",{style:{...d,height:r,maxHeight:r,width:"100%",display:"flex",flexDirection:"column"}},Pc.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"10px",padding:"8px 10px",borderBottom:"none"===i?"1px solid rgba(255,255,255,0.08)":"1px solid var(--borderMedium)",background:"rgba(0,0,0,0.25)"}},Pc.createElement("div",{style:{fontSize:"11px",color:"var(--textMuted)"}},"HTML Preview"),Pc.createElement("div",{style:{display:"flex",alignItems:"center",gap:"10px"}},Pc.createElement("label",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"11px",color:o?"var(--textPrimary)":"var(--textMuted)",cursor:"pointer",userSelect:"none"}},Pc.createElement("input",{type:"checkbox",checked:o,onChange:e=>s(!!e.target.checked),style:{accentColor:"#a855f7"}}),"Run scripts"),Pc.createElement("a",{href:t,target:"_blank",rel:"noreferrer",style:{fontSize:"11px",color:"#93c5fd",textDecoration:"none"}},"Open"))),Pc.createElement("iframe",{src:t,title:"HTML inscription preview",sandbox:o?"allow-scripts":"",loading:"lazy",style:{width:"100%",flex:1,minHeight:0,height:"100%",border:"none",background:"white",display:"block"}})):Pc.createElement("div",{style:{...p,padding:"12px",color:"var(--textMuted)",fontSize:"12px",height:"auto"}},"HTML preview unavailable (no blob URL).")}if("json"===c&&"string"==typeof e){let t=e;try{t=JSON.stringify(JSON.parse(e),null,2)}catch{}return Pc.createElement("div",{style:{...d,padding:"none"===i?"12px 14px":"10px 14px",height:r,maxHeight:r,overflowY:"auto",WebkitOverflowScrolling:"touch"}},Pc.createElement("pre",{style:{margin:0,fontFamily:"var(--fontFamily-mono)",fontSize:"11px",color:"#a5d6ff",lineHeight:"1.5",whiteSpace:"pre-wrap",wordBreak:"break-word"}},t))}if("text"===c&&"string"==typeof e){const t=e.trim(),n=t.match(/^(\d+)\.(\d+)\.bitmap$/),a=t.match(/^(\d+)\.bitmap$/);return n?Pc.createElement("div",{style:{...d,padding:"16px 14px",height:r,maxHeight:r,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"6px"}},Pc.createElement("div",{style:{fontSize:"10px",textTransform:"uppercase",letterSpacing:"0.5px",color:"var(--textMuted)",fontWeight:600}},"Inscribed Content"),Pc.createElement("div",{style:{fontSize:"18px",fontWeight:700,fontFamily:"var(--fontFamily-mono)",letterSpacing:"0.5px"}},Pc.createElement("span",{style:{color:"#f79a27"}},n[1]),Pc.createElement("span",{style:{color:"var(--textMuted)"}},"."),Pc.createElement("span",{style:{color:"var(--textPrimary)"}},n[2]),Pc.createElement("span",{style:{color:"var(--textMuted)"}},"."),Pc.createElement("span",{style:{color:"#4A90E2"}},"bitmap")),Pc.createElement("div",{style:{fontSize:"10px",color:"var(--textMuted)"}},"Parcel ",n[1]," of block ",n[2])):a?Pc.createElement("div",{style:{...d,padding:"16px 14px",height:r,maxHeight:r,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"6px"}},Pc.createElement("div",{style:{fontSize:"10px",textTransform:"uppercase",letterSpacing:"0.5px",color:"var(--textMuted)",fontWeight:600}},"Inscribed Content"),Pc.createElement("div",{style:{fontSize:"18px",fontWeight:700,fontFamily:"var(--fontFamily-mono)",letterSpacing:"0.5px"}},Pc.createElement("span",{style:{color:"var(--textPrimary)"}},a[1]),Pc.createElement("span",{style:{color:"var(--textMuted)"}},"."),Pc.createElement("span",{style:{color:"#4A90E2"}},"bitmap")),Pc.createElement("div",{style:{fontSize:"10px",color:"var(--textMuted)"}},"Bitmap parent for block ",a[1])):Pc.createElement("div",{style:{...d,padding:"none"===i?"12px 14px":"10px 14px",height:r,maxHeight:r,overflowY:"auto",WebkitOverflowScrolling:"touch"}},Pc.createElement("pre",{style:{margin:0,fontFamily:"var(--fontFamily-mono)",fontSize:"11px",color:"var(--textMuted)",lineHeight:"1.5",whiteSpace:"pre-wrap",wordBreak:"break-word"}},e.length>2e3?e.substring(0,2e3)+"\n\n\u2026 (truncated)":e))}if("3d"===c)return Pc.createElement(iN,{fallback:Pc.createElement("div",{style:{...d,padding:"12px",color:"var(--textMuted)",fontSize:"12px"}},"3D preview failed to render.")},Pc.createElement(rN,{content:e,contentType:t,maxHeight:r}));if(("audio"===c||"video"===c)&&(u||"string"==typeof e)){const t=u||("string"==typeof e?e:null);if(!t)return null;if("audio"===c)return Pc.createElement("div",{style:{...d,padding:"12px"}},Pc.createElement("audio",{controls:!0,src:t,style:{width:"100%"}}));if("video"===c)return Pc.createElement("div",{style:{...p,background:"#111"}},Pc.createElement("video",{controls:!0,src:t,style:{width:"100%",height:"100%",maxWidth:"100%",maxHeight:"100%",display:"block",objectFit:"contain"}}))}const f=aN(e);return Pc.createElement("div",{style:{...d,padding:"16px",height:r,maxHeight:r,textAlign:"center",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"}},Pc.createElement("div",{style:{fontSize:"28px",marginBottom:"8px"}},"\ud83d\udce6"),Pc.createElement("div",{style:{fontSize:"12px",color:"var(--textPrimary)",fontWeight:600}},t||"application/octet-stream"),Pc.createElement("div",{style:{fontSize:"11px",color:"var(--textMuted)",fontFamily:"var(--fontFamily-mono)",marginTop:"4px"}},f>0?f.toLocaleString()+" bytes":"Unknown size",n?" \xb7 "+n:""))}function sN({content:e="",contentType:t="",contentSize:n=0,fileName:r="",feeEstimate:i=null,selectedParents:a=[],reinscriptionTarget:o=null,repeatCount:s=1,onRepeatCountChange:l,delegateId:c="",metaprotocol:u="",metadata:d="",properties:p="",customTags:f=null,pointer:m="",contentEncoding:g="",compressBeforeInscribe:h=!1,onCompressBeforeInscribeChange:b,isDraftCompressing:y=!1,draftCompressedSize:x=null,recipientAddress:w="",batchItems:v=[],onAddToBatch:S,onRemoveFromBatch:E,onEditBatchItem:N,onDuplicateBatchItem:I,onAddAnother:A,inscriptionMode:k="standard"}){const T=v.length>0,[C,B]=Pc.useState(!1);Bc.useEffect(()=>{T&&B(!1)},[T]);const P=!!o,_=P?1:parseInt(s,10)||1,O=e=>{if(!l)return;const t=Math.max(1,Math.min(200,parseInt(e,10)||1));l(t)};Pc.useCallback(e=>{const t=Number(e);return!Number.isFinite(t)||t<0?null:t<1024?`${Math.round(t).toLocaleString()} B`:t<1048576?`${(t/1024).toFixed(1)} KB`:t<1073741824?`${(t/1048576).toFixed(2)} MB`:`${(t/1073741824).toFixed(2)} GB`},[]);const L=e=>e?e<1024?e+" B":e<1048576?(e/1024).toFixed(1)+" KB":(e/1048576).toFixed(2)+" MB":"0 B",F=e=>(e||"").split(";")[0]||"Unknown",M=/^(\d+)\.(\d+)\.bitmap$/,R=/^(\d+)\.bitmap$/,$=e=>{if("string"!=typeof e)return null;const t=e.trim(),n=t.match(M);if(n)return{kind:"parcel",parcel:n[1],block:n[2],full:t};const r=t.match(R);return r?{kind:"parent",block:r[1],full:t}:null},U={display:"flex",alignItems:"flex-start",justifyContent:"space-between",gap:"10px",flexWrap:"wrap"},z={fontSize:"11px",color:"var(--textMuted)",whiteSpace:"nowrap"},D={fontSize:"11px",color:"var(--textPrimary)",fontFamily:"var(--fontFamily-mono)",wordBreak:"break-word",flex:1,minWidth:"160px",textAlign:"right"};if(!T){const s=(()=>{const e=[],t=a||[],n=o,r=c,i=u,s=d,l=p,f=g,b=h,y=m;return 1===t.length&&e.push("Parent-Child"),t.length>1&&e.push("Multi-Parent ("+t.length+")"),n&&e.push("Reinscription"),r&&e.push("Delegate"),i&&e.push(i),s&&e.push("Metadata"),l&&e.push("Properties"),f&&e.push("Encoding"),b&&!f&&e.push("Brotli"),y&&e.push("Pointer"),e})(),l=F(t),f=L(n),b=(()=>{const e=i?.postage;return"number"==typeof e&&Number.isFinite(e)&&e>=0?Math.floor(e):o?0:546})(),y=$(e),x=(a||[]).map(e=>e&&(e.id||e.inscriptionId||e.inscription_id)).map(e=>String(e||"").trim()).filter(Boolean),v=String(o||"").split(",").map(e=>String(e||"").trim()).filter(Boolean),S=v.length>0?v[v.length-1]:"";return Pc.createElement("div",{style:{display:"flex",flexDirection:"column",height:"100%",minHeight:0,gap:"12px",overflowY:"auto",WebkitOverflowScrolling:"touch",paddingBottom:"8px"}},Pc.createElement("div",{style:{padding:"12px 16px",background:"var(--bgSecondary)",border:"1px solid var(--borderMedium)",borderRadius:"8px"}},Pc.createElement("div",{style:{fontSize:"15px",fontWeight:600,color:"var(--textPrimary)",marginBottom:"4px"}},"Inscription Review"),Pc.createElement("div",{style:{fontSize:"12px",color:"var(--textMuted)"}},"Review your inscription before creating")),Pc.createElement("div",{style:{background:"var(--bgSecondary)",border:"1px solid var(--borderMedium)",borderRadius:"8px"}},Pc.createElement("div",{style:{padding:"12px 16px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px",flexWrap:"wrap"}},Pc.createElement("div",{style:{flex:1,minWidth:0}},Pc.createElement("div",{style:{fontSize:"14px",fontWeight:600,color:"var(--textPrimary)"}},l),r&&Pc.createElement("div",{style:{fontSize:"11px",color:"var(--textMuted)",fontFamily:"var(--fontFamily-mono)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",marginTop:"2px"}},r)),Pc.createElement("div",{style:{fontSize:"12px",color:"var(--textMuted)",fontFamily:"var(--fontFamily-mono)",flexShrink:0}},f)),s.length>0&&Pc.createElement("div",{style:{padding:"0 16px 10px",display:"flex",flexWrap:"wrap",gap:"6px"}},s.map((e,t)=>Pc.createElement("span",{key:t,style:{fontSize:"10px",padding:"2px 8px",background:"rgba(168, 85, 247, 0.15)",color:"#c084fc",borderRadius:"99px",border:"1px solid rgba(168, 85, 247, 0.3)"}},e))),e&&Pc.createElement(Pc.Fragment,null,(()=>{const t=$(e);return t?"parcel"===t.kind?Pc.createElement("div",{style:{padding:"14px 16px",borderTop:"1px solid var(--borderMedium)",background:"rgba(74, 144, 226, 0.08)",display:"flex",flexDirection:"column",alignItems:"center",gap:"6px"}},Pc.createElement("div",{style:{fontSize:"10px",textTransform:"uppercase",letterSpacing:"0.5px",color:"var(--textMuted)",fontWeight:600}},"Inscribed Content"),Pc.createElement("div",{style:{fontSize:"20px",fontWeight:700,fontFamily:"var(--fontFamily-mono)",letterSpacing:"0.5px"}},Pc.createElement("span",{style:{color:"#f79a27"}},t.parcel),Pc.createElement("span",{style:{color:"var(--textMuted)"}},"."),Pc.createElement("span",{style:{color:"var(--textPrimary)"}},t.block),Pc.createElement("span",{style:{color:"var(--textMuted)"}},"."),Pc.createElement("span",{style:{color:"#4A90E2"}},"bitmap")),Pc.createElement("div",{style:{fontSize:"10px",color:"var(--textMuted)"}},"Parcel ",t.parcel," of block ",t.block)):Pc.createElement("div",{style:{padding:"14px 16px",borderTop:"1px solid var(--borderMedium)",background:"rgba(247, 154, 39, 0.06)",display:"flex",flexDirection:"column",alignItems:"center",gap:"6px"}},Pc.createElement("div",{style:{fontSize:"10px",textTransform:"uppercase",letterSpacing:"0.5px",color:"var(--textMuted)",fontWeight:600}},"Inscribed Content"),Pc.createElement("div",{style:{fontSize:"20px",fontWeight:700,fontFamily:"var(--fontFamily-mono)",letterSpacing:"0.5px"}},Pc.createElement("span",{style:{color:"var(--textPrimary)"}},t.block),Pc.createElement("span",{style:{color:"var(--textMuted)"}},"."),Pc.createElement("span",{style:{color:"#4A90E2"}},"bitmap")),Pc.createElement("div",{style:{fontSize:"10px",color:"var(--textMuted)"}},"Bitmap parent for block ",t.block)):null})(),Pc.createElement("div",{style:{padding:"12px 16px",background:"rgba(0,0,0,0.12)",borderTop:"1px solid var(--borderMedium)"}},Pc.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"10px",marginBottom:"8px"}},Pc.createElement("div",{style:{fontSize:"11px",color:"var(--textMuted)",fontWeight:500}},"Content Preview"),Pc.createElement("button",{type:"button",onClick:()=>B(e=>!e),style:{fontSize:"11px",padding:"4px 10px",borderRadius:"999px",background:C?"rgba(168, 85, 247, 0.18)":"rgba(23, 23, 23, 0.2)",color:C?"#e9d5ff":"var(--textMuted)",border:C?"1px solid rgba(168, 85, 247, 0.35)":"1px solid rgba(64, 64, 64, 0.35)",cursor:"pointer",userSelect:"none"}},C?"Collapse":"Expand")),Pc.createElement("div",{style:{width:"100%",maxWidth:C?"100%":"min(720px, 100%)",height:C?"min(70vh, 820px)":"420px",margin:"0 auto",display:"flex",alignItems:"stretch",justifyContent:"stretch",borderRadius:"12px",overflow:"hidden",border:"1px solid var(--borderMedium)",background:"rgba(0,0,0,0.25)"}},Pc.createElement(oN,{content:e,contentType:t,contentEncoding:g,maxHeight:"100%"})))),!e&&Pc.createElement("div",{style:{padding:"24px 16px",textAlign:"center",color:"var(--textMuted)",fontSize:"13px",borderTop:"1px solid var(--borderMedium)"}},"No content added yet")),Pc.createElement("div",{style:{background:"var(--bgSecondary)",border:"1px solid var(--borderMedium)",borderRadius:"8px",padding:"12px 16px",display:"flex",flexDirection:"column",gap:"10px"}},Pc.createElement("div",{style:{display:"flex",alignItems:"baseline",justifyContent:"space-between",gap:"10px",flexWrap:"wrap"}},Pc.createElement("div",{style:{fontSize:"13px",fontWeight:600,color:"var(--textPrimary)"}},"Delivery"),y&&"parcel"===y.kind&&Pc.createElement("div",{style:{fontSize:"10px",color:"var(--textMuted)"}},"Parcel inscription")),Pc.createElement("div",{style:U},Pc.createElement("div",{style:z},"\ud83d\udc8e Postage"),Pc.createElement("div",{style:D},b.toLocaleString()," sats")),Pc.createElement("div",{style:{height:"1px",background:"var(--borderMedium)",opacity:.7}}),Pc.createElement("div",{style:U},Pc.createElement("div",{style:z},"\ud83d\udccd Destination"),Pc.createElement("div",{style:{...D,textAlign:"right"}},String(w||"").trim()?String(w).trim():"Default (wallet ordinals address)"))),Pc.createElement("div",{style:{background:"var(--bgSecondary)",border:"1px solid var(--borderMedium)",borderRadius:"8px",overflow:"hidden"}},Pc.createElement("details",{style:{padding:"10px 16px"}},Pc.createElement("summary",{style:{cursor:"pointer",listStyle:"none",fontSize:"13px",fontWeight:600,color:"var(--textPrimary)"}},"Advanced options",Pc.createElement("span",{style:{marginLeft:"8px",fontSize:"11px",fontWeight:500,color:"var(--textMuted)"}},"(tap to expand)")),Pc.createElement("div",{style:{marginTop:"10px",display:"flex",flexDirection:"column",gap:"8px"}},Pc.createElement("div",{style:U},Pc.createElement("div",{style:z},"Parents"),Pc.createElement("div",{style:D},0===x.length?"None":`${x.length} selected`)),x.length>0&&Pc.createElement("div",{style:{padding:"8px 10px",borderRadius:"6px",background:"rgba(0,0,0,0.25)",border:"1px solid var(--borderMedium)",fontFamily:"var(--fontFamily-mono)",fontSize:"10px",color:"var(--textMuted)",wordBreak:"break-word"}},x.slice(0,2).join("\n"),x.length>2?`\n\u2026 +${x.length-2} more`:""),Pc.createElement("div",{style:U},Pc.createElement("div",{style:z},"Reinscription"),Pc.createElement("div",{style:D},0===v.length?"None":v.length>1?`${v.length} IDs (using latest)`:"Enabled")),S&&Pc.createElement("div",{style:{padding:"8px 10px",borderRadius:"6px",background:"rgba(0,0,0,0.25)",border:"1px solid var(--borderMedium)",fontFamily:"var(--fontFamily-mono)",fontSize:"10px",color:"var(--textMuted)",wordBreak:"break-word"}},S),Pc.createElement("div",{style:U},Pc.createElement("div",{style:z},"Delegate"),Pc.createElement("div",{style:D},String(c||"").trim()?"Set":"None")),String(c||"").trim()&&Pc.createElement("div",{style:{padding:"8px 10px",borderRadius:"6px",background:"rgba(0,0,0,0.25)",border:"1px solid var(--borderMedium)",fontFamily:"var(--fontFamily-mono)",fontSize:"10px",color:"var(--textMuted)",wordBreak:"break-word"}},String(c).trim()),Pc.createElement("div",{style:U},Pc.createElement("div",{style:z},"Metaprotocol"),Pc.createElement("div",{style:D},String(u||"").trim()||"None")),Pc.createElement("div",{style:U},Pc.createElement("div",{style:z},"Pointer"),Pc.createElement("div",{style:D},String(m||"").trim()||"None")),Pc.createElement("div",{style:U},Pc.createElement("div",{style:z},"Metadata"),Pc.createElement("div",{style:D},String(d||"").trim()?`${new Blob([String(d)]).size.toLocaleString()} bytes`:"None")),Pc.createElement("div",{style:U},Pc.createElement("div",{style:z},"Properties"),Pc.createElement("div",{style:D},String(p||"").trim()?`${new Blob([String(p)]).size.toLocaleString()} bytes`:"None")),Pc.createElement("div",{style:U},Pc.createElement("div",{style:z},"Encoding"),Pc.createElement("div",{style:D},String(g||"").trim()||"None"))))),Pc.createElement("div",{style:{background:"var(--bgSecondary)",border:"1px solid var(--borderMedium)",borderRadius:"8px",padding:"12px 16px",display:"flex",flexDirection:"column",gap:"10px"}},Pc.createElement("div",{style:{display:"flex",alignItems:"center",gap:"10px",flexWrap:"wrap"}},Pc.createElement("span",{style:{fontSize:"13px",fontWeight:600,color:"var(--textPrimary)",minWidth:"50px"}},"Copies"),Pc.createElement("div",{style:{display:"flex",alignItems:"center",gap:"4px"}},Pc.createElement("button",{onClick:()=>O(Math.max(1,_-1)),disabled:P||_<=1,style:{width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.3)",border:"1px solid var(--borderMedium)",borderRadius:"6px",color:"var(--textPrimary)",fontSize:"16px",cursor:P||_<=1?"not-allowed":"pointer",opacity:P||_<=1?.4:1}},"\u2212"),Pc.createElement("input",{type:"number",min:"1",max:"200",value:_,disabled:P,onChange:e=>O(e.target.value),style:{width:"64px",padding:"6px 8px",background:"rgba(0,0,0,0.4)",border:"1px solid var(--borderMedium)",borderRadius:"6px",color:"var(--textPrimary)",fontSize:"14px",fontFamily:"var(--fontFamily-mono)",fontWeight:600,textAlign:"center",opacity:P?.5:1}}),Pc.createElement("button",{onClick:()=>O(Math.min(200,_+1)),disabled:P||_>=200,style:{width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.3)",border:"1px solid var(--borderMedium)",borderRadius:"6px",color:"var(--textPrimary)",fontSize:"16px",cursor:P||_>=200?"not-allowed":"pointer",opacity:P||_>=200?.4:1}},"+")),Pc.createElement("span",{style:{fontSize:"11px",color:"var(--textMuted)"}},_>1?`Create ${_} identical inscriptions`:"Single inscription"),P&&Pc.createElement("span",{style:{fontSize:"10px",color:"var(--textMuted)"}},"Disabled for reinscriptions"))))}return Pc.createElement("div",{className:"nexus-review-batch"},Pc.createElement("div",{className:"nexus-review-batch__bar"},Pc.createElement("div",{className:"nexus-review-batch__title"},"Review"),Pc.createElement("div",{className:"nexus-review-batch__count"},v.length," item",1!==v.length?"s":""),Pc.createElement("div",{className:"nexus-review-batch__status"},"Ready")),I&&v.length>0&&!v[v.length-1]?.reinscriptionTargetId&&Pc.createElement("div",{style:{background:"var(--bgSecondary)",border:"1px solid var(--borderMedium)",borderRadius:"8px",padding:"10px 16px",margin:"0 0 8px",display:"flex",alignItems:"center",gap:"10px",flexWrap:"wrap"}},Pc.createElement("span",{style:{fontSize:"13px",fontWeight:600,color:"var(--textPrimary)",minWidth:"80px"}},"Quick Repeat"),Pc.createElement("div",{style:{display:"flex",alignItems:"center",gap:"4px"}},[2,5,10,25].map(e=>Pc.createElement("button",{key:e,onClick:()=>{const t=v.length-1;for(let n=0;n<e;n++)I(t)},style:{padding:"4px 12px",background:"rgba(168, 85, 247, 0.12)",border:"1px solid rgba(168, 85, 247, 0.3)",borderRadius:"6px",color:"#c084fc",fontSize:"12px",fontWeight:600,cursor:"pointer"}},"+",e))),Pc.createElement("span",{style:{fontSize:"11px",color:"var(--textMuted)"}},"Duplicate last item")),Pc.createElement("div",{className:"nexus-review-list"},v.map((e,t)=>{const n=F(e.contentType),r=L((e=>"number"==typeof e.contentSize?e.contentSize:aN(e.content))(e)),i=e.features||[],a=!(!e.content||!("string"!=typeof e.content||e.content.length>0)),o=!!(e.reinscriptionTarget||e.reinscriptionTargetId||e.reinscriptionUtxo),s=o?0:330,l=(()=>{const t=e.postage,n="number"==typeof t?t:parseInt(t,10);return Number.isFinite(n)?Math.max(s,Math.floor(n)):o?0:546})(),c=String(e.destinationAddress||e.recipientAddress||"").trim();return Pc.createElement("div",{key:e.id||t,className:"nexus-review-item"},Pc.createElement("div",{className:"nexus-review-item__row"},Pc.createElement("div",{className:"nexus-review-item__left"},Pc.createElement("div",{className:"nexus-review-item__head"},Pc.createElement("span",{className:"nexus-review-item__index"},"#",t+1),Pc.createElement("div",{className:"nexus-review-item__meta"},(()=>{const t=$(e.content);return t&&"parcel"===t.kind?Pc.createElement(Pc.Fragment,null,Pc.createElement("div",{className:"nexus-review-item__title nexus-review-item__title--mono"},Pc.createElement("span",{style:{color:"#f79a27"}},t.parcel),Pc.createElement("span",{style:{color:"var(--textMuted)"}},"."),Pc.createElement("span",{style:{color:"var(--textPrimary)"}},t.block),Pc.createElement("span",{style:{color:"var(--textMuted)"}},"."),Pc.createElement("span",{style:{color:"#4A90E2"}},"bitmap"))):t&&"parent"===t.kind?Pc.createElement("div",{className:"nexus-review-item__title nexus-review-item__title--mono"},Pc.createElement("span",{style:{color:"var(--textPrimary)"}},t.block),Pc.createElement("span",{style:{color:"var(--textMuted)"}},"."),Pc.createElement("span",{style:{color:"#4A90E2"}},"bitmap")):Pc.createElement(Pc.Fragment,null,Pc.createElement("div",{className:"nexus-review-item__title"},n),Pc.createElement("div",{className:"nexus-review-item__sub"},r,e.fileName?" \xb7 "+e.fileName:""))})()),Pc.createElement("div",{style:{display:"flex",alignItems:"center",gap:"4px",marginLeft:"auto",flexShrink:0}},I&&!o&&Pc.createElement("button",{onClick:()=>I(t),title:"Duplicate this inscription",className:"nexus-review-item__remove",style:{color:"var(--textMuted)",opacity:.7}},"\u29c9"),E&&Pc.createElement("button",{onClick:()=>E(t),title:"Remove",className:"nexus-review-item__remove"},"\u2715"))),i.length>0&&Pc.createElement("div",{className:"nexus-review-item__features"},i.map((e,t)=>Pc.createElement("span",{key:t,className:"nexus-review-item__chip"},e))),Pc.createElement("div",{className:"nexus-review-item__controls"},Pc.createElement("div",{className:"nexus-review-item__controlsRow"},Pc.createElement("label",{className:"nexus-review-item__controlsLabel"},"\ud83d\udc8e"),Pc.createElement("input",{type:"number",placeholder:String(s||330),min:String(s||330),value:l,onChange:e=>N&&N(t,{postage:parseInt(e.target.value,10)||(o?0:546)}),className:"nexus-review-input nexus-review-input--postage"}),Pc.createElement("span",{className:"nexus-review-item__controlsUnit"},"sats")),Pc.createElement("input",{type:"text",placeholder:"\ud83d\udccd Destination (optional)",value:c,onChange:e=>N&&N(t,{destinationAddress:e.target.value,recipientAddress:e.target.value}),className:"nexus-review-input nexus-review-input--dest"}))),a&&Pc.createElement("div",{className:"nexus-review-item__preview"},Pc.createElement(oN,{content:e.content,contentType:e.contentType,contentEncoding:e.contentEncoding,maxHeight:"100%",frame:"none"}))))})))}const lN=new Map,cN=new Map,uN=new Map,dN=new Map;function pN(e){if(!e)return null;const t=lN.get(e);return t&&Date.now()-t.timestamp<36e5?t:null}function fN(e,t,n){try{const t=lN.get(e),n=t?.data;if("string"==typeof n&&n.startsWith("blob:")){const t=dN.get(n);t&&(t.delete(e),0===t.size&&dN.delete(n))}}catch{}lN.set(e,{contentType:t,data:n,timestamp:Date.now()});try{if("string"==typeof n&&n.startsWith("blob:")){const t=dN.get(n)||new Set;t.add(e),dN.set(n,t)}}catch{}}function mN(e){try{if("string"!=typeof e||!e.startsWith("blob:"))return;const t=(uN.get(e)||0)-1;if(t<=0){uN.delete(e);try{const t=dN.get(e);if(t&&t.size>0)for(const n of t){const t=lN.get(n);t?.data===e&&lN.delete(n)}dN.delete(e)}catch{}try{URL.revokeObjectURL(e)}catch{}}else uN.set(e,t)}catch{}}async function gN({inscriptionId:e,contentUrl:t,fallbackContentType:n="",forceRefresh:r=!1}){if(!e||!t)return null;if(!r){const t=pN(e);if(t)return t}const i=cN.get(e);if(i)return i;const a=(async()=>{const i=n||"";if(String(i).toLowerCase().startsWith("text/html"))return fN(e,i,t),pN(e);const a=await async function(e){try{const t=await fetch(e,{method:"HEAD"});return t.ok?String(t.headers.get("content-type")||""):""}catch{return""}}(t),o=String(a||"").toLowerCase();if(o.startsWith("text/html")||o.startsWith("image/"))return fN(e,o||i,t),pN(e);if(o&&!r)return fN(e,o||i,t),pN(e);const s=await fetch(t);if(!s.ok)throw new Error(`HTTP ${s.status}`);const l=String(s.headers.get("content-type")||""),c=l.toLowerCase();if(c.startsWith("text/html"))return fN(e,c||i,t),pN(e);const u=await s.arrayBuffer(),d=function(e){try{const t=new Uint8Array(e||[]);if(t.length>=8){if(137===t[0]&&80===t[1]&&78===t[2]&&71===t[3]&&13===t[4]&&10===t[5]&&26===t[6]&&10===t[7])return"image/png";if(71===t[0]&&73===t[1]&&70===t[2]&&56===t[3])return"image/gif";if(255===t[0]&&216===t[1]&&255===t[2])return"image/jpeg";if(82===t[0]&&73===t[1]&&70===t[2]&&70===t[3]&&87===t[8]&&69===t[9]&&66===t[10]&&80===t[11])return"image/webp"}if(t.length>=12&&102===t[4]&&116===t[5]&&121===t[6]&&112===t[7]){const e=Math.min((t[0]<<24|t[1]<<16|t[2]<<8|t[3])>>>0,t.length),n=new Set;for(let r=8;r+3<e;r+=4)12!==r&&n.add(String.fromCharCode(t[r],t[r+1],t[r+2],t[r+3]));if(n.has("avif")||n.has("avis"))return"image/avif";if(n.has("heic")||n.has("heix")||n.has("hevc")||n.has("hevx"))return"image/heic"}if(t.length>=16)try{const e=new TextDecoder("utf-8",{fatal:!1}).decode(t.slice(0,2048)),n=String(e||"").replace(/^\uFEFF/,"").trimStart().toLowerCase();if(n.startsWith("<svg")||n.startsWith("<?xml")&&n.includes("<svg")||n.includes("<svg"))return"image/svg+xml"}catch{}}catch{}return""}(u),p=function({headerCt:e="",sniffedCt:t="",fallbackCt:n=""}){const r=String(e||"").toLowerCase(),i=String(t||"").toLowerCase(),a=String(n||"").toLowerCase();return r.startsWith("text/html")?r:i.startsWith("image/")?i:r.startsWith("image/")?r:a.startsWith("image/")?a:r||i||a||""}({headerCt:l,sniffedCt:d,fallbackCt:i}),f=String(p||"").toLowerCase();if(!f.startsWith("image/")&&!f.startsWith("text/html"))return fN(e,p||l||i,t),pN(e);const m=new Blob([u],{type:p||void 0}),g=URL.createObjectURL(m);return fN(e,p||i,g),pN(e)})();cN.set(e,a);try{return await a}finally{cN.delete(e)}}const hN=lN;function bN({inscription:e,width:t,height:n,size:r}){const i=e?.id||e?.inscriptionId||e?.inscription_id||"",a=e?.contentType||e?.content_type||"",o=e?.number||e?.inscriptionNumber||e?.inscription_number,[s,l]=Bc.useState(!1),[c,u]=Bc.useState(null),[d,p]=Bc.useState(!1),f=Pc.useRef(null),m=r?`${r}px`:t||"100%",g=r?`${r}px`:n||"120px",h=String(a||"").toLowerCase(),b=String(c?.contentType||"").toLowerCase(),y=h.startsWith("image/")||b.startsWith("image/"),x=h.startsWith("text/html")||b.startsWith("text/html"),w=i?kt(`/content/${i}`):null,v=b||h,S=v.includes("octet-stream")||v.includes("binary/octet-stream"),E=!x&&(y||S||!v);return Bc.useEffect(()=>{p(!1)},[i]),Bc.useEffect(()=>{if(!i)return;const e=pN(i);let t=!1,n=!1;if(e){u(e),l(!0);try{const t=String(e?.contentType||"").toLowerCase(),r=e?.data;"string"!=typeof r||r.startsWith("blob:")||t&&"unknown"!==t||(n=!0)}catch{}try{const n=String(e?.contentType||"").toLowerCase(),r=e?.data;"string"!=typeof r||!r.startsWith("blob:")||n.startsWith("image/")||n.startsWith("text/html")||(t=!0)}catch{}if(!t&&!n)return}if(!w)return;let r=!1;return(async()=>{const e=await gN({inscriptionId:i,contentUrl:w,fallbackContentType:a,forceRefresh:!!t});!r&&e&&(u(e),l(!0))})().catch(e=>{l(!0)}),()=>{r=!0}},[i,w,a]),Bc.useEffect(()=>{const e=c?.data,t=f.current;return t&&t!==e&&mN(t),"string"==typeof e&&e.startsWith("blob:")?(function(e){try{if("string"!=typeof e||!e.startsWith("blob:"))return;const t=(uN.get(e)||0)+1;uN.set(e,t)}catch{}}(e),f.current=e):f.current=null,()=>{const e=f.current;e&&mN(e),f.current=null}},[c?.data]),Pc.createElement("div",{style:{width:m,height:g,borderRadius:"6px",overflow:"hidden",background:"#1a1a1a",position:"relative",border:"1px solid rgba(255, 255, 255, 0.1)"}},i?E&&!d?Pc.createElement("img",{src:c?.data||w,alt:`#${o||i.slice(0,8)}`,style:{width:"100%",height:"100%",objectFit:"contain",objectPosition:"center"},loading:"lazy",onLoad:()=>l(!0),onError:()=>{p(!0)}}):Pc.createElement("iframe",{src:w,title:`#${o||i.slice(0,8)}`,style:{width:"100%",height:"100%",border:"none",background:"white",display:"block"},sandbox:"allow-scripts allow-same-origin",onLoad:()=>l(!0)}):Pc.createElement("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"11px",color:"#888"}},e?"Loading inscription data...":"No inscription selected"))}const yN=Object.freeze(Object.defineProperty({__proto__:null,contentCache:hN,default:bN,prefetchInscriptionContent:async function(e,t=""){if(!e)return!1;if(pN(e))return!0;const n=kt(`/content/${e}`);if(String(t||"").toLowerCase().startsWith("text/html"))return fN(e,t,n),!0;try{return!!(await gN({inscriptionId:e,contentUrl:n,fallbackContentType:t,forceRefresh:!1}))}catch(_k){return!1}}},Symbol.toStringTag,{value:"Module"}));class xN{constructor(e=[]){this.width=0,this.height=0,this.rowOffset=0,this.rows=[],this.slots=[];let t=0;for(const n of e)t+=n*n;this.length=Math.ceil(Math.sqrt(t));for(const n of e)this.place(n)}getSize(){return{width:this.width,height:this.height}}getRow(e){return e.y-this.rowOffset<this.rows.length?this.rows[e.y-this.rowOffset]:null}getSlot(e){const t=this.getRow(e);return null!==t&&t.map.has(e.x)&&t.map.get(e.x)||null}addRow(){const e={y:this.rows.length+this.rowOffset,slots:[],map:new Map,max:0};return this.rows.push(e),e}addSlot(e){if(e.size<=0)return null;const t=this.getSlot(e.position);if(null!==t)return t.size=Math.max(t.size,e.size),t;{const t=this.getRow(e.position);if(null===t)return null;const n=t.slots.findIndex(t=>t.position.x>e.position.x);return-1===n?t.slots.push(e):t.slots.splice(n,0,e),t.map.set(e.position.x,e),e}}removeSlot(e){const t=this.getRow(e.position);if(null!==t){t.map.delete(e.position.x);const n=t.slots.findIndex(t=>t.position.x===e.position.x);-1!==n&&t.slots.splice(n,1)}}fillSlot(e,t){const n={left:e.position.x,right:e.position.x+t,bottom:e.position.y,top:e.position.y+t};this.removeSlot(e);for(let r=e.position.y;r<n.top;r++){const i=this.getRow({x:e.position.x,y:r});if(null!==i){const a=[];let o=0;for(const t of i.slots)if(!(t.position.x+t.size<n.left||t.position.x>=n.right)){a.push(t);const n=Math.max(0,t.position.x+t.size-(e.position.x+e.size));o=Math.max(o,n)}n.right<this.length&&!i.map.has(n.right)&&this.addSlot({position:{x:n.right,y:r},size:e.size-t+o});for(let t=0;t<a.length;t++)a[t].size=e.position.x-a[t].position.x,0===a[t].size&&this.removeSlot(a[t])}else this.addRow(),e.position.x>0&&this.addSlot({position:{x:0,y:r},size:e.position.x}),n.right<this.length&&this.addSlot({position:{x:n.right,y:r},size:this.length-n.right})}for(let r=Math.max(0,e.position.y-t);r<e.position.y;r++){const n=this.getRow({x:e.position.x,y:r});if(null!=n)for(let r=0;r<n.slots.length;r++){const i=n.slots[r];if(i.position.x<e.position.x+t&&i.position.x+i.size>e.position.x&&i.position.y+i.size>=e.position.y){const t=i.size;i.size=e.position.y-i.position.y;const n={x:i.position.x+i.size,y:i.position.y,width:t-i.size,height:i.size};for(;n.width>0&&n.height>0;)n.width<=n.height?(this.addSlot({position:{x:n.x,y:n.y},size:n.width}),n.y+=n.width,n.height-=n.width):(this.addSlot({position:{x:n.x,y:n.y},size:n.height}),n.x+=n.height,n.width-=n.height)}}}return{position:e.position,size:t}}place(e){let t=!1,n=null;for(const r of this.rows){for(const i of r.slots)if(i.size>=e){t=!0,n=this.fillSlot(i,e);break}if(t)break}if(!t){const t=this.addRow(),r=this.addSlot({position:{x:0,y:t.y},size:this.length});if(!r)throw new Error("Failed to create initial slot");n=this.fillSlot(r,e)}if(!n)throw new Error("Failed to place square");return n.position.x+n.size>this.width&&(this.width=n.position.x+n.size),n.position.y+n.size>this.height&&(this.height=n.position.y+n.size),this.slots.push(n),n}fillEmptySpaces(e=!0){const t=[],n=Array.from({length:this.height},()=>Array(this.width).fill(!1));for(const r of this.slots)for(let e=0;e<r.size;e++)for(let t=0;t<r.size;t++)n[r.position.y+e][r.position.x+t]=!0;if(e){const e=(e,t,r)=>{if(e+r>this.width||t+r>this.height)return!1;for(let i=0;i<r;i++)for(let a=0;a<r;a++)if(n[t+i][e+a])return!1;return!0};for(let r=Math.min(this.width,this.height);r>1;r--)for(let i=0;i<=this.height-r;i++)for(let a=0;a<=this.width-r;a++)if(e(a,i,r)){t.push({position:{x:a,y:i},size:r});for(let e=0;e<r;e++)for(let t=0;t<r;t++)n[i+e][a+t]=!0}}for(let r=0;r<this.height;r++)for(let e=0;e<this.width;e++)n[r][e]||(t.push({position:{x:e,y:r},size:1}),n[r][e]=!0);return t}}const wN="55551557695dd82a2bda5ec3497684ec7cbb2cc1752ff5101accff1648666c3ai0",vN=`bitmon:index:${wN}`;let SN=null,EN=null;function NN(e,t,n,r){const i=e.indexOf(t);if(-1===i)return null;const a=e.indexOf("=",i);if(-1===a)return null;const o=e.indexOf(n,a);if(-1===o)return null;let s=0,l=null,c=!1;for(let u=o;u<e.length;u++){const t=e[u];if(l){if(c){c=!1;continue}if("\\"===t){c=!0;continue}t===l&&(l=null)}else if('"'!==t&&"'"!==t){if(t===n&&s++,t===r&&(s--,0===s))return e.slice(o,u+1)}else l=t}return null}function IN(e,t){if(!e)return null;try{return JSON.parse(e)}catch{}if(!/^[\s0-9",:'\-\.\{\}\[\]\(\)]+$/.test(e))return null;try{return(0,eval)("object"===t?`(${e})`:e)}catch{return null}}async function AN({forceRefresh:e=!1}={}){if(!e&&SN?.patternArray&&SN?.patternObject)return SN;if(EN)return await EN;EN=(async()=>{if(!e){const e=await ui(vN,{maxAgeMs:7776e6});if(e&&Array.isArray(e.patternArray)&&e.patternObject)return SN=e,SN}const t=await async function(){const e=kt(`/content/${wN}`),t=await Ht(e);if(!t?.ok)throw new Error(`Failed to fetch Bitmon index: ${t?.status}`);const n=await t.text(),r=NN(n,"patternArray","[","]"),i=NN(n,"patternObject","{","}"),a=IN(r,"array"),o=IN(i,"object");if(!Array.isArray(a)||!o||"object"!=typeof o)throw new Error("Bitmon index parse failed");return{loadedAt:Date.now(),patternArray:a,patternObject:o}}();return SN=t,await li(vN,t),SN})();try{return await EN}finally{EN=null}}const kN=new Map,TN=new Map,CN=e=>`bitmap:layout:${e}`;function BN({blockNumber:e,bitmonPattern:t=null,highlightParcels:n=[],highlightColor:r="#00e5ff",selectedParcels:i=[],selectedColor:a="#22c55e",existingParcels:o=new Set,size:s="auto",measureKey:l,className:c,onParcelClick:u,onParcelMouseDown:d,onParcelMouseEnter:p}){const f=TN.get(e),[m,g]=Bc.useState(f?.slots||[]),[h,b]=Bc.useState(f?{width:f.width,height:f.height}:null),[y,x]=Bc.useState(f?.txCount||0),[w,v]=Bc.useState(f?.amounts||[]),[S,E]=Bc.useState(!f),[N,I]=Bc.useState(null),A=Bc.useRef(null),[k,T]=Bc.useState(null),C=Bc.useMemo(()=>{const e=m.map((e,t)=>t);return e.sort((e,t)=>{const n=m[e],r=m[t],i=Number(n?.position?.y??0),a=Number(r?.position?.y??0);if(i!==a)return i-a;const o=Number(n?.position?.x??0),s=Number(r?.position?.x??0);if(o!==s)return o-s;const l=Number(n?.size??0),c=Number(r?.size??0);return l!==c?c-l:e-t}),e},[m]),B=Bc.useMemo(()=>{const e=new Array(m.length);for(let t=0;t<C.length;t++){const n=C[t];void 0!==n&&(e[n]=t)}return e},[m.length,C]),P=Bc.useMemo(()=>{const e=new Set,t=C.length-1;for(const r of n){if("number"!=typeof r||!Number.isFinite(r))continue;const n=Math.trunc(r);if(n<0||n>t)continue;const i=C[n];void 0!==i&&e.add(i)}return e},[n,C]),_=Bc.useMemo(()=>{const e=new Set,t=C.length-1;for(const n of i){if("number"!=typeof n||!Number.isFinite(n))continue;const r=Math.trunc(n);if(r<0||r>t)continue;const i=C[r];void 0!==i&&e.add(i)}return e},[i,C]),O=Bc.useMemo(()=>{const e=new Set,t=C.length-1;for(const n of o){if("number"!=typeof n||!Number.isFinite(n))continue;const r=Math.trunc(n);if(r<0||r>t)continue;const i=C[r];void 0!==i&&e.add(i)}return e},[o,C]);Bc.useEffect(()=>{if(!Boolean(import.meta?.env?.DEV))return;const e=m.length;if(0===e)return;const t=C;if(t.length!==e)return;const n=new Set;for(const r of t){if(!Number.isFinite(r)||r<0||r>=e)return;n.add(r)}n.size},[e,m.length,C]),Bc.useEffect(()=>{let n=!0;return async function(){I(null);const r=TN.get(e);if(r){if(!n)return;return g(r.slots),b({width:r.width,height:r.height}),x(r.txCount),v(r.amounts||[]),void E(!1)}E(!0);try{try{const t=await ui(CN(e));if(t&&Array.isArray(t.slots)&&Number.isFinite(t.width)&&Number.isFinite(t.height)&&Number.isFinite(t.txCount)){if(TN.set(e,t),!n)return;return g(t.slots),b({width:t.width,height:t.height}),x(t.txCount),v(Array.isArray(t.amounts)?t.amounts:[]),void E(!1)}}catch{}const r=t?function(e){const t=String(e||"").trim();if(!t)return null;const n=[];for(let r=0;r<t.length;r++){const e=Number(t[r]);if(!Number.isFinite(e)||e<=0)return null;n.push(e)}return n}(t):null;if(Array.isArray(r)&&r.length>0){const t=new xN(r),i={slots:t.slots,width:t.width,height:t.height,txCount:r.length,amounts:void 0};if(TN.set(e,i),!n)return;return g(i.slots),b({width:i.width,height:i.height}),x(i.txCount),void v([])}let i=kN.get(e);i||(i=await async function(e){if(void 0!==window.btcapi)return await window.btcapi.getBlockWithTxs(e);{const n=await Ht((t=`/rawblock/${e}?cors=true`,At(t,"https://blockchain.info")));if(!n.ok)throw new Error(`Failed to fetch block ${e}`);return n.json()}var t}(e),kN.set(e,i));const a=Array.isArray(i?.tx)?i.tx:[],o=a.map(e=>e.out.reduce((e,t)=>e+(t?.value||0),0)),s=o.map(e=>(e=>{const t=e/1e8;return 0===t||t<=.01?1:t<=.1?2:t<=1?3:t<=10?4:t<=100?5:t<=1e3?6:t<=1e4?7:t<=1e5?8:9})(e)),l=new xN(s),c={slots:l.slots,width:l.width,height:l.height,txCount:a.length,amounts:o};TN.set(e,c);try{await li(CN(e),c)}catch{}if(!n)return;g(c.slots),b({width:c.width,height:c.height}),x(c.txCount),v(c.amounts||[])}catch(Pk){if(!n)return;I(Pk?.message||"Failed to render bitmap")}finally{n&&E(!1)}}(),()=>{n=!1}},[e,t]),Bc.useEffect(()=>{if("auto"!==s)return;const e=A.current;if(!e)return;const t=new ResizeObserver(e=>{for(const t of e){const e=Math.floor(t.contentRect.width),n=Math.floor(t.contentRect.height);e>0&&n>0&&T({width:e,height:n})}});t.observe(e);const n=e.getBoundingClientRect();T({width:Math.floor(n.width),height:Math.floor(n.height)});const r=requestAnimationFrame(()=>{if(A.current){const e=A.current.getBoundingClientRect();T({width:Math.floor(e.width),height:Math.floor(e.height)})}});return()=>{t.disconnect(),cancelAnimationFrame(r)}},[s,l]);const L="number"==typeof s?s:k?Math.max(1,Math.min(k.width,k.height)):1;if(S)return Pc.createElement("div",{ref:A,className:c,style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"}},Pc.createElement("div",{style:{width:L,height:L,display:"grid",placeItems:"center"}},"Loading\u2026"));if(N)return Pc.createElement("div",{ref:A,className:c,style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"}},Pc.createElement("div",{style:{width:L,height:L,color:"tomato",display:"grid",placeItems:"center"}},"Error: ",N));if(!h)return Pc.createElement("div",{ref:A,className:c,style:{width:"100%",height:"100%"}});const F=Math.min(L/h.width,L/h.height),M=Math.floor(h.width*F),R=Math.floor(h.height*F),$=Math.floor((L-M)/2),U=Math.floor((L-R)/2);return Pc.createElement("div",{ref:A,className:c,style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",minWidth:0,minHeight:0,overflow:"hidden"}},Pc.createElement("div",{style:{width:L,height:L,maxWidth:"100%",maxHeight:"100%",position:"relative",background:"black",borderRadius:0,overflow:"hidden"}},m.map((e,t)=>{const n=Number.isFinite(B[t])?B[t]:t,i=P.size>0,o=P.has(t),s=_.has(t),l=O.has(t),c=a,f=l?"#E24A4A":s?c:o?r:i?"#2f2f2f":"#f79a27",m=e.size*F,g=Math.min(2,Math.max(0,m-1)),h=g/2,b=$+e.position.x*F+h,y=U+e.position.y*F+h,x=Math.max(.25,m-g),v=Math.max(.25,m-g),S=w&&null!=w[t]?w[t]:void 0,E=l?`Parcel ${n} \u2014 Already Inscribed \u26a0\ufe0f`:null!=S?`Parcel ${n} \u2014 ${N=S,`${(N/1e8).toLocaleString(void 0,{maximumFractionDigits:8})} BTC`}`:`Parcel ${n}`;var N;return Pc.createElement("div",{key:t,title:E,style:{position:"absolute",left:`${b}px`,top:`${y}px`,width:`${x}px`,height:`${v}px`,backgroundColor:f,cursor:l?"not-allowed":u?"pointer":"default",transition:"background-color 120ms ease-out",opacity:l?.7:1,border:l?"1px solid rgba(226, 74, 74, 0.5)":s?`1px solid ${c}`:"none"},onMouseDown:e=>!l&&d&&d(n,e),onClick:e=>!l&&u&&u(n,e),onTouchEnd:e=>{!l&&u&&(e.preventDefault(),u(n,e))},onMouseEnter:e=>{l||(p&&p(n),e.currentTarget.style.backgroundColor=o?"#00d0eb":i?"#3a3a3a":"#ff9f3d")},onMouseLeave:e=>{l||(e.currentTarget.style.backgroundColor=f)}})})))}const PN=100000000n;function _N(e){const t=String(e||"").trim().replace(/,/g,"");if(!t)throw new Error("Enter a sale price.");if(/^[0-9]+$/.test(t)){const e=BigInt(t);if(e<=0n)throw new Error("Enter a sale price > 0.");if(e>BigInt(Number.MAX_SAFE_INTEGER))throw new Error("Sale price too large.");return Number(e)}if(/^[0-9]*\.[0-9]+$/.test(t)){const[e,n]=t.split("."),r=e?BigInt(e):0n,i=String(n||"");if(i.length>8)throw new Error("BTC amount supports up to 8 decimal places.");const a=(i+"00000000").slice(0,8);if(!/^[0-9]{8}$/.test(a))throw new Error("Invalid BTC amount.");const o=BigInt(a),s=r*PN+o;if(s<=0n)throw new Error("Enter a sale price > 0.");if(s>BigInt(Number.MAX_SAFE_INTEGER))throw new Error("Sale price too large.");return Number(s)}throw new Error("Enter a valid price in sats (e.g. 30000) or BTC (e.g. 0.0003).")}function ON(e){if(null==e)return"";let t;if("bigint"==typeof e)t=e;else if("number"==typeof e){if(!Number.isFinite(e))return"";t=BigInt(Math.trunc(e))}else{const n=String(e).trim();if(!n)return"";t=BigInt(n)}if(0n===t)return"0";const n=t/PN,r=t%PN;if(0n===r)return n.toString();const i=r.toString().padStart(8,"0").replace(/0+$/,"");return`${n.toString()}.${i}`}const LN=Object.freeze(Object.defineProperty({__proto__:null,parseUserPriceToSats:_N,satsToBtcString:ON},Symbol.toStringTag,{value:"Module"})),FN="h-8 w-8 min-h-[32px] shrink-0 grid place-items-center rounded-lg text-[11px] font-semibold transition focus:outline-none focus:ring-2 focus:ring-sky-500/30 touch-manipulation",MN=FN+" bg-neutral-950/50 ring-1 ring-neutral-800/70 text-neutral-200 hover:ring-sky-500/25 hover:text-sky-100",RN=FN+" bg-neutral-950/30 ring-1 ring-neutral-900/60 text-neutral-500 cursor-not-allowed",$N="h-8 min-h-[32px] flex-1 grid place-items-center rounded-lg bg-purple-600/30 ring-1 ring-purple-500/50 text-purple-50 font-semibold text-[11px] transition hover:bg-purple-600/40 hover:ring-purple-400/60 active:bg-purple-600/50 focus:outline-none focus:ring-2 focus:ring-purple-400/30 touch-manipulation",UN="h-8 min-h-[32px] flex-1 grid place-items-center rounded-lg bg-neutral-950/50 ring-1 ring-neutral-800/70 text-neutral-200 font-semibold text-[11px] transition hover:ring-sky-500/25 active:bg-neutral-900/60 focus:outline-none focus:ring-2 focus:ring-sky-500/30 touch-manipulation";function zN({title:e,onClick:t,statusBadge:n,media:r,metaLeft:i,metaRight:a,label:o,footerLeft:s,footerRight:l,actions:c}){return Pc.createElement("div",{onClick:t,className:"group relative flex flex-col h-full rounded-2xl bg-gradient-to-b from-neutral-900/60 to-neutral-950/80 text-neutral-200 shadow-[0_0_0_1px_rgba(59,130,246,0.10),0_0_18px_rgba(59,130,246,0.06)] transition hover:-translate-y-0.5 hover:shadow-xl overflow-hidden cursor-pointer focus-within:ring-2 focus-within:ring-sky-500/30 focus-within:ring-offset-0",title:e},n,Pc.createElement("div",{className:"p-2 sm:p-3"},Pc.createElement("div",{className:"relative aspect-square w-full rounded-xl overflow-hidden bg-black ring-1 ring-neutral-800/70"},Pc.createElement("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/0 via-black/0 to-black/45 opacity-80 group-hover:opacity-100 transition"}),Pc.createElement("div",{className:"pointer-events-none absolute inset-0 opacity-0 group-hover:opacity-100 group-focus-within:opacity-100 transition"},Pc.createElement("div",{className:"absolute inset-0 bg-black/10"}),Pc.createElement("div",{className:"absolute bottom-2 left-2 text-[10px] font-semibold px-2 py-1 rounded-full bg-black/55 backdrop-blur ring-1 ring-white/10"},"Open preview")),r)),Pc.createElement("div",{className:"px-2 sm:px-3 pb-2 sm:pb-3 flex flex-col gap-1.5 sm:gap-2"},(i||a)&&Pc.createElement("div",{className:"flex items-baseline justify-between gap-3"},i&&Pc.createElement("div",{className:"text-[10px] font-mono text-neutral-500 truncate"},i),a),o&&Pc.createElement("div",{className:"text-[12px] font-semibold text-neutral-200 truncate"},o),(s||l)&&Pc.createElement("div",{className:"flex items-center justify-between gap-2"},s&&Pc.createElement("div",{className:"text-[10px] text-neutral-400"},s),l),c&&Pc.createElement("div",{className:"flex items-center gap-2"},c)))}function DN({price:e,hasPrice:t}){return Pc.createElement("div",{className:t?"text-[12px] font-semibold tabular-nums text-amber-200 truncate":"text-[12px] font-semibold tabular-nums text-neutral-300 truncate"},e)}function HN({canShowQr:e,onShowQr:t,onSelect:n,ctaLabel:r="View",ctaVariant:i="primary"}){return Pc.createElement(Pc.Fragment,null,Pc.createElement("button",{type:"button",disabled:!e,onClick:n=>{n.stopPropagation(),e&&t?.(n)},className:e?MN:RN,title:e?"Show listing offer PSBT as QR":"PSBT not available yet","aria-label":"Show QR"},"QR"),Pc.createElement("button",{type:"button",onClick:e=>{e.stopPropagation(),n?.(e)},className:"primary"===i?$N:UN,title:"View listing"},r," \u2192"))}function WN({bitmapNumber:e,bitmonPattern:t,highlightParcels:n,highlightColor:r}){const i=Number.isFinite(Number(e));return Pc.createElement("div",{className:"w-full h-full p-1"},Pc.createElement("div",{className:"w-full h-full rounded-lg bg-black overflow-hidden border border-neutral-800/70"},i?Pc.createElement(BN,{blockNumber:Number(e),bitmonPattern:t,highlightParcels:Array.isArray(n)?n:[],highlightColor:r||void 0,size:"auto",className:"w-full h-full"}):Pc.createElement("div",{className:"w-full h-full flex items-center justify-center text-neutral-500 text-xs"},"bitmap")))}function jN({listing:e,onSelect:t,onShowQr:n,formatPrice:r}){const i=Number(e?.collection?.bitmapNumber),a=e?.price,o=Number.isFinite(i)?`${i}.bitmap`:"bitmap",s=e?.collection?.bitmon?.pattern||null,l=!!String(e?.sellerOfferPsbt||"").trim()||!!String(e?.revealTxid||"").trim(),c=Number(a),u=Number.isFinite(c)&&c>0,d=(r?r(a):"")||"Price TBD";return Pc.createElement(zN,{title:o,onClick:t,media:Pc.createElement(WN,{bitmapNumber:i,bitmonPattern:s}),metaRight:Pc.createElement(DN,{price:d,hasPrice:u}),label:o,actions:Pc.createElement(HN,{canShowQr:l,onShowQr:n,onSelect:t})})}function VN({bitmapNumber:e,parcelsForSaleCount:t=0,highlightParcels:n=[],onOpen:r}){const i=Number.isFinite(Number(e))?`${Number(e)}.bitmap`:"bitmap",a=(()=>{const e=Number(t);return!Number.isFinite(e)||e<0?0:Math.trunc(e)})();return Pc.createElement(zN,{title:i,onClick:()=>r?.(),media:Pc.createElement(WN,{bitmapNumber:e,highlightParcels:n,highlightColor:"rgb(34 197 94)"}),metaRight:Pc.createElement(DN,{price:`${a} listed`,hasPrice:a>0}),label:i,actions:Pc.createElement("button",{type:"button",onClick:e=>{e.stopPropagation(),r?.()},className:$N,title:"View parcels"},"View \u2192")})}function qN({listing:e,onSelect:t,onShowQr:n}){const r=e.inscription||{},i=e.inscriptionId||r.id||"",a=r.number||r.inscriptionNumber||"",o=e.price,s=!!String(e?.sellerOfferPsbt||"").trim(),l=!!e.revealTxid||s,c=s||!!String(e?.revealTxid||"").trim(),u=Number(o),d=Number.isFinite(u)&&u>0,p=d?`${ON(Math.trunc(u))} BTC`:"Price TBD",f=a?`#${a}`:`#${i.slice(0,8)}\u2026`;return Pc.createElement(zN,{onClick:t,statusBadge:l||s?null:Pc.createElement("div",{className:"absolute top-2 left-2 sm:top-1 sm:left-1 z-10 px-2 sm:px-1.5 py-0.5 text-[10px] sm:text-[9px] font-semibold bg-yellow-500/20 text-yellow-300 border border-yellow-500/40 rounded"},"Pending Reveal"),media:Pc.createElement(bN,{inscription:r,width:"100%",height:"100%"}),metaRight:Pc.createElement(DN,{price:p,hasPrice:d}),label:f,actions:Pc.createElement(HN,{canShowQr:c,onShowQr:n,onSelect:t,ctaVariant:l?"primary":"secondary"})})}const XN={bitmap:{key:"bitmap",name:"Bitmaps",description:"OCI-verified .bitmap inscriptions.",catalogImage:{inscriptionId:"e71becf022f7c77acdb8936dbc30b45165dd7fd65ca8e3415450b41b99495cd0i0",contentType:"image/png"},match:{bitmapOci:!0},filters:[{key:"ociVerified",label:"OCI verified",type:"boolean",sourcePath:"collection.verified",default:!0},{key:"maxPriceSats",label:"Max sats",type:"rangeMax",sourcePath:"price"}],indexLinks:{docs:[{title:"Bitmap",url:"/content/907bcb2c477a99162436f55cc0058564b5ed02a958e62141fca50d43b35f3542i0"}]},scripts:[],sort:10},parcel:{key:"parcel",name:"Bitmap Parcels",description:"Parcel listings by provenance address.",catalogImage:null,filters:[],sort:20}};function KN(e){const t=String(e||"").trim().toLowerCase();return XN[t]||null}const GN="nexus:psbt",YN="v1",JN={gz:"gzip",br:"brotli"},QN={gzip:"gz",brotli:"br"};function ZN(e){return(new TextEncoder).encode(String(e??""))}function eI(e){return(new TextDecoder).decode(e)}function tI(e){let t="";for(let n=0;n<e.length;n+=32768)t+=String.fromCharCode(...e.subarray(n,n+32768));return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}function nI(e){const t=String(e??"").replace(/\s+/g,"").replace(/-/g,"+").replace(/_/g,"/"),n=t.length%4,r=n?t+"=".repeat(4-n):t,i=atob(r),a=new Uint8Array(i.length);for(let o=0;o<i.length;o++)a[o]=i.charCodeAt(o);return a}function rI(e){try{return"undefined"!=typeof CompressionStream&&"undefined"!=typeof DecompressionStream&&(new CompressionStream(e),new DecompressionStream(e),!0)}catch{return!1}}async function iI(e,t){if("undefined"==typeof CompressionStream)throw new Error("CompressionStream not supported");const n=new CompressionStream(t),r=n.writable.getWriter();await r.write(e),await r.close();const i=new Response(n.readable),a=await i.arrayBuffer();return new Uint8Array(a)}async function aI(e,t){if("undefined"==typeof DecompressionStream)throw new Error("DecompressionStream not supported");const n=new DecompressionStream(t),r=n.writable.getWriter();await r.write(e),await r.close();const i=new Response(n.readable),a=await i.arrayBuffer();return new Uint8Array(a)}function oI(){try{const e=new Uint8Array(8);if("undefined"!=typeof crypto&&crypto?.getRandomValues)return crypto.getRandomValues(e),tI(e).slice(0,10)}catch{}return(Math.random().toString(36).slice(2)+Math.random().toString(36).slice(2)).replace(/[^a-z0-9]/gi,"").slice(0,10)||"mp"}function sI(e,t){const n=String(e??"");if(t<=0)return[n];const r=[];for(let i=0;i<n.length;i+=t)r.push(n.slice(i,i+t));return r}function lI({selectedParentsCount:e,disabled:t,collectionKey:n,minBlockHeight:r=null,onCreateBulkListingTx:i,bulkSellerStatus:a,bulkSellerError:o,bulkBundleJson:s}){if(!(Number(e||0)>1))return null;const l=String(s||"");return Pc.createElement("div",{className:"mt-3 flex flex-col gap-2"},Pc.createElement("button",{onClick:()=>i?.({collectionKey:String(n||"").trim()||null,minBlockHeight:void 0===r?null:r}),disabled:!!t,className:t?"w-full px-4 py-2 text-sm font-semibold rounded-lg bg-neutral-800 text-neutral-500 cursor-not-allowed":"w-full px-4 py-2 text-sm font-semibold rounded-lg bg-neutral-800/60 hover:bg-neutral-700/60 text-neutral-200 transition-colors","aria-label":"Create bulk sale listing transactions",title:"Create one listing per selected inscription"},"Create Bulk Listings (",e,")"),a?a?.steps?Pc.createElement(NE,{steps:a.steps,title:a.title}):Array.isArray(a)?Pc.createElement(NE,{steps:a}):Pc.createElement("div",{className:"text-xs text-green-300 bg-green-500/10 border border-green-500/30 rounded-lg px-3 py-2"},String(a)):null,o?Pc.createElement("div",{className:"text-xs text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2"},o):null,l?Pc.createElement("div",{className:"bg-neutral-950/60 border border-neutral-800/60 rounded-lg p-3"},Pc.createElement("div",{className:"flex items-center justify-between gap-2 mb-2"},Pc.createElement("div",{className:"text-xs font-semibold text-neutral-300"},"Bundle JSON"),Pc.createElement("button",{onClick:()=>navigator.clipboard.writeText(l),className:"px-3 py-1 bg-neutral-800 hover:bg-neutral-700 rounded text-xs text-white transition-colors",title:"Copy bundle JSON to clipboard"},"Copy")),Pc.createElement("textarea",{readOnly:!0,value:l,className:"w-full h-40 px-3 py-2 text-xs bg-neutral-950 border border-neutral-800/60 rounded text-neutral-200 outline-none font-mono"}),Pc.createElement("div",{className:"mt-2 text-[11px] text-neutral-500"},"Optional: compress externally (e.g. Brotli) before inscribing.")):null)}function cI(e){const t=String(e??"").replace(/[^0-9.]/g,"");if(!t)return"";const n=t.indexOf(".");if(n<0)return t;const r=t.slice(0,n).replace(/\./g,""),i=t.slice(n+1).replace(/\./g,""),a=""===r?"0":r;return 0===i.length&&t.endsWith(".")?`${a}.`:`${a}.${i}`}function uI({selectedParents:e=[],selectedParentsCount:t,assetPricing:n={},disabled:r=!1,collectionKey:i,minBlockHeight:a=null,onCreateMultiListingTx:o,multiSellerStatus:s="",multiSellerError:l="",multiListingResult:c=null}){const u=Array.isArray(e)?e:[],d=Number(t??u.length);if(!(d>1))return null;const p=!!String(i||"").trim()&&"uncategorized"!==i,{allPriced:f,pricedCount:m}=Bc.useMemo(()=>{let e=0;for(const t of u){const r=t?.id||t?.inscriptionId||t?.inscription_id,i=cI(n?.[r]?.priceBtc||""),a=parseFloat(i);Number.isFinite(a)&&a>0&&e++}return{allPriced:e===u.length,pricedCount:e}},[u,n]),g=r?"Wallet not ready or collection invalid":p?f?null:`Set a price for all ${d} items (${m}/${d} priced)`:"Select a collection first \u2014 all items must be from the same collection";return Pc.createElement("div",{className:"mt-3 flex flex-col gap-3"},Pc.createElement("div",{className:"flex items-center gap-2"},Pc.createElement("div",{className:"flex-1 h-px bg-neutral-800/60"}),Pc.createElement("span",{className:"text-[11px] font-semibold text-purple-400 uppercase tracking-wider"},"Multi-Asset Listing"),Pc.createElement("div",{className:"flex-1 h-px bg-neutral-800/60"})),!p&&Pc.createElement("div",{className:"text-[11px] text-yellow-300 bg-yellow-500/10 border border-yellow-500/30 rounded-lg px-3 py-2"},"\u26a0\ufe0f Select a collection above. All items in a multi-asset listing must belong to the same collection."),Pc.createElement("div",{className:"text-[11px] text-neutral-500"},"Bundle ",d," inscriptions into ",Pc.createElement("strong",{className:"text-neutral-300"},"one reveal TX"),". Each asset gets its own SIGHASH_SINGLE|ANYONECANPAY offer so buyers can purchase individually. Data is Brotli-compressed and embedded in the carrier witness."),Pc.createElement("button",{onClick:()=>{o?.({collectionKey:String(i||"").trim()||null,minBlockHeight:void 0===a?null:a,assetPricing:n})},disabled:!!g||"function"!=typeof o,className:g?"w-full px-4 py-2 text-sm font-semibold rounded-lg bg-neutral-800 text-neutral-500 cursor-not-allowed":"w-full px-4 py-2 text-sm font-semibold rounded-lg bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-500 hover:to-indigo-500 text-white transition-all shadow-lg shadow-purple-500/10","aria-label":"Create multi-asset listing transaction",title:g||`Embed ${d} offer PSBTs in a single reveal transaction`},"Create Multi-Asset Listing (",d," items)"),g&&Pc.createElement("div",{className:"text-[11px] text-neutral-500 italic"},g),s?Array.isArray(s)?Pc.createElement(NE,{steps:s}):Pc.createElement("div",{className:"text-xs text-green-300 bg-green-500/10 border border-green-500/30 rounded-lg px-3 py-2"},String(s)):null,l?Pc.createElement("div",{className:"text-xs text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2"},l):null,"multi-asset-3tx-complete"===c?.mode&&Pc.createElement("div",{className:"bg-neutral-950/60 border border-neutral-800/60 rounded-lg p-3 flex flex-col gap-2"},Pc.createElement("div",{className:"text-xs font-semibold text-neutral-300"},"Multi-Asset Listing Result"),Pc.createElement("div",{className:"grid grid-cols-[auto_1fr] gap-x-3 gap-y-1 text-[11px]"},Pc.createElement("span",{className:"text-neutral-500"},"Assets"),Pc.createElement("span",{className:"text-neutral-200"},c.assetCount),Pc.createElement("span",{className:"text-neutral-500"},"Commit TX"),Pc.createElement("span",{className:"font-mono text-neutral-300 break-all"},c.commitTxid||"\u2014"),Pc.createElement("span",{className:"text-neutral-500"},"Reveal TX"),Pc.createElement("span",{className:"font-mono text-neutral-300 break-all"},c.revealTxid||"\u2014"),c.embeddedPayloadBytes?Pc.createElement(Pc.Fragment,null,Pc.createElement("span",{className:"text-neutral-500"},"Payload"),Pc.createElement("span",{className:"text-neutral-200"},c.embeddedPayloadBytes," bytes",c.compressed?" (Brotli)":"")):null,Pc.createElement("span",{className:"text-neutral-500"},"Broadcast"),Pc.createElement("span",{className:c.broadcasted?"text-green-400":"text-yellow-400"},c.broadcasted?"Yes \u2705":"Dry run only"))))}function dI(e){const t=String(e??"").replace(/[^0-9.]/g,"");if(!t)return"";const n=t.indexOf(".");if(n<0)return t;const r=t.slice(0,n).replace(/\./g,""),i=t.slice(n+1).replace(/\./g,""),a=""===r?"0":r;return 0===i.length&&t.endsWith(".")?`${a}.`:`${a}.${i}`}function pI({selectedParents:e=[],assetPricing:t={},onAssetPriceChange:n,onUniformPriceChange:r,disabled:i=!1}){const a=Array.isArray(e)?e:[];if(a.length<2)return null;const{totalBtc:o,allPriced:s,pricedCount:l}=Bc.useMemo(()=>{let e=0,n=0;for(const r of a){const i=r?.id||r?.inscriptionId||r?.inscription_id,a=dI(t?.[i]?.priceBtc||""),o=parseFloat(a);Number.isFinite(o)&&o>0&&(e+=o,n++)}return{totalBtc:e,allPriced:n===a.length,pricedCount:n}},[a,t]);return Pc.createElement("div",{className:"flex flex-col gap-2"},Pc.createElement("div",{className:"flex items-center justify-between"},Pc.createElement("h4",{className:"text-xs font-semibold text-neutral-300"},"\ud83d\uddc2\ufe0f Multi-Asset Pricing (",a.length," items)"),"function"==typeof r&&Pc.createElement(mI,{onApply:r,disabled:i})),Pc.createElement("div",{className:"border border-neutral-800/60 rounded-lg overflow-hidden"},Pc.createElement("div",{className:"grid grid-cols-[1fr_2fr_120px] gap-1 px-3 py-1.5 bg-neutral-900/60 text-[11px] font-semibold text-neutral-500 uppercase tracking-wider"},Pc.createElement("span",null,"#"),Pc.createElement("span",null,"Inscription"),Pc.createElement("span",{className:"text-right"},"Price (BTC)")),Pc.createElement("div",{className:"max-h-64 overflow-y-auto divide-y divide-neutral-800/40"},a.map((e,r)=>{const a=e?.id||e?.inscriptionId||e?.inscription_id||"",o=e?.number??e?.inscriptionNumber??e?.inscription_number;return Pc.createElement(fI,{key:a||r,idx:r,inscriptionId:a,inscriptionNumber:o,externalPrice:t?.[a]?.priceBtc||"",onPriceChange:n,disabled:i})})),Pc.createElement("div",{className:"grid grid-cols-[1fr_2fr_120px] gap-1 px-3 py-2 bg-neutral-900/40 border-t border-neutral-800/60"},Pc.createElement("span",null),Pc.createElement("span",{className:"text-xs text-neutral-400"},l,"/",a.length," priced"),Pc.createElement("span",{className:"text-xs font-semibold text-right text-neutral-200"},o>0?`${o.toFixed(8)} BTC`:"\u2014"))),!s&&l>0&&Pc.createElement("div",{className:"text-[11px] text-yellow-400/80"},"Set a price for all ",a.length," items before creating the multi-asset listing."))}function fI({idx:e,inscriptionId:t,inscriptionNumber:n,externalPrice:r,onPriceChange:i,disabled:a}){const[o,s]=Bc.useState(r||"");Bc.useEffect(()=>{s(r||"")},[r]);const l=String(t).length>16?`${String(t).slice(0,8)}\u2026${String(t).slice(-6)}`:String(t),c=Bc.useCallback(e=>{const n=dI(e.target.value);s(n),"function"==typeof i&&i(t,n)},[t,i]);return Pc.createElement("div",{className:"grid grid-cols-[1fr_2fr_120px] gap-1 px-3 py-1.5 items-center hover:bg-neutral-800/20 transition-colors"},Pc.createElement("span",{className:"text-xs text-neutral-400"},e+1),Pc.createElement("div",{className:"flex flex-col"},Pc.createElement("span",{className:"text-[11px] font-mono text-neutral-300 truncate",title:t},l),null!=n&&Pc.createElement("span",{className:"text-[10px] text-neutral-500"},"#",n)),Pc.createElement("input",{type:"text",inputMode:"decimal",disabled:a,value:o,onChange:c,className:"w-full px-2 py-1 text-xs text-right bg-neutral-950/60 border border-neutral-800/60 rounded text-neutral-200 outline-none focus:border-purple-500/60 disabled:opacity-50",placeholder:"0.0003"}))}function mI({onApply:e,disabled:t}){const[n,r]=Pc.useState(""),i=dI(n);return Pc.createElement("div",{className:"flex items-center gap-1"},Pc.createElement("input",{type:"text",inputMode:"decimal",disabled:t,value:n,onChange:e=>r(dI(e.target.value)),className:"w-20 px-2 py-0.5 text-[11px] text-right bg-neutral-950/60 border border-neutral-800/60 rounded text-neutral-200 outline-none focus:border-purple-500/60 disabled:opacity-50",placeholder:"0.001"}),Pc.createElement("button",{disabled:t||!i.trim()||!Number.isFinite(parseFloat(i))||parseFloat(i)<=0,onClick:()=>{i.trim()&&e(i.trim())},className:"px-2 py-0.5 text-[11px] rounded bg-neutral-800 hover:bg-neutral-700 text-neutral-300 transition-colors disabled:opacity-40 disabled:cursor-not-allowed",title:"Apply this price to all selected inscriptions"},"Apply All"))}function gI(e){return(null==e?"":String(e)).trim()}function hI(e){const t=gI(e).toLowerCase();return t?t.replace(/\s+/g,"-").replace(/[^a-z0-9_-]/g,"").replace(/-+/g,"-").replace(/^[-_]+|[-_]+$/g,""):""}function bI(e){const t=gI(e);if(!t)return"";const n=t.match(/^([0-9a-fA-F]{64})i(\d+)$/);return n?`${n[1].toLowerCase()}i${String(Number(n[2]))}`:""}function yI(e){const t=String(e||"");if(!t.trim())return[];const n=t.split(/[\s,;]+/g).map(e=>bI(e)).filter(Boolean),r=[],i=new Set;for(const a of n)i.has(a)||(i.add(a),r.push(a));return r}function xI(){const e=new Blob([["inscription_id,price_sats,min_block_height,for_sale","abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789i0,10000,900000,true","abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789i1,25000,,false","abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789i2,,,"].join("\n")],{type:"text/csv"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="collection-template.csv",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t)}async function wI(e,{timeoutMs:t=12e3}={}){const n="undefined"!=typeof AbortController?new AbortController:null,r=n?setTimeout(()=>n.abort(),t):null;try{const t=await fetch(e,n?{signal:n.signal}:void 0);if(!t.ok){const e=await t.text().catch(()=>"");throw new Error(`HTTP ${t.status} ${t.statusText}${e?`: ${e}`:""}`)}return await t.json()}finally{r&&clearTimeout(r)}}function vI({initialListingIntent:e="launch",initialCollectionMode:t=null,selectedParentsCount:r=0,selectedInscriptionIds:i=[],walletInscriptions:a=[],walletAssetScanState:o=null,onRequestWalletRescan:s,existingCollectionKeys:l=[],authoritySlots:c=[],authorityStatus:u="",authorityError:d="",selectedAuthoritySlotId:p="",feeRate:f=null,onFeeRateChange:m,onAuthoritySlotChange:g,onLaunchCollection:h,onLaunchParcelManifest:b,onBuyAuthorityListing:y,isConnected:x=!1,onConnect:w,onOpenInscriptions:v,previousManifest:S=null,previousManifestStatus:E="",previousManifestError:N="",onLoadPreviousManifest:I}){const[A,k]=Pc.useState(""),[T,C]=Pc.useState(!1),[B,P]=Pc.useState(""),[_,O]=Pc.useState(!1),[L,F]=Pc.useState(""),[M,R]=Pc.useState(""),[$,U]=Pc.useState(""),[z,D]=Pc.useState("330"),[H,W]=Pc.useState("launch"===e),[j,V]=Pc.useState(""),[q,X]=Pc.useState(""),[K,G]=Pc.useState({}),[Y,J]=Pc.useState({}),[Q,Z]=Pc.useState({}),[ee,te]=Pc.useState(t||"parent-child"),[ne,re]=Pc.useState(!1),[ie,ae]=Pc.useState(!1),[oe,se]=Pc.useState(e||"launch"),le=Pc.useRef(e);Pc.useEffect(()=>{e!==le.current&&(le.current=e,se(e),W("launch"===e))},[e]);const ce=Pc.useRef(t);Pc.useEffect(()=>{t&&t!==ce.current&&(ce.current=t,te(t),"parcels"!==t&&"bitmaps"!==t||(Se("source"),W(!0)))},[t]);const[ue,de]=Pc.useState(!1),[pe,fe]=Pc.useState(""),[me,ge]=Pc.useState(!1),[he,be]=Pc.useState(!1),[ye,xe]=Pc.useState(!1),we=Pc.useRef(null),[ve,Se]=Pc.useState("parcels"===t||"bitmaps"===t?"source":"intent"),[Ee,Ne]=Pc.useState(""),[Ie,Ae]=Pc.useState(""),[ke,Te]=Pc.useState(""),[Ce,Be]=Pc.useState([]),[Pe,_e]=Pc.useState(""),[Oe,Le]=Pc.useState([]),[Fe,Me]=Pc.useState(""),[Re,$e]=Pc.useState("");Pc.useEffect(()=>{if("parent-child"!==ee)return;const e=(Array.isArray(i)?i:[]).map(e=>bI(e)).filter(Boolean)[0]||"";e!==bI(Ee)&&(Ne(e),Be([]),Ae(""),Te(""))},[ee,i]);const[Ue,ze]=Pc.useState(""),[De,He]=Pc.useState({}),[We,je]=Pc.useState({}),[Ve,qe]=Pc.useState([]),[Xe,Ke]=Pc.useState(""),[Ge,Ye]=Pc.useState(""),Je=Pc.useRef(null),[Qe,Ze]=Pc.useState(""),[et,tt]=Pc.useState(""),[nt,rt]=Pc.useState(null);Pc.useEffect(()=>{let e=!0;const t=async()=>{try{const{fetchBlockHeightViaProxy:t}=await n(async()=>{const{fetchBlockHeightViaProxy:e}=await Promise.resolve().then(()=>Ei);return{fetchBlockHeightViaProxy:e}},__VITE_PRELOAD__),r="undefined"!=typeof window&&window.__NEXUS_NETWORK__||"mainnet",i=await t(r);if(!e)return;Number.isFinite(Number(i))&&Number(i)>=0&&rt(Math.floor(Number(i)))}catch{}};t();const r=setInterval(t,6e4);return()=>{e=!1,clearInterval(r)}},[]);const[it,at]=Pc.useState(""),[ot,st]=Pc.useState(""),[lt,ct]=Pc.useState(""),[ut,dt]=Pc.useState(""),[pt,ft]=Pc.useState([]),[mt,gt]=Pc.useState({}),[ht,bt]=Pc.useState(""),[yt,xt]=Pc.useState(""),[wt,vt]=Pc.useState([]),[St,Et]=Pc.useState({}),Nt=Pc.useRef(!1),It=Pc.useRef(null),At=Pc.useRef(""),Tt=Array.isArray(c)&&c.length>0,Ct=Array.isArray(i)?i:[],[Bt,Pt]=Pc.useState(null),[_t,Ot]=Pc.useState(""),[Lt,Ft]=Pc.useState("");Pc.useEffect(()=>{let e=!0;return Tt?(Pt(null),Ot(""),void Ft("")):zt()?((async()=>{try{Ot("Finding you an authority slot\u2026"),Ft(""),Pt(null);const t=await Pl({forceRefresh:!1}),r=(Array.isArray(t?.collections)?t.collections:[]).find(e=>{const t=String(e?.key||"").trim().toLowerCase();return"oodl-auth"===t||"oodl_auth"===t||"oodlauth"===t});if(!e)return;if(!r)return void Ot("No oodl-auth collection found in registry.");const i=r?.manifest&&"object"==typeof r.manifest?r.manifest:null,a=Array.isArray(i?.open_store?.offers)?i.open_store.offers:[];if(0===a.length)return void Ot("No embedded offers found in oodl-auth collection. Check the marketplace for available slots.");const o=[];let s=null,l=null,c=null;try{const[e,t,r]=await Promise.all([n(()=>Promise.resolve().then(()=>An),__VITE_PRELOAD__),n(()=>Promise.resolve().then(()=>cs),__VITE_PRELOAD__),n(()=>Promise.resolve().then(()=>Jt),__VITE_PRELOAD__)]);s=await e.loadBitcoinLibFromInscription(),l=t.getPsbtInputOutpoint,c=r.getInscriptionOutpoint}catch{}const u=e=>{if(!s)return null;try{return s.Psbt.fromBase64(e)}catch{try{return s.Psbt.fromHex(e)}catch{return null}}},d=10,p=6;for(let n=0;n<a.length&&o.length<d;n+=p){if(!e)return;const t=a.slice(n,n+p),r=await Promise.all(t.map(async e=>{const t=String(e?.inscriptionId||e?.inscription_id||e?.id||"").trim(),n=String(e?.sellerOfferPsbt||e?.seller_offer_psbt||e?.psbt||"").trim(),r=Number(e?.priceSats??e?.price_sats??e?.price);if(!t||!n)return null;if(!Number.isFinite(r)||r<=0)return null;if(l&&c)try{const e=u(n),r=e?l(e,2):null;if(r){const e=await c(t).catch(()=>null);if(e&&r.toLowerCase()!==String(e).toLowerCase())return null}}catch{}return{inscriptionId:t,sellerOfferPsbt:n,price:r}}));for(const e of r)e&&o.length<d&&o.push(e);if(!e)return;Ot("Finding you an authority slot\u2026")}if(!e)return;if(0===o.length)return void Ot("All authority slots in the oodl-auth collection have been sold or are no longer available.");const f=o[Math.floor(Math.random()*o.length)];Pt({inscriptionId:f.inscriptionId,sellerOfferPsbt:f.sellerOfferPsbt,price:f.price,collection:r,totalAvailable:o.length}),Ot("")}catch(Pk){if(!e)return;Ft(Pk?.message||String(Pk)),Ot("")}})(),()=>{e=!1}):void 0},[Tt]);const Mt=Array.isArray(a)?a:[],Rt=Pc.useMemo(()=>(o&&"object"==typeof o?String(o.status||"").trim().toLowerCase():"")||(Mt.length>0?"unverified":"idle"),[o,Mt.length]);Pc.useMemo(()=>(o&&"object"==typeof o?String(o.message||"").trim():"")||("ready"===Rt?`Wallet assets ready (${Mt.length} inscription(s))`:"unverified"===Rt?`Wallet inscriptions present (${Mt.length}), but ownership scan not verified yet.`:"loading"===Rt?"Checking wallet\u2026":"extracting"===Rt?"Extracting inscriptions\u2026":"error"===Rt?"Wallet scan failed.":"Wallet assets not verified yet."),[o,Rt,Mt.length]);const $t=Pc.useMemo(()=>o&&"object"==typeof o?String(o.error||"").trim():"",[o]),Ut=Pc.useMemo(()=>{const e=[];for(const t of Mt){const n=bI(t?.id||t?.inscriptionId||t?.inscription_id);if(!n)continue;const r=String(t?.contentType||t?.content_type||"").trim().toLowerCase();if(!r.startsWith("image/"))continue;const i=t?.number??t?.inscriptionNumber??t?.inscription_number;e.push({id:n,contentType:r,number:Number.isFinite(Number(i))?Number(i):null})}return e.sort((e,t)=>{const n=e.number,r=t.number;return Number.isFinite(n)&&Number.isFinite(r)&&n!==r?n-r:Number.isFinite(n)&&!Number.isFinite(r)?-1:!Number.isFinite(n)&&Number.isFinite(r)?1:String(e.id).localeCompare(String(t.id))}),e},[Mt]),Dt=Pc.useMemo(()=>bI(M),[M]),Ht=Pc.useMemo(()=>{const e=(()=>{const e=Number(String(ot||"").trim());return Number.isFinite(e)&&e>=0?Math.floor(e):null})();if(null!==e)return e;const t=Array.isArray(pt)?pt:[];if(0===t.length)return null;let n=null;for(const r of t){const e=Number(mt?.[r]?.bitmapNumber);if(!Number.isFinite(e)||e<0)continue;const t=Math.floor(e);if(null===n)n=t;else if(n!==t)return null}return n},[ot,pt,mt]);Pc.useEffect(()=>{if("parcels"!==ee)return;const e=Ht,t=Number.isFinite(Number(e))?`${Math.floor(Number(e))}.bitmap`:"",n=hs?.parcel_manifest||null,r=n?.address?String(n.address).trim():"",i=(()=>{const e=Number(n?.feeSats??n?.minFeeSats);return!Number.isFinite(e)||e<=0?"600":String(Math.max(600,Math.floor(e)))})();B!==t&&(P(t),O(!0));const a=Number.isFinite(Number(e))?String(Math.floor(Number(e))):"";A!==a&&(k(a),C(!0)),$!==r&&U(r),z!==i&&D(i)},[ee,Ht,A,B,$,z]),Pc.useEffect(()=>{"parcels"===ee&&W(e=>!0!==e||e)},[ee]),Pc.useEffect(()=>{if("parcels"!==ee)return;if(!zt())return;const e=(Array.isArray(Ct)?Ct:[]).map(e=>bI(e)).filter(Boolean).slice(-3).reverse();if(0===e.length)return;const t=e[0];if(t&&At.current===t)return;t&&(At.current=t);let n=!1;return(async()=>{for(const t of e){if(n)return;try{const e=await Us(t),n="bitmap"===String(e?.key||"").toLowerCase()&&!0===e?.verified,r=Number(e?.bitmapNumber);if(n&&Number.isFinite(r)&&r>=0){const e=Math.floor(r);if(bI(it)===t&&String(ot||"").trim()===String(e))return;return at(t),void st(String(e))}}catch{}try{const e=await Vs(t),n="parcel"===String(e?.key||"").toLowerCase()&&!0===e?.verified,r=Number(e?.bitmapNumber),i=e?.bitmapInscriptionId;if(n&&Number.isFinite(r)&&r>=0&&i){const e=Math.floor(r);if(String(ot||"").trim()===String(e)&&bI(it))return;return at(bI(i)||String(i)),void st(String(e))}}catch{}}})(),()=>{n=!0}},[ee,Ct,it,ot]);const Wt=Pc.useMemo(()=>{const e=[],t=new Set;for(const n of Mt){const r=bI(n?.id||n?.inscriptionId||n?.inscription_id);r&&!t.has(r)&&(t.add(r),e.push({id:r,number:n?.number??n?.inscriptionNumber??n?.inscription_number??null}))}return e},[Mt]),jt=Pc.useMemo(()=>{const e=new Set;for(const{id:t}of Wt)t&&e.add(String(t));for(const t of Mt){const n=t?.sameSatIds;if(Array.isArray(n)&&0!==n.length)for(const t of n){const n=bI(t);n&&e.add(n)}}return e},[Wt,Mt]),Vt=Pc.useCallback(e=>{const t=bI(e);return t?jt.has(t)?"owned":"ready"===Rt?"not-owned":"error"===Rt?"error":"loading"===Rt||"extracting"===Rt?"checking":"unknown":"unknown"},[jt,Rt]);Pc.useEffect(()=>{if("in-wallet"!==ee)return;const e=Array.isArray(Ct)?Ct.map(e=>bI(e)).filter(Boolean):[];0!==e.length&&He(t=>{const n={...t||{}};let r=!1;for(const i of e)!0!==n[i]&&(n[i]=!0,r=!0);return r?n:t})},[ee,Ct]);const qt=Pc.useCallback(e=>{const t=Array.isArray(e)?e:[];0!==t.length&&je(e=>{const n={...e||{}};let r=!1;for(const i of t)i&&void 0===n[i]&&(n[i]=!0,r=!0);return r?n:e})},[]),Xt=Pc.useMemo(()=>{if("csv"===ee)return Array.isArray(Ve)?Ve:[];if("legacy"===ee)return yI(Ue);if("parcels"===ee)return Array.isArray(pt)?pt:[];if("bitmaps"===ee)return Array.isArray(wt)?wt:[];if("gallery"===ee)return Array.isArray(Oe)?Oe:[];if("in-wallet"===ee){const e=[],t=new Set;for(const{id:n}of Wt)n&&!t.has(n)&&!0===De?.[n]&&(t.add(n),e.push(n));for(const n of Ct.map(e=>bI(e)).filter(Boolean))t.has(n)||(t.add(n),e.push(n));return e}return Array.isArray(Ce)?Ce:[]},[ee,Ve,Ue,pt,wt,Oe,Ce,Wt,De,Ct]),Kt=Pc.useCallback(async({filterBitmapOverride:e=null}={})=>{if(dt(""),ct(""),!zt())return ft([]),gt({}),void dt("Cannot scan parcels in a sandboxed environment. Use a reverse proxy that serves /r/* and /content/* on the current origin.");const t=Wt.map(e=>e.id).filter(Boolean);if(0===t.length)return ft([]),gt({}),void ct("No wallet inscriptions loaded yet. Fetch UTXOs first.");const n=(()=>{const t=Number(e);if(Number.isFinite(t)&&t>=0)return Math.floor(t);const n=Number(String(ot||"").trim());return Number.isFinite(n)&&n>=0?Math.floor(n):null})();try{ct("Scanning wallet for valid parcels\u2026");const e=6,r=[],i={};let a=0;for(let s=0;s<t.length;s+=e){const o=t.slice(s,s+e),l=await Promise.all(o.map(async e=>{try{return await Vs(e)}catch{return null}}));for(let e=0;e<o.length;e++){const t=o[e],s=l[e];a++;const c=Number(s?.bitmapNumber),u=Number(s?.parcelNumber);"parcel"===String(s?.key||"").toLowerCase()&&!0===s?.verified&&Number.isFinite(c)&&Number.isFinite(u)&&(null!==n&&Math.floor(c)!==n||(r.push(t),i[t]={parcelNumber:Math.floor(u),bitmapNumber:Math.floor(c)}))}ct(`Scanning wallet for valid parcels\u2026 (${a}/${t.length})`)}try{if(r.length>0){const e=await Hl(r,{fetchCollections:["parcel","parcel_manifest","bitmap"]});for(const n of r)if(e.has(n)&&i[n]){const t=e.get(n);i[n].hasActiveListing=!0,i[n].activeListingPrice=t?.price??null,i[n].activeListingCollection=t?.collection?.key??null}const t=r.filter(e=>i[e]?.hasActiveListing).length;t>0&&ct(e=>`${e||""} \u26a0\ufe0f ${t} parcel(s) already have active listing(s).`.trim())}}catch(Pk){}r.sort((e,t)=>{const n=i[e],r=i[t],a=Number(n?.bitmapNumber),o=Number(r?.bitmapNumber);if(Number.isFinite(a)&&Number.isFinite(o)&&a!==o)return a-o;const s=Number(n?.parcelNumber),l=Number(r?.parcelNumber);return Number.isFinite(s)&&Number.isFinite(l)&&s!==l?s-l:String(e).localeCompare(String(t))}),ft(r),gt(i),qt(r);const o=r.filter(e=>i[e]?.hasActiveListing).length;ct(r.length>0?`Found ${r.length} valid parcel inscription(s).`+(o>0?` ${o} already listed \u2014 re-listing will update existing listing(s).`:""):"No valid parcels found in wallet.")}catch(Pk){ft([]),gt({}),dt(Pk?.message||String(Pk)),ct("")}},[ot,qt,Wt]),Gt=Pc.useCallback(async()=>{if(xt(""),bt(""),!zt())return vt([]),Et({}),void xt("Cannot scan bitmaps in a sandboxed environment. Use a reverse proxy that serves /r/* and /content/* on the current origin.");const e=Wt.map(e=>e.id).filter(Boolean);if(0===e.length)return vt([]),Et({}),void bt("No wallet inscriptions loaded yet. Fetch UTXOs first.");try{bt("Scanning wallet for valid bitmaps\u2026");const t=6,n=[],r={};let i=0;for(let o=0;o<e.length;o+=t){const a=e.slice(o,o+t),s=await Promise.all(a.map(async e=>{try{return await Us(e)}catch{return null}}));for(let e=0;e<a.length;e++){const t=a[e],o=s[e];i++;const l=Number(o?.bitmapNumber);"bitmap"===String(o?.key||"").toLowerCase()&&!0===o?.verified&&Number.isFinite(l)&&(n.push(t),r[t]={bitmapNumber:Math.floor(l)})}bt(`Scanning wallet for valid bitmaps\u2026 (${i}/${e.length})`)}try{if(n.length>0){const e=await Hl(n,{fetchCollections:["bitmap"]});for(const i of n)if(e.has(i)&&r[i]){const t=e.get(i);r[i].hasActiveListing=!0,r[i].activeListingPrice=t?.price??null,r[i].activeListingCollection=t?.collection?.key??null}const t=n.filter(e=>r[e]?.hasActiveListing).length;t>0&&bt(e=>`${e||""} \u26a0\ufe0f ${t} bitmap(s) already have active listing(s).`.trim())}}catch(Pk){}n.sort((e,t)=>{const n=Number(r[e]?.bitmapNumber),i=Number(r[t]?.bitmapNumber);return Number.isFinite(n)&&Number.isFinite(i)&&n!==i?n-i:String(e).localeCompare(String(t))}),vt(n),Et(r),qt(n);const a=n.filter(e=>r[e]?.hasActiveListing).length;bt(n.length>0?`Found ${n.length} valid bitmap inscription(s).`+(a>0?` ${a} already listed \u2014 re-listing will update existing listing(s).`:""):"No valid bitmaps found in wallet.")}catch(Pk){vt([]),Et({}),xt(Pk?.message||String(Pk)),bt("")}},[qt,Wt]);Pc.useEffect(()=>{"bitmaps"===ee&&(Nt.current||0!==Wt.length&&(Nt.current=!0,Gt()))},[ee,Wt,Gt]),Pc.useEffect(()=>{"parcels"===ee&&null!==Ht&&It.current!==Ht&&(It.current=Ht,Kt({filterBitmapOverride:Ht}))},[ee,Ht,Kt]),Pc.useEffect(()=>{qt(Xt)},[Xt,qt]);const Yt=Pc.useMemo(()=>(Array.isArray(Xt)?Xt:[]).filter(e=>!1!==We?.[e]),[Xt,We]);Pc.useEffect(()=>{H&&Array.isArray(Yt)&&0!==Yt.length&&Z(e=>{const t={...e||{}};let n=!1;for(const r of Yt)r&&"owned"===Vt(r)&&void 0===t[r]&&(t[r]=!0,n=!0);return n?t:e})},[H,Yt,Vt]),Pc.useEffect(()=>{H&&Z(e=>{const t={...e||{}};let n=!1;for(const r of Object.keys(t))r&&!0===t[r]&&(!1!==We?.[r]?"owned"!==Vt(r)&&(t[r]=!1,n=!0):(t[r]=!1,n=!0));return n?t:e})},[H,We,Vt]);const Qt=Pc.useMemo(()=>H?(Array.isArray(Yt)?Yt:[]).filter(e=>"owned"===Vt(e)&&!1!==Q?.[e]):[],[H,Yt,Q,Vt]),Zt=Pc.useMemo(()=>{const e=Array.isArray(Qt)?Qt:[],t=e=>{try{return _N(e)}catch{return null}},n=t(j);let r=0,i=0;for(const a of e){const e=t(K?.[a]),o=null!==e?e:n;null!==o?r+=o:i++}return{count:e.length,missingPriceCount:i,totalSats:r,hasDefaultPrice:null!==n}},[Qt,K,j]),en=Math.max(0,(Xt?.length||0)-(Yt?.length||0)),tn=Pc.useMemo(()=>{const e=Array.isArray(Xt)?Xt:[];return"parcels"===ee?e.filter(e=>mt?.[e]?.hasActiveListing).length:"bitmaps"===ee?e.filter(e=>St?.[e]?.hasActiveListing).length:0},[ee,Xt,mt,St]);Pc.useEffect(()=>{if(T)return;const e=function(e,t){const n=hI(e);if(!n)return"";const r=new Set((Array.isArray(t)?t:[]).map(e=>hI(e)).filter(Boolean));if(!r.has(n))return n;for(let i=2;i<1e4;i++){const e=`${n}-${i}`;if(!r.has(e))return e}return`${n}-${Date.now()}`}(B,l);e||gI(B)?e&&e!==A&&k(e):A&&k("")},[B,l,T]),Pc.useEffect(()=>{Array.isArray(Yt)&&0!==Yt.length&&G(e=>{const t={...e||{}},n=String(j||"").trim();let r=!1;for(const i of Yt)i&&(void 0!==t[i]&&null!==t[i]&&""!==String(t[i]).trim()||(t[i]=n,r=!0));return r?t:e})},[Yt,j]);const nn=async()=>{Ze(""),tt("");try{if(!Yt||0===Yt.length)throw new Error("Select at least one inscription to include in the collection.");if(H&&!ue){if("ready"!==Rt)throw new Error("Wallet ownership is not verified yet. Click \u201cRescan wallet\u201d and wait for Ready before generating offers (or explicitly allow unverified signing).");if($t)throw new Error(`Wallet scan error: ${$t}`)}tt("Launching collection\u2026");const e=e=>{const t=String(e??"").trim();if(!t)return null;const n=Number(t);if(!Number.isFinite(n))throw new Error("Block height must be a number.");const r=Math.floor(n);if(r<0)throw new Error("Block height must be >= 0.");return r},t=(()=>{if(!H)return;const e={};for(const t of Qt){const n=Y?.[t];if(null==n)continue;const r=String(n).trim();r&&(e[t]=r)}return Object.keys(e).length>0?e:void 0})(),n=H?t?null:e(q):null;await(h?.({key:A,title:B,description:L,indexingAddress:$,feeSats:z,catalogImageInscriptionId:Dt||void 0,selectedItemIdsOverride:Yt,offerItemIdsOverride:Qt,galleryInscriptionId:"gallery"===ee?String(Pe||"").trim():void 0,includeSaleOffers:H,salePriceSats:j,salePriceByInscriptionId:K,minBlockHeightByInscriptionId:t,minBlockHeight:n,inheritPreviousItems:ne,inheritPreviousOffers:ne&&ie,onProgress:e=>{const t=String(e||"").trim();t&&tt(t)}})),tt("Launch flow started. Follow wallet prompts to publish.")}catch(Pk){Ze(Pk?.message||String(Pk)),tt("")}},rn=async()=>{Ze(""),tt("");try{if("function"!=typeof b)throw new Error("Parcel manifesto flow is not available in this build.");if(!Yt||0===Yt.length)throw new Error("Select at least one inscription to include in the manifesto.");if(H&&!ue){if("ready"!==Rt)throw new Error("Wallet ownership is not verified yet. Click \u201cRescan wallet\u201d and wait for Ready before generating offers (or explicitly allow unverified signing).");if($t)throw new Error(`Wallet scan error: ${$t}`)}const e=bI(it);if(!e)throw new Error("Enter a valid bitmap inscription id (<txid>i<index>).");const t=Number(ot);if(!Number.isFinite(t)||t<0)throw new Error("Enter a valid bitmap number (>= 0).");const n={};if(H){const e=String(j||"").trim();for(const t of Qt){const r=K?.[t]??e;if(null==r)continue;const i=String(r).trim();i&&(n[t]=i)}}const r=e=>{const t=String(e??"").trim();if(!t)return null;const n=Number(t);if(!Number.isFinite(n))throw new Error("Block height must be a number.");const r=Math.floor(n);if(r<0)throw new Error("Block height must be >= 0.");return r},i=(()=>{if(!H)return;const e={};for(const t of Qt){const n=Y?.[t];if(null==n)continue;const r=String(n).trim();r&&(e[t]=r)}return Object.keys(e).length>0?e:void 0})(),a=H?i?null:r(q):null;tt("Publishing Bitmap Parcels manifesto\u2026"),await b({bitmapInscriptionId:e,bitmapNumber:Math.floor(t),itemIds:Yt,includeSaleOffers:H,salePriceByInscriptionId:n,minBlockHeightByInscriptionId:i,minBlockHeight:a,onProgress:e=>{const t=String(e||"").trim();t&&tt(t)}}),tt("Parcel manifesto publish flow started. Follow wallet prompts.")}catch(Pk){Ze(Pk?.message||String(Pk)),tt("")}},an=Pc.useMemo(()=>"parcels"===ee||"bitmaps"===ee?[{id:"source",num:1,label:"parcels"===ee?"Parcels":"Bitmaps",description:"Select or scan your inscriptions"},{id:"items",num:2,label:"Items",description:"Review, filter, and price your items"},{id:"details",num:3,label:"Details",description:"Collection metadata and fees"},{id:"review",num:4,label:"Launch",description:"Review and publish"}]:[{id:"intent",num:1,label:"Intent",description:"Choose how you want to list"},{id:"mode",num:2,label:"Mode",description:"Choose how inscriptions are sourced"},{id:"source",num:3,label:"Source",description:"Select or load your inscriptions"},{id:"items",num:4,label:"Items",description:"Review, filter, and price your items"},{id:"details",num:5,label:"Details",description:"Collection metadata and fees"},{id:"review",num:6,label:"Launch",description:"Review and publish"}],[ee]),on=an.findIndex(e=>e.id===ve),sn=on<=0,ln=on>=an.length-1,cn=Pc.useMemo(()=>{switch(ve){case"intent":return Tt;case"mode":case"details":case"review":default:return!0;case"source":return"parent-child"===ee?!!gI(Ee):Xt.length>0;case"items":return Yt.length>0}},[ve,ee,Tt,Xt.length,Yt.length,Ee]),[un,dn]=Pc.useState(!1),pn=async()=>{if(!ln&&cn){if("source"===ve&&"parent-child"===ee&&gI(Ee)){dn(!0);try{await(async()=>{Te(""),Ae("");try{Ae("Fetching children\u2026");const e=await async function(e){const t=bI(e);if(!t)throw new Error("Invalid parent inscription id. Expected <txid>i<index>.");if(!zt())throw new Error("Cannot fetch children in a sandboxed environment. Use a reverse proxy that serves /r/children/* on the current origin.");const n=[],r=new Set,i=e=>{const t=bI(e);t&&(r.has(t)||(r.add(t),n.push(t)))};try{let e=0;for(;;){const n=0===e?`/r/children/${t}/inscriptions`:`/r/children/${t}/inscriptions/${e}`,r=await wI(kt(n)),a=Array.isArray(r?.children)?r.children:null;if(!a||0===a.length)break;for(const e of a)i(e?.id||e);if(!r.more)break;if(e++,e>50)break}if(n.length>0)return n}catch{}let a=0;for(;;){const e=0===a?`/r/children/${t}`:`/r/children/${t}/${a}`,n=await wI(kt(e)),r=Array.isArray(n?.ids)?n.ids:[];if(!r||0===r.length)break;for(const t of r)i(t);if(!n.more)break;if(a++,a>50)break}return n}(Ee);Be(e),qt(e),Ae(`Loaded ${e.length} child inscription(s).`)}catch(Pk){Te(Pk?.message||String(Pk)),Ae(""),Be([])}})()}finally{dn(!1)}}Se(an[on+1].id)}},fn=()=>{sn||Se(an[on-1].id)},mn=e=>{const t=an.findIndex(t=>t.id===e);t<0||(t<=on||t===on+1&&cn)&&Se(e)},gn=Pc.useMemo(()=>{const e=an.findIndex(e=>e.id===ve),t=e>0,n=e<an.length-1&&cn,r=e>0?`\u2190 ${an[e-1].label}`:"\u2190 Back",i=e<an.length-1?`${an[e+1].label} \u2192`:null,a="review"===ve;return Pc.createElement("div",{className:"fixed bottom-0 left-0 right-0 z-[9200] border-t border-neutral-800/70 bg-neutral-900/95 backdrop-blur-md",style:{paddingBottom:"env(safe-area-inset-bottom, 0px)"}},Pc.createElement("div",{className:"flex items-center gap-2 px-2 sm:px-3 py-2"},Pc.createElement("button",{type:"button",onClick:fn,disabled:!t,className:"px-3 py-1.5 text-[11px] sm:text-xs font-medium rounded-lg transition-all shrink-0 "+(t?"bg-neutral-800 hover:bg-neutral-700 text-neutral-200":"bg-neutral-900/40 text-neutral-700 cursor-not-allowed")},r),Pc.createElement("div",{className:"flex-1 min-w-0 flex items-center justify-center gap-1 overflow-x-auto"},Pc.createElement("div",{className:"flex items-center gap-1 sm:gap-1.5 px-1"},an.map((t,n)=>{const r=n<e,i=n===e,a=n<=e||n===e+1&&cn;return Pc.createElement("button",{key:t.id,type:"button",onClick:()=>mn(t.id),disabled:!a,className:"flex items-center gap-1 px-1.5 py-1 rounded-md text-[10px] font-medium transition-all "+(a?i?"bg-purple-500/20 text-purple-300 ring-1 ring-purple-500/50":r?"bg-neutral-800/60 text-purple-300/80 hover:bg-neutral-800":"text-neutral-500 hover:bg-neutral-800/40":"text-neutral-700 cursor-not-allowed")},Pc.createElement("span",{className:"inline-flex items-center justify-center h-4 w-4 rounded-full text-[8px] font-bold "+(i?"bg-purple-500/30 text-purple-200":r?"bg-purple-500 text-white":"bg-neutral-800 text-neutral-500")},r?"\u2713":t.num),Pc.createElement("span",{className:"hidden sm:inline"},t.label))}))),a?"parcels"!==ee?Pc.createElement("button",{type:"button",onClick:nn,disabled:!Tt,className:"px-4 py-1.5 text-[11px] sm:text-xs font-bold rounded-lg transition-all shrink-0 "+(Tt?"bg-purple-600 hover:bg-purple-500 text-white shadow-lg shadow-purple-500/20":"bg-neutral-800 text-neutral-500 cursor-not-allowed")},"Launch Collection"):Pc.createElement("button",{type:"button",onClick:rn,disabled:"function"!=typeof b||!bI(it)||null===Ht,className:"px-4 py-1.5 text-[11px] sm:text-xs font-bold rounded-lg bg-green-600 hover:bg-green-700 text-white transition-all shrink-0"},"Publish Manifesto"):i?Pc.createElement("button",{type:"button",onClick:pn,disabled:!n||un,className:"px-3 py-1.5 text-[11px] sm:text-xs font-medium rounded-lg transition-all shrink-0 "+(!n||un?"bg-neutral-900/40 text-neutral-700 cursor-not-allowed":"bg-purple-600 hover:bg-purple-500 text-white")},un?Pc.createElement("span",{className:"inline-flex items-center gap-1.5"},Pc.createElement("span",{className:"inline-block w-3.5 h-3.5 rounded-full border-2 border-white/30 border-t-white/80 animate-spin"}),"Fetching\\u2026"):i):Pc.createElement("div",{className:"w-16 shrink-0"})))},[an,ve,cn,fn,pn,mn,ee,Tt,nn,rn,it,Ht,b,un]);return Pc.createElement("div",{className:"flex flex-col h-full min-h-0"},Pc.createElement("div",{className:"flex-1 overflow-y-auto min-h-0 pb-12"},"intent"===ve&&Pc.createElement("div",{className:"flex-1 overflow-y-auto p-4 space-y-4"},Pc.createElement("div",{className:"text-xs font-semibold text-neutral-400 uppercase tracking-wider"},"Intent & Authority"),"parcels"!==ee&&Pc.createElement("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3"},Pc.createElement("button",{type:"button",onClick:()=>{se("launch"),W(!0)},className:"text-left rounded-xl p-4 border transition-all duration-200 "+("launch"===oe?"border-purple-500/60 bg-purple-500/10 ring-1 ring-purple-500/30":"border-neutral-800/60 bg-neutral-950/20 hover:border-neutral-700/60")},Pc.createElement("div",{className:"text-sm font-semibold mb-1.5 "+("launch"===oe?"text-purple-200":"text-neutral-400")},"Launch Pad"),Pc.createElement("p",{className:"text-[12px] leading-relaxed "+("launch"===oe?"text-neutral-300":"text-neutral-500")},"List items you own for sale with embedded offers. Set prices, configure locktimes, and launch directly to the marketplace.")),Pc.createElement("button",{type:"button",onClick:()=>{se("curate"),W(!1)},className:"text-left rounded-xl p-4 border transition-all duration-200 "+("curate"===oe?"border-indigo-500/60 bg-indigo-500/10 ring-1 ring-indigo-500/30":"border-neutral-800/60 bg-neutral-950/20 hover:border-neutral-700/60")},Pc.createElement("div",{className:"text-sm font-semibold mb-1.5 "+("curate"===oe?"text-indigo-200":"text-neutral-400")},"Curate Collection"),Pc.createElement("p",{className:"text-[12px] leading-relaxed "+("curate"===oe?"text-neutral-300":"text-neutral-500")},"Curate a collection on-chain. Others list their items to it; you earn indexing fees as the owner."))),"parcels"!==ee&&Pc.createElement("div",{className:"text-sm rounded-xl overflow-hidden "+(Tt?"border border-green-500/40 bg-green-500/5 p-3":"border border-purple-500/30 bg-gradient-to-br from-purple-500/10 via-neutral-900/60 to-neutral-950/80 p-4")},Tt?Pc.createElement(Pc.Fragment,null,Pc.createElement("div",{className:"text-xs font-semibold text-neutral-200 mb-1"},"Authority Slot"),Pc.createElement("div",{className:"text-[11px] text-neutral-400 mb-2"},"You're all set! Pick the authority slot to publish with."),Pc.createElement("select",{className:"w-full px-3 py-2 text-sm bg-neutral-950/60 border border-green-500/40 rounded-lg text-neutral-200 outline-none focus:border-purple-500/60 font-mono",value:p,onChange:e=>g?.(e.target.value)},c.map(e=>Pc.createElement("option",{key:e,value:e},e)))):Pc.createElement("div",{className:"space-y-3"},Pc.createElement("div",{className:"text-sm font-bold text-purple-200"},"You need an Authority Slot"),Pc.createElement("div",{className:"text-[12px] text-neutral-300 leading-relaxed"},"An ",Pc.createElement("span",{className:"text-purple-300 font-semibold"},"OODL Authority Slot")," is required to publish collections. Grab one below \u2014 it's a one-time purchase you can reuse forever."),Bt?Pc.createElement("div",{className:"border border-purple-500/30 bg-purple-600/10 rounded-lg p-3 flex items-center justify-between flex-wrap gap-3"},Pc.createElement("div",null,Pc.createElement("div",{className:"text-sm font-semibold text-neutral-100"},"Authority Slot"),Pc.createElement("div",{className:"text-xs text-neutral-400"},Pc.createElement("span",{className:"text-purple-300 font-bold"},Number(Bt.price).toLocaleString())," sats \xb7 one-time purchase")),Pc.createElement("button",{type:"button",className:"px-5 py-2.5 text-sm font-bold rounded-lg transition-all hover:scale-[1.02] active:scale-[0.98] shadow-lg "+(x?"bg-purple-600 hover:bg-purple-500 text-white shadow-purple-500/20":"bg-purple-600/80 hover:bg-purple-500/80 text-white shadow-purple-500/10"),onClick:()=>x?y?.(Bt):w?.(),disabled:x&&"function"!=typeof y},x?"Get My Auth":"Connect Wallet")):_t?Pc.createElement("div",{className:"border border-purple-500/20 bg-purple-500/5 rounded-lg p-4 flex flex-col items-center justify-center gap-2 text-center"},Pc.createElement("div",{className:"w-6 h-6 rounded-full border-2 border-purple-400/30 border-t-purple-400 animate-spin"}),Pc.createElement("div",{className:"text-xs text-purple-300/80 font-medium"},_t)):null,Lt&&Pc.createElement("div",{className:"text-[11px] text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2"},Lt)),(u||d)&&Pc.createElement("div",{className:"mt-2"},u&&Pc.createElement("div",{className:"text-xs text-green-300 bg-green-500/10 border border-green-500/30 rounded-lg px-3 py-2"},u),d&&Pc.createElement("div",{className:"text-xs text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2"},d))),"parcels"!==ee&&Tt&&Pc.createElement("div",{className:"border border-neutral-700/50 bg-neutral-900/40 rounded-xl p-3 space-y-2"},Pc.createElement("div",{className:"text-xs font-semibold text-neutral-300"},"Previous Manifesto"),N&&Pc.createElement("div",{className:"text-[11px] text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2"},N),E&&!S&&Pc.createElement("div",{className:"text-[11px] text-neutral-400"},E),S?Pc.createElement("div",{className:"space-y-2"},Pc.createElement("div",{className:"text-[11px] text-neutral-400 leading-relaxed bg-neutral-950/40 rounded-lg p-2 border border-neutral-800/60"},Pc.createElement("div",{className:"flex flex-wrap gap-x-4 gap-y-1"},S.title&&Pc.createElement("span",null,Pc.createElement("span",{className:"text-neutral-500"},"Title:")," ",Pc.createElement("span",{className:"text-neutral-200"},S.title)),S.key&&Pc.createElement("span",null,Pc.createElement("span",{className:"text-neutral-500"},"Key:")," ",Pc.createElement("span",{className:"text-purple-300 font-mono"},S.key))),Pc.createElement("div",{className:"flex flex-wrap gap-x-4 gap-y-1 mt-1"},Pc.createElement("span",null,Pc.createElement("span",{className:"text-neutral-500"},"Items:")," ",Pc.createElement("span",{className:"text-green-300 font-bold"},S.inscriptionIds?.length||0)),Pc.createElement("span",null,Pc.createElement("span",{className:"text-neutral-500"},"Offers:")," ",Pc.createElement("span",{className:"text-amber-300 font-bold"},S.offers?.length||0)),S.version&&Pc.createElement("span",null,Pc.createElement("span",{className:"text-neutral-500"},"Version:")," ",Pc.createElement("span",{className:"text-neutral-300"},S.version)))),Pc.createElement("label",{className:"flex items-center gap-2 cursor-pointer select-none group"},Pc.createElement("input",{type:"checkbox",checked:ne,onChange:e=>{re(e.target.checked),e.target.checked||ae(!1)},className:"accent-purple-500 w-3.5 h-3.5"}),Pc.createElement("span",{className:"text-[12px] text-neutral-300 group-hover:text-neutral-100 transition-colors"},"Inherit inscription IDs from previous manifesto")),ne&&S.offers?.length>0&&Pc.createElement("label",{className:"flex items-center gap-2 cursor-pointer select-none group ml-5"},Pc.createElement("input",{type:"checkbox",checked:ie,onChange:e=>ae(e.target.checked),className:"accent-amber-500 w-3.5 h-3.5"}),Pc.createElement("span",{className:"text-[12px] text-neutral-300 group-hover:text-neutral-100 transition-colors"},"Carry forward signed sale offers ",Pc.createElement("span",{className:"text-[10px] text-neutral-500"},"(stale outpoints will be ignored by indexers)"))),ne&&Pc.createElement("div",{className:"text-[10px] text-neutral-500 leading-relaxed pl-5"},"New items you add will be merged with the ",S.inscriptionIds?.length||0," existing item(s). Duplicates are automatically de-duped.")):Pc.createElement("div",{className:"text-[11px] text-neutral-500"},E||"No existing manifesto found on this authority slot."),"function"==typeof I&&Pc.createElement("button",{type:"button",className:"text-[11px] text-purple-400 hover:text-purple-300 underline underline-offset-2",onClick:()=>I?.()},"Reload previous manifesto")),"parcels"===ee&&Pc.createElement("div",{className:"text-sm text-neutral-400 bg-neutral-950/30 border border-neutral-800/60 rounded-lg p-3"},"Bitmap Parcels mode \u2014 no authority slot needed."),"bitmaps"===ee&&Pc.createElement("div",{className:"text-sm text-neutral-400 bg-neutral-950/30 border border-neutral-800/60 rounded-lg p-3"},"Bitmaps mode \u2014 scans your wallet for verified bitmap inscriptions and lists them via the standard OODL collection flow.")),"mode"===ve&&Pc.createElement("div",{className:"flex-1 overflow-y-auto p-4 space-y-4"},Pc.createElement("div",{className:"text-xs font-semibold text-neutral-400 uppercase tracking-wider"},"Collection Mode"),Pc.createElement("div",{className:"text-[12px] text-neutral-500 leading-relaxed"},"How are the inscriptions in this collection sourced?"),Pc.createElement("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2"},[{value:"parent-child",label:"Parent\u2011Child",desc:"Select a parent inscription and fetch all its children."},{value:"in-wallet",label:"In\u2011Wallet",desc:"Pick inscriptions directly from your connected wallet."},{value:"legacy",label:"Paste IDs",desc:"Paste a list of inscription IDs manually."},{value:"gallery",label:"Gallery",desc:"Use items from a Gallery inscription (Tag 17)."},{value:"csv",label:"CSV Upload",desc:"Upload a CSV file with inscription IDs and optional pricing."}].map(e=>Pc.createElement("button",{key:e.value,type:"button",onClick:()=>te(e.value),className:"text-left rounded-lg p-3 border transition-all "+(ee===e.value?"border-purple-500/50 bg-purple-500/10 ring-1 ring-purple-500/30":"border-neutral-800/60 bg-neutral-950/20 hover:border-neutral-700/60")},Pc.createElement("div",{className:"text-[12px] font-semibold mb-0.5 "+(ee===e.value?"text-purple-200":"text-neutral-300")},e.label),Pc.createElement("p",{className:"text-[11px] leading-relaxed "+(ee===e.value?"text-neutral-300":"text-neutral-500")},e.desc))))),"source"===ve&&Pc.createElement("div",{className:"flex-1 overflow-y-auto p-4 space-y-4"},Pc.createElement("div",{className:"text-xs font-semibold text-neutral-400 uppercase tracking-wider"},"bitmaps"===ee?"\ud83d\uddfa\ufe0f Bitmap Inscriptions":"parcels"===ee?"\ud83d\udcd0 Bitmap Parcels":"Select Inscriptions"),"parent-child"===ee&&Pc.createElement("div",{className:"space-y-3"},Pc.createElement("div",{className:"text-[12px] text-neutral-500"},"Select a parent inscription, then fetch its children to include in the collection."),gI(Ee)?Pc.createElement("div",{className:"flex items-center gap-2 px-3 py-2 text-sm bg-neutral-950/60 border border-purple-500/40 rounded-lg text-neutral-200 font-mono"},Pc.createElement("span",{className:"text-green-400 shrink-0"},"\u2713"),Pc.createElement("span",{className:"truncate min-w-0"},Ee),v&&Pc.createElement("button",{className:"ml-auto shrink-0 px-2 py-1 text-[11px] font-semibold rounded bg-neutral-800 hover:bg-neutral-700 text-neutral-300",onClick:()=>v()},"Change")):Pc.createElement("button",{className:"w-full px-4 py-3 text-sm font-semibold rounded-lg bg-purple-600 hover:bg-purple-500 text-white transition-colors",onClick:()=>v?.()},"Select Parent Inscription"),Ce.length>0&&Pc.createElement("div",{className:"flex items-center gap-2"},Pc.createElement("div",{className:"text-[11px] text-green-300 bg-green-500/10 border border-green-500/30 rounded-lg px-3 py-2 flex-1"},Ce.length," child inscription(s) loaded"),Pc.createElement("button",{className:"px-2.5 py-1.5 text-[11px] font-semibold rounded-lg bg-neutral-900 hover:bg-neutral-800 text-neutral-300 shrink-0",onClick:()=>{Be([]),Ae(""),Te("")}},"Clear")),un&&Pc.createElement("div",{className:"flex items-center gap-2 text-[11px] text-purple-300"},Pc.createElement("span",{className:"inline-block w-4 h-4 rounded-full border-2 border-purple-400/30 border-t-purple-400 animate-spin"}),"Fetching children\u2026"),ke&&Pc.createElement("div",{className:"text-[11px] text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2"},ke)),"in-wallet"===ee&&Pc.createElement("div",{className:"space-y-3"},Pc.createElement("div",{className:"text-[12px] text-neutral-500"},"Check the inscriptions from your wallet to include."),0===Wt.length?Pc.createElement("div",{className:"text-[11px] text-neutral-500 bg-neutral-950/30 border border-neutral-800/60 rounded-lg p-3"},"No wallet inscriptions loaded. Connect wallet first."):Pc.createElement("div",{className:"border border-neutral-800/60 rounded-lg bg-neutral-950/20 overflow-hidden"},Pc.createElement("div",{className:"px-3 py-2 border-b border-neutral-800/60 flex items-center justify-between"},Pc.createElement("div",{className:"text-[11px] text-neutral-400"},Wt.length," wallet inscription(s)"),Pc.createElement("div",{className:"flex gap-2"},Pc.createElement("button",{className:"px-2 py-1 text-[11px] rounded bg-neutral-800 hover:bg-neutral-700 text-neutral-100",onClick:()=>{const e={};for(const{id:t}of Wt)e[t]=!0;He(e)}},"Select all"),Pc.createElement("button",{className:"px-2 py-1 text-[11px] rounded bg-neutral-900 hover:bg-neutral-800 text-neutral-200",onClick:()=>He({})},"Clear"))),Pc.createElement("div",{className:"max-h-64 overflow-auto"},Pc.createElement("table",{className:"w-full text-[11px]"},Pc.createElement("thead",null,Pc.createElement("tr",{className:"text-neutral-400"},Pc.createElement("th",{className:"text-left font-semibold px-3 py-2"},"Include"),Pc.createElement("th",{className:"text-left font-semibold px-3 py-2"},"Inscription"),Pc.createElement("th",{className:"text-left font-semibold px-3 py-2 w-16"},"Preview"))),Pc.createElement("tbody",null,Wt.map(({id:e,number:t})=>Pc.createElement("tr",{key:e,className:"border-t border-neutral-800/60 hover:bg-neutral-800/20"},Pc.createElement("td",{className:"px-3 py-2"},Pc.createElement("input",{type:"checkbox",checked:!0===De?.[e],onChange:t=>He(n=>({...n||{},[e]:!!t.target.checked})),className:"accent-purple-500"})),Pc.createElement("td",{className:"px-3 py-2 font-mono text-neutral-200 break-all"},null!=t?Pc.createElement("span",{className:"text-neutral-400"},"#",t," "):null,e),Pc.createElement("td",{className:"px-3 py-2"},Pc.createElement("img",{src:kt(`/content/${e}`),alt:"",className:"h-8 w-8 rounded border border-neutral-800/60 object-cover",loading:"lazy",onError:e=>{e.target.style.display="none"}}))))))))),"legacy"===ee&&Pc.createElement("div",{className:"space-y-3"},Pc.createElement("div",{className:"text-[12px] text-neutral-500"},"Paste inscription IDs, one per line."),Pc.createElement("textarea",{className:"w-full px-3 py-2 text-sm bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-purple-500/60 font-mono",value:Ue,onChange:e=>ze(e.target.value),placeholder:"txid...i0\ntxid...i1",rows:6}),Pc.createElement("div",{className:"text-[11px] text-neutral-500"},"Parsed: ",yI(Ue).length," inscription(s)")),"csv"===ee&&Pc.createElement("div",{className:"space-y-3"},Pc.createElement("div",{className:"text-[12px] text-neutral-500"},"Upload a CSV file containing inscription IDs and optional pricing data."),Pc.createElement("div",{className:"flex flex-wrap items-center gap-2"},Pc.createElement("input",{ref:Je,type:"file",accept:".csv,text/csv",className:"hidden",onChange:e=>{const t=e.target.files?.[0];if(!t)return;Ye(""),Ke(t.name);const n=new FileReader;n.onload=e=>{const t=function(e){const t=String(e||"").split(/\r?\n/).map(e=>e.trim()).filter(Boolean);if(0===t.length)return{ids:[],priceMap:{},lockMap:{},forSaleMap:{},error:"CSV file is empty."};const n=t[0].toLowerCase(),r=n.includes("inscription_id")||n.includes("inscription id")||n.includes("inscription,"),i=r?t.slice(1):t;let a=0,o=-1,s=-1,l=-1;if(r){const e=t[0].split(",").map(e=>e.trim().toLowerCase().replace(/['"]/g,""));a=e.findIndex(e=>"inscription_id"===e||"inscription id"===e||"id"===e),o=e.findIndex(e=>"price_sats"===e||"price"===e||"price sats"===e),s=e.findIndex(e=>"min_block_height"===e||"lock"===e||"locktime"===e||"block_height"===e),l=e.findIndex(e=>"for_sale"===e||"sell"===e||"for sale"===e),a<0&&(a=0)}const c=[],u={},d={},p={},f=new Set;let m=0;for(const g of i){const e=g.split(",").map(e=>e.trim().replace(/^['"]|['"]$/g,"")),t=bI(e[a]||"");if(t){if(!f.has(t)){if(f.add(t),c.push(t),o>=0&&e[o]){const n=e[o].trim();n&&!isNaN(Number(n))&&Number(n)>0&&(u[t]=n)}if(s>=0&&e[s]){const n=e[s].trim();n&&!isNaN(Number(n))&&Number(n)>0&&(d[t]=n)}if(l>=0&&e[l]){const n=e[l].trim().toLowerCase();p[t]="true"===n||"yes"===n||"1"===n}}}else m++}return{ids:c,priceMap:u,lockMap:d,forSaleMap:p,error:m>0?`${m} row(s) could not be parsed (invalid inscription ID).`:""}}(e.target?.result);qe(t.ids),t.error&&Ye(t.error),Object.keys(t.priceMap).length>0&&G(e=>({...e||{},...t.priceMap})),Object.keys(t.lockMap).length>0&&J(e=>({...e||{},...t.lockMap})),Object.keys(t.forSaleMap).length>0&&Z(e=>({...e||{},...t.forSaleMap}))},n.onerror=()=>{Ye("Failed to read file."),qe([])},n.readAsText(t),e.target.value=""}}),Pc.createElement("button",{type:"button",className:"px-3 py-2 text-xs font-semibold rounded-lg bg-purple-600 hover:bg-purple-500 text-white",onClick:()=>Je.current?.click()},Xe?"Replace CSV":"Choose CSV File"),Pc.createElement("button",{type:"button",className:"px-3 py-2 text-xs font-semibold rounded-lg bg-neutral-800 hover:bg-neutral-700 text-neutral-100",onClick:xI},"Download Template"),Xe&&Pc.createElement("button",{type:"button",className:"px-3 py-2 text-xs font-semibold rounded-lg bg-neutral-900 hover:bg-neutral-800 text-neutral-400",onClick:()=>{qe([]),Ke(""),Ye(""),Je.current&&(Je.current.value="")}},"Clear")),Xe&&Pc.createElement("div",{className:"text-[11px] text-neutral-400 flex items-center gap-1.5"},Pc.createElement("span",{className:"text-purple-300 font-medium"},Xe),Pc.createElement("span",null,"\xb7"),Pc.createElement("span",null,Ve.length," inscription(s) parsed")),Ge&&Pc.createElement("div",{className:"text-[11px] text-yellow-300 bg-yellow-500/10 border border-yellow-500/30 rounded-lg px-3 py-2"},Ge),Pc.createElement("div",{className:"border border-neutral-800/60 rounded-lg bg-neutral-950/20 p-3 text-[11px] text-neutral-500 space-y-1"},Pc.createElement("div",{className:"text-neutral-400 font-semibold"},"CSV Format"),Pc.createElement("div",null,"Required column: ",Pc.createElement("span",{className:"font-mono text-neutral-300"},"inscription_id")),Pc.createElement("div",null,"Optional columns: ",Pc.createElement("span",{className:"font-mono text-neutral-300"},"price_sats"),", ",Pc.createElement("span",{className:"font-mono text-neutral-300"},"min_block_height"),", ",Pc.createElement("span",{className:"font-mono text-neutral-300"},"for_sale")),Pc.createElement("div",{className:"text-neutral-600 mt-1"},"Pricing columns auto-fill the Items & Pricing step. You can still edit values there.")),Ve.length>0&&Pc.createElement("div",{className:"border border-neutral-800/60 rounded-lg bg-neutral-950/20 overflow-hidden max-h-48 overflow-y-auto"},Pc.createElement("div",{className:"px-3 py-2 border-b border-neutral-800/60 text-[11px] text-neutral-400 sticky top-0 bg-neutral-900/95 backdrop-blur-sm"},Ve.length," inscription(s) from CSV"),Ve.slice(0,200).map(e=>Pc.createElement("div",{key:e,className:"px-3 py-1.5 text-[11px] font-mono text-neutral-300 border-t border-neutral-800/30 first:border-t-0 break-all flex items-center gap-2"},Pc.createElement("img",{src:kt(`/content/${e}`),alt:"",className:"h-6 w-6 rounded border border-neutral-800/60 object-cover shrink-0",loading:"lazy",onError:e=>{e.target.style.display="none"}}),e)),Ve.length>200&&Pc.createElement("div",{className:"px-3 py-2 text-[11px] text-neutral-500 text-center"},"...and ",Ve.length-200," more"))),"gallery"===ee&&Pc.createElement("div",{className:"space-y-3"},Pc.createElement("div",{className:"text-[12px] text-neutral-500"},"Paste the inscription ID of a Gallery inscription."),Pc.createElement("div",{className:"flex gap-2"},Pc.createElement("input",{className:"flex-1 px-3 py-2 text-sm bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-purple-500/60 font-mono",value:Pe,onChange:e=>_e(e.target.value),placeholder:"<txid>i0 or txid"}),Pc.createElement("button",{className:"px-3 py-2 text-xs font-semibold rounded-lg bg-neutral-800 hover:bg-neutral-700 text-neutral-100 disabled:opacity-40 disabled:cursor-not-allowed shrink-0",onClick:async()=>{const e=String(Pe||"").trim();if(e){$e(""),Me("Resolving gallery items\u2026"),Le([]);try{const{getGalleryInscriptionIds:t}=await n(async()=>{const{getGalleryInscriptionIds:e}=await Promise.resolve().then(()=>mk);return{getGalleryInscriptionIds:e}},__VITE_PRELOAD__),r=await t(e);Le(r),Me(r.length>0?`Resolved ${r.length} item(s) from gallery.`:"No gallery items found.")}catch(Pk){$e(Pk?.message||String(Pk)),Me("")}}},disabled:!String(Pe||"").trim()},"Resolve")),Fe&&Pc.createElement("div",{className:"text-[11px] text-neutral-400"},Fe),Re&&Pc.createElement("div",{className:"text-[11px] text-red-400"},Re),Oe.length>0&&Pc.createElement("div",{className:"border border-neutral-800/60 rounded-lg bg-neutral-950/20 overflow-hidden max-h-48 overflow-y-auto"},Pc.createElement("div",{className:"px-3 py-2 border-b border-neutral-800/60 text-[11px] text-neutral-400 sticky top-0 bg-neutral-900/95"},Oe.length," gallery item(s)"),Oe.map(e=>Pc.createElement("div",{key:e,className:"px-3 py-1.5 text-[11px] font-mono text-neutral-300 border-t border-neutral-800/30 first:border-t-0 break-all flex items-center gap-2"},Pc.createElement("img",{src:kt(`/content/${e}`),alt:"",className:"h-6 w-6 rounded border border-neutral-800/60 object-cover shrink-0",loading:"lazy",onError:e=>{e.target.style.display="none"}}),e)))),"bitmaps"===ee&&Pc.createElement("div",{className:"space-y-3"},Pc.createElement("div",{className:"text-[12px] text-neutral-500"},"Scan your wallet for verified bitmap inscriptions. Each bitmap represents a Bitcoin block and will be listed via the OODL collection flow."),Pc.createElement("div",{className:"flex items-center gap-2"},Pc.createElement("button",{className:"px-3 py-2 text-xs font-semibold rounded-lg bg-teal-600 hover:bg-teal-500 text-white transition-colors",onClick:()=>Gt()},"\ud83d\udd0d Scan wallet for bitmaps"),Pc.createElement("button",{className:"px-3 py-2 text-xs font-semibold rounded-lg bg-neutral-900 hover:bg-neutral-800 text-neutral-200",onClick:()=>{vt([]),Et({}),bt(""),xt(""),Nt.current=!1}},"Clear")),ht&&Pc.createElement("div",{className:"text-[11px] text-green-300 bg-green-500/10 border border-green-500/30 rounded-lg px-3 py-2"},ht),yt&&Pc.createElement("div",{className:"text-[11px] text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2"},yt),wt.length>0&&Pc.createElement("div",{className:"border border-neutral-800/60 rounded-lg bg-neutral-950/20 overflow-hidden"},Pc.createElement("div",{className:"px-3 py-2 border-b border-neutral-800/60 text-[11px] text-neutral-400 sticky top-0 bg-neutral-900/95 backdrop-blur-sm flex items-center justify-between"},Pc.createElement("span",null,"\ud83d\uddfa\ufe0f ",wt.length," bitmap",1!==wt.length?"s":""," found"),(()=>{const e=wt.filter(e=>St[e]?.hasActiveListing).length;return e>0?Pc.createElement("span",{className:"text-orange-300"},e," already listed"):null})()),Pc.createElement("div",{className:"max-h-64 overflow-y-auto divide-y divide-neutral-800/30"},wt.slice(0,200).map(e=>{const t=St[e],n=t?.bitmapNumber;return Pc.createElement("div",{key:e,className:"flex items-center gap-3 px-3 py-2 hover:bg-neutral-800/20 transition-colors"},Pc.createElement("img",{src:kt(`/content/${e}`),alt:"",className:"h-10 w-10 rounded-md border border-neutral-800/60 object-cover shrink-0 bg-neutral-900",loading:"lazy",onError:e=>{e.target.style.display="none"}}),Pc.createElement("div",{className:"min-w-0 flex-1"},Pc.createElement("div",{className:"flex items-center gap-2"},Number.isFinite(n)&&Pc.createElement("span",{className:"text-[13px] font-bold text-teal-300"},"Bitmap ",n.toLocaleString()),t?.hasActiveListing&&Pc.createElement("span",{className:"text-[10px] text-orange-300 bg-orange-500/10 border border-orange-500/20 px-1.5 py-0.5 rounded font-medium"},"listed",null!=t.activeListingPrice?` @ ${ON(t.activeListingPrice)||Number(t.activeListingPrice).toLocaleString()} BTC`:"")),Pc.createElement("div",{className:"text-[10px] font-mono text-neutral-500 truncate mt-0.5",title:e},e)),Number.isFinite(n)&&Pc.createElement("span",{className:"shrink-0 text-[10px] text-neutral-500 bg-neutral-800/50 px-2 py-1 rounded-md font-mono"},"Block ",n.toLocaleString()))})),wt.length>200&&Pc.createElement("div",{className:"px-3 py-2 text-[11px] text-neutral-500 text-center border-t border-neutral-800/40"},"\u2026and ",wt.length-200," more"))),"parcels"===ee&&Pc.createElement("div",{className:"space-y-3"},Pc.createElement("div",{className:"text-[12px] text-neutral-500"},"Select a bitmap, then scan your wallet for valid parcels."),Pc.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3"},Pc.createElement("label",{className:"block"},Pc.createElement("div",{className:"text-xs opacity-70"},"Bitmap number"),Pc.createElement("input",{className:"w-full px-3 py-2 text-sm bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-purple-500/60",value:ot,onChange:e=>st(e.target.value),placeholder:"e.g. 177700",inputMode:"numeric"})),Pc.createElement("div",{className:"flex items-end gap-2"},Pc.createElement("button",{className:"px-3 py-2 text-xs font-semibold rounded-lg bg-neutral-800 hover:bg-neutral-700 text-neutral-100",onClick:()=>Kt({filterBitmapOverride:Ht}),disabled:null===Ht},"Scan wallet"),Pc.createElement("button",{className:"px-3 py-2 text-xs font-semibold rounded-lg bg-neutral-900 hover:bg-neutral-800 text-neutral-200",onClick:()=>{ft([]),gt({}),ct(""),dt("")}},"Clear"))),bI(it)?Pc.createElement("div",{className:"text-[11px] text-neutral-500"},"Selected bitmap: ",Pc.createElement("span",{className:"font-mono text-neutral-300 break-all"},bI(it))):Pc.createElement("div",{className:"text-[11px] text-neutral-500"},"Tip: select your bitmap inscription in the right-hand panel to auto-fill."),lt&&Pc.createElement("div",{className:"text-[11px] text-green-300 bg-green-500/10 border border-green-500/30 rounded-lg px-3 py-2"},lt),ut&&Pc.createElement("div",{className:"text-[11px] text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2"},ut)),Xt.length>0&&Pc.createElement("div",{className:"text-[11px] text-green-300 bg-green-500/5 border border-green-500/30 rounded-lg px-3 py-2"},"bitmaps"===ee?`${Xt.length} bitmap(s) ready \u2014 proceed to set pricing & review.`:`${Xt.length} inscription(s) loaded \u2014 proceed to review them.`)),"items"===ve&&Pc.createElement("div",{className:"flex-1 overflow-y-auto p-4 space-y-0"},Pc.createElement("div",{className:"text-xs font-semibold text-neutral-400 uppercase tracking-wider mb-3"},"Items & Pricing"),Xt.length>0?Pc.createElement("div",{className:"text-sm border border-neutral-800/60 rounded-lg bg-neutral-950/20 overflow-hidden"},Pc.createElement("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 px-3 py-2.5 border-b border-neutral-800/60"},Pc.createElement("div",{className:"flex items-center gap-3"},Pc.createElement("div",{className:"text-xs font-semibold text-neutral-200"},"Items"),Pc.createElement("div",{className:"flex items-center gap-2 text-[11px]"},Pc.createElement("span",{className:"px-1.5 py-0.5 rounded bg-purple-500/15 text-purple-300 font-semibold"},Yt.length," included"),en>0&&Pc.createElement("span",{className:"px-1.5 py-0.5 rounded bg-neutral-800/60 text-neutral-400"},en," excluded"),tn>0&&Pc.createElement("span",{className:"px-1.5 py-0.5 rounded bg-orange-500/15 text-orange-300 font-semibold"},tn," already listed"),H&&Pc.createElement("span",{className:"px-1.5 py-0.5 rounded bg-fuchsia-500/15 text-fuchsia-300 font-semibold"},Qt.length," for sale"))),Pc.createElement("div",{className:"flex items-center gap-2"},Pc.createElement("div",{className:"text-[10px] px-1.5 py-0.5 rounded "+("ready"===Rt?"bg-green-500/10 text-green-300":"error"===Rt?"bg-red-500/10 text-red-300":"bg-yellow-500/10 text-yellow-300/90")},"ready"===Rt?"\u2705 Wallet verified":"error"===Rt?"\u274c Scan error":"loading"===Rt||"extracting"===Rt?"\u23f3 Checking\u2026":"\u26a0\ufe0f Unverified"),Pc.createElement("button",{type:"button",className:"px-2 py-1 text-[10px] rounded bg-neutral-900 hover:bg-neutral-800 text-neutral-300 disabled:opacity-40",onClick:()=>s?.(),disabled:"function"!=typeof s,title:"Refresh wallet UTXOs + inscriptions"},"Rescan"))),Pc.createElement("div",{className:"px-3 py-2 border-b border-neutral-800/40 bg-neutral-950/30 space-y-2"},Pc.createElement("input",{className:"w-full px-2 py-1.5 text-[11px] bg-neutral-950/60 border border-neutral-800/60 rounded text-neutral-200 outline-none focus:border-purple-500/60 font-mono",value:pe,onChange:e=>fe(e.target.value),placeholder:"Search by inscription id\\u2026",title:"Filter by inscription id"}),Pc.createElement("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-2 text-[11px]"},Pc.createElement("div",{className:"flex items-center gap-2.5"},Pc.createElement("span",{className:"text-[10px] text-neutral-600 uppercase tracking-wider"},"Filter"),Pc.createElement("label",{className:"flex items-center gap-1.5 text-neutral-400 select-none cursor-pointer hover:text-neutral-200 transition-colors",title:"Only show owned inscriptions"},Pc.createElement("input",{type:"checkbox",checked:me,onChange:e=>ge(!!e.target.checked),className:"accent-purple-500"}),"Owned"),Pc.createElement("label",{className:"flex items-center gap-1.5 text-neutral-400 select-none cursor-pointer hover:text-neutral-200 transition-colors",title:"Only show included inscriptions"},Pc.createElement("input",{type:"checkbox",checked:ye,onChange:e=>xe(!!e.target.checked),className:"accent-purple-500"}),"Included"),H&&Pc.createElement("label",{className:"flex items-center gap-1.5 text-neutral-400 select-none cursor-pointer hover:text-neutral-200 transition-colors",title:"Only show for-sale inscriptions"},Pc.createElement("input",{type:"checkbox",checked:he,onChange:e=>be(!!e.target.checked),className:"accent-purple-500"}),"For sale")),Pc.createElement("span",{className:"hidden sm:inline text-neutral-800"},"|"),Pc.createElement("div",{className:"flex items-center gap-1.5 text-[10px]"},Pc.createElement("span",{className:"text-[10px] text-neutral-600 uppercase tracking-wider"},"Bulk"),Pc.createElement("button",{className:"px-2 py-1 rounded bg-neutral-800/80 hover:bg-neutral-700 text-neutral-200",title:"Include all",onClick:()=>{const e={...We||{}};for(const t of Xt)e[t]=!0;je(e)}},"Include all"),Pc.createElement("button",{className:"px-2 py-1 rounded bg-neutral-800/80 hover:bg-neutral-700 text-neutral-200",title:"Include owned only",onClick:()=>{const e={...We||{}};for(const t of Xt)t&&(e[t]=jt.has(t));je(e)}},"Include owned"),Pc.createElement("button",{className:"px-2 py-1 rounded bg-neutral-900/80 hover:bg-neutral-800 text-neutral-400",title:"Exclude all",onClick:()=>{const e={...We||{}};for(const t of Xt)e[t]=!1;je(e)}},"Exclude all"),H&&Pc.createElement(Pc.Fragment,null,Pc.createElement("button",{className:"px-2 py-1 rounded bg-fuchsia-500/10 hover:bg-fuchsia-500/20 text-fuchsia-300",title:"Sell all owned",onClick:()=>{Z(e=>{const t={...e||{}};for(const n of Xt)n&&!1!==We?.[n]&&"owned"===Vt(n)&&(t[n]=!0);return t})}},"Sell all owned"),Pc.createElement("button",{className:"px-2 py-1 rounded bg-neutral-900/80 hover:bg-neutral-800 text-neutral-400",title:"Clear sales",onClick:()=>Z({})},"Clear sales"))),Pc.createElement("label",{className:"flex items-center gap-1.5 text-neutral-400 select-none cursor-pointer hover:text-neutral-200 transition-colors ml-auto",title:"Embed sale offer PSBTs in the manifest"},Pc.createElement("input",{type:"checkbox",checked:H,onChange:e=>{const t=!!e.target.checked;W(t),se(t?"launch":"curate")},className:"accent-purple-500"}),"Embed offers"))),H&&Pc.createElement("div",{className:"flex flex-col gap-2 px-3 py-2 border-b border-neutral-800/40 bg-neutral-950/30"},Pc.createElement("div",{className:"flex items-end gap-3"},Pc.createElement("label",{className:"flex-1 min-w-0 block"},Pc.createElement("div",{className:"text-[10px] text-neutral-500 mb-0.5"},"Default price (sats or BTC)"),Pc.createElement("input",{className:"w-full px-2 py-1.5 text-[11px] bg-neutral-950/60 border border-neutral-800/60 rounded text-neutral-200 outline-none focus:border-purple-500/60 font-mono",value:j,onChange:e=>V(e.target.value),placeholder:"100000",inputMode:"decimal"})),Pc.createElement("label",{className:"flex-1 min-w-0 block"},Pc.createElement("div",{className:"text-[10px] text-neutral-500 mb-0.5"},"Default locktime (block)"),Pc.createElement("div",{className:"flex items-center gap-1.5"},Pc.createElement("input",{className:"flex-1 w-full px-2 py-1.5 text-[11px] bg-neutral-950/60 border border-neutral-800/60 rounded text-neutral-200 outline-none focus:border-purple-500/60 font-mono",type:"number",min:0,step:1,value:q,onChange:e=>X(e.target.value),onBlur:()=>{const e=String(q??"").trim();if(!e)return;const t=Number(e),n=Number.isFinite(t)&&t>=0?Math.floor(t):null;null!==n&&null!==nt&&n<=nt&&X("")},placeholder:null!==nt?String(nt+6):"e.g. 850000"}),(()=>{const e=String(q??"").trim();if(!e)return null!==nt?Pc.createElement("span",{className:"text-[10px] text-neutral-600 whitespace-nowrap"},"Tip: ",nt):null;const t=Number(e),n=Number.isFinite(t)&&t>=0?Math.floor(t):null;if(null===n)return null;if(null===nt)return null;const r=n-nt;return r<=0?Pc.createElement("span",{className:"text-[10px] text-yellow-300/80 whitespace-nowrap"},"Now"):Pc.createElement("span",{className:"text-[10px] text-neutral-500 whitespace-nowrap"},"+",r)})())),Pc.createElement("div",{className:"flex items-center gap-1.5 shrink-0 pb-0.5"},Pc.createElement("button",{type:"button",className:"px-2 py-1.5 text-[10px] rounded bg-neutral-800 hover:bg-neutral-700 text-neutral-100",title:"Fill empty fields with defaults",onClick:()=>{const e=Array.isArray(Qt)?Qt:[];if(0===e.length)return;const t=String(j||"").trim(),n=String(q||"").trim();G(n=>{const r={...n||{}};for(const i of e)i&&(String(r[i]??"").trim()||(r[i]=t));return r}),J(t=>{const r={...t||{}};for(const i of e)i&&(String(r[i]??"").trim()||(r[i]=n));return r})}},"Fill blanks"),Pc.createElement("button",{type:"button",className:"px-2 py-1.5 text-[10px] rounded bg-neutral-900 hover:bg-neutral-800 text-neutral-300",title:"Clear per-item overrides",onClick:()=>{const e=Array.isArray(Qt)?Qt:[];0!==e.length&&(G(t=>{const n={...t||{}};for(const r of e)r&&delete n[r];return n}),J(t=>{const n={...t||{}};for(const r of e)r&&delete n[r];return n}))}},"Clear overrides"))),Pc.createElement("div",{className:"flex items-center justify-between gap-4 text-[10px]"},Pc.createElement("div",{className:"flex items-center gap-3 text-neutral-500 whitespace-nowrap min-w-0"},Pc.createElement("span",null,"Offers: ",Pc.createElement("span",{className:"text-neutral-200 font-semibold"},Zt.count)),Pc.createElement("span",null,"Total: ",Pc.createElement("span",{className:"text-neutral-200 font-semibold"},Zt.totalSats," sats")),Zt.missingPriceCount>0&&Pc.createElement("span",{className:"text-yellow-300/90"},"Missing: ",Zt.missingPriceCount)),Pc.createElement("label",{className:"flex items-center gap-1.5 text-neutral-500 select-none cursor-pointer hover:text-neutral-300 transition-colors whitespace-nowrap shrink-0"},Pc.createElement("input",{type:"checkbox",className:"accent-purple-500",checked:ue,onChange:e=>de(!!e.target.checked)}),"Allow unverified signing")),"ready"!==Rt&&!ue&&Pc.createElement("div",{className:"text-[10px] text-yellow-300/90"},"Ownership not verified \u2014 rescan wallet before signing.")),("parcels"===ee||"bitmaps"===ee)&&tn>0&&Pc.createElement("div",{className:"px-3 py-2 border-b border-orange-500/20 bg-orange-500/5 text-[11px] text-orange-300/90 flex items-start gap-2"},Pc.createElement("span",{className:"shrink-0 mt-0.5"},"\ud83d\udd04"),Pc.createElement("span",null,Pc.createElement("strong",null,tn)," ","bitmaps"===ee?"bitmap":"parcel",1!==tn?"s":""," already ",1!==tn?"have":"has"," active OODL listing",1!==tn?"s":"",". Re-listing will ",Pc.createElement("strong",null,"update")," the existing listing with the new price."," ","Items with a current price show it as ",Pc.createElement("span",{className:"text-neutral-400"},'"old \u2192"')," next to the price input.")),Pc.createElement("div",{className:"max-h-[28rem] overflow-auto"},Pc.createElement("table",{className:"w-full text-[11px]"},Pc.createElement("thead",{className:"sticky top-0 bg-neutral-900/95 backdrop-blur-sm z-10"},Pc.createElement("tr",{className:"text-neutral-500 text-[10px] uppercase tracking-wider"},Pc.createElement("th",{className:"text-center font-medium px-2 py-2 w-8"},"In"),H&&Pc.createElement("th",{className:"text-center font-medium px-2 py-2 w-8"},"Sell"),Pc.createElement("th",{className:"text-center font-medium px-2 py-2 w-10"},"Preview"),Pc.createElement("th",{className:"text-left font-medium px-2 py-2 w-14"},"Status"),"parcels"===ee&&Pc.createElement("th",{className:"text-left font-medium px-2 py-2"},"Bitmap"),"bitmaps"===ee&&Pc.createElement("th",{className:"text-left font-medium px-2 py-2"},"Bitmap #"),"parcels"===ee&&Pc.createElement("th",{className:"text-left font-medium px-2 py-2"},"Parcel"),"parcels"===ee&&Pc.createElement("th",{className:"text-center font-medium px-2 py-2 w-14"},"Listed"),"bitmaps"===ee&&Pc.createElement("th",{className:"text-center font-medium px-2 py-2 w-14"},"Listed"),Pc.createElement("th",{className:"text-left font-medium px-2 py-2"},"Inscription"),H&&Pc.createElement("th",{className:"text-left font-medium px-2 py-2 w-28"},"Price"),H&&Pc.createElement("th",{className:"text-left font-medium px-2 py-2 w-24"},"Lock"),Pc.createElement("th",{className:"text-left font-medium px-2 py-2 w-16"}))),Pc.createElement("tbody",null,Xt.filter(e=>{if(!e)return!1;const t=String(pe||"").trim().toLowerCase();return!(t&&!String(e).toLowerCase().includes(t)||ye&&!1===We?.[e]||me&&"owned"!==Vt(e)||he&&(!H||!1===Q?.[e]||"owned"!==Vt(e)))}).map(e=>{const t=Vt(e),n="owned"===t?{text:"yes",cls:"text-green-300 bg-green-500/10 border border-green-500/30"}:"not-owned"===t?{text:"no",cls:"text-neutral-400 bg-neutral-900/30 border border-neutral-800/60"}:"checking"===t?{text:"\u2026",cls:"text-blue-300 bg-blue-500/10 border border-blue-500/30"}:"error"===t?{text:"err",cls:"text-red-300 bg-red-500/10 border border-red-500/30"}:{text:"?",cls:"text-yellow-300/90 bg-yellow-500/10 border border-yellow-500/30"},r=!1!==We?.[e],i=H&&!1!==Q?.[e]&&"owned"===t,a=!(!mt?.[e]?.hasActiveListing&&!St?.[e]?.hasActiveListing),o=mt?.[e]?.hasActiveListing?mt[e]:St?.[e]?.hasActiveListing?St[e]:null,s=o?.activeListingPrice,l=H?!1===We?.[e]?"Item is excluded.":"checking"===t||"unknown"===t?"Ownership not verified yet.":"error"===t?"Wallet scan error.":"owned"!==t?"Not in connected wallet.":"":'Enable "Embed sale offers" first.',c=r?a?"bg-orange-500/5":"":"opacity-40";return Pc.createElement("tr",{key:e,className:`border-t border-neutral-800/40 hover:bg-neutral-800/20 transition-colors ${c}`},Pc.createElement("td",{className:"px-2 py-1.5 text-center"},Pc.createElement("input",{type:"checkbox",checked:r,onChange:t=>je(n=>({...n||{},[e]:!!t.target.checked})),className:"accent-purple-500"})),H&&Pc.createElement("td",{className:"px-2 py-1.5 text-center"},Pc.createElement("input",{type:"checkbox",checked:!1!==Q?.[e],onChange:n=>{const r=!!n.target.checked;r&&"owned"!==t?Ze(l||"Cannot mark for sale unless owned."):Z(t=>({...t||{},[e]:r}))},disabled:!!l,className:"accent-fuchsia-500",title:l||void 0})),Pc.createElement("td",{className:"px-2 py-1.5 text-center"},Pc.createElement("img",{src:kt(`/content/${e}`),alt:"",className:"h-8 w-8 rounded border border-neutral-800/60 object-cover inline-block",loading:"lazy",onError:e=>{e.target.style.display="none"}})),Pc.createElement("td",{className:"px-2 py-1.5"},Pc.createElement("span",{className:`inline-flex items-center text-[10px] px-1.5 py-0.5 rounded ${n.cls}`},n.text)),"bitmaps"===ee&&Pc.createElement("td",{className:"px-2 py-1.5 text-teal-300 font-mono font-bold"},Number.isFinite(St?.[e]?.bitmapNumber)?St[e].bitmapNumber.toLocaleString():""),"parcels"===ee&&Pc.createElement(Pc.Fragment,null,Pc.createElement("td",{className:"px-2 py-1.5 text-neutral-400 font-mono"},Number.isFinite(Number(mt?.[e]?.bitmapNumber))?String(mt[e].bitmapNumber):""),Pc.createElement("td",{className:"px-2 py-1.5 text-neutral-400 font-mono"},Number.isFinite(Number(mt?.[e]?.parcelNumber))?String(mt[e].parcelNumber):""),Pc.createElement("td",{className:"px-2 py-1.5 text-center"},mt?.[e]?.hasActiveListing?Pc.createElement("span",{className:"inline-flex items-center text-[10px] px-1.5 py-0.5 rounded text-orange-300 bg-orange-500/10 border border-orange-500/30",title:`Already listed${mt[e].activeListingPrice?` @ ${ON(mt[e].activeListingPrice)||mt[e].activeListingPrice} BTC`:""}${mt[e].activeListingCollection?` (${mt[e].activeListingCollection})`:""}`},"\ud83d\udd04 yes"):Pc.createElement("span",{className:"inline-flex items-center text-[10px] px-1.5 py-0.5 rounded text-neutral-500 bg-neutral-900/30 border border-neutral-800/60"},"\u2014"))),"bitmaps"===ee&&Pc.createElement("td",{className:"px-2 py-1.5 text-center"},St?.[e]?.hasActiveListing?Pc.createElement("span",{className:"inline-flex items-center text-[10px] px-1.5 py-0.5 rounded text-orange-300 bg-orange-500/10 border border-orange-500/30",title:"Already listed"+(St[e].activeListingPrice?` @ ${ON(St[e].activeListingPrice)||St[e].activeListingPrice} BTC`:"")},"\ud83d\udd04 yes"):Pc.createElement("span",{className:"inline-flex items-center text-[10px] px-1.5 py-0.5 rounded text-neutral-500 bg-neutral-900/30 border border-neutral-800/60"},"\u2014")),Pc.createElement("td",{className:"px-2 py-1.5 font-mono text-neutral-300 text-[10px] break-all"},e),H&&Pc.createElement("td",{className:"px-2 py-1"},a&&null!=s&&Pc.createElement("div",{className:"text-[9px] text-orange-300/80 mb-0.5 flex items-center gap-1",title:`Current listing: ${Number(s).toLocaleString()} sats`},Pc.createElement("span",{className:"text-neutral-500"},"old")," ",Pc.createElement("span",{className:"font-mono"},ON(s)||Number(s).toLocaleString())," ",Pc.createElement("span",{className:"text-neutral-500"},"BTC")," ",Pc.createElement("span",{className:"text-neutral-600"},"\u2192")),Pc.createElement("input",{className:"w-full px-1.5 py-1 text-[11px] bg-neutral-950/60 border rounded text-neutral-200 outline-none font-mono "+(!i||String(K?.[e]??"").trim()||String(j||"").trim()?a?"border-orange-500/30 focus:border-orange-400/60":"border-neutral-800/60 focus:border-purple-500/60":"border-yellow-500/40 focus:border-yellow-500/60"),value:K?.[e]??"",onChange:t=>G(n=>({...n||{},[e]:t.target.value})),placeholder:j?String(j):"\u2014",inputMode:"decimal",disabled:!r,title:a&&null!=s?`Current: ${ON(s)||s} BTC \u2192 enter new price`:K?.[e]?`Override: ${K[e]} sats`:j?`Default: ${j} sats`:"No price set"})),H&&Pc.createElement("td",{className:"px-2 py-1"},Pc.createElement("input",{className:"w-full px-1.5 py-1 text-[11px] bg-neutral-950/60 border border-neutral-800/60 rounded text-neutral-200 outline-none focus:border-purple-500/60 font-mono",type:"number",min:0,step:1,value:Y?.[e]??"",onChange:t=>J(n=>({...n||{},[e]:t.target.value})),onBlur:()=>{const t=String(Y?.[e]??"").trim();if(!t)return;const n=Number(t),r=Number.isFinite(n)&&n>=0?Math.floor(n):null;null!==r&&null!==nt&&r<=nt&&J(t=>({...t||{},[e]:""}))},placeholder:q?String(q):"\u2014",disabled:!r,title:Y?.[e]?`Override: block ${Y[e]}`:q?`Default: block ${q}`:"No locktime"})),Pc.createElement("td",{className:"px-2 py-1.5"},Pc.createElement("div",{className:"flex items-center gap-1"},Pc.createElement("button",{type:"button",className:"px-1.5 py-0.5 text-[10px] rounded bg-neutral-800/60 hover:bg-neutral-700 text-neutral-300",onClick:()=>{try{window.open(kt(`/content/${e}`),"_blank","noopener,noreferrer")}catch(t){}}},"View"),Pc.createElement("button",{type:"button",className:"px-1.5 py-0.5 text-[10px] rounded bg-neutral-900/60 hover:bg-neutral-800 text-neutral-400",onClick:async()=>{try{navigator?.clipboard?.writeText&&await navigator.clipboard.writeText(String(e||"")),tt("Copied."),we.current&&clearTimeout(we.current),we.current=setTimeout(()=>tt(""),1500)}catch(Pk){Ze(Pk?.message||"Failed to copy.")}}},"Copy"))))})))),H&&Pc.createElement("div",{className:"px-3 py-2 border-t border-neutral-800/40 text-[10px] text-neutral-500"},Qt.length," offer PSBT(s) will be signed \xb7 Per-item fields override defaults \xb7 Leave blank to use default")):Pc.createElement("div",{className:"text-[12px] text-neutral-500 bg-neutral-950/30 border border-neutral-800/60 rounded-lg p-4 text-center"},"No inscriptions loaded yet. Go back to ",Pc.createElement("button",{type:"button",className:"text-purple-300 underline",onClick:()=>Se("source")},"Source")," to select your inscriptions.")),"details"===ve&&Pc.createElement("div",{className:"flex-1 overflow-y-auto p-4 space-y-4"},Pc.createElement("div",{className:"text-xs font-semibold text-neutral-400 uppercase tracking-wider"},"Collection Details"),Pc.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3"},Pc.createElement("label",{className:"block"},Pc.createElement("div",{className:"text-xs opacity-70"},"Key (slug)"),Pc.createElement("input",{className:"w-full px-3 py-2 text-sm bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-purple-500/60 font-mono",value:A,onChange:e=>{k(e.target.value),C(!!gI(e.target.value))},disabled:"parcels"===ee,placeholder:"my-collection"})),Pc.createElement("label",{className:"block"},Pc.createElement("div",{className:"text-xs opacity-70"},"Title"),Pc.createElement("input",{className:"w-full px-3 py-2 text-sm bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-purple-500/60",value:B,onChange:e=>{P(e.target.value),O(!0)},disabled:"parcels"===ee,placeholder:"My Collection"})),Pc.createElement("label",{className:"block md:col-span-2"},Pc.createElement("div",{className:"text-xs opacity-70"},"Description (optional)"),Pc.createElement("input",{className:"w-full px-3 py-2 text-sm bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-purple-500/60",value:L,onChange:e=>F(e.target.value),placeholder:"Short description"})),"parcels"!==ee&&Pc.createElement("div",{className:"md:col-span-2"},Pc.createElement("div",{className:"text-xs opacity-70"},"Collection image (optional)"),Pc.createElement("div",{className:"text-[11px] text-neutral-500 mb-2"},"Reference an existing image inscription ID as the thumbnail."),Pc.createElement("input",{className:"w-full px-3 py-2 text-sm bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-purple-500/60 font-mono",value:M,onChange:e=>R(e.target.value),placeholder:"Paste existing image inscription id (e.g. 0123abcd...i0)"}),Ut.length>0&&Pc.createElement("div",{className:"mt-2 flex flex-col sm:flex-row gap-2 sm:items-center"},Pc.createElement("div",{className:"text-[11px] text-neutral-500 shrink-0"},"Pick from wallet:"),Pc.createElement("select",{className:"w-full sm:w-auto px-3 py-2 text-sm bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-purple-500/60 font-mono",value:Dt||"",onChange:e=>R(String(e.target.value||""))},Pc.createElement("option",{value:""},"(none)"),Ut.map(e=>Pc.createElement("option",{key:e.id,value:e.id},null!=e.number?`#${e.number} `:"",e.id))),Pc.createElement("button",{type:"button",className:"px-3 py-2 text-xs font-semibold rounded-lg bg-neutral-900 hover:bg-neutral-800 text-neutral-200",onClick:()=>R("")},"Clear")),Dt&&Pc.createElement("div",{className:"mt-3 border border-neutral-800/60 rounded-lg bg-neutral-950/20 p-2"},Pc.createElement("div",{className:"text-[11px] text-neutral-500 mb-2"},"Preview"),Pc.createElement("img",{src:kt(`/content/${Dt}`),alt:"Catalog thumbnail",className:"max-h-40 w-auto rounded-md border border-neutral-800/60",loading:"lazy"}))),"parcels"!==ee&&Pc.createElement(Pc.Fragment,null,Pc.createElement("label",{className:"block md:col-span-2"},Pc.createElement("div",{className:"text-xs opacity-70"},"Indexing address"),Pc.createElement("input",{className:"w-full px-3 py-2 text-sm bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-purple-500/60 font-mono",value:$,onChange:e=>U(e.target.value),placeholder:"bc1p..."})),Pc.createElement("label",{className:"block"},Pc.createElement("div",{className:"text-xs opacity-70"},"Indexing fee sats (min 330)"),Pc.createElement("input",{className:"w-full px-3 py-2 text-sm bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-purple-500/60",type:"number",min:330,step:1,value:z,onChange:e=>D(e.target.value),placeholder:"330"}))),Pc.createElement("label",{className:"block"},Pc.createElement("div",{className:"text-xs opacity-70"},"Fee rate (sat/vB)"),Pc.createElement("input",{className:"w-full px-3 py-2 text-sm bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-purple-500/60",value:null==f?"":String(f),onChange:e=>m?.(e.target.value),placeholder:"e.g. 5",inputMode:"decimal"}),Pc.createElement("div",{className:"text-[11px] text-neutral-500 mt-1"},"Used when inscribing the collection manifest.")))),"review"===ve&&Pc.createElement("div",{className:"flex-1 overflow-y-auto p-4 space-y-4"},Pc.createElement("div",{className:"text-xs font-semibold text-neutral-400 uppercase tracking-wider"},"Review & Launch"),Pc.createElement("div",{className:"border border-neutral-800/60 rounded-lg bg-neutral-950/20 overflow-hidden text-[12px]"},Pc.createElement("div",{className:"px-3 py-2 border-b border-neutral-800/60 text-xs font-semibold text-neutral-200"},"Summary"),Pc.createElement("div",{className:"px-3 py-2 space-y-1.5 text-neutral-400"},Pc.createElement("div",{className:"flex justify-between"},Pc.createElement("span",null,"Intent"),Pc.createElement("span",{className:"text-neutral-200 font-medium"},"launch"===oe?"Launch Pad":"Curate Collection")),Pc.createElement("div",{className:"flex justify-between"},Pc.createElement("span",null,"Mode"),Pc.createElement("span",{className:"text-neutral-200 font-medium capitalize"},ee)),A&&Pc.createElement("div",{className:"flex justify-between"},Pc.createElement("span",null,"Key"),Pc.createElement("span",{className:"text-neutral-200 font-mono"},A)),B&&Pc.createElement("div",{className:"flex justify-between"},Pc.createElement("span",null,"Title"),Pc.createElement("span",{className:"text-neutral-200"},B)),Pc.createElement("div",{className:"flex justify-between"},Pc.createElement("span",null,"Items included"),Pc.createElement("span",{className:"text-neutral-200 font-semibold"},Yt.length)),H&&Pc.createElement(Pc.Fragment,null,Pc.createElement("div",{className:"flex justify-between"},Pc.createElement("span",null,"For sale"),Pc.createElement("span",{className:"text-fuchsia-300 font-semibold"},Qt.length)),Pc.createElement("div",{className:"flex justify-between"},Pc.createElement("span",null,"Default price"),Pc.createElement("span",{className:"text-neutral-200 font-mono"},j||"\u2014"," sats")),Pc.createElement("div",{className:"flex justify-between"},Pc.createElement("span",null,"Offers total"),Pc.createElement("span",{className:"text-neutral-200 font-semibold"},Zt.totalSats," sats")),Zt.missingPriceCount>0&&Pc.createElement("div",{className:"flex justify-between"},Pc.createElement("span",{className:"text-yellow-300/90"},"Missing prices"),Pc.createElement("span",{className:"text-yellow-300/90 font-semibold"},Zt.missingPriceCount))),f&&Pc.createElement("div",{className:"flex justify-between"},Pc.createElement("span",null,"Fee rate"),Pc.createElement("span",{className:"text-neutral-200 font-mono"},f," sat/vB")))),"parcels"===ee&&Pc.createElement("div",{className:"text-[12px] text-neutral-500"},"Inscribes a manifesto with the bitmap as parent, and pays the parcel-manifest indexing fee + OODL TLV hint inside the reveal."))),gn,(et||Qe)&&Pc.createElement("div",{className:"text-sm px-3 py-2"},et&&Pc.createElement("div",{className:"text-xs text-green-300 bg-green-500/10 border border-green-500/30 rounded-lg px-3 py-2"},et),Qe&&Pc.createElement("div",{className:"text-xs text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2 mt-1"},Qe)))}function SI(e,t,n){const r=Number(n);return Number.isFinite(r)?Math.min(t,Math.max(e,Math.trunc(r))):e}function EI({value:e,label:t,onClear:n}){const r=Bc.useRef(null),i=Bc.useRef(null),a=null===e,o=Bc.useMemo(()=>a?"":String(e||"").trim(),[e,a]),s=a||!!o,[l,c]=Bc.useState([]),[u,d]=Bc.useState(""),[p,f]=Bc.useState(null),[m,g]=Bc.useState(""),[h,b]=Bc.useState(0);Bc.useEffect(()=>{if(!s)return;let e=!1;return g(""),f(null),d(""),b(0),(async()=>{try{if(a||!o)return void c([]);const t=await async function(e,t={}){const n=Number.isFinite(t.singleMaxChars)?t.singleMaxChars:1800,r=Number.isFinite(t.partMaxChars)?t.partMaxChars:900,i=String(e??"").trim();if(!i)return{kind:"single-raw",parts:[""],info:{empty:!0}};if(i.length<=n)return{kind:"single-raw",parts:[i],info:{chars:i.length}};const a=[];rI("gzip")&&a.push("gzip"),rI("brotli")&&a.push("brotli");const o=[];for(const u of a)try{const e=await iI(ZN(i),u),t=QN[u]||"gz",a=tI(e),s=`${GN}:${t}:${YN}:${a}`;if(s.length<=n){o.push({kind:`single-${t}`,parts:[s],info:{chars:s.length,rawChars:i.length,compressedBytes:e.length,format:u}});continue}const l=oI(),c=sI(a,Math.max(1,r-60)),d=c.length,p=c.map((e,n)=>`${GN}:mp:${YN}:${l}:${n+1}/${d}:${t}:${e}`);o.push({kind:`multipart-${t}`,parts:p,info:{parts:d,rawChars:i.length,compressedBytes:e.length,format:u}})}catch{}if(o.length>0)return o.sort((e,t)=>{const n=Array.isArray(e.parts)?e.parts.length:9999,r=Array.isArray(t.parts)?t.parts.length:9999;return n!==r?n-r:(Array.isArray(e.parts)?e.parts.reduce((e,t)=>e+String(t||"").length,0):1e18)-(Array.isArray(t.parts)?t.parts.reduce((e,t)=>e+String(t||"").length,0):1e18)}),o[0];const s=oI(),l=sI(i,Math.max(1,r-60)),c=l.length;return{kind:"multipart-raw",parts:l.map((e,t)=>`${GN}:mp:${YN}:${s}:${t+1}/${c}:raw:${e}`),info:{parts:c,rawChars:i.length}}}(o,{singleMaxChars:1200,partMaxChars:650});if(e)return;c(Array.isArray(t?.parts)?t.parts:[]),d(String(t?.kind||"")),f(t?.info||null)}catch(Pk){if(e)return;c([o]),d("single-raw"),f(null),g(Pk?.message||String(Pk))}})(),()=>{e=!0}},[o,s,a]);const y=Bc.useMemo(()=>{if(a)return"";if(!l||0===l.length)return"";const e=Math.min(Math.max(0,h),l.length-1);return String(l[e]||"").trim()},[l,h,a]);if(Bc.useEffect(()=>{if(!s)return;if(a)return;let e=!1;return(async()=>{try{const t=await function({timeoutMs:e=5e3}={}){const t=Date.now();return new Promise((n,r)=>{const i=()=>"undefined"!=typeof window&&window.QrCreator&&"function"==typeof window.QrCreator.render?n(window.QrCreator):Date.now()-t>e?r(new Error("QrCreator not loaded")):void setTimeout(i,50);i()})}({timeoutMs:7e3});if(e)return;const n=r.current;if(!n)return;if(!y)return n&&(n.innerHTML=""),void(i.current=null);let a=i.current;a||(n.innerHTML="",a=document.createElement("canvas"),a.style.display="block",a.style.imageRendering="pixelated",a.style.maxWidth="100%",a.style.maxHeight="100%",i.current=a,n.appendChild(a));let o=280;try{const e=n.getBoundingClientRect(),t=Number(e?.width),r=Number(e?.height),i=Number.isFinite(t)&&Number.isFinite(r)?Math.min(t,r):null;i&&i>0&&(o=SI(220,360,Math.floor(i)))}catch{}const s=y.length>800?"L":"M",l=SI(220,360,o),c=4;a.style.width=`${l}px`,a.style.height=`${l}px`,t.render({text:y,size:l,ecLevel:s,radius:0,quiet:c},a),a.style.maxWidth="100%",a.style.maxHeight="100%"}catch(Pk){if(e)return;const n=r.current;n&&(n.innerHTML=""),i.current=null}})(),()=>{e=!0}},[y,s,a]),Bc.useEffect(()=>{if(a)return;if(!l||l.length<=1)return;const e=setInterval(()=>{b(e=>(e+1)%l.length)},1400);return()=>clearInterval(e)},[l,a]),!s)return null;const x=Pc.createElement("div",{className:"fixed bottom-4 right-4 z-[99999]"},Pc.createElement("div",{className:"bg-neutral-900/95 border border-neutral-700/60 rounded-xl p-3 shadow-lg w-[92vw] max-w-[420px]"},Pc.createElement("div",{className:"flex flex-col items-center gap-2"},Pc.createElement("div",{className:"bg-white rounded-lg p-3 w-full"},Pc.createElement("div",{className:"w-full aspect-square max-w-[360px] mx-auto flex items-center justify-center"},a?Pc.createElement("div",{className:"text-xs text-neutral-700 font-semibold"},"Loading\u2026"):Pc.createElement("div",{ref:r,className:"w-full h-full flex items-center justify-center"}))),!a&&l?.length>1?Pc.createElement("div",{className:"w-full flex items-center justify-between gap-2"},Pc.createElement("button",{onClick:e=>{e.stopPropagation(),b(e=>(e-1+l.length)%l.length)},className:"px-2 py-1 text-[11px] font-semibold rounded-lg bg-neutral-800 hover:bg-neutral-700 text-white transition-colors",title:"Previous QR part"},"Prev"),Pc.createElement("div",{className:"text-[11px] text-neutral-300 font-semibold"},"Part ",h+1,"/",l.length),Pc.createElement("button",{onClick:e=>{e.stopPropagation(),b(e=>(e+1)%l.length)},className:"px-2 py-1 text-[11px] font-semibold rounded-lg bg-neutral-800 hover:bg-neutral-700 text-white transition-colors",title:"Next QR part"},"Next")):null,Pc.createElement("div",{className:"w-full"},Pc.createElement("div",{className:"text-[11px] text-neutral-300 font-semibold"},t||"PSBT"),Pc.createElement("div",{className:"text-[10px] text-neutral-500 break-all"},a?"Fetching PSBT from reveal tx\u2026":Pc.createElement(Pc.Fragment,null,o.slice(0,42),o.length>42?"\u2026":"")),!a&&u?Pc.createElement("div",{className:"mt-1 text-[10px] text-neutral-500"},"QR payload: ",Pc.createElement("span",{className:"text-neutral-300 font-semibold"},u),p?.parts?Pc.createElement("span",{className:"text-neutral-500"}," \u2022 ",p.parts," parts"):null):null,!a&&m?Pc.createElement("div",{className:"mt-2 text-[11px] text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-2 py-1"},m):null)),Pc.createElement("div",{className:"mt-2 flex gap-2"},Pc.createElement("button",{onClick:e=>{e.stopPropagation();try{!a&&o&&navigator.clipboard.writeText(o)}catch(t){}},disabled:a||!o,className:a||!o?"flex-1 px-3 py-1.5 text-xs font-semibold rounded-lg bg-neutral-800/40 text-neutral-500 cursor-not-allowed":"flex-1 px-3 py-1.5 text-xs font-semibold rounded-lg bg-neutral-800 hover:bg-neutral-700 text-white transition-colors",title:"Copy PSBT"},"Copy"),Pc.createElement("button",{onClick:e=>{e.stopPropagation(),n?.()},className:"px-3 py-1.5 text-xs font-semibold rounded-lg bg-neutral-800 hover:bg-neutral-700 text-white transition-colors",title:"Close"},"Close"))));return"undefined"==typeof document?x:qc.createPortal(x,document.body)}const NI="text-[10px] font-semibold uppercase tracking-wide text-neutral-500",II="text-sky-400 hover:text-sky-300 transition-colors underline underline-offset-2",AI="px-3 sm:px-4 py-2.5 sm:py-3 border-b border-neutral-800/50 last:border-b-0";function kI({label:e,children:t,mono:n=!1}){return t?Pc.createElement("div",{className:"flex flex-col gap-1"},Pc.createElement("span",{className:NI},e),Pc.createElement("span",{className:n?"text-xs font-mono text-neutral-300 break-all":"text-sm text-neutral-200"},t)):null}function TI({value:e,label:t="Copy"}){const[n,r]=Bc.useState(!1);return Pc.createElement("button",{type:"button",onClick:async()=>{try{await navigator.clipboard.writeText(e),r(!0),setTimeout(()=>r(!1),1500)}catch{}},className:"ml-2 px-1.5 py-0.5 text-[9px] font-semibold rounded bg-neutral-800/60 text-neutral-400 hover:text-neutral-200 border border-neutral-700/50 hover:border-neutral-600/60 transition-colors",title:t},n?"\u2713":"\u2398")}function CI({inscriptionId:e,label:t}){if(!e)return null;const n=`${e.slice(0,8)}\u2026${e.slice(-6)}`,r=kt(`/inscription/${e}`);return Pc.createElement("a",{href:r,target:"_blank",rel:"noopener noreferrer",className:II,title:e},t||n)}function BI({address:e}){if(!e)return null;const t=e.length>20?`${e.slice(0,10)}\u2026${e.slice(-8)}`:e,n=`https://mempool.space/address/${e}`;return Pc.createElement("span",{className:"inline-flex items-center gap-1 flex-wrap"},Pc.createElement("a",{href:n,target:"_blank",rel:"noopener noreferrer",className:`${II} font-mono text-xs`,title:e},t),Pc.createElement(TI,{value:e,label:"Copy address"}))}function PI({scripts:e}){return e&&Array.isArray(e)&&0!==e.length?Pc.createElement("div",{className:"flex flex-col gap-1.5"},e.map((e,t)=>{const n="string"==typeof e?e:e?.inscriptionId||e?.id||"",r="object"==typeof e&&(e?.name||e?.label)||"";return n?Pc.createElement("div",{key:t,className:"flex items-center gap-2 text-xs flex-wrap"},Pc.createElement(CI,{inscriptionId:n,label:r||void 0}),r&&Pc.createElement("span",{className:"text-neutral-500"},"(",r,")")):null})):null}function _I({filters:e}){return e&&Array.isArray(e)&&0!==e.length?Pc.createElement("div",{className:"flex flex-wrap gap-1.5"},e.map((e,t)=>{const n=e?.label||e?.key||`Filter ${t+1}`,r=e?.type||"unknown";return Pc.createElement("span",{key:t,className:"inline-flex items-center px-2 py-0.5 text-[10px] font-semibold rounded-full bg-neutral-800/60 text-neutral-300 border border-neutral-700/50",title:`Type: ${r}, Path: ${e?.sourcePath||"N/A"}`},n)})):null}function OI({match:e}){if(!e||"object"!=typeof e)return null;const t=[];if(e.bitmapOci&&t.push({label:"Bitmap OCI",value:"Matches bitmap OCI inscriptions"}),e.contentRegex&&t.push({label:"Content Regex",value:e.contentRegex,mono:!0}),e.contentTypeStartsWith&&t.push({label:"Content Type",value:`Starts with: ${e.contentTypeStartsWith}`}),e.inscriptionIdRange){const n=e.inscriptionIdRange,r=Array.isArray(n)?n.map(e=>`${e.baseTxid?.slice(0,8)}\u2026i${e.from}-${e.to}`).join(", "):`${n.baseTxid?.slice(0,8)}\u2026i${n.from}-${n.to}`;t.push({label:"Inscription Range",value:r,mono:!0})}if(e.inscriptionIds&&e.inscriptionIds.length>0&&t.push({label:"Specific IDs",value:`${e.inscriptionIds.length} inscriptions`}),e.galleryInscriptionId&&t.push({label:"Gallery Inscription",value:e.galleryInscriptionId,mono:!0}),e.jsonPathEquals&&e.jsonPathEquals.length>0){const n=e.jsonPathEquals.map(e=>`${e.path} = ${JSON.stringify(e.equals)}`).join("; ");t.push({label:"JSON Path Match",value:n,mono:!0})}return 0===t.length?null:Pc.createElement("div",{className:"flex flex-col gap-2"},t.map((e,t)=>Pc.createElement("div",{key:t,className:"flex flex-col gap-0.5"},Pc.createElement("span",{className:"text-[9px] font-semibold uppercase text-neutral-600"},e.label),Pc.createElement("span",{className:e.mono?"text-[11px] font-mono text-neutral-400 break-all":"text-xs text-neutral-300"},e.value))))}function LI({addresses:e}){if(!e||"object"!=typeof e)return null;const t=Object.entries(e).filter(([e,t])=>e&&t);return 0===t.length?null:Pc.createElement("div",{className:"flex flex-col gap-2"},t.map(([e,t])=>Pc.createElement("div",{key:e,className:"flex flex-col gap-0.5"},Pc.createElement("span",{className:"text-[9px] font-semibold uppercase text-neutral-600"},e),Pc.createElement(BI,{address:t}))))}function FI({collection:e,isOpen:t,onClose:n}){const r=Bc.useRef(null);if(Bc.useEffect(()=>{if(!t)return;const e=e=>{"Escape"===e.key&&n?.()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[t,n]),Bc.useEffect(()=>{if(!t)return;const e=e=>{r.current&&!r.current.contains(e.target)&&n?.()},i=setTimeout(()=>{document.addEventListener("mousedown",e)},100);return()=>{clearTimeout(i),document.removeEventListener("mousedown",e)}},[t,n]),!t||!e)return null;const{key:i,name:a,description:o,indexingAddress:s,feeSats:l,minFeeSats:c,imageInscriptionId:u,catalogImage:d,addresses:p,scripts:f,filters:m,match:g,sourceInscriptionId:h,manifest:b}=e,y=b?.meta||{},x=b?.indexing||{},w=Number.isFinite(l)||Number.isFinite(c),v=f&&f.length>0,S=m&&m.length>0,E=g&&Object.keys(g).length>0,N=p&&Object.keys(p).length>0,I="string"==typeof d?d:d&&"object"==typeof d&&(d.inscriptionId||d.id)||"",A=d?.contentType||d?.content_type||"";return Pc.createElement(Pc.Fragment,null,Pc.createElement("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[9500]",onClick:n}),Pc.createElement("div",{className:"fixed inset-0 z-[9500] flex items-end sm:items-center justify-center p-0 sm:p-4 pointer-events-none"},Pc.createElement("div",{ref:r,className:"rounded-2xl bg-gradient-to-b from-neutral-900 to-neutral-950 text-neutral-200 shadow-2xl border border-neutral-700/50 overflow-hidden w-full max-w-lg max-h-[85vh] max-h-[85dvh] overflow-y-auto pointer-events-auto animate-in fade-in zoom-in-95 duration-200 rounded-t-2xl sm:rounded-2xl"},Pc.createElement("div",{className:"flex items-start gap-3 sm:gap-4 p-3 sm:p-4 border-b border-neutral-800/50 sticky top-0 bg-neutral-900/95 backdrop-blur-sm z-10"},(u||I)&&Pc.createElement("div",{className:"w-14 h-14 sm:w-16 sm:h-16 shrink-0 rounded-xl overflow-hidden bg-black border border-neutral-800/70"},Pc.createElement("img",{src:kt(`/content/${u||I}`),alt:a||i,className:"w-full h-full object-cover",onError:e=>{e.target.style.display="none"}})),Pc.createElement("div",{className:"flex-1 min-w-0"},Pc.createElement("h3",{className:"text-base sm:text-lg font-semibold text-neutral-100 truncate"},a||i),i!==a&&Pc.createElement("div",{className:"text-[10px] sm:text-xs text-neutral-500 font-mono truncate"},i),o&&Pc.createElement("p",{className:"text-xs sm:text-sm text-neutral-400 mt-1 line-clamp-2"},o)),Pc.createElement("button",{type:"button",onClick:n,className:"shrink-0 w-8 h-8 grid place-items-center rounded-lg bg-neutral-800/60 text-neutral-400 hover:text-neutral-200 hover:bg-neutral-700/60 border border-neutral-700/50 transition-colors touch-manipulation",title:"Close"},"\u2715")),Pc.createElement("div",{className:AI},Pc.createElement("div",{className:"grid grid-cols-1 gap-3"},Pc.createElement(kI,{label:"Indexing Address"},Pc.createElement(BI,{address:s})),w&&Pc.createElement(kI,{label:"Listing Fee"},Pc.createElement("span",{className:"flex items-center gap-2 flex-wrap"},Number.isFinite(l)&&Pc.createElement("span",{className:"text-amber-200 font-semibold"},ON(l)," BTC"),Number.isFinite(c)&&c!==l&&Pc.createElement("span",{className:"text-neutral-500 text-xs"},"(min: ",ON(c)," BTC)"))),h&&Pc.createElement(kI,{label:"Manifest Inscription"},Pc.createElement(CI,{inscriptionId:h})),I&&I!==u&&Pc.createElement(kI,{label:"Catalog Image"},Pc.createElement("span",{className:"flex items-center gap-2 flex-wrap"},Pc.createElement(CI,{inscriptionId:I}),A&&Pc.createElement("span",{className:"text-neutral-500 text-[10px]"},"(",A,")"))))),N&&Pc.createElement("div",{className:AI},Pc.createElement("span",{className:NI},"Additional Addresses"),Pc.createElement("div",{className:"mt-2"},Pc.createElement(LI,{addresses:p}))),v&&Pc.createElement("div",{className:AI},Pc.createElement("span",{className:NI},"Scripts"),Pc.createElement("div",{className:"mt-2"},Pc.createElement(PI,{scripts:f}))),S&&Pc.createElement("div",{className:AI},Pc.createElement("span",{className:NI},"Filters"),Pc.createElement("div",{className:"mt-2"},Pc.createElement(_I,{filters:m}))),E&&Pc.createElement("div",{className:AI},Pc.createElement("span",{className:NI},"Membership Rules"),Pc.createElement("div",{className:"mt-2"},Pc.createElement(OI,{match:g}))),y.author&&Pc.createElement("div",{className:AI},Pc.createElement(kI,{label:"Author"},y.author)),x.parentInscriptionId&&Pc.createElement("div",{className:AI},Pc.createElement(kI,{label:"Parent Inscription"},Pc.createElement(CI,{inscriptionId:x.parentInscriptionId}))))))}function MI({collection:e,listingsCount:t=0,floorPriceSats:n=null,isLoading:r=!1,isSubscribed:i=!1,onBack:a,onRefresh:o,onSell:s,onToggleSubscribe:l,onClearCache:c,isClearingCache:u=!1}){const[d,p]=Bc.useState(!1),f=e?.name||e?.title||e?.key||"Collection",m=e?.description||"",g=e?.imageInscriptionId||e?.catalogImage?.inscriptionId||e?.catalogImage||"",h=Number.isFinite(n)&&n>0;return Pc.createElement("div",{className:"relative z-[50]"},Pc.createElement("div",{className:"bg-neutral-900/95 backdrop-blur-sm border border-neutral-800/60 rounded-xl overflow-visible"},Pc.createElement("div",{className:"flex items-center gap-0.5 sm:gap-1 px-1 sm:px-3 py-0 sm:py-0"},Pc.createElement("button",{onClick:a,className:"min-h-[32px] sm:min-h-[44px] px-1 sm:px-1.5 flex items-center text-neutral-400 hover:text-neutral-100 active:text-neutral-100 transition-colors touch-manipulation select-none shrink-0",title:"Back to collections"},Pc.createElement("svg",{className:"w-3.5 h-3.5 sm:w-4 sm:h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2},Pc.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"}))),Pc.createElement("button",{type:"button",onClick:()=>p(e=>!e),className:"flex-1 min-w-0 min-h-[32px] sm:min-h-[44px] flex items-center gap-1.5 sm:gap-3 touch-manipulation select-none group"},g&&Pc.createElement("div",{className:"w-5 h-5 sm:w-7 sm:h-7 shrink-0 rounded sm:rounded-md overflow-hidden bg-neutral-800 ring-1 ring-neutral-700/40"},Pc.createElement("img",{src:kt(`/content/${g}`),alt:"",className:"w-full h-full object-cover",loading:"lazy",onError:e=>{e.target.style.display="none"}})),Pc.createElement("span",{className:"text-xs sm:text-sm font-semibold text-neutral-100 truncate group-hover:text-white transition-colors"},f),Pc.createElement("div",{className:"hidden sm:flex items-center gap-1.5 shrink-0"},Pc.createElement("span",{className:"px-2 py-0.5 text-[11px] font-semibold tabular-nums rounded-md bg-neutral-800/60 text-neutral-300 ring-1 ring-neutral-700/40"},t," listed"),h&&Pc.createElement("span",{className:"px-2 py-0.5 text-[11px] font-semibold tabular-nums rounded-md bg-neutral-800/60 text-amber-300/90 ring-1 ring-amber-500/15"},"\u230a ",ON(n))),i&&Pc.createElement("span",{className:"w-2 h-2 rounded-full bg-purple-400 shrink-0 shadow-[0_0_6px_rgba(168,85,247,0.4)]",title:"Subscribed"}),Pc.createElement("svg",{className:"w-3 h-3 sm:w-3.5 sm:h-3.5 shrink-0 text-neutral-500 transition-transform duration-200 "+(d?"rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,title:"Show more details"},Pc.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"}))),Pc.createElement("div",{className:"flex items-center shrink-0"},"function"==typeof s&&Pc.createElement("button",{onClick:s,className:"h-7 sm:h-9 min-h-[32px] sm:min-h-[44px] px-2 sm:px-2.5 flex items-center gap-1 rounded-lg text-[10px] sm:text-[11px] font-semibold text-purple-300 hover:text-purple-100 hover:bg-purple-500/10 active:bg-purple-500/15 transition-colors touch-manipulation select-none",title:"Sell items from this collection"},Pc.createElement("svg",{className:"w-3 h-3 sm:w-3.5 sm:h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2},Pc.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})),"Sell"),Pc.createElement("button",{onClick:o,disabled:r,className:"w-7 h-7 sm:w-9 sm:h-9 min-h-[32px] min-w-[32px] sm:min-h-[44px] sm:min-w-[44px] grid place-items-center rounded-lg text-neutral-500 hover:text-neutral-200 active:text-neutral-200 transition-colors disabled:opacity-40 disabled:cursor-not-allowed touch-manipulation",title:"Refresh listings"},Pc.createElement("svg",{className:"w-3 h-3 sm:w-3.5 sm:h-3.5 "+(r?"animate-spin":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2},Pc.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"}))))),d&&Pc.createElement("div",{className:"border-t border-neutral-800/40 px-2 sm:px-4 py-2 sm:py-4"},Pc.createElement("div",{className:"flex items-start gap-2 sm:gap-3"},g&&Pc.createElement("div",{className:"w-10 h-10 sm:w-16 sm:h-16 shrink-0 rounded-md sm:rounded-lg overflow-hidden bg-neutral-800 ring-1 ring-neutral-700/40"},Pc.createElement("img",{src:kt(`/content/${g}`),alt:"",className:"w-full h-full object-cover",loading:"lazy",onError:e=>{e.target.style.display="none"}})),Pc.createElement("div",{className:"flex-1 min-w-0"},m&&Pc.createElement("p",{className:"text-[11px] sm:text-sm text-neutral-400 leading-snug sm:leading-relaxed line-clamp-2 sm:line-clamp-3"},m),Pc.createElement("div",{className:"mt-1.5 sm:mt-2 flex items-center gap-2 sm:gap-3 flex-wrap"},Pc.createElement("div",{className:"flex items-center gap-1"},Pc.createElement("span",{className:"text-xs sm:text-sm font-bold text-neutral-100 tabular-nums"},t),Pc.createElement("span",{className:"text-[9px] sm:text-[10px] text-neutral-500 uppercase tracking-wider"},"listed")),h&&Pc.createElement(Pc.Fragment,null,Pc.createElement("span",{className:"text-neutral-700"},"\xb7"),Pc.createElement("div",{className:"flex items-center gap-1"},Pc.createElement("span",{className:"text-xs sm:text-sm font-bold text-amber-300 tabular-nums"},ON(n)),Pc.createElement("span",{className:"text-[9px] sm:text-[10px] text-neutral-500 uppercase tracking-wider"},"floor"))),Pc.createElement("span",{className:"text-neutral-700"},"\xb7"),Pc.createElement("button",{onClick:l,className:"flex items-center gap-1 px-2 py-0.5 rounded-full text-[10px] sm:text-xs font-medium transition-colors touch-manipulation select-none "+(i?"bg-purple-500/15 text-purple-300 hover:bg-purple-500/25 ring-1 ring-purple-500/30":"bg-neutral-800/60 text-neutral-400 hover:text-neutral-200 hover:bg-neutral-700/60 ring-1 ring-neutral-700/40"),title:i?"Unsubscribe from this collection":"Subscribe to this collection"},i?Pc.createElement("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20"},Pc.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})):Pc.createElement("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2},Pc.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})),i?"Subscribed":"Subscribe"),Pc.createElement("span",{className:"text-neutral-700"},"\xb7"),Pc.createElement("button",{onClick:c,disabled:u,className:"flex items-center gap-1 px-2 py-0.5 rounded-full text-[10px] sm:text-xs font-medium bg-neutral-800/60 text-neutral-400 hover:text-red-300 hover:bg-red-500/10 ring-1 ring-neutral-700/40 hover:ring-red-500/20 transition-colors disabled:opacity-50 touch-manipulation select-none",title:"Clear cached listings for this collection"},Pc.createElement("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2},Pc.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})),u?"Clearing\u2026":"Clear")))))))}const RI="98a7813f3ada2888e447ea91df8a0178803096b1b3575e0699469fe9bc65cc69i0";function $I({selectedInscription:e,selectedParents:t=[],selectedParentsCount:r=0,selectedParentIds:i=[],priceSats:a,onPriceSatsChange:o,listingScriptAddress:s,onListingScriptAddressChange:l,markerValueSats:c,onMarkerValueSatsChange:u,dryRun:d=!1,onDryRunChange:p,onCreateListingTx:f,onCreateBulkListingTx:m,createDisabled:g=!1,multiListingDisabled:h=!1,sellerStatus:b,sellerError:y,bulkSellerStatus:x,bulkSellerError:w,bulkBundleJson:v,saleMinBlockHeight:S="",onSaleMinBlockHeightChange:E,onCreateMultiListingTx:N,multiSellerStatus:I="",multiSellerError:A="",multiListingResult:k=null,multiAssetPricing:T={},onMultiAssetPriceChange:C,onMultiUniformPriceChange:B,collectionAuthoritySlots:P=[],collectionAuthorityStatus:_="",collectionAuthorityError:O="",collectionAuthoritySlotId:L="",onCollectionAuthoritySlotIdChange:F,onLaunchCollection:M,onLaunchParcelManifest:R,previousManifest:$=null,previousManifestStatus:U="",previousManifestError:z="",onLoadPreviousManifest:D,revealTxid:H,onRevealTxidChange:W,onBuy:j,buyDisabled:V=!1,fundingNeeded:q=!1,onCreateFundingTx:X,fundingDisabled:K=!1,fundingStatus:G,fundingError:Y,buyStatus:J,buyError:Q,previewInscription:Z=null,manualSellerPsbt:ee="",manualSellerStatus:te="",manualSellerError:ne="",onCreateManualSellerOfferPsbt:re,manualBuyStatus:ie="",manualBuyError:ae="",onBuyFromSellerOfferPsbt:oe,manualBuyerFundedPsbt:se="",manualBuyerFundedStatus:le="",manualBuyerFundedError:ce="",onCreateBuyerFundedPsbtForSeller:ue,manualSellerCountersignStatus:de="",manualSellerCountersignError:pe="",onCountersignAndBroadcastFromBuyerFundedPsbt:fe,feeRate:me,onFeeRateChange:ge,walletInscriptions:he=[],walletAssetScanState:be=null,onRequestWalletRescan:ye,onOodlLayoutChange:xe,oodlSection:we,onOodlSectionChange:ve,isConnected:Se=!1,onConnect:Ee}){const[Ne,Ie]=Bc.useState("marketplace"),Ae=we||Ne,ke=ve||Ie,[Te,Ce]=Bc.useState("sell"),[Be,Pe]=Bc.useState("launch"),[_e,Oe]=Bc.useState(null),[Le,Fe]=Bc.useState(!1),Me=Pc.useRef(!1),[Re,$e]=Bc.useState(!1),Ue=Pc.useRef(!1),[ze,De]=Bc.useState(""),[He,We]=Bc.useState(!1),[je,Ve]=Bc.useState(!1),[qe,Xe]=Bc.useState(!1),Ke=Pc.useRef(null),[Ge,Ye]=Bc.useState(""),[Je,Qe]=Bc.useState(""),Ze=Pc.useRef(null),[et,tt]=Bc.useState(""),[nt,rt]=Bc.useState(""),[it,at]=Bc.useState(""),[ot,st]=Bc.useState([]),[lt,ct]=Bc.useState(!1),[ut,dt]=Bc.useState(null),[pt,ft]=Bc.useState("home"),[mt,gt]=Bc.useState([]),[ht,bt]=Bc.useState(null),[yt,xt]=Bc.useState({}),[wt,vt]=Bc.useState({}),[St,Et]=Bc.useState(""),[Nt,It]=Bc.useState("listingsDesc"),[At,Tt]=Bc.useState(!1),[Ct,Bt]=Bc.useState(null),[Pt,_t]=Bc.useState(!1),[Ot,Lt]=Bc.useState(!1),[Ft,Mt]=Bc.useState(72),[Rt,$t]=Pc.useState(12),[Ut,zt]=Bc.useState(null),[Dt,Wt]=Bc.useState(null),[jt,Vt]=Bc.useState(null),[qt,Xt]=Bc.useState(""),[Kt,Gt]=Bc.useState(null),[Yt,Qt]=Bc.useState(!1),[Zt,en]=Bc.useState(null),[nn,rn]=Bc.useState(""),[an,on]=Bc.useState({});Bc.useEffect(()=>{T&&"object"==typeof T&&Object.keys(T).length>0&&on(T)},[T]);const sn=Bc.useCallback((e,t)=>{on(n=>({...n,[e]:{...n[e]||{},priceBtc:String(t)}})),"function"==typeof C&&C(e,t)},[C]),ln=Bc.useCallback(e=>{const n=Array.isArray(t)?t:[],r={};for(const t of n){const n=t?.id||t?.inscriptionId||t?.inscription_id;n&&(r[n]={priceBtc:String(e)})}on(r),"function"==typeof B&&B(e)},[t,B]),cn=(()=>{if(!Se)return"";try{const e="undefined"!=typeof window&&window.NexusWalletConnect?.getState?.()?window.NexusWalletConnect.getState():null;return String(e?.walletType||e?.provider?.walletType||e?.provider?.name||e?.provider?.id||"").toLowerCase()}catch{return""}})().includes("phantom");Bc.useEffect(()=>{let e=!0;const t=async()=>{try{rn("");const{fetchBlockHeightViaProxy:t}=await n(async()=>{const{fetchBlockHeightViaProxy:e}=await Promise.resolve().then(()=>Ei);return{fetchBlockHeightViaProxy:e}},__VITE_PRELOAD__),r="undefined"!=typeof window&&window.__NEXUS_NETWORK__||"mainnet",i=await t(r);if(!e)return;Number.isFinite(Number(i))&&Number(i)>=0&&en(Math.floor(Number(i)))}catch(Pk){if(!e)return;rn(Pk?.message||String(Pk))}};if("marketplace"!==Ae&&("sell"===Te||"collection"===Te)){t();const n=setInterval(t,6e4);return()=>{e=!1,clearInterval(n)}}return t(),()=>{e=!1}},[Ae,Te]),Bc.useEffect(()=>{if(null!=me)return;if("function"!=typeof ge)return;let e=!0;return(async()=>{try{const{fetchFeeRatesFromOrdinals:t}=await n(async()=>{const{fetchFeeRatesFromOrdinals:e}=await Promise.resolve().then(()=>hr);return{fetchFeeRatesFromOrdinals:e}},__VITE_PRELOAD__),r=await t({timeoutMs:8e3});if(!e)return;const i=r?.medium??r?.slow??r?.fast??null;null!==i&&Number.isFinite(i)&&i>0&&ge(i)}catch(Pk){}})(),()=>{e=!1}},[me,ge]);const un=Pc.useRef(null),dn=Pc.useRef(null),pn=Pc.useRef([]),[fn,gn]=Bc.useState(-1),hn=Pc.useRef(null),bn=Pc.useCallback(e=>{const t=pn.current;Array.isArray(t)&&0!==t.length&&gn(n=>{const r=n+e;if(r<0||r>=t.length)return n;const i=t[r];if(!i)return n;const a=(()=>{const e=Number(i?.price);return!Number.isFinite(e)||e<=0?null:Math.trunc(e)})(),o=String(i?.sellerOfferPsbt||"").trim(),s=String(i?.inscriptionId||"").trim();if(zt(a),Wt(i?.inscription||null),Vt(i?.collection||null),o)Xt(""),De(o),We(!0),ke("offer"),Ce("buy");else{const e=s||i?.revealTxid;W&&e&&W(e),Xt(e?String(e):""),De(""),We(!1),ke("oodl"),Ce("buy")}return r})},[W]),[yn,xn]=Bc.useState(null),[wn,vn]=Bc.useState(null),[Sn,En]=Bc.useState(null);Bc.useEffect(()=>{vn(null),En(null)},[yn]),Bc.useEffect(()=>{Lt(!1),Mt(72)},[pt,Ct?.key]),Bc.useEffect(()=>{Mt(72)},[Ot]);const[Nn,In]=Bc.useState(null),[kn,Tn]=Bc.useState(""),[Cn,Bn]=Bc.useState(""),[Pn,_n]=Bc.useState({status:"idle",message:""}),[On,Ln]=Bc.useState(""),[Fn,Mn]=Bc.useState(""),Rn=Pc.useCallback(e=>{const t=String(e??"").trim();if(!t)return null;const n=Number(t);if(!Number.isFinite(n))return null;const r=Math.floor(n);return r<0?null:r},[]),$n=String(kn||"").trim()||null,Un=Pc.useMemo(()=>$n&&(Array.isArray(mt)?mt:[]).find(e=>String(e?.key||"").trim()===$n)||null,[mt,$n]),zn=gs?.enabled?Ss($n&&"uncategorized"!==$n?$n:null)||vs():null,Dn=gs?.enabled&&$n&&"uncategorized"!==$n?Ss($n):null;!gs?.enabled||$n&&"uncategorized"!==$n&&Ss($n);const Hn=Pc.useRef({inflight:new Map,done:new Map}),Wn=Pc.useRef({inflight:new Map,done:new Map}),jn=Number.POSITIVE_INFINITY,Vn="oodl:subscribed-collections",qn="oodl:auto-sub-dismissed",Xn=e=>`oodl:listings:${String(e||"home")}`,Kn=(e,t)=>`oodl:listing-meta:${String(e||"mainnet")}:${String(t||"")}`,Gn=e=>{const t=String(e||"home").trim()||"home",n="home"===t||"__home"===t;return{page:t,idbPageKey:n?"home":t,cacheKey:n?"__home":t,isCatchAll:n}},Yn=Pc.useMemo(()=>["bitmap","parcel"],[]),[Jn,Qn]=Bc.useState([]),Zn=Pc.useMemo(()=>new Set(Jn),[Jn]),[er,tr]=Bc.useState(!1),nr="oodl:subscribe-prompt-dismissed",[rr,ir]=Bc.useState(null),ar=Pc.useRef(new Set);Bc.useEffect(()=>{(async()=>{try{const e=await ui(nr,{maxAgeMs:Number.POSITIVE_INFINITY});Array.isArray(e)&&(ar.current=new Set(e.map(e=>String(e||"").trim().toLowerCase()).filter(Boolean)))}catch{}})()},[]),Bc.useEffect(()=>{let e=!0;return(async()=>{try{const[t,n]=await Promise.all([ui(Vn,{maxAgeMs:Number.POSITIVE_INFINITY}),ui(qn,{maxAgeMs:Number.POSITIVE_INFINITY})]);if(!e)return;const r=Array.isArray(t)?t.map(e=>String(e||"").trim()).filter(Boolean):[],i=Array.from(new Set(r.map(e=>e.toLowerCase()))),a=new Set(Array.isArray(n)?n.map(e=>String(e||"").trim().toLowerCase()).filter(Boolean):[]),o=Yn.filter(e=>!i.includes(e)&&!a.has(e));if(o.length>0){const e=[...i,...o];try{li(Vn,e)}catch{}Qn(e)}else Qn(i)}catch{if(!e)return;try{li(Vn,Yn)}catch{}Qn([...Yn])}})(),()=>{e=!1}},[Yn]),Bc.useEffect(()=>{let e=!0;const t=e=>{const t=String(e||"").trim().toLowerCase();if(!t)return null;const n=(Array.isArray(mt)?mt:[]).find(e=>String(e?.key||"").trim().toLowerCase()===t)||null;return String(n?.key||t).trim()||null};return(async()=>{try{if("marketplace"!==Ae)return;const n=Array.isArray(Jn)?Jn:[];if(0===n.length)return;const r={},i=Math.min(n.length,12);for(let e=0;e<i;e++){const i=n[e],a=t(i);if(!a)continue;const{idbPageKey:o,cacheKey:s}=Gn(a);if(!(Array.isArray(yt?.[s])&&yt[s].length>0))try{const e=await ui(Xn(o),{maxAgeMs:Number.POSITIVE_INFINITY});Array.isArray(e)&&e.length>0&&(r[s]=e)}catch{}}if(!e)return;if(Object.keys(r).length>0){xt(e=>({...e||{},...r}));const e=String(pt||"").trim(),{cacheKey:t}=Gn(e),n=r[t];if(Array.isArray(n)&&n.length>0){const t=String(e||"").trim().toLowerCase();Zn.has(t)&&0===(Array.isArray(ot)?ot:[]).length&&st(n)}}}catch{}})(),()=>{e=!1}},[Ae,Jn,mt,pt]);const or=Pc.useCallback(e=>{const t=String(e||"").trim().toLowerCase();t&&(Qn(e=>{if(e.includes(t))return e;const n=[...e,t];try{li(Vn,n)}catch{}return n}),Yn.includes(t)&&(async()=>{try{const e=await ui(qn,{maxAgeMs:Number.POSITIVE_INFINITY}),n=Array.isArray(e)?e.map(e=>String(e||"").trim().toLowerCase()).filter(Boolean):[];n.includes(t)&&li(qn,n.filter(e=>e!==t))}catch{}})())},[Yn]),sr=Pc.useCallback(e=>{const t=String(e||"").trim().toLowerCase();t&&(Qn(e=>{if(!e.includes(t))return e;const n=e.filter(e=>e!==t);try{li(Vn,n)}catch{}return n}),Yn.includes(t)&&(async()=>{try{const e=await ui(qn,{maxAgeMs:Number.POSITIVE_INFINITY}),n=Array.isArray(e)?e.map(e=>String(e||"").trim().toLowerCase()).filter(Boolean):[];n.includes(t)||li(qn,[...n,t])}catch{try{li(qn,[t])}catch{}}})())},[Yn]),lr=e=>{const t=String(e||"").trim().toLowerCase();return Zn.has(t)?jn:12e4},cr=e=>"bitmap"===String(e||"").trim().toLowerCase(),ur=e=>{const t=String(e||"").trim().toLowerCase();return"parcel"===t||"parcels"===t},dr=Pc.useMemo(()=>{const e=Array.isArray(mt)?mt:[],t=[{key:"uncategorized",name:"Uncategorized",description:"No collection / no category",catalogImage:{inscriptionId:RI,contentType:"image/avif"}}];e.some(e=>cr(e?.key))||t.push({key:"bitmap",name:"Bitmaps",description:"Verified bitmap inscriptions",match:{bitmapOci:!0}}),e.some(e=>ur(e?.key))||t.push({key:"parcel",name:"Bitmap Parcels",description:"Parcel inscriptions ({parcel}.{bitmap}.bitmap)"});const n=[...e,...t],r=new Map;for(const i of n){const e=String(i?.key||"").trim();e&&(r.has(e)||r.set(e,i))}return Array.from(r.values()).sort((e,t)=>String(e?.name||e?.key).localeCompare(String(t?.name||t?.key)))},[mt]),pr=Pc.useMemo(()=>{const e=String(Cn||"").trim().toLowerCase(),t=Array.isArray(dr)?dr:[];return e?t.filter(t=>{const n=String(t?.name||"").toLowerCase(),r=String(t?.key||"").toLowerCase(),i=String(t?.description||"").toLowerCase();return n.includes(e)||r.includes(e)||i.includes(e)}):t},[dr,Cn]),fr=e?.id||e?.inscriptionId||e?.inscription_id||"",mr=e?.number||e?.inscriptionNumber||e?.inscription_number,gr="offer"===Ae,br="oodl"===Ae,yr="marketplace"===Ae,xr="hub"===Ae,wr=cn&&(xr||br||gr),vr=Pc.useRef(0);Pc.useEffect(()=>{if(!br&&!gr||"buy"!==Te)return;const e=e=>{const t=(e.target?.tagName||"").toLowerCase();"input"!==t&&"textarea"!==t&&"select"!==t&&("ArrowLeft"===e.key?(e.preventDefault(),bn(-1)):"ArrowRight"===e.key&&(e.preventDefault(),bn(1)))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[br,gr,Te,bn]);const Sr=Pc.useMemo(()=>{const e=Number(jt?.bitmapNumber);return Number.isFinite(e)?Math.floor(e):null},[jt]),Er=jt?.bitmon?.pattern||null,Nr=Pc.useMemo(()=>{const e=String(jt?.type||"").trim().toLowerCase();return"bitmap"===String(jt?.key||"").trim().toLowerCase()||"bitmap"===e&&!0===jt?.verified||"bitmap"===e&&null!==Sr},[jt,Sr]),Ir=Pc.useMemo(()=>{const e=String(jt?.type||"").trim().toLowerCase(),t=String(jt?.key||"").trim().toLowerCase(),n="parcel"===t||"parcels"===t||"parcel"===e,r=Number(jt?.bitmapNumber),i=Number(jt?.parcelNumber);return{isParcel:n,bitmapNumber:Number.isFinite(r)?Math.trunc(r):null,parcelNumber:Number.isFinite(i)?Math.trunc(i):null}},[jt]),[Ar,kr]=Bc.useState({status:"idle",result:null,error:null});Bc.useEffect(()=>{let e=!0;return(async()=>{if(!Ir.isParcel)return void(e&&kr({status:"idle",result:null,error:null}));const t=(Dt?.id||Dt?.inscriptionId||Dt?.inscription_id||qt||H||"").toString().trim();if(t){e&&kr({status:"validating",result:null,error:null});try{const{detectAndVerifyParcelByInscriptionId:r}=await n(async()=>{const{detectAndVerifyParcelByInscriptionId:e}=await Promise.resolve().then(()=>qs);return{detectAndVerifyParcelByInscriptionId:e}},__VITE_PRELOAD__),i=await r(String(t));if(!e)return;if(!i||"parcel"!==i.type||!i.verified)return void kr({status:"invalid",result:i||null,error:"Not a verified parcel inscription."});const a=Number(i?.bitmapNumber),o=Number(i?.parcelNumber);if(null!==Ir.bitmapNumber&&Number.isFinite(a)&&Math.trunc(a)!==Ir.bitmapNumber)return void kr({status:"invalid",result:i,error:`Bitmap mismatch (expected ${Ir.bitmapNumber}, verified ${Math.trunc(a)}).`});if(null!==Ir.parcelNumber&&Number.isFinite(o)&&Math.trunc(o)!==Ir.parcelNumber)return void kr({status:"invalid",result:i,error:`Parcel mismatch (expected ${Ir.parcelNumber}, verified ${Math.trunc(o)}).`});kr({status:"valid",result:i,error:null})}catch(_k){if(!e)return;kr({status:"invalid",result:null,error:String(_k?.message||_k||"Parcel verification failed")})}}else e&&kr({status:"invalid",result:null,error:"Missing inscription id."})})(),()=>{e=!1}},[Ir.isParcel,Ir.bitmapNumber,Ir.parcelNumber,Dt,qt,H]);const Tr=Pc.useRef(Ae);async function Cr({forceRefresh:e=!1,page:t=null,collection:r=null}={}){const i=++vr.current;ct(!0),dt(null);const a=Array.isArray(ot)?ot:[];if(e)try{Wn.current?.done?.clear?.()}catch{}try{const o=t||pt,s=cr(o),l=ur(o),c="__home"===String(o||"")||"home"===String(o||"");let u=null;const d=r||(o&&"home"!==o&&String(Ct?.key||"")===String(o)?Ct:null)||o&&"home"!==o&&"__home"!==o&&mt.find(e=>e?.key===o)||null;if(u=c?gs?.fundingAddress||null:d?.indexingAddress||null,!u&&s&&(u=hs?.bitmap?.address||null),!u&&l&&(u=hs?.parcel?.address||null),!(u||c||s||l))throw new Error(`Missing indexing address for collection "${String(o)}"`);const p=(e,t,n)=>{const r=Number(t),i=Number.isFinite(r)&&r>0?Math.trunc(r):25e3;return Promise.race([Promise.resolve(e),new Promise((e,t)=>{setTimeout(()=>t(new Error(`${n||"Operation"} timed out`)),i)})])},f=await p(Ul({address:u||void 0,forceRefresh:e}),25e3,"Marketplace indexing"),m=async e=>{const t=Array.isArray(e)?e:[];if(0===t.length)return[];try{const{loadBitcoinLibFromInscription:e}=await n(async()=>{const{loadBitcoinLibFromInscription:e}=await Promise.resolve().then(()=>An);return{loadBitcoinLibFromInscription:e}},__VITE_PRELOAD__),{getPsbtInputOutpoint:r}=await n(async()=>{const{getPsbtInputOutpoint:e}=await Promise.resolve().then(()=>cs);return{getPsbtInputOutpoint:e}},__VITE_PRELOAD__),{getInscriptionOutpoint:i}=await n(async()=>{const{getInscriptionOutpoint:e}=await Promise.resolve().then(()=>Jt);return{getInscriptionOutpoint:e}},__VITE_PRELOAD__),a=await e(),o=e=>{const t=String(e||"").trim();if(!t)return null;try{return a.Psbt.fromBase64(t)}catch{return a.Psbt.fromHex(t)}},s=async e=>{const t=String(e?.inscriptionId||"").trim(),n=String(e?.sellerOfferPsbt||"").trim();if(!t||!n)return null;const a=o(n);if(!a)return e;const s=r(a,2);if(!s)return e;let l=null;try{l=await i(t)}catch{l=null}return l&&s.toLowerCase()!==String(l).toLowerCase()?null:{...e||{},inscriptionOutpoint:l||e?.inscriptionOutpoint||null,offerOutpoint:s}},l=[],c=6;for(let n=0;n<t.length;n+=c){const e=t.slice(n,n+c),r=await Promise.all(e.map(s));l.push(...r.filter(Boolean))}return l}catch{return t}},g=(e,t)=>{const n=Array.isArray(e)?e:[],r=Array.isArray(t)?t:[];if(0===r.length)return n;const i=new Map;for(const a of n){const e=String(a?.inscriptionId||"").trim();e&&i.set(e,a)}for(const a of r){const e=String(a?.inscriptionId||"").trim();e&&(i.has(e)||i.set(e,a))}return Array.from(i.values())},h=async()=>{try{if(!ur(o)||"home"===o)return[];const{discoverParcelManifestRegistrations:e}=await n(async()=>{const{discoverParcelManifestRegistrations:e}=await Promise.resolve().then(()=>Bk);return{discoverParcelManifestRegistrations:e}},__VITE_PRELOAD__),{detectAndVerifyParcelByInscriptionId:t}=await n(async()=>{const{detectAndVerifyParcelByInscriptionId:e}=await Promise.resolve().then(()=>qs);return{detectAndVerifyParcelByInscriptionId:e}},__VITE_PRELOAD__),r=await e({limit:120});if(!Array.isArray(r)||0===r.length)return[];const i=new Map;for(const n of r){const e=n?.bitmapNumber,t=String(n?.manifestoInscriptionId||"").trim().toLowerCase();if(!/^[0-9a-f]{64}i\d+$/.test(t))continue;const r=null!=e&&Number.isFinite(Number(e))&&Number(e)>=0?`bn:${Math.trunc(Number(e))}`:`tx:${String(n?.txid||t)}`,a=i.get(r);a?Number(n?.blockTimeMs||0)>Number(a?.blockTimeMs||0)&&i.set(r,n):i.set(r,n)}const a=async(e,{accept:t}={})=>{const r=(Array.isArray(e)?e:[e]).map(e=>String(e||"").trim()).filter(e=>/^[0-9a-f]{64}i\d+$/i.test(e));if(0===r.length)return null;const i="function"==typeof t?t:null;for(const a of r){let e=null;try{const t=kt(`/content/${a}`),n=await fetch(t);if(!n.ok)continue;e=new Uint8Array(await n.arrayBuffer())}catch{e=null}if(!e)continue;const t=e=>{if(!e)return null;let t="";try{t=new TextDecoder("utf-8",{fatal:!1}).decode(e)}catch{try{t=Buffer.from(e).toString("utf8")}catch{t=""}}const n=String(t||"").trim();if(!n)return null;try{return JSON.parse(n)}catch{return null}};let r=t(e);if(!r)try{const{brotliDecompressBytes:i}=await n(async()=>{const{brotliDecompressBytes:e}=await Promise.resolve().then(()=>Oi);return{brotliDecompressBytes:e}},__VITE_PRELOAD__);r=t(await i(e))}catch{}if("string"==typeof r)try{r=JSON.parse(String(r))}catch{}const o=r&&"object"==typeof r?{...r,__inscriptionId:a}:null;if(o&&(!i||i(o)))return o}return null},s=Array.from(i.values()),l=[],c=3;for(let n=0;n<s.length;n+=c){const e=s.slice(n,n+c),r=await Promise.all(e.map(async e=>{const t=String(e?.manifestoInscriptionId||"").trim(),n=String(e?.txid||"").trim().toLowerCase(),r=(()=>{const e=[];t&&e.push(t),/^[0-9a-f]{64}$/.test(n)&&(e.push(`${n}i0`),e.push(`${n}i1`),e.push(`${n}i2`));const r=new Set;return e.filter(e=>{const t=String(e).toLowerCase();return!r.has(t)&&(r.add(t),!0)})})();return{r:e,manifest:await a(r,{accept:e=>{const t=String(e?.p||"").trim();return"Bitmap Parcel"===t||"NXS-PARCEL-MANIFEST"===t||"NXS Parcel Manifest"===t}})}}));for(const{r:n,manifest:i}of r){if(!i)continue;const e=String(i?.p||"").trim();if("Bitmap Parcel"!==e&&"NXS-PARCEL-MANIFEST"!==e&&"NXS Parcel Manifest"!==e)continue;const r=(()=>{const e=Number(i?.bitmap);if(Number.isFinite(e)&&e>=0)return Math.trunc(e);const t=Number(n?.bitmapNumber);return Number.isFinite(t)&&t>=0?Math.trunc(t):null})();if(null===r)continue;const a=Array.isArray(i?.open_store?.offers)?i.open_store.offers:[];if(0===a.length)continue;const o=(()=>{const e=Number(i?.open_store?.minBlockHeight??i?.open_store?.min_block_height);return Number.isFinite(e)&&e>=0?Math.trunc(e):null})(),s=(()=>{const e=Array.isArray(i?.items)?i.items:[];if(0===e.length)return null;const t=new Map;for(const n of e){const e=String(n?.inscription_id||n?.inscriptionId||"").trim().toLowerCase();e&&t.set(e,n)}return t})();for(const i of a){const e=String(i?.inscriptionId||i?.inscription_id||i?.id||"").trim(),a=String(i?.sellerOfferPsbt||i?.seller_offer_psbt||i?.psbt||"").trim(),c=Number(i?.priceSats??i?.price_sats??i?.price);if(!e||!a)continue;if(!Number.isFinite(c)||c<=0)continue;if(s){const t=s.get(String(e).toLowerCase());if(t&&!1===t.for_sale)continue}let u=null;try{u=await t(e)}catch{u=null}const d=Number(u?.parcelNumber),p=Number(u?.bitmapNumber);!Number.isFinite(d)||d<0||Number.isFinite(p)&&Math.trunc(p)===r&&l.push({inscriptionId:e,inscription:{id:e,inscriptionId:e},revealTxid:null,price:Math.trunc(c),...null!==o?{minBlockHeight:o}:{},listedAt:Number.isFinite(Number(n?.blockTimeMs))?Number(n.blockTimeMs):Date.now(),status:"active",sellerOfferPsbt:a,source:"parcel-manifest",collection:{key:"parcel",bitmapNumber:r,parcelNumber:Math.trunc(d),manifestInscriptionId:String(n?.manifestoInscriptionId||"").trim()||void 0}})}}}return l}catch{return[]}},b=!c&&d?(e=>{const t=e?.manifest&&"object"==typeof e.manifest?e.manifest:null,n=Array.isArray(t?.open_store?.offers)?t.open_store.offers:[];if(!n||0===n.length)return[];const r=(()=>{const e=Number(t?.open_store?.minBlockHeight??t?.open_store?.min_block_height);return Number.isFinite(e)&&e>=0?Math.trunc(e):null})();return n.map(t=>{const n=String(t?.inscriptionId||t?.inscription_id||t?.id||"").trim(),i=String(t?.sellerOfferPsbt||t?.seller_offer_psbt||t?.psbt||"").trim(),a=Number(t&&(t.priceSats??t.price_sats??t.price));return n&&i?!Number.isFinite(a)||a<=0?null:{inscriptionId:n,inscription:{id:n,inscriptionId:n},revealTxid:null,price:a,...null!==r?{minBlockHeight:r}:{},listedAt:Date.now(),status:"active",sellerOfferPsbt:i,source:"collection-manifest",collection:e||null}:null}).filter(Boolean)})(d):[],y=await m(b),x=await h(),w=await m(x),v=g(g(f,y),w),S=s?(Array.isArray(v)?v:[]).map(e=>{const t=e?.collection&&"object"==typeof e.collection?e.collection:{};return"bitmap"===String(t?.key||"").trim().toLowerCase()?e:{...e,collection:{...t,key:"bitmap"}}}):v,E=(()=>{const e=Array.isArray(S)?S:[];return s?e.filter(e=>"bitmap"===String(e?.collection?.key||"").trim().toLowerCase()):l?e.filter(e=>"parcel"===String(e?.collection?.key||"").trim().toLowerCase()):e})(),N=Array.isArray(E)?E:[],I=(()=>{if(0===a.length)return N;const e=new Map;for(const t of a){const n=String(t?.inscriptionId||"").trim(),r=Number(t?.price);n&&Number.isFinite(r)&&r>0&&e.set(n,t)}return 0===e.size?N:N.map(t=>{const n=String(t?.inscriptionId||"").trim();if(!n)return t;const r=Number(t?.price);if(Number.isFinite(r)&&r>0)return t;const i=e.get(n);if(!i)return t;const a={...t};return a.price=i.price,i.priceAsOf&&(a.priceAsOf=i.priceAsOf),void 0!==i.minBlockHeight&&void 0===a.minBlockHeight&&(a.minBlockHeight=i.minBlockHeight),null!==i.bitmapNumberHint&&null===a.bitmapNumberHint&&(a.bitmapNumberHint=i.bitmapNumberHint),null!==i.parcelNumberHint&&null===a.parcelNumberHint&&(a.parcelNumberHint=i.parcelNumberHint),a})})();i===vr.current&&st(I);try{const{idbPageKey:e}=Gn(o);await li(Xn(e),I)}catch{}const{cacheKey:A}=Gn(o);i===vr.current&&xt(e=>({...e||{},[A]:I}))}catch(tn){i===vr.current&&dt(tn.message||"Failed to load marketplace")}finally{i===vr.current&&ct(!1)}}Pc.useEffect(()=>{if("marketplace"===Ae&&"marketplace"!==Tr.current){const e=dn.current;if(e){dn.current=null;const t=String(e?.marketplacePage||"home"),n=e?.selectedMarketplaceCollection||null,r=null==e?.parcelMarketplaceBitmapNumber?null:e.parcelMarketplaceBitmapNumber;Bt(n),ft(t),xn(r),st([]),(async()=>{try{const{idbPageKey:e,cacheKey:r}=Gn(t);if("home"===t){const e=yt?.[r];return void(Array.isArray(e)&&e.length>0?st(e):await Cr({forceRefresh:!1,page:"home"}))}const i=yt?.[r];if(Array.isArray(i)&&i.length>0)return st(i),void Cr({forceRefresh:!0,page:t,collection:n}).catch(()=>{});try{const i=await ui(Xn(e),{maxAgeMs:lr(t)});if(Array.isArray(i)&&i.length>0)return st(i),xt(e=>({...e||{},[r]:i})),void Cr({forceRefresh:!0,page:t,collection:n}).catch(()=>{})}catch{}await Cr({forceRefresh:!1,page:t,collection:n})}catch{}})()}else Bt(null),ft("home"),xn(null)}Tr.current=Ae},[Ae]),Bc.useEffect(()=>{let e=!0;return(async()=>{const t=fr;if(t)try{const{detectAndVerifyBitmapByInscriptionId:r}=await n(async()=>{const{detectAndVerifyBitmapByInscriptionId:e}=await Promise.resolve().then(()=>zs);return{detectAndVerifyBitmapByInscriptionId:e}},__VITE_PRELOAD__),i=await r(t);if("bitmap"===i?.type&&i?.verified)return void(e&&In(i));const{detectAndVerifyParcelByInscriptionId:a}=await n(async()=>{const{detectAndVerifyParcelByInscriptionId:e}=await Promise.resolve().then(()=>qs);return{detectAndVerifyParcelByInscriptionId:e}},__VITE_PRELOAD__),o=await a(t);if("parcel"===o?.type&&o?.verified)return void(e&&In(o));e&&In(null)}catch{e&&In(null)}else e&&In(null)})(),()=>{e=!1}},[fr]),Bc.useEffect(()=>{let e=!0;return(async()=>{const t=String(fr||"").trim(),r=String(kn||"").trim();if(t&&r)if("uncategorized"!==r){e&&_n({status:"validating",message:"Validating collection membership\u2026"});try{if(cr(r)){if("bitmap"!==Nn?.type||!Nn?.verified)throw new Error("This inscription is not OCI-verified as a bitmap.");return void(e&&_n({status:"valid",message:"Verified bitmap."}))}if(ur(r)){if("parcel"!==Nn?.type||!Nn?.verified){const{detectAndVerifyParcelByInscriptionId:e}=await n(async()=>{const{detectAndVerifyParcelByInscriptionId:e}=await Promise.resolve().then(()=>qs);return{detectAndVerifyParcelByInscriptionId:e}},__VITE_PRELOAD__),r=await e(t);if("parcel"!==r?.type||!r?.verified)throw new Error('This inscription is not parcel-verified (expected "{parcel}.{bitmap}.bitmap" under the correct bitmap parent).')}return void(e&&_n({status:"valid",message:"Verified parcel."}))}const i=dr.find(e=>String(e?.key||"").trim()===r)||null;if(!i)throw new Error("Selected collection not found. Refresh collections and try again.");const{matchCollectionForInscription:a}=await n(async()=>{const{matchCollectionForInscription:e}=await Promise.resolve().then(()=>Ol);return{matchCollectionForInscription:e}},__VITE_PRELOAD__);if(await a(t,[i])!==r)throw new Error("This inscription is not indexed / does not match the selected collection rules.");e&&_n({status:"valid",message:"Verified in selected collection."})}catch(Pk){if(!e)return;_n({status:"invalid",message:Pk?.message||String(Pk)})}}else e&&_n({status:"valid",message:"No collection selected."});else e&&_n({status:"idle",message:""})})(),()=>{e=!1}},[fr,kn,dr,Nn]),Bc.useEffect(()=>{const e="parcel"===String(kn||"").toLowerCase()&&Number(r||0)>1;e&&"sell"===Te&&!Me.current?Fe(!0):e||(Fe(!1),Me.current=!1)},[kn,r,Te]),Bc.useEffect(()=>{const e="bitmap"===String(kn||"").toLowerCase()&&Number(r||0)>1;e&&"sell"===Te&&!Ue.current?$e(!0):e||($e(!1),Ue.current=!1)},[kn,r,Te]),Bc.useEffect(()=>{gr&&"sell"===Te&&"uncategorized"!==String(kn||"").trim()&&Tn("uncategorized")},[gr,Te]),Bc.useEffect(()=>{if("function"!=typeof xe)return;const e=!yr&&!xr&&("sell"===Te||br&&"collection"===Te),t=br&&"collection"===Te;xe({showAdvancedOptions:e,isCollectionWizard:t,limitParentSelection:!(!e||br&&"sell"===Te),parentsLabel:e?"Inscriptions":"Parents",mobileDefaultPanel:e&&"sell"===Te?"options":null,mobileOptionsLabel:e?"Inscriptions":null,mobileEditorLabel:e&&"sell"===Te?gr?"Offer Setup":"Listing Setup":t?"List Setup":null})},[xe,yr,xr,br,gr,Te]),Bc.useEffect(()=>{ur(Ct?.key||pt)||null===yn||xn(null)},[pt,Ct?.key]),Bc.useEffect(()=>{Xe(!1)},[gr,ze,Te]),Bc.useEffect(()=>{He&&Ve(!1)},[He]),Bc.useEffect(()=>{!String(H||"").trim()&&String(qt||"").trim()&&Xt("")},[H,qt]),Bc.useEffect(()=>{let e=!0;return(async()=>{let t=!1;try{const n=await ui("oodl:collections:dynamic",{maxAgeMs:864e5});e&&Array.isArray(n)&&n.length>0&&(t=!0,gt(n),xs(n))}catch{}try{const t=await Pl({forceRefresh:!1});if(!e)return;const n=Array.isArray(t?.collections)?t.collections:[];gt(n),xs(n),Array.isArray(n)&&n.length>0&&li("oodl:collections:dynamic",n).catch(()=>{})}catch(_k){if(!e)return;t||gt([]),bt(_k?.message||String(_k))}const n=Dl();if(e&&Array.isArray(n)&&n.length>0)st(n);else try{const t=await ui(Xn("home"),{maxAgeMs:lr("home")});e&&Array.isArray(t)&&t.length>0&&st(t)}catch{}await Cr({forceRefresh:!1,page:"home"})})(),()=>{e=!1}},[]),Bc.useEffect(()=>{let e=!1;const t=cr(Ct?.key||pt);if(!t)return;AN({forceRefresh:!1}).catch(()=>{});const n=Array.isArray(ot)?ot:[];if(0===n.length)return;const r=n.map(e=>({inscriptionId:e?.inscriptionId,collection:e?.collection})).filter(e=>{const t=String(e.inscriptionId||"").trim();if(!t)return!1;const n=Number(e?.collection?.bitmapNumber);return!Number.isFinite(n)&&!Hn.current.done.has(t)}).map(e=>String(e.inscriptionId).trim());if(0===r.length)return;const i=async e=>{const t=String(e||"").trim();if(!t)return null;const n=Hn.current.done.get(t);if(n)return n;const r=Hn.current.inflight.get(t);if(r)return await r;const i=(async()=>{try{const e=await Us(t);if(e&&Number.isFinite(Number(e?.bitmapNumber))){const t=await async function(e){const t=Number(e);if(!Number.isFinite(t)||t<0)return{isBitmon:!1,pattern:null,key:null};try{const e=await AN({forceRefresh:!1}),n=e?.patternArray,r=e?.patternObject;if(!Array.isArray(n)||!r)return{isBitmon:!1,pattern:null,key:null};const i=n[t];if(null==i)return{isBitmon:!1,pattern:null,key:null};if(!i)return{isBitmon:!1,pattern:null,key:String(i)};const a=r[i]||r[String(i)]||null;return a&&"string"==typeof a?{isBitmon:!0,pattern:a,key:String(i)}:{isBitmon:!1,pattern:null,key:String(i)}}catch{return{isBitmon:!1,pattern:null,key:null}}}(e.bitmapNumber);return{...e,bitmon:t}}return e||null}catch{return null}})();Hn.current.inflight.set(t,i);const a=await i;return Hn.current.inflight.delete(t),a&&Hn.current.done.set(t,a),a};return(async()=>{let n=0;const a=Array.from({length:Math.min(8,r.length)}).map(async()=>{for(;!e;){const a=n++;if(a>=r.length)return;const o=r[a],s=await i(o);!e&&s&&(st(e=>{const n=Array.isArray(e)?e:[];let r=!1;const i=n.map(e=>{if(!e||e.inscriptionId!==o)return e;const t=Number(e?.collection?.bitmapNumber);return Number.isFinite(t)?e:(r=!0,{...e,collection:{...s,key:"bitmap"}})});if(r&&t){const e=String(pt||"");if(e)try{li(Xn(e),i)}catch{}}return r?i:e}),xt(e=>{const t=e||{},n=String(pt),r=Array.isArray(t?.[n])?t[n]:null;if(!r)return e;let i=!1;const a=r.map(e=>{if(!e||e.inscriptionId!==o)return e;const t=Number(e?.collection?.bitmapNumber);return Number.isFinite(t)?e:(i=!0,{...e,collection:{...s,key:"bitmap"}})});return i?{...t,[n]:a}:e}))}});await Promise.all(a)})(),()=>{e=!0}},[pt,Ct?.key,ot]);const Br=()=>Pc.createElement("div",{className:"flex items-center gap-2"},Pc.createElement("div",{className:"text-xs sm:text-[11px] text-neutral-500"},"Fee rate"),Pc.createElement("input",{type:"number",min:0,step:.1,value:null==me?"":me,onChange:e=>ge?.(e.target.value),disabled:"function"!=typeof ge,className:"w-28 sm:w-24 px-2.5 sm:px-2 py-2 sm:py-1 text-sm sm:text-xs bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-sky-500/60 focus:ring-1 focus:ring-sky-500/20 font-mono disabled:opacity-60 disabled:cursor-not-allowed",placeholder:"sat/vB",title:"Network fee rate (sat/vB)"}),Pc.createElement("div",{className:"text-xs sm:text-[11px] text-neutral-500"},"sat/vB")),Pr=e=>{const t=Number(e);return!Number.isFinite(t)||t<=0?"Price TBD":`${ON(Math.trunc(t))} BTC`},_r=e=>{const t=String(e?.revealTxid||"").trim().toLowerCase();if(!/^[0-9a-f]{64}$/.test(t))return!1;const n=(e=>{const t=e?.output||e?.satpoint||e?.location;if(!t||"string"!=typeof t)return null;const n=t.split(":");if(n.length<2)return null;const r=n[0],i=n[1];if(!/^[0-9a-f]{64}$/i.test(r))return null;const a=Number(i);return!Number.isFinite(a)||a<0?null:`${String(r).toLowerCase()}:${Math.floor(a)}`})(e?.inscription);if(!n)return!1;const r=Number(e?.revealOutputIndex);if(Number.isFinite(r)&&r>=0){const e=`${t}:${Math.floor(r)}`;return String(n).toLowerCase()!==String(e).toLowerCase()}const i=String(n).split(":")[0];return!(!i||i===t)},Or=Pc.useMemo(()=>{const e=Array.isArray(mt)?mt:[],t=e.filter(e=>!!String(e?.indexingAddress||"").trim()),n=t.some(e=>"bitmap"===String(e?.key||"").trim().toLowerCase()),r=t.some(e=>"parcel"===String(e?.key||"").trim().toLowerCase()),i=Il("bitmap")||String(e.find(e=>"bitmap"===String(e?.key||"").trim().toLowerCase())?.imageInscriptionId||"").trim()||null,a=Il("parcel")||String(e.find(e=>"parcel"===String(e?.key||"").trim().toLowerCase())?.imageInscriptionId||"").trim()||null,o=KN("bitmap")||{},s=KN("parcel")||{},l=[...n?[]:[{key:"bitmap",name:o.name||"Bitmaps",description:o.description||"OCI-verified bitmaps + Bitmon patterns",indexingAddress:hs?.bitmap?.address||null,catalogImage:o.catalogImage||null,imageInscriptionId:i||(o.catalogImage&&"object"==typeof o.catalogImage?o.catalogImage.inscriptionId:o.catalogImage)||null,filters:Array.isArray(o.filters)?o.filters:[],match:o.match||null,scripts:o.scripts||void 0,indexLinks:o.indexLinks||void 0,sort:o.sort??void 0,isBuiltIn:!0}],...r?[]:[{key:"parcel",name:s.name||"Bitmap Parcels",description:s.description||"Parcel listings by provenance address",indexingAddress:hs?.parcel?.address||null,catalogImage:s.catalogImage||null,imageInscriptionId:a||(s.catalogImage&&"object"==typeof s.catalogImage?s.catalogImage.inscriptionId:s.catalogImage)||null,filters:Array.isArray(s.filters)?s.filters:[],match:s.match||null,scripts:s.scripts||void 0,sort:s.sort??void 0,isBuiltIn:!0}]].filter(e=>!!e.indexingAddress),c={key:"__home",name:"Uncategorized",description:"Listings not in a collection",indexingAddress:gs?.fundingAddress||null,catalogImage:{inscriptionId:RI,contentType:"image/avif"},imageInscriptionId:RI},u=new Set(["oodl-auth","oodl_auth","oodlauth"]),d=new Map;for(const m of[c,...l,...t]){const e=m?.key?String(m.key):"";e&&(u.has(e.toLowerCase())||d.has(e)||d.set(e,m))}const p=c,f=Array.from(d.values()).filter(e=>"__home"!==String(e?.key||""));return f.sort((e,t)=>String(e?.name||e?.key||"").localeCompare(String(t?.name||t?.key||""))),[p,...f]},[mt]),Lr=e=>{let t=String(e||"").trim();if(!t)return"";try{if(/^psbt\s*[:=]/i.test(t)){const n=t.replace(/^psbt\s*[:=]\s*/i,"");n&&(e=n)}else if(/^https?:\/\//i.test(t)){const n=new URL(t),r=[n.searchParams.get("psbt"),n.searchParams.get("offer"),n.searchParams.get("sellerOfferPsbt"),n.searchParams.get("seller_offer_psbt")].filter(Boolean);r.length>0&&(e=decodeURIComponent(String(r[0])))}}catch{}if(t=String(e||"").trim(),!t)return"";const n=t.replace(/\s+/g,"");if(!n)return"";const r=n.match(/cHNidP[0-9A-Za-z+/=]+/);if(r&&r[0]&&r[0].length>=16)return r[0];const i=n.match(/70736274ff[0-9a-fA-F]+/);return i&&i[0]&&i[0].length>=16?i[0]:n},Fr=Pc.useCallback(e=>{const t=String(e||"").trim();if(!t)return"";const n=t.replace(/\s+/g,"");return n.length<=48?n:`${n.slice(0,24)}\u2026${n.slice(-16)}`},[]),Mr=Pc.useCallback(async(e,t="QR")=>{const n=await async function(e){const t=String(e??"").trim();if(!t)return{status:"empty"};const n=function(e){const t=String(e??"").trim();if(!t.startsWith(`${GN}:mp:${YN}:`))return null;const n=t.slice(`${GN}:mp:${YN}:`.length),r=n.indexOf(":");if(r<=0)return null;const i=n.slice(0,r),a=n.slice(r+1),o=a.indexOf(":");if(o<=0)return null;const s=a.slice(0,o),l=a.slice(o+1),[c,u]=s.split("/"),d=Number(c),p=Number(u);if(!Number.isFinite(d)||!Number.isFinite(p)||d<1||p<1||d>p)return null;const f=l.indexOf(":");if(f<=0)return null;const m=l.slice(0,f),g=l.slice(f+1);return g?"gz"!==m&&"raw"!==m?null:{id:i,index:d,total:p,enc:m,chunk:g}:null}(t);if(n)return{status:"part",part:n};for(const r of["gz","br"]){const e=`${GN}:${r}:${YN}:`;if(t.startsWith(e)){const n=nI(t.slice(e.length)),i=JN[r];if(!i)throw new Error(`Unsupported compression token: ${r}`);return{status:"complete",psbtText:eI(await aI(n,i))}}}return{status:"complete",psbtText:t}}(e);if("part"===n?.status){Ze.current||(Ze.current=function(){const e=new Map;return{reset(t){t?e.delete(t):e.clear()},async addPart(t){if(!t?.id)throw new Error("Missing multipart id");const n=((t,n,r)=>{const i=e.get(t);if(i)return i;const a={id:t,total:n,enc:r,chunks:new Array(n).fill(null)};return e.set(t,a),a})(t.id,t.total,t.enc);if(n.total!==t.total||n.enc!==t.enc)throw new Error("Mismatched multipart session");n.chunks[t.index-1]=String(t.chunk);const r=n.chunks.filter(Boolean).length,i=n.total;if(r<i)return{status:"partial",id:n.id,have:r,total:i,enc:n.enc};const a=n.chunks.join("");if(e.delete(n.id),"raw"===n.enc)return{status:"complete",psbtText:a};const o=JN[n.enc];if(!o)throw new Error(`Unsupported multipart encoding: ${n.enc}`);const s=nI(a);return{status:"complete",psbtText:eI(await aI(s,o))}}}}());const e=await Ze.current.addPart(n.part);if("partial"===e?.status)return void Ye(`Captured ${t} part ${e.have}/${e.total}. Scan the next part.`);const r=String(e?.psbtText||"").trim();if(!r)throw new Error("Multipart QR decoded but produced empty PSBT");return De(r),We(!1),Ve(!0),void Ye(`${t} decoded (multipart complete).`)}const r=String(n?.psbtText||"").trim();if(!r)throw new Error("QR did not contain PSBT text");De(r),We(!1),Ve(!0),Ye(`${t} decoded.`)},[]),Rr=Pc.useCallback(async e=>{if(e){Qe(""),Ye("Decoding QR\u2026");try{const t=await async function(e){if(!e)throw new Error("No image selected");if("undefined"==typeof window||!("BarcodeDetector"in window))throw new Error("QR scanning is not supported in this browser. Please paste the offer text manually.");const t=new window.BarcodeDetector({formats:["qr_code"]}),n=await createImageBitmap(e),r=await t.detect(n),i=r?.[0]?.rawValue;if(!i)throw new Error("No QR code found in image");return String(i)}(e);await Mr(t,"QR")}catch(Pk){Ye(""),Qe(Pk?.message||String(Pk))}}},[Mr]),$r=Pc.useRef(!1);Bc.useEffect(()=>{if(!gr||"buy"!==Te)return;const e=Lr(ze),t=String(e||"").trim();if(!t)return tt(""),rt(""),void($r.current&&(Wt(null),Vt(null),zt(null),$r.current=!1));let r=!1;rt(""),tt("Parsing offer\u2026");const i=setTimeout(()=>{(async()=>{try{const{loadBitcoinLibFromInscription:e}=await n(async()=>{const{loadBitcoinLibFromInscription:e}=await Promise.resolve().then(()=>An);return{loadBitcoinLibFromInscription:e}},__VITE_PRELOAD__),{getPsbtInputOutpoint:i}=await n(async()=>{const{getPsbtInputOutpoint:e}=await Promise.resolve().then(()=>cs);return{getPsbtInputOutpoint:e}},__VITE_PRELOAD__),a=await e(),o=(e=>{const t=String(e||"").trim();if(!t)return null;try{return a.Psbt.fromBase64(t)}catch{return a.Psbt.fromHex(t)}})(t);if(!o)throw new Error("Could not parse offer PSBT");const s=(()=>{for(const e of[2,0,1]){const t=i(o,e);if(t)return t}return null})();if(!s)throw new Error("Offer PSBT missing an inscription input outpoint");if(r)return;tt("Fetching asset\u2026");const l=await Ht(kt(`/r/utxo/${s}`));if(!l.ok)throw new Error(`Failed to fetch asset UTXO (status ${l.status})`);const c=await l.json(),u=Array.isArray(c?.inscriptions)?String(c.inscriptions[0]||"").trim():"";if(!/^[0-9a-f]{64}i\d+$/i.test(u))throw new Error("Offer PSBT outpoint did not resolve to an inscription");let d=null;try{const{getInscriptionDetails:e}=await n(async()=>{const{getInscriptionDetails:e}=await Promise.resolve().then(()=>Jt);return{getInscriptionDetails:e}},__VITE_PRELOAD__);d=await e(u)}catch{d=null}const p=(()=>{try{const e=2,t=2,n=BigInt(Math.trunc(Number(o?.txOutputs?.[1]?.value||0))),r=BigInt(Math.trunc(Number(o?.txOutputs?.[t]?.value||0))),i=BigInt(Math.trunc(Number(o?.data?.inputs?.[e]?.witnessUtxo?.value||0)));if(n<=0n||r<=0n||i<=0n)return null;const a=r-(i>n?i-n:0n);return a<=0n||a>BigInt(Number.MAX_SAFE_INTEGER)?null:Number(a)}catch{return null}})();if(r)return;Wt(e=>{const t={...e||{}};return t.id=u,t.inscriptionId=u,d&&"object"==typeof d&&(void 0===t.number&&(t.number=d.number),void 0===t.inscriptionNumber&&(t.inscriptionNumber=d.number),void 0===t.contentType&&(t.contentType=d.content_type||d.contentType)),t}),Vt(e=>e?.key?e:null),null!==p&&zt(p),$r.current=!0,tt("")}catch(Pk){if(r)return;tt(""),rt(Pk?.message||String(Pk))}})()},350);return()=>{r=!0,clearTimeout(i)}},[gr,Te,ze]);const Ur=Pc.useMemo(()=>{const e=String(St||"").trim().toLowerCase(),t=String(Nt||"name"),n=!!At,r=t=>{if(!e)return!0;const n=String(t?.name||"").toLowerCase(),r=String(t?.key||"").toLowerCase(),i=String(t?.description||"").toLowerCase();return n.includes(e)||r.includes(e)||i.includes(e)},i=e=>{const t=String(e?.key||"").trim(),n="parcel"===t.toLowerCase()?"Bitmap Parcels":String(e?.name||e?.key||"").trim(),r=e?.description?String(e.description):"",i="__home"===t,a=!!e?.isBuiltIn,o=(e=>{const t=String(e||"").trim();if(!t)return{known:!1,count:null,floorSats:null};if(!Object.prototype.hasOwnProperty.call(yt||{},t))return{known:!1,count:null,floorSats:null};const n=(Array.isArray(yt?.[t])?yt[t]:[]).filter(e=>!_r(e));let r=null;for(const i of n){const e=Number(i?.price);!Number.isFinite(e)||e<=0||(null===r||e<r)&&(r=e)}return{known:!0,count:n.length,floorSats:r}})(t),s=o.known?`${o.count} listed`+(null!==o.floorSats?` \u2022 Floor ${ON(o.floorSats)} BTC`:""):"",{thumbId:l,contentType:c}=(e=>{const t=e?.catalogImage;return{thumbId:"string"==typeof t?String(t).trim():t&&"object"==typeof t?String(t?.inscriptionId||t?.id||t?.inscription_id||"").trim():String(e?.imageInscriptionId||"").trim(),contentType:t&&"object"==typeof t?String(t?.contentType||t?.content_type||"").trim().toLowerCase():String(e?.manifest?.registry_entry?.catalogImage?.contentType||"").trim().toLowerCase()}})(e);return{key:t,title:n,description:r,isCatchAll:i,isBuiltIn:a,statsLine:s,thumbId:l,thumbContentType:c,fallbackImageInscriptionId:String(e?.imageInscriptionId||"").trim(),raw:e,__stats:o}},a=[];for(const s of Array.isArray(Or)?Or:[]){const e=i(s);r(e)&&(n&&e.__stats?.known&&0===e.__stats?.count||a.push(e))}const o=(e,t)=>String(e?.title||e?.key||"").localeCompare(String(t?.title||t?.key||""));return"listingsDesc"===t?a.sort((e,t)=>{const n=e?.__stats?.known?Number(e?.__stats?.count||0):-1,r=t?.__stats?.known?Number(t?.__stats?.count||0):-1;return r!==n?r-n:o(e,t)}):"floorAsc"===t?a.sort((e,t)=>{const n=e?.__stats?.known&&null!==e?.__stats?.floorSats?Number(e.__stats.floorSats):Number.POSITIVE_INFINITY,r=t?.__stats?.known&&null!==t?.__stats?.floorSats?Number(t.__stats.floorSats):Number.POSITIVE_INFINITY;return n!==r?n-r:o(e,t)}):a.sort(o),[...a.filter(e=>!!e.isCatchAll),...a.filter(e=>!e.isCatchAll&&!!e.isBuiltIn),...a.filter(e=>!e.isCatchAll&&!e.isBuiltIn)]},[Or,St,Nt,At,yt]);Pc.useEffect(()=>{$t(12);const e="undefined"!=typeof requestIdleCallback?requestIdleCallback(()=>$t(1/0)):setTimeout(()=>$t(1/0),60);return()=>{"undefined"!=typeof requestIdleCallback?cancelIdleCallback(e):clearTimeout(e)}},[Ur]);const zr=Pc.useCallback(async({forceRefresh:e=!1}={})=>{const t=(Array.isArray(Or)?Or:[]).filter(t=>{const n=String(t?.key||"").trim();return!(!n||"__home"===n||!String(t?.indexingAddress||"").trim()||!Zn.has(n.toLowerCase())||!e&&Object.prototype.hasOwnProperty.call(yt||{},n))}).map(e=>({key:String(e.key),address:String(e.indexingAddress)}));if(0===t.length)return;let n=!1,r=0;const i=async t=>{try{const r=await Ul({address:t.address||void 0,forceRefresh:e});if(n)return;xt(e=>({...e||{},[t.key]:Array.isArray(r)?r:[]}))}catch{}},a=Array.from({length:Math.min(2,t.length)}).map(async()=>{for(;!n;){const e=r++;if(e>=t.length)return;await i(t[e])}});return await Promise.all(a),()=>{n=!0}},[Or,yt,Zn]);Bc.useEffect(()=>{yr&&"home"===pt&&("name"!==Nt||At)&&zr({forceRefresh:!1})},[yr,pt,Nt,At,zr]);const Dr=(e,t)=>{const n=String(t||"").trim();if(!n)return;const r=n.split(".").filter(Boolean);let i=e;for(const a of r){if(null==i)return;i=i?.[a]}return i},[Hr,Wr]=Pc.useState("idle"),[jr,Vr]=Pc.useState([]),[qr,Xr]=Pc.useState("");Bc.useEffect(()=>{let e=!0;return(async()=>{try{const t="home"!==pt,r=Ct,i=String(r?.match?.galleryInscriptionId||"").trim(),a=r?.match?.parentInscriptionIds,o=Array.isArray(a)?a.map(e=>String(e||"").trim()).filter(Boolean):[],s=!!i||o.length>0;if(!yr||!t||!s)return void(e&&(Wr("idle"),Vr([]),Xr("")));e&&(Wr("loading"),Xr(""));const{resolveGalleryIds:l,resolveParentChildrenIdsProgressive:c}=await n(async()=>{const{resolveGalleryIds:e,resolveParentChildrenIdsProgressive:t}=await Promise.resolve().then(()=>Ol);return{resolveGalleryIds:e,resolveParentChildrenIdsProgressive:t}},__VITE_PRELOAD__);if(i){const t=await l(r);if(!e)return;Vr(Array.isArray(t)?t:[]),Wr("ready")}else{let t=!0;if(await c(r,n=>{e&&(t?(t=!1,Vr(n),Wr("ready")):Vr(e=>{const t=new Set(e.map(e=>String(e||"").toLowerCase())),r=n.filter(e=>!t.has(String(e||"").toLowerCase()));return r.length>0?[...e,...r]:e}))}),!e)return;Wr("ready")}}catch(Pk){if(!e)return;Wr("error"),Vr([]),Xr(Pk?.message||String(Pk))}})(),()=>{e=!1}},[yr,pt,Ct?.key,Ct?.match?.galleryInscriptionId,Ct?.match?.parentInscriptionIds]);const Kr=(e=>{const t="home"!==pt,n=t?((e,t)=>{const n=Array.isArray(e)?e:[],r=Array.isArray(t?.filters)?t.filters:[],i=r.length>0?r:"bitmap"===String(t?.key||pt)?[{key:"oci",label:"OCI",type:"boolean",sourcePath:"collection.verified",default:!1},{key:"bitmon",label:"Bitmon",type:"boolean",sourcePath:"collection.bitmon.isBitmon",default:!1}]:[];if(0===i.length)return n;const a=String(t?.key||pt||"").trim(),o=wt&&a&&wt[a]?wt[a]:{},s=i.map(e=>{const t=String(e?.key||"").trim();if(!t)return null;const n=o&&Object.prototype.hasOwnProperty.call(o,t)?o[t]:e?.default;return{...e,_value:n}}).filter(Boolean);return n.filter(e=>{for(const t of s){const n=String(t?.type||"").trim(),r=t?._value,i=t?.sourcePath;if(!i)continue;const a=Dr(e,i);if("boolean"!==n){if("rangeMin"===n){const e=Number(r);if(!Number.isFinite(e))continue;const t=Number(a);if(!Number.isFinite(t))return!1;if(t<e)return!1;continue}if("rangeMax"===n){const e=Number(r);if(!Number.isFinite(e))continue;const t=Number(a);if(!Number.isFinite(t))return!1;if(t>e)return!1;continue}if("enum"!==n);else{if(null==r||""===String(r))continue;if(a!==r)return!1}}else if(!0===r&&!a)return!1}return!0})})(e,Ct):Array.isArray(e)?e:[],r=String(Ct?.match?.galleryInscriptionId||"").trim(),i=Ct?.match?.parentInscriptionIds,a=Array.isArray(i)?i.map(e=>String(e||"").trim()).filter(Boolean):[],o=!!r||a.length>0;if(t&&o){if("ready"!==Hr)return[];const e=new Set((Array.isArray(jr)?jr:[]).map(e=>String(e||"").trim()));return(Array.isArray(n)?n:[]).filter(t=>e.has(String(t?.inscriptionId||"").trim())).filter(e=>!_r(e)).slice().sort((e,t)=>{const n=Number(e?.listedAt||0);return Number(t?.listedAt||0)-n})}return(Array.isArray(n)?n:[]).filter(e=>!_r(e)).slice().sort((e,t)=>{const n=Number(e?.listedAt||0);return Number(t?.listedAt||0)-n})})(ot);Bc.useEffect(()=>{let e=!1;if("marketplace"!==Ae)return()=>{e=!0};const{idbPageKey:t,cacheKey:r}=Gn(pt),i=e=>e&&"object"==typeof e&&Object.prototype.hasOwnProperty.call(e,"meta")?{meta:e.meta,ts:Number(e.ts||0)}:{meta:e,ts:0},a=(Array.isArray(ot)?ot:[]).filter(e=>{const t=String(e?.revealTxid||"").trim().toLowerCase();if(!/^[0-9a-f]{64}$/.test(t))return!1;const n=Number(e?.price);if(Number.isFinite(n)&&n>0)return!1;if(Wn.current.done.has(t)){const{meta:e,ts:n}=i(Wn.current.done.get(t));if(null!=e)return!1;if(n&&Date.now()-n<9e4)return!1}return!0}).slice(0,80).map(e=>String(e.revealTxid).trim().toLowerCase());if(0===a.length)return()=>{e=!0};const o=async e=>{const t=String(e||"").trim().toLowerCase();if(!/^[0-9a-f]{64}$/.test(t))return null;const r=Wn.current.done.get(t);if(void 0!==r){const{meta:e,ts:t}=i(r);if(null!=e)return e;if(t&&Date.now()-t<9e4)return null}const a=Wn.current.inflight.get(t);if(a)return await a;const o="undefined"!=typeof window&&window.__NEXUS_NETWORK__?String(window.__NEXUS_NETWORK__).toLowerCase():"mainnet";try{const e=await ui(Kn(o,t),{maxAgeMs:864e5});if(e&&"object"==typeof e){const n=Date.now();return Wn.current.done.set(t,{meta:e,ts:n}),e}}catch{}const s=(async()=>{try{const{ensureBufferPolyfill:e}=await n(async()=>{const{ensureBufferPolyfill:e}=await Promise.resolve().then(()=>mn);return{ensureBufferPolyfill:e}},__VITE_PRELOAD__);await e();const{loadBitcoinLibFromInscription:r}=await n(async()=>{const{loadBitcoinLibFromInscription:e}=await Promise.resolve().then(()=>An);return{loadBitcoinLibFromInscription:e}},__VITE_PRELOAD__),i=await r(),{fetchTxHexViaProxy:a}=await n(async()=>{const{fetchTxHexViaProxy:e}=await Promise.resolve().then(()=>Ei);return{fetchTxHexViaProxy:e}},__VITE_PRELOAD__),s=async e=>{const t=String(e||"").trim().toLowerCase();if(!/^[0-9a-f]{64}$/.test(t))return null;try{const e=await fetch(kt(`/r/tx/${t}`));if(!e.ok)return null;const n=String(e?.headers?.get?.("content-type")||"").toLowerCase(),r=String(await e.text()||"").trim(),i=e=>"string"==typeof e&&e.length>0&&e.length%2==0&&/^[0-9a-fA-F]+$/.test(e);if(i(r))return r;if(n.includes("application/json")||r.startsWith("{")||r.startsWith("["))try{const e=JSON.parse(r),t=[e?.hex,e?.txHex,e?.rawtx,e?.rawTx,e?.data?.hex,e?.result?.hex].filter(e=>"string"==typeof e);for(const n of t){const e=String(n).trim();if(i(e))return e}}catch{}const a=r.slice(0,200).toLowerCase();if(a.includes("<!doctype")||a.includes("<html")||a.includes("<head")||a.includes("<body"))return null;const o=r.match(/\b[0-9a-fA-F]{200,}\b/);if(o&&i(o[0]))return o[0]}catch{}return null};let l=null;try{l=await a(t,o)}catch{}l||(l=await s(t));const c=!!(l&&"string"==typeof l&&l.length>100);try{const{extractOodlListingMetadataFromRevealTxWithBitcoinLib:e}=await n(async()=>{const{extractOodlListingMetadataFromRevealTxWithBitcoinLib:e}=await Promise.resolve().then(()=>fo);return{extractOodlListingMetadataFromRevealTxWithBitcoinLib:e}},__VITE_PRELOAD__),t=await e(i,l);if(t&&"object"==typeof t)return{...t,__ts:Date.now()}}catch{}return{__meta:null,__gotTxHex:c}}catch{return{__meta:null,__gotTxHex:!1}}})();Wn.current.inflight.set(t,s);const l=await s;Wn.current.inflight.delete(t);const c=l&&"object"==typeof l&&"__meta"in l?l.__meta:l,u=l&&"object"==typeof l&&!0===l.__gotTxHex,d=Date.now();if(null!=c){Wn.current.done.set(t,{meta:c,ts:d});try{li(Kn(o,t),c)}catch{}}else u&&Wn.current.done.set(t,{meta:null,ts:d});return c},s=e=>{if(null==e)return null;try{const t="bigint"==typeof e?e:BigInt(String(e));if(t<=0n)return null;const n=Number(t);return!Number.isFinite(n)||n<=0||t>BigInt(Number.MAX_SAFE_INTEGER)?null:Math.trunc(n)}catch{const t=Number(e);return!Number.isFinite(t)||t<=0?null:Math.trunc(t)}};return(async()=>{let n=0;const i=Array.from({length:Math.min(4,a.length)}).map(async()=>{for(;!e;){const i=n++;if(i>=a.length)return;const l=a[i],c=await o(l);if(e||!c)continue;const u=s(c?.priceSats),d=(()=>{const e=Number(c?.minBlockHeight);return Number.isFinite(e)&&e>=0?Math.trunc(e):null})(),p=(()=>{const e=Number(c?.bitmapNumber);return Number.isFinite(e)&&e>=0?Math.trunc(e):null})(),f=(()=>{const e=Number(c?.parcelNumber);return Number.isFinite(e)&&e>=0?Math.trunc(e):null})();if(!u&&null===d&&null===p&&null===f)continue;const m=e=>{if(String(e?.revealTxid||"").trim().toLowerCase()!==l)return e;const t=Number(e?.price),n={...e||{}};if(!(Number.isFinite(t)&&t>0)&&u){n.price=u;const e=Number(c?.__ts||c?.ts||c?.decodedAt||0);Number.isFinite(e)&&e>0?n.priceAsOf=Math.trunc(e):n.priceAsOf=Date.now()}return void 0===n.minBlockHeight&&null!==d&&(n.minBlockHeight=d),null===n.bitmapNumberHint&&null!==p&&(n.bitmapNumberHint=p),null===n.parcelNumberHint&&null!==f&&(n.parcelNumberHint=f),n};st(e=>{const n=Array.isArray(e)?e:[];let i=!1;const a=n.map(e=>{const t=m(e);return t!==e&&(i=!0),t});if(i){try{li(Xn(t),a)}catch{}xt(e=>{const t=e||{},n=Array.isArray(t?.[r])?t[r]:null;if(!n)return e;let i=!1;const a=n.map(e=>{const t=m(e);return t!==e&&(i=!0),t});return i?{...t,[r]:a}:e})}return i?a:e})}});await Promise.all(i)})(),()=>{e=!0}},[Ae,pt,ot]);const Gr=async()=>{Bt(null),_t(!1),ft("home"),xn(null),ir(null),st([]);const e=yt?.[Gn("home").cacheKey];Array.isArray(e)&&e.length>0?st(e):await Cr({forceRefresh:!1,page:"home"})},Yr=(()=>{const e=[];if(yr&&(e.push({label:"Marketplace",action:()=>Gr()}),"home"!==pt)){const t=Ct?.title||Ct?.key||pt;null!==yn?(e.push({label:t,action:()=>xn(null)}),e.push({label:`${yn}.bitmap`,action:null})):e.push({label:t,action:null})}return e})(),Jr=BE({enabled:!(!yr||"home"!==pt),mobileOnly:!0,minScrollToHidePx:50}),Qr=BE({enabled:!!(yr&&"home"!==pt&&null!==yn||br||gr),mobileOnly:!0,minScrollToHidePx:50}),Zr=(()=>{const e=un.current;if(!e||"marketplace"!==e.from)return[];const t=String(e?.marketplacePage||"home"),n=e?.selectedMarketplaceCollection||null,r=n?.title||n?.name||n?.key||("home"!==t?t:"Marketplace"),i=[];return i.push({label:"Home",action:()=>{dn.current={marketplacePage:"home",selectedMarketplaceCollection:null,parcelMarketplaceBitmapNumber:null},ke("marketplace")}}),"home"!==t&&i.push({label:String(r),action:()=>{dn.current={marketplacePage:t,selectedMarketplaceCollection:n,parcelMarketplaceBitmapNumber:e?.parcelMarketplaceBitmapNumber??null},ke("marketplace")}}),i.push({label:"Buy",action:null}),i})();return Pc.createElement("div",{className:"flex flex-col gap-4 flex-1 min-h-0"},yr&&"home"===pt?Pc.createElement(Pc.Fragment,null,!(Jr.hidden&&Jr.isMobile)&&Pc.createElement("div",{className:"sm:sticky sm:top-0 z-[100]"},Pc.createElement("div",{role:"search",className:TE+" shadow-[0_4px_20px_rgba(0,0,0,0.25)]"},Pc.createElement("div",{className:CE+" py-1.5 sm:py-2"},Pc.createElement("div",{className:"flex items-center gap-1.5 sm:gap-2"},Pc.createElement("div",{className:"relative flex-1 min-w-0 group/search"},Pc.createElement("label",{className:"sr-only",htmlFor:"marketplace-collection-search"},"Search collections"),Pc.createElement("svg",{className:"pointer-events-none absolute left-2.5 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-neutral-500 group-focus-within/search:text-purple-400 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2},Pc.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})),Pc.createElement("input",{id:"marketplace-collection-search",type:"search",enterKeyHint:"search",value:St,onChange:e=>Et(e.target.value),className:"w-full h-8 sm:h-9 pl-8 pr-7 text-xs sm:text-sm rounded-lg bg-neutral-950/50 border border-white/[0.06] text-neutral-100 placeholder:text-neutral-500 outline-none focus:border-purple-500/40 focus:ring-1 focus:ring-purple-500/20 transition touch-manipulation",placeholder:"Search\u2026",spellCheck:!1,autoComplete:"off"}),St&&Pc.createElement("button",{type:"button",onClick:()=>Et(""),className:"absolute right-1 top-1/2 -translate-y-1/2 w-6 h-6 grid place-items-center rounded text-neutral-500 hover:text-neutral-200 transition-colors touch-manipulation",title:"Clear search"},Pc.createElement("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5},Pc.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})))),Pc.createElement("div",{className:"relative shrink-0"},Pc.createElement("svg",{className:"pointer-events-none absolute left-2 top-1/2 -translate-y-1/2 w-3 h-3 text-neutral-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2},Pc.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12"})),Pc.createElement("select",{value:Nt,onChange:e=>It(e.target.value),className:"h-8 sm:h-9 pl-6 pr-2 text-[11px] sm:text-xs rounded-lg bg-neutral-950/50 border border-white/[0.06] text-neutral-300 outline-none focus:border-purple-500/40 focus:ring-1 focus:ring-purple-500/20 transition appearance-none touch-manipulation cursor-pointer",title:"Sort collections"},Pc.createElement("option",{value:"name"},"A \u2192 Z"),Pc.createElement("option",{value:"listingsDesc"},"Most listed"),Pc.createElement("option",{value:"floorAsc"},"Lowest floor"))),Pc.createElement("button",{type:"button",onClick:()=>Tt(!At),className:"h-8 sm:h-9 px-2 sm:px-2.5 text-[11px] rounded-lg border transition-all active:scale-[0.97] touch-manipulation select-none flex items-center gap-1 shrink-0 "+(At?"bg-purple-500/15 border-purple-500/25 text-purple-300":"bg-neutral-950/40 border-white/[0.06] text-neutral-400 hover:text-neutral-200 hover:border-white/10"),title:At?"Showing active only":"Hide empty collections"},At?Pc.createElement("svg",{className:"w-3 h-3 shrink-0",fill:"currentColor",viewBox:"0 0 20 20"},Pc.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})):Pc.createElement("svg",{className:"w-3 h-3 shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2},Pc.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L6.5 6.5m3.378 3.378L6.5 6.5m0 0L3 3m3.5 3.5l10 10M17.5 17.5L21 21"})),Pc.createElement("span",{className:"hidden sm:inline"},At?"Active":"Hide \u2205")),Pc.createElement("span",{className:"hidden sm:inline-flex px-2 py-0.5 text-[10px] font-medium tabular-nums rounded-full bg-white/[0.04] text-neutral-400 ring-1 ring-white/[0.06] shrink-0"},Ur.length))))),Pc.createElement(PE,{show:Jr.hidden&&Jr.isMobile,label:"Show search & filters",onShow:()=>Jr.setHidden(!1),top:"calc(env(safe-area-inset-top, 0px) + 46px)"})):null,yr&&"home"!==pt&&null!==yn||br||gr?Pc.createElement(Pc.Fragment,null,!(Qr.hidden&&Qr.isMobile)&&Pc.createElement("div",{className:"sm:sticky sm:top-0 z-[100]"},Pc.createElement("div",{className:TE},Pc.createElement("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0 "+CE+" py-1.5 sm:py-2"},yr&&"home"!==pt&&null!==yn&&Yr.length>1?Pc.createElement("nav",{className:"flex items-center gap-1 min-w-0 text-xs sm:text-sm overflow-hidden","aria-label":"Breadcrumb"},Yr.map((e,t)=>Pc.createElement(Pc.Fragment,{key:t},t>0&&Pc.createElement("span",{className:"text-neutral-600 shrink-0"},"/"),e.action?Pc.createElement("button",{onClick:e.action,className:"min-h-[44px] flex items-center text-neutral-400 hover:text-purple-300 active:text-purple-300 transition-colors truncate shrink-0 touch-manipulation",title:e.label},e.label):Pc.createElement("span",{className:"text-neutral-200 font-semibold truncate min-w-0",title:e.label},e.label)))):null,!yr&&(br||gr)&&"buy"===Te&&Zr.length>1?Pc.createElement("nav",{className:"flex items-center gap-1 min-w-0 text-xs sm:text-sm overflow-hidden","aria-label":"Breadcrumb"},Zr.map((e,t)=>Pc.createElement(Pc.Fragment,{key:t},t>0&&Pc.createElement("span",{className:"text-neutral-600 shrink-0"},"/"),e.action?Pc.createElement("button",{onClick:e.action,className:"min-h-[44px] flex items-center text-neutral-400 hover:text-purple-300 active:text-purple-300 transition-colors truncate shrink-0 touch-manipulation",title:e.label},e.label):Pc.createElement("span",{className:"text-neutral-200 font-semibold truncate min-w-0",title:e.label},e.label)))):null,br||gr?Pc.createElement("button",{onClick:()=>{const e=un.current;if("buy"===Te&&e&&"marketplace"===e.from)return dn.current={marketplacePage:String(e?.marketplacePage||"home"),selectedMarketplaceCollection:e?.selectedMarketplaceCollection||null,parcelMarketplaceBitmapNumber:e?.parcelMarketplaceBitmapNumber??null},void ke("marketplace");ke("hub")},className:"min-h-[44px] flex items-center text-xs sm:text-sm text-neutral-400 hover:text-purple-300 active:text-purple-300 transition-colors shrink-0 touch-manipulation select-none"},"\u2190 Back"):null,Pc.createElement("div",{className:"flex-1 min-w-0"})))),Pc.createElement(PE,{show:Qr.hidden&&Qr.isMobile,label:"Show navigation",onShow:()=>Qr.setHidden(!1),top:"calc(env(safe-area-inset-top, 0px) + 86px)"})):null,Pc.createElement("div",{className:"px-1 sm:px-3 md:px-4 pb-2 sm:pb-4"},xr&&Pc.createElement("div",{className:"flex flex-col gap-3 sm:gap-4 max-w-5xl mx-auto"},wr?Pc.createElement("div",{className:"text-xs text-yellow-300 bg-yellow-500/10 border border-yellow-500/30 rounded-lg px-3 py-2"},"Phantom wallet is connected. Creating listings/sell offers requires a 0x83 (SIGHASH_SINGLE|ANYONECANPAY) signature, which Phantom does not support here. Switch wallets to list or create seller offers."):null,Pc.createElement("section",null,Pc.createElement("div",{className:"mb-1.5 sm:mb-2 px-1"},Pc.createElement("h3",{className:"text-[10px] sm:text-[11px] font-semibold uppercase tracking-widest text-neutral-500"},"Collections")),Pc.createElement("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2 sm:gap-2.5"},Pc.createElement("button",{onClick:()=>{Pe("launch"),ke("oodl"),Ce("collection")},className:"group w-full text-left rounded-xl border border-neutral-800/70 bg-neutral-900/60 px-3 py-2.5 sm:px-4 sm:py-3 hover:border-purple-500/40 hover:bg-purple-500/5 transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-purple-500/40","aria-label":"Launch Pad \u2014 list items for sale with embedded offers"},Pc.createElement("div",{className:"text-[10px] font-medium uppercase tracking-wider text-neutral-500 leading-tight"},"Collection listing"),Pc.createElement("div",{className:"text-[13px] sm:text-[14px] font-semibold text-neutral-100 group-hover:text-purple-200 transition-colors mt-1"},"Launch Pad"),Pc.createElement("p",{className:"text-[11px] text-neutral-400 mt-1 leading-snug line-clamp-2 hidden sm:block"},"List items for sale with embedded offers and locktimes."),Pc.createElement("div",{className:"text-[11px] font-medium text-purple-300/90 mt-1.5 sm:mt-2"},"Open flow \u203a")),Pc.createElement("button",{onClick:()=>{Pe("curate"),ke("oodl"),Ce("collection")},className:"group w-full text-left rounded-xl border border-neutral-800/70 bg-neutral-900/60 px-3 py-2.5 sm:px-4 sm:py-3 hover:border-indigo-500/40 hover:bg-indigo-500/5 transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500/40","aria-label":"Curate a collection for others to list to"},Pc.createElement("div",{className:"text-[10px] font-medium uppercase tracking-wider text-neutral-500 leading-tight"},"Collection setup"),Pc.createElement("div",{className:"text-[13px] sm:text-[14px] font-semibold text-neutral-100 group-hover:text-indigo-200 transition-colors mt-1"},"Curate"),Pc.createElement("p",{className:"text-[11px] text-neutral-400 mt-1 leading-snug line-clamp-2 hidden sm:block"},"Set up a collection on-chain. Earn indexing fees."),Pc.createElement("div",{className:"text-[11px] font-medium text-indigo-300/90 mt-1.5 sm:mt-2"},"Start curation \u203a")),Pc.createElement("button",{onClick:()=>{Oe("bitmaps"),Pe("launch"),ke("oodl"),Ce("collection")},className:"group w-full text-left rounded-xl border border-neutral-800/70 bg-neutral-900/60 px-3 py-2.5 sm:px-4 sm:py-3 hover:border-teal-500/40 hover:bg-teal-500/5 transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-teal-500/40","aria-label":"List bitmaps from your wallet"},Pc.createElement("div",{className:"text-[10px] font-medium uppercase tracking-wider text-neutral-500 leading-tight"},"Bitmap listing"),Pc.createElement("div",{className:"text-[13px] sm:text-[14px] font-semibold text-neutral-100 group-hover:text-teal-200 transition-colors mt-1"},"Bitmaps"),Pc.createElement("p",{className:"text-[11px] text-neutral-400 mt-1 leading-snug line-clamp-2 hidden sm:block"},"Scan wallet for verified bitmaps and set per-item pricing."),Pc.createElement("div",{className:"text-[11px] font-medium text-teal-300/90 mt-1.5 sm:mt-2"},"Bitmap wizard \u203a")),Pc.createElement("button",{onClick:()=>{Oe("parcels"),Pe("launch"),ke("oodl"),Ce("collection")},className:"group w-full text-left rounded-xl border border-neutral-800/70 bg-neutral-900/60 px-3 py-2.5 sm:px-4 sm:py-3 hover:border-green-500/40 hover:bg-green-500/5 transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-green-500/40","aria-label":"List bitmap parcels from your wallet"},Pc.createElement("div",{className:"text-[10px] font-medium uppercase tracking-wider text-neutral-500 leading-tight"},"Parcel listing"),Pc.createElement("div",{className:"text-[13px] sm:text-[14px] font-semibold text-neutral-100 group-hover:text-green-200 transition-colors mt-1"},"Parcels"),Pc.createElement("p",{className:"text-[11px] text-neutral-400 mt-1 leading-snug line-clamp-2 hidden sm:block"},"Publish a parcel manifesto with embedded offers."),Pc.createElement("div",{className:"text-[11px] font-medium text-green-300/90 mt-1.5 sm:mt-2"},"Parcel wizard \u203a")))),Pc.createElement("section",null,Pc.createElement("div",{className:"mb-1.5 sm:mb-2 px-1"},Pc.createElement("h3",{className:"text-[10px] sm:text-[11px] font-semibold uppercase tracking-widest text-neutral-500"},"Sell & Buy")),Pc.createElement("div",{className:"grid grid-cols-2 gap-2 sm:gap-2.5"},Pc.createElement("button",{onClick:()=>{ke("oodl"),Ce("sell")},className:"group w-full text-left rounded-xl border border-neutral-800/70 bg-neutral-900/60 px-3 py-2.5 sm:px-4 sm:py-3 hover:border-fuchsia-500/40 hover:bg-fuchsia-500/5 transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-fuchsia-500/40","aria-label":"Sell an inscription"},Pc.createElement("div",{className:"text-[10px] font-medium uppercase tracking-wider text-neutral-500 leading-tight"},"Marketplace listing"),Pc.createElement("div",{className:"text-[13px] sm:text-[14px] font-semibold text-neutral-100 group-hover:text-fuchsia-200 transition-colors mt-1"},"Sell"),Pc.createElement("p",{className:"text-[11px] text-neutral-400 mt-1 leading-snug line-clamp-2 hidden sm:block"},"Create a marketplace listing for an inscription you own."),Pc.createElement("div",{className:"text-[11px] font-medium text-fuchsia-300/90 mt-1.5 sm:mt-2"},"List now \u203a")),Pc.createElement("button",{onClick:()=>{un.current=null,ke("oodl"),Ce("buy")},className:"group w-full text-left rounded-xl border border-neutral-800/70 bg-neutral-900/60 px-3 py-2.5 sm:px-4 sm:py-3 hover:border-sky-500/40 hover:bg-sky-500/5 transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500/40","aria-label":"Buy an inscription"},Pc.createElement("div",{className:"text-[10px] font-medium uppercase tracking-wider text-neutral-500 leading-tight"},"Marketplace purchase"),Pc.createElement("div",{className:"text-[13px] sm:text-[14px] font-semibold text-neutral-100 group-hover:text-sky-200 transition-colors mt-1"},"Buy"),Pc.createElement("p",{className:"text-[11px] text-neutral-400 mt-1 leading-snug line-clamp-2 hidden sm:block"},"Purchase a listed inscription by reveal txid or inscription id."),Pc.createElement("div",{className:"text-[11px] font-medium text-sky-300/90 mt-1.5 sm:mt-2"},"Find listing \u203a")))),Pc.createElement("section",null,Pc.createElement("div",{className:"mb-1.5 sm:mb-2 px-1"},Pc.createElement("h3",{className:"text-[10px] sm:text-[11px] font-semibold uppercase tracking-widest text-neutral-500"},"Direct Offers")),Pc.createElement("div",{className:"grid grid-cols-2 gap-2 sm:gap-2.5"},Pc.createElement("button",{onClick:()=>{ke("offer"),Ce("sell")},className:"group w-full text-left rounded-xl border border-neutral-800/70 bg-neutral-900/60 px-3 py-2.5 sm:px-4 sm:py-3 hover:border-amber-500/40 hover:bg-amber-500/5 transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-500/40","aria-label":"Create a seller offer"},Pc.createElement("div",{className:"text-[10px] font-medium uppercase tracking-wider text-neutral-500 leading-tight"},"Direct trade"),Pc.createElement("div",{className:"text-[13px] sm:text-[14px] font-semibold text-neutral-100 group-hover:text-amber-200 transition-colors mt-1"},"Create Offer"),Pc.createElement("p",{className:"text-[11px] text-neutral-400 mt-1 leading-snug line-clamp-2 hidden sm:block"},"Generate a seller offer PSBT to share directly with a buyer."),Pc.createElement("div",{className:"text-[11px] font-medium text-amber-300/90 mt-1.5 sm:mt-2"},"Generate PSBT \u203a")),Pc.createElement("button",{onClick:()=>{un.current=null;try{W?.("")}catch{}Xt(""),Wt(null),Vt(null),zt(null),Xe(!1),De(""),We(!1),Ve(!0),Ye(""),Qe(""),ke("offer"),Ce("buy")},className:"group w-full text-left rounded-xl border border-neutral-800/70 bg-neutral-900/60 px-3 py-2.5 sm:px-4 sm:py-3 hover:border-emerald-500/40 hover:bg-emerald-500/5 transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500/40","aria-label":"Accept a seller offer"},Pc.createElement("div",{className:"text-[10px] font-medium uppercase tracking-wider text-neutral-500 leading-tight"},"Direct trade"),Pc.createElement("div",{className:"text-[13px] sm:text-[14px] font-semibold text-neutral-100 group-hover:text-emerald-200 transition-colors mt-1"},"Accept Offer"),Pc.createElement("p",{className:"text-[11px] text-neutral-400 mt-1 leading-snug line-clamp-2 hidden sm:block"},"Complete a purchase from a pasted seller offer PSBT."),Pc.createElement("div",{className:"text-[11px] font-medium text-emerald-300/90 mt-1.5 sm:mt-2"},"Paste and buy \u203a"))))),yr&&Pc.createElement("div",{className:"flex flex-col gap-4"},ut&&"home"!==pt&&Pc.createElement("div",{className:"text-xs text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2"},ut),(()=>{const e=cr(Ct?.key||pt),t="home"!==pt;if(t&&lt&&!(Array.isArray(ot)&&ot.length>0))return Pc.createElement("div",{className:"flex flex-col gap-4"},!(null!==yn&&ur(Ct?.key||pt))&&Pc.createElement(MI,{collection:Ct,listingsCount:0,floorPriceSats:null,isLoading:!0,isSubscribed:(()=>{const e=String(Ct?.key||pt||"").trim().toLowerCase();return e&&"home"!==e&&Zn.has(e)})(),onBack:Gr,onRefresh:()=>Cr({forceRefresh:!0,page:pt,collection:Ct}),onSell:()=>{ke("oodl"),Ce("sell")},onToggleSubscribe:()=>{const e=String(Ct?.key||pt||"").trim().toLowerCase();e&&"home"!==e&&(Zn.has(e)?sr(e):or(e))},onClearCache:async()=>{if(!er){tr(!0);try{try{await ci("oodl:listings:")}catch{}try{await ci("oodl:listing-meta:")}catch{}xt({}),await Cr({forceRefresh:!0,page:pt,collection:Ct})}finally{tr(!1)}}},isClearingCache:er}),rr&&rr===String(Ct?.key||pt||"").trim().toLowerCase()&&Pc.createElement("div",{className:"flex items-center gap-3 rounded-xl border border-purple-500/30 bg-purple-950/30 px-4 py-3 text-sm"},Pc.createElement("svg",{className:"w-5 h-5 text-purple-400 shrink-0",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor"},Pc.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.455 2.456L21.75 6l-1.036.259a3.375 3.375 0 0 0-2.455 2.456Z"})),Pc.createElement("span",{className:"text-neutral-300 flex-1"},"For a faster experience, consider ",Pc.createElement("strong",{className:"text-purple-300"},"subscribing")," to collections you visit often."),Pc.createElement("button",{className:"shrink-0 rounded-lg bg-purple-600 hover:bg-purple-500 text-white text-xs font-semibold px-3 py-1.5 transition-colors",onClick:()=>{const e=String(Ct?.key||pt||"").trim().toLowerCase();e&&"home"!==e&&or(e),ir(null)}},"Subscribe"),Pc.createElement("button",{className:"shrink-0 text-neutral-500 hover:text-neutral-300 transition-colors p-1",title:"Dismiss",onClick:()=>{const e=rr;ar.current.add(e);try{li(nr,Array.from(ar.current))}catch{}ir(null)}},Pc.createElement("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor"},Pc.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"})))),Pc.createElement("div",{className:"flex items-center justify-center py-12"},Pc.createElement("div",{className:"flex items-center gap-3 text-neutral-400 text-sm"},Pc.createElement("svg",{className:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24"},Pc.createElement("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),Pc.createElement("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})),"Loading listings\u2026")));const r=e=>{un.current={from:"marketplace",marketplacePage:pt,selectedMarketplaceCollection:Ct,parcelMarketplaceBitmapNumber:yn};const t=Array.isArray(Kr)?Kr:[];pn.current=t;const n=String(e?.inscriptionId||"").trim();gn(n?t.findIndex(e=>String(e?.inscriptionId||"").trim()===n):-1);const r=(()=>{const t=Number(e?.price);return!Number.isFinite(t)||t<=0?null:Math.trunc(t)})(),i=String(e?.sellerOfferPsbt||"").trim(),a=String(e?.inscriptionId||"").trim();if(i)return zt(r),Wt(e?.inscription||null),Vt(e?.collection||null),Xt(""),De(i),We(!0),ke("offer"),void Ce("buy");const o=a||e?.revealTxid;W&&o&&W(o),Xt(o?String(o):""),zt(r),Wt(e?.inscription||null),Vt(e?.collection||null),ke("oodl"),Ce("buy")},i=async(e,t)=>{t?.stopPropagation?.();try{const t=String(e?.sellerOfferPsbt||"").trim();if(t)return Mn("Listing offer PSBT"),void Ln(t);const r=String(e?.revealTxid||"").trim();if(!/^[0-9a-f]{64}$/i.test(r))throw new Error("Listing has no reveal txid / offer PSBT yet");Mn("Loading listing PSBT\u2026"),Ln(null);const i=await n(()=>Promise.resolve().then(()=>Zo),__VITE_PRELOAD__),a=await i.getSellerOfferPsbtBase64FromRevealTxid(r,{inscriptionId:listingInscriptionId||null});Mn(`Listing offer PSBT (${r.slice(0,10)}\u2026)`),Ln(a)}catch(_k){String(_k?.message||_k||"Failed to extract listing PSBT"),Mn("Failed to load listing PSBT"),Ln("")}};return Pc.createElement("div",{className:"flex flex-col gap-4"},t?Pc.createElement(Pc.Fragment,null,!(null!==yn&&ur(Ct?.key||pt))&&Pc.createElement(MI,{collection:Ct,listingsCount:Kr.length,floorPriceSats:(()=>{const e=Kr.map(e=>Number(e?.price)).filter(e=>Number.isFinite(e)&&e>0);return e.length>0?Math.min(...e):null})(),isLoading:lt,isSubscribed:(()=>{const e=String(Ct?.key||pt||"").trim().toLowerCase();return e&&"home"!==e&&Zn.has(e)})(),onBack:Gr,onRefresh:()=>Cr({forceRefresh:!0,page:pt,collection:Ct}),onSell:()=>{ke("oodl"),Ce("sell")},onToggleSubscribe:()=>{const e=String(Ct?.key||pt||"").trim().toLowerCase();e&&"home"!==e&&(Zn.has(e)?sr(e):or(e))},onClearCache:async()=>{if(!er&&("undefined"==typeof window||"function"!=typeof window.confirm||window.confirm("Clear cache?"))){tr(!0);try{try{await ci("oodl:listings:")}catch{}try{await ci("oodl:listing-meta:")}catch{}try{Wn.current?.done?.clear?.(),Wn.current?.inflight?.clear?.()}catch{}xt({}),await Cr({forceRefresh:!0,page:pt,collection:Ct})}finally{tr(!1)}}},isClearingCache:er}),rr&&rr===String(Ct?.key||pt||"").trim().toLowerCase()&&Pc.createElement("div",{className:"flex items-center gap-3 rounded-xl border border-purple-500/30 bg-purple-950/30 px-4 py-3 text-sm"},Pc.createElement("svg",{className:"w-5 h-5 text-purple-400 shrink-0",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor"},Pc.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.455 2.456L21.75 6l-1.036.259a3.375 3.375 0 0 0-2.455 2.456Z"})),Pc.createElement("span",{className:"text-neutral-300 flex-1"},"For a faster experience, consider ",Pc.createElement("strong",{className:"text-purple-300"},"subscribing")," to collections you visit often."),Pc.createElement("button",{className:"shrink-0 rounded-lg bg-purple-600 hover:bg-purple-500 text-white text-xs font-semibold px-3 py-1.5 transition-colors",onClick:()=>{const e=String(Ct?.key||pt||"").trim().toLowerCase();e&&"home"!==e&&or(e),ir(null)}},"Subscribe"),Pc.createElement("button",{className:"shrink-0 text-neutral-500 hover:text-neutral-300 transition-colors p-1",title:"Dismiss",onClick:()=>{const e=rr;ar.current.add(e);try{li(nr,Array.from(ar.current))}catch{}ir(null)}},Pc.createElement("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor"},Pc.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"})))),(()=>{if(null!==yn&&ur(Ct?.key||pt))return null;const e=(()=>{const e=Ct,n=Array.isArray(e?.filters)?e.filters:[];if(cr(e?.key||pt)||ur(e?.key||pt))return null;const r=n.length>0?n:cr(e?.key||pt)?[{key:"oci",label:"OCI",type:"boolean",sourcePath:"collection.verified",default:!1},{key:"bitmon",label:"Bitmon",type:"boolean",sourcePath:"collection.bitmon.isBitmon",default:!1}]:[];if(!t||!e?.key||0===r.length)return null;const i=String(e.key),a=wt&&wt[i]?wt[i]:{},o=(e,t)=>{vt(n=>{const r={...n||{}};return r[i]={...r[i]||{},[e]:t},r})};return Pc.createElement("div",{className:"flex items-center gap-x-3 min-w-0 overflow-x-auto"},Pc.createElement("div",{className:"text-[10px] font-semibold uppercase tracking-wider text-neutral-400 whitespace-nowrap shrink-0 px-2 py-1 rounded-md bg-neutral-950/30 border border-neutral-800/60"},"Filters"),Pc.createElement("div",{className:"flex items-center gap-x-3 min-w-max"},r.slice(0,4).map(e=>{const t=String(e?.key||"").trim();if(!t)return null;const n=String(e?.label||t),r=String(e?.type||"boolean"),i=Object.prototype.hasOwnProperty.call(a,t)?a[t]:e?.default;if("boolean"===r)return Pc.createElement("label",{key:t,className:"flex items-center gap-1.5 text-[11px] text-neutral-300 select-none whitespace-nowrap shrink-0"},Pc.createElement("input",{type:"checkbox",checked:!0===i,onChange:e=>o(t,!!e.target.checked),className:"accent-purple-500"}),Pc.createElement("span",{className:"whitespace-nowrap"},n));if("rangeMin"===r||"rangeMax"===r)return Pc.createElement("label",{key:t,className:"flex items-center gap-1.5 text-[11px] text-neutral-300 select-none whitespace-nowrap shrink-0"},Pc.createElement("span",{className:"whitespace-nowrap"},n),Pc.createElement("input",{type:"number",value:null==i?"":i,onChange:e=>{const n=e.target.value;o(t,""===n?null:Number(n))},className:"w-24 px-2 py-1 text-xs bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-sky-500/60 focus:ring-1 focus:ring-sky-500/20 font-mono"}));if("enum"===r){const r=Array.isArray(e?.options)?e.options:[];return Pc.createElement("label",{key:t,className:"flex items-center gap-1.5 text-[11px] text-neutral-300 select-none whitespace-nowrap shrink-0"},Pc.createElement("span",{className:"whitespace-nowrap"},n),Pc.createElement("select",{value:null==i?"":String(i),onChange:e=>o(t,e.target.value),className:"px-2 py-1 text-xs bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-sky-500/60 focus:ring-1 focus:ring-sky-500/20"},Pc.createElement("option",{value:""},"All"),r.map((e,t)=>Pc.createElement("option",{key:t,value:String(e?.value)},String(e?.label||e?.value)))))}return null})))})();return e?Pc.createElement("div",{className:"bg-neutral-900/40 border border-neutral-800/60 rounded-xl px-3 py-2"},e):null})(),(()=>{const t=Kr,n=String(Ct?.match?.galleryInscriptionId||"").trim(),a=Ct?.match?.parentInscriptionIds,o=Array.isArray(a)?a.map(e=>String(e||"").trim()).filter(Boolean):[],s=!!n||o.length>0,l=e=>String(e||"").trim();if(s){if(("loading"===Hr||"idle"===Hr)&&0===jr.length)return Pc.createElement("div",{className:"flex items-center gap-3 text-neutral-400 text-sm py-10"},Pc.createElement("svg",{className:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24"},Pc.createElement("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),Pc.createElement("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})),"Loading collection membership\u2026");const e="loading"===Hr&&jr.length>0;if("error"===Hr)return Pc.createElement("div",{className:"text-xs text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2"},"Failed to load collection membership. ",qr?`(${qr})`:"");const n=(()=>{const e=Array.isArray(jr)?jr:[],t=new Set,n=[];for(const r of e){const e=l(r);if(!e)continue;const i=e.toLowerCase();t.has(i)||(t.add(i),n.push(e))}return n})(),a=(()=>{const e=new Map;for(const n of Array.isArray(t)?t:[]){const t=l(n?.inscriptionId);t&&(e.has(t.toLowerCase())||e.set(t.toLowerCase(),n))}return e})(),o=a.size,s=Ot?n.filter(e=>a.has(e.toLowerCase())):n,c=72,u=Number.isFinite(Number(Ft))?Math.max(1,Math.trunc(Number(Ft))):c,d=s.slice(0,u),p=s.length>d.length,f="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2 items-stretch auto-rows-fr",m=({inscriptionId:e})=>{const t=l(e),n=t?a.get(t.toLowerCase()):null,o=!!n,s=Number(n?.price),c=Number.isFinite(s)&&s>0,u=o?c?`${ON(Math.trunc(s))} BTC`:"Listed":"Unlisted",d=(()=>{const e=Number(n?.collection?.bitmapNumber);return Number.isFinite(e)?Math.trunc(e):null})(),p=null!==d&&n?.collection?.bitmon?.pattern||null,f=null!==d,m=f?`${d}.bitmap`:t?t.length>18?`${t.slice(0,10)}\u2026${t.slice(-6)}`:t:"inscription",g=o&&(!!String(n?.sellerOfferPsbt||"").trim()||!!String(n?.revealTxid||"").trim()),h={inscriptionId:t,inscription:{id:t,inscriptionId:t},price:null,sellerOfferPsbt:"",revealTxid:null,collection:n?.collection||null},b=()=>r(o?n:h);return Pc.createElement(zN,{title:f?`${d}.bitmap`:t||"inscription",onClick:b,media:f?Pc.createElement(WN,{bitmapNumber:d,bitmonPattern:p}):Pc.createElement(bN,{inscription:{id:t,inscriptionId:t},width:"100%",height:"100%"}),metaLeft:Pc.createElement("span",{className:"text-[10px] font-mono text-neutral-500 truncate"},f?"bitmap":"insc"),metaRight:Pc.createElement(DN,{price:u,hasPrice:o}),label:m,actions:o?Pc.createElement(HN,{canShowQr:g,onShowQr:e=>i(n,e),onSelect:()=>r(n),ctaLabel:"Buy",ctaVariant:"primary"}):Pc.createElement("button",{type:"button",onClick:e=>{e.stopPropagation(),b()},className:UN,title:"View inscription"},"View \u2192")})};return Pc.createElement("div",{className:"flex flex-col gap-3"},e&&Pc.createElement("div",{className:"flex items-center gap-2 text-[11px] text-neutral-500"},Pc.createElement("svg",{className:"w-3 h-3 animate-spin shrink-0",fill:"none",viewBox:"0 0 24 24"},Pc.createElement("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),Pc.createElement("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})),"Loading more\u2026"),Pc.createElement("div",{className:"flex flex-wrap items-center justify-between gap-3"},Pc.createElement("div",{className:"text-xs text-neutral-400"},n.length," items \u2022 ",o," listed \u2022 Showing ",d.length,"/",s.length),Pc.createElement("label",{className:"inline-flex items-center gap-2 text-xs text-neutral-300 select-none"},Pc.createElement("input",{type:"checkbox",checked:!!Ot,onChange:e=>Lt(!!e.target.checked),className:"accent-sky-500"}),"Listed only")),0===d.length?Pc.createElement("div",{className:"text-xs text-neutral-500"},"No items found."):Pc.createElement(Pc.Fragment,null,Pc.createElement("div",{className:f},d.map(e=>Pc.createElement(m,{key:e,inscriptionId:e}))),p&&Pc.createElement("div",{className:"flex justify-center pt-2"},Pc.createElement("button",{type:"button",onClick:()=>Mt(e=>{const t=Number.isFinite(Number(e))?Math.max(1,Math.trunc(Number(e))):c;return Math.min(s.length,t+c)}),className:"px-4 py-2 text-xs font-semibold rounded-lg bg-neutral-950/30 text-neutral-200 border border-neutral-800/60 hover:border-sky-500/25",title:"Load more items"},"Load more"))))}if(!Array.isArray(t)||0===t.length)return Pc.createElement("div",{className:"text-xs text-neutral-500"},"No listings found.");const c="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2 items-stretch auto-rows-fr";if(e)return Pc.createElement("div",{className:c},t.map(e=>Pc.createElement(jN,{key:e.inscriptionId,listing:e,onSelect:()=>r(e),onShowQr:t=>i(e,t),formatPrice:Pr})));if(ur(Ct?.key||pt)){const e=e=>{const t=e?.collection||null;if("parcel"!==String(t?.key||"").trim().toLowerCase())return null;const n=(()=>{const e=Number(t?.bitmapNumber);return Number.isFinite(e)?Math.trunc(e):null})(),r=(()=>{const e=Number(t?.parcelNumber);return Number.isFinite(e)?Math.trunc(e):null})(),i=(()=>{const t=Number(e?.price);return!Number.isFinite(t)||t<=0?null:Math.trunc(t)})();return Number.isFinite(n)&&null!==n&&Number.isFinite(r)&&null!==r?{bitmapNumber:n,parcelNumber:r,price:i,listing:e}:null},n=t.map(e).filter(Boolean);if(0===n.length){const e=Array.isArray(t)?t.length:0;return lt?Pc.createElement("div",{className:"text-xs text-neutral-400"},"Loading parcel listings\u2026"):0===e?Pc.createElement("div",{className:"text-xs text-neutral-500"},"No parcels found."):Pc.createElement("div",{className:"text-xs text-neutral-500"},"No parcel listings found.")}const i=new Map;for(const t of n){const e=t.bitmapNumber,n=i.get(e)||[];n.push(t),i.set(e,n)}const a=Array.from(i.keys()).sort((e,t)=>e-t),o=e=>{const t=(i.get(e)||[]).slice().sort((e,t)=>{const n=e.parcelNumber,r=t.parcelNumber;return n!==r?n-r:(null===e.price?Number.POSITIVE_INFINITY:e.price)-(null===t.price?Number.POSITIVE_INFINITY:t.price)}),n=new Map;for(const i of t){const e=i.parcelNumber;if(!Number.isFinite(e)||e<0)continue;const t=n.get(e),r=null===i.price?Number.POSITIVE_INFINITY:i.price,a=t?null===t.price?Number.POSITIVE_INFINITY:t.price:Number.POSITIVE_INFINITY;(!t||r<a)&&n.set(e,i)}const r=Array.from(n.keys()).sort((e,t)=>e-t);return{bitmapNumber:e,items:t,cheapestByParcel:n,highlight:r}};if(null!==yn){const e=Number(yn);if(!Number.isFinite(e)||!i.has(Math.trunc(e)))return Pc.createElement("div",{className:"flex flex-col gap-3"},Pc.createElement("div",{className:"text-xs text-neutral-500"},"Selected bitmap not found in current listings."));const t=o(Math.trunc(e)),n=t.bitmapNumber,a=t.items,s=t.cheapestByParcel,l=t.highlight,c=Sn,u=(()=>{if(c){const e=c?.collection||null,t=Number(e?.parcelNumber);if(Number.isFinite(t))return Math.trunc(t)}const e=Number(wn);return Number.isFinite(e)?Math.trunc(e):null})();return Pc.createElement("div",{className:"flex flex-col gap-2"},Pc.createElement("div",{className:"flex flex-wrap items-center justify-between gap-x-3 gap-y-2"},Pc.createElement("div",{className:"flex items-center gap-2"},Pc.createElement("button",{type:"button",onClick:()=>xn(null),className:"px-3 py-1.5 text-xs font-semibold rounded-lg bg-neutral-950/30 text-neutral-200 border border-neutral-800/60 hover:border-sky-500/25",title:"Back to bitmap list"},"Back"),Pc.createElement("div",{className:"text-xs text-neutral-400 whitespace-nowrap"},Pc.createElement("span",{className:"font-semibold text-neutral-200"},n,".bitmap")," \u2022 ",l.length," parcels listed")),Pc.createElement("div",{className:"flex items-center gap-2"},Pc.createElement("div",{className:"text-[11px] text-neutral-500 whitespace-nowrap"},"Click a ",Pc.createElement("span",{className:"text-neutral-200"},"green")," parcel to select."),Pc.createElement("button",{type:"button",disabled:!c,onClick:()=>c&&r(c),className:"px-3 py-1.5 text-xs font-semibold rounded-lg border transition "+(c?"bg-green-500/20 border-green-500/40 text-green-200 hover:bg-green-500/25":"bg-neutral-950/20 border-neutral-800/60 text-neutral-500 cursor-not-allowed"),title:c?"Continue to checkout":"Select a parcel first"},"Continue"))),Pc.createElement("div",{className:"bg-neutral-900/40 border border-neutral-800/60 rounded-xl p-3"},Pc.createElement("div",{className:"grid grid-cols-1 md:grid-cols-[minmax(260px,520px)_1fr] gap-3 items-start",style:{"--parcel-bitmap-size":"max(220px, min(520px, calc(100svh - 340px)))"}},Pc.createElement("div",{className:"w-full flex justify-center"},Pc.createElement("div",{className:"bg-black",style:{width:"min(100%, var(--parcel-bitmap-size))",maxWidth:"var(--parcel-bitmap-size)",aspectRatio:"1 / 1"}},Pc.createElement("div",{className:"w-full h-full p-1"},Pc.createElement("div",{className:"w-full h-full rounded bg-black overflow-hidden"},Pc.createElement(BN,{blockNumber:n,highlightParcels:l,highlightColor:"rgb(34 197 94)",selectedParcels:null===u?[]:[u],selectedColor:"rgb(34 211 238)",size:"auto",className:"w-full h-full",onParcelClick:e=>{const t=s.get(e);t?.listing&&(vn(e),En(t.listing))}}))))),Pc.createElement("div",{className:"flex flex-col gap-2 min-h-0 w-full max-w-[560px] mx-auto",style:{maxHeight:"var(--parcel-bitmap-size)"}},c?Pc.createElement("div",{className:"bg-neutral-950/40 border border-neutral-800/60 rounded-xl p-3"},Pc.createElement("div",{className:"flex items-start justify-between gap-3"},Pc.createElement("div",{className:"min-w-0"},Pc.createElement("div",{className:"text-[11px] font-semibold text-neutral-200"},"Selected parcel"),Pc.createElement("div",{className:"mt-1 text-[11px] text-neutral-400"},Pc.createElement("span",{className:"font-mono text-sm sm:text-base font-semibold text-cyan-200 break-all"},null===u?"\u2014":`${u}.${n}.bitmap`)),Pc.createElement("div",{className:"mt-1 text-[11px] text-neutral-400"},"Expected text: ",Pc.createElement("span",{className:"font-mono text-neutral-200"},null===u?"\u2014":`${u}.${n}.bitmap`)),Pc.createElement("div",{className:"mt-1 text-[11px] text-neutral-500 font-mono break-all"},String(c?.inscriptionId||"").trim()?`insc ${String(c.inscriptionId).trim()}`:"insc \u2014")),Pc.createElement("div",{className:"shrink-0 text-right"},Pc.createElement("div",{className:"text-[10px] uppercase tracking-wider text-neutral-500"},"Price"),Pc.createElement("div",{className:"text-lg sm:text-xl font-extrabold tracking-tight text-amber-300 drop-shadow-[0_0_10px_rgba(251,191,36,0.18)]"},(()=>{const e=Number(c?.price);return!Number.isFinite(e)||e<=0?"Price TBD":Pr(Math.trunc(e))})()))),Pc.createElement("div",{className:"mt-2 flex items-center gap-2"},Pc.createElement("button",{type:"button",onClick:()=>r(c),className:"px-3 py-1.5 text-xs font-semibold rounded-lg bg-green-500/20 border border-green-500/40 text-green-200 hover:bg-green-500/25"},"Continue to checkout"),Pc.createElement("button",{type:"button",onClick:()=>{vn(null),En(null)},className:"px-3 py-1.5 text-xs font-semibold rounded-lg bg-neutral-950/20 border border-neutral-800/60 text-neutral-200 hover:border-sky-500/25"},"Clear"))):null,Pc.createElement("div",{className:"text-xs font-semibold text-neutral-200"},"For sale"),Pc.createElement("div",{className:"flex-1 min-h-0 overflow-auto border border-neutral-800/60 rounded-lg"},a.map(e=>Pc.createElement("button",{key:`${n}:${e.parcelNumber}:${e.listing?.inscriptionId||""}`,onClick:()=>{vn(e.parcelNumber),En(e.listing)},className:"w-full flex items-center justify-between gap-3 px-3 py-2 text-left text-xs transition-colors "+(null!==u&&e.parcelNumber===u?"bg-cyan-500/10 border-l-2 border-cyan-400/80":"hover:bg-neutral-800/40"),title:null!==u&&e.parcelNumber===u?"Selected":"Select this parcel listing"},Pc.createElement("div",{className:"flex items-center gap-2 min-w-0"},Pc.createElement("span",{className:"inline-flex items-center justify-center w-2.5 h-2.5 rounded-full "+(null!==u&&e.parcelNumber===u?"bg-cyan-400 shadow-[0_0_12px_rgba(34,211,238,0.45)]":"bg-green-500/80")}),Pc.createElement("div",{className:"min-w-0"},Pc.createElement("div",{className:"font-mono text-neutral-200 truncate"},`${e.parcelNumber}.${n}.bitmap`),Pc.createElement("div",{className:"text-[11px] text-neutral-500 truncate"},String(e.listing?.inscriptionId||"").trim()?`insc ${String(e.listing.inscriptionId).trim()}`:"insc \u2014"))),Pc.createElement("div",{className:"shrink-0 flex items-center gap-2"},Pc.createElement("span",{className:"px-2.5 py-1 rounded-md text-xs font-bold bg-neutral-950/40 border border-neutral-800/60 text-amber-200"},null===e.price?"Price TBD":Pr(e.price)),Pc.createElement("span",{className:"text-neutral-500"},"\u2192")))))))))}return Pc.createElement("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-2"},a.map(e=>{const t=o(e);return Pc.createElement(VN,{key:String(e),bitmapNumber:e,parcelsForSaleCount:t.highlight.length,highlightParcels:t.highlight,onOpen:()=>xn(e)})}))}return Pc.createElement("div",{className:c},t.map(e=>Pc.createElement(qN,{key:e.inscriptionId,listing:e,onSelect:()=>r(e),onShowQr:t=>i(e,t)})))})()):Pc.createElement(Pc.Fragment,null,Pc.createElement("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3"},(Ur||[]).slice(0,Rt).map(e=>Pc.createElement(UI,{key:e.key,collectionKey:e.key,title:e.title,description:e.description,statsLine:e.statsLine,thumbId:e.thumbId,thumbContentType:e.thumbContentType,fallbackImageInscriptionId:e.fallbackImageInscriptionId,isCatchAll:!!e.isCatchAll,onOpen:()=>(async e=>{const t=String(e?.key||"").trim();if(!t)return;Bt(e),_t(!1),ft(t),xn(null),Lt(!1);const n=t.toLowerCase();Zn.has(n)||ar.current.has(n)?ir(null):ir(n),st([]);const{idbPageKey:r,cacheKey:i}=Gn(t),a=yt?.[i];if(Array.isArray(a)&&a.length>0)return st(a),void Cr({forceRefresh:!0,page:t,collection:e}).catch(()=>{});try{const n=await ui(Xn(r),{maxAgeMs:lr(t)});if(Array.isArray(n)&&n.length>0)return st(n),xt(e=>({...e||{},[i]:n})),void Cr({forceRefresh:!0,page:t,collection:e}).catch(()=>{})}catch{}await Cr({forceRefresh:!0,page:t,collection:e})})(e.raw)})))))})()),(br||gr)&&"buy"===Te&&Pc.createElement("div",{className:"w-full flex-1 min-h-0 flex flex-col"},Pc.createElement("div",{className:"mx-auto w-full max-w-[1200px] grid grid-cols-1 md:grid-cols-[minmax(0,520px)_minmax(0,600px)] gap-2 sm:gap-3 md:gap-4 items-start"},Pc.createElement("div",{className:"w-full min-w-0"},Pc.createElement("div",{className:"group relative flex flex-col rounded-xl sm:rounded-2xl p-2 sm:p-3 md:p-4 bg-gradient-to-b from-neutral-900/60 to-neutral-950/80 border border-neutral-800/60 shadow-[0_0_0_1px_rgba(59,130,246,0.15),0_0_30px_rgba(59,130,246,0.10)] hover:translate-y-[-1px] hover:shadow-xl transition"},Pc.createElement("div",{className:"relative w-full aspect-square rounded-xl overflow-hidden border border-neutral-800/70 bg-black",onTouchStart:e=>{1===e.touches.length&&(hn.current={x:e.touches[0].clientX,y:e.touches[0].clientY})},onTouchEnd:e=>{const t=hn.current;if(hn.current=null,!t||e.changedTouches.length<1)return;const n=e.changedTouches[0].clientX-t.x,r=e.changedTouches[0].clientY-t.y;Math.abs(n)>50&&Math.abs(n)>1.5*Math.abs(r)&&bn(n<0?1:-1)}},Pc.createElement("div",{className:"absolute top-2 left-2 z-10 flex flex-wrap gap-1"},Nr&&null!==Sr?Pc.createElement("span",{className:"text-[11px] px-2 py-1 rounded-md bg-neutral-950/60 border border-neutral-800/60 text-neutral-200"},"Bitmap ",Pc.createElement("span",{className:"font-mono"},Sr,".bitmap")):null,(()=>{const e=Dt||Z,t=e?.number??e?.inscriptionNumber??e?.inscription_number;return null==t?null:Pc.createElement("span",{className:"text-[11px] px-2 py-1 rounded-md bg-neutral-950/60 border border-neutral-800/60 text-neutral-200"},"#",Pc.createElement("span",{className:"font-mono"},String(t)))})(),jt?.key?Pc.createElement("span",{className:"text-[11px] px-2 py-1 rounded-md bg-neutral-950/60 border border-neutral-800/60 text-neutral-300"},String(jt?.name||jt?.title||jt?.key)):null),Pc.createElement("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/0 via-black/0 to-black/35"}),Ir.isParcel&&(null!==Ir.bitmapNumber||Number.isFinite(Number(Ar?.result?.bitmapNumber))&&null!=Ar?.result?.bitmapNumber)?Pc.createElement(Pc.Fragment,null,Pc.createElement(BN,{blockNumber:null!==Ir.bitmapNumber?Ir.bitmapNumber:Math.trunc(Number(Ar?.result?.bitmapNumber)),highlightParcels:null!==Ir.parcelNumber?[Ir.parcelNumber]:Number.isFinite(Number(Ar?.result?.parcelNumber))?[Math.trunc(Number(Ar?.result?.parcelNumber))]:[],highlightColor:"rgb(34 197 94)",size:"auto",className:"w-full h-full"}),Pc.createElement("div",{className:"absolute bottom-2 right-2 w-28 h-20 sm:w-32 sm:h-24 rounded-lg overflow-hidden border border-neutral-800/70 bg-neutral-950/70"},Pc.createElement(bN,{inscription:Dt||Z,width:"100%",height:"100%"}))):Nr&&null!==Sr?Pc.createElement(BN,{blockNumber:Sr,bitmonPattern:Er,size:"auto",className:"w-full h-full"}):Pc.createElement(bN,{inscription:Dt||Z,width:"100%",height:"100%"}),pn.current.length>1&&fn>=0?Pc.createElement(Pc.Fragment,null,fn>0&&Pc.createElement("button",{onClick:e=>{e.stopPropagation(),bn(-1)},className:"absolute left-1.5 top-1/2 -translate-y-1/2 z-20 w-9 h-9 sm:w-10 sm:h-10 flex items-center justify-center rounded-full bg-black/50 backdrop-blur-sm border border-neutral-700/50 text-neutral-300 hover:text-white hover:bg-black/70 active:scale-95 transition-all touch-manipulation",title:"Previous listing (\u2190 arrow key)","aria-label":"Previous listing"},Pc.createElement("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5},Pc.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"}))),fn<pn.current.length-1&&Pc.createElement("button",{onClick:e=>{e.stopPropagation(),bn(1)},className:"absolute right-1.5 top-1/2 -translate-y-1/2 z-20 w-9 h-9 sm:w-10 sm:h-10 flex items-center justify-center rounded-full bg-black/50 backdrop-blur-sm border border-neutral-700/50 text-neutral-300 hover:text-white hover:bg-black/70 active:scale-95 transition-all touch-manipulation",title:"Next listing (\u2192 arrow key)","aria-label":"Next listing"},Pc.createElement("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5},Pc.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"}))),Pc.createElement("div",{className:"absolute bottom-2 left-1/2 -translate-x-1/2 z-20 px-2.5 py-1 rounded-full bg-black/60 backdrop-blur-sm border border-neutral-700/40 text-[11px] text-neutral-300 font-mono tabular-nums select-none"},fn+1," / ",pn.current.length)):null),Pc.createElement("div",{className:"mt-3 flex items-start justify-between gap-3"},Pc.createElement("div",{className:"min-w-0"},Pc.createElement("div",{className:"text-xs font-semibold text-neutral-200 truncate"},"Asset"),Pc.createElement("div",{className:"text-[11px] text-neutral-500 font-mono break-all"},String((Dt||Z)?.id||(Dt||Z)?.inscriptionId||qt||H||"").trim()||"(no inscription id)")),Ut?Pc.createElement("div",{className:"shrink-0 text-right"},Pc.createElement("div",{className:"text-[11px] text-neutral-500"},"Price"),Pc.createElement("div",{className:"text-sm font-extrabold tracking-tight text-amber-300 drop-shadow-[0_0_10px_rgba(251,191,36,0.15)]"},ON(Ut)," BTC")):null))),Pc.createElement("div",{className:"w-full min-w-0 flex flex-col"},Pc.createElement("div",{className:"w-full max-w-none sm:max-w-[600px] mx-auto md:mx-0 rounded-xl sm:rounded-2xl bg-neutral-900/40 border border-neutral-800/60 p-2 sm:p-3 md:p-4 flex-1 flex flex-col"},Pc.createElement("div",{className:"flex flex-col gap-4 flex-1"},gr?Pc.createElement(Pc.Fragment,null,Pc.createElement("div",{className:"flex items-start justify-between gap-3"},Pc.createElement("div",{className:"min-w-0"},jt?.key?Pc.createElement("div",{className:"text-sm font-semibold text-neutral-200 truncate"},String(jt?.name||jt?.title||jt?.key)):Pc.createElement("div",{className:"text-sm font-semibold text-neutral-200"},"Purchase"),(()=>{const e=Dt||Z,t=e?.number??e?.inscriptionNumber??e?.inscription_number;return null!=t?Pc.createElement("div",{className:"text-[11px] text-neutral-500"},"Inscription ",Pc.createElement("span",{className:"font-mono"},"#",String(t))):Pc.createElement("div",{className:"text-[11px] text-neutral-500"},"Your wallet will prompt you to approve & sign.")})()),Pc.createElement("div",{className:"shrink-0 text-right"},Pc.createElement("div",{className:"text-[11px] text-neutral-500"},"Price"),Pc.createElement("div",{className:"text-3xl font-extrabold tracking-tight text-amber-300 drop-shadow-[0_0_10px_rgba(251,191,36,0.15)]"},Ut?`${ON(Ut)} BTC`:"\u2014"))),Ir.isParcel?Pc.createElement("div",{className:"bg-neutral-900/40 border border-neutral-800/60 rounded-xl p-3"},Pc.createElement("div",{className:"text-xs font-semibold text-neutral-200 mb-2"},"Parcel details"),Pc.createElement("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-2 text-[11px]"},Pc.createElement("div",{className:"text-neutral-400"},"Bitmap",Pc.createElement("div",{className:"text-neutral-200 font-mono"},null!==(null!==Ir.bitmapNumber?Ir.bitmapNumber:Number.isFinite(Number(Ar?.result?.bitmapNumber))?Math.trunc(Number(Ar?.result?.bitmapNumber)):null)?`${null!==Ir.bitmapNumber?Ir.bitmapNumber:Math.trunc(Number(Ar?.result?.bitmapNumber))}.bitmap`:"\u2014")),Pc.createElement("div",{className:"text-neutral-400"},"Parcel",Pc.createElement("div",{className:"text-neutral-200 font-mono"},null!==(null!==Ir.parcelNumber?Ir.parcelNumber:Number.isFinite(Number(Ar?.result?.parcelNumber))?Math.trunc(Number(Ar?.result?.parcelNumber)):null)?`#${null!==Ir.parcelNumber?Ir.parcelNumber:Math.trunc(Number(Ar?.result?.parcelNumber))}`:"\u2014")),Pc.createElement("div",{className:"text-neutral-400 sm:col-span-2"},"Inscription id",Pc.createElement("div",{className:"text-neutral-200 font-mono break-all"},String(Dt?.id||Dt?.inscriptionId||qt||H||"").trim()||"\u2014")),Pc.createElement("div",{className:"text-neutral-400 sm:col-span-2"},"Expected text content",Pc.createElement("div",{className:"text-neutral-200 font-mono break-all"},(()=>{const e=null!==Ir.bitmapNumber?Ir.bitmapNumber:Number.isFinite(Number(Ar?.result?.bitmapNumber))?Math.trunc(Number(Ar?.result?.bitmapNumber)):null,t=null!==Ir.parcelNumber?Ir.parcelNumber:Number.isFinite(Number(Ar?.result?.parcelNumber))?Math.trunc(Number(Ar?.result?.parcelNumber)):null;return null===e||null===t?"\u2014":`${t}.${e}.bitmap`})())),Pc.createElement("div",{className:"sm:col-span-2"},"validating"===Ar.status?Pc.createElement("div",{className:"text-[11px] text-neutral-400"},"Validating parcel\u2026"):"valid"===Ar.status?Pc.createElement("div",{className:"text-[11px] text-green-300 bg-green-500/10 border border-green-500/30 rounded-lg px-3 py-2"},"Verified parcel inscription (bitmap + parcel match)."):"invalid"===Ar.status&&Ar.error?Pc.createElement("div",{className:"text-[11px] text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2"},Ar.error):null))):null,Pc.createElement("div",{className:"flex flex-col gap-3"},Pc.createElement("div",{className:"text-xs font-semibold text-neutral-200"},"Purchase details"),Pc.createElement("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-2 text-[11px]"},jt?.key?Pc.createElement("div",{className:"text-neutral-400"},"Collection",Pc.createElement("div",{className:"text-neutral-200 font-medium"},String(jt?.name||jt?.title||jt?.key))):null,(()=>{const e=Dt||Z,t=e?.number??e?.inscriptionNumber??e?.inscription_number;return null==t?null:Pc.createElement("div",{className:"text-neutral-400"},"Inscription #",Pc.createElement("div",{className:"text-neutral-200 font-mono"},String(t)))})(),Pc.createElement("div",{className:"text-neutral-400 sm:col-span-2"},"Inscription ID",Pc.createElement("div",{className:"text-neutral-200 font-mono break-all"},String(Dt?.id||Dt?.inscriptionId||qt||H||"").trim()||"\u2014")),Ut?Pc.createElement("div",{className:"text-neutral-400"},"Price",Pc.createElement("div",{className:"text-amber-300 font-semibold"},ON(Ut)," BTC")):null),Lr(ze)?Pc.createElement("div",{className:"flex items-center gap-2 text-[11px] text-green-400/80"},Pc.createElement("span",null,"\u2713"),Pc.createElement("span",null,"Offer loaded \u2014 ready to purchase.")):Pc.createElement("div",{className:"flex items-center gap-2 text-[11px] text-amber-400/80"},Pc.createElement("span",null,"\u23f3"),Pc.createElement("span",null,"Paste or scan a seller offer PSBT to continue."))),Pc.createElement("div",{className:"bg-neutral-900/40 border border-neutral-800/60 rounded-xl p-3"},Pc.createElement("div",{className:"flex items-center justify-between gap-2"},Pc.createElement("div",{className:"text-xs font-semibold text-neutral-200"},"Seller offer (PSBT)"),Pc.createElement("div",{className:"flex items-center gap-2"},Pc.createElement("button",{type:"button",onClick:()=>Ve(e=>!e),className:"px-3 py-1.5 text-[11px] font-semibold rounded-lg bg-neutral-800 hover:bg-neutral-700 text-white transition-colors",title:"Show / hide offer text"},!je&&He&&String(ze||"").trim()?"Edit / Paste":"Hide"),Pc.createElement("button",{type:"button",onClick:()=>{Qe(""),Ye(""),Ke?.current?.click?.()},className:"px-3 py-1.5 text-[11px] font-semibold rounded-lg bg-neutral-800 hover:bg-neutral-700 text-white transition-colors",title:"Use your camera to take a photo of a QR code"},"Scan QR Photo"),Pc.createElement("button",{type:"button",onClick:async()=>{try{Qe(""),Ye("Reading clipboard\u2026");const e=await navigator.clipboard.readText(),t=String(e||"").trim();if(!t)throw new Error("Clipboard is empty");await Mr(t,"Clipboard")}catch(Pk){Ye(""),Qe(Pk?.message||String(Pk))}},className:"px-3 py-1.5 text-[11px] font-semibold rounded-lg bg-neutral-800 hover:bg-neutral-700 text-white transition-colors",title:"Scan with your phone Camera app, then copy and paste here"},"Paste Scan"),Pc.createElement("button",{type:"button",onClick:()=>{Qe(""),Ye(""),De(""),We(!1),Ve(!0)},className:"px-3 py-1.5 text-[11px] font-semibold rounded-lg bg-neutral-800 hover:bg-neutral-700 text-white transition-colors",title:"Clear offer"},"Clear"))),Pc.createElement("div",{className:"mt-1 text-[11px] text-neutral-500"},"Paste an offer PSBT (or an offer URL with a ",Pc.createElement("span",{className:"font-mono"},"psbt=")," param), scan from a photo, or use ",Pc.createElement("span",{className:"font-semibold"},"Paste Scan")," after scanning with your phone\u2019s Camera app."),He?Pc.createElement("div",{className:"mt-2 text-[11px] text-neutral-400"},"Prefilled from listing. You can override it."):null,Pc.createElement("input",{ref:Ke,type:"file",accept:"image/*",capture:"environment",className:"hidden",onChange:async e=>{const t=e?.target?.files?.[0]||null;try{e?.target&&(e.target.value="")}catch{}await Rr(t)}}),!je&&He&&String(ze||"").trim()?Pc.createElement("div",{className:"mt-2 text-[11px] text-neutral-400 font-mono break-all"},Fr(ze)||"(empty)"):Pc.createElement("textarea",{value:ze||"",onChange:e=>{De(e.target.value),We(!1)},className:"mt-2 w-full px-2.5 py-2 text-xs bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-purple-500/60 font-mono",placeholder:"Paste seller offer PSBT here (base64/hex), or scan a QR photo",spellCheck:!1,rows:5}),Ge?Pc.createElement("div",{className:"mt-2 text-[11px] text-green-300 bg-green-500/10 border border-green-500/30 rounded-lg px-3 py-2"},Ge):null,Je?Pc.createElement("div",{className:"mt-2 text-[11px] text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2"},Je):null,et?Pc.createElement("div",{className:"mt-2 text-[11px] text-blue-200 bg-blue-500/10 border border-blue-500/30 rounded-lg px-3 py-2"},et):null,nt?Pc.createElement("div",{className:"mt-2 text-[11px] text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2"},nt):null),Pc.createElement("div",{className:"flex flex-col gap-2"},Pc.createElement(Br,null),ie?Array.isArray(ie)?Pc.createElement(NE,{steps:ie}):Pc.createElement("div",{className:"text-xs text-green-300 bg-green-500/10 border border-green-500/30 rounded-lg px-3 py-2"},String(ie)):null),null,ae?Pc.createElement("div",{className:"text-xs text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2"},ae):null):Pc.createElement(Pc.Fragment,null,Pc.createElement("div",{className:"flex items-start justify-between gap-3"},Pc.createElement("div",{className:"min-w-0"},jt?.key?Pc.createElement("div",{className:"text-sm font-semibold text-neutral-200 truncate"},String(jt?.name||jt?.title||jt?.key)):Pc.createElement("div",{className:"text-xs font-semibold text-neutral-200"},"Checkout"),(()=>{const e=Dt||Z,t=e?.number??e?.inscriptionNumber??e?.inscription_number;return null!=t?Pc.createElement("div",{className:"text-[11px] text-neutral-500"},"Inscription ",Pc.createElement("span",{className:"font-mono"},"#",String(t))):Pc.createElement("div",{className:"text-[11px] text-neutral-500"},"Your wallet will prompt you to approve & broadcast.")})()),Pc.createElement("div",{className:"shrink-0 text-right"},Pc.createElement("div",{className:"text-[11px] text-neutral-500"},"Price"),Pc.createElement("div",{className:"text-3xl font-extrabold tracking-tight text-amber-300 drop-shadow-[0_0_10px_rgba(251,191,36,0.15)]"},Ut?`${ON(Ut)} BTC`:"\u2014"))),Ir.isParcel?Pc.createElement("div",{className:"bg-neutral-900/40 border border-neutral-800/60 rounded-xl p-3"},Pc.createElement("div",{className:"text-xs font-semibold text-neutral-200 mb-2"},"Parcel details"),Pc.createElement("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-2 text-[11px]"},Pc.createElement("div",{className:"text-neutral-400"},"Bitmap",Pc.createElement("div",{className:"text-neutral-200 font-mono"},null!==(null!==Ir.bitmapNumber?Ir.bitmapNumber:Number.isFinite(Number(Ar?.result?.bitmapNumber))?Math.trunc(Number(Ar?.result?.bitmapNumber)):null)?`${null!==Ir.bitmapNumber?Ir.bitmapNumber:Math.trunc(Number(Ar?.result?.bitmapNumber))}.bitmap`:"\u2014")),Pc.createElement("div",{className:"text-neutral-400"},"Parcel",Pc.createElement("div",{className:"text-neutral-200 font-mono"},null!==(null!==Ir.parcelNumber?Ir.parcelNumber:Number.isFinite(Number(Ar?.result?.parcelNumber))?Math.trunc(Number(Ar?.result?.parcelNumber)):null)?`#${null!==Ir.parcelNumber?Ir.parcelNumber:Math.trunc(Number(Ar?.result?.parcelNumber))}`:"\u2014")),Pc.createElement("div",{className:"text-neutral-400 sm:col-span-2"},"Expected text content",Pc.createElement("div",{className:"text-neutral-200 font-mono break-all"},(()=>{const e=null!==Ir.bitmapNumber?Ir.bitmapNumber:Number.isFinite(Number(Ar?.result?.bitmapNumber))?Math.trunc(Number(Ar?.result?.bitmapNumber)):null,t=null!==Ir.parcelNumber?Ir.parcelNumber:Number.isFinite(Number(Ar?.result?.parcelNumber))?Math.trunc(Number(Ar?.result?.parcelNumber)):null;return null===e||null===t?"\u2014":`${t}.${e}.bitmap`})())),Pc.createElement("div",{className:"sm:col-span-2"},"validating"===Ar.status?Pc.createElement("div",{className:"text-[11px] text-neutral-400"},"Validating parcel\u2026"):"valid"===Ar.status?Pc.createElement("div",{className:"text-[11px] text-green-300 bg-green-500/10 border border-green-500/30 rounded-lg px-3 py-2"},"Verified parcel inscription (bitmap + parcel match)."):"invalid"===Ar.status&&Ar.error?Pc.createElement("div",{className:"text-[11px] text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2"},Ar.error):null))):null,Pc.createElement("div",{className:"flex flex-col gap-2"},Pc.createElement("label",{className:"text-[11px] font-semibold uppercase tracking-wide text-neutral-500"},"Inscription ID / Reveal txid"),Pc.createElement("input",{type:"text",value:H||"",readOnly:!!String(qt||"").trim(),onChange:e=>{String(qt||"").trim()||W?.(e.target.value)},className:"w-full px-3 py-2.5 text-sm bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-sky-500/60 focus:ring-1 focus:ring-sky-500/20 font-mono",placeholder:"Paste inscription ID (<txid>i<index>) or reveal txid",spellCheck:!1,autoCapitalize:"none",autoCorrect:"off"}),String(qt||"").trim()?Pc.createElement("div",{className:"text-[11px] text-neutral-500"},"Prefilled from the selected listing (inscription id, locked)."):null,Pc.createElement("div",{className:"text-[11px] text-neutral-500"},"Keep fee inputs boring and precise.")),Ut&&Pc.createElement("div",{className:"bg-neutral-900/40 border border-neutral-800/60 rounded-xl p-3"},Pc.createElement("div",{className:"text-xs font-semibold text-neutral-200 mb-1"},"Estimated total"),Pc.createElement("div",{className:"flex flex-col gap-1.5 text-xs"},Pc.createElement("div",{className:"flex justify-between items-center"},Pc.createElement("span",{className:"text-neutral-400"},"Listing Price:"),Pc.createElement("span",{className:"font-mono text-neutral-200"},ON(Ut)," BTC")),Pc.createElement("div",{className:"flex justify-between items-center"},Pc.createElement("span",{className:"text-neutral-400"},"Est. Network Fees:"),Pc.createElement("span",{className:"font-mono text-neutral-300"},"~0.00001-0.00002 BTC")),Pc.createElement("div",{className:"border-t border-neutral-800/60 my-1"}),Pc.createElement("div",{className:"flex justify-between items-center font-semibold"},Pc.createElement("span",{className:"text-neutral-200"},"Total Approx:"),Pc.createElement("span",{className:"font-mono text-amber-300"},ON(Ut+1500)," BTC")),Pc.createElement("div",{className:"text-[10px] text-neutral-500 mt-1"},"Final fees depend on transaction size and network conditions"))),Pc.createElement("div",{className:"flex flex-col gap-2"},Pc.createElement(Br,null)),Kt?Pc.createElement("div",{className:"text-xs text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2"},Kt):null,J?Array.isArray(J)?Pc.createElement(NE,{steps:J}):Pc.createElement("div",{className:"text-xs text-green-300 bg-green-500/10 border border-green-500/30 rounded-lg px-3 py-2"},String(J)):null,Q?Pc.createElement("div",{className:"text-xs text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2"},Q):null,"function"==typeof X&&q?Pc.createElement("div",{className:"flex flex-col gap-2"},Pc.createElement("div",{className:"text-[11px] text-neutral-400"},"Your wallet needs additional spendable UTXOs to complete this buy."),Pc.createElement("button",{onClick:X,disabled:K,className:K?"w-full px-3 py-1.5 text-xs font-semibold rounded-lg bg-neutral-800 text-neutral-500 cursor-not-allowed":"w-full px-3 py-1.5 text-xs font-semibold rounded-lg bg-neutral-800 hover:bg-neutral-700 text-white transition-colors","aria-label":"Create funding split transaction",title:"Create a funding transaction that splits UTXOs for payment"},"Create Split Funding Tx"),G?Pc.createElement("div",{className:"text-xs text-green-300 bg-green-500/10 border border-green-500/30 rounded-lg px-3 py-2"},G):null,Y?Pc.createElement("div",{className:"text-xs text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2"},Y):null):null))),Pc.createElement("div",{className:"sticky bottom-0 z-[50] mt-2 -mx-0 md:-mx-0"},Pc.createElement("div",{className:"bg-neutral-950/95 backdrop-blur-sm border-t border-neutral-800/60 rounded-none sm:rounded-b-2xl px-2 sm:px-4 py-2 sm:py-3"},Se?gr?Pc.createElement("button",{onClick:()=>{Xe(!0),oe?.(Lr(ze))},disabled:!oe||!Lr(ze),className:oe&&Lr(ze)?"w-full px-4 py-3 text-sm font-semibold rounded-lg bg-emerald-500 hover:bg-emerald-400 text-neutral-950 transition-colors shadow-[0_0_0_1px_rgba(16,185,129,0.35),0_10px_30px_rgba(16,185,129,0.15)] active:translate-y-[1px]":"w-full px-4 py-3 text-sm font-semibold rounded-lg bg-neutral-800 text-neutral-500 cursor-not-allowed","aria-label":"Buy listing",title:"Buy this listing"},"Buy"):gr||Ut||Lr(ze)||!String(qt||"").trim()?Pc.createElement("button",{onClick:async()=>{if(Gt(null),"bitmap"===jt?.type&&jt?.verified||"bitmap"===jt?.key){const e=Dt?.id||Dt?.inscriptionId||Dt?.inscription_id||null;if(!e)return void Gt("Cannot validate bitmap: missing inscription id. Try refreshing the listing.");try{Qt(!0);const t=await Us(String(e));if(!t||"bitmap"!==t.type||!t.verified)return void Gt("This listing is not OCI-verified as a bitmap. Refusing to buy.");const n=Number(jt?.bitmapNumber);if(Number.isFinite(n)&&t.bitmapNumber!==n)return void Gt(`Bitmap number mismatch (claimed ${n}, OCI says ${t.bitmapNumber}). Refusing to buy.`)}finally{Qt(!1)}}if("parcel"===String(jt?.type||"").toLowerCase()&&jt?.verified||"parcel"===String(jt?.key||"").toLowerCase()){const e=Dt?.id||Dt?.inscriptionId||Dt?.inscription_id||null;if(!e)return void Gt("Cannot validate parcel: missing inscription id. Try refreshing the listing.");try{Qt(!0);const{detectAndVerifyParcelByInscriptionId:t}=await n(async()=>{const{detectAndVerifyParcelByInscriptionId:e}=await Promise.resolve().then(()=>qs);return{detectAndVerifyParcelByInscriptionId:e}},__VITE_PRELOAD__),r=await t(String(e));if(!r||"parcel"!==r.type||!r.verified)return void Gt("This listing is not parcel-verified. Refusing to buy.");const i=Number(jt?.parcelNumber),a=Number(jt?.bitmapNumber);if(Number.isFinite(i)&&r.parcelNumber!==i)return void Gt(`Parcel number mismatch (claimed ${i}, content+rules say ${r.parcelNumber}). Refusing to buy.`);if(Number.isFinite(a)&&r.bitmapNumber!==a)return void Gt(`Bitmap number mismatch (claimed ${a}, content+rules say ${r.bitmapNumber}). Refusing to buy.`)}finally{Qt(!1)}}await(j?.())},disabled:V||Yt,className:V||Yt?"w-full px-4 py-3 text-sm font-semibold rounded-lg bg-neutral-800 text-neutral-500 cursor-not-allowed":"w-full px-4 py-3 text-sm font-semibold rounded-lg bg-emerald-500 hover:bg-emerald-400 text-neutral-950 transition-colors shadow-[0_0_0_1px_rgba(16,185,129,0.35),0_10px_30px_rgba(16,185,129,0.15)] active:translate-y-[1px]","aria-label":"Buy from reveal txid",title:q?"Buy may require splitting payment UTXOs.":"Buy the listed asset"},Yt?"Validating...":`Buy${Ut?` \u2014 ${ON(Ut)} BTC`:""}${q?" (Needs Funding)":""}`):Pc.createElement("div",{className:"w-full px-4 py-3 text-sm font-semibold rounded-lg bg-neutral-800/60 border border-neutral-700/40 text-neutral-400 text-center select-none"},"Not Listed \u2014 View Only"):Pc.createElement("button",{onClick:()=>Ee?.(),className:"w-full px-4 py-3 text-sm font-semibold rounded-lg bg-purple-600 hover:bg-purple-500 text-white transition-colors shadow-[0_0_0_1px_rgba(168,85,247,0.35),0_10px_30px_rgba(168,85,247,0.15)] active:translate-y-[1px]","aria-label":"Connect wallet to buy"},"Connect Wallet to Buy")))))),(br||gr)&&"sell"===Te&&Pc.createElement("div",{className:"grid grid-cols-1 sm:grid-cols-[200px_1fr] gap-2 sm:gap-3 md:gap-4 items-start"},Pc.createElement("div",{className:"w-full sm:w-[200px] max-w-[220px] sm:max-w-[280px] mx-auto sm:mx-0 flex flex-col gap-2"},Pc.createElement("div",{className:"aspect-square relative"},Pc.createElement(bN,{inscription:e,width:"100%",height:"100%"}),r>1&&Pc.createElement("div",{className:"absolute top-1.5 right-1.5 px-2 py-0.5 rounded-full bg-purple-600/90 text-white text-[11px] font-semibold shadow-lg"},r," selected")),gs.enabled&&zn&&Pc.createElement("div",{className:"bg-neutral-900/50 border border-neutral-800/50 rounded-lg p-2.5 text-[10px] leading-relaxed text-neutral-500 space-y-1"},Pc.createElement("div",{className:"font-semibold text-purple-400 text-[11px] flex items-center gap-1"},"\ud83d\udc8e Indexing / provenance"),Pc.createElement("div",null,"Collection:"," ",Pc.createElement("span",{className:"font-mono font-semibold text-neutral-300"},$n&&"uncategorized"!==$n?Un?.name||$n:"uncategorized")),Pc.createElement("div",null,"Fee:"," ",Pc.createElement("span",{className:"font-mono font-semibold text-neutral-300"},Number(zn.value||0).toLocaleString()," sats")),Pc.createElement("div",null,"Address:"," ",Pc.createElement("span",{className:"font-mono text-neutral-400 break-all"},String(zn.address||""))),Pc.createElement("div",{className:"text-neutral-600"},$n&&"uncategorized"!==$n&&Dn?"Source: collection manifesto (registry).":"Source: default OODL indexing address."),Pc.createElement("div",{className:"text-neutral-600 italic"},"Included in the listing commit tx so indexers can discover & categorize the listing."))),Pc.createElement("div",{className:"flex flex-col gap-3"},br?Pc.createElement("div",{className:"text-xs text-neutral-300"},r>1?Pc.createElement(Pc.Fragment,null,Pc.createElement("div",{className:"font-semibold text-neutral-200 mb-1"},"Selected inscriptions (",r,")"),Pc.createElement("div",{className:"flex flex-wrap gap-1 mt-1"},(Array.isArray(t)?t:[]).slice(0,8).map((e,t)=>{const n=e?.id||e?.inscriptionId||e?.inscription_id||"",r=e?.number??e?.inscriptionNumber??e?.inscription_number;return Pc.createElement("span",{key:n||t,className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded bg-neutral-800/60 border border-neutral-700/40 text-[10px] font-mono text-neutral-400",title:n},null!=r?`#${r}`:`${String(n).slice(0,8)}\u2026`)}),r>8&&Pc.createElement("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded bg-neutral-800/60 text-[10px] text-neutral-500"},"+",r-8," more")),Pc.createElement("div",{className:"text-[11px] text-purple-400 mt-1.5"},"Set per-asset prices below in the Multi-Asset Listing section.")):Pc.createElement(Pc.Fragment,null,Pc.createElement("div",{className:"font-semibold text-neutral-200 mb-1"},"Selected inscription"),fr?Pc.createElement("div",null,Pc.createElement("div",{className:"font-mono text-[11px] text-neutral-300 break-all"},fr),null!=mr&&Pc.createElement("div",{className:"text-[11px] text-neutral-500 mt-0.5"},"#",mr),"bitmap"===Nn?.type&&Nn?.verified?Pc.createElement("div",{className:"text-[11px] text-neutral-400 mt-1"},"Collection: ",Pc.createElement("span",{className:"font-semibold text-neutral-200"},"Bitmaps")," ",Pc.createElement("span",{className:"font-mono text-neutral-300"},Nn.bitmapNumber,".bitmap")):null,"parcel"===Nn?.type&&Nn?.verified?Pc.createElement("div",{className:"text-[11px] text-neutral-400 mt-1"},"Collection: ",Pc.createElement("span",{className:"font-semibold text-neutral-200"},"Bitmap Parcels")," ",Pc.createElement("span",{className:"font-mono text-neutral-300"},Nn.parcelNumber,".",Nn.bitmapNumber,".bitmap")):null):Pc.createElement("div",{className:"text-[11px] text-neutral-500"},"Select an inscription from the Inscriptions panel, or paste an ID in the Advanced tab."))):null,gr?Pc.createElement("div",{className:"text-[11px] text-neutral-500"},"Direct offers don\u2019t need collection tagging."):null,br?Pc.createElement("div",{className:"flex flex-col gap-2"},Pc.createElement("label",{className:"text-xs font-semibold text-neutral-300"},"Collection (required)"),Pc.createElement("div",{className:"flex flex-col gap-2 bg-neutral-900/30 border border-neutral-800/60 rounded-lg p-3"},Pc.createElement("div",{className:"flex items-center gap-2"},Pc.createElement("input",{type:"text",value:Cn,onChange:e=>Bn(e.target.value),className:"flex-1 min-w-0 px-3 py-2.5 sm:py-2 text-sm bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-purple-500/60",placeholder:"Enter inscription ID or collection name\u2026"}),Pc.createElement("button",{type:"button",onClick:async()=>{try{if(!fr)return;if(_n({status:"validating",message:"Auto-detecting\u2026"}),"bitmap"===Nn?.type&&Nn?.verified)return Tn("bitmap"),void Bn("Bitmaps");if("parcel"===Nn?.type&&Nn?.verified)return Tn("parcel"),Bn("Bitmap Parcels"),void _n({status:"valid",message:"Verified parcel."});const{matchCollectionForInscription:e}=await n(async()=>{const{matchCollectionForInscription:e}=await Promise.resolve().then(()=>Ol);return{matchCollectionForInscription:e}},__VITE_PRELOAD__),t=await e(fr,dr);if(t){const e=dr.find(e=>String(e?.key||"").trim()===String(t).trim());return Tn(String(t)),void Bn(String(e?.name||t))}try{const{detectAndVerifyBitmapByInscriptionId:e}=await n(async()=>{const{detectAndVerifyBitmapByInscriptionId:e}=await Promise.resolve().then(()=>zs);return{detectAndVerifyBitmapByInscriptionId:e}},__VITE_PRELOAD__),t=await e(String(fr));if("bitmap"===t?.type&&t?.verified)return Tn("bitmap"),Bn("Bitmaps"),void _n({status:"valid",message:"Verified bitmap."})}catch{}try{const{detectAndVerifyParcelByInscriptionId:e}=await n(async()=>{const{detectAndVerifyParcelByInscriptionId:e}=await Promise.resolve().then(()=>qs);return{detectAndVerifyParcelByInscriptionId:e}},__VITE_PRELOAD__),t=await e(String(fr));if("parcel"===t?.type&&t?.verified)return Tn("parcel"),Bn("Bitmap Parcels"),void _n({status:"valid",message:"Verified parcel."})}catch{}_n({status:"invalid",message:"Could not auto-detect a collection for this inscription."})}catch(Pk){_n({status:"invalid",message:Pk?.message||String(Pk)})}},className:"px-3 py-2 text-xs font-semibold rounded-lg bg-neutral-800 hover:bg-neutral-700 text-white transition-colors",title:"Try to auto-detect the collection based on registry rules"},"Fetch collection")),Pc.createElement("div",{className:"flex flex-wrap gap-2"},(pr||[]).slice(0,10).map(e=>{const t=String(e?.key||""),n=t&&t===String(kn||"");return Pc.createElement("button",{key:t,type:"button",onClick:()=>{Tn(t),Bn(String(e?.name||t))},className:n?"px-3 sm:px-2.5 py-2 sm:py-1.5 text-xs sm:text-[11px] font-semibold rounded-full bg-purple-500/20 border border-purple-500/40 text-purple-200":"px-3 sm:px-2.5 py-2 sm:py-1.5 text-xs sm:text-[11px] font-semibold rounded-full bg-neutral-800/70 border border-neutral-700/60 text-neutral-200 hover:bg-neutral-800",title:String(e?.description||"")},String(e?.name||t))})),Pc.createElement("div",{className:"text-[11px] text-neutral-500"},"Choose which registry collection to tag this listing under. Your inscription must match that collection\u2019s rules to prevent spoofing."),kn?Pc.createElement("div",{className:"text-[11px] text-neutral-400"},"Selected: ",Pc.createElement("span",{className:"font-mono text-neutral-200"},kn)):Pc.createElement("div",{className:"text-[11px] text-yellow-300/80"},"Select a collection to enable listing."),"validating"===Pn?.status?Pc.createElement("div",{className:"text-xs text-neutral-300 bg-neutral-800/40 border border-neutral-700/40 rounded-lg px-3 py-2"},Pn?.message||"Validating\u2026"):null,"valid"===Pn?.status?Pc.createElement("div",{className:"text-xs text-green-300 bg-green-500/10 border border-green-500/30 rounded-lg px-3 py-2"},Pn?.message||"Valid"):null,"invalid"===Pn?.status?Pc.createElement("div",{className:"text-xs text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2"},Pn?.message||"Invalid"):null)):null,r>1?Pc.createElement(pI,{selectedParents:t,assetPricing:an,onAssetPriceChange:sn,onUniformPriceChange:ln,disabled:!1}):Pc.createElement("div",{className:"flex flex-col gap-2"},Pc.createElement("label",{className:"text-xs font-semibold text-neutral-300"},"Sale price (sats or BTC)"),Pc.createElement("input",{type:"text",inputMode:"decimal",value:a,onChange:e=>o(e.target.value),className:"w-full px-3 py-2.5 sm:py-2 text-sm bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-purple-500/60",placeholder:"30000  or  0.0003"}),Pc.createElement("div",{className:"text-[11px] text-neutral-500"},"Examples: ",Pc.createElement("span",{className:"font-mono"},"30000")," sats or ",Pc.createElement("span",{className:"font-mono"},"0.0003")," BTC")),Pc.createElement("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2"},Pc.createElement("div",{className:"flex flex-col gap-2"},Pc.createElement("label",{className:"text-xs font-semibold text-neutral-300"},"Not valid before block (optional)"),Pc.createElement("div",{className:"flex items-center gap-2"},Pc.createElement("input",{type:"number",min:0,step:1,value:S||"",onChange:e=>E?.(e.target.value),onBlur:()=>{const e=String(S??"").trim();if(!e)return;const t=Number(e),n=Number.isFinite(t)&&t>=0?Math.floor(t):null;null!==n&&null!==Zt&&n<=Zt&&E?.("")},className:"flex-1 w-full px-3 py-2.5 sm:py-2 text-sm bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-purple-500/60",placeholder:"e.g. 850000"}),(()=>{const e=String(S??"").trim();if(!e)return null!==Zt?Pc.createElement("div",{className:"text-[11px] text-neutral-500 whitespace-nowrap"},"Tip: ",Zt):null;const t=Number(e),n=Number.isFinite(t)&&t>=0?Math.floor(t):null;if(null===n)return null;if(null===Zt)return null;const r=n-Zt;return r<=0?Pc.createElement("div",{className:"text-[11px] text-yellow-300/80 whitespace-nowrap"},"Purchasable now"):Pc.createElement("div",{className:"text-[11px] text-neutral-400 whitespace-nowrap"},"Purchasable in ",r," block(s)")})()),Pc.createElement("div",{className:"text-[11px] text-neutral-500"},"Sets the offer/buy tx locktime and a marker constraint."),null===Zt&&nn?Pc.createElement("div",{className:"text-[11px] text-neutral-600"},"Tip height unavailable"):null)),gr?Pc.createElement(Pc.Fragment,null,Pc.createElement("div",{className:"text-[11px] text-neutral-500"},"Creates a seller offer PSBT for the selected inscription that you can send to a buyer. The buyer completes the purchase by pasting it into Offer \u2192 Buy."),wr?Pc.createElement("div",{className:"text-xs text-yellow-300 bg-yellow-500/10 border border-yellow-500/30 rounded-lg px-3 py-2"},"Phantom wallet is connected. Creating sell offers/listings requires a 0x83 (SIGHASH_SINGLE|ANYONECANPAY) signature, which Phantom does not support here. Switch wallets to list or create seller offers."):null,Pc.createElement("div",{className:"flex flex-col gap-2"},Pc.createElement(Br,null),Pc.createElement("button",{onClick:re,disabled:cn||g||!re,className:cn||g||!re?"w-full px-4 py-2 text-sm font-semibold rounded-lg bg-neutral-800 text-neutral-500 cursor-not-allowed":"w-full px-4 py-2 text-sm font-semibold rounded-lg bg-purple-600 hover:bg-purple-500 text-white transition-colors","aria-label":"Create seller offer PSBT",title:cn?"Phantom does not support required 0x83 offer signing":"Create a seller offer PSBT to share with a buyer"},"Create Seller Offer PSBT"),te?Array.isArray(te)?Pc.createElement(NE,{steps:te}):(()=>{const e=String(te||"").toLowerCase(),t=e.includes("refused")||e.includes("unsigned")||e.includes("external signer")||e.includes("two-step");return Pc.createElement("div",{className:t?"text-xs text-yellow-300 bg-yellow-500/10 border border-yellow-500/30 rounded-lg px-3 py-2":"text-xs text-green-300 bg-green-500/10 border border-green-500/30 rounded-lg px-3 py-2"},String(te))})():null),Pc.createElement("div",{className:"flex flex-col gap-2"},Pc.createElement("label",{className:"text-xs font-semibold text-neutral-300"},"Seller offer PSBT (share with buyer)"),Pc.createElement("textarea",{value:ee||"",readOnly:!0,className:"w-full px-3 py-2 text-sm bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-purple-500/60 font-mono",placeholder:"(will appear here after creation)",rows:6}),Pc.createElement("div",{className:"flex gap-2"},Pc.createElement("button",{onClick:()=>{const e=String(ee||"").trim();if(e)try{navigator.clipboard.writeText(e)}catch(t){}},disabled:!String(ee||"").trim(),className:String(ee||"").trim()?"flex-1 px-3 py-2 text-xs font-semibold rounded-lg bg-neutral-800 hover:bg-neutral-700 text-white transition-colors":"flex-1 px-3 py-2 text-xs font-semibold rounded-lg bg-neutral-800 text-neutral-500 cursor-not-allowed",title:"Copy seller offer PSBT"},"Copy"),Pc.createElement("button",{onClick:()=>{const e=String(ee||"").trim();e&&(Ln(e),Mn("Seller offer PSBT"))},disabled:!String(ee||"").trim(),className:String(ee||"").trim()?"px-3 py-2 text-xs font-semibold rounded-lg bg-neutral-800 hover:bg-neutral-700 text-white transition-colors":"px-3 py-2 text-xs font-semibold rounded-lg bg-neutral-800 text-neutral-500 cursor-not-allowed",title:"Show seller offer PSBT as QR code"},"Show QR"))),null,ne?Pc.createElement("div",{className:"text-xs text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2"},ne):null):Pc.createElement(Pc.Fragment,null,Pc.createElement("label",{className:"flex items-center gap-2 text-xs text-neutral-300 select-none"},Pc.createElement("input",{type:"checkbox",checked:!!d,onChange:e=>p?.(e.target.checked),className:"accent-purple-500"}),"Dry run (no broadcast)"),Pc.createElement("div",{className:"flex flex-col gap-2"},Pc.createElement(Br,null),wr?Pc.createElement("div",{className:"text-xs text-yellow-300 bg-yellow-500/10 border border-yellow-500/30 rounded-lg px-3 py-2"},"Phantom wallet is connected. Creating listings requires a 0x83 (SIGHASH_SINGLE|ANYONECANPAY) signature, which Phantom does not support here. Switch wallets to create listings."):null,Number(r||0)<=1?Pc.createElement("button",{onClick:()=>f?.({collectionKey:String(kn||"").trim()||null,minBlockHeight:Rn(S)}),disabled:cn||g||!String(kn||"").trim()||"validating"===Pn?.status||"invalid"===Pn?.status,className:g?"w-full px-4 py-3 sm:py-2 text-sm font-semibold rounded-lg bg-neutral-800 text-neutral-500 cursor-not-allowed":"w-full px-4 py-3 sm:py-2 text-sm font-semibold rounded-lg bg-purple-600 hover:bg-purple-500 text-white transition-colors","aria-label":"Create sale listing transaction",title:cn?"Phantom does not support required 0x83 offer signing":"Broadcast a listing reveal transaction"},"Create Listing Tx"):null,Le?Pc.createElement("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",onClick:()=>{Me.current=!0,Fe(!1)}},Pc.createElement("div",{className:"bg-neutral-900 border border-purple-500/40 rounded-2xl shadow-2xl shadow-purple-500/10 p-6 max-w-sm w-full mx-4 space-y-4",onClick:e=>e.stopPropagation()},Pc.createElement("div",{className:"text-lg font-bold text-neutral-100"},"\ud83d\udce6 Listing multiple parcels?"),Pc.createElement("p",{className:"text-sm text-neutral-400 leading-relaxed"},"You have ",Pc.createElement("span",{className:"text-purple-300 font-semibold"},r," parcels")," selected. Parcels are listed via a ",Pc.createElement("span",{className:"text-neutral-200 font-semibold"},"Parcel Manifesto")," \u2014 a single inscription that bundles all offers with signed PSBTs linked to the parent bitmap."),Pc.createElement("div",{className:"flex flex-col gap-2"},Pc.createElement("button",{type:"button",className:"w-full px-4 py-3 text-sm font-bold rounded-xl bg-green-600 hover:bg-green-500 text-white transition-colors",onClick:()=>{Fe(!1),Oe("parcels"),Pe("launch"),Ce?.("collection")}},"Open Parcel Manifesto Wizard"),Pc.createElement("button",{type:"button",className:"w-full px-4 py-2.5 text-xs font-medium rounded-xl bg-neutral-800 hover:bg-neutral-700 text-neutral-400 transition-colors",onClick:()=>{Me.current=!0,Fe(!1)}},"Dismiss \u2014 I know what I'm doing")))):null,Re?Pc.createElement("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",onClick:()=>{Ue.current=!0,$e(!1)}},Pc.createElement("div",{className:"bg-neutral-900 border border-purple-500/40 rounded-2xl shadow-2xl shadow-purple-500/10 p-6 max-w-sm w-full mx-4 space-y-4",onClick:e=>e.stopPropagation()},Pc.createElement("div",{className:"text-lg font-bold text-neutral-100"},"\ud83d\uddfa\ufe0f Listing multiple bitmaps?"),Pc.createElement("p",{className:"text-sm text-neutral-400 leading-relaxed"},"You have ",Pc.createElement("span",{className:"text-purple-300 font-semibold"},r," bitmaps")," selected. Use the ",Pc.createElement("span",{className:"text-neutral-200 font-semibold"},"Bitmap Collection Wizard")," to scan your wallet for verified bitmaps, set per-item pricing, and publish them as a collection listing."),Pc.createElement("div",{className:"flex flex-col gap-2"},Pc.createElement("button",{type:"button",className:"w-full px-4 py-3 text-sm font-bold rounded-xl bg-purple-600 hover:bg-purple-500 text-white transition-colors",onClick:()=>{$e(!1),Oe("bitmaps"),Pe("launch"),Ce?.("collection")}},"Open Bitmap Listing Wizard"),Pc.createElement("button",{type:"button",className:"w-full px-4 py-2.5 text-xs font-medium rounded-xl bg-neutral-800 hover:bg-neutral-700 text-neutral-400 transition-colors",onClick:()=>{Ue.current=!0,$e(!1)}},"Dismiss \u2014 I know what I'm doing")))):null,("parcel"===String(kn||"").toLowerCase()||"bitmap"===String(kn||"").toLowerCase())&&Number(r||0)>1?Pc.createElement(Pc.Fragment,null):Pc.createElement(Pc.Fragment,null,Pc.createElement(lI,{selectedParentsCount:r,disabled:cn||g||!String(kn||"").trim()||"validating"===Pn?.status||"invalid"===Pn?.status||"function"!=typeof m,collectionKey:String(kn||"").trim()||null,minBlockHeight:Rn(S),onCreateBulkListingTx:m,bulkSellerStatus:x,bulkSellerError:w,bulkBundleJson:v}),Number(r||0)>1?Pc.createElement(uI,{selectedParents:t,selectedParentsCount:r,assetPricing:an,disabled:cn||h,collectionKey:String(kn||"").trim()||null,minBlockHeight:Rn(S),onCreateMultiListingTx:N,multiSellerStatus:I,multiSellerError:A,multiListingResult:k}):null),b?Array.isArray(b)?Pc.createElement(NE,{steps:b}):Pc.createElement("div",{className:"text-xs text-green-300 bg-green-500/10 border border-green-500/30 rounded-lg px-3 py-2"},String(b)):null),y?Pc.createElement("div",{className:"text-xs text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2"},y):null))),!yr&&br&&"collection"===Te&&Pc.createElement("div",{className:"bg-neutral-900/40 border border-neutral-800/60 rounded-lg"},wr?Pc.createElement("div",{className:"m-3 text-xs text-yellow-300 bg-yellow-500/10 border border-yellow-500/30 rounded-lg px-3 py-2"},"Phantom wallet is connected. The Launch Pad requires signing 0x83 seller offer PSBTs; Phantom is not supported for that. Switch wallets to use the Launch Pad with embedded sale offers."):null,Pc.createElement(vI,{initialListingIntent:Be,initialCollectionMode:_e,selectedParentsCount:r,selectedInscriptionIds:i,walletInscriptions:he,walletAssetScanState:be,onRequestWalletRescan:ye,onOpenInscriptions:()=>{"function"==typeof xe&&xe({openInscriptionsPanel:!0})},existingCollectionKeys:(Array.isArray(mt)?mt:[]).map(e=>String(e?.key||"").trim()).filter(Boolean),authoritySlots:P,authorityStatus:_,authorityError:O,selectedAuthoritySlotId:L,feeRate:me,onFeeRateChange:ge,onAuthoritySlotChange:F,onLaunchCollection:M,onLaunchParcelManifest:R,isConnected:Se,onConnect:Ee,onBuyAuthorityListing:e=>{if(!e)return;const t=(()=>{const t=Number(e?.price);return!Number.isFinite(t)||t<=0?null:Math.trunc(t)})(),n=String(e?.sellerOfferPsbt||"").trim();n&&(zt(t),Wt(e?.inscription||{id:e?.inscriptionId,inscriptionId:e?.inscriptionId}),Vt(e?.collection||null),Xt(""),De(n),We(!0),ke("offer"),Ce("buy"))},previousManifest:$,previousManifestStatus:U,previousManifestError:z,onLoadPreviousManifest:D}))),Pc.createElement(EI,{value:On,label:Fn,onClear:()=>{Ln(""),Mn("")}}),Pc.createElement(FI,{collection:Ct,isOpen:Pt,onClose:()=>_t(!1)}))}const UI=Pc.memo(function({collectionKey:e,title:t,description:n,statsLine:r,thumbId:i,thumbContentType:a,fallbackImageInscriptionId:o,isCatchAll:s,onOpen:l}){const c=(()=>{const t=String(e||"").trim().toLowerCase();return"parcel"===t||"parcels"===t})(),u=String(a||"").trim().toLowerCase(),d=u.startsWith("image/"),[p,f]=Pc.useState(()=>d||!u?"img":"iframe"),m=String(i||"").trim(),g=String(o||"").trim(),h=Pc.useMemo(()=>{const e=String(r||"").trim();if(!e)return null;const t=e.split(" \u2022 Floor ");return 2===t.length?{countText:t[0],floorText:t[1]}:{countText:e,floorText:null}},[r]);return Pc.createElement("button",{onClick:l,className:"group text-left rounded-2xl bg-gradient-to-b from-neutral-900/60 to-neutral-950/80 border border-neutral-800/60 text-neutral-200 shadow-[0_0_0_1px_rgba(59,130,246,0.10),0_0_22px_rgba(59,130,246,0.08)] hover:translate-y-[-1px] hover:shadow-xl hover:border-sky-500/25 transition overflow-hidden",title:`View ${t||e}`},Pc.createElement("div",{className:"p-2"},Pc.createElement("div",{className:"relative aspect-square w-full rounded-xl overflow-hidden border border-neutral-800/70 bg-black"},Pc.createElement("div",{className:"absolute top-2 left-2 z-10"},s?Pc.createElement("span",{className:"text-[11px] px-2 py-1 rounded-md bg-neutral-950/60 border border-neutral-800/60 text-neutral-200"},"Uncategorized"):c?Pc.createElement("span",{className:"text-[11px] px-2 py-1 rounded-md bg-neutral-950/60 border border-neutral-800/60 text-neutral-200"},"Parcels"):null),Pc.createElement("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/0 via-black/0 to-black/35"}),c?Pc.createElement("div",{className:"w-full h-full flex items-center justify-center"},Pc.createElement("div",{className:"w-2/3 h-2/3 rounded-none border border-green-500 bg-green-500"})):m?"iframe"===p?Pc.createElement("iframe",{src:kt(`/content/${m}`),title:"",sandbox:"allow-scripts",referrerPolicy:"no-referrer",className:"w-full h-full pointer-events-none",tabIndex:-1}):"img"===p?Pc.createElement("img",{src:kt(`/content/${m}`),alt:"",className:"w-full h-full object-cover",loading:"lazy",onError:()=>{f("iframe")}}):Pc.createElement("iframe",{src:kt(`/content/${m}`),title:"",sandbox:"allow-scripts",referrerPolicy:"no-referrer",className:"w-full h-full pointer-events-none",tabIndex:-1}):g?Pc.createElement("img",{src:kt(`/content/${g}`),alt:"",className:"w-full h-full object-cover",loading:"lazy"}):s?Pc.createElement("div",{className:"w-full h-full flex items-center justify-center"},Pc.createElement("img",{src:kt(`/content/${RI}`),alt:"",className:"w-10 h-10 opacity-70",loading:"lazy"})):Pc.createElement("div",{className:"w-full h-full flex items-center justify-center text-neutral-600 text-xs"},String(t||"").slice(0,10)))),Pc.createElement("div",{className:"px-3 pb-3"},Pc.createElement("div",{className:"text-[13px] font-semibold truncate text-neutral-100"},t),h?Pc.createElement("div",{className:"mt-0.5 text-[11px] text-neutral-400 truncate"},Pc.createElement("span",null,h.countText),h.floorText?Pc.createElement(Pc.Fragment,null,Pc.createElement("span",{className:"text-neutral-600"}," ","\u2022"," "),Pc.createElement("span",{className:"text-amber-300 drop-shadow-[0_0_10px_rgba(251,191,36,0.10)]"},"Floor ",h.floorText)):null):null,n?Pc.createElement("div",{className:"mt-1 text-[11px] text-neutral-500 line-clamp-2"},n):Pc.createElement("div",{className:"mt-1 text-[11px] text-neutral-500 line-clamp-2"},"Open collection page")))});Array(9).fill(0),kt("/content/01bba6c58af39d7f199aa2bceeaaba1ba91b23d2663bc4ef079a4b5e442dbf74i0"),kt("/content/bb01dfa977a5cd0ee6e900f1d1f896b5ec4b1e3c7b18f09c952f25af6591809fi0"),kt("/content/bb02e94f3062facf6aa2e47eeed348d017fd31c97614170dddb58fc59da304efi0"),kt("/content/bb037ec98e6700e8415f95d1f5ca1fe1ba23a3f0c5cb7284d877e9ac418d0d32i0"),kt("/content/bb9438f4345f223c6f4f92adf6db12a82c45d1724019ecd7b6af4fcc3f5786cei0"),kt("/content/bb0542d4606a9e7eb4f31051e91f7696040db06ca1383dff98505618c34d7df7i0"),kt("/content/bb06a4dffba42b6b513ddee452b40a67688562be4a1345127e4d57269e6b2ab6i0"),kt("/content/bb076934c1c22007b315dd1dc0f8c4a2f9d52f348320cfbadc7c0bd99eaa5e18i0"),kt("/content/bb986a1208380ec7db8df55a01c88c73a581069a51b5a2eb2734b41ba10b65c2i0"),kt("/content/b907b51a239e3a37f29f8222fb274f828c6ebf7b93ce501a55b7171daaa75758i0");const zI=new URL(import.meta.url);async function DI(e){const t=kt(`/r/inscription/${e}`);return await fetch(t).then(e=>e.json())}async function HI(e){const t=kt(`/content/${e}`);return(await fetch(t).then(e=>e.text())).trim()}async function WI(e,t,n){const r=new Set;try{const i=await async function(e){const t=[];let n=0;for(;;){const r=kt(0===n?`/r/children/${e}`:`/r/children/${e}/${n}`),i=await fetch(r).then(e=>e.json());if(!i.ids||0===i.ids.length)break;if(t.push(...i.ids),!i.more)break;n++}return t}(e);if(0===i.length)return r;const a={},o=i.map(async e=>{try{const r=await async function(e,t,n){const r=await HI(e),i=r.split(".");if(3!==i.length||"bitmap"!==i[2])return!1;const[a,o]=i;if(o!==t.toString())return!1;const s=parseInt(a,10);return!(isNaN(s)||s<0||void 0!==n&&s>=n)&&{id:e,content:r,parcelNumber:s}}(e,t,n);if(r){const e=r.parcelNumber,t=await DI(r.id);(!a[e]||t.height<a[e].height||t.height===a[e].height&&t.id<a[e].id)&&(a[e]={...r,height:t.height,inscriptionId:t.id})}}catch(_k){}});await Promise.all(o);for(const e in a)r.add(parseInt(e,10))}catch(_k){}return r}new URLSearchParams(zI.search).get("origin"),"undefined"!=typeof document&&document.getElementById("searchForm")&&document.getElementById("searchForm").addEventListener("submit",async function(e){e.preventDefault();const t=document.getElementById("searchInput").value;document.getElementById("loading").style.display="block";try{const e=parseInt(t,10),n=await async function(e){const t=await $s(e);if(!t)throw new Error("Failed to resolve bitmap inscription id via OCI");return t}(e);if(await DI(n),!(await HI(n)).includes(e.toString()))throw new Error("Invalid bitmap content");let r;if(0!==e)try{r=(await async function(e){const t=kt(`/r/blockinfo/${e}`);return await fetch(t).then(e=>{if(!e.ok)throw new Error("Block info not available");return e.json()})}(e)).transaction_count}catch(tn){}const i=await WI(n,e,r),a={bitmapNumber:e,inscriptionId:n,existingParcels:Array.from(i),existingParcelCount:i.size};"undefined"!=typeof document&&document.getElementById("bitmapInfoPre")&&(document.getElementById("bitmapInfoPre").textContent=JSON.stringify(a,null,2))}catch(tn){"undefined"!=typeof document&&document.getElementById("bitmapInfoPre")&&(document.getElementById("bitmapInfoPre").textContent="Error retrieving bitmap information.")}finally{"undefined"!=typeof document&&document.getElementById("loading")&&(document.getElementById("loading").style.display="none")}});const jI=e=>{const t=(e.contentType||e.content_type||"").toLowerCase().trim();return!t||!!t.startsWith("text/plain")||"application/octet-stream"===t},VI=async e=>{if(!e)return null;if(!jI(e))return null;const t=(e=>{const t=hN.get(e);if(t){const e=(t.contentType||"").toLowerCase();if(e.startsWith("image/")||e.includes("html")||e.includes("json")||e.includes("javascript")||e.includes("svg"))return"";if("string"==typeof t.data&&!t.data.startsWith("blob:"))return t.data}return null})(e.id);if(null!==t){if(!t)return null;const e=t.match(/^(\d+)\.bitmap/);return e?parseInt(e[1],10):null}const n=await(async e=>{try{const t=await fetch(kt(`/content/${e}`));return await t.text()}catch(_k){return null}})(e.id);if(!n)return null;const r=n.match(/^(\d+)\.bitmap/);return r?parseInt(r[1],10):null};function qI({selectedParents:e=[],walletInscriptions:t=[],loadingInscriptions:n=!1,onParentSelect:r,onMobilePanelChange:i,onContentChange:a,onContentTypeChange:o,onBatchCreate:s,disabled:l=!1}){const[c,u]=Bc.useState(null),[d,p]=Bc.useState(null),[f,m]=Bc.useState(0),[g,h]=Bc.useState(new Set),[b,y]=Bc.useState(!1),[x,w]=Bc.useState(null),[v,S]=Bc.useState(0),[E,N]=Bc.useState(!1),[I,A]=Bc.useState(!1),[k,T]=Bc.useState({}),[C,B]=Bc.useState({}),[P,_]=Bc.useState(new Set),[O,L]=Bc.useState(!1),[F,M]=Bc.useState([]),[R,$]=Bc.useState(!1),[U,z]=Bc.useState(!1),[D,H]=Bc.useState(null),[W,j]=Bc.useState(!1),[V,q]=Bc.useState(1),[X,K]=Bc.useState({x:0,y:0}),[G,Y]=Bc.useState(!1),[J,Q]=Bc.useState({x:0,y:0}),Z=Bc.useRef({x:0,y:0,dist:0,zoom:1}),ee=Bc.useRef(!1),[te,ne]=Bc.useState(()=>"undefined"!=typeof window&&window.innerWidth<768);Bc.useEffect(()=>{const e=window.matchMedia("(max-width: 767px)"),t=e=>ne(e.matches);return e.addEventListener("change",t),()=>e.removeEventListener("change",t)},[]),Bc.useEffect(()=>{if(!E)return;const e=e=>{"Escape"===e.key&&N(!1)};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[E]);const re=Bc.useRef("");Bc.useEffect(()=>{if(n)return;if(e.length>0)return;if(!t||0===t.length)return void(""!==re.current&&(re.current="",M([]),z(!1)));const r=t[0]?.id||"",i=t[t.length-1]?.id||"",a=`${t.length}:${r}:${i}`;if(re.current===a)return;let o=!1;return(async()=>{$(!0);const e=[],n=t.filter(jI);for(let t=0;t<n.length&&!o;t+=10){const r=n.slice(t,t+10);(await Promise.all(r.map(async e=>{try{const t=await VI(e);if(null!==t)return{inscription:e,bitmapNumber:t}}catch{}return null}))).filter(Boolean).forEach(t=>e.push(t))}o||(re.current=a,M(e),z(!0),$(!1))})(),()=>{o=!0}},[t,n,e.length]),Bc.useEffect(()=>{(async()=>{let t=null,n=null;for(const a of e){const e=await VI(a);if(null!==e){t=a,n=e;break}}if(!t)return u(null),p(null),m(0),h(new Set),void w(null);y(!0),w(null),h(new Set);try{const e=n;u(e),p(t);let a=0;if(window.btcapi&&window.btcapi.getBlockAtHeight)try{const t=await window.btcapi.getBlockAtHeight(e);a=t.tx_count||t.n_tx||0}catch(r){}if(0===a){const t=kt(`/r/blockinfo/${e}`),n=await fetch(t);if(!n.ok)throw new Error(`Failed to fetch block info for block ${e}`);a=(await n.json()).transaction_count}m(a),S(e=>e+1),1===V&&0===X.x&&0===X.y&&(a>=12e3?q(3):a>=5e3&&q(2)),L(!0);try{const n=t.id||t.inscriptionId,r=await WI(n,e,a);_(r)}catch(i){}finally{L(!1)}}catch(_k){w(_k.message),u(null),p(null),m(0)}finally{y(!1)}})()},[e]);const ie=Bc.useCallback((e,t=!1)=>{if(!P.has(e)){if(t&&null!==D){const t=Math.min(D,e),n=Math.max(D,e);h(e=>{const r=new Set(e);for(let i=t;i<=n;i++)P.has(i)||r.add(i);return r})}else h(t=>{const n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n});H(e)}},[P,D]),ae=Bc.useCallback(()=>{h(e=>{const t=new Set(e);for(let n=0;n<f;n++)P.has(n)||t.add(n);return t})},[f,P]),oe=Bc.useCallback(()=>{h(new Set)},[]),se=Bc.useCallback(()=>{h(e=>{const t=new Set;for(let n=0;n<f;n++)P.has(n)||e.has(n)||t.add(n);return t})},[f,P]),le=Bc.useCallback((e,t)=>{P.has(e)||(t?.shiftKey?(ie(e,!0),j(!1)):ie(e,!1))},[P,ie]),ce=Bc.useCallback((e,t)=>{P.has(e)||j(!0)},[P]),ue=Bc.useCallback(e=>{W&&!P.has(e)&&h(t=>{const n=new Set(t);return n.add(e),n})},[W,P]);Bc.useCallback(()=>{j(!1)},[]),Bc.useCallback(()=>{j(!1)},[]),Bc.useEffect(()=>{const e=()=>{j(!1)};return window.addEventListener("mouseup",e),window.addEventListener("touchend",e),()=>{window.removeEventListener("mouseup",e),window.removeEventListener("touchend",e)}},[]);const de=Bc.useCallback(()=>{q(e=>Math.min(e+.2,3))},[]),pe=Bc.useCallback(()=>{q(e=>Math.max(e-.2,.5))},[]),fe=Bc.useCallback(()=>{q(1),K({x:0,y:0})},[]),me=Bc.useCallback(e=>{(1===e.button||0===e.button&&e.ctrlKey)&&(e.preventDefault(),Y(!0),Q({x:e.clientX-X.x,y:e.clientY-X.y}))},[X]),ge=Bc.useCallback(e=>{G&&K({x:e.clientX-J.x,y:e.clientY-J.y})},[G,J]),he=Bc.useCallback(()=>{Y(!1),ee.current=!1},[]),be=Bc.useCallback(e=>{if(2===e.touches.length){e.preventDefault();const t=e.touches[0].clientX-e.touches[1].clientX,n=e.touches[0].clientY-e.touches[1].clientY;Z.current={x:0,y:0,dist:Math.sqrt(t*t+n*n),zoom:V}}else 1===e.touches.length&&(ee.current=!0,Z.current={x:e.touches[0].clientX-X.x,y:e.touches[0].clientY-X.y,dist:0,zoom:V})},[V,X]),ye=Bc.useCallback(e=>{if(2===e.touches.length){e.preventDefault();const t=e.touches[0].clientX-e.touches[1].clientX,n=e.touches[0].clientY-e.touches[1].clientY,r=Math.sqrt(t*t+n*n)/(Z.current.dist||1);q(Math.max(.5,Math.min(3,Z.current.zoom*r)))}else 1===e.touches.length&&ee.current&&K({x:e.touches[0].clientX-Z.current.x,y:e.touches[0].clientY-Z.current.y})},[]),xe=Bc.useCallback(()=>{ee.current=!1},[]),we=Bc.useCallback(async()=>{if(c&&d){L(!0);try{const e=d.id||d.inscriptionId,t=await WI(e,c,f);_(t),h(e=>{const n=new Set(e);return t.forEach(e=>n.delete(e)),n})}catch(_k){}finally{L(!1)}}},[c,d,f]),ve=Bc.useCallback(()=>{if(0===g.size||!d)return;const e=Array.from(g).filter(e=>!P.has(e)).map(e=>{const t={content:`${e}.${c}.bitmap`,contentType:"text/plain;charset=utf-8",parent:d.id||d.inscriptionId,metadata:JSON.stringify({name:`${e}.${c}`,type:"parcel",bitmap:c,parcel:e})};return k[e]&&(t.destinationAddress=k[e]),C[e]&&(t.postage=parseInt(C[e],10)),t});s&&s(e),i&&i("review")},[g,d,c,k,C,P,s,i]);return Bc.createElement(Bc.Fragment,null,Bc.createElement("div",{style:{height:"100%",display:"flex",flexDirection:"column",gap:"8px",overflow:"auto",WebkitOverflowScrolling:"touch",padding:"4px"}},!c&&Bc.createElement("div",{style:{padding:"8px 12px",background:"rgba(74, 144, 226, 0.1)",border:"1px solid rgba(74, 144, 226, 0.3)",borderRadius:"6px"}},Bc.createElement("div",{style:{display:"flex",alignItems:"center",gap:"8px"}},Bc.createElement("div",null,Bc.createElement("h3",{style:{margin:0,fontSize:"14px",color:"var(--textPrimary)"}},"Bitmap Parcel Selector"),Bc.createElement("p",{style:{margin:0,fontSize:"12px",color:"var(--textMuted)"}},F.length>0?"Select a bitmap from your wallet to enter parcel mode":"Select bitmap from your wallet or the Parents tab")))),!c&&!b&&Bc.createElement("div",{style:{background:"var(--bgSecondary)",border:"1px solid var(--borderMedium)",borderRadius:"8px",overflow:"hidden"}},(n||R)&&Bc.createElement("div",{style:{padding:"16px",textAlign:"center",display:"flex",flexDirection:"column",alignItems:"center",gap:"8px"}},Bc.createElement("div",{style:{width:"24px",height:"24px",border:"2px solid rgba(74, 144, 226, 0.2)",borderTop:"2px solid #4A90E2",borderRadius:"50%",animation:"spin 1s linear infinite"}}),Bc.createElement("span",{style:{fontSize:"12px",color:"var(--textMuted)"}},n?"Loading wallet inscriptions...":"Scanning wallet for bitmaps...")),!n&&!R&&F.length>0&&Bc.createElement("div",null,Bc.createElement("div",{style:{padding:"8px 12px",borderBottom:"1px solid var(--borderMedium)",fontSize:"11px",fontWeight:600,color:"var(--textMuted)",textTransform:"uppercase",letterSpacing:"0.5px",display:"flex",justifyContent:"space-between",alignItems:"center"}},Bc.createElement("span",null,"Your Bitmaps (",F.length,")"),Bc.createElement("span",{style:{textTransform:"none",fontWeight:400,fontSize:"10px"}},"Tap to enter parcel mode")),Bc.createElement("div",{style:{maxHeight:"280px",overflowY:"auto",WebkitOverflowScrolling:"touch",padding:"4px"}},F.sort((e,t)=>e.bitmapNumber-t.bitmapNumber).map(({inscription:e,bitmapNumber:t})=>Bc.createElement("button",{key:e.id,onClick:()=>{r&&r(e)},style:{display:"flex",alignItems:"center",gap:"10px",width:"100%",padding:te?"12px 10px":"8px 10px",background:"rgba(0, 0, 0, 0.2)",border:"1px solid rgba(255, 255, 255, 0.08)",borderRadius:"6px",color:"var(--textPrimary)",cursor:"pointer",transition:"all 0.15s",marginBottom:"4px",textAlign:"left"},onMouseOver:e=>{e.currentTarget.style.background="rgba(74, 144, 226, 0.15)",e.currentTarget.style.borderColor="rgba(74, 144, 226, 0.4)"},onMouseOut:e=>{e.currentTarget.style.background="rgba(0, 0, 0, 0.2)",e.currentTarget.style.borderColor="rgba(255, 255, 255, 0.08)"}},Bc.createElement("div",{style:{flex:1,minWidth:0}},Bc.createElement("div",{style:{fontSize:"14px",fontWeight:600}},t,".bitmap"),Bc.createElement("div",{style:{fontSize:"10px",color:"var(--textMuted)",fontFamily:"var(--fontFamily-mono)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},e.id)),Bc.createElement("span",{style:{fontSize:"16px",color:"#4A90E2",flexShrink:0}},"\u2192"))))),!n&&!R&&0===F.length&&Bc.createElement("div",{style:{padding:"24px",textAlign:"center"}},Bc.createElement("h4",{style:{margin:"0 0 8px 0",color:"var(--textPrimary)"}},t.length>0?"No Bitmaps Found":"Select a Bitmap Parent"),Bc.createElement("p",{style:{margin:0,fontSize:"13px",color:"var(--textMuted)"}},t.length>0?"No bitmap inscriptions found in your wallet. You can also select one from Advanced Options \u2192 Parents.":"Connect your wallet to see your bitmaps, or go to Advanced Options \u2192 Parents and select a bitmap inscription."))),b&&Bc.createElement("div",{style:{padding:"48px",textAlign:"center",background:"var(--bgSecondary)",border:"1px solid var(--borderMedium)",borderRadius:"8px"}},Bc.createElement("div",{style:{width:"40px",height:"40px",border:"3px solid rgba(74, 144, 226, 0.2)",borderTop:"3px solid #4A90E2",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 12px"}}),Bc.createElement("p",{style:{margin:"0 0 4px 0",fontSize:"13px",color:"var(--textPrimary)",fontWeight:600}},O?"Validating existing parcels...":"Loading bitmap data..."),Bc.createElement("p",{style:{margin:0,fontSize:"11px",color:"var(--textMuted)"}},O?"Checking on-chain parcel inscriptions":"Fetching block transaction count")),!b&&O&&Bc.createElement("div",{style:{padding:"8px 12px",background:"rgba(34, 211, 238, 0.1)",border:"1px solid rgba(34, 211, 238, 0.3)",borderRadius:"6px",fontSize:"11px",color:"#22d3ee",display:"flex",alignItems:"center",gap:"8px"}},Bc.createElement("div",{style:{width:"12px",height:"12px",border:"2px solid rgba(34, 211, 238, 0.3)",borderTop:"2px solid #22d3ee",borderRadius:"50%",animation:"spin 0.8s linear infinite"}}),Bc.createElement("span",null,"Validating parcels against on-chain data...")),x&&Bc.createElement("div",{style:{padding:"12px",background:"rgba(226, 74, 74, 0.1)",border:"1px solid rgba(226, 74, 74, 0.3)",borderRadius:"8px",color:"#E24A4A",fontSize:"13px"}},x),c&&!b&&Bc.createElement(Bc.Fragment,null,Bc.createElement("div",{style:{padding:te?"8px":"6px 12px",background:"var(--bgSecondary)",border:"1px solid var(--borderMedium)",borderRadius:"6px",display:"flex",flexDirection:te?"column":"row",justifyContent:"space-between",alignItems:te?"stretch":"center",gap:te?"8px":"12px"}},Bc.createElement("div",{style:{display:"flex",gap:"8px",alignItems:"center",justifyContent:"space-between"}},Bc.createElement("div",{style:{display:"flex",gap:"8px",alignItems:"center"}},Bc.createElement("div",{style:{display:"flex",alignItems:"center",gap:"6px"}},Bc.createElement("span",{style:{fontSize:"13px",fontWeight:600,color:"var(--textPrimary)"}},c,".bitmap"),Bc.createElement("span",{style:{fontSize:"11px",color:"var(--textMuted)"}},f," parcels"),Bc.createElement("button",{onClick:()=>{r&&d&&r(d)},disabled:l,title:"Remove bitmap and pick another",style:{padding:te?"4px 8px":"2px 6px",minHeight:te?"28px":"auto",background:"rgba(239, 68, 68, 0.15)",border:"1px solid rgba(239, 68, 68, 0.4)",borderRadius:te?"6px":"4px",color:"#ef4444",fontSize:te?"11px":"10px",fontWeight:500,cursor:l?"not-allowed":"pointer",transition:"all 0.15s",opacity:l?.5:1,lineHeight:1,display:"flex",alignItems:"center",gap:"3px"},onMouseOver:e=>{l||(e.currentTarget.style.background="rgba(239, 68, 68, 0.3)")},onMouseOut:e=>{e.currentTarget.style.background="rgba(239, 68, 68, 0.15)"}},Bc.createElement("span",{style:{fontSize:te?"12px":"10px"}},"\u2715"),Bc.createElement("span",null,"Swap")))),Bc.createElement("div",{style:{display:"flex",gap:"6px",alignItems:"center"}},Bc.createElement("span",{style:{fontSize:"12px",fontWeight:600,color:"#4A90E2"}},g.size," selected"),P.size>0&&Bc.createElement("span",{style:{fontSize:"11px",color:"#E24A4A",fontWeight:500}},"(",P.size," exist)"))),Bc.createElement("div",{style:{display:"flex",gap:te?"4px":"3px",alignItems:"center",flexWrap:"nowrap",justifyContent:te?"center":"flex-end"}},Bc.createElement("button",{onClick:we,disabled:O||l,title:"Refresh parcel validation",style:{padding:te?"6px 8px":"2px 5px",minHeight:te?"32px":"auto",background:O?"rgba(74, 144, 226, 0.2)":"rgba(34, 211, 238, 0.2)",border:"1px solid rgba(34, 211, 238, 0.4)",borderRadius:te?"6px":"3px",color:"var(--textPrimary)",fontSize:te?"11px":"10px",cursor:O?"wait":"pointer",transition:"all 0.2s",opacity:O||l?.6:1,lineHeight:1}},O?"\u27f3\u2026":"\u27f3"),Bc.createElement("button",{onClick:ae,disabled:l,title:"Select all available parcels",style:{padding:te?"6px 8px":"2px 5px",minHeight:te?"32px":"auto",background:"rgba(34, 197, 94, 0.2)",border:"1px solid rgba(34, 197, 94, 0.4)",borderRadius:te?"6px":"3px",color:"var(--textPrimary)",fontSize:te?"11px":"10px",cursor:"pointer",transition:"all 0.2s",lineHeight:1}},"All"),Bc.createElement("button",{onClick:oe,disabled:l,title:"Deselect all parcels",style:{padding:te?"6px 8px":"2px 5px",minHeight:te?"32px":"auto",background:"rgba(239, 68, 68, 0.2)",border:"1px solid rgba(239, 68, 68, 0.4)",borderRadius:te?"6px":"3px",color:"var(--textPrimary)",fontSize:te?"11px":"10px",cursor:"pointer",transition:"all 0.2s",lineHeight:1}},"None"),Bc.createElement("button",{onClick:se,disabled:l,title:"Invert selection",style:{padding:te?"6px 8px":"2px 5px",minHeight:te?"32px":"auto",background:"rgba(168, 85, 247, 0.2)",border:"1px solid rgba(168, 85, 247, 0.4)",borderRadius:te?"6px":"3px",color:"var(--textPrimary)",fontSize:te?"11px":"10px",cursor:"pointer",transition:"all 0.2s",lineHeight:1}},"Inv"),Bc.createElement("button",{onClick:()=>A(!I),title:I?"Switch to Mondrian view":"Switch to list view",style:{padding:te?"6px 8px":"2px 5px",minHeight:te?"32px":"auto",background:I?"rgba(74, 144, 226, 0.3)":"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(74, 144, 226, 0.4)",borderRadius:te?"6px":"3px",color:"var(--textPrimary)",fontSize:te?"11px":"10px",cursor:"pointer",transition:"all 0.2s",lineHeight:1}},I?"\u25a6":"\u2630"),!I&&Bc.createElement("button",{onClick:()=>N(!E),title:E?"Exit fullscreen":"Fullscreen",style:{padding:te?"6px 8px":"2px 5px",minHeight:te?"32px":"auto",background:E?"rgba(74, 144, 226, 0.3)":"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(74, 144, 226, 0.4)",borderRadius:te?"6px":"3px",color:"var(--textPrimary)",fontSize:te?"11px":"10px",cursor:"pointer",transition:"all 0.2s",lineHeight:1}},E?"\u2715":"\u26f6"))),!I&&!E&&Bc.createElement("div",{style:{flex:"1 1 0",minHeight:te?"180px":0,maxHeight:te?"calc(100vh - 320px)":void 0,display:"flex",flexDirection:"column",background:"var(--bgSecondary)",border:"1px solid var(--borderMedium)",borderRadius:"6px",overflow:"hidden"}},Bc.createElement("div",{style:{padding:te?"6px 8px":"6px 12px",background:"rgba(0, 0, 0, 0.3)",borderBottom:"1px solid var(--borderMedium)",fontSize:"10px",color:"var(--textMuted)",display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:te?"4px":"8px"}},Bc.createElement("div",{style:{display:"flex",gap:"8px",alignItems:"center"}},!te&&Bc.createElement("span",null,"Tap to select / Hold to drag-select"),Bc.createElement("span",{style:{color:"#f79a27",fontSize:"10px"}},"Available"),Bc.createElement("span",{style:{color:"#00e5ff",fontSize:"10px"}},"Selected"),Bc.createElement("span",{style:{color:"#E24A4A",fontSize:"10px"}},"Exists")),Bc.createElement("div",{style:{display:"flex",gap:"4px",alignItems:"center"}},Bc.createElement("button",{onClick:pe,title:"Zoom out",style:{padding:te?"6px 10px":"2px 4px",minHeight:te?"32px":"auto",minWidth:te?"32px":"auto",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:te?"4px":"2px",color:"white",fontSize:te?"14px":"10px",cursor:"pointer",lineHeight:1,display:"grid",placeItems:"center"}},"\u2212"),Bc.createElement("span",{style:{fontSize:te?"11px":"9px",minWidth:"30px",textAlign:"center"}},Math.round(100*V),"%"),Bc.createElement("button",{onClick:de,title:"Zoom in",style:{padding:te?"6px 10px":"2px 4px",minHeight:te?"32px":"auto",minWidth:te?"32px":"auto",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:te?"4px":"2px",color:"white",fontSize:te?"14px":"10px",cursor:"pointer",lineHeight:1,display:"grid",placeItems:"center"}},"+"),Bc.createElement("button",{onClick:fe,title:"Reset zoom and pan",style:{padding:te?"6px 10px":"2px 4px",minHeight:te?"32px":"auto",minWidth:te?"32px":"auto",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:te?"4px":"2px",color:"white",fontSize:te?"12px":"9px",cursor:"pointer",lineHeight:1,display:"grid",placeItems:"center"}},"Reset"))),Bc.createElement("div",{style:{flex:1,minHeight:0,display:"flex",alignItems:"center",justifyContent:"center",padding:te?"4px":"8px",overflow:"hidden",background:"black",cursor:G?"grabbing":V>1?"grab":"default",userSelect:"none",position:"relative",touchAction:"none"},onMouseDown:me,onMouseMove:ge,onMouseUp:he,onMouseLeave:he,onTouchStart:be,onTouchMove:ye,onTouchEnd:xe},Bc.createElement("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",transform:`scale(${V}) translate(${X.x/V}px, ${X.y/V}px)`,transformOrigin:"center center",transition:G?"none":"transform 0.1s ease-out"}},Bc.createElement(BN,{blockNumber:c,highlightParcels:Array.from(g),existingParcels:P,size:"auto",measureKey:v,className:"bitmap-renderer",onParcelMouseDown:ce,onParcelClick:le,onParcelMouseEnter:ue}))),te&&Bc.createElement("button",{onClick:()=>N(!0),style:{padding:"8px",background:"rgba(74, 144, 226, 0.15)",border:"none",borderTop:"1px solid var(--borderMedium)",color:"#4A90E2",fontSize:"12px",fontWeight:500,cursor:"pointer",textAlign:"center",width:"100%"}},"Tap to expand fullscreen")),I&&Bc.createElement("div",{style:{flex:1,minHeight:0,background:"var(--bgSecondary)",border:"1px solid var(--borderMedium)",borderRadius:"6px",overflow:"auto",WebkitOverflowScrolling:"touch",padding:te?"6px":"8px"}},Bc.createElement("div",{style:{fontSize:"11px",fontWeight:600,color:"var(--textMuted)",marginBottom:"8px",padding:"0 4px",textTransform:"uppercase",letterSpacing:"0.5px"}},"All Parcels (0-",f-1,")"),Bc.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"4px"}},Array.from({length:f},(e,t)=>{const n=P.has(t),r=g.has(t);return Bc.createElement("div",{key:t,style:{display:"grid",gridTemplateColumns:te?"auto 1fr":"auto 130px 1fr auto",gap:"6px",alignItems:"center",padding:te?"8px 6px":"4px 6px",background:n?"rgba(226, 74, 74, 0.1)":r?"rgba(0, 229, 255, 0.15)":"rgba(0, 0, 0, 0.2)",border:n?"1px solid rgba(226, 74, 74, 0.4)":r?"1px solid rgba(0, 229, 255, 0.4)":"1px solid rgba(255, 255, 255, 0.1)",borderRadius:"4px",fontSize:"11px",opacity:n?.6:1}},Bc.createElement("input",{type:"checkbox",checked:r&&!n,onChange:()=>!n&&ie(t),disabled:l||n,title:n?"This parcel already exists":"",style:{cursor:l||n?"not-allowed":"pointer",margin:0,width:te?"18px":"auto",height:te?"18px":"auto"}}),Bc.createElement("span",{style:{fontFamily:"var(--fontFamily-mono)",color:n?"#E24A4A":r?"#00e5ff":"var(--textPrimary)",fontWeight:r?600:400,fontSize:te?"13px":"11px",whiteSpace:"nowrap"}},t,".",c,n&&Bc.createElement("span",{title:"Already exists"}," (exists)")),!te&&Bc.createElement(Bc.Fragment,null,Bc.createElement("input",{type:"text",placeholder:"Address (optional)",value:k[t]||"",onChange:e=>T(n=>({...n,[t]:e.target.value})),disabled:l||!r||n,style:{padding:"3px 6px",background:"rgba(0, 0, 0, 0.3)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"3px",color:"var(--textPrimary)",fontSize:"10px",fontFamily:"var(--fontFamily-mono)",opacity:r&&!n?1:.4}}),Bc.createElement("input",{type:"number",placeholder:"Postage",value:C[t]||"",onChange:e=>B(n=>({...n,[t]:e.target.value})),disabled:l||!r||n,min:"330",title:"Postage amount in sats (min 330)",style:{width:"70px",padding:"3px 6px",background:"rgba(0, 0, 0, 0.3)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"3px",color:"var(--textPrimary)",fontSize:"10px",fontFamily:"var(--fontFamily-mono)",opacity:r&&!n?1:.4}})))}))),g.size>0&&Bc.createElement("div",{style:{padding:te?"8px":"8px 12px",background:"var(--bgSecondary)",border:"1px solid rgba(102, 126, 234, 0.4)",borderRadius:"6px",display:"flex",flexDirection:te?"column":"row",gap:te?"8px":"12px",alignItems:te?"stretch":"center",justifyContent:"space-between",flexShrink:0}},Bc.createElement("div",{style:{flex:1,minWidth:0}},Bc.createElement("div",{style:{fontSize:"11px",fontWeight:600,color:"var(--textMuted)",marginBottom:"4px",textTransform:"uppercase",letterSpacing:"0.5px"}},"Selected: ",g.size," parcel",1!==g.size?"s":""),Bc.createElement("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px",maxHeight:te?"48px":"60px",overflow:"auto",WebkitOverflowScrolling:"touch"}},Array.from(g).sort((e,t)=>e-t).map(e=>Bc.createElement("span",{key:e,style:{padding:"2px 6px",background:"rgba(0, 229, 255, 0.2)",border:"1px solid rgba(0, 229, 255, 0.4)",borderRadius:"3px",fontSize:"10px",color:"#00e5ff",fontFamily:"var(--fontFamily-mono)",whiteSpace:"nowrap"}},e)))),Bc.createElement("button",{onClick:ve,disabled:l,style:{padding:te?"12px 20px":"10px 20px",minHeight:te?"44px":"auto",background:l?"var(--bgTertiary)":"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",border:"none",borderRadius:"6px",color:"white",fontSize:te?"14px":"13px",fontWeight:600,cursor:l?"not-allowed":"pointer",opacity:l?.5:1,transition:"all 0.2s",whiteSpace:"nowrap",flexShrink:0}},l?"Inscribing...":`Create ${g.size}`)))),!I&&E&&qc.createPortal(Bc.createElement("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:9999,background:"black",display:"flex",flexDirection:"column",paddingTop:"env(safe-area-inset-top, 0px)",paddingBottom:"env(safe-area-inset-bottom, 0px)",paddingLeft:"env(safe-area-inset-left, 0px)",paddingRight:"env(safe-area-inset-right, 0px)"}},Bc.createElement("div",{style:{padding:te?"8px 12px":"12px 20px",background:"rgba(0, 0, 0, 0.8)",borderBottom:"1px solid rgba(255, 255, 255, 0.1)",fontSize:te?"10px":"11px",color:"var(--textMuted)",display:"flex",flexDirection:te?"column":"row",justifyContent:"space-between",alignItems:te?"stretch":"center",gap:te?"6px":"12px"}},Bc.createElement("div",{style:{display:"flex",gap:te?"6px":"16px",alignItems:"center",justifyContent:te?"space-between":"flex-start",flexWrap:"wrap"}},Bc.createElement("div",{style:{display:"flex",gap:"8px",alignItems:"center"}},Bc.createElement("span",{style:{color:"#f79a27",fontSize:te?"10px":"11px"}},"Available"),Bc.createElement("span",{style:{color:"#00e5ff",fontSize:te?"10px":"11px"}},"Selected"),Bc.createElement("span",{style:{color:"#E24A4A",fontSize:te?"10px":"11px"}},"Exists")),Bc.createElement("div",{style:{display:"flex",gap:"4px",alignItems:"center"}},Bc.createElement("button",{onClick:pe,title:"Zoom out",style:{padding:te?"8px 12px":"4px 8px",minHeight:te?"36px":"auto",minWidth:te?"36px":"auto",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:te?"6px":"3px",color:"white",fontSize:te?"16px":"11px",cursor:"pointer",display:"grid",placeItems:"center"}},"\u2212"),Bc.createElement("span",{style:{fontSize:te?"12px":"10px",minWidth:"35px",textAlign:"center"}},Math.round(100*V),"%"),Bc.createElement("button",{onClick:de,title:"Zoom in",style:{padding:te?"8px 12px":"4px 8px",minHeight:te?"36px":"auto",minWidth:te?"36px":"auto",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:te?"6px":"3px",color:"white",fontSize:te?"16px":"11px",cursor:"pointer",display:"grid",placeItems:"center"}},"+"),Bc.createElement("button",{onClick:fe,title:"Reset zoom and pan",style:{padding:te?"8px 12px":"4px 8px",minHeight:te?"36px":"auto",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:te?"6px":"3px",color:"white",fontSize:te?"12px":"10px",cursor:"pointer",display:"grid",placeItems:"center"}},"Reset"))),Bc.createElement("button",{onClick:()=>N(!1),style:{padding:te?"10px 16px":"4px 12px",minHeight:te?"40px":"auto",background:"rgba(226, 74, 74, 0.3)",border:"1px solid rgba(226, 74, 74, 0.5)",borderRadius:te?"6px":"4px",color:"white",fontSize:te?"13px":"11px",cursor:"pointer",fontWeight:600,textAlign:"center"}},"Close")),Bc.createElement("div",{style:{padding:"4px 12px",background:"rgba(74, 144, 226, 0.1)",fontSize:"10px",color:"var(--textMuted)",textAlign:"center"}},te?"Tap to select parcels \u2022 Drag to pan \u2022 Pinch to zoom":"Click to select \u2022 Hold to drag-select \u2022 Shift+Click for range \u2022 Ctrl+Drag to pan"),Bc.createElement("div",{style:{flex:1,minHeight:0,display:"flex",alignItems:"center",justifyContent:"center",padding:te?"8px":"20px",overflow:"hidden",cursor:G?"grabbing":V>1?"grab":"default",userSelect:"none",position:"relative",touchAction:"none"},onMouseDown:me,onMouseMove:ge,onMouseUp:he,onMouseLeave:he,onTouchStart:be,onTouchMove:ye,onTouchEnd:xe},Bc.createElement("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",transform:`scale(${V}) translate(${X.x/V}px, ${X.y/V}px)`,transformOrigin:"center center",transition:G?"none":"transform 0.1s ease-out"}},Bc.createElement(BN,{blockNumber:c,highlightParcels:Array.from(g),existingParcels:P,size:"auto",measureKey:`fullscreen-${v}`,className:"bitmap-renderer-fullscreen",onParcelMouseDown:ce,onParcelClick:le,onParcelMouseEnter:ue})))),document.body))}const XI=new Set(["image/png","image/jpeg","image/webp","image/avif","image/bmp"]),KI=[{value:"image/jpeg",label:"JPEG"},{value:"image/webp",label:"WebP"},{value:"image/png",label:"PNG"}],GI={"image/jpeg":".jpg","image/webp":".webp","image/png":".png"};function YI(e){return!Number.isFinite(e)||e<0?"\u2014":0===e?"0 B":e<1024?`${e} B`:e<1048576?`${(e/1024).toFixed(1)} KB`:`${(e/1048576).toFixed(2)} MB`}function JI(e,t,n){if(e<=n&&t<=n)return{width:e,height:t,scaled:!1};const r=Math.min(n/e,n/t);return{width:Math.round(e*r),height:Math.round(t*r),scaled:!0}}function QI({originalUrl:e,compressedUrl:t,quality:n,setQuality:r,outputFormat:i,originalSize:a,compressedSize:o,onClose:s}){const l=Bc.useRef(null),c=Bc.useRef(n),u=Bc.useRef(null),d=Bc.useRef(null),[p,f]=Bc.useState(null),[m,g]=Bc.useState(50),[h,b]=Bc.useState(n),y=Bc.useRef(!1),x=Bc.useCallback(()=>{const e=d.current,t=u.current;if(!e||!t)return;const n=t.getBoundingClientRect(),r=e.getBoundingClientRect();f({top:r.top-n.top,left:r.left-n.left,width:r.width,height:r.height})},[]),w=Bc.useCallback(e=>{y.current||(l.current=e.touches[0].clientX,c.current=h)},[h]),v=Bc.useCallback(e=>{if(y.current)return;if(null===l.current)return;const t=(e.touches[0].clientX-l.current)/(window.innerWidth||375)*.6,n=Math.max(.05,Math.min(1,c.current+t));b(n)},[]),S=Bc.useCallback(()=>{null===l.current||y.current||r(h),l.current=null},[h,r]),E=Bc.useCallback(e=>{const t=u.current;if(!t)return;const n=t.getBoundingClientRect();if(0===n.width)return;const r=Math.max(0,Math.min(100,(e-n.left)/n.width*100));g(r)},[]),N=Bc.useCallback(e=>{y.current=!0,e.currentTarget.setPointerCapture(e.pointerId),E(e.clientX)},[E]),I=Bc.useCallback(e=>{y.current&&E(e.clientX)},[E]),A=Bc.useCallback(()=>{y.current=!1},[]);Bc.useEffect(()=>{const e=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=e}},[]),Bc.useEffect(()=>{const e=d.current;if(!e)return;if("undefined"==typeof ResizeObserver)return;const t=new ResizeObserver(()=>x());return t.observe(e),()=>t.disconnect()},[e,x]);const k="image/png"===i,T=a>0?100*(1-o/a):0,C=o>a,B=i?.split("/")[1]?.toUpperCase()||"";return Pc.createElement("div",{style:{position:"fixed",inset:0,zIndex:9999,background:"rgba(0,0,0,0.95)",display:"flex",flexDirection:"column",touchAction:"none"},onTouchStart:w,onTouchMove:v,onTouchEnd:S},Pc.createElement("button",{type:"button",onClick:s,className:"absolute top-3 right-3 z-10 w-9 h-9 rounded-full bg-black/60 backdrop-blur-sm flex items-center justify-center text-white/80 hover:text-white transition-colors",style:{zIndex:1e4}},Pc.createElement("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"},Pc.createElement("path",{d:"M18 6L6 18M6 6l12 12"}))),Pc.createElement("div",{ref:u,className:"flex-1 relative flex items-center justify-center overflow-hidden",onPointerDown:N,onPointerMove:I,onPointerUp:A,onPointerCancel:A,style:{cursor:"ew-resize"}},e&&Pc.createElement("img",{ref:d,src:e,alt:"Original",className:"max-w-full max-h-full object-contain select-none",draggable:!1,onLoad:x}),t&&p&&Pc.createElement("img",{src:t,alt:"Compressed",className:"absolute select-none",style:{top:p.top,left:p.left,width:p.width,height:p.height,objectFit:"contain",clipPath:`inset(0 0 0 ${m}%)`},draggable:!1,key:t}),Pc.createElement("div",{className:"absolute top-0 bottom-0 pointer-events-none",style:{left:`${m}%`,transform:"translateX(-50%)"}},Pc.createElement("div",{className:"w-0.5 h-full bg-white/60"}),Pc.createElement("div",{className:"absolute top-1/2 -translate-y-1/2 -translate-x-1/2 w-8 h-8 rounded-full bg-white/80 shadow-lg flex items-center justify-center pointer-events-auto",style:{left:"50%"}},Pc.createElement("svg",{width:"12",height:"12",viewBox:"0 0 16 16",fill:"none"},Pc.createElement("path",{d:"M5 3L2 8L5 13",stroke:"#333",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),Pc.createElement("path",{d:"M11 3L14 8L11 13",stroke:"#333",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})))),Pc.createElement("div",{className:"absolute top-2 left-2 px-2 py-1 rounded bg-black/60 backdrop-blur-sm text-[10px] text-neutral-300 font-medium"},"Original \xb7 ",YI(a)),Pc.createElement("div",{className:"absolute top-2 right-2 px-2 py-1 rounded bg-black/60 backdrop-blur-sm text-[10px] text-right font-medium"},Pc.createElement("span",{className:C?"text-amber-400":"text-green-400"},YI(o)),Pc.createElement("span",{className:"text-neutral-500 ml-1"},B))),Pc.createElement("div",{className:"flex items-center justify-center gap-3 py-3 px-4",style:{paddingBottom:"calc(12px + env(safe-area-inset-bottom, 0px))"}},Pc.createElement("span",{className:"text-neutral-400 text-xs"},"Swipe \u2190 \u2192 to adjust quality"),Pc.createElement("span",{className:"text-white font-mono text-sm font-semibold"},k?"Lossless":`${Math.round(100*h)}%`),!k&&!C&&Pc.createElement("span",{className:"text-green-400 text-xs font-medium"},"\u2212",T.toFixed(0),"%")))}function ZI({originalUrl:e,compressedUrl:t,originalSize:n,compressedSize:r,contentType:i,outputFormat:a,onTapFullscreen:o}){const s=Bc.useRef(null),[l,c]=Bc.useState(50),u=Bc.useRef(!1),d=Bc.useRef(!1),p=Bc.useCallback(e=>{const t=s.current?.getBoundingClientRect();if(!t||0===t.width)return;const n=e-t.left,r=Math.max(0,Math.min(100,n/t.width*100));c(r)},[]),f=Bc.useCallback(e=>{u.current=!0,d.current=!1,e.currentTarget.setPointerCapture(e.pointerId),p(e.clientX)},[p]),m=Bc.useCallback(e=>{u.current&&(d.current=!0,p(e.clientX))},[p]),g=Bc.useCallback(()=>{const e=d.current;u.current=!1,d.current=!1,!e&&o&&o()},[o]),h=i?.split("/")[1]?.toUpperCase()||"",b=a?.split("/")[1]?.toUpperCase()||"",y=Bc.useRef(null),[x,w]=Bc.useState(null),v=Bc.useCallback(()=>{if(!y.current)return;const e=y.current;w({width:e.clientWidth,height:e.clientHeight})},[]);Bc.useEffect(()=>{const e=y.current;if(!e)return;if("undefined"==typeof ResizeObserver)return;const t=new ResizeObserver(()=>v());return t.observe(e),()=>t.disconnect()},[e,v]);const S=r>n;return Pc.createElement("div",{ref:s,className:"relative w-full overflow-hidden rounded-lg border border-neutral-800/60 bg-neutral-950 select-none",style:{touchAction:"none",cursor:"ew-resize"},onPointerDown:f,onPointerMove:m,onPointerUp:g,onPointerCancel:g},e&&Pc.createElement("img",{ref:y,src:e,alt:"Original",className:"block w-full h-auto object-contain",style:{maxHeight:"min(55vh, 400px)",width:"100%"},draggable:!1,onLoad:v}),t&&x&&Pc.createElement("img",{src:t,alt:"Compressed",className:"absolute top-0 left-0 block",style:{width:x.width,height:x.height,objectFit:"contain",clipPath:`inset(0 0 0 ${l}%)`},draggable:!1,key:t}),Pc.createElement("div",{className:"absolute top-0 bottom-0",style:{left:`${l}%`,transform:"translateX(-50%)"}},Pc.createElement("div",{className:"w-px h-full bg-white/80 shadow-lg",style:{minWidth:2}}),Pc.createElement("div",{className:"absolute top-1/2 -translate-y-1/2 -translate-x-1/2 w-9 h-9 rounded-full bg-white/90 shadow-lg flex items-center justify-center",style:{left:"50%",minWidth:36,minHeight:36}},Pc.createElement("svg",{width:"14",height:"14",viewBox:"0 0 16 16",fill:"none"},Pc.createElement("path",{d:"M5 3L2 8L5 13",stroke:"#333",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),Pc.createElement("path",{d:"M11 3L14 8L11 13",stroke:"#333",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})))),Pc.createElement("div",{className:"absolute top-1.5 left-1.5 px-1.5 py-0.5 rounded bg-black/70 backdrop-blur-sm max-w-[45%]"},Pc.createElement("div",{className:"text-[9px] font-semibold uppercase tracking-wide text-neutral-300 truncate"},"Original"),Pc.createElement("div",{className:"text-[9px] font-mono text-neutral-400 truncate"},YI(n)," ",Pc.createElement("span",{className:"text-neutral-500"},h))),Pc.createElement("div",{className:"absolute top-1.5 right-1.5 px-1.5 py-0.5 rounded bg-black/70 backdrop-blur-sm text-right max-w-[45%]"},Pc.createElement("div",{className:"text-[9px] font-semibold uppercase tracking-wide text-neutral-300 truncate"},"Compressed"),Pc.createElement("div",{className:"text-[9px] font-mono truncate "+(S?"text-amber-400":"text-green-400")},r>0?YI(r):"\u2014"," ",Pc.createElement("span",{className:"text-neutral-500"},b))),Pc.createElement("div",{className:"absolute bottom-1.5 left-1/2 -translate-x-1/2 px-2 py-0.5 rounded-full bg-black/50 backdrop-blur-sm"},Pc.createElement("span",{className:"text-[8px] text-neutral-400"},"Tap to expand")))}function eA({outputFormat:e,setOutputFormat:t,quality:n,setQuality:r,formatSupport:i,compressedBlob:a,compressing:o,originalSize:s,compressedSize:l,isPng:c,isLarger:u,savings:d,onSkip:p,onAcceptClick:f,onRemove:m,defaultSettingsOpen:g=!1}){const[h,b]=Bc.useState(!!g);Bc.useEffect(()=>{g&&b(!0)},[g]);const y=e?.split("/")[1]?.toUpperCase()||"";return Pc.createElement("div",{className:"space-y-0"},Pc.createElement("div",{className:"flex items-center gap-1.5"},Pc.createElement("button",{type:"button",onClick:()=>b(e=>!e),className:`\n            shrink-0 w-8 h-8 rounded-md flex items-center justify-center transition-colors touch-manipulation\n            ${h?"bg-purple-500/20 text-purple-300 border border-purple-500/40":"bg-neutral-900/60 text-neutral-400 border border-neutral-800/60 hover:border-neutral-700"}\n          `,title:"Compression settings"},Pc.createElement("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"},Pc.createElement("path",{d:"M12 3v1m0 16v1m-8-9H3m18 0h-1m-2.636-6.364l-.707.707M6.343 17.657l-.707.707m12.728 0l-.707-.707M6.343 6.343l-.707-.707"}),Pc.createElement("circle",{cx:"12",cy:"12",r:"3"}))),Pc.createElement("div",{className:"flex items-center gap-1 min-w-0 flex-1"},Pc.createElement("span",{className:"text-[10px] font-medium text-neutral-400 bg-neutral-800/60 px-1.5 py-0.5 rounded shrink-0"},y),!c&&Pc.createElement("span",{className:"text-[10px] font-mono text-neutral-500 shrink-0"},Math.round(100*n),"%"),l>0&&Pc.createElement("span",{className:"text-[10px] font-medium px-1.5 py-0.5 rounded shrink-0 "+(u?"bg-amber-500/10 text-amber-300":"bg-green-500/10 text-green-300")},u?`+${YI(l-s)}`:`\u2212${d.toFixed(0)}%`)),Pc.createElement("button",{type:"button",onClick:p,className:"shrink-0 px-2.5 py-1.5 rounded-md text-[11px] font-medium border border-neutral-800/60 bg-neutral-900/60 text-neutral-300 hover:bg-neutral-800 transition-colors touch-manipulation min-h-[32px]"},"Original")),h&&Pc.createElement("div",{className:"mt-1.5 p-2 rounded-lg border border-neutral-800/60 bg-neutral-900/80 space-y-2",style:{animation:"slideDown 150ms ease-out"}},Pc.createElement("div",null,Pc.createElement("div",{className:"text-[9px] font-semibold uppercase tracking-wide text-neutral-500 mb-1"},"Format"),Pc.createElement("div",{className:"flex gap-1"},KI.map(n=>{const r=i[n.value],a=!1===r,o=null===r,s=e===n.value;return Pc.createElement("button",{key:n.value,type:"button",disabled:a||o,onClick:()=>t(n.value),className:`\n                      flex-1 px-1.5 py-1.5 rounded text-[11px] font-medium transition-colors touch-manipulation min-h-[34px]\n                      ${s?"border-purple-400/70 bg-purple-500/15 text-purple-200 border":a||o?"border border-neutral-800/40 bg-neutral-900/30 text-neutral-600 cursor-not-allowed":"border border-neutral-800/60 bg-neutral-900/60 text-neutral-300 hover:border-neutral-700 hover:bg-neutral-800"}\n                    `},n.label)}))),c?Pc.createElement("p",{className:"text-[9px] text-neutral-500 leading-snug"},"PNG is lossless \u2014 output may be larger than original."):Pc.createElement("div",null,Pc.createElement("div",{className:"flex items-center justify-between"},Pc.createElement("span",{className:"text-[9px] font-semibold uppercase tracking-wide text-neutral-500"},"Quality"),Pc.createElement("span",{className:"text-[10px] font-mono text-neutral-300"},Math.round(100*n),"%")),Pc.createElement("input",{type:"range",min:.05,max:1,step:.01,value:n,onChange:e=>r(parseFloat(e.target.value)),className:"h-2.5 w-full cursor-pointer appearance-none rounded-full bg-neutral-800 accent-purple-500",style:{touchAction:"none"}}),Pc.createElement("div",{className:"flex justify-between text-[8px] text-neutral-600 -mt-0.5"},Pc.createElement("span",null,"Smaller"),Pc.createElement("span",null,"Higher quality"))),Pc.createElement("div",{className:"flex items-center justify-between text-[9px] text-neutral-500 pt-0.5 border-t border-neutral-800/40"},Pc.createElement("span",null,YI(s)," \u2192 ",YI(l)),!u&&l>0&&Pc.createElement("span",{className:"text-green-400"},"Save ",YI(s-l)))),Pc.createElement("style",null,"\n        @keyframes slideDown {\n          from { opacity: 0; transform: translateY(-4px); }\n          to   { opacity: 1; transform: translateY(0); }\n        }\n      "))}function tA({content:e,contentType:t,fileName:n="",maxDimension:r=4096,onAccept:i,onSkip:a,onRemove:o,onControlsReady:s,defaultSettingsOpen:l=!1}){const c=Bc.useRef(null),[u,d]=Bc.useState(null),[p,f]=Bc.useState(null),[m,g]=Bc.useState(0),[h,b]=Bc.useState(0),[y,x]=Bc.useState(.8),[w,v]=Bc.useState("image/jpeg"),[S,E]=Bc.useState(null),[N,I]=Bc.useState(null),[A,k]=Bc.useState(!1),[T,C]=Bc.useState(null),[B,P]=Bc.useState(null),[_,O]=Bc.useState(!1),[L,F]=Bc.useState({"image/jpeg":!0,"image/webp":null,"image/png":!0}),M=Bc.useRef(null),R=Bc.useRef(0),$=Bc.useRef(!1),U=Bc.useRef(null),z=Bc.useRef(s),D=Bc.useRef(a),H=Bc.useRef(i),W=Bc.useRef(o);Bc.useEffect(()=>{z.current=s},[s]),Bc.useEffect(()=>{D.current=a},[a]),Bc.useEffect(()=>{H.current=i},[i]),Bc.useEffect(()=>{W.current=o},[o]);const j=Bc.useCallback(()=>{const e=M.current;if(e&&"function"==typeof e.close)try{e.close()}catch{}M.current=null},[]);Bc.useEffect(()=>()=>{j(),d(e=>(e&&URL.revokeObjectURL(e),null)),f(e=>(e&&URL.revokeObjectURL(e),null)),U.current&&clearTimeout(U.current)},[]),Bc.useEffect(()=>{let e=!1;return(async()=>{const t=await new Promise(e=>{try{const t=document.createElement("canvas");t.width=1,t.height=1,t.getContext("2d").fillRect(0,0,1,1),t.toBlob(t=>e(!!t&&t.size>0),"image/webp",.5)}catch{e(!1)}});e||F({"image/jpeg":!0,"image/webp":t,"image/png":!0})})(),()=>{e=!0}},[]),Bc.useEffect(()=>{if(!e)return;++R.current,j();const n=function(e,t){const n=e instanceof Uint8Array?e:new Uint8Array(e);return new Blob([n],{type:t})}(e,t);d(e=>(e&&URL.revokeObjectURL(e),URL.createObjectURL(n))),g(n.size),C(null),b(0),f(e=>(e&&URL.revokeObjectURL(e),null)),P(null),E(null),I(null),$.current=!1;let r=!1;return(async()=>{try{let t=null;if("function"==typeof createImageBitmap)try{t=await createImageBitmap(n,{imageOrientation:"from-image"})}catch{try{t=await createImageBitmap(n)}catch{}}if(!t){const r=URL.createObjectURL(n);try{t=await(e=r,new Promise((t,n)=>{const r=new Image;r.onload=()=>t(r),r.onerror=()=>n(new Error("Failed to decode image. The file may be corrupt or unsupported.")),r.src=e}))}finally{URL.revokeObjectURL(r)}}if(r)return void(t&&"function"==typeof t.close&&t.close());M.current=t;const i=t.naturalWidth||t.width,a=t.naturalHeight||t.height;E({width:i,height:a}),P(null)}catch(Pk){if(r)return;P(Pk?.message||"Failed to decode image.")}var e})(),()=>{r=!0}},[e,t,r]),Bc.useEffect(()=>{const e=M.current;if(!e||!S)return;if(Object.values(L).some(e=>null===e))return;if($.current)return;$.current=!0;const t=JI(S.width,S.height,r),n=document.createElement("canvas");n.width=t.width,n.height=t.height;const i=n.getContext("2d");i.fillStyle="#ffffff",i.fillRect(0,0,t.width,t.height),i.drawImage(e,0,0,t.width,t.height);const a=["image/jpeg","image/webp"].filter(e=>!0===L[e]),o={"image/jpeg":[.8,.7,.6],"image/webp":[.8,.7,.6]},s=(e,t)=>new Promise(r=>{try{n.toBlob(n=>{r(n&&n.size>0?{format:e,quality:t,size:n.size}:null)},e,t)}catch{r(null)}});let l=!1;return(async()=>{const e=[];for(const n of a)for(const t of o[n]||[.75,.6]){if(l)return;const r=await s(n,t);r&&e.push(r)}if(n.width=0,n.height=0,l)return;if(0===e.length)return v(a[0]||"image/jpeg"),void x(.85);e.sort((e,t)=>e.size-t.size);const t=m,r=e.filter(e=>e.size<.95*t),i=r.length>0?r[0]:null;if(!i)return v("image/jpeg"),void x(.85);v(i.format),x(i.quality)})(),()=>{l=!0,n.width=0,n.height=0}},[S,L,r,m]);const V=Bc.useCallback((e,t,n,r,i)=>{k(!0);const a=++R.current;requestAnimationFrame(()=>{if(R.current===a)try{const o=c.current||document.createElement("canvas");o.width=t,o.height=n;const s=o.getContext("2d");s.clearRect(0,0,t,n),"image/jpeg"===r&&(s.fillStyle="#ffffff",s.fillRect(0,0,t,n)),s.drawImage(e,0,0,t,n),o.toBlob(e=>{if(R.current!==a)return;if(!e)return P("Browser could not encode in the selected format."),void k(!1);const t=URL.createObjectURL(e);f(e=>(e&&URL.revokeObjectURL(e),t)),b(e.size),C(e),k(!1),P(null)},r,i)}catch(_k){if(R.current!==a)return;P("Compression failed: "+(_k?.message||String(_k))),k(!1)}})},[]);Bc.useEffect(()=>{if(!M.current||!S)return;if(!1===L[w])return P(`Your browser does not support ${w} encoding.`),C(null),b(0),void f(e=>(e&&URL.revokeObjectURL(e),null));const e=JI(S.width,S.height,r);I(e);const t="image/png"===w?void 0:y;return U.current&&clearTimeout(U.current),U.current=setTimeout(()=>{U.current=null,M.current&&V(M.current,e.width,e.height,w,t)},120),()=>{U.current&&(clearTimeout(U.current),U.current=null)}},[y,w,S,r,L,V]);const q=Bc.useCallback(async()=>{if(!T||!H.current)return;const e=await T.arrayBuffer(),t=GI[w]||".bin",r=(n||"").replace(/\.[^.]+$/,"")||"image";H.current(e,w,r+t,{originalSize:m,compressedSize:h,quality:y,savedBytes:m-h,savedPercent:m>0?(100*(1-h/m)).toFixed(1):"0"})},[T,w,n,m,h,y]),X=m>0?100*(1-h/m):0,K=h>m,G="image/png"===w,Y=Bc.useCallback(()=>{D.current&&D.current()},[]),J=Bc.useCallback(()=>{W.current&&W.current()},[]),Q=Bc.useMemo(()=>({outputFormat:w,setOutputFormat:v,quality:y,setQuality:x,formatSupport:L,compressedBlob:T,compressing:A,originalSize:m,compressedSize:h,isPng:G,isLarger:K,savings:X,onSkip:Y,onAcceptClick:q,onRemove:J,defaultSettingsOpen:l}),[w,y,L,T,A,m,h,G,K,X,Y,q,J,l]);return Bc.useEffect(()=>{z.current&&z.current(Q)},[Q]),e&&XI.has(t)?Pc.createElement("div",{className:"space-y-1.5"},S&&Pc.createElement("div",{className:"flex items-center gap-2 text-[10px] text-neutral-500"},Pc.createElement("span",null,S.width,"\xd7",S.height),N?.scaled&&Pc.createElement("span",{className:"text-amber-400/80 font-medium"},"\u2192 ",N.width,"\xd7",N.height)),B&&Pc.createElement("div",{className:"rounded-md border border-red-500/40 bg-red-500/10 px-3 py-1.5 text-xs text-red-300"},B),Pc.createElement(ZI,{originalUrl:u,compressedUrl:p,originalSize:m,compressedSize:h,contentType:t,outputFormat:w,onTapFullscreen:()=>O(!0)}),Pc.createElement(eA,{...Q}),_&&Pc.createElement(QI,{originalUrl:u,compressedUrl:p,quality:y,setQuality:x,outputFormat:w,originalSize:m,compressedSize:h,onClose:()=>O(!1)}),Pc.createElement("canvas",{ref:c,style:{display:"none"}})):null}function nA({content:e="",contentType:t="text/plain",contentSize:n,onContentChange:r,onContentTypeChange:i,onContentEncodingChange:a,compressBeforeInscribe:o=!1,onCompressBeforeInscribeChange:s,isDraftCompressing:l=!1,draftCompressedSize:c=null,fileName:u="",onFileNameChange:d,onImportJson:p,showTemplates:f=!0,feeRate:m=5,onFeeRateChange:g,feeEstimate:h,walletAddress:b,walletState:y,walletInscriptions:x=[],loadingInscriptions:w=!1,selectedUtxos:v=[],onUtxosChange:S,onUtxoSelect:E,onFeesLoaded:N,onFilteredUtxosLoaded:I,utxoRescanRequestId:A=0,onUtxoScanStateChange:k,walletAssetScanState:T=null,onRequestWalletRescan:C,showUtxoTab:B=!0,selectedParents:P=[],reinscriptionTarget:_=null,delegateId:O="",metaprotocol:L="",metadata:F="",properties:M="",customTags:R=null,pointer:$="",contentEncoding:U="",recipientAddress:z="",repeatCount:D=1,onRepeatCountChange:H,batchItems:W=[],onAddToBatch:j,onRemoveFromBatch:V,onDuplicateBatchItem:q,onEditBatchItem:X,inscriptionMode:K="standard",inscribing:G=!1,selectedSaleInscription:Y,salePriceSats:J="",onSalePriceSatsChange:Q,listingScriptAddress:Z="",onListingScriptAddressChange:ee,markerValueSats:te="",onMarkerValueSatsChange:ne,listingDryRun:re=!1,onListingDryRunChange:ie,onCreateListingTx:ae,onCreateBulkListingTx:oe,createListingDisabled:se=!1,multiListingDisabled:le=!1,sellerStatus:ce="",sellerError:ue="",bulkSellerStatus:de="",bulkSellerError:pe="",bulkBundleJson:fe="",onCreateMultiListingTx:me,multiSellerStatus:ge="",multiSellerError:he="",multiListingResult:be=null,multiAssetPricing:ye={},onMultiAssetPriceChange:xe,onMultiUniformPriceChange:we,collectionAuthoritySlots:ve=[],collectionAuthorityStatus:Se="",collectionAuthorityError:Ee="",collectionAuthoritySlotId:Ne="",onCollectionAuthoritySlotIdChange:Ie,onLaunchCollection:Ae,onLaunchParcelManifest:ke,previousManifest:Te=null,previousManifestStatus:Ce="",previousManifestError:Be="",onLoadPreviousManifest:Pe,buyRevealTxid:_e="",onBuyRevealTxidChange:Oe,onBuyFromRevealTx:Le,buyDisabled:Fe=!1,buyFundingNeeded:Me=!1,onCreateBuyFundingTx:Re,buyFundingDisabled:$e=!1,buyFundingStatus:Ue="",buyFundingError:ze="",saleMinBlockHeight:De,onSaleMinBlockHeightChange:He,buyStatus:We="",buyError:je="",manualSellerPsbt:Ve="",manualSellerStatus:qe="",manualSellerError:Xe="",onCreateManualSellerOfferPsbt:Ke,manualBuyStatus:Ge="",manualBuyError:Ye="",onBuyFromSellerOfferPsbt:Je,manualBuyerFundedPsbt:Qe="",manualBuyerFundedStatus:Ze="",manualBuyerFundedError:et="",onCreateBuyerFundedPsbtForSeller:tt,manualSellerCountersignStatus:nt="",manualSellerCountersignError:rt="",onCountersignAndBroadcastFromBuyerFundedPsbt:it,onOodlLayoutChange:at,oodlSection:ot,onOodlSectionChange:st,onActiveTabChange:lt,tabRequest:ct=null,onConnect:ut,onParentSelect:dt,onMobilePanelChange:pt,guidedFlowEnabled:ft=!1,guidedFlowStep:mt="content",onContinueToAdvancedOptions:gt}){const[ht,bt]=Bc.useState((()=>{const e=String(ct?.tab||"").trim();return e&&("utxos"!==e||B)?e:!B||v&&0!==v.length?"text":"utxos"})()),[yt,xt]=Bc.useState(!1),[wt,vt]=Bc.useState(!1),[St,Et]=Bc.useState(null),[Nt,It]=Bc.useState(!1),At=Bc.useRef(ct?.seq??-1),kt="utxos"!==ht&&"oodl"!==ht,Tt=!!ft&&kt&&(!Array.isArray(W)||0===W.length)&&"review"!==String(mt||"");Bc.useCallback(e=>{const t=Number(e);return!Number.isFinite(t)||t<0?null:t<1024?`${Math.round(t).toLocaleString()} B`:t<1048576?`${(t/1024).toFixed(1)} KB`:t<1073741824?`${(t/1048576).toFixed(2)} MB`:`${(t/1073741824).toFixed(2)} GB`},[]),Bc.useEffect(()=>{lt&&lt(ht)},[ht,lt]),Bc.useEffect(()=>{if(!ct)return;const{tab:e,seq:t}=ct;if(null==t||t===At.current)return;At.current=t;const n=String(e||"").trim();n&&n!==ht&&("utxos"!==n||B)&&("review"===n&&Tt||"review"===n&&ft||(It("utxos"===n),bt(n)))},[ct,ht,B,Tt]);const Ct=Bc.useMemo(()=>'{\n  "version": 1,\n  "feeRate": 8,\n  "fees": {\n    "developer": {\n      "enabled": false,\n      "mode": "transaction",\n      "address": "bc1pYOUR_DEV_FEE_ADDRESS_HERE",\n      "amountSats": 1000,\n      "description": "Developer API Fee"\n    },\n    "customFees": []\n  },\n  "defaults": {\n    "contentType": "text/plain",\n    "metaprotocol": "ord",\n    "metadata": {\n      "app": "oodinals",\n      "note": "Working test JSON: Apply JSON, then Inscribe. Optional: enable fees.developer and set a real address."\n    },\n    "properties": {\n      "collection": "Test",\n      "createdBy": "JSON Import"\n    },\n    "postage": 546\n  },\n  "items": [\n    {\n      "fileName": "hello-1.txt",\n      "content": "Hello from Oodinals JSON!\\n\\nThis is item #1.",\n      "repeatCount": 1\n    },\n    {\n      "fileName": "hello-2.txt",\n      "content": "Hello again \u2014 item #2.",\n      "repeatCount": 1,\n      "customTags": {\n        "101": "per-item-tag"\n      }\n    },\n    {\n      "fileName": "bytes.bin",\n      "contentType": "application/octet-stream",\n      "contentBase64": "AAECAwQFBgcICQ=="\n    }\n  ]\n}',[]),[Bt,Pt]=Bc.useState(Ct),[_t,Ot]=Bc.useState(""),Lt=Bc.useRef(ht);Bc.useEffect(()=>{Lt.current=ht},[ht]);const Ft=Bc.useCallback(t=>{!Nt&&!wt&&"utxos"===Lt.current&&t&&t.spendable&&t.spendable.length>0&&(e&&"string"!=typeof e&&(e instanceof ArrayBuffer||"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(e)||"[object ArrayBuffer]"===Object.prototype.toString.call(e))?bt("upload"):(a&&U&&a(""),bt("text")),vt(!0));const n=t?.spendable?JSON.stringify(t.spendable.map(e=>`${e.txid}:${e.vout}`)):null;I&&n!==St&&(Et(n),I(t))},[I,St,Nt,wt,a,U,e]);Bc.useEffect(()=>{y?.isConnected&&v&&0!==v.length||wt&&vt(!1)},[y?.isConnected,v,wt]);const Mt=[{value:"text/plain",label:"Plain Text",icon:"\ud83d\udcc4",color:"#06b6d4"},{value:"text/html",label:"HTML",icon:"\ud83c\udf10",color:"#a855f7"},{value:"text/javascript",label:"JavaScript",icon:"\u26a1",color:"#f59e0b"},{value:"application/json",label:"JSON",icon:"\ud83d\udcca",color:"#10b981"},{value:"text/markdown",label:"Markdown",icon:"\ud83d\udcdd",color:"#22c55e"},{value:"application/xml",label:"XML",icon:"\ud83e\udde9",color:"#60a5fa"},{value:"text/yaml",label:"YAML",icon:"\ud83e\uddfe",color:"#f97316"},{value:"application/typescript",label:"TypeScript",icon:"\ud83e\udde0",color:"#3b82f6"},{value:"text/css",label:"CSS",icon:"\ud83c\udfa8",color:"#ec4899"},{value:"image/svg+xml",label:"SVG",icon:"\ud83d\uddbc\ufe0f",color:"#8b5cf6"},{value:"image/png",label:"PNG Image",icon:"\ud83d\uddbc\ufe0f",color:"#06b6d4"},{value:"image/jpeg",label:"JPEG Image",icon:"\ud83d\udcf7",color:"#f59e0b"},{value:"image/webp",label:"WebP Image",icon:"\ud83c\udf9e\ufe0f",color:"#10b981"},{value:"image/avif",label:"AVIF Image",icon:"\ud83d\uddbc\ufe0f",color:"#10b981"},{value:"model/gltf-binary",label:"GLB (3D Model)",icon:"\ud83e\uddca",color:"#06b6d4"},{value:"model/gltf+json",label:"GLTF (3D Model)",icon:"\ud83e\uddca",color:"#3b82f6"}],Rt=[{name:"Simple Text",contentType:"text/plain",content:"Hello, Bitcoin! This is my inscription."},{name:"BRC-20 Token",contentType:"application/json",content:JSON.stringify({p:"brc-20",op:"deploy",tick:"ordi",max:"21000000",lim:"1000"},null,2)},{name:"HTML Page",contentType:"text/html",content:"<!DOCTYPE html>\n<html>\n<head>\n  <title>My Inscription</title>\n  <style>\n    body { \n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      color: white;\n      font-family: Arial, sans-serif;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      height: 100vh;\n      margin: 0;\n    }\n  </style>\n</head>\n<body>\n  <h1>Hello from Bitcoin!</h1>\n</body>\n</html>"},{name:"SVG Art",contentType:"image/svg+xml",content:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">\n  <circle cx="50" cy="50" r="40" fill="#a855f7" />\n  <text x="50" y="55" text-anchor="middle" fill="white" font-size="20">\u20bf</text>\n</svg>'},{name:"Metadata JSON",contentType:"application/json",content:JSON.stringify({name:"My Inscription",description:"A unique digital artifact on Bitcoin",attributes:[{trait_type:"Rarity",value:"Legendary"},{trait_type:"Type",value:"Genesis"}]},null,2)}],$t=Bc.useCallback(e=>{a&&U&&a(""),r&&r(e.target.value)},[r,a,U]),Ut=Bc.useCallback(async e=>{if(e)try{const t=(e.type||"").trim();d&&d(e.name||"");const n=async e=>{const t=(e.name||"").toLowerCase();if(t.endsWith(".gz"))return"gzip";if(t.endsWith(".br"))return"br";const n=e.slice(0,4),r=await n.arrayBuffer(),i=new Uint8Array(r);if(i.length>=2){if(31===i[0]&&139===i[1])return"gzip";if(120===i[0]&&(1===i[1]||94===i[1]||156===i[1]||218===i[1]))return"deflate"}return""},o=e=>{const t=(e||"").toLowerCase().replace(/\.(gz|br)$/i,""),n=t.split("/").pop()||t;return!n.includes(".")&&new Set(["nexus-core","nexus-loader","nexus-unified","oordinals-sdk"]).has(n)?"application/javascript":t.endsWith(".json")?"application/json":t.endsWith(".html")||t.endsWith(".htm")?"text/html":t.endsWith(".md")||t.endsWith(".markdown")?"text/markdown":t.endsWith(".txt")?"text/plain":t.endsWith(".xml")?"application/xml":t.endsWith(".yaml")||t.endsWith(".yml")?"text/yaml":t.endsWith(".csv")?"text/csv":t.endsWith(".js")||t.endsWith(".mjs")||t.endsWith(".cjs")||t.endsWith(".jsx")?"application/javascript":t.endsWith(".ts")||t.endsWith(".tsx")?"application/typescript":t.endsWith(".map")?"application/json":t.endsWith(".css")?"text/css":t.endsWith(".svg")?"image/svg+xml":t.endsWith(".png")?"image/png":t.endsWith(".jpg")||t.endsWith(".jpeg")?"image/jpeg":t.endsWith(".gif")?"image/gif":t.endsWith(".webp")?"image/webp":t.endsWith(".avif")?"image/avif":t.endsWith(".ico")?"image/x-icon":t.endsWith(".bmp")?"image/bmp":t.endsWith(".tif")||t.endsWith(".tiff")?"image/tiff":t.endsWith(".pdf")?"application/pdf":t.endsWith(".wasm")?"application/wasm":t.endsWith(".zip")?"application/zip":t.endsWith(".tar")?"application/x-tar":t.endsWith(".mp4")?"video/mp4":t.endsWith(".webm")?"video/webm":t.endsWith(".ogg")?"audio/ogg":t.endsWith(".mp3")?"audio/mpeg":t.endsWith(".wav")?"audio/wav":t.endsWith(".flac")?"audio/flac":t.endsWith(".gltf")?"model/gltf+json":t.endsWith(".glb")?"model/gltf-binary":t.endsWith(".epub")?"application/epub+zip":null},s=await n(e);a&&a(s);let l=null;if(!s)try{const t=new Uint8Array(await e.slice(0,32).arrayBuffer()),n=(e,t,n=0)=>t.every((t,r)=>e[n+r]===t),r=e=>Array.from(e).map(e=>e.charCodeAt(0));if(n(t,[137,80,78,71,13,10,26,10]))l="image/png";else if(n(t,[255,216,255]))l="image/jpeg";else if(n(t,r("GIF8")))l="image/gif";else if(n(t,[37,80,68,70,45]))l="application/pdf";else if(n(t,[0,97,115,109]))l="application/wasm";else if(n(t,r("RIFF")))n(t,r("WEBP"),8)?l="image/webp":n(t,r("WAVE"),8)&&(l="audio/wav");else if(n(t,r("OggS")))l="audio/ogg";else if(n(t,r("fLaC")))l="audio/flac";else if(n(t,r("ftyp"),4)){const e=e=>String.fromCharCode(t[e]||0,t[e+1]||0,t[e+2]||0,t[e+3]||0),n=e(8),r=new Set([n]);for(let i=16;i+3<t.length;i+=4)r.add(e(i));if(r.has("avif")||r.has("avis"))l="image/avif";else{const e=new Set(["isom","iso2","mp41","mp42","avc1","dash","MSNV"]);for(const t of r)if(e.has(t)){l="video/mp4";break}}}else n(t,r("glTF"))?l="model/gltf-binary":n(t,[80,75,3,4])&&(l="application/zip")}catch{}let c=t||"application/octet-stream";if(s){const t=o(e.name);t&&(c=t)}else if(l)c=l;else{const t=o(e.name);t&&(c=t)}if(a&&U&&a(""),!("application/octet-stream"!==c||t&&"application/octet-stream"!==t||l)){const t=s?"This file appears encoded (e.g. .br/.gz). If it is a JS bundle, use application/javascript.":"Common values: text/plain, application/json, text/html, application/javascript, image/png, application/wasm.",n=(window.prompt(`Unknown content type for "${e.name||"uploaded file"}".\n\n${t}\n\nEnter MIME type (or leave blank for application/octet-stream):`,"application/octet-stream")||"").trim();n&&(c=n)}if(!s&&(c.startsWith("text/")||c.includes("json")||c.includes("javascript")||c.includes("xml")||c.includes("yaml")||c.includes("typescript"))){const t=await e.text();r&&r(t),i&&i(c)}else if(!s&&c.startsWith("image/")){const t=await e.arrayBuffer();r&&r(t),i&&i(c)}else{const t=await e.arrayBuffer();r&&r(t),i&&i(c||"application/octet-stream")}}catch(tn){alert("Error reading file: "+tn.message)}},[r,i,a,d]),zt=Bc.useCallback(e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?xt(!0):"dragleave"===e.type&&xt(!1)},[]),Dt=Bc.useCallback(e=>{e.preventDefault(),e.stopPropagation(),xt(!1),e.dataTransfer.files&&e.dataTransfer.files[0]&&Ut(e.dataTransfer.files[0])},[Ut]),Ht=Bc.useCallback(e=>{r&&r(e.content),i&&i(e.contentType),a&&a(""),d&&d(""),bt("text")},[r,i,a,d]),Wt=new Blob([e]).size,jt="number"==typeof n?n:Wt,Vt=Bc.useMemo(()=>!!e&&"string"!=typeof e&&(e instanceof ArrayBuffer||!("undefined"==typeof ArrayBuffer||!ArrayBuffer.isView||!ArrayBuffer.isView(e))||"[object ArrayBuffer]"===Object.prototype.toString.call(e)),[e]);return Bc.useEffect(()=>{Tt&&"review"===ht&&bt(Vt?"upload":"text")},[Tt,ht,Vt]),Bc.createElement("div",{className:"content-editor inscription-card",style:{height:"100%",display:"flex",flexDirection:"column",overflow:"review"===ht?"visible":"hidden",minWidth:0}},"oodl"!==ht&&"utxos"!==ht?Bc.createElement("div",{className:"inscription-card-header content-editor-header",style:{padding:"4px 8px",flexShrink:0,background:"rgb(23, 23, 23)",borderBottom:"1px solid rgb(38, 38, 38)",borderRadius:"12px 12px 0 0",overflow:"hidden"}},Bc.createElement("div",{className:"content-editor-header-main",style:{minWidth:0,width:"100%",display:"flex",alignItems:"center",gap:"4px"}},Bc.createElement("div",{className:"content-editor-tabs",style:{flex:1,minWidth:0}},kt?Bc.createElement(Bc.Fragment,null,Bc.createElement("button",{className:"tab-button "+("text"===ht?"active":""),onClick:()=>{It(!1),Vt?bt("upload"):(a&&U&&a(""),bt("text"))},style:{background:"text"===ht?"var(--bgTertiary)":"transparent",border:"none",borderBottom:"text"===ht?"2px solid var(--accentPurple)":"2px solid transparent",padding:"6px 12px",color:"text"===ht?"var(--textPrimary)":"var(--textMuted)",fontWeight:"var(--fontWeight-medium)",fontSize:"13px",cursor:"pointer",transition:"var(--transition-fast)"}},"Text"),Bc.createElement("button",{className:"tab-button "+("upload"===ht?"active":""),onClick:()=>{It(!1),bt("upload")},style:{background:"upload"===ht?"var(--bgTertiary)":"transparent",border:"none",borderBottom:"upload"===ht?"2px solid var(--accentPurple)":"2px solid transparent",padding:"6px 12px",color:"upload"===ht?"var(--textPrimary)":"var(--textMuted)",fontWeight:"var(--fontWeight-medium)",fontSize:"13px",cursor:"pointer",transition:"var(--transition-fast)"}},"Upload"),f?Bc.createElement("button",{className:"tab-button "+("templates"===ht?"active":""),onClick:()=>{It(!1),bt("templates")},style:{background:"templates"===ht?"var(--bgTertiary)":"transparent",border:"none",borderBottom:"templates"===ht?"2px solid var(--accentPurple)":"2px solid transparent",padding:"6px 12px",color:"templates"===ht?"var(--textPrimary)":"var(--textMuted)",fontWeight:"var(--fontWeight-medium)",fontSize:"13px",cursor:"pointer",transition:"var(--transition-fast)"}},"Templates"):null,Bc.createElement("button",{className:"tab-button "+("json"===ht?"active":""),onClick:()=>{It(!1),bt("json")},style:{background:"json"===ht?"var(--bgTertiary)":"transparent",border:"none",borderBottom:"json"===ht?"2px solid var(--accentPurple)":"2px solid transparent",padding:"6px 12px",color:"json"===ht?"var(--textPrimary)":"var(--textMuted)",fontWeight:"var(--fontWeight-medium)",fontSize:"13px",cursor:"pointer",transition:"var(--transition-fast)"},title:"Paste a JSON spec to populate draft or batch"},"JSON"),Bc.createElement("button",{className:"tab-button "+("bitmap"===ht?"active":""),onClick:()=>{It(!1),bt("bitmap")},style:{background:"bitmap"===ht?"var(--bgTertiary)":"transparent",border:"none",borderBottom:"bitmap"===ht?"2px solid var(--accentPurple)":"2px solid transparent",padding:"6px 12px",color:"bitmap"===ht?"var(--textPrimary)":"var(--textMuted)",fontWeight:"var(--fontWeight-medium)",fontSize:"13px",cursor:"pointer",transition:"var(--transition-fast)"}},"Bitmap/Parcels"),!ft&&Bc.createElement("button",{className:"tab-button max-lg:hidden "+("review"===ht?"active":""),onClick:()=>{Tt||(It(!1),bt("review"))},disabled:Tt,style:{background:"review"===ht?"var(--bgTertiary)":"transparent",border:"none",borderBottom:"review"===ht?"2px solid var(--accentPurple)":"2px solid transparent",padding:"6px 12px",color:"review"===ht?"var(--textPrimary)":"var(--textMuted)",fontWeight:"var(--fontWeight-medium)",fontSize:"13px",cursor:Tt?"not-allowed":"pointer",transition:"var(--transition-fast)"},title:Tt?"Add to batch first (Advanced Options)":"Review batch items and inscribe"},"Review")):null))):null,Bc.createElement("div",{style:{flex:1,minHeight:0,display:"flex",flexDirection:"column",overflow:"review"===ht?"visible":"hidden"}},Bc.createElement("div",{style:{flex:1,minHeight:0,padding:"8px",overflowY:"auto",overflowX:"hidden",WebkitOverflowScrolling:"touch"}},Bc.createElement("div",{style:{height:"100%",display:"flex",flexDirection:"column",minHeight:0}},B&&Bc.createElement("div",{style:{display:"utxos"===ht?"block":"none"},"aria-hidden":"utxos"!==ht},Bc.createElement(GE,{walletAddress:b,walletState:y,selectedUtxos:v,onUtxosChange:S,onUtxoSelect:E,onFeesLoaded:N,onFilteredUtxosLoaded:Ft,rescanRequestId:A,onScanStateChange:k,autoFetch:!0,minUtxoValue:1e4,requiredAmount:h?.totalRequired||0})),"text"===ht&&Bc.createElement("div",{className:"fade-in",style:{flex:1,display:"flex",flexDirection:"column",position:"relative",minHeight:0}},Bc.createElement("div",{style:{position:"absolute",top:"8px",right:"8px",zIndex:10}},Bc.createElement("div",{style:{display:"flex",gap:"8px"}},Bc.createElement("select",{className:"form-select",value:t,onChange:e=>i&&i(e.target.value),title:"Quick select common MIME types",style:{fontSize:"11px",padding:"4px 8px",background:"rgba(23, 23, 23, 0.95)",border:"1px solid rgb(64, 64, 64)",borderRadius:"6px",color:"rgb(212, 212, 212)"}},Mt.map(e=>Bc.createElement("option",{key:e.value,value:e.value},e.icon," ",e.label))),Bc.createElement("input",{type:"text",className:"form-input",value:t,onChange:e=>i&&i(e.target.value),placeholder:"Custom MIME type (e.g. application/pdf)",title:"Enter any MIME type. This becomes tag 1 in the envelope.",style:{fontSize:"11px",padding:"4px 8px",background:"rgba(23, 23, 23, 0.95)",border:"1px solid rgb(64, 64, 64)",borderRadius:"6px",color:"rgb(212, 212, 212)",minWidth:"220px"}}))),Vt&&Bc.createElement("div",{className:"validation-warning",style:{marginBottom:"8px"}},Bc.createElement("span",null,"\u26a0\ufe0f"),Bc.createElement("div",null,"Binary/encoded content is loaded. Use the Upload tab (Text editor is disabled for this content).")),Bc.createElement("textarea",{className:"form-input form-textarea",value:"string"==typeof e?e:"",onChange:$t,placeholder:"Enter your inscription content here...",disabled:Vt,dir:"ltr",style:{flex:1,width:"100%",minHeight:0,fontFamily:"var(--fontFamily-mono)",fontSize:"13px",lineHeight:"1.5",resize:"none",paddingTop:"40px",direction:"ltr",unicodeBidi:"plaintext",textAlign:"left"}})),"json"===ht&&Bc.createElement("div",{className:"fade-in",style:{height:"100%",display:"flex",flexDirection:"column",gap:"10px"}},Bc.createElement("div",{style:{background:"rgba(23, 23, 23, 0.6)",border:"1px solid rgb(38, 38, 38)",borderRadius:"10px",padding:"10px"}},Bc.createElement("div",{style:{fontSize:"13px",fontWeight:700,color:"var(--textPrimary)",marginBottom:"6px"}},"\ud83e\uddfe JSON Import"),Bc.createElement("div",{style:{fontSize:"12px",color:"var(--textMuted)",lineHeight:1.4}},"Paste a JSON spec to build a single inscription or a batch. If the JSON contains ",Bc.createElement("span",{style:{fontFamily:"monospace"}},"items"),", it will replace the current batch.")),Bc.createElement("textarea",{value:Bt,onChange:e=>{Pt(e.target.value),_t&&Ot("")},placeholder:'{\n  "version": 1,\n  "feeRate": 8,\n  "item": {\n    "contentType": "text/plain",\n    "content": "Hello",\n    "parentIds": ["<txid>i0"],\n    "delegateId": "<txid>i0"\n  }\n}',style:{flex:1,width:"100%",resize:"none",padding:"10px",borderRadius:"10px",border:"1px solid rgb(64, 64, 64)",background:"rgba(10, 10, 10, 0.7)",color:"rgb(212, 212, 212)",fontFamily:"monospace",fontSize:"12px",lineHeight:1.35}}),_t&&Bc.createElement("div",{style:{background:"rgba(239, 68, 68, 0.12)",border:"1px solid rgba(239, 68, 68, 0.35)",borderRadius:"10px",padding:"10px",color:"rgb(252, 165, 165)",fontSize:"12px"}},_t),Bc.createElement("div",{style:{display:"flex",gap:"10px",justifyContent:"flex-end"}},Bc.createElement("button",{onClick:()=>{try{if(!p)return void Ot("JSON import is not available in this build.");const e=String(Bt||"").trim();if(!e)return void Ot("Paste a JSON spec first.");p(e)}catch(Pk){Ot(Pk?.message||String(Pk))}},className:"px-4 py-2 rounded-lg bg-purple-600 hover:bg-purple-500 text-white transition-colors",style:{fontSize:"12px",fontWeight:700}},"Apply JSON"))),"upload"===ht&&Bc.createElement("div",{className:"fade-in"},!u&&Bc.createElement("div",{className:"file-drop-zone "+(yt?"active":""),onDragEnter:zt,onDragLeave:zt,onDragOver:zt,onDrop:Dt,style:{border:"2px dashed "+(yt?"var(--accentPurple)":"var(--borderMedium)"),borderRadius:"var(--radius-lg)",padding:"30px 20px",textAlign:"center",background:yt?"var(--bgTertiary)":"var(--bgSecondary)",transition:"var(--transition-normal)",cursor:"pointer",minHeight:"180px",display:"flex",flexDirection:"column",justifyContent:"center"},onClick:()=>document.getElementById("file-input").click()},Bc.createElement("h4",{style:{margin:0,marginBottom:"8px",fontSize:"14px",color:"var(--textPrimary)"}},"Drop file here or click to browse"),Bc.createElement("p",{style:{margin:0,color:"var(--textMuted)",fontSize:"var(--fontSize-sm)"}},"Supports text, HTML, JavaScript, JSON, images, and more"),Bc.createElement("input",{id:"file-input",type:"file",onChange:e=>e.target.files[0]&&Ut(e.target.files[0]),style:{display:"none"}})),!!u&&Bc.createElement("input",{id:"file-input",type:"file",onChange:e=>e.target.files[0]&&Ut(e.target.files[0]),style:{display:"none"}}),!!u&&!!e&&!!t&&(()=>{const n=t.startsWith("image/"),r=t.includes("gltf")||t.includes("model/")||t.includes("glb"),i=e instanceof ArrayBuffer||"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(e);if(r&&i)return Bc.createElement("div",{className:"mt-3"},Bc.createElement("div",{style:{borderRadius:"8px",border:"1px solid rgb(38, 38, 38)",background:"rgba(23, 23, 23, 0.5)",padding:"12px",overflow:"hidden"}},Bc.createElement("p",{style:{fontSize:"10px",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.05em",color:"rgb(115, 115, 115)",marginBottom:"8px",margin:0}},"3D Preview"),Bc.createElement(rN,{content:e,contentType:t,maxHeight:"280px"}),Bc.createElement("p",{style:{fontSize:"11px",color:"rgb(115, 115, 115)",marginTop:"8px",margin:"8px 0 0 0"}},t," \u2014 ",jt>0?`${jt.toLocaleString()} bytes`:"unknown size")));if(n&&i){const n=new Blob([e],{type:t}),r=URL.createObjectURL(n);return XI.has(t)?Bc.createElement("div",{className:"mt-3"},Bc.createElement("div",{className:"rounded-lg border border-neutral-800/60 bg-neutral-900/50 p-3"},Bc.createElement("p",{className:"text-[10px] font-semibold uppercase tracking-wide text-neutral-500 mb-2"},"Preview"),Bc.createElement("img",{src:r,alt:"Upload preview",className:"w-full max-h-64 object-contain rounded",draggable:!1,onLoad:()=>URL.revokeObjectURL(r)}),XI.has(t)&&Bc.createElement("p",{className:"text-[11px] text-neutral-500 mt-2"},"Optimize this image in the Compression step."))):Bc.createElement("div",{className:"mt-3"},Bc.createElement("div",{className:"rounded-lg border border-neutral-800/60 bg-neutral-900/50 p-3"},Bc.createElement("p",{className:"text-[10px] font-semibold uppercase tracking-wide text-neutral-500 mb-2"},"Preview"),Bc.createElement("img",{src:r,alt:"Upload preview",className:"w-full max-h-64 object-contain rounded",draggable:!1,onLoad:()=>URL.revokeObjectURL(r)}),Bc.createElement("p",{className:"text-[11px] text-neutral-500 mt-2"},"Format not compressible in browser \u2014 will be inscribed as-is.")))}return!i&&"string"==typeof e&&e.length>0?Bc.createElement("div",{className:"mt-3 rounded-lg border border-neutral-800/60 bg-neutral-900/50 p-3"},Bc.createElement("p",{className:"text-[10px] font-semibold uppercase tracking-wide text-neutral-500 mb-2"},"Content Preview"),Bc.createElement("div",{className:"bg-neutral-950/50 rounded p-2 font-mono text-xs text-neutral-300 overflow-y-auto whitespace-pre-wrap break-words",style:{width:"100%",maxWidth:"300px",height:"300px",margin:"0 auto"}},e.length>5e3?Bc.createElement(Bc.Fragment,null,e.substring(0,5e3),Bc.createElement("span",{className:"text-neutral-500"},"\\n\\n\u2026 (truncated)")):e)):i?Bc.createElement("div",{className:"mt-3 rounded-lg border border-neutral-800/60 bg-neutral-900/50 p-3"},Bc.createElement("p",{className:"text-[10px] font-semibold uppercase tracking-wide text-neutral-500 mb-2"},"File Info"),Bc.createElement("p",{className:"text-xs text-neutral-400 font-mono"},t," \u2014 ",jt>0?`${jt.toLocaleString()} bytes`:"unknown size")):null})()),"templates"===ht&&f&&Bc.createElement("div",{className:"fade-in"},Bc.createElement("div",{className:"inscription-grid"},Rt.map((e,t)=>Bc.createElement("div",{key:t,className:"inscription-card",onClick:()=>Ht(e),style:{cursor:"pointer",padding:"var(--spacing-lg)"}},Bc.createElement("div",{style:{fontSize:"32px",marginBottom:"var(--spacing-md)",textAlign:"center"}},Mt.find(t=>t.value===e.contentType)?.icon||"\ud83d\udcc4"),Bc.createElement("h5",{style:{margin:0,marginBottom:"var(--spacing-xs)",fontSize:"var(--fontSize-base)",fontWeight:"var(--fontWeight-semibold)",color:"var(--textPrimary)",textAlign:"center"}},e.name),Bc.createElement("p",{style:{margin:0,fontSize:"var(--fontSize-xs)",color:"var(--textMuted)",textAlign:"center"}},e.contentType),Bc.createElement("p",{style:{margin:0,marginTop:"var(--spacing-sm)",fontSize:"var(--fontSize-xs)",color:"var(--textMuted)",textAlign:"center",fontFamily:"var(--fontFamily-mono)"}},e.content.length," bytes"))))),"bitmap"===ht&&Bc.createElement("div",{className:"fade-in",style:{height:"100%"}},Bc.createElement(qI,{selectedParents:P,walletInscriptions:x,loadingInscriptions:w,onParentSelect:dt,onMobilePanelChange:pt,onContentChange:r,onContentTypeChange:i,onBatchCreate:e=>{e.forEach(e=>{const t={content:e.content,contentType:e.contentType,contentSize:e.content.length,selectedParents:e.parent?[{id:e.parent}]:[],reinscriptionTarget:null,delegateId:"",metaprotocol:"",metadata:e.metadata||"",properties:"",contentEncoding:"",pointer:"",recipientAddress:e.destinationAddress||"",destinationAddress:e.destinationAddress||"",postage:e.postage||546,features:e.parent?["\ud83d\udc68\u200d\ud83d\udc67 Parent-Child","\ud83d\uddfa Bitmap Parcel"]:["\ud83d\uddfa Bitmap Parcel"]};j(t)}),bt("review"),pt?.("review")},disabled:G})),"oodl"===ht&&Bc.createElement("div",{className:"fade-in",style:{height:"100%",overflow:"auto",padding:0}},Bc.createElement($I,{onOodlLayoutChange:at,feeRate:m,onFeeRateChange:g,walletInscriptions:x,walletAssetScanState:T,onRequestWalletRescan:C,selectedInscription:Y,selectedParents:P,selectedParentsCount:Array.isArray(P)?P.length:0,selectedParentIds:(Array.isArray(P)?P:[]).map(e=>e&&(e.id||e.inscriptionId||e.inscription_id)).map(e=>String(e||"").trim()).filter(Boolean),priceSats:J,onPriceSatsChange:Q,listingScriptAddress:Z,onListingScriptAddressChange:ee,markerValueSats:te,onMarkerValueSatsChange:ne,dryRun:re,onDryRunChange:ie,saleMinBlockHeight:De,onSaleMinBlockHeightChange:He,onCreateListingTx:ae,onCreateBulkListingTx:oe,createDisabled:se,multiListingDisabled:le,sellerStatus:ce,sellerError:ue,bulkSellerStatus:de,bulkSellerError:pe,bulkBundleJson:fe,onCreateMultiListingTx:me,multiSellerStatus:ge,multiSellerError:he,multiListingResult:be,multiAssetPricing:ye,onMultiAssetPriceChange:xe,onMultiUniformPriceChange:we,collectionAuthoritySlots:ve,collectionAuthorityStatus:Se,collectionAuthorityError:Ee,collectionAuthoritySlotId:Ne,onCollectionAuthoritySlotIdChange:Ie,onLaunchCollection:Ae,onLaunchParcelManifest:ke,previousManifest:Te,previousManifestStatus:Ce,previousManifestError:Be,onLoadPreviousManifest:Pe,revealTxid:_e,onRevealTxidChange:Oe,onBuy:Le,buyDisabled:Fe,fundingNeeded:Me,onCreateFundingTx:Re,fundingDisabled:$e,fundingStatus:Ue,fundingError:ze,buyStatus:We,buyError:je,manualSellerPsbt:Ve,manualSellerStatus:qe,manualSellerError:Xe,onCreateManualSellerOfferPsbt:Ke,manualBuyStatus:Ge,manualBuyError:Ye,onBuyFromSellerOfferPsbt:Je,manualBuyerFundedPsbt:Qe,manualBuyerFundedStatus:Ze,manualBuyerFundedError:et,onCreateBuyerFundedPsbtForSeller:tt,manualSellerCountersignStatus:nt,manualSellerCountersignError:rt,onCountersignAndBroadcastFromBuyerFundedPsbt:it,oodlSection:ot,onOodlSectionChange:st,isConnected:!!y?.isConnected,onConnect:ut})),"review"===ht&&Bc.createElement("div",{className:"fade-in",style:{height:"100%"}},Bc.createElement(sN,{content:e,contentType:t,contentSize:jt,feeEstimate:h,contentEncoding:U,compressBeforeInscribe:o,onCompressBeforeInscribeChange:s,isDraftCompressing:l,draftCompressedSize:c,fileName:u,selectedParents:P,reinscriptionTarget:_,delegateId:O,metaprotocol:L,metadata:F,properties:M,pointer:$,recipientAddress:z,repeatCount:D,onRepeatCountChange:H,batchItems:W,onAddToBatch:j,onRemoveFromBatch:V,onDuplicateBatchItem:q,onEditBatchItem:X,inscriptionMode:K}))))))}function rA({content:e,contentType:t,onContentChange:n,onContentTypeChange:r,onContentEncodingChange:i,compressBeforeInscribe:a=!1,onCompressBeforeInscribeChange:o,isDraftCompressing:s=!1,draftCompressedSize:l=null,fileName:c,onFileNameChange:u,onImportJson:d,contentSize:p,feeRate:f,onFeeRateChange:m,feeEstimate:g,walletAddress:h,walletState:b,selectedUtxos:y,onUtxosChange:x,onUtxoSelect:w,walletInscriptions:v,loadingInscriptions:S=!1,onFeesLoaded:E,onFilteredUtxosLoaded:N,utxoRescanRequestId:I=0,onUtxoScanStateChange:A,walletAssetScanState:k=null,onRequestWalletRescan:T,inscribing:C,selectedParents:B,reinscriptionTarget:P,delegateId:_,metaprotocol:O,metadata:L,properties:F,pointer:M,contentEncoding:R,recipientAddress:$,repeatCount:U,onRepeatCountChange:z,batchItems:D,onAddToBatch:H,onRemoveFromBatch:W,onDuplicateBatchItem:j,onEditBatchItem:V,inscriptionMode:q,selectedSaleInscription:X,salePriceSats:K,onSalePriceSatsChange:G,listingScriptAddress:Y,onListingScriptAddressChange:J,markerValueSats:Q,onMarkerValueSatsChange:Z,listingDryRun:ee,onListingDryRunChange:te,saleMinBlockHeight:ne,onSaleMinBlockHeightChange:re,onCreateListingTx:ie,onCreateBulkListingTx:ae,createListingDisabled:oe,sellerStatus:se,sellerError:le,bulkSellerStatus:ce,bulkSellerError:ue,bulkBundleJson:de,onCreateMultiListingTx:pe,multiSellerStatus:fe,multiSellerError:me,multiListingResult:ge,multiListingDisabled:he,multiAssetPricing:be,onMultiAssetPriceChange:ye,onMultiUniformPriceChange:xe,collectionAuthoritySlots:we,collectionAuthorityStatus:ve,collectionAuthorityError:Se,collectionAuthoritySlotId:Ee,onCollectionAuthoritySlotIdChange:Ne,onLaunchCollection:Ie,onLaunchParcelManifest:Ae,previousManifest:ke,previousManifestStatus:Te,previousManifestError:Ce,onLoadPreviousManifest:Be,buyRevealTxid:Pe,onBuyRevealTxidChange:_e,onBuyFromRevealTx:Oe,buyDisabled:Le,buyFundingNeeded:Fe,onCreateBuyFundingTx:Me,buyFundingDisabled:Re,buyFundingStatus:$e,buyFundingError:Ue,buyStatus:ze,buyError:De,manualSellerPsbt:He,manualSellerStatus:We,manualSellerError:je,onCreateManualSellerOfferPsbt:Ve,manualBuyStatus:qe,manualBuyError:Xe,onBuyFromSellerOfferPsbt:Ke,manualBuyerFundedPsbt:Ge,manualBuyerFundedStatus:Ye,manualBuyerFundedError:Je,onCreateBuyerFundedPsbtForSeller:Qe,manualSellerCountersignStatus:Ze,manualSellerCountersignError:et,onCountersignAndBroadcastFromBuyerFundedPsbt:tt,tabRequest:nt=null,onActiveTabChange:rt,onOodlLayoutChange:it,oodlSection:at,onOodlSectionChange:ot,onConnect:st,onParentSelect:lt,onMobilePanelChange:ct,guidedFlowEnabled:ut=!1,guidedFlowStep:dt="content",onContinueToAdvancedOptions:pt}){return Pc.createElement("div",{className:"h-full min-h-0"},Pc.createElement(nA,{content:e,contentType:t,onContentChange:n,onContentTypeChange:r,onContentEncodingChange:i,compressBeforeInscribe:a,onCompressBeforeInscribeChange:o,isDraftCompressing:s,draftCompressedSize:l,fileName:c,onFileNameChange:u,onImportJson:d,contentSize:p,feeRate:f,onFeeRateChange:m,feeEstimate:g,walletAddress:h,walletState:b,selectedUtxos:y,onUtxosChange:x,onUtxoSelect:w,walletInscriptions:v,loadingInscriptions:S,onFeesLoaded:E,onFilteredUtxosLoaded:N,utxoRescanRequestId:I,onUtxoScanStateChange:A,walletAssetScanState:k,onRequestWalletRescan:T,inscribing:C,selectedParents:B,reinscriptionTarget:P,delegateId:_,metaprotocol:O,metadata:L,properties:F,pointer:M,contentEncoding:R,recipientAddress:$,repeatCount:U,onRepeatCountChange:z,batchItems:D,onAddToBatch:H,onRemoveFromBatch:W,onDuplicateBatchItem:j,onEditBatchItem:V,inscriptionMode:q,selectedSaleInscription:X,salePriceSats:K,onSalePriceSatsChange:G,listingScriptAddress:Y,onListingScriptAddressChange:J,markerValueSats:Q,onMarkerValueSatsChange:Z,listingDryRun:ee,onListingDryRunChange:te,saleMinBlockHeight:ne,onSaleMinBlockHeightChange:re,onCreateListingTx:ie,onCreateBulkListingTx:ae,createListingDisabled:oe,sellerStatus:se,sellerError:le,bulkSellerStatus:ce,bulkSellerError:ue,bulkBundleJson:de,onCreateMultiListingTx:pe,multiSellerStatus:fe,multiSellerError:me,multiListingResult:ge,multiListingDisabled:he,multiAssetPricing:be,onMultiAssetPriceChange:ye,onMultiUniformPriceChange:xe,collectionAuthoritySlots:we,collectionAuthorityStatus:ve,collectionAuthorityError:Se,collectionAuthoritySlotId:Ee,onCollectionAuthoritySlotIdChange:Ne,onLaunchCollection:Ie,onLaunchParcelManifest:Ae,previousManifest:ke,previousManifestStatus:Te,previousManifestError:Ce,onLoadPreviousManifest:Be,buyRevealTxid:Pe,onBuyRevealTxidChange:_e,onBuyFromRevealTx:Oe,buyDisabled:Le,buyFundingNeeded:Fe,onCreateBuyFundingTx:Me,buyFundingDisabled:Re,buyFundingStatus:$e,buyFundingError:Ue,buyStatus:ze,buyError:De,manualSellerPsbt:He,manualSellerStatus:We,manualSellerError:je,onCreateManualSellerOfferPsbt:Ve,manualBuyStatus:qe,manualBuyError:Xe,onBuyFromSellerOfferPsbt:Ke,manualBuyerFundedPsbt:Ge,manualBuyerFundedStatus:Ye,manualBuyerFundedError:Je,onCreateBuyerFundedPsbtForSeller:Qe,manualSellerCountersignStatus:Ze,manualSellerCountersignError:et,onCountersignAndBroadcastFromBuyerFundedPsbt:tt,tabRequest:nt,oodlSection:at,onOodlSectionChange:ot,onActiveTabChange:rt,onOodlLayoutChange:it,onConnect:st,onParentSelect:lt,onMobilePanelChange:ct,guidedFlowEnabled:ut,guidedFlowStep:dt,onContinueToAdvancedOptions:pt}))}async function iA(e){try{const n=zt();for(const i of[`/r/inscription/${e}`,`/r/inscriptions/${e}`])try{const e=kt(i),t=await fetch(e);if(t.ok)return aA(await t.json())}catch(t){}if(!n&&window.NexusBitcoinProxy&&window.NexusBitcoinProxy.isEnabled()){const t=window.NexusBitcoinProxy.getUrl(),n=window.open(`${t}?action=fetch&url=${encodeURIComponent(kt(`/r/inscription/${e}`))}`,"_blank","width=1,height=1,left=-1000,top=-1000"),r=`nexus_proxy_inscription_${Date.now()}`;return new Promise((e,t)=>{const i=setTimeout(()=>{n&&n.close(),t(new Error("Timeout fetching inscription data"))},15e3),a=setInterval(()=>{const o=localStorage.getItem(r);if(o){clearInterval(a),clearTimeout(i),n&&n.close();try{const n=JSON.parse(o);localStorage.removeItem(r),n.error?t(new Error(n.error)):e(aA(n))}catch(_k){t(new Error("Failed to parse inscription data"))}}},100);localStorage.setItem(`${r}_request`,"pending")})}const r=await fetch(kt(`/inscription/${e}`));if(!r.ok)throw new Error(`Failed to fetch inscription: ${r.statusText}`);return function(e){const t={},n=e.match(/inscription\/([a-f0-9]{64}i\d+)/);n&&(t.id=n[1]);const r=e.match(/Inscription (\d+)/);r&&(t.number=parseInt(r[1]));const i=e.match(/content type<\/dt>\s*<dd[^>]*>([^<]+)/i);i&&(t.content_type=i[1].trim());const a=e.match(/content length<\/dt>\s*<dd[^>]*>(\d+)/i);a&&(t.content_length=parseInt(a[1]));const o=e.match(/genesis height<\/dt>\s*<dd[^>]*>(\d+)/i);o&&(t.genesis_height=parseInt(o[1]));const s=e.match(/output<\/dt>\s*<dd[^>]*>([a-f0-9]{64}:\d+)/i);s&&(t.satpoint=s[1]);const l=e.match(/address<\/dt>\s*<dd[^>]*>([a-zA-Z0-9]+)/i);return l&&(t.address=l[1]),t}(await r.text())}catch(tn){throw tn}}function aA(e){return{id:e.id,number:e.number,content_type:e.content_type,content_length:e.content_length,satpoint:e.satpoint,output:e.output,address:e.address,sat:e.sat,genesis_height:e.genesis_height,genesis_fee:e.genesis_fee,height:e.height,fee:e.fee,timestamp:e.timestamp,delegate:e.delegate,charms:e.charms,output_value:e.output_value,value:e.value,...Object.keys(e).reduce((t,n)=>(["id","number","content_type","content_length","satpoint","output","address","sat","genesis_height","genesis_fee","height","fee","timestamp","delegate","charms","output_value","value"].includes(n)||(t[n]=e[n]),t),{})}}async function oA(e){if(!e||!e.id)throw new Error("Invalid inscription object");if((e.content_type||e.contentType)&&e.satpoint)return e;try{const t=await iA(e.id);return{...t,...e,sat:e.sat||t.sat}}catch(tn){return e}}const sA=Object.freeze(Object.defineProperty({__proto__:null,enrichInscriptionData:oA,enrichInscriptions:async function(e,t){if(!e||0===e.length)return[];const n=[];for(let r=0;r<e.length;r++){const i=e[r];t&&t({current:r+1,total:e.length,percentage:Math.round((r+1)/e.length*100)});try{const t=!(i.content_type||i.contentType)||!i.satpoint,a=await oA(i);n.push(a),t&&r<e.length-1&&await new Promise(e=>setTimeout(e,200))}catch(tn){n.push(i)}}return n},fetchInscriptionDetails:iA},Symbol.toStringTag,{value:"Module"}));function lA(e,t){if(!e)return null;if(e.renderType)return e;const n=e.contentType||"",r=e.data,i=function(e,t){const n=String(e||"").toLowerCase();return n.startsWith("image/")?"image":n.startsWith("text/html")?"iframe":n.startsWith("text/")||n.includes("json")||n.includes("javascript")?"text":"string"==typeof t&&t.startsWith("blob:")?"image":"string"==typeof t&&(t.startsWith("http")||t.startsWith("/"))?"iframe":"text"}(n,r);return{content:"iframe"===i?t:r,renderType:i,contentType:n}}function cA({inscriptions:e,selectedIds:t,onSelect:n,visible:r=!0,disabledIds:i=[],emphasizeSelected:a=!0,sortByNumber:o=!0,selectedFirst:s=!0,disabledLabelLookup:l=null,enableDragSelect:c=!1,onDoubleClick:u=null}){const[d,p]=Bc.useState({}),f=Bc.useRef({}),m=Bc.useRef(null),g=Bc.useRef({}),h=Bc.useRef({active:!1,mode:"add",visited:new Set,didDrag:!1});Bc.useEffect(()=>{f.current=d||{}},[d]);const b=Bc.useMemo(()=>Array.isArray(e)&&0!==e.length?e.map(e=>e&&(e.id||e.inscriptionId||e.inscription_id)?String(e.id||e.inscriptionId||e.inscription_id):"").filter(Boolean).join("|"):"",[e]);Bc.useEffect(()=>{if(!b)return;const e=b.split("|").filter(Boolean);if(0===e.length)return;let t=!1;const n=new Set(e);return p(e=>{const t=e&&"object"==typeof e?e:{},r=Object.keys(t);if(0===r.length)return e;let i=!1;const a={};for(const o of r)n.has(o)?a[o]=t[o]:i=!0;return i?a:e}),p(t=>{let n=!1;const r={...t&&"object"==typeof t?t:{}};for(const i of e){if(r[i])continue;const e=hN.get(i);e&&(r[i]=lA(e,i),n=!0)}return n?r:t}),(async()=>{const n=f.current||{},r=e.filter(e=>!n[e]&&!hN.has(e));if(0===r.length)return;const i=r.slice(0,20),a=async e=>{const n={};await Promise.all(e.map(async e=>{try{const t=await async function(e){if(hN.has(e))return lA(hN.get(e),e);try{const t=await fetch(kt(`/content/${e}`)),n=t.headers.get("content-type")||"",r=await t.arrayBuffer(),i=String(n||"").toLowerCase(),a=function(e){try{const t=new Uint8Array(e||[]);if(t.length>=8){if(137===t[0]&&80===t[1]&&78===t[2]&&71===t[3]&&13===t[4]&&10===t[5]&&26===t[6]&&10===t[7])return"image/png";if(71===t[0]&&73===t[1]&&70===t[2]&&56===t[3])return"image/gif";if(255===t[0]&&216===t[1]&&255===t[2])return"image/jpeg";if(82===t[0]&&73===t[1]&&70===t[2]&&70===t[3]&&87===t[8]&&69===t[9]&&66===t[10]&&80===t[11])return"image/webp"}if(t.length>=12&&102===t[4]&&116===t[5]&&121===t[6]&&112===t[7]){const e=Math.min((t[0]<<24|t[1]<<16|t[2]<<8|t[3])>>>0,t.length),n=new Set;for(let r=8;r+3<e;r+=4)12!==r&&n.add(String.fromCharCode(t[r],t[r+1],t[r+2],t[r+3]));if(n.has("avif")||n.has("avis"))return"image/avif";if(n.has("heic")||n.has("heix")||n.has("hevc")||n.has("hevx"))return"image/heic"}if(t.length>=16)try{const e=new TextDecoder("utf-8",{fatal:!1}).decode(t.slice(0,2048)),n=String(e||"").replace(/^\uFEFF/,"").trimStart().toLowerCase();if(n.startsWith("<svg")||n.startsWith("<?xml")&&n.includes("<svg")||n.includes("<svg"))return"image/svg+xml"}catch{}}catch{}return""}(r),o=a||n;let s;if(i.includes("image/")||a){const e=new Blob([r],{type:o||void 0});s=URL.createObjectURL(e)}else if(i.includes("text/")||i.includes("json")||i.includes("javascript"))try{s=new TextDecoder("utf-8",{fatal:!1}).decode(r)}catch{s=""}else s=kt(`/content/${e}`);const l={contentType:o,data:s,timestamp:Date.now()};return hN.set(e,l),lA(l,e)}catch(_k){return{content:e,renderType:"iframe",contentType:"unknown"}}}(e);n[e]=t}catch(t){}})),t||p(e=>({...e||{},...n}))};await a(i);const o=r.slice(20);for(let e=0;e<o.length;e+=10){if(t)return;await a(o.slice(e,e+10))}})(),()=>{t=!0}},[b]);let y=[];Array.isArray(t)?y=t.filter(Boolean):t&&"string"==typeof t&&(y=t.split(",").filter(Boolean));const x=new Set(y),w=new Set(i.filter(Boolean)),v=Bc.useRef(x),S=Bc.useRef(w);Bc.useEffect(()=>{v.current=x},[t]),Bc.useEffect(()=>{S.current=w},[i]);const E=Bc.useCallback(()=>{h.current.active=!1,h.current.visited=new Set},[]);Bc.useEffect(()=>{if(!c)return;const e=()=>E();return window.addEventListener("pointerup",e),window.addEventListener("pointercancel",e),()=>{window.removeEventListener("pointerup",e),window.removeEventListener("pointercancel",e)}},[c,E]),y.length;const N=e=>{const t=e.number||e.inscriptionNumber||e.inscription_number;if("number"==typeof t)return t;const n=e.id||e.inscriptionId||e.inscription_id||"",r=/i(\d+)$/.exec(n);return r?parseInt(r[1],10):Number.MAX_SAFE_INTEGER},I=o?(e||[]).slice().sort((e,t)=>{const n=e.id||e.inscriptionId||e.inscription_id||"",r=t.id||t.inscriptionId||t.inscription_id||"";if(s){const e=x.has(n);if(e!==x.has(r))return e?-1:1}const i=N(e),a=N(t);return i!==a?i-a:n.localeCompare(r)}):(e||[]).slice();return I&&0!==I.length?Bc.createElement("div",{ref:m,style:{display:r?"grid":"none",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:"12px",padding:"8px",width:"100%",minWidth:0,boxSizing:"border-box"}},I.map(e=>{const t=e.id||e.inscriptionId||e.inscription_id||"",r=x.has(t),i=w.has(t),o=e.number||e.inscriptionNumber||e.inscription_number||(e.id?`${e.id.substring(0,8)}`:"?"),p=lA(d[t],t);return Bc.createElement("div",{key:t||Math.random(),ref:e=>{t&&(g.current[t]=e)},"data-insc-id":t,onPointerDown:r=>{if(!c)return;if(0!==r.button)return;if(!t)return;if(S.current.has(t))return;h.current.didDrag=!1;const i=v.current.has(t);h.current.active=!0,h.current.mode=i?"remove":"add",h.current.visited=new Set([t]),h.current.didDrag=!0,n(e);try{r.currentTarget.setPointerCapture?.(r.pointerId)}catch{}r.preventDefault()},onPointerEnter:()=>{if(!c)return;if(!h.current.active)return;if(!t)return;if(S.current.has(t))return;if(h.current.visited.has(t))return;h.current.visited.add(t),h.current.didDrag=!0;const r=v.current.has(t),i=h.current.mode;"add"!==i||r||n(e),"remove"===i&&r&&n(e)},onClick:()=>{if(!i&&(!c||!h.current.active&&!h.current.didDrag)&&(n(e),s))try{const e=g.current[t];e&&e.scrollIntoView&&setTimeout(()=>{e.scrollIntoView({behavior:"smooth",block:"start"})},80)}catch{}},onDoubleClick:()=>{i||"function"==typeof u&&u(e)},style:{minWidth:0,maxWidth:"100%",boxSizing:"border-box",background:i?"rgba(120,120,120,0.12)":r?"rgba(168, 85, 247, 0.18)":"var(--bgSecondary)",border:"2px solid "+(i?"rgba(120,120,120,0.5)":r?"var(--accentPurple)":"var(--borderMedium)"),borderRadius:"8px",padding:a&&!i&&r?"10px":"8px",cursor:i?"not-allowed":"pointer",opacity:i?.6:1,transition:"all 0.15s ease",position:"relative"}},Bc.createElement("div",{style:{width:"100%",height:"100px",borderRadius:"4px",overflow:"hidden",background:"#1a1a1a",position:"relative",marginBottom:"6px",pointerEvents:"none"}},p?"image"===p.renderType?Bc.createElement("img",{src:p.content,alt:`#${o}`,style:{width:"100%",height:"100%",objectFit:"contain",objectPosition:"center"}}):"text"===p.renderType?Bc.createElement("div",{style:{width:"100%",height:"100%",padding:"4px",fontSize:"8px",fontFamily:"monospace",color:"#ccc",overflow:"hidden",textOverflow:"ellipsis",lineHeight:"1.2",whiteSpace:"pre-wrap",wordBreak:"break-all"}},p.content.substring(0,500)):Bc.createElement("iframe",{src:kt(`/content/${p.content}`),style:{width:"100%",height:"100%",border:"none"},sandbox:"allow-scripts",loading:"lazy"}):Bc.createElement("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",color:"#666",fontSize:"24px"}},"\u23f3")),Bc.createElement("div",{style:{fontSize:"13px",fontWeight:600,color:"var(--accentPurple)",marginBottom:"3px"}},"#",o),Bc.createElement("div",{style:{fontSize:"9px",color:"var(--textMuted)",fontFamily:"monospace",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},t?.substring(0,16),"..."),r&&!i&&Bc.createElement("div",{style:{position:"absolute",top:"6px",right:"6px",background:"var(--accentPurple)",borderRadius:"50%",width:"22px",height:"22px",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"12px",fontWeight:"bold",boxShadow:"0 2px 6px rgba(0,0,0,0.3)",zIndex:10}},"\u2713"),i&&Bc.createElement("div",{style:{position:"absolute",top:"6px",left:"6px",background:"var(--accentPurple)",padding:"2px 6px",borderRadius:"999px",fontSize:"10px",fontWeight:600,color:"white",letterSpacing:"0.4px",border:"1px solid rgba(251, 146, 60, 0.1)"}},l&&l[t]?l[t]:"USED IN BATCH"))})):Bc.createElement("div",{style:{padding:"40px",textAlign:"center",color:"var(--textMuted)",display:r?"block":"none"}},"No inscriptions found")}function uA({guidedFlowEnabled:e=!1,guidedFlowStep:t="content",delegateId:n="",metaprotocol:r="",metadata:i="",properties:a="",pointer:o="",reinscriptionTarget:s="",recipientAddress:l="",selectedParents:c=[],inscriptionMode:u="standard",onDelegateChange:d,onMetaprotocolChange:p,onMetadataChange:f,onPropertiesChange:m,onPointerChange:g,onReinscriptionTargetChange:h,onRecipientAddressChange:b,onParentSelect:y,walletInscriptions:x=[],loadingInscriptions:w=!1,ordinalsAddress:v="",existingReinscriptionTargets:S=[],existingParentIds:E=[],batchResetSignal:N=0,onResetSelections:I,limitParentSelection:A=!1,showOnlyParents:k=!1,parentsLabel:T="Parents",content:C=null,contentType:B="",contentSize:P=0,contentEncoding:_="",fileName:O="",compressBeforeInscribe:L=!1,onCompressBeforeInscribeChange:F,isDraftCompressing:M=!1,draftCompressedSize:R=null,repeatCount:$=1,onRepeatCountChange:U,batchItems:z=[],onAddToBatch:D,onInscriptionSelected:H=null}){Bc.useEffect(()=>{try{s&&Array.isArray(S)&&S.includes(s)&&"function"==typeof h&&h("")}catch(e){}},[s,S]),Bc.useEffect(()=>{N>0&&("function"==typeof I&&I(),d&&d(""),h&&h(""),Y(""),Q(""),ee(""),ne(""))},[N]);const[W,j]=Bc.useState("parents"),[V,q]=Bc.useState(""),[X,K]=Bc.useState("gallery"),[G,Y]=Bc.useState(""),[J,Q]=Bc.useState(""),[Z,ee]=Bc.useState(""),[te,ne]=Bc.useState("");Bc.useEffect(()=>{if(a)try{const e=JSON.parse(a),t=e?.[1]?.[0]||"",n=e?.[0]||[],r=Array.isArray(n)?n.join("\n"):"";Y(t),Q(r),ne(t)}catch(Pk){}else Y(""),Q(""),ee(""),ne("")},[a]);const re=e=>{if(null==e)return"";let t=String(e).trim();if(t=t.replace(/[\u200B-\u200D\uFEFF]/g,""),t=t.replace(/^["'\s]+|["'\s]+$/g,""),t=t.replace(/\s+/g,""),t=t.split("#")[0],t=t.split("?")[0],t.includes("/")){const e=t.split("/").filter(Boolean);t=e[e.length-1]||t}return t.includes(":")&&(t=t.split(":")[0]),t=t.replace(/\(i\)/gi,"i"),/^[a-f0-9]{64}$/i.test(t)&&(t+="i0"),t},ie=Bc.useMemo(()=>{const e=new Map;return(x||[]).forEach(t=>{const n=t?.id||t?.inscriptionId||t?.inscription_id;n&&e.set(n,t)}),e},[x]),ae=e=>e?/^[a-f0-9]{64}[i\(i\)]?\d+$/i.test(e.replace(/[\(\)]/g,""))?{valid:!0,message:"\u2713 Valid"}:{valid:!1,message:"\u26a0\ufe0f Invalid format"}:{valid:!0,message:""},oe=e=>{if(!e||""===e.trim())return{valid:!0,message:""};try{return JSON.parse(e),{valid:!0,message:"\u2713 Valid JSON"}}catch(tn){return{valid:!1,message:`\u26a0\ufe0f Invalid JSON: ${tn.message}`}}};ae(n),ae(s);const se=oe(i),le=oe(a),ce=(e=>{if(!e||""===e)return{valid:!0,message:""};const t=parseInt(e,10);return isNaN(t)||t<0?{valid:!1,message:"\u26a0\ufe0f Must be a non-negative integer"}:{valid:!0,message:"\u2713 Valid pointer value"}})(o);Bc.useCallback(e=>{const t=Number(e);return!Number.isFinite(t)||t<0?null:t<1024?`${Math.round(t).toLocaleString()} B`:t<1048576?`${(t/1024).toFixed(1)} KB`:t<1073741824?`${(t/1048576).toFixed(2)} MB`:`${(t/1073741824).toFixed(2)} GB`},[]);const ue=Bc.useMemo(()=>{if(!Array.isArray(S))return null;const e={};return S.forEach((t,n)=>{t&&(e[t]||(e[t]=`USED IN BATCH #${n+1}`))}),e},[S]),de=Bc.useMemo(()=>{if(!Array.isArray(x)||0===x.length)return null;const e=new Map,t=new Map;for(const o of x){const n=o.id||o.inscriptionId||o.inscription_id;if(!n)continue;t.set(n,o);let r=null;if(o.output)r=o.output;else if(o.satpoint){const e=String(o.satpoint).split(":");e.length>=2&&(r=`${e[0]}:${e[1]}`)}else o.utxo&&o.utxo.txid&&void 0!==o.utxo.vout&&(r=`${o.utxo.txid}:${o.utxo.vout}`);r&&(e.has(r)||e.set(r,[]),e.get(r).push(o))}const n=[],r=Array.from(e.entries()).filter(([e,t])=>t.length>1);r.forEach(([e,t])=>{const r=t.slice().sort((e,t)=>{const n=void 0!==e.offset?e.offset:(()=>{const t=(e.satpoint||"").split(":");return t.length>=3?parseInt(t[2],10):-1})();return(void 0!==t.offset?t.offset:(()=>{const e=(t.satpoint||"").split(":");return e.length>=3?parseInt(e[2],10):-1})())-n}),i=new Map;r.forEach(e=>{const t=e.sat;null!=t&&(i.has(t)||i.set(t,[]),i.get(t).push(e))});const a=Array.from(i.entries()).filter(([e,t])=>t.length>1).map(([e,t])=>({type:"same-sat",sat:Number(e),inscriptions:t}));n.push({type:"utxo",key:`utxo:${e}`,utxo:e,inscriptions:r,subGroups:a.length>0?a:null})});const i=new Set;n.forEach(e=>{e.inscriptions.forEach(e=>{const t=e.id||e.inscriptionId||e.inscription_id;t&&i.add(t)})});const a=new Map;for(const o of x){const e=o.id||o.inscriptionId||o.inscription_id;if(e&&!i.has(e)&&o.sameSatIds&&Array.isArray(o.sameSatIds)&&o.sameSatIds.length>1){const e=o.sat;null!=e&&(a.has(e)||a.set(e,new Set),o.sameSatIds.forEach(t=>a.get(e).add(t)))}}for(const[o,s]of a.entries()){const e=Array.from(s);if(e.length<=1)continue;let r=e;for(const t of x)if(t.sameSatIds&&Array.isArray(t.sameSatIds)&&t.sat===o){r=[...t.sameSatIds].reverse();break}r===e&&(r=[...e].reverse());const a=r.map(e=>t.get(e)||{id:e,sat:Number(o),satpoint:null,output:null,number:void 0,contentType:null,fromSatScan:!0}).filter(e=>{const t=e.id||e.inscriptionId||e.inscription_id;return t&&!i.has(t)});a.length>1&&n.push({type:"same-sat",key:`sat:${o}`,sat:Number(o),inscriptions:a,subGroups:null})}return 0===n.length?null:{groups:n}},[x]),pe=Bc.useMemo(()=>{const e=new Map;(x||[]).forEach(t=>{const n=t.id||t.inscriptionId||t.inscription_id;n&&e.set(n,t)}),de&&Array.isArray(de.groups)&&de.groups.forEach(t=>{t.inscriptions.forEach(t=>{const n=t.id||t.inscriptionId||t.inscription_id;n&&!e.has(n)&&e.set(n,t)})});const t=Array.from(e.values());if(!V.trim())return t;const n=V.toLowerCase();return t.filter(e=>{const t=(e.id||e.inscriptionId||e.inscription_id||"").toLowerCase(),r=String(e.number||e.inscriptionNumber||e.inscription_number||"");if(t.includes(n)||r.includes(n))return!0;const i=lA(hN.get(e.id),e.id);return!(!i||"text"!==i.renderType)&&i.content.toLowerCase().includes(n)})},[V,x,de]),fe=({selectedId:e,onSelect:t,title:n,description:r,disableIds:i=[],disabledLabelLookup:a=null,filterGroupedInscriptions:o=!1,allowManualEntry:s=!1,manualEntryLabel:l="Manual inscription ID",manualEntryPlaceholder:c="64-hex txid + i + index (e.g. <txid>i0)",manualEntryHint:u="You can reference an inscription you do not own."})=>{const[d,p]=Bc.useState(""),[f,m]=Bc.useState("");Bc.useEffect(()=>{if(!s)return;const t=String(e||"").split(",")[0];m(t)},[s,e]);const g=String(f||"").trim(),h=!g||/^[0-9a-fA-F]{64}i\d+(?::.*)?$/.test(g),b=()=>{t&&t(g)},y=Bc.useMemo(()=>{const e=new Map;(x||[]).forEach(t=>{const n=t.id||t.inscriptionId||t.inscription_id;n&&e.set(n,t)}),de&&Array.isArray(de.groups)&&de.groups.forEach(t=>{t.inscriptions.forEach(t=>{const n=t.id||t.inscriptionId||t.inscription_id;n&&!e.has(n)&&e.set(n,t)})});let t=Array.from(e.values());if(o&&de&&de.groups){const e=new Set;de.groups.forEach(t=>{t.inscriptions.forEach(t=>{const n=t.id||t.inscriptionId||t.inscription_id;n&&e.add(n)})}),t=t.filter(t=>{const n=t.id||t.inscriptionId||t.inscription_id;return n&&!e.has(n)})}if(!d.trim())return t;const n=d.toLowerCase();return t.filter(e=>{const t=(e.id||e.inscriptionId||e.inscription_id||"").toLowerCase(),r=String(e.number||e.inscriptionNumber||e.inscription_number||"");if(t.includes(n)||r.includes(n))return!0;const i=lA(hN.get(e.id),e.id);return!(!i||"text"!==i.renderType)&&i.content.toLowerCase().includes(n)})},[d,x,de,o]),v=e=>{const t=e.number||e.inscriptionNumber||e.inscription_number;if("number"==typeof t)return t;const n=e.id||e.inscriptionId||e.inscription_id||"",r=/i(\d+)$/.exec(n);return r?parseInt(r[1],10):Number.MAX_SAFE_INTEGER},S=e?e.split(",").filter(Boolean):[],E=new Set(S),N=y.slice().sort((e,t)=>{const n=e.id||e.inscriptionId||e.inscription_id||"",r=t.id||t.inscriptionId||t.inscription_id||"",i=E.has(n),a=E.has(r);if(!o&&i!==a)return i?-1:1;const s=v(e),l=v(t);return s!==l?s-l:n.localeCompare(r)}),I=new Set(i);return Bc.createElement("div",null,Bc.createElement("label",{className:"form-label",style:{fontSize:"12px",marginBottom:"6px"}},n),s&&Bc.createElement("div",{style:{marginBottom:"10px",padding:"8px",borderRadius:"6px",background:"rgba(0,0,0,0.25)",border:"1px solid rgba(34, 211, 238, 0.35)"}},Bc.createElement("div",{style:{fontSize:"11px",fontWeight:600,color:"rgb(34, 211, 238)",marginBottom:"6px"}},l),Bc.createElement("div",{style:{display:"flex",gap:"8px",alignItems:"center"}},Bc.createElement("input",{type:"text",value:f,placeholder:c,onChange:e=>m(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),b())},style:{width:"100%",padding:"6px 8px",fontSize:"11px",background:"var(--bgSecondary)",border:"1px solid var(--borderMedium)",borderRadius:"4px",color:"var(--textPrimary)",fontFamily:"var(--fontFamily-mono)"}}),Bc.createElement("button",{type:"button",onClick:b,disabled:!g,style:{padding:"6px 10px",fontSize:"11px",borderRadius:"6px",border:"1px solid rgba(34, 211, 238, 0.45)",background:g?"rgba(34, 211, 238, 0.12)":"rgba(255,255,255,0.04)",color:g?"rgb(34, 211, 238)":"var(--textMuted)",cursor:g?"pointer":"not-allowed",whiteSpace:"nowrap"}},"Use"),Bc.createElement("button",{type:"button",onClick:()=>t&&t(""),disabled:!String(e||"").trim(),style:{padding:"6px 10px",fontSize:"11px",borderRadius:"6px",border:"1px solid rgba(255,255,255,0.12)",background:"rgba(255,255,255,0.04)",color:String(e||"").trim()?"var(--textPrimary)":"var(--textMuted)",cursor:String(e||"").trim()?"pointer":"not-allowed",whiteSpace:"nowrap"}},"Clear")),Bc.createElement("div",{style:{marginTop:"6px",fontSize:"10px",color:h?"var(--textMuted)":"rgba(251, 113, 133, 0.95)",lineHeight:"1.35"}},h?u:"Expected format like <txid>i0 (64 hex + i + index).")),x.length>0&&Bc.createElement("div",{style:{marginBottom:"8px"}},Bc.createElement("input",{type:"text",placeholder:"\ud83d\udd0d Search by ID or content...",value:d,onChange:e=>p(e.target.value),style:{width:"100%",padding:"6px 8px",fontSize:"11px",background:"var(--bgSecondary)",border:"1px solid var(--borderMedium)",borderRadius:"4px",color:"var(--textPrimary)",fontFamily:"var(--fontFamily-mono)"}}),d&&Bc.createElement("div",{style:{fontSize:"10px",color:"var(--textMuted)",marginTop:"4px"}},y.length," of ",x.length," inscriptions")),w?Bc.createElement("div",{style:{padding:"20px",textAlign:"center",color:"var(--textMuted)",fontSize:"11px"}},"Loading inscriptions..."):0===x.length?Bc.createElement("div",{style:{padding:"20px",textAlign:"center",color:"var(--textMuted)",fontSize:"11px"}},"No inscriptions found in wallet"):0===y.length?Bc.createElement("div",{style:{padding:"20px",textAlign:"center",color:"var(--textMuted)",fontSize:"11px"}},'No inscriptions match "',d,'"'):Bc.createElement(cA,{inscriptions:N,selectedIds:e,onSelect:e=>{const n=e.id||e.inscriptionId||e.inscription_id;I.has(n)||(E.has(n)?t(""):t(n))},visible:!0,disabledIds:i,disabledLabelLookup:a}),Bc.createElement("p",{style:{margin:"8px 0 0 0",fontSize:"11px",color:"var(--textMuted)",lineHeight:"1.4"}},r))},me=String(T||"Parents").trim()||"Parents",ge="inscriptions"===me.toLowerCase(),he=ge?"inscription":"parent",be=[{id:"parents",label:me},{id:"delegate",label:"Delegate"},{id:"reinscribe",label:"Reinscribe"},{id:"destination",label:"Dest"},{id:"meta",label:"Meta"},{id:"metadata",label:"Data"},{id:"properties",label:"Props"},{id:"pointer",label:"Pointer"}],ye=k?be.filter(e=>"parents"===e.id):be;return Bc.createElement("div",{className:"advanced-options inscription-card",style:{height:"100%",display:"flex",flexDirection:"column",overflow:"hidden"}},Bc.createElement("div",{style:{display:"flex",gap:"2px",padding:"3px",borderBottom:"1px solid var(--borderMedium)",flexShrink:0,overflowX:"auto",WebkitOverflowScrolling:"touch",msOverflowStyle:"none",scrollbarWidth:"none"}},ye.map(e=>Bc.createElement("button",{key:e.id,onClick:()=>j(e.id),style:{flex:"0 0 auto",minWidth:"48px",padding:"4px 4px",fontSize:"11px",background:W===e.id?"var(--bgTertiary)":"transparent",border:"none",borderBottom:W===e.id?"2px solid var(--accentPurple)":"2px solid transparent",color:W===e.id?"var(--textPrimary)":"var(--textMuted)",cursor:"pointer",transition:"all 0.2s",fontWeight:W===e.id?"600":"400",touchAction:"manipulation",WebkitTapHighlightColor:"transparent"}},Bc.createElement("div",{style:{fontSize:"11px",lineHeight:"1.2",whiteSpace:"nowrap"}},e.label)))),Bc.createElement("div",{style:{flex:1,overflow:"auto",padding:"4px",minHeight:0,WebkitOverflowScrolling:"touch"}},"parents"===W&&Bc.createElement("div",{className:"fade-in",style:{background:"rgba(168, 85, 247, 0.05)",borderRadius:"6px",padding:"6px"}},Bc.createElement("h5",{style:{fontSize:"12px",fontWeight:600,margin:"0 0 4px 0",color:"var(--textPrimary)"}},"Select ",ge?"Inscription":"Parent Inscription",c.length>1?"s":""),Bc.createElement("p",{style:{fontSize:"10px",color:"var(--textMuted)",marginBottom:"6px",lineHeight:"1.3"}},A&&0===c.length?`Click an inscription to select (1 ${he} max)`:A&&1===c.length?`${he} selected (1 ${he} max)`:0===c.length?`Click an inscription to add as ${he}`:1===c.length?ge?"1 inscription selected":"Parent-Child mode active":ge?`${c.length} inscriptions selected`:`Multi-Parent mode active (${c.length} parents)`),ge&&!A&&pe.length>0&&Bc.createElement("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginBottom:"6px"}},(()=>{const e=pe.map(e=>e.id||e.inscriptionId||e.inscription_id).filter(Boolean),t=new Set((c||[]).map(e=>e.id||e.inscriptionId||e.inscription_id).filter(Boolean)),n=e.length>0&&e.every(e=>t.has(e));return Bc.createElement("button",{type:"button",onClick:()=>{n?y&&y({type:"bulk",parents:[]}):y&&y({type:"bulk",parents:pe})},style:{padding:"6px 10px",fontSize:"11px",borderRadius:"6px",border:"1px solid var(--borderMedium)",background:"var(--bgSecondary)",color:"var(--textPrimary)",cursor:"pointer"},title:n?"Clear selection":"Select all visible inscriptions"},n?"Clear all":"Select all")})()),x.length>0&&Bc.createElement("div",{style:{marginBottom:"8px"}},Bc.createElement("input",{type:"text",placeholder:"Search by ID or content...",value:V,onChange:e=>q(e.target.value),style:{width:"100%",padding:"6px 8px",fontSize:"11px",background:"var(--bgSecondary)",border:"1px solid var(--borderMedium)",borderRadius:"4px",color:"var(--textPrimary)",fontFamily:"var(--fontFamily-mono)"}}),V&&Bc.createElement("div",{style:{fontSize:"10px",color:"var(--textMuted)",marginTop:"4px"}},pe.length," of ",x.length," inscriptions")),w?Bc.createElement("div",{style:{padding:"12px",textAlign:"center",color:"var(--textMuted)",fontSize:"11px"}},"Loading inscriptions..."):0===x.length?Bc.createElement("div",{style:{padding:"12px",textAlign:"center",color:"var(--textMuted)",fontSize:"11px"}},"No inscriptions found in wallet"):0===pe.length?Bc.createElement("div",{style:{padding:"12px",textAlign:"center",color:"var(--textMuted)",fontSize:"11px"}},'No inscriptions match "',V,'"'):Bc.createElement("div",null,Bc.createElement(cA,{inscriptions:pe,selectedIds:(c||[]).map(e=>e&&(e.id||e.inscriptionId||e.inscription_id)).filter(Boolean),onSelect:e=>{if(A){const t=e.id||e.inscriptionId||e.inscription_id;c.some(e=>(e.id||e.inscriptionId||e.inscription_id)===t)?y&&y({type:"bulk",parents:[]}):(y&&y({type:"bulk",parents:[e]}),H&&H(e))}else y&&y(e)},onDoubleClick:e=>{if(A){const t=e.id||e.inscriptionId||e.inscription_id;c.some(e=>(e.id||e.inscriptionId||e.inscription_id)===t)||y&&y({type:"bulk",parents:[e]}),H&&H(e)}},visible:!0,disabledIds:[],enableDragSelect:ge&&!A,selectedFirst:!(ge&&!A)}),de&&de.groups.length>0&&Bc.createElement("div",{style:{marginTop:"10px",padding:"6px",background:"rgba(0,0,0,0.25)",borderRadius:"6px",border:"1px solid rgba(59, 130, 246, 0.4)"}},Bc.createElement("div",{style:{fontSize:"11px",fontWeight:600,color:"rgb(59, 130, 246)",marginBottom:"4px"}},"\ud83d\udce6 Multi-Inscription Groups (tap any to use as parent)"),Bc.createElement("div",{style:{fontSize:"10px",color:"var(--textMuted)",marginBottom:"6px"}},"Select any inscription ID for parent reference."),Bc.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"8px"}},de.groups.map((e,t)=>{const n="utxo"===e.type,r=n?`UTXO ${e.utxo.split(":")[0].substring(0,8)}...:${e.utxo.split(":")[1]}`:`Sat ${e.key.slice(4)}`,i=n?"rgba(59, 130, 246, 0.7)":"rgba(250, 204, 21, 0.9)";return Bc.createElement("div",{key:e.key||t,style:{position:"relative",padding:"10px 6px 6px 6px",borderRadius:"8px",background:"rgba(0,0,0,0.35)",border:`2px solid ${i}`,boxShadow:`0 0 0 1px ${i}`}},Bc.createElement("div",{style:{position:"absolute",top:"-10px",left:"8px",padding:"2px 8px",borderRadius:"999px",fontSize:"10px",fontWeight:600,color:n?"#fff":"#111827",background:n?"linear-gradient(135deg, rgb(59, 130, 246), rgb(29, 78, 216))":"linear-gradient(135deg, #facc15, #fbbf24)",border:`1px solid ${i}`,boxShadow:"0 2px 4px rgba(0,0,0,0.4)",display:"inline-flex",alignItems:"center",gap:"4px",zIndex:5}},Bc.createElement("span",null,n?"\ud83d\udce6":"\ud83e\ude99"),Bc.createElement("span",null,r),Bc.createElement("span",{style:{fontWeight:500,fontSize:"9px"}},"\xb7 ",e.inscriptions.length)),Bc.createElement(cA,{inscriptions:e.inscriptions,selectedIds:(c||[]).map(e=>e&&(e.id||e.inscriptionId||e.inscription_id)).filter(Boolean),onSelect:e=>{if(A){const t=e.id||e.inscriptionId||e.inscription_id;c.some(e=>(e.id||e.inscriptionId||e.inscription_id)===t)?y&&y({type:"bulk",parents:[]}):y&&y({type:"bulk",parents:[e]})}else y&&y(e)},visible:!0,disabledIds:[],emphasizeSelected:!1,sortByNumber:!1}))}))))),"delegate"===W&&Bc.createElement("div",{className:"fade-in",style:{background:"rgba(34, 211, 238, 0.05)",borderRadius:"6px",padding:"6px"}},Bc.createElement(fe,{selectedId:n,onSelect:d,title:"Select Delegate Inscription",description:"Reference another inscription's content (Tag 11). Body will be empty when delegating.",allowManualEntry:!0,manualEntryLabel:"Delegate ID (manual)",manualEntryPlaceholder:"Paste delegate inscription id (e.g. <txid>i0)",manualEntryHint:"Delegates do not need to be in your wallet. Paste any inscription ID."}),de&&de.groups.length>0&&Bc.createElement("div",{style:{marginTop:"10px",padding:"6px",background:"rgba(0,0,0,0.25)",borderRadius:"6px",border:"1px solid rgba(59, 130, 246, 0.4)"}},Bc.createElement("div",{style:{fontSize:"11px",fontWeight:600,color:"rgb(59, 130, 246)",marginBottom:"4px"}},"\ud83d\udce6 Multi-Inscription Groups (tap any to use as delegate)"),Bc.createElement("div",{style:{fontSize:"10px",color:"var(--textMuted)",marginBottom:"6px"}},"Select any inscription ID for delegate reference."),Bc.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"8px"}},de.groups.map((e,t)=>{const r="utxo"===e.type;e.type;const i=r?`UTXO ${e.utxo.split(":")[0].substring(0,8)}...:${e.utxo.split(":")[1]}`:`Sat ${e.key.slice(4)}`,a=r?"rgba(59, 130, 246, 0.7)":"rgba(250, 204, 21, 0.9)";return Bc.createElement("div",{key:e.key||t,style:{position:"relative",padding:"10px 6px 6px 6px",borderRadius:"8px",background:"rgba(0,0,0,0.35)",border:`2px solid ${a}`,boxShadow:`0 0 0 1px ${a}`}},Bc.createElement("div",{style:{position:"absolute",top:"-10px",left:"8px",padding:"2px 8px",borderRadius:"999px",fontSize:"10px",fontWeight:600,color:r?"#fff":"#111827",background:r?"linear-gradient(135deg, rgb(59, 130, 246), rgb(29, 78, 216))":"linear-gradient(135deg, #facc15, #fbbf24)",border:`1px solid ${a}`,boxShadow:"0 2px 4px rgba(0,0,0,0.4)",display:"inline-flex",alignItems:"center",gap:"4px",zIndex:5}},Bc.createElement("span",null,r?"\ud83d\udce6":"\ud83e\ude99"),Bc.createElement("span",null,i),Bc.createElement("span",{style:{fontWeight:500,fontSize:"9px"}},"\xb7 ",e.inscriptions.length)),Bc.createElement(cA,{inscriptions:e.inscriptions,selectedIds:n,onSelect:e=>{const t=e.id||e.inscriptionId||e.inscription_id;d&&d(t)},visible:!0,disabledIds:[],emphasizeSelected:!1,sortByNumber:!1}))})))),"reinscribe"===W&&Bc.createElement("div",{className:"fade-in",style:{background:"rgba(251, 146, 60, 0.05)",borderRadius:"6px",padding:"6px"}},s&&(()=>{const e=s.split(",").filter(Boolean),t=e.length>1,n=e=>e.length<=20?e:`${e.substring(0,12)}...${e.substring(e.length-4)}`;return Bc.createElement("div",{style:{marginBottom:"6px",padding:"5px 6px",borderRadius:"6px",background:"rgba(250, 204, 21, 0.08)",border:"1px solid rgba(250, 204, 21, 0.5)",fontSize:"10px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"6px"}},Bc.createElement("div",{style:{flex:1,minWidth:0}},Bc.createElement("div",{style:{fontWeight:600,color:"rgb(250, 204, 21)",fontSize:"10px",marginBottom:"2px"}},"\ud83c\udfaf Target",t?"s":""," ",t&&`(${e.length})`),Bc.createElement("div",{style:{fontFamily:"var(--fontFamily-mono)",fontSize:"9px",color:"var(--textMuted)",maxHeight:t?"50px":"auto",overflow:"auto",wordBreak:"break-all",lineHeight:"1.3"},title:t?e.join("\n"):s},t?Bc.createElement("div",null,e.map((e,t)=>Bc.createElement("div",{key:t},n(e)))):n(s))),Bc.createElement("button",{type:"button",onClick:()=>{try{const t=document.querySelector(`[data-insc-id="${e[0]}"]`);t&&t.scrollIntoView&&t.scrollIntoView({behavior:"smooth",block:"center"})}catch(t){}},style:{fontSize:"9px",padding:"3px 6px",borderRadius:"999px",border:"1px solid rgba(250, 204, 21, 0.7)",background:"rgba(250, 204, 21, 0.12)",color:"rgb(250, 204, 21)",cursor:"pointer",flexShrink:0,whiteSpace:"nowrap"}},"Jump"))})(),Bc.createElement(fe,{selectedId:s,onSelect:e=>{S.includes(e)||h&&h(e)},title:"Select Inscription to Update",description:"Reinscribe over an existing inscription. Select the target inscription to update its content. Inscriptions sharing the same sat/UTXO are highlighted below as groups.",disableIds:[...S],disabledLabelLookup:ue,filterGroupedInscriptions:!0}),de&&de.groups.length>0&&Bc.createElement("div",{style:{marginTop:"10px",padding:"6px",background:"rgba(0,0,0,0.25)",borderRadius:"6px",border:"1px solid rgba(59, 130, 246, 0.4)"}},Bc.createElement("div",{style:{fontSize:"11px",fontWeight:600,color:"rgb(59, 130, 246)",marginBottom:"4px"}},"\ud83d\udce6 Multi-Inscription Groups"),Bc.createElement("div",{style:{fontSize:"10px",color:"var(--textMuted)",marginBottom:"6px"}},Bc.createElement("strong",null,"Blue boxes:")," Multiple inscriptions on same UTXO.",Bc.createElement("strong",null," Gold boxes:")," Same-sat chains (inside UTXO or standalone).",Bc.createElement("br",null),Bc.createElement("strong",null,"\u26a0\ufe0f Click individual inscription tiles")," to select exact sat/offset for reinscription."),Bc.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"10px"}},de.groups.map((e,t)=>{const n="utxo"===e.type,r="same-sat"===e.type,i=e.inscriptions.map(e=>e.id||e.inscriptionId||e.inscription_id).filter(Boolean),a=s||"",o=i.includes(a);if(n){const n=e.utxo.split(":"),r=`${n[0].substring(0,8)}...:${n[1]}`;return Bc.createElement("div",{key:e.key||t,style:{position:"relative",padding:"12px 8px 8px 8px",borderRadius:"8px",background:o?"rgba(59, 130, 246, 0.15)":"rgba(59, 130, 246, 0.08)",border:o?"3px solid rgb(59, 130, 246)":"2px solid rgba(59, 130, 246, 0.7)",boxShadow:o?"0 0 0 1px rgb(59, 130, 246), 0 0 20px rgba(59, 130, 246, 0.3)":"0 0 0 1px rgba(59, 130, 246, 0.5)",transition:"all 0.2s ease",cursor:"pointer"},onClick:e=>{(e.target===e.currentTarget||e.target.closest(".utxo-badge"))&&o&&h&&h("")}},Bc.createElement("div",{className:"utxo-badge",style:{position:"absolute",top:"-10px",left:"8px",padding:"2px 8px",borderRadius:"999px",fontSize:"10px",fontWeight:600,color:"#fff",background:o?"linear-gradient(135deg, rgb(59, 130, 246), rgb(37, 99, 235))":"linear-gradient(135deg, rgb(59, 130, 246), rgb(29, 78, 216))",border:"1px solid rgba(59, 130, 246, 0.9)",boxShadow:"0 2px 4px rgba(0,0,0,0.4)",display:"inline-flex",alignItems:"center",gap:"4px",zIndex:5,cursor:"pointer"}},o&&Bc.createElement("span",null,"\u2713"),Bc.createElement("span",null,"\ud83d\udce6"),Bc.createElement("span",{title:e.utxo},r),Bc.createElement("span",{style:{fontWeight:500,fontSize:"9px"}},"\xb7 ",e.inscriptions.length)),o&&Bc.createElement("div",{style:{position:"absolute",inset:0,overflow:"hidden",borderRadius:"inherit",zIndex:4,pointerEvents:"none"}},Bc.createElement("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"80px",color:"rgb(59, 130, 246)",textShadow:"0 0 20px rgba(59, 130, 246, 0.8), 0 0 40px rgba(59, 130, 246, 0.4)",opacity:.9}},"\u2713")),e.subGroups&&e.subGroups.length>0?Bc.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"8px"}},e.subGroups.map((e,n)=>{const r=e.inscriptions.map(e=>e.id||e.inscriptionId||e.inscription_id).filter(Boolean),i=r.includes(a);return Bc.createElement("div",{key:`sub-${t}-${n}`,style:{position:"relative",padding:"8px 6px 6px 6px",borderRadius:"6px",background:i?"rgba(250, 204, 21, 0.15)":"rgba(250, 204, 21, 0.08)",border:i?"3px solid rgb(250, 204, 21)":"2px solid rgba(250, 204, 21, 0.7)",boxShadow:i?"0 0 0 1px rgb(250, 204, 21), 0 0 15px rgba(250, 204, 21, 0.3)":"0 0 0 1px rgba(161, 98, 7, 0.5)",cursor:"pointer",transition:"all 0.2s ease"},onClick:e=>{(e.target===e.currentTarget||e.target.closest(".samesat-badge"))&&(e.stopPropagation(),i&&h&&h(""))}},Bc.createElement("div",{className:"samesat-badge",style:{position:"absolute",top:"-8px",left:"6px",padding:"1px 6px",borderRadius:"999px",fontSize:"9px",fontWeight:600,color:"#111827",background:i?"linear-gradient(135deg, #fbbf24, #facc15)":"linear-gradient(135deg, #facc15, #fbbf24)",border:"1px solid rgba(161, 98, 7, 0.9)",boxShadow:"0 1px 2px rgba(0,0,0,0.3)",display:"inline-flex",alignItems:"center",gap:"3px",zIndex:6,cursor:"pointer"}},i&&Bc.createElement("span",null,"\u2713"),Bc.createElement("span",null,"\ud83e\ude99"),Bc.createElement("span",null,"Sat ",e.sat),Bc.createElement("span",{style:{fontWeight:500,fontSize:"8px"}},"\xb7 ",e.inscriptions.length)),i&&Bc.createElement("div",{style:{position:"absolute",inset:0,overflow:"hidden",borderRadius:"inherit",zIndex:4,pointerEvents:"none"}},Bc.createElement("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"60px",color:"rgb(250, 204, 21)",textShadow:"0 0 15px rgba(250, 204, 21, 0.8), 0 0 30px rgba(250, 204, 21, 0.4)",opacity:.9}},"\u2713")),Bc.createElement(cA,{inscriptions:e.inscriptions,selectedIds:i?r:[],onSelect:e=>{const t=e.id||e.inscriptionId||e.inscription_id;S.includes(t)||h&&h(t)},visible:!0,disabledIds:S,emphasizeSelected:!1,sortByNumber:!1}))}),(()=>{const t=new Set;e.subGroups.forEach(e=>{e.inscriptions.forEach(e=>{const n=e.id||e.inscriptionId||e.inscription_id;n&&t.add(n)})});const n=e.inscriptions.filter(e=>{const n=e.id||e.inscriptionId||e.inscription_id;return n&&!t.has(n)});if(0===n.length)return null;const r=n.map(e=>e.id||e.inscriptionId||e.inscription_id).filter(Boolean),i=r.includes(a);return Bc.createElement("div",{style:{marginTop:"4px"}},Bc.createElement("div",{style:{fontSize:"9px",color:"var(--textMuted)",marginBottom:"4px"}},"Other inscriptions on this UTXO:"),Bc.createElement(cA,{inscriptions:n,selectedIds:i?[a]:[],onSelect:e=>{const t=e.id||e.inscriptionId||e.inscription_id;S.includes(t)||h&&h(t)},visible:!0,disabledIds:S,emphasizeSelected:!1,sortByNumber:!0}))})()):Bc.createElement(cA,{inscriptions:e.inscriptions,selectedIds:o?i:[],onSelect:e=>{const t=e.id||e.inscriptionId||e.inscription_id;S.includes(t)||h&&h(t)},visible:!0,disabledIds:S,emphasizeSelected:!1,sortByNumber:!0}))}if(r){const n=e.key.slice(4),r=e.inscriptions.map(e=>e.id||e.inscriptionId||e.inscription_id).filter(Boolean),i=r.includes(a);return Bc.createElement("div",{key:e.key||t,style:{position:"relative",padding:"10px 6px 6px 6px",borderRadius:"8px",background:i?"rgba(250, 204, 21, 0.15)":"rgba(250, 204, 21, 0.08)",border:i?"3px solid rgb(250, 204, 21)":"2px solid rgba(250, 204, 21, 0.9)",boxShadow:i?"0 0 0 1px rgb(250, 204, 21), 0 0 15px rgba(250, 204, 21, 0.3)":"0 0 0 1px rgba(161, 98, 7, 0.5)",transition:"all 0.2s ease",cursor:"pointer"},onClick:e=>{(e.target===e.currentTarget||e.target.closest(".standalone-samesat-badge"))&&i&&h&&h("")}},Bc.createElement("div",{className:"standalone-samesat-badge",style:{position:"absolute",top:"-10px",left:"8px",padding:"2px 8px",borderRadius:"999px",fontSize:"10px",fontWeight:600,color:"#111827",background:i?"linear-gradient(135deg, #fbbf24, #facc15)":"linear-gradient(135deg, #facc15, #fbbf24)",border:"1px solid rgba(161, 98, 7, 0.9)",boxShadow:"0 2px 4px rgba(0,0,0,0.4)",display:"inline-flex",alignItems:"center",gap:"4px",zIndex:5,cursor:"pointer"}},i&&Bc.createElement("span",null,"\u2713"),Bc.createElement("span",null,"\ud83e\ude99"),Bc.createElement("span",null,"Sat ",n),Bc.createElement("span",{style:{fontWeight:500,fontSize:"9px"}},"\xb7 ",e.inscriptions.length)),i&&Bc.createElement("div",{style:{position:"absolute",inset:0,overflow:"hidden",borderRadius:"inherit",zIndex:4,pointerEvents:"none"}},Bc.createElement("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"70px",color:"rgb(250, 204, 21)",textShadow:"0 0 15px rgba(250, 204, 21, 0.8), 0 0 30px rgba(250, 204, 21, 0.4)",opacity:.9}},"\u2713")),Bc.createElement("div",{style:{fontSize:"9px",color:"var(--textMuted)",marginBottom:"4px",marginTop:"4px"}},"Same-sat chain across multiple UTXOs"),Bc.createElement(cA,{inscriptions:e.inscriptions,selectedIds:i?r:[],onSelect:e=>{const t=e.id||e.inscriptionId||e.inscription_id;S.includes(t)||h&&h(t)},visible:!0,disabledIds:S,emphasizeSelected:!1,sortByNumber:!1}))}return null}))),s&&(()=>{const e=x.find(e=>(e.id||e.inscriptionId||e.inscription_id)===s);if(!e)return null;let t,n,r="unknown";if(e.utxo&&void 0!==e.utxo.txid&&void 0!==e.utxo.vout&&(t=e.utxo.txid,n=e.utxo.vout,r="utxo"),(!t||void 0===n)&&e.satpoint){const i=String(e.satpoint).split(":");i.length>=2&&(t=t||i[0],n=n??parseInt(i[1]),r="utxo"===r?"utxo+satpoint":"satpoint")}const i=(()=>{const t=String(e.satpoint||"").split(":");return t.length>=3?`:${t[2]}`:""})(),a=e=>!e||e.length<=16?e:`${e.substring(0,8)}...${e.substring(e.length-8)}`;return Bc.createElement("div",{style:{marginTop:"6px",padding:"5px 6px",background:"rgba(251, 146, 60, 0.08)",border:"1px solid rgba(251, 146, 60, 0.3)",borderRadius:"4px",fontSize:"9px",color:"var(--textPrimary)"}},Bc.createElement("div",{style:{fontFamily:"var(--fontFamily-mono)",wordBreak:"break-all",lineHeight:"1.3"},title:`Full ID: ${s}`},Bc.createElement("strong",null,"Target:")," ",a(s)),Bc.createElement("div",{style:{fontFamily:"var(--fontFamily-mono)",marginTop:"2px",color:"var(--textMuted)",wordBreak:"break-all",lineHeight:"1.3"},title:`Full outpoint: ${t}:${String(n)}${i}`},Bc.createElement("strong",null,"Outpoint:")," ",a(t),":",String(n),i," ",Bc.createElement("span",{style:{opacity:.8,fontSize:"8px"}},"[",r,"]")))})(),s&&S.includes(s)&&Bc.createElement("div",{style:{marginTop:"6px",padding:"6px",background:"rgba(120,120,120,0.15)",border:"1px solid rgba(120,120,120,0.4)",borderRadius:"4px",fontSize:"11px",color:"var(--textMuted)"}},"This target has already been used in the current batch.")),"destination"===W&&Bc.createElement("div",{className:"fade-in",style:{background:"rgba(34, 197, 94, 0.05)",borderRadius:"6px",padding:"6px"}},Bc.createElement("label",{className:"form-label",style:{fontSize:"12px",marginBottom:"4px"}},"\ud83d\udccd Destination Address (Optional)"),Bc.createElement("input",{type:"text",className:"form-input",value:l,onChange:e=>b&&b(e.target.value),placeholder:v?`Leave empty for your ordinals address (${v.substring(0,10)}...)`:"Leave empty to use your ordinals address",style:{fontSize:"11px",padding:"6px",fontFamily:"var(--fontFamily-mono)"}}),l&&l!==v&&Bc.createElement("div",{style:{marginTop:"6px",padding:"6px",background:"rgba(251, 146, 60, 0.1)",border:"1px solid rgba(251, 146, 60, 0.3)",borderRadius:"4px",fontSize:"11px",color:"var(--accentAmber)"}},"\u26a0\ufe0f ",Bc.createElement("strong",null,"Warning:")," You are sending to a custom address. Make sure you control this address!"),!l&&v&&Bc.createElement("div",{style:{marginTop:"6px",padding:"6px",background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)",borderRadius:"4px",fontSize:"11px",color:"var(--accentGreen)"}},"\u2713 Will send to your ordinals address: ",Bc.createElement("span",{style:{fontFamily:"var(--fontFamily-mono)"}},v.substring(0,20),"...")),Bc.createElement("div",{style:{marginTop:"12px",padding:"10px",background:"var(--bgSecondary)",borderRadius:"6px",fontSize:"11px",color:"var(--textMuted)",lineHeight:"1.5"}},Bc.createElement("div",{style:{fontWeight:600,color:"var(--textSecondary)",marginBottom:"6px"}},"What is this?"),Bc.createElement("ul",{style:{margin:0,paddingLeft:"20px"}},Bc.createElement("li",null,"Where the ",Bc.createElement("strong",null,"newly created inscription")," will be sent"),Bc.createElement("li",null,"Change and funding still come from your payment address"),Bc.createElement("li",null,"Leave empty to send to your ordinals address (recommended)"),Bc.createElement("li",null,"Use custom address to gift inscriptions or send to cold storage")))),"meta"===W&&Bc.createElement("div",{className:"fade-in"},Bc.createElement("label",{className:"form-label",style:{fontSize:"12px",marginBottom:"4px"}},"Metaprotocol (Tag 7)"),Bc.createElement("input",{type:"text",className:"form-input",value:r,onChange:e=>p&&p(e.target.value),placeholder:"e.g., cbrc-20",style:{fontSize:"12px",padding:"6px"}}),Bc.createElement("p",{style:{margin:"4px 0 0 0",fontSize:"11px",color:"var(--textMuted)",lineHeight:"1.4"}},"Specify protocol for interpretation (e.g., brc-20, sns, ordinal-collections)")),"metadata"===W&&Bc.createElement("div",{className:"fade-in"},Bc.createElement("label",{className:"form-label",style:{fontSize:"12px",marginBottom:"4px"}},"Metadata JSON (Tag 5)"),Bc.createElement("textarea",{className:"form-input form-textarea",value:i,onChange:e=>f&&f(e.target.value),placeholder:'{"key": "value"}',style:{fontSize:"11px",padding:"6px",minHeight:"120px",fontFamily:"var(--fontFamily-mono)",borderColor:i&&!se.valid?"var(--accentAmber)":void 0}}),i&&Bc.createElement("div",{style:{marginTop:"4px",fontSize:"11px",color:se.valid?"var(--accentCyan)":"var(--accentAmber)"}},se.message),Bc.createElement("p",{style:{margin:"4px 0 0 0",fontSize:"11px",color:"var(--textMuted)",lineHeight:"1.4"}},"Arbitrary JSON metadata (CBOR-encoded automatically)")),"properties"===W&&Bc.createElement("div",{className:"fade-in"},Bc.createElement("div",{style:{marginBottom:"8px",padding:"8px",background:"rgba(139, 92, 246, 0.1)",border:"1px solid rgba(139, 92, 246, 0.3)",borderRadius:"6px",fontSize:"11px",lineHeight:"1.5",color:"var(--textPrimary)"}},Bc.createElement("div",{style:{fontWeight:600,marginBottom:"4px",color:"rgb(168, 85, 247)"}},"\ud83d\udcd6 What are Properties?"),Bc.createElement("div",{style:{color:"var(--textMuted)"}},Bc.createElement("strong",null,"Properties")," are structured, protocol-defined metadata with strict schema rules. Unlike ",Bc.createElement("strong",null,"Metadata")," (Tag 5, free-form), properties must follow ordinals spec."),Bc.createElement("div",{style:{marginTop:"6px",paddingLeft:"8px",borderLeft:"2px solid rgba(139, 92, 246, 0.3)"}},Bc.createElement("div",null,Bc.createElement("strong",null,"Gallery:")," Showcase other inscriptions (key 0 = items array)"),Bc.createElement("div",null,Bc.createElement("strong",null,"\ud83c\udff7\ufe0f Attributes:"),' Add title to your inscription (key 1 \u2192 key 0 = "title")'))),Bc.createElement("div",{style:{marginBottom:"12px"}},Bc.createElement("label",{className:"form-label",style:{fontSize:"12px",marginBottom:"8px",display:"block"}},"Choose Type"),Bc.createElement("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"6px"}},Bc.createElement("button",{type:"button",onClick:()=>K("gallery"),style:{padding:"10px 8px",fontSize:"11px",background:"gallery"===X?"linear-gradient(135deg, rgb(139, 92, 246), rgb(168, 85, 247))":"rgb(38, 38, 38)",border:"1px solid rgb(55, 55, 55)",borderRadius:"8px",color:"white",cursor:"pointer",fontWeight:"gallery"===X?600:400,transition:"all 0.2s"}},"Gallery"),Bc.createElement("button",{type:"button",onClick:()=>K("attributes"),style:{padding:"10px 8px",fontSize:"11px",background:"attributes"===X?"linear-gradient(135deg, rgb(59, 130, 246), rgb(37, 99, 235))":"rgb(38, 38, 38)",border:"1px solid rgb(55, 55, 55)",borderRadius:"8px",color:"white",cursor:"pointer",fontWeight:"attributes"===X?600:400,transition:"all 0.2s"}},"\ud83c\udff7\ufe0f Attributes"),Bc.createElement("button",{type:"button",onClick:()=>K("advanced"),style:{padding:"10px 8px",fontSize:"11px",background:"advanced"===X?"linear-gradient(135deg, rgb(34, 197, 94), rgb(22, 163, 74))":"rgb(38, 38, 38)",border:"1px solid rgb(55, 55, 55)",borderRadius:"8px",color:"white",cursor:"pointer",fontWeight:"advanced"===X?600:400,transition:"all 0.2s"}},"\ud83d\udcbb JSON"))),"gallery"===X&&Bc.createElement("div",null,Bc.createElement("div",{style:{marginBottom:"12px",padding:"8px",background:"rgba(139, 92, 246, 0.05)",borderLeft:"3px solid rgb(139, 92, 246)",borderRadius:"4px",fontSize:"10px",color:"var(--textMuted)"}},Bc.createElement("strong",null,"Gallery:")," Create a permissionless collection showcasing other inscriptions. Items appear on ordinals.com. Anyone can make galleries - no provenance required."),Bc.createElement("label",{className:"form-label",style:{fontSize:"12px",marginBottom:"6px"}},"Gallery Title ",Bc.createElement("span",{style:{color:"var(--textMuted)",fontWeight:400}},"(required)")),Bc.createElement("input",{type:"text",className:"form-input "+(G&&""!==G.trim()?"":"xverse-input-invalid"),value:G,onChange:e=>{const t=e.target.value;Y(t);const n=(J||"").split(/[\n,]+/).map(e=>re(e)).filter(Boolean),r={};(Z||"").split("\n").forEach(e=>{const t=e.trim().match(/^([^=]+)=(.+)$/);if(t){const e=t[1].trim();let n=t[2].trim();"true"===n?n=!0:"false"===n?n=!1:"null"===n?n=null:/^-?\d+$/.test(n)&&(n=parseInt(n)),r[e]=n}});const i={0:n,1:{0:t,...Object.keys(r).length>0?{1:r}:{}}},a=JSON.stringify(i,null,2);m&&m(a)},onBlur:e=>{const t=J.split(/[\n,]+/).map(e=>re(e)).filter(Boolean),n={};(Z||"").split("\n").forEach(e=>{const t=e.trim().match(/^([^=]+)=(.+)$/);if(t){const e=t[1].trim();let r=t[2].trim();"true"===r?r=!0:"false"===r?r=!1:"null"===r?r=null:/^-?\d+$/.test(r)&&(r=parseInt(r)),n[e]=r}});const r={0:t,1:{0:e.target.value,...Object.keys(n).length>0?{1:n}:{}}};m&&m(JSON.stringify(r,null,2))},onKeyDown:e=>{"Enter"===e.key&&e.target.blur()},placeholder:"My Bitcoin Art Collection",style:{fontSize:"12px",padding:"8px",marginBottom:"12px"}}),Bc.createElement("label",{className:"form-label",style:{fontSize:"12px",marginBottom:"6px"}},"Traits ",Bc.createElement("span",{style:{color:"var(--textMuted)",fontWeight:400}},"(optional, key=value format)")),Bc.createElement("textarea",{className:"form-input form-textarea",value:Z,onChange:e=>{const t=e.target.value;ee(t);const n=(J||"").split(/[\n,]+/).map(e=>re(e)).filter(Boolean),r={};t.split("\n").forEach(e=>{const t=e.trim().match(/^([^=]+)=(.+)$/);if(t){const e=t[1].trim();let n=t[2].trim();"true"===n?n=!0:"false"===n?n=!1:"null"===n?n=null:/^-?\d+$/.test(n)&&(n=parseInt(n)),r[e]=n}});const i={0:n,1:{0:G,...Object.keys(r).length>0?{1:r}:{}}};m&&m(JSON.stringify(i,null,2))},placeholder:"artist = Satoshi\nyear = 2024\nverified = true",style:{fontSize:"11px",padding:"8px",minHeight:"60px",marginBottom:"12px",fontFamily:"var(--fontFamily-mono)"}}),Bc.createElement("p",{style:{margin:"6px 0 12px 0",fontSize:"10px",color:"var(--textMuted)",lineHeight:"1.4"}},"Traits support: strings, integers (42), booleans (true/false), null. Switch to JSON mode for per-item attributes."),Bc.createElement("label",{className:"form-label",style:{fontSize:"12px",marginBottom:"6px"}},"Inscription IDs to Include ",Bc.createElement("span",{style:{color:"var(--textMuted)",fontWeight:400}},"(one per line or comma-separated)")),Bc.createElement("textarea",{className:"form-input form-textarea",value:J,onChange:e=>{const t=e.target.value;Q(t);const n={0:t.split(/[\n,]+/).map(e=>re(e)).filter(Boolean),1:{0:G}};m&&m(JSON.stringify(n,null,2))},onBlur:e=>{const t={0:e.target.value.split(/[\n,]+/).map(e=>re(e)).filter(Boolean),1:{0:G}};m&&m(JSON.stringify(t,null,2))},placeholder:"abc123...def456...xyz789i0\nor comma: abc123, def456, xyz789i0",style:{fontSize:"11px",padding:"8px",minHeight:"100px",fontFamily:"var(--fontFamily-mono)"}}),(()=>{const e=(J||"").split(/[\n,]+/).map(e=>re(e)).filter(Boolean);return 0===e.length?null:Bc.createElement("div",{style:{marginTop:"10px",padding:"8px",border:"1px solid var(--borderMedium)",borderRadius:"8px",background:"rgba(0, 0, 0, 0.15)"}},Bc.createElement("div",{style:{fontSize:"11px",fontWeight:600,color:"var(--textPrimary)",marginBottom:"6px"}},"Gallery Items (preview)"),Bc.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"4px"}},e.slice(0,12).map(e=>{const t=(e=>/^[a-f0-9]{64}i\d+$/i.test(String(e||"").trim()))(e),n=ie.get(e),r=n?.sat||n?.sat_number||n?.satNumber,i=n?.utxo?.value,a=[t?"\u2713":"\u26a0\ufe0f",e,null!=r?`sat ${r}`:null,null!=i?`${i} sats`:null].filter(Boolean).join(" \xb7 ");return Bc.createElement("div",{key:e,style:{fontSize:"10px",color:t?"var(--textSecondary)":"var(--accentAmber)",fontFamily:"var(--fontFamily-mono)",wordBreak:"break-all"}},a)}),e.length>12&&Bc.createElement("div",{style:{fontSize:"10px",color:"var(--textMuted)"}},"\u2026and ",e.length-12," more")))})(),Bc.createElement("p",{style:{margin:"6px 0 0 0",fontSize:"10px",color:"var(--textMuted)",lineHeight:"1.4"}},"Paste full inscription IDs from ordinals.com (format: txidiindex). Updates when you click out.")),"attributes"===X&&Bc.createElement("div",null,Bc.createElement("div",{style:{marginBottom:"12px",padding:"8px",background:"rgba(59, 130, 246, 0.05)",borderLeft:"3px solid rgb(59, 130, 246)",borderRadius:"4px",fontSize:"10px",color:"var(--textMuted)"}},Bc.createElement("strong",null,"Attributes:")," Add structured metadata like a title. These follow strict ordinals protocol (Tag 17) and appear on ordinals.com. Use ",Bc.createElement("strong",null,"Metadata")," tab for free-form data."),Bc.createElement("label",{className:"form-label",style:{fontSize:"12px",marginBottom:"6px"}},"Title ",Bc.createElement("span",{style:{color:"var(--textMuted)",fontWeight:400}},"(displayed on ordinals.com)")),Bc.createElement("input",{type:"text",className:"form-input",value:te,onChange:e=>ne(e.target.value),onBlur:e=>{const t={1:{0:e.target.value}};m&&m(JSON.stringify(t,null,2))},onKeyDown:e=>{"Enter"===e.key&&e.target.blur()},placeholder:"Genesis Inscription",style:{fontSize:"12px",padding:"8px"}}),Bc.createElement("p",{style:{margin:"6px 0 0 0",fontSize:"10px",color:"var(--textMuted)",lineHeight:"1.4"}},"Adds protocol-compliant title. For custom fields, use the ",Bc.createElement("strong",null,"Data")," (Metadata) tab instead.")),"advanced"===X&&Bc.createElement("div",null,Bc.createElement("div",{style:{marginBottom:"12px",padding:"8px",background:"rgba(34, 197, 94, 0.05)",borderLeft:"3px solid rgb(34, 197, 94)",borderRadius:"4px",fontSize:"10px",color:"var(--textMuted)"}},Bc.createElement("strong",null,"Advanced:")," Manually write properties JSON. Must follow strict ordinals schema with numeric keys: ",Bc.createElement("code",{style:{background:"rgba(0,0,0,0.3)",padding:"1px 4px",borderRadius:"2px"}},"0")," for items array,",Bc.createElement("code",{style:{background:"rgba(0,0,0,0.3)",padding:"1px 4px",borderRadius:"2px"}}," 1")," for attributes."),Bc.createElement("label",{className:"form-label",style:{fontSize:"12px",marginBottom:"6px"}},"Properties JSON ",Bc.createElement("span",{style:{color:"var(--textMuted)",fontWeight:400}},"(ordinals schema - Tag 17)")),Bc.createElement("textarea",{className:"form-input form-textarea",value:a,onChange:e=>m&&m(e.target.value),placeholder:'{\\n  "0": ["inscriptionId1", "inscriptionId2"],\\n  "1": { "0": "Gallery Title" }\\n}',style:{fontSize:"11px",padding:"8px",minHeight:"140px",fontFamily:"var(--fontFamily-mono)",borderColor:a&&!le.valid?"var(--accentAmber)":void 0}}),a&&Bc.createElement("div",{style:{marginTop:"4px",fontSize:"11px",color:le.valid?"var(--accentCyan)":"var(--accentAmber)"}},le.message),Bc.createElement("div",{style:{marginTop:"12px",padding:"10px",background:"rgba(6, 182, 212, 0.05)",border:"1px solid rgba(6, 182, 212, 0.2)",borderRadius:"8px",fontSize:"10px",lineHeight:"1.5",color:"var(--textMuted)"}},Bc.createElement("div",{style:{fontWeight:600,color:"var(--accentCyan)",marginBottom:"4px"}},"\ud83d\udccb Schema Reference"),Bc.createElement("div",{style:{fontFamily:"var(--fontFamily-mono)",fontSize:"9px",background:"rgba(0,0,0,0.3)",padding:"6px",borderRadius:"4px"}},'{ "0": [items], "1": { "0": "title" } }'),Bc.createElement("div",{style:{marginTop:"6px"}},Bc.createElement("strong",null,'Key "0":')," Array of inscription IDs (gallery items)",Bc.createElement("br",null),Bc.createElement("strong",null,'Key "1":')," Attributes object \u2192 ",Bc.createElement("strong",null,'Key "0":')," Title text"))),Bc.createElement("button",{type:"button",onClick:()=>{m&&m(""),Y(""),Q(""),ee(""),ne("")},style:{marginTop:"12px",width:"100%",padding:"8px",fontSize:"11px",background:"rgb(38, 38, 38)",border:"1px solid rgb(55, 55, 55)",borderRadius:"8px",color:"var(--textMuted)",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:e=>{e.target.style.background="rgb(220, 38, 38)",e.target.style.color="white"},onMouseLeave:e=>{e.target.style.background="rgb(38, 38, 38)",e.target.style.color="var(--textMuted)"}},"\ud83d\uddd1\ufe0f Clear Properties")),"pointer"===W&&Bc.createElement("div",{className:"fade-in"},Bc.createElement("label",{className:"form-label",style:{fontSize:"12px",marginBottom:"6px"}},"Pointer"),Bc.createElement("input",{type:"text",className:"form-input",value:o,onChange:e=>g&&g(e.target.value),placeholder:"0",style:{fontSize:"12px",padding:"8px",borderColor:o&&!ce.valid?"var(--accentAmber)":void 0}}),o&&Bc.createElement("div",{style:{marginTop:"4px",fontSize:"11px",color:ce.valid?"var(--accentCyan)":"var(--accentAmber)"}},ce.message),Bc.createElement("p",{style:{margin:"8px 0 0 0",fontSize:"11px",color:"var(--textMuted)",lineHeight:"1.4"}},"A pointer selects which sat position (0-based) the inscription should attach to. Leave blank unless you know you need it. For reinscriptions, this is typically auto-set to match the original sat."))),"function"==typeof D&&!e&&Bc.createElement("div",{style:{flexShrink:0,padding:"6px 8px",borderTop:"1px solid var(--borderMedium)",background:"var(--bgPrimary)"}},Bc.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:"8px",marginBottom:"6px"}},(()=>{const e=!!s,t=e?1:parseInt($,10)||1;return Bc.createElement(Bc.Fragment,null,Bc.createElement("span",{style:{fontSize:"11px",color:"var(--textMuted)"}},"Repeat"),Bc.createElement("input",{type:"number",min:"1",max:"200",value:t,disabled:e,onChange:e=>(e=>{if(!U)return;const t=Math.max(1,Math.min(200,parseInt(e,10)||1));U(t)})(e.target.value),style:{width:"48px",padding:"2px 4px",background:"rgba(23,23,23,0.6)",border:"1px solid rgba(64,64,64,0.5)",borderRadius:"4px",fontSize:"11px",fontFamily:"monospace",color:"var(--textPrimary)",opacity:e?.5:1}}))})()),0===z.length?Bc.createElement(Bc.Fragment,null,e&&"content"===String(t||"")&&Bc.createElement("div",{style:{marginBottom:"6px",padding:"6px 8px",borderRadius:"8px",border:"1px solid rgba(168, 85, 247, 0.25)",background:"rgba(168, 85, 247, 0.08)",color:"rgba(233, 213, 255, 0.95)",fontSize:"11px",lineHeight:1.3}},"Step 1: Add your content first, then come here to add to batch."),Bc.createElement("button",{onClick:()=>{if(e&&"content"===String(t||""))return;const u=(()=>{if(null==C)return!1;if("string"==typeof C)return C.length>0;if(C instanceof ArrayBuffer)return C.byteLength>0;if("undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(C))return(C.byteLength||0)>0;if("[object ArrayBuffer]"===Object.prototype.toString.call(C))try{return(C.byteLength||0)>0}catch{return!0}return!0})(),d=(()=>{const e=String(n||"").trim(),t=String(r||"").trim(),l=String(i||"").trim(),u=String(a||"").trim(),d=Array.isArray(c)?c.length:0,p=!!s,f=!(null==o||""===String(o));return!!e||!!t||!!l||!!u||d>0||p||f})();if(!String(B||"").trim()||!u&&!d)return void alert("Please add content, or set delegate/metadata/properties/parents/reinscription.");const p=[];1===c.length&&p.push("Parent-Child"),c.length>1&&p.push(`Multi-Parent (${c.length})`),s&&p.push("Reinscription"),n&&p.push("Delegate"),r&&p.push(r),i&&p.push("Metadata"),a&&p.push("Properties"),_&&p.push("Encoding"),L&&!_&&p.push("Brotli"),o&&p.push("Pointer"),D({content:C,contentType:B,contentSize:P,fileName:O,selectedParents:c,reinscriptionTarget:s,delegateId:n,metaprotocol:r,metadata:i,properties:a,contentEncoding:_,compressBeforeInscribe:!!L,pointer:o,recipientAddress:l,repeatCount:$,features:p})},disabled:(()=>{if(e&&"content"===String(t||""))return!0;const l=!!String(B||"").trim(),u=(()=>{if(null==C)return!1;if("string"==typeof C)return C.length>0;if(C instanceof ArrayBuffer)return C.byteLength>0;if("undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(C))return(C.byteLength||0)>0;if("[object ArrayBuffer]"===Object.prototype.toString.call(C))try{return(C.byteLength||0)>0}catch{return!0}return!0})(),d=(()=>{const e=String(n||"").trim(),t=String(r||"").trim(),l=String(i||"").trim(),u=String(a||"").trim(),d=Array.isArray(c)?c.length:0,p=!!s,f=!(null==o||""===String(o));return!!e||!!t||!!l||!!u||d>0||p||f})();return!l||!u&&!d})(),style:{width:"100%",padding:"10px",background:e&&"content"===String(t||"")?"rgba(64, 64, 64, 0.5)":"linear-gradient(to right, #a855f7, #ec4899)",color:"white",border:"none",borderRadius:"8px",fontWeight:600,fontSize:"13px",cursor:"pointer",opacity:(()=>{if(e&&"content"===String(t||""))return.6;const l=!!String(B||"").trim(),u=(()=>{if(null==C)return!1;if("string"==typeof C)return C.length>0;if(C instanceof ArrayBuffer)return C.byteLength>0;if("undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(C))return(C.byteLength||0)>0;if("[object ArrayBuffer]"===Object.prototype.toString.call(C))try{return(C.byteLength||0)>0}catch{return!0}return!0})(),d=(()=>{const e=String(n||"").trim(),t=String(r||"").trim(),l=String(i||"").trim(),u=String(a||"").trim(),d=Array.isArray(c)?c.length:0,p=!!s,f=!(null==o||""===String(o));return!!e||!!t||!!l||!!u||d>0||p||f})();return l&&(u||d)?1:.5})()}},"Add to Batch")):Bc.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"6px 8px",background:"rgba(34,197,94,0.08)",border:"1px solid rgba(34,197,94,0.25)",borderRadius:"8px"}},Bc.createElement("div",null,Bc.createElement("div",{style:{fontSize:"12px",fontWeight:600,color:"#86efac"}},"Batch: ",z.length," item",1!==z.length?"s":""),Bc.createElement("div",{style:{fontSize:"10px",color:"rgba(134,239,172,0.6)"}},"Review to manage")),Bc.createElement("button",{onClick:()=>{if(e&&"content"===String(t||""))return;const u=(()=>{if(null==C)return!1;if("string"==typeof C)return C.length>0;if(C instanceof ArrayBuffer)return C.byteLength>0;if("undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(C))return(C.byteLength||0)>0;if("[object ArrayBuffer]"===Object.prototype.toString.call(C))try{return(C.byteLength||0)>0}catch{return!0}return!0})(),d=(()=>{const e=String(n||"").trim(),t=String(r||"").trim(),l=String(i||"").trim(),u=String(a||"").trim(),d=Array.isArray(c)?c.length:0,p=!!s,f=!(null==o||""===String(o));return!!e||!!t||!!l||!!u||d>0||p||f})();if(!String(B||"").trim()||!u&&!d)return void alert("Please add content, or set delegate/metadata/properties/parents/reinscription.");const p=[];1===c.length&&p.push("Parent-Child"),c.length>1&&p.push(`Multi-Parent (${c.length})`),s&&p.push("Reinscription"),n&&p.push("Delegate"),r&&p.push(r),i&&p.push("Metadata"),a&&p.push("Properties"),_&&p.push("Encoding"),L&&!_&&p.push("Brotli"),o&&p.push("Pointer"),D({content:C,contentType:B,contentSize:P,fileName:O,selectedParents:c,reinscriptionTarget:s,delegateId:n,metaprotocol:r,metadata:i,properties:a,contentEncoding:_,compressBeforeInscribe:!!L,pointer:o,recipientAddress:l,repeatCount:$,features:p})},disabled:(()=>{if(e&&"content"===String(t||""))return!0;const l=!!String(B||"").trim(),u=(()=>{if(null==C)return!1;if("string"==typeof C)return C.length>0;if(C instanceof ArrayBuffer)return C.byteLength>0;if("undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(C))return(C.byteLength||0)>0;if("[object ArrayBuffer]"===Object.prototype.toString.call(C))try{return(C.byteLength||0)>0}catch{return!0}return!0})(),d=(()=>{const e=String(n||"").trim(),t=String(r||"").trim(),l=String(i||"").trim(),u=String(a||"").trim(),d=Array.isArray(c)?c.length:0,p=!!s,f=!(null==o||""===String(o));return!!e||!!t||!!l||!!u||d>0||p||f})();return!l||!u&&!d})(),style:{padding:"6px 12px",background:e&&"content"===String(t||"")?"rgba(64, 64, 64, 0.5)":"#a855f7",color:"white",border:"none",borderRadius:"6px",fontWeight:600,fontSize:"12px",cursor:"pointer",opacity:(()=>{if(e&&"content"===String(t||""))return.6;const l=!!String(B||"").trim(),u=(()=>{if(null==C)return!1;if("string"==typeof C)return C.length>0;if(C instanceof ArrayBuffer)return C.byteLength>0;if("undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(C))return(C.byteLength||0)>0;if("[object ArrayBuffer]"===Object.prototype.toString.call(C))try{return(C.byteLength||0)>0}catch{return!0}return!0})(),d=(()=>{const e=String(n||"").trim(),t=String(r||"").trim(),l=String(i||"").trim(),u=String(a||"").trim(),d=Array.isArray(c)?c.length:0,p=!!s,f=!(null==o||""===String(o));return!!e||!!t||!!l||!!u||d>0||p||f})();return l&&(u||d)?1:.5})()}},"Add"))))}const dA=.1,pA=[{label:"Low",value:5},{label:"Balanced",value:15},{label:"Priority",value:35}],fA=e=>"number"==typeof e&&!Number.isNaN(e),mA=e=>fA(e)?e.toLocaleString():"\u2014",gA=({label:e,helper:t,value:n,accent:r=!1})=>Bc.createElement("div",{className:"flex items-baseline justify-between gap-2 rounded-sm border border-neutral-800/70 bg-neutral-900/40 px-1.5 py-1"},Bc.createElement("div",{className:"min-w-0 flex-1"},Bc.createElement("p",{className:"text-[10px] uppercase tracking-wide text-neutral-500 truncate"},e),t&&Bc.createElement("p",{className:"text-[10px] text-neutral-500 truncate"},t)),Bc.createElement("p",{className:"text-xs font-semibold whitespace-nowrap shrink-0 "+(r?"text-fuchsia-200":"text-neutral-100")},mA(n),Bc.createElement("span",{className:"ml-1 text-[10px] font-normal text-neutral-500"},"sats")));function hA({feeRate:e=null,onFeeRateChange:t,feeEstimate:n,contentSize:r=0,feeRates:i=null,feeItemCount:a=1,onSubmit:o,isSubmitting:s=!1,isDisabled:l=!1,isDraftCompressing:c=!1,hideSubmitButton:u=!1}){const[d,p]=Bc.useState(()=>{try{const e=localStorage.getItem("nexus.localBtcRate");if(!e)return"";const t=Number(e);return Number.isFinite(t)&&t>0?String(t):""}catch{return""}}),[f,m]=Bc.useState(!1),[g,h]=Bc.useState(null),b=Bc.useMemo(()=>i&&!i.isDefault&&i.fast?Math.ceil(1.2*i.fast):250,[i]),y=f?5e3:b;Bc.useEffect(()=>{m(!1),h(null)},[b]);const x=Bc.useMemo(()=>{const e=Number(d);return Number.isFinite(e)&&e>0?e:null},[d]),w=Bc.useMemo(()=>i&&i.slow&&i.medium&&i.fast?[{label:"Low",value:i.slow,apiLabel:"~1 hour"},{label:"Balanced",value:i.medium,apiLabel:"~30 min"},{label:"Priority",value:i.fast,apiLabel:"~10 min"}]:pA,[i]),v=fA(n?.commitFee)?n.commitFee:null,S=fA(n?.revealFee)?n.revealFee:null,E=fA(n?.commitSize)?n.commitSize:void 0,N=fA(n?.revealSize)?n.revealSize:void 0,I=fA(n?.postage)?n.postage:fA(n?.inscriptionPostage)?n.inscriptionPostage:null,A=fA(n?.dustAdjustment)?n.dustAdjustment:0,k=fA(v)||fA(S),T=k?(v??0)+(S??0):null,C=(S??0)+(I??0),B=fA(n?.revealFunding)?n.revealFunding:k||fA(I)?C:null,P=Bc.useMemo(()=>{if(fA(n?.itemCount))return Math.max(1,Math.floor(n.itemCount));const e=Number(a);return Number.isFinite(e)&&e>0?Math.floor(e):1},[n?.itemCount,a]),_=Bc.useMemo(()=>{try{return Xn(P)}catch{return[]}},[P]),O=Bc.useMemo(()=>{try{return Kn(P)}catch{return 0}},[P]),L=Bc.useMemo(()=>{const e=new Map;for(const t of _){const n=`${t.purpose}:${t.address}:${t.description}`,r=e.get(n);r?(r.value+=t.value,r.count+=1):e.set(n,{...t,count:1})}return Array.from(e.values())},[_]),F=fA(n?.totalRequired)?n.totalRequired:fA(B)||fA(v)?(v??0)+(B??0)+O:null,M=fA(R=F)?(R/1e8).toFixed(8):null;var R;const $=Bc.useMemo(()=>fA(F)&&x?F/1e8*x:null,[F,x]),U=fA(n?.parentCount)?n.parentCount:0,z=I,D=r?`${r.toLocaleString()} bytes \u2022 ${(r/1024).toFixed(2)} KB`:"Add content to calculate fees",H=e=>{if(!t)return;if(null==e||""===String(e).trim())return t(null),void h(null);const n=Number(e);if(!Number.isFinite(n))return;const r=Math.max(dA,Math.min(5e3,n));if(r>b&&!f)return h(r),void t(r);h(null),t(r)},W=Boolean(n),j=i&&!i.isDefault,V=i?.isDefault||!i,q=j,X=Bc.useMemo(()=>fA(e)?e:null,[e]);return Bc.createElement("aside",{className:"flex h-full min-h-0 flex-col rounded-xl border border-neutral-800/60 bg-neutral-950/80 backdrop-blur overflow-hidden"},Bc.createElement("header",{className:"flex items-start justify-between border-b border-neutral-800/70 px-2 py-1.5 shrink-0"},Bc.createElement("div",{className:"min-w-0"},Bc.createElement("div",{className:"flex items-center gap-2"},Bc.createElement("p",{className:"text-sm font-semibold text-neutral-100"},"Fee estimator"),j?Bc.createElement("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-green-500/10 text-green-400 border border-green-500/30"},"Live"):V?Bc.createElement("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-yellow-500/10 text-yellow-400 border border-yellow-500/30"},"Manual"):null),Bc.createElement("p",{className:"text-[11px] text-neutral-500"},D),c&&Bc.createElement("p",{className:"text-[10px] text-fuchsia-200 mt-1"},"Brotli: compressing\u2026 updating fee estimate"),U>0&&Bc.createElement("p",{className:"text-[10px] text-neutral-500"},"Parents selected: ",U),V&&Bc.createElement("p",{className:"text-[10px] text-yellow-400 mt-1"},"Enter your own fee rate \u2014 no confirmed rates available"),Bc.createElement("p",{className:"text-[10px] text-neutral-500 mt-1"},"Minimum fee rate enforced: ",dA," sat/vB"))),Bc.createElement("div",{className:"flex-1 min-h-0 overflow-y-auto"},Bc.createElement("div",{className:"px-2 py-1.5"},Bc.createElement("label",{className:"text-[11px] font-semibold uppercase tracking-wide text-neutral-500"},q?"Adjust fee rate":"Enter fee rate (sat/vB)"),Bc.createElement("input",{type:"number",min:dA,max:y,step:"0.1",value:e??"",onChange:e=>H(e.target.value),className:"mt-1.5 w-full rounded-md bg-neutral-900 border px-2 py-1 text-sm font-semibold text-neutral-200 focus:outline-none focus:ring-1 "+(g&&!f?"border-amber-500 focus:border-amber-500 focus:ring-amber-500":"border-neutral-800 focus:border-fuchsia-500 focus:ring-fuchsia-500"),placeholder:null===e?"Waiting for API or enter manually (min 0.1)":"Enter sat/vB"}),g&&!f&&Bc.createElement("div",{className:"mt-2 rounded-md border border-amber-500/50 bg-amber-500/10 px-2.5 py-2"},Bc.createElement("div",{className:"flex items-start gap-2"},Bc.createElement("span",{className:"text-amber-400 text-sm shrink-0 mt-0.5"},"\u26a0\ufe0f"),Bc.createElement("div",{className:"min-w-0 flex-1"},Bc.createElement("p",{className:"text-[11px] font-semibold text-amber-200"},"Fee rate exceeds network conditions"),Bc.createElement("p",{className:"text-[10px] text-amber-300/80 mt-0.5"},g," sat/vB is more than 20% above the current fastest rate (",i?.fast||"\u2014"," sat/vB). Dynamic ceiling: ",b," sat/vB."),Bc.createElement("div",{className:"flex gap-2 mt-1.5"},Bc.createElement("button",{type:"button",onClick:()=>{m(!0),h(null)},className:"text-[10px] px-2.5 py-1 rounded border border-amber-500/50 bg-amber-500/20 text-amber-100 font-semibold hover:bg-amber-500/30 transition-colors"},"Approve higher fee"),Bc.createElement("button",{type:"button",onClick:()=>{h(null),H(b)},className:"text-[10px] px-2.5 py-1 rounded border border-neutral-700 bg-neutral-800/60 text-neutral-300 font-medium hover:bg-neutral-700/60 transition-colors"},"Use ",b," sat/vB"))))),f&&e>b&&Bc.createElement("div",{className:"mt-1.5 flex items-center gap-1.5 text-[10px] text-amber-400"},Bc.createElement("span",null,"\u26a0\ufe0f"),Bc.createElement("span",null,"High fee approved \u2014 above dynamic ceiling of ",b," sat/vB"),Bc.createElement("button",{type:"button",onClick:()=>{m(!1),H(b)},className:"ml-auto text-[9px] px-1.5 py-0.5 rounded border border-neutral-700 bg-neutral-800/60 text-neutral-400 hover:text-neutral-200 transition-colors"},"Reset")),q&&Bc.createElement(Bc.Fragment,null,Bc.createElement("input",{type:"range",min:dA,max:y,step:"0.1",value:X??dA,onChange:e=>H(e.target.value),className:"mt-1.5 h-1.5 w-full cursor-pointer appearance-none rounded-full bg-neutral-800 accent-fuchsia-500"}),Bc.createElement("div",{className:"mt-1.5 flex flex-wrap gap-1.5 sm:gap-2"},w.map(e=>{const t=fA(X)&&Math.abs(X-e.value)<1e-9;return Bc.createElement("button",{key:e.label,type:"button",onClick:()=>H(e.value),className:"flex flex-1 min-w-[80px] flex-col items-center justify-center rounded-md border px-1.5 sm:px-2 py-1 sm:py-1.5 text-xs font-medium transition-colors touch-manipulation "+(t?"border-fuchsia-400/70 bg-fuchsia-500/10 text-fuchsia-100":"border-neutral-800/60 bg-neutral-900/60 text-neutral-300 hover:border-neutral-700 hover:bg-neutral-800")},Bc.createElement("span",null,e.label),Bc.createElement("span",{className:"text-[11px] text-neutral-400"},e.value," sat/vB"),e.apiLabel&&Bc.createElement("span",{className:"text-[10px] text-neutral-500"},e.apiLabel))})))),Bc.createElement("div",{className:"px-2 pb-1"},W?Bc.createElement("div",{className:"space-y-1.5"},Bc.createElement(gA,{label:"Commit transaction",helper:E?`${E} vB`:void 0,value:v}),Bc.createElement(gA,{label:"Reveal transaction",helper:N?`${N} vB`:void 0,value:S}),"number"==typeof z&&z>0&&Bc.createElement(gA,{label:"Postage",value:z}),Bc.createElement(gA,{label:"Network fees",value:T,accent:!0}),Bc.createElement(gA,{label:"Reveal funding",value:B}),L.map((e,t)=>Bc.createElement(gA,{key:`${e.purpose}-${t}`,label:e.count>1?`${e.description} (x${e.count})`:e.description,helper:"platform-fee"===e.purpose?"Platform":"developer-fee"===e.purpose?"Developer":"Custom",value:e.value})),A>0&&Bc.createElement("div",{className:"rounded-md border border-amber-400/40 bg-amber-500/10 px-2 py-1 text-[10px] text-amber-200"},"Added ",mA(A)," sats to satisfy Taproot dust limits.")):Bc.createElement("div",{className:"flex flex-col items-center justify-center rounded-lg border border-dashed border-neutral-800/60 bg-neutral-900/40 px-3 py-4 text-center text-sm text-neutral-400"},Bc.createElement("p",null,"Add inscription content to generate an exact fee breakdown."),Bc.createElement("p",{className:"mt-1 text-xs text-neutral-500"},"Adjust the fee rate now and we'll apply it once content is ready.")),W&&(E>1e5||N>1e5)&&Bc.createElement("div",{className:"mt-1.5 rounded-md border border-amber-500/50 bg-amber-500/10 px-2 py-1.5"},Bc.createElement("div",{className:"flex items-start gap-1.5"},Bc.createElement("span",{className:"text-amber-400 text-sm shrink-0"},"\u26a0\ufe0f"),Bc.createElement("div",{className:"min-w-0"},Bc.createElement("p",{className:"text-[11px] font-semibold text-amber-200"},"Transaction exceeds standard relay limit"),Bc.createElement("p",{className:"text-[10px] text-amber-300/80 mt-0.5"},E>1e5?`Commit: ${E?.toLocaleString()} vB`:"",E>1e5&&N>1e5?" \xb7 ":"",N>1e5?`Reveal: ${N?.toLocaleString()} vB`:""," ","(limit: 100,000 vB / 400 KB). Regular Bitcoin nodes will reject this. After signing, you'll receive the raw transaction to submit via"," ",Bc.createElement("strong",null,"MARA Slipstream")," or similar service."))))),W&&Bc.createElement("div",{className:"border-t border-neutral-800/70 px-2 py-1.5"},Bc.createElement("div",{className:"rounded-md border border-fuchsia-500/40 bg-fuchsia-500/10 px-2 py-1.5"},Bc.createElement("p",{className:"text-xs uppercase tracking-wide text-fuchsia-200"},"Total required"),Bc.createElement("div",{className:"mt-1 flex flex-wrap items-baseline justify-between gap-1"},Bc.createElement("span",{className:"text-base sm:text-lg font-semibold text-fuchsia-100"},mA(F),Bc.createElement("span",{className:"ml-1 text-xs sm:text-sm font-medium text-fuchsia-200"},"sats")),M&&Bc.createElement("span",{className:"text-[11px] text-fuchsia-200"},"\u2248 ",M," BTC")),Bc.createElement("div",{className:"mt-2"},Bc.createElement("label",{className:"text-[11px] font-semibold uppercase tracking-wide text-neutral-500"},"Local rate (1 BTC =)"),Bc.createElement("input",{type:"number",min:0,step:"0.01",value:d,onChange:e=>(e=>{const t=String(e??"").trim();p(t);try{const e=Number(t);Number.isFinite(e)&&e>0?localStorage.setItem("nexus.localBtcRate",String(e)):localStorage.removeItem("nexus.localBtcRate")}catch{}})(e.target.value),className:"mt-1.5 w-full rounded-md bg-neutral-900 border border-neutral-800 px-2 py-1 text-sm font-semibold text-neutral-200 focus:border-fuchsia-500 focus:outline-none focus:ring-1 focus:ring-fuchsia-500",placeholder:"Enter your local BTC price"}),null!==$&&Bc.createElement("p",{className:"mt-2 text-[11px] text-fuchsia-200"},"\u2248 ",new Intl.NumberFormat(void 0,{maximumFractionDigits:2}).format($)," local"))))),!u&&Bc.createElement("div",{className:"border-t border-neutral-800/70 px-2 py-1.5 pb-[calc(env(safe-area-inset-bottom,0px)+0.25rem)]"},Bc.createElement("button",{onClick:o,disabled:l||s,className:`\n              w-full px-3 py-2.5 sm:py-1.5 rounded-md font-semibold text-sm transition-all duration-200 touch-manipulation\n              ${l||s?"bg-neutral-800/50 text-neutral-500 cursor-not-allowed border border-neutral-700/30":"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white shadow-lg shadow-purple-500/30 hover:shadow-purple-500/50"}\n            `},s?"Inscribing...":"Create Inscription")))}function bA({type:e="info",message:t,onClose:n,autoDismiss:r=!0}){Bc.useEffect(()=>{if(r&&n){const e=setTimeout(n,5e3);return()=>clearTimeout(e)}},[r,n]);const i={error:{bg:"bg-red-500/90",border:"border-red-400/30",icon:"\u274c"},success:{bg:"bg-green-500/90",border:"border-green-400/30",icon:"\u2705"},info:{bg:"bg-blue-500/90",border:"border-blue-400/30",icon:"\u2139\ufe0f"}},a=i[e]||i.info;return Bc.createElement("div",{className:"fixed top-16 sm:top-20 left-2 right-2 sm:left-5 sm:right-5 z-[9800] animate-slide-down",style:{paddingBottom:"env(safe-area-inset-bottom, 0px)"}},Bc.createElement("div",{className:`\n        ${a.bg} ${a.border}\n        backdrop-blur-md border rounded-xl p-3 sm:p-4 shadow-2xl\n        flex items-start gap-2 sm:gap-3\n        max-w-lg mx-auto\n      `},Bc.createElement("span",{className:"text-base sm:text-lg flex-shrink-0"},a.icon),Bc.createElement("div",{className:"flex-1 text-white text-xs sm:text-sm font-medium leading-relaxed min-w-0 break-words"},t),n&&Bc.createElement("button",{onClick:n,className:"flex-shrink-0 text-white/70 hover:text-white transition-colors p-1 touch-manipulation","aria-label":"Dismiss"},"\u2715")))}function yA({text:e,label:t="Copy"}){const[n,r]=Bc.useState(!1);return Pc.createElement("button",{onClick:()=>{navigator.clipboard.writeText(e).then(()=>{r(!0),setTimeout(()=>r(!1),2e3)})},className:"px-3 py-1 rounded text-xs font-medium transition-colors shrink-0 "+(n?"bg-green-600 text-white":"bg-gray-600 hover:bg-gray-500 text-white")},n?"\u2713 Copied":t)}function xA({result:e,onClose:t}){const n=[{label:"Commit Transaction",hex:e.commitTxHex},...(e.revealTxHexes||[]).map((e,t)=>({label:`Reveal Transaction #${t+1}`,hex:e}))].filter(e=>e.hex),[r,i]=Bc.useState(null);return Pc.createElement("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-end sm:items-center justify-center z-[9500] p-0 sm:p-4"},Pc.createElement("div",{className:"bg-gray-800 rounded-t-2xl sm:rounded-lg max-w-2xl w-full mx-0 sm:mx-4 max-h-[90dvh] max-h-[90vh] flex flex-col",style:{paddingBottom:"env(safe-area-inset-bottom, 0px)"}},Pc.createElement("div",{className:"p-4 sm:p-6 pb-0 overflow-y-auto flex-1 min-h-0"},Pc.createElement("div",{className:"flex items-center justify-between mb-4 gap-2"},Pc.createElement("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0"},Pc.createElement("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-amber-600 rounded-full flex items-center justify-center shrink-0"},Pc.createElement("span",{className:"text-xl"},"\u26a0\ufe0f")),Pc.createElement("div",{className:"min-w-0"},Pc.createElement("h2",{className:"text-base sm:text-xl font-bold text-white truncate"},"Transaction Too Large for Standard Relay"),Pc.createElement("p",{className:"text-xs sm:text-sm text-amber-300"},"Signed successfully \u2014 manual broadcast required"))),Pc.createElement("button",{onClick:t,className:"text-gray-400 hover:text-white transition-colors shrink-0"},Pc.createElement("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Pc.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})))),Pc.createElement("div",{className:"mb-4 p-4 bg-amber-900/30 border border-amber-600/50 rounded-lg"},Pc.createElement("div",{className:"flex items-start gap-3"},Pc.createElement("svg",{className:"w-5 h-5 text-amber-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},Pc.createElement("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})),Pc.createElement("div",{className:"text-sm text-amber-200 space-y-2"},Pc.createElement("p",null,Pc.createElement("strong",{className:"text-amber-100"},"Transaction exceeds 400 KB standard relay limit")),Pc.createElement("p",{className:"text-xs text-amber-300"},"Bitcoin Core nodes reject non-standard transactions above 400 KB via regular relay. Your transaction was fully signed but ",Pc.createElement("strong",null,"not broadcast"),". You must submit it manually using a non-standard relay service."),e.oversizedDetails&&Pc.createElement("div",{className:"text-xs text-amber-300/80 mt-1"},e.oversizedDetails.map((e,t)=>Pc.createElement("span",{key:t,className:"inline-block mr-3"},e.label,": ",Pc.createElement("strong",null,e.sizeKB," KB"))))))),Pc.createElement("div",{className:"mb-4"},Pc.createElement("h3",{className:"text-sm font-semibold text-white mb-2 flex items-center gap-2"},Pc.createElement("span",null,"\ud83d\ude80")," Submit via Non-Standard Relay"),Pc.createElement("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2"},Pc.createElement("a",{href:"https://slipstream.mara.com",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-3 p-3 bg-purple-900/30 border border-purple-600/40 rounded-lg hover:bg-purple-900/50 transition-colors"},Pc.createElement("div",{className:"min-w-0"},Pc.createElement("div",{className:"text-sm font-semibold text-purple-200"},"MARA Slipstream"),Pc.createElement("div",{className:"text-[10px] text-purple-300/70"},"Non-standard tx submission")),Pc.createElement("svg",{className:"w-4 h-4 text-purple-400 shrink-0 ml-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Pc.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"}))),Pc.createElement("a",{href:"https://mempool.space/tx/push",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-3 p-3 bg-blue-900/30 border border-blue-600/40 rounded-lg hover:bg-blue-900/50 transition-colors"},Pc.createElement("div",{className:"min-w-0"},Pc.createElement("div",{className:"text-sm font-semibold text-blue-200"},"Mempool.space"),Pc.createElement("div",{className:"text-[10px] text-blue-300/70"},"Broadcast raw transaction")),Pc.createElement("svg",{className:"w-4 h-4 text-blue-400 shrink-0 ml-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Pc.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"}))))),Pc.createElement("div",{className:"space-y-3 mb-4"},Pc.createElement("h3",{className:"text-sm font-semibold text-white flex items-center gap-2"},Pc.createElement("span",null,"\ud83d\udccb")," Signed Transaction",n.length>1?"s":""," (Raw Hex)"),Pc.createElement("p",{className:"text-[10px] text-gray-400 -mt-1"},"\u26a0\ufe0f Transactions must be broadcast ",Pc.createElement("strong",null,"in order")," \u2014 commit first, then reveal(s). Each reveal depends on the commit being confirmed or in the mempool."),n.map((e,t)=>{const n=r===t,a=(e.hex.length/2/1e3).toFixed(1);return Pc.createElement("div",{key:t,className:"bg-gray-700 rounded-lg overflow-hidden"},Pc.createElement("div",{className:"flex items-center justify-between p-3 gap-2"},Pc.createElement("div",{className:"min-w-0"},Pc.createElement("div",{className:"text-xs font-semibold text-gray-200"},e.label),Pc.createElement("div",{className:"text-[10px] text-gray-400 font-mono"},a," KB \xb7 ",(e.hex.length/2).toLocaleString()," bytes")),Pc.createElement("div",{className:"flex items-center gap-2 shrink-0"},Pc.createElement(yA,{text:e.hex,label:"Copy Hex"}),Pc.createElement("button",{onClick:()=>i(n?null:t),className:"px-2 py-1 bg-gray-600 hover:bg-gray-500 rounded text-xs text-white transition-colors"},n?"Hide":"Show"))),n&&Pc.createElement("div",{className:"px-3 pb-3"},Pc.createElement("textarea",{readOnly:!0,value:e.hex,rows:6,className:"w-full bg-gray-900 text-[10px] text-gray-300 font-mono p-2 rounded border border-gray-600 resize-y",onFocus:e=>e.target.select()})))})),Pc.createElement("div",{className:"p-4 bg-blue-900/30 border border-blue-700 rounded-lg"},Pc.createElement("div",{className:"flex items-start gap-3"},Pc.createElement("svg",{className:"w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},Pc.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})),Pc.createElement("div",{className:"text-sm text-blue-200 space-y-2"},Pc.createElement("p",null,Pc.createElement("strong",{className:"text-blue-100"},"How to submit")),Pc.createElement("ol",{className:"list-decimal list-inside space-y-1 text-xs text-blue-300"},Pc.createElement("li",null,"Copy the ",Pc.createElement("strong",null,"Commit Transaction")," hex and submit it first"),Pc.createElement("li",null,"Wait for it to appear in the mempool (usually seconds)"),Pc.createElement("li",null,"Copy each ",Pc.createElement("strong",null,"Reveal Transaction")," hex and submit in order"),Pc.createElement("li",null,"MARA Slipstream accepts non-standard transactions that regular nodes reject")))))),Pc.createElement("div",{className:"p-4 sm:px-6 sm:pb-6 pt-3 border-t border-gray-700 flex flex-col sm:flex-row gap-2 sm:gap-3 shrink-0"},Pc.createElement("button",{onClick:()=>{const e=n.map(e=>`--- ${e.label} ---\n${e.hex}`).join("\n\n");navigator.clipboard.writeText(e)},className:"flex-1 px-4 py-3 sm:py-2 bg-amber-600 hover:bg-amber-700 text-white rounded-lg font-medium transition-colors text-sm sm:text-base"},"Copy All Transactions"),Pc.createElement("a",{href:"https://slipstream.mara.com",target:"_blank",rel:"noopener noreferrer",className:"px-4 py-3 sm:py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-medium transition-colors flex items-center justify-center gap-2 text-sm sm:text-base"},"Open MARA Slipstream",Pc.createElement("svg",{className:"w-4 h-4 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Pc.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"}))),Pc.createElement("button",{onClick:t,className:"px-4 py-3 sm:py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg font-medium transition-colors text-sm sm:text-base"},"Close"))))}function wA({result:e,onClose:t}){if(!e)return null;if(e.oversizedTx)return Pc.createElement(xA,{result:e,onClose:t});const n=Array.isArray(e.revealTxIds)?e.revealTxIds:e.revealTxId?[e.revealTxId]:[],r=n.length>1,i=n[0]||"",a=e.inscriptionId||(i?`${i}i0`:"");return Pc.createElement("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-end sm:items-center justify-center z-[9500] p-0 sm:p-4"},Pc.createElement("div",{className:"bg-gray-800 rounded-t-2xl sm:rounded-lg max-w-2xl w-full mx-0 sm:mx-4 max-h-[90dvh] max-h-[90vh] flex flex-col",style:{paddingBottom:"env(safe-area-inset-bottom, 0px)"}},Pc.createElement("div",{className:"p-4 sm:p-6 pb-0 overflow-y-auto flex-1 min-h-0"},Pc.createElement("div",{className:"flex items-center justify-between mb-4 gap-2"},Pc.createElement("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0"},Pc.createElement("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-green-600 rounded-full flex items-center justify-center shrink-0"},Pc.createElement("svg",{className:"w-5 h-5 sm:w-6 sm:h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Pc.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"}))),Pc.createElement("div",{className:"min-w-0"},Pc.createElement("h2",{className:"text-base sm:text-xl font-bold text-white truncate"},r?"Batch Inscription Created!":"Inscription Created!"),Pc.createElement("p",{className:"text-xs sm:text-sm text-gray-400"},r?`${n.length} inscriptions successfully broadcast`:"Your inscription has been successfully broadcast"))),Pc.createElement("button",{onClick:t,className:"text-gray-400 hover:text-white transition-colors"},Pc.createElement("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Pc.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})))),Pc.createElement("div",{className:"mb-4 p-4 bg-gray-700 rounded-lg"},Pc.createElement("div",{className:"flex items-center justify-between mb-2"},Pc.createElement("h3",{className:"text-sm font-semibold text-orange-400 flex items-center gap-2"},Pc.createElement("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},Pc.createElement("path",{d:"M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"}),Pc.createElement("path",{fillRule:"evenodd",d:"M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z",clipRule:"evenodd"})),"Commit Transaction"),Pc.createElement("span",{className:"text-xs text-gray-400 bg-gray-600 px-2 py-1 rounded"},"Step 1/2")),Pc.createElement("div",{className:"flex items-center gap-2 mb-2"},Pc.createElement("code",{className:"text-xs text-gray-300 bg-gray-800 px-2 py-1 rounded flex-1 overflow-x-auto break-all"},e.commitTxId),Pc.createElement("button",{onClick:()=>navigator.clipboard.writeText(e.commitTxId),className:"px-3 py-1 bg-gray-600 hover:bg-gray-500 rounded text-xs text-white transition-colors"},"Copy")),Pc.createElement("a",{href:Tt(`/tx/${e.commitTxId}`),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-sm text-blue-400 hover:text-blue-300 transition-colors"},"View on Mempool.space",Pc.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Pc.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})))),r?Pc.createElement("div",{className:"space-y-3"},Pc.createElement("h3",{className:"text-sm font-semibold text-green-400 flex items-center gap-2"},Pc.createElement("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},Pc.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})),"Reveal Transactions (",n.length,")"),Pc.createElement("div",{className:"max-h-64 overflow-y-auto space-y-2"},n.map((e,t)=>Pc.createElement("div",{key:e,className:"p-3 bg-gray-700 rounded-lg"},Pc.createElement("div",{className:"flex items-center justify-between mb-2"},Pc.createElement("span",{className:"text-xs text-gray-400"},"Reveal #",t+1),Pc.createElement("span",{className:"text-xs text-green-400 bg-green-900 bg-opacity-30 px-2 py-1 rounded"},"Step 2/2")),Pc.createElement("div",{className:"flex items-center gap-2 mb-2"},Pc.createElement("code",{className:"text-xs text-gray-300 bg-gray-800 px-2 py-1 rounded flex-1 overflow-x-auto break-all"},e),Pc.createElement("button",{onClick:()=>navigator.clipboard.writeText(e),className:"px-2 py-1 bg-gray-600 hover:bg-gray-500 rounded text-xs text-white transition-colors"},"Copy")),Pc.createElement("a",{href:Tt(`/tx/${e}`),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-sm text-blue-400 hover:text-blue-300 transition-colors"},"View on Mempool.space",Pc.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Pc.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"}))))))):Pc.createElement("div",{className:"p-4 bg-gray-700 rounded-lg"},Pc.createElement("div",{className:"flex items-center justify-between mb-2"},Pc.createElement("h3",{className:"text-sm font-semibold text-green-400 flex items-center gap-2"},Pc.createElement("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},Pc.createElement("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})),"Reveal Transaction (Inscription)"),Pc.createElement("span",{className:"text-xs text-green-400 bg-green-900 bg-opacity-30 px-2 py-1 rounded"},"Step 2/2")),Pc.createElement("div",{className:"flex items-center gap-2 mb-2"},Pc.createElement("code",{className:"text-xs text-gray-300 bg-gray-800 px-2 py-1 rounded flex-1 overflow-x-auto break-all"},i),Pc.createElement("button",{onClick:()=>navigator.clipboard.writeText(i),className:"px-3 py-1 bg-gray-600 hover:bg-gray-500 rounded text-xs text-white transition-colors"},"Copy")),Pc.createElement("div",{className:"flex flex-wrap gap-2 sm:gap-3"},Pc.createElement("a",{href:Tt(`/tx/${i}`),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-sm text-blue-400 hover:text-blue-300 transition-colors"},"View Transaction",Pc.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Pc.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"}))),a&&Pc.createElement("a",{href:kt(`/inscription/${a}`),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-sm text-purple-400 hover:text-purple-300 transition-colors"},"View Inscription",Pc.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Pc.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"}))))),Pc.createElement("div",{className:"mt-4 p-4 bg-blue-900 bg-opacity-30 border border-blue-700 rounded-lg"},Pc.createElement("div",{className:"flex items-start gap-3"},Pc.createElement("svg",{className:"w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},Pc.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})),Pc.createElement("div",{className:"text-sm text-blue-200 space-y-2"},Pc.createElement("p",null,Pc.createElement("strong",{className:"text-blue-100"},"Your inscription is being processed")),Pc.createElement("ul",{className:"list-disc list-inside space-y-1 text-xs text-blue-300"},Pc.createElement("li",null,"Transactions are now in the mempool waiting for confirmation"),Pc.createElement("li",null,Pc.createElement("strong",null,"Used UTXOs are temporarily locked")," - they won't appear in the UTXO selector until confirmed"),Pc.createElement("li",null,"Your inscription will appear on ordinals.com after the reveal transaction confirms"),Pc.createElement("li",null,"You can close this modal and create another inscription with remaining UTXOs")))))),Pc.createElement("div",{className:"p-4 sm:px-6 sm:pb-6 pt-3 border-t border-gray-700 flex flex-col sm:flex-row gap-2 sm:gap-3 shrink-0"},Pc.createElement("button",{onClick:t,className:"flex-1 px-4 py-3 sm:py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg font-medium transition-colors text-sm sm:text-base"},"Create Another Inscription"),Pc.createElement("a",{href:Tt(`/tx/${i}`),target:"_blank",rel:"noopener noreferrer",className:"px-4 py-3 sm:py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg font-medium transition-colors flex items-center justify-center gap-2 text-sm sm:text-base"},"Track in Mempool",Pc.createElement("svg",{className:"w-4 h-4 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Pc.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"}))))))}function vA({label:e,txid:t,showExplorer:n=!0}){return t?Pc.createElement("div",{className:"p-4 bg-gray-700 rounded-lg"},Pc.createElement("div",{className:"flex items-center justify-between mb-2"},Pc.createElement("h3",{className:"text-sm font-semibold text-green-400"},e)),Pc.createElement("div",{className:"flex items-center gap-2 mb-2"},Pc.createElement("code",{className:"text-xs text-gray-300 bg-gray-800 px-2 py-1 rounded flex-1 overflow-x-auto break-all"},t),Pc.createElement("button",{onClick:()=>navigator.clipboard.writeText(t),className:"px-3 py-1 bg-gray-600 hover:bg-gray-500 rounded text-xs text-white transition-colors"},"Copy")),n?Pc.createElement("a",{href:Tt(`/tx/${t}`),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-sm text-blue-400 hover:text-blue-300 transition-colors"},"View on Mempool.space",Pc.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Pc.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"}))):null):null}function SA({kind:e,result:t,onClose:n}){if(!t)return null;const r=!1!==t?.broadcasted,i="listing"===e,a="funding"===e,o=i?r?"Listing Broadcast!":"Listing Preview (Not Broadcast)":a?r?"Funding Transaction Broadcast!":"Funding Transaction Preview (Not Broadcast)":r?"Purchase Broadcast!":"Purchase Preview (Not Broadcast)",s=i?[t?.parentOutpointAfterCommit?`outpoint=${String(t.parentOutpointAfterCommit).slice(0,16)}\u2026`:null,t?.sellerListingPsbtHashHex?`offerHash=${String(t.sellerListingPsbtHashHex).slice(0,12)}\u2026`:null].filter(Boolean).join("  "):a?"Payment UTXOs split for Open Store buy":[t?.inferredPriceSats?`price\u2248${t.inferredPriceSats} sats`:null,t?.feeSats?`fee\u2248${t.feeSats} sats`:null].filter(Boolean).join("  "),l=i?[{label:"Listing Commit Transaction",txid:t?.commitTxid},{label:"Listing Reveal Transaction",txid:t?.revealTxid||t?.markerTxid}]:a?[{label:"Funding Transaction",txid:t?.fundingTxid}]:[{label:"Buy Transaction",txid:t?.buyTxid}],c=l.find(e=>e.txid)?.txid||null;return Pc.createElement("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-end sm:items-center justify-center z-[9500] p-0 sm:p-4"},Pc.createElement("div",{className:"bg-gray-800 rounded-t-2xl sm:rounded-lg max-w-2xl w-full mx-0 sm:mx-4 max-h-[90dvh] max-h-[90vh] flex flex-col",style:{paddingBottom:"env(safe-area-inset-bottom, 0px)"}},Pc.createElement("div",{className:"p-4 sm:p-6 pb-0 overflow-y-auto flex-1 min-h-0"},Pc.createElement("div",{className:"flex items-center justify-between mb-4 gap-2"},Pc.createElement("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0"},Pc.createElement("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-green-600 rounded-full flex items-center justify-center shrink-0"},Pc.createElement("svg",{className:"w-5 h-5 sm:w-6 sm:h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Pc.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"}))),Pc.createElement("div",{className:"min-w-0"},Pc.createElement("h2",{className:"text-base sm:text-xl font-bold text-white truncate"},o),Pc.createElement("p",{className:"text-xs sm:text-sm text-gray-400 truncate"},s||"Your transaction has been successfully broadcast"))),Pc.createElement("button",{onClick:n,className:"text-gray-400 hover:text-white transition-colors shrink-0"},Pc.createElement("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Pc.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})))),Pc.createElement("div",{className:"space-y-3"},l.map(e=>Pc.createElement(vA,{key:`${e.label}:${e.txid||"none"}`,label:e.label,txid:e.txid,showExplorer:r}))),Pc.createElement("div",{className:"mt-4 p-4 bg-blue-900 bg-opacity-30 border border-blue-700 rounded-lg"},Pc.createElement("div",{className:"flex items-start gap-3"},Pc.createElement("svg",{className:"w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},Pc.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})),Pc.createElement("div",{className:"text-sm text-blue-200 space-y-2"},Pc.createElement("p",null,Pc.createElement("strong",{className:"text-blue-100"},r?"Broadcast complete":"Preview complete")),Pc.createElement("ul",{className:"list-disc list-inside space-y-1 text-xs text-blue-300"},r?Pc.createElement(Pc.Fragment,null,Pc.createElement("li",null,"Transactions may take a moment to appear on explorers"),Pc.createElement("li",null,"Used UTXOs may be temporarily locked until confirmation")):Pc.createElement(Pc.Fragment,null,Pc.createElement("li",null,"No transactions were broadcast"),Pc.createElement("li",null,"Txids shown are computed from the finalized PSBTs"))))))),Pc.createElement("div",{className:"p-4 sm:px-6 sm:pb-6 pt-3 border-t border-gray-700 flex flex-col sm:flex-row gap-2 sm:gap-3 shrink-0"},Pc.createElement("button",{onClick:n,className:"flex-1 px-4 py-3 sm:py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg font-medium transition-colors text-sm sm:text-base"},"Close"),r&&c?Pc.createElement("a",{href:Tt(`/tx/${c}`),target:"_blank",rel:"noopener noreferrer",className:"px-4 py-3 sm:py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg font-medium transition-colors flex items-center justify-center gap-2 text-sm sm:text-base"},"Track in Mempool",Pc.createElement("svg",{className:"w-4 h-4 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Pc.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"}))):null)))}const EA=[{id:"editor",icon:"\u270f\ufe0f",label:"Content",step:1},{id:"options",icon:"\u2699\ufe0f",label:"Advanced Options",step:2},{id:"review",icon:"\ud83d\udccb",label:"Review",step:3},{id:"fees",icon:"\ud83d\udcb0",label:"Fees",step:4}];function NA({activePanel:e="editor",onPanelChange:t,visiblePanels:n=["editor","options","review","fees"],swipeContainerRef:r}){const i=()=>{if("undefined"==typeof window)return!1;if(window.matchMedia("(min-width: 1024px)").matches)return!1;const e="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent:"",t=/Android|iPhone|iPad|iPod/i.test(e),n=window.matchMedia("(pointer: coarse)").matches,r=window.matchMedia("(hover: none)").matches,i="undefined"!=typeof navigator&&"number"==typeof navigator.maxTouchPoints&&navigator.maxTouchPoints>0;return t||n&&(r||i)};Bc.useRef({startX:0,startY:0,startTime:0});const[a,o]=Bc.useState(()=>i()),s=EA.filter(e=>n.includes(e.id)),l=s.findIndex(t=>t.id===e),c=s.length<=1||!a,u=l<=0,d=l>=s.length-1,p=Bc.useCallback(e=>{t&&t(e)},[t]),f=Bc.useCallback(()=>{const t=s.findIndex(t=>t.id===e);t<s.length-1&&p(s[t+1].id)},[e,s,p]),m=Bc.useCallback(()=>{const t=s.findIndex(t=>t.id===e);t>0&&p(s[t-1].id)},[e,s,p]);if(Bc.useEffect(()=>{if("undefined"==typeof window)return;const e=window.matchMedia("(min-width: 1024px)"),t=window.matchMedia("(pointer: coarse)"),n=window.matchMedia("(hover: none)"),r=()=>o(i());return r(),e.addEventListener?.("change",r),t.addEventListener?.("change",r),n.addEventListener?.("change",r),window.addEventListener("resize",r),()=>{e.removeEventListener?.("change",r),t.removeEventListener?.("change",r),n.removeEventListener?.("change",r),window.removeEventListener("resize",r)}},[]),c)return null;s[l]||s[0];const g=s.length,h=l+1;return Pc.createElement("nav",{className:"lg:hidden shrink-0 z-[100] flex flex-col border-t border-neutral-800/70 bg-neutral-950/95 backdrop-blur-md pb-[calc(env(safe-area-inset-bottom,0px)+0.25rem)]",role:"navigation","aria-label":"Inscription step navigation"},Pc.createElement("div",{className:"px-3 pt-2.5 pb-1"},Pc.createElement("div",{className:"flex items-center justify-between mb-1.5"},s.map((e,t)=>{const n=t<l,r=t===l;return Pc.createElement(Pc.Fragment,{key:e.id},t>0&&Pc.createElement("div",{className:"flex-1 h-0.5 mx-0.5 rounded-full transition-colors duration-300 "+(t<=l?"bg-purple-500":"bg-neutral-800")}),Pc.createElement("div",{className:"flex flex-col items-center min-w-0"},Pc.createElement("div",{className:`\n                      w-7 h-7 rounded-full flex items-center justify-center text-[11px] font-bold\n                      transition-all duration-200 shrink-0\n                      ${n?"bg-purple-500 text-white":r?"bg-purple-500/20 text-purple-300 ring-2 ring-purple-500":"bg-neutral-800 text-neutral-500"}\n                    `},n?"\u2713":e.step),Pc.createElement("span",{className:`\n                      text-[8px] mt-0.5 text-center leading-tight whitespace-nowrap\n                      ${r?"text-purple-300 font-semibold":n?"text-purple-400/70":"text-neutral-600"}\n                    `},e.label)))}))),Pc.createElement("div",{className:"flex items-center gap-2 px-3 pt-1 pb-1.5"},Pc.createElement("button",{onClick:m,disabled:u,"aria-label":"Previous step",className:`\n            flex items-center gap-1.5 px-4 py-2.5 rounded-lg text-sm font-medium\n            transition-all duration-150 touch-manipulation\n            ${u?"bg-neutral-800/40 text-neutral-600 cursor-not-allowed":"bg-neutral-800 text-neutral-200 active:bg-neutral-700 hover:bg-neutral-700"}\n          `},Pc.createElement("svg",{className:"w-4 h-4",viewBox:"0 0 20 20",fill:"currentColor"},Pc.createElement("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z",clipRule:"evenodd"})),"Previous"),Pc.createElement("div",{className:"flex-1 text-center"},Pc.createElement("span",{className:"text-[11px] text-neutral-400"},h," / ",g)),Pc.createElement("button",{onClick:f,disabled:d,"aria-label":"Next step",className:`\n            flex items-center gap-1.5 px-4 py-2.5 rounded-lg text-sm font-medium\n            transition-all duration-150 touch-manipulation\n            ${d?"bg-neutral-800/40 text-neutral-600 cursor-not-allowed":"bg-purple-600 text-white active:bg-purple-700 hover:bg-purple-500"}\n          `},"Next",Pc.createElement("svg",{className:"w-4 h-4",viewBox:"0 0 20 20",fill:"currentColor"},Pc.createElement("path",{fillRule:"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z",clipRule:"evenodd"})))))}function IA({children:e,className:t="",style:n,onClick:r,title:i,role:a,tabIndex:o,...s}){const l="function"==typeof r;return Pc.createElement("div",{className:`nexus-wizard-card${l?" nexus-wizard-card--clickable":""}${t?` ${t}`:""}`,style:n,onClick:r,title:i,role:a,tabIndex:o,...s},e)}function AA(e){const t=Number(e);return!Number.isFinite(t)||t<0?"\u2014":t<1024?`${Math.round(t).toLocaleString()} B`:t<1048576?`${(t/1024).toFixed(1)} KB`:t<1073741824?`${(t/1048576).toFixed(2)} MB`:`${(t/1073741824).toFixed(2)} GB`}function kA({content:e,contentType:t,contentSize:n,fileName:r,contentEncoding:i,compressBeforeInscribe:a,onCompressBeforeInscribeChange:o,isDraftCompressing:s,draftCompressedSize:l,draftCompressionInputSize:c,draftCompressionOutcome:u,onContentChange:d,onContentTypeChange:p,onFileNameChange:f,onContentEncodingChange:m}){const g=String(t||"").toLowerCase(),h=String(i||"").trim(),[b,y]=Pc.useState(!1),[x,w]=Pc.useState(null),[v,S]=Pc.useState(!1),E=/^(\d+)\.(\d+)\.bitmap$/,N=/^(\d+)\.bitmap$/,I=null!=e&&("string"==typeof e?e.length>0:e instanceof ArrayBuffer?e.byteLength>0:"undefined"==typeof ArrayBuffer||!ArrayBuffer.isView||!ArrayBuffer.isView(e)||(e.byteLength||0)>0),A="string"==typeof e&&e.startsWith("data:"),k=!!e&&g.startsWith("image/")&&(e instanceof ArrayBuffer||"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(e)||e instanceof Uint8Array),T=k&&XI.has(g),C=(e=>{if("string"!=typeof e)return null;const t=e.trim(),n=t.match(E);if(n)return{kind:"parcel",parcel:n[1],block:n[2],full:t};const r=t.match(N);return r?{kind:"parent",block:r[1],full:t}:null})(e),B=!!C,P=!B&&g.startsWith("image/"),_=!B&&!g.startsWith("image/");Pc.useEffect(()=>{P||y(!1)},[P]),Pc.useEffect(()=>{if(!b)return;const e=e=>{"Escape"===e.key&&S(!0)};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[b]);const O=Number.isFinite(Number(c))?Number(c):null,L=Number.isFinite(Number(l))?Number(l):null,F=null!=O&&null!=L?L-O:null,M=null!=O&&null!=L&&O>0?100*(L/O-1):null,R=String(u||"idle"),$=B?"Not applicable":a?h?"Disabled (encoding set)":I?A?"Not applicable (data URL)":s?"Compressing\u2026":"helps"===R?"Smaller (will use)":"same"===R?"Same size (won't use)":"hurts"===R?"Larger (won't use)":null!=L?"Measured":"Idle":"No content":"Off",U=B||!a||h?"text-neutral-400 border-neutral-800/60 bg-neutral-900/40":s?"text-purple-200 border-purple-500/30 bg-purple-500/10":"helps"===R?"text-green-200 border-green-500/30 bg-green-500/10":"hurts"===R||"same"===R?"text-amber-200 border-amber-500/30 bg-amber-500/10":"text-neutral-300 border-neutral-800/60 bg-neutral-900/40",z=!!a&&!h&&I&&!A,D=!(!_||g&&!g.startsWith("text/")&&"application/json"!==g&&"application/javascript"!==g&&"application/x-javascript"!==g&&"application/xml"!==g&&"image/svg+xml"!==g),H=(()=>{const e=[];return D&&e.push({label:"Best for text/JSON/SVG",tone:"text-cyan-200 border-cyan-500/30 bg-cyan-500/10"}),e.push({label:"Uses `content-encoding: br`",tone:"text-neutral-200 border-neutral-700/60 bg-neutral-900/40"}),e.push({label:"Only applied if smaller",tone:"text-green-200 border-green-500/30 bg-green-500/10"}),e})();return Pc.createElement("div",{className:"h-full bg-neutral-900/50 border border-neutral-800/50 rounded-xl flex flex-col overflow-hidden"},Pc.createElement("div",{className:"shrink-0 flex items-center justify-between gap-3 px-3 py-2 border-b border-neutral-800/50 bg-neutral-900/80"},Pc.createElement("div",{className:"min-w-0"},Pc.createElement("div",{className:"text-sm font-semibold text-neutral-100 truncate"},"Compression"),Pc.createElement("div",{className:"text-[11px] text-neutral-500 truncate"},"Optimize size before adding to batch")),Pc.createElement("span",{className:"text-[10px] text-purple-400 font-medium shrink-0"},"Step 3: Compression")),Pc.createElement("div",{className:"flex-1 min-h-0 overflow-auto p-3 space-y-3"},B?Pc.createElement("div",{className:"rounded-xl border border-neutral-800/60 bg-neutral-950/40 p-3"},Pc.createElement("div",{className:"text-xs font-semibold text-neutral-200"},"No compression for Bitmap"),Pc.createElement("div",{className:"text-[11px] text-neutral-500 mt-1"},"parcel"===C?.kind?`Parcel bitmap (${C.full}) should not be compressed.`:`Bitmap (${C?.full||"\u2026"}) should not be compressed.`)):null,_?Pc.createElement("div",{className:"rounded-2xl border border-neutral-800/70 bg-gradient-to-b from-neutral-950/70 to-neutral-950/40 p-4 shadow-[0_0_0_1px_rgba(168,85,247,0.08),0_12px_50px_rgba(0,0,0,0.35)]"},Pc.createElement("div",{className:"flex items-start justify-between gap-3"},Pc.createElement("div",{className:"min-w-0"},Pc.createElement("div",{className:"flex items-center gap-2"},Pc.createElement("div",{className:"h-8 w-8 rounded-xl bg-purple-500/10 border border-purple-500/20 grid place-items-center text-[14px]"},"\ud83e\uddf1"),Pc.createElement("div",{className:"min-w-0"},Pc.createElement("div",{className:"text-sm font-semibold text-neutral-100"},"Brotli compression"),Pc.createElement("div",{className:"text-[11px] text-neutral-400 mt-0.5"},"Reduces bytes for lower fees \u2014 automatically skipped when it doesn\u2019t help.")))),Pc.createElement("label",{className:"inline-flex items-center gap-2 select-none "+(h?"opacity-40 cursor-not-allowed":"cursor-pointer"),title:h?"Disabled \u2014 content encoding already set":"Use Brotli (only applied if smaller)"},Pc.createElement("input",{type:"checkbox",checked:!!a,disabled:!!h||"function"!=typeof o,onChange:e=>o?.(!!e.target.checked),className:"sr-only"}),Pc.createElement("span",{className:"relative inline-flex h-7 w-12 items-center rounded-full border transition-colors "+(a?"bg-purple-500/25 border-purple-500/40":"bg-neutral-900/60 border-neutral-800/70")},Pc.createElement("span",{className:"inline-block h-5 w-5 rounded-full shadow transition-transform "+(a?"translate-x-6 bg-purple-200":"translate-x-1 bg-neutral-200")})),Pc.createElement("span",{className:"text-xs font-semibold "+(a?"text-purple-200":"text-neutral-400")},"On"))),Pc.createElement("div",{className:"mt-3 flex flex-wrap items-center gap-2"},H.map(e=>Pc.createElement("span",{key:e.label,className:`inline-flex items-center px-2 py-1 rounded-full text-[11px] border ${e.tone}`},e.label))),Pc.createElement("div",{className:"mt-3 grid grid-cols-2 gap-2"},Pc.createElement("div",{className:"rounded-xl border border-neutral-800/60 bg-neutral-950/40 p-2"},Pc.createElement("div",{className:"text-[10px] text-neutral-500"},"Original"),Pc.createElement("div",{className:"text-sm text-neutral-100 font-mono"},AA(O??n))),Pc.createElement("div",{className:"rounded-xl border border-neutral-800/60 bg-neutral-950/40 p-2"},Pc.createElement("div",{className:"text-[10px] text-neutral-500"},"Compressed"),Pc.createElement("div",{className:"text-sm text-neutral-100 font-mono"},null!=L?AA(L):"\u2014"))),Pc.createElement("div",{className:"mt-2 flex flex-wrap items-center gap-2"},Pc.createElement("span",{className:`inline-flex items-center gap-1.5 px-2 py-1 rounded-full text-[11px] border ${U}`},Pc.createElement("span",{className:"font-semibold"},$)),null!=F&&null!=M&&Pc.createElement("span",{className:"text-[11px] font-mono "+(F<0?"text-green-300":F>0?"text-amber-300":"text-neutral-400")},F<0?"":"+",AA(Math.abs(F))," (",M<0?"":"+",M.toFixed(1),"%)"),z?Pc.createElement("span",{className:"text-[11px] text-neutral-400"},"Ordinals supports ",Pc.createElement("span",{className:"font-mono text-neutral-200"},"content-encoding: br"),", so your inscription still renders correctly."):Pc.createElement("span",{className:"text-[11px] text-neutral-500"},"Stored bytes are compressed; viewers decode using ",Pc.createElement("span",{className:"font-mono text-neutral-300"},"br"),".")),(h||A)&&Pc.createElement("div",{className:"mt-3 rounded-xl border border-neutral-800/60 bg-neutral-950/40 p-2 text-[11px] text-neutral-500"},h?Pc.createElement(Pc.Fragment,null,"Disabled because encoding is already set to ",Pc.createElement("span",{className:"font-mono text-neutral-300"},h),"."):Pc.createElement(Pc.Fragment,null,"Data URLs aren\u2019t Brotli-compressed here.")),Pc.createElement("div",{className:"mt-3 text-[11px] text-neutral-500 leading-relaxed"},Pc.createElement("span",{className:"text-neutral-300 font-semibold"},"Why this is good:")," smaller inscriptions usually mean lower miner fees and faster propagation. Brotli is especially effective on repetitive text like JSON, HTML, SVG, and source code.")):null,P?Pc.createElement(Pc.Fragment,null,Pc.createElement("div",{className:"rounded-2xl border border-neutral-800/70 bg-gradient-to-b from-neutral-950/75 to-neutral-950/35 p-4 shadow-[0_0_0_1px_rgba(34,211,238,0.06),0_12px_50px_rgba(0,0,0,0.35)]"},Pc.createElement("div",{className:"flex items-start justify-between gap-3"},Pc.createElement("div",{className:"min-w-0"},Pc.createElement("div",{className:"flex items-center gap-2"},Pc.createElement("div",{className:"h-8 w-8 rounded-xl bg-cyan-500/10 border border-cyan-500/20 grid place-items-center text-[14px]"},"\ud83d\uddbc\ufe0f"),Pc.createElement("div",{className:"min-w-0"},Pc.createElement("div",{className:"text-sm font-semibold text-neutral-100"},"Image compression"),Pc.createElement("div",{className:"text-[11px] text-neutral-400 mt-0.5"},"Preview + tune quality in a full-screen optimizer."))),Pc.createElement("div",{className:"mt-3 flex flex-wrap gap-2"},Pc.createElement("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-[11px] border border-neutral-800/60 bg-neutral-900/40 text-neutral-300"},g||"image/*"),Pc.createElement("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-[11px] border border-neutral-800/60 bg-neutral-900/40 text-neutral-300"},AA(n)),Pc.createElement("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-[11px] border border-green-500/30 bg-green-500/10 text-green-200"},"Never applies larger output")))),Pc.createElement("div",{className:"mt-4"},Pc.createElement("button",{type:"button",onClick:()=>{y(!0),S(!1),w(null)},className:"w-full flex items-center justify-center gap-2 px-4 py-3 rounded-xl text-sm font-semibold transition-all border border-cyan-500/25 bg-gradient-to-r from-cyan-500/20 via-purple-500/20 to-pink-500/20 text-white hover:from-cyan-500/25 hover:via-purple-500/25 hover:to-pink-500/25 shadow-lg shadow-cyan-500/10"},Pc.createElement("span",{className:"text-base"},"\u26a1"),Pc.createElement("span",null,"Compress image (full screen)")),Pc.createElement("div",{className:"mt-2 text-[11px] text-neutral-500"},"Settings open by default. Tap outside or press Esc to close."))),b?qc.createPortal(Pc.createElement("div",{className:"fixed inset-0 z-[10000] bg-neutral-950/75 backdrop-blur-sm",role:"dialog","aria-modal":"true",onMouseDown:e=>{e.target===e.currentTarget&&S(!0)}},Pc.createElement("div",{className:"absolute inset-0 p-0 sm:p-6"},Pc.createElement("div",{className:"h-full w-full rounded-none sm:rounded-2xl border-0 sm:border border-neutral-800/70 bg-neutral-950/95 shadow-[0_0_0_1px_rgba(236,72,153,0.10),0_20px_80px_rgba(0,0,0,0.6)] flex flex-col overflow-hidden"},Pc.createElement("div",{className:"shrink-0 px-4 py-3 border-b border-neutral-800/60 bg-neutral-950/70 flex flex-col gap-0"},Pc.createElement("div",{className:"flex items-center justify-between gap-3"},Pc.createElement("div",{className:"min-w-0"},Pc.createElement("div",{className:"text-sm font-semibold text-neutral-100 truncate"},"Image Optimizer"),Pc.createElement("div",{className:"text-[11px] text-neutral-500 truncate"},r?`${r} \u2022 `:"",g||"image/*")),Pc.createElement("div",{className:"flex items-center gap-2 shrink-0"},x&&Pc.createElement("button",{type:"button",onClick:()=>x.onAcceptClick?.(),disabled:!x.compressedBlob||x.compressing||x.isLarger,className:`\n                                px-4 py-2 rounded-lg text-sm font-semibold transition-colors touch-manipulation min-h-[36px]\n                                ${!x.compressedBlob||x.compressing||x.isLarger?"bg-neutral-800/50 text-neutral-500 cursor-not-allowed border border-neutral-700/30":"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white shadow-lg shadow-purple-500/25"}\n                              `,title:x.isLarger?"Compressed file is larger than original":""},x.compressing?"\u2026":x.isLarger?"Larger":"Use Compressed"),Pc.createElement("button",{type:"button",onClick:()=>S(!0),className:"px-3 py-1.5 rounded-lg text-xs font-semibold border border-neutral-800/70 bg-neutral-900/40 text-neutral-200 hover:bg-neutral-900/70"},"Close"))),v&&Pc.createElement("div",{className:"mt-2 flex items-center gap-2 p-2 rounded-lg border border-neutral-700/60 bg-neutral-900/90",style:{animation:"slideDown 150ms ease-out"}},Pc.createElement("span",{className:"text-[11px] text-neutral-300 flex-1"},"Use the compressed version before closing?"),Pc.createElement("button",{type:"button",onClick:()=>{S(!1),x?.onAcceptClick?.()},disabled:!x?.compressedBlob||x?.compressing||x?.isLarger,className:`\n                              px-3 py-1.5 rounded-md text-[11px] font-semibold transition-colors touch-manipulation min-h-[32px]\n                              ${!x?.compressedBlob||x?.compressing||x?.isLarger?"bg-neutral-800/50 text-neutral-500 cursor-not-allowed border border-neutral-700/30":"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white shadow-lg shadow-purple-500/20"}\n                            `},"Yes, use it"),Pc.createElement("button",{type:"button",onClick:()=>{S(!1),y(!1)},className:"px-3 py-1.5 rounded-md text-[11px] font-medium border border-neutral-700/60 bg-neutral-800/60 text-neutral-300 hover:bg-neutral-700 transition-colors touch-manipulation min-h-[32px]"},"No, discard")),Pc.createElement("style",null,"@keyframes slideDown { from { opacity:0; transform:translateY(-4px); } to { opacity:1; transform:translateY(0); } }")),Pc.createElement("div",{className:"flex-1 min-h-0 overflow-auto p-4"},T?Pc.createElement(tA,{content:e,contentType:g,fileName:r,defaultSettingsOpen:!0,onControlsReady:w,onAccept:(e,t,n)=>{d?.(e),p?.(t),f?.(n),m?.(""),y(!1)},onSkip:()=>{y(!1)}}):Pc.createElement("div",{className:"rounded-xl border border-neutral-800/60 bg-neutral-950/40 p-3 text-[12px] text-neutral-400"},g.startsWith("image/")?k?"This image format can\u2019t be recompressed in-browser.":"Load an image (binary) to enable compression.":"Not an image inscription."))))),document.body):null):null))}function TA(e){return(null==e?"":String(e)).trim()}function CA(e){const t=TA(e).toLowerCase();return t?t.replace(/\s+/g,"-").replace(/[^a-z0-9_-]/g,"").replace(/-+/g,"-").replace(/^[-_]+|[-_]+$/g,""):""}function BA(e){const t=TA(e).toLowerCase();return t&&/^[0-9a-f]{64}i\d+$/.test(t)?t:""}async function PA(e){const t=await fetch(e);if(!t.ok)throw new Error(`HTTP ${t.status}`);return await t.json()}function _A(e){const t=Number(e);return Number.isFinite(t)?t<0?null:Math.floor(t):null}async function OA(e){const t=await async function(e){const t=TA(e);if(!t)return"";try{const e=kt(`/content/${t}`),n=await fetch(e);if(!n.ok)return"";const r=await n.text();return r.length>5e5?r.slice(0,5e5):r}catch{return""}}(e);if(!t)return null;let n;try{n=JSON.parse(t)}catch{return null}if(!n||"object"!=typeof n)return null;if("OODL-COLLECTION"!==TA(n.p))return null;const r=n.registry_entry&&"object"==typeof n.registry_entry?n.registry_entry:{},i=n.meta&&"object"==typeof n.meta?n.meta:{},a=n.match&&"object"==typeof n.match?n.match:{},o=n.open_store&&"object"==typeof n.open_store?n.open_store:{},s=Array.isArray(a.inscriptionIds)?a.inscriptionIds.map(e=>BA(e)).filter(Boolean):[],l=Array.isArray(o.offers)?o.offers.map(e=>{if(!e||"object"!=typeof e)return null;const t=BA(e.inscriptionId),n=TA(e.sellerOfferPsbt),r=Number(e.priceSats);return!t||!n||!Number.isFinite(r)||r<=0?null:{inscriptionId:t,priceSats:Math.floor(r),sellerOfferPsbt:n}}).filter(Boolean):[];return{sourceInscriptionId:TA(e),raw:n,key:TA(r.key),title:TA(r.title)||TA(i.title),description:TA(r.description)||TA(i.description),indexingAddress:TA(r.addresses?.indexing),feeSats:Number(r.fee?.sats)||0,inscriptionIds:s,galleryInscriptionId:TA(a.galleryInscriptionId),catalogImageId:TA(r.catalogImage?.inscriptionId),offers:l,minBlockHeight:Number.isFinite(Number(o.minBlockHeight))?Math.floor(Number(o.minBlockHeight)):null,version:TA(n.version)}}async function LA(e,{scanLimit:t=250}={}){const n=TA(e);if(!n)return null;const r=await async function(e){const t=TA(e);if(!t)return null;try{const e=kt(`/r/inscription/${t}`),n=await PA(e);return _A(n?.sat)}catch{return null}}(n);if(null===r)return await OA(n);const i=await async function(e){const t=_A(e);if(null===t)return[];try{const e=kt(`/r/sat/${t}`),n=await PA(e);return(Array.isArray(n?.ids)?n.ids:[]).map(e=>TA(e)).filter(Boolean)}catch{return[]}}(r);if(!i||0===i.length)return await OA(n);const a=Number.isFinite(Number(t))&&Number(t)>0?Math.floor(Number(t)):i.length;let o=0;for(let s=i.length-1;s>=0;s--){const e=TA(i[s]);if(!e)continue;const t=await OA(e);if(o++,t)return t;if(o>=a)break}return null}function FA(e){return(null==e?"":String(e)).trim()}const MA=["Prepare manifesto","Sign offer PSBTs","Wallet prompt (inscribe)","Broadcast & confirm"];function RA({walletState:e,onConnect:t,onDisconnect:r,onInscriptionCreated:i}){const a=.1,[o,s]=Bc.useState("standard"),[l,c]=Bc.useState([]),[u,d]=Bc.useState(!1),[p,f]=Bc.useState([]),[m,g]=Bc.useState(null),[h,b]=Bc.useState(null),[y,x]=Bc.useState({status:"idle",phase:"",message:"",error:"",ts:null,lastSuccessAt:null,spendableCount:null,unsafeCount:null,inscriptionCount:null}),[w,v]=Bc.useState(0),S=Pc.useCallback(()=>{x(e=>({...e||{},status:"loading",phase:"utxos",message:"Rescanning wallet\u2026",error:"",ts:Date.now()})),v(e=>e+1)},[]),E=Pc.useCallback(e=>{e&&"object"==typeof e&&x(t=>{const n=t&&"object"==typeof t?t:{},r={...n,...e},i=String(n.status||"").trim().toLowerCase(),a=String(e.status||"").trim().toLowerCase();return("extracting"===i&&("utxos-ready"===a||"ready"===a)||"ready"===i&&"utxos-ready"===a)&&(r.status=n.status,n.phase&&(r.phase=n.phase),n.message&&(r.message=n.message)),null==r.inscriptionCount&&null!=n.inscriptionCount&&(r.inscriptionCount=n.inscriptionCount),null==r.lastSuccessAt&&null!=n.lastSuccessAt&&(r.lastSuccessAt=n.lastSuccessAt),"string"!=typeof r.status&&(r.status=n.status||"idle"),"number"!=typeof r.ts&&(r.ts=Date.now()),r})},[]),[N,I]=Bc.useState("text/plain"),[A,k]=Bc.useState(""),[T,C]=Bc.useState(0),[B,P]=Bc.useState(""),[_,O]=Bc.useState(""),[L,F]=Bc.useState(""),[M,R]=Bc.useState(""),[$,U]=Bc.useState(""),[z,D]=Bc.useState(null),[H,W]=Bc.useState(""),[j,V]=Bc.useState(""),[q,X]=Bc.useState(!1),[K,G]=Bc.useState(null),[Y,J]=Bc.useState("idle"),[Q,Z]=Bc.useState(null),[ee,te]=Bc.useState("idle"),ne=Pc.useRef(null),re=Pc.useRef(0),[ie,ae]=Bc.useState(""),oe=Pc.useRef(null),[se,le]=Bc.useState(1),[ce,ue]=Bc.useState(null),[de,pe]=Bc.useState(null),[fe,me]=Bc.useState({status:"not-loaded"}),[ge,he]=Bc.useState([]),[be,ye]=Bc.useState(null),[xe,we]=Bc.useState(!1),[ve,Se]=Bc.useState(null),[Ee,Ne]=Bc.useState(null),[Ie,Ae]=Bc.useState(null),[ke,Te]=Bc.useState("oodl"),[Ce,Be]=Bc.useState("marketplace"),[Pe,_e]=Bc.useState(!1),[Oe,Le]=Bc.useState(!0),[Fe,Me]=Bc.useState("Parents"),[Re,$e]=Bc.useState(null),[Ue,ze]=Bc.useState(null),[De,He]=Bc.useState(null),[We,je]=Bc.useState(!1),Ve=!0,[qe,Xe]=Bc.useState("content"),Ke=Pc.useRef(0),Ge=e=>({tab:e,seq:++Ke.current}),[Ye,Je]=Bc.useState(()=>Ge("oodl")),Qe=Pc.useCallback(e=>{Je(Ge(e))},[]),[Ze,et]=Bc.useState("text"),[tt,nt]=Bc.useState("editor"),rt=Bc.useRef(null),it=Bc.useRef(!1),at=Pc.useCallback(e=>{it.current=!0,nt(e)},[]),ot=Pc.useCallback(e=>{at(e),"editor"===e&&Xe("content"),"options"===e&&Xe("options"),"compression"===e&&Xe("compression"),"review"===e&&Xe("review"),"fees"===e&&Xe("fees")},[at,Ve]),st=Pc.useCallback(()=>{Xe("options"),at("options")},[at]);Bc.useEffect(()=>{it.current?it.current=!1:nt("editor")},[ke]);const lt=Pc.useCallback(()=>{try{return"undefined"!=typeof window&&!!window.matchMedia&&window.matchMedia("(max-width: 1023px)").matches}catch{return!1}},[]),ct=Bc.useRef(!1);Bc.useEffect(()=>{"oodl"===ke&&Pe?ct.current||Re&&lt()&&("options"!==Re&&"inscriptions"!==Re||(ct.current=!0,nt("options"))):ct.current=!1},[ke,Pe,Re,lt]);const[ut,dt]=Bc.useState(0),pt=()=>dt(e=>e+1),ft=()=>dt(e=>Math.max(0,e-1)),mt=Bc.useRef({key:null,started:!1}),gt=async()=>{try{if(!e?.isConnected)return;const r=`${e?.walletType||""}|${e?.ordinalsAddress||""}|${e?.paymentAddress||""}|${e?.address||""}`;if(mt.current.started&&mt.current.key===r)return;mt.current={key:r,started:!0};const[{indexOODLListings:i},{prefetchInscriptionContent:a}]=await Promise.all([n(()=>Promise.resolve().then(()=>Xl),__VITE_PRELOAD__),n(()=>Promise.resolve().then(()=>yN),__VITE_PRELOAD__)]);let o=null;try{const{OODL_CONFIG:e}=await n(async()=>{const{OODL_CONFIG:e}=await Promise.resolve().then(()=>As);return{OODL_CONFIG:e}},__VITE_PRELOAD__);o=e?.fundingAddress||null}catch(t){o=null}const s=await i({address:o||void 0,forceRefresh:!1});if(!Array.isArray(s)||0===s.length)return;const l=Math.min(12,s.length);await Promise.allSettled(s.slice(0,l).map(e=>a(e?.inscriptionId||e?.id,e?.contentType||e?.content_type||"")))}catch(_k){}},[ht,bt]=Bc.useState(""),[yt,xt]=Bc.useState(""),[wt,vt]=Bc.useState(""),[St,Nt]=Bc.useState(!1),[It,At]=Bc.useState(""),[Ct,Bt]=Bc.useState(""),[Pt,_t]=Bc.useState(""),[Ot,Lt]=Bc.useState(""),[Ft,Mt]=Bc.useState(""),[Rt,$t]=Bc.useState(""),[Ut,Dt]=Bc.useState(null),[Ht,Wt]=Bc.useState(""),jt=function({walletState:e,feeRate:t,selectedParents:r,selectedUtxos:i,cachedFilteredUtxos:a,salePriceSats:o,listingScriptAddress:s,listingMarkerValueSats:l,listingDryRun:c,saleMinBlockHeight:u,beginTxBusy:d,endTxBusy:p}){const[f,m]=Bc.useState(""),[g,h]=Bc.useState(""),[b,y]=Bc.useState(null),x=()=>{const e=Array.isArray(r)?r:[];return e.length>0?e[e.length-1]:null};return{sellerStatus:f,sellerError:g,listingSuccessResult:b,setListingSuccessResult:y,onCreateListingTx:async(r={})=>{h(""),m(""),d?.();try{if(!e?.isConnected)throw new Error("Wallet not connected");const d=x(),p=d?.id||d?.inscriptionId||d?.inscription_id;if(!p)throw new Error("Select an inscription first");const f=d?.utxo;if(!f?.txid||void 0===f?.vout)throw new Error("Selected inscription is missing UTXO data. Refresh inscriptions/UTXOs and try again.");const g={...f,address:f?.address||f?.addr||e?.ordinalsAddress||null};if(!g?.address)throw new Error("Parent UTXO missing address. Ensure the inscription UTXO has an address field or wallet ordinalsAddress is available.");const{parseUserPriceToSats:h}=await n(async()=>{const{parseUserPriceToSats:e}=await Promise.resolve().then(()=>LN);return{parseUserPriceToSats:e}},__VITE_PRELOAD__),b=h(o),w=String(s||"").trim()||null,v=(e=>{if(null==e||""===e)return null;const t=Number(e);if(!Number.isFinite(t))return null;const n=Math.floor(t);return n<0?null:n})(r?.minBlockHeight??u);if(null!==v){const{fetchBlockHeightViaProxy:e}=await n(async()=>{const{fetchBlockHeightViaProxy:e}=await Promise.resolve().then(()=>Ei);return{fetchBlockHeightViaProxy:e}},__VITE_PRELOAD__),t="undefined"!=typeof window&&window.__NEXUS_NETWORK__||"mainnet";let r;try{r=await e(t)}catch{r=null}const i=Number(r);if(!Number.isFinite(i))throw new Error('Unable to fetch chain tip height to validate "Not valid before block". Clear the field or try again.');const a=Math.floor(i);if(v<=a)throw new Error(`Not valid before block must be > tip height (${a}). Clear it to list immediately.`)}const S=String(l||"").trim();let E=null;if(S){if(!/^[0-9]+$/.test(S))throw new Error("Enter a valid listing script funding amount (integer sats)");const e=Number.parseInt(S,10);if(!Number.isFinite(e)||e<=0)throw new Error("Listing script funding must be > 0 sats");E=e}const N=a?Array.isArray(a)?a:a.spendable||[]:[],I=e?.provider||window.NexusWalletConnect;if(!I)throw new Error("Wallet provider not available");const A=e?.paymentAddress||e?.address;if(!A)throw new Error("Wallet payment address not available");const k=e=>{if(!e)return null;const t=e?.fullUtxo||e?.utxo||e?.raw||e?.full||e,n=t.txid||t.txId||t.hash,r=t.vout??t.index??t.n,i=t.value??t.satoshis??t.amount,a=t.address||t.addr||A;if(!n||null==r)return null;const o=Number(i);return!Number.isFinite(o)||o<=0?null:{...e,txid:String(n),vout:Number(r),value:o,address:a}},T=`${g.txid}:${g.vout}`,C=Array.isArray(i)?i:[],B=[...Array.isArray(N)?N:[],...C].map(k).filter(Boolean).filter(e=>`${e.txid}:${e.vout}`!==T),P=new Map;B.forEach(e=>P.set(`${e.txid}:${e.vout}`,e));const _=Array.from(P.values()).sort((e,t)=>(t.value||0)-(e.value||0));if(!Array.isArray(_)||0===_.length)throw new Error("No spendable funding UTXOs loaded. Click \u201cFetch UTXOs\u201d first.");const O=_[0]||null;if(!O)throw new Error("No funding UTXO available");const{createAndBroadcast3TxSaleListingFlow:L}=await n(async()=>{const{createAndBroadcast3TxSaleListingFlow:e}=await Promise.resolve().then(()=>fo);return{createAndBroadcast3TxSaleListingFlow:e}},__VITE_PRELOAD__),{getOODLFeeOutput:F,getOODLCollectionFeeOutput:M}=await n(async()=>{const{getOODLFeeOutput:e,getOODLCollectionFeeOutput:t}=await Promise.resolve().then(()=>As);return{getOODLFeeOutput:e,getOODLCollectionFeeOutput:t}},__VITE_PRELOAD__),R=String(r?.collectionKey||"").trim()||null;let $=null,U=null,z=null,D=null,H=[];try{const[{loadCollectionsRegistry:e,matchCollectionForInscription:t},{setDynamicOODLCollections:r}]=await Promise.all([n(()=>Promise.resolve().then(()=>Ol),__VITE_PRELOAD__),n(()=>Promise.resolve().then(()=>As),__VITE_PRELOAD__)]),i=await e({forceRefresh:!1});if(H=Array.isArray(i?.collections)?i.collections:[],r(H),R)if("uncategorized"===R)$=null;else if("bitmap"===String(R).toLowerCase()){const{detectAndVerifyBitmapByInscriptionId:e}=await n(async()=>{const{detectAndVerifyBitmapByInscriptionId:e}=await Promise.resolve().then(()=>zs);return{detectAndVerifyBitmapByInscriptionId:e}},__VITE_PRELOAD__),t=await e(p);if("bitmap"!==t?.type||!t?.verified)throw new Error("Selected collection is bitmap, but this inscription is not OCI-verified as a bitmap.");$="bitmap",U=Number.isFinite(Number(t?.bitmapNumber))?Math.floor(Number(t.bitmapNumber)):null}else if("parcel"===String(R).toLowerCase()){const{detectAndVerifyParcelByInscriptionId:e}=await n(async()=>{const{detectAndVerifyParcelByInscriptionId:e}=await Promise.resolve().then(()=>qs);return{detectAndVerifyParcelByInscriptionId:e}},__VITE_PRELOAD__),t=await e(p);if("parcel"!==t?.type||!t?.verified)throw new Error('Selected collection is parcel, but this inscription does not look like a parcel inscription (expected "{parcel}.{bitmap}.bitmap").');$="parcel",D=t,z=Number.isFinite(Number(t?.parcelNumber))?Math.floor(Number(t.parcelNumber)):null,U=Number.isFinite(Number(t?.bitmapNumber))?Math.floor(Number(t.bitmapNumber)):null}else{const e=H.find(e=>String(e?.key||"").trim()===R)||null;if(!e)throw new Error("Selected collection not found in registry.");if(await t(p,[e])!==R)throw new Error("This inscription is not indexed / does not match the selected collection rules.");$=R}else $=await t(p,H)}catch(Pk){if(R)throw Pk;$=null}if(!$)try{const{detectAndVerifyBitmapByInscriptionId:e}=await n(async()=>{const{detectAndVerifyBitmapByInscriptionId:e}=await Promise.resolve().then(()=>zs);return{detectAndVerifyBitmapByInscriptionId:e}},__VITE_PRELOAD__),t=await e(p);"bitmap"===t?.type&&t?.verified&&($="bitmap",U=Number.isFinite(Number(t?.bitmapNumber))?Math.floor(Number(t.bitmapNumber)):null)}catch{$=null}if(!$)try{const{detectAndVerifyParcelByInscriptionId:e}=await n(async()=>{const{detectAndVerifyParcelByInscriptionId:e}=await Promise.resolve().then(()=>qs);return{detectAndVerifyParcelByInscriptionId:e}},__VITE_PRELOAD__),t=await e(p);"parcel"===t?.type&&t?.verified&&($="parcel",D=t,z=Number.isFinite(Number(t?.parcelNumber))?Math.floor(Number(t.parcelNumber)):null,U=Number.isFinite(Number(t?.bitmapNumber))?Math.floor(Number(t.bitmapNumber)):null)}catch{$=null}const W=M($)||F(),j={parentInscriptionId:p,collectionKey:$,sellerAddress:A,priceSats:BigInt(b),...null!==v?{minBlockHeight:v}:{},...Number.isFinite(Number(z))?{parcelNumber:Math.floor(Number(z))}:{},...Number.isFinite(Number(U))?{bitmapNumber:Math.floor(Number(U))}:{}},V=["Sign commit","Extract txid","Sign offer","Sign reveal","Local-sign carrier","Broadcast commit","Broadcast reveal"];c&&m("Dry run: building+signing offer + commit + reveal (no broadcast)...");const q=await L({walletProvider:I,parentUtxo:g,fundingUtxo:O,fundingUtxos:_,listingScriptAddress:w,markerValueSats:E,sellerChangeAddress:A,feeRateSatPerVb:t,marker:j,emitOpReturnMarker:!1,emitParcelHintOpReturn:!1,broadcast:!c,oodlFeeAddress:W?.address||null,oodlFeeSats:W?.value||null,onProgress:c?null:e=>m(IE(V,e))});if("3tx-complete"===q?.mode&&q?.commitTxid&&y({commitTxid:q.commitTxid,revealTxid:q.revealTxid||q.markerTxid||null,parentOutpointAfterCommit:q.parentOutpointAfterCommit||null,sellerListingPsbtHashHex:q.sellerListingPsbtHashHex||null,broadcasted:!!q.broadcasted}),"needs-external-signer"===q?.mode){const e=String(q.commitTxid||"").slice(0,12);return void m(`Commit broadcasted (txid=${e}\u2026). Wallet refused to sign seller offer PSBT (ANYONECANPAY).`)}const X=String(q.commitTxid||"").slice(0,12),K=String(q.revealTxid||q.markerTxid||"").slice(0,12),G=String(q.sellerListingPsbtHashHex||"").slice(0,12);m(q?.broadcasted?`Listed. commit=${X}\u2026 reveal=${K}\u2026 offerHash=${G}\u2026 outpoint=${q.parentOutpointAfterCommit}`:`Dry run complete (NOT broadcast). commit=${X}\u2026 reveal=${K}\u2026 offerHash=${G}\u2026 outpoint=${q.parentOutpointAfterCommit}`)}catch(Pk){m(""),h(Pk?.message||String(Pk))}finally{p?.()}},getSelectedSaleInscription:x}}({walletState:e,feeRate:ce,selectedParents:p,selectedUtxos:ge,cachedFilteredUtxos:h,salePriceSats:ht,listingScriptAddress:yt,listingMarkerValueSats:wt,listingDryRun:St,saleMinBlockHeight:It,beginTxBusy:pt,endTxBusy:ft}),Vt=jt?.getSelectedSaleInscription||(()=>null),qt=jt?.onCreateListingTx,Xt=jt?.sellerStatus||"",Kt=jt?.sellerError||"",Gt=jt?.listingSuccessResult||null,Jt=jt?.setListingSuccessResult||(()=>{}),Qt=function({walletState:e,feeRate:t,selectedSaleInscription:r,salePriceSats:i,saleMinBlockHeight:a,selectedUtxos:o,cachedFilteredUtxos:s}){const[l,c]=Bc.useState(""),[u,d]=Bc.useState(""),[p,f]=Bc.useState(""),[m,g]=Bc.useState(""),[h,b]=Bc.useState(""),[y,x]=Bc.useState(null),[w,v]=Bc.useState(""),[S,E]=Bc.useState(""),[N,I]=Bc.useState(""),[A,k]=Bc.useState(""),[T,C]=Bc.useState(""),B=Bc.useCallback(()=>s?Array.isArray(s)?s:s.spendable||[]:[],[s]),P=Bc.useCallback(t=>{const n=B(),r=[...Array.isArray(n)?n:[],...Array.isArray(o)?o:[]];if(!Array.isArray(r)||0===r.length)return[];const i=r.map(n=>{if(!n)return null;const r=n?.fullUtxo||n?.utxo||n?.raw||n?.full||n,i=r.txid||r.txId||r.hash,a=r.vout??r.index??r.n,o=r.value??r.satoshis??r.amount,s=r.address||r.addr||t;if(!i||null==a)return null;const l=Number(o);if(!Number.isFinite(l)||l<=0)return null;const c=e?.ordinalsAddress||null,u=e?.paymentAddress||null;if(c&&u&&c!==u){const e=String(s||"").trim();if(e&&e===String(c).trim())return null}return{txid:String(i),vout:Number(a),value:l,address:s}}).filter(Boolean),a=new Map;return i.forEach(e=>a.set(`${e.txid}:${e.vout}`,e)),Array.from(a.values())},[B,o,e?.ordinalsAddress,e?.paymentAddress]),_=Bc.useCallback(async()=>{f(""),d(""),c("");try{if(!e?.isConnected)throw new Error("Wallet not connected");const o=r;if(!(o?.id||o?.inscriptionId||o?.inscription_id))throw new Error("Select an inscription first");const s=o?.utxo;if(!s?.txid||void 0===s?.vout)throw new Error("Selected inscription is missing UTXO data. Refresh inscriptions/UTXOs and try again.");const l={...s,address:s?.address||s?.addr||e?.ordinalsAddress||null};if(!l?.address)throw new Error("Parent UTXO missing address. Ensure wallet ordinalsAddress is available.");const{parseUserPriceToSats:u}=await n(async()=>{const{parseUserPriceToSats:e}=await Promise.resolve().then(()=>LN);return{parseUserPriceToSats:e}},__VITE_PRELOAD__),p=u(i),f=Number(t||0);if(!Number.isFinite(f)||f<=0)throw new Error("Set a fee rate first (sat/vB) before creating a seller offer PSBT.");const m=(()=>{const e=String(a??"").trim();if(!e)return null;const t=Number(e);if(!Number.isFinite(t)||t<0)throw new Error("Min block height must be a non-negative integer.");return Math.floor(t)})();if(null!==m){const{fetchBlockHeightViaProxy:e}=await n(async()=>{const{fetchBlockHeightViaProxy:e}=await Promise.resolve().then(()=>Ei);return{fetchBlockHeightViaProxy:e}},__VITE_PRELOAD__),t="undefined"!=typeof window&&window.__NEXUS_NETWORK__||"mainnet";let r;try{r=await e(t)}catch{r=null}const i=Number(r);if(!Number.isFinite(i))throw new Error('Unable to fetch chain tip height to validate "Not valid before block". Clear the field or try again.');const a=Math.floor(i);if(m<=a)throw new Error(`Not valid before block must be > tip height (${a}). Clear it to create an immediately-valid offer.`)}const g=e?.provider||window.NexusWalletConnect;if(!g)throw new Error("Wallet provider not available");if(String(e?.walletType||g?.walletType||g?.name||"").toLowerCase().includes("phantom"))throw new Error("Phantom wallet is not supported for creating Open Store offers/listings (requires 0x83 SIGHASH_SINGLE|ANYONECANPAY). Use UniSat/OKX/Xverse/Wizz or another compatible wallet.");const h=e?.paymentAddress||e?.address||e?.ordinalsAddress;if(!h)throw new Error("Wallet payout address not available");d("Building Open Store offer PSBT (no broadcast)\u2026");const{loadBitcoinLibFromInscription:b}=await n(async()=>{const{loadBitcoinLibFromInscription:e}=await Promise.resolve().then(()=>An);return{loadBitcoinLibFromInscription:e}},__VITE_PRELOAD__),{signAndBroadcastPsbt:y}=await n(async()=>{const{signAndBroadcastPsbt:e}=await Promise.resolve().then(()=>ir);return{signAndBroadcastPsbt:e}},__VITE_PRELOAD__),x=await b(),w="undefined"!=typeof window&&window.__NEXUS_NETWORK__||"mainnet",v=String(w).toLowerCase(),S="testnet"===v||"signet"===v||"regtest"===v?x.networks.testnet:x.networks.bitcoin,E=Number(l?.value);if(!Number.isFinite(E)||E<=0)throw new Error("Selected inscription UTXO is missing value. Refresh UTXOs/inscriptions and try again.");const N=546,I=(x.Transaction?.SIGHASH_SINGLE??3)|(x.Transaction?.SIGHASH_ANYONECANPAY??128),A=new x.Psbt({network:S});if(null!==m)try{A.setLocktime(m)}catch{throw new Error("Failed to set PSBT locktime for min block height.")}const k=Buffer.alloc(32,0),T={script:Buffer.from("0014"+"00".repeat(20),"hex"),value:1};A.addInput({hash:k,index:4294967294,sequence:4294967293,witnessUtxo:T}),A.addInput({hash:k,index:4294967295,sequence:4294967293,witnessUtxo:T});const C=x.address.toOutputScript(l.address,S);A.addInput({hash:l.txid,index:l.vout,witnessUtxo:{script:C,value:Math.floor(E)},sighashType:I,sequence:4294967293});try{const t=g?.getState?.()?.ordinalsPublicKey||g?.getState?.()?.publicKey||e?.ordinalsPublicKey||e?.publicKey||null,n="string"==typeof t?t.startsWith("0x")?t.slice(2):t:null;if("string"==typeof l.address&&(l.address.startsWith("bc1p")||l.address.startsWith("tb1p"))&&n&&(64===n.length||66===n.length)&&A?.data?.inputs?.[2]){const e=66===n.length?n.slice(2):n;A.data.inputs[2].tapInternalKey=Buffer.from(e,"hex")}}catch{}A.addOutput({address:h,value:0}),A.addOutput({address:h,value:N});const B=E>N?BigInt(E)-BigInt(N):0n,P=BigInt(p)+B;A.addOutput({address:h,value:Number(P)}),d("Requesting wallet signature for offer PSBT (0x83)\u2026");const{assertOpenStoreSellerOfferSignedCorrectly:_}=await n(async()=>{const{assertOpenStoreSellerOfferSignedCorrectly:e}=await Promise.resolve().then(()=>cs);return{assertOpenStoreSellerOfferSignedCorrectly:e}},__VITE_PRELOAD__);let O,L=null;try{const e=await y(g,A.toHex(),{autoFinalized:!1,toSignInputs:[{index:2,address:l.address,sighashType:I}]},!1);L=e?.signedPsbt||null}catch{L=null}if(!L)throw new Error("Wallet refused to sign the 0x83 seller offer. This build refuses to create unsigned offers and does not support the two-step buyer-funded fallback. Use a wallet that supports SIGHASH_SINGLE|ANYONECANPAY.");try{O=x.Psbt.fromHex(L,{network:S})}catch{O=x.Psbt.fromBase64(L,{network:S})}_({unsignedOfferPsbt:A,signedOfferPsbt:O,sellerInputIndex:2,expectedSighashByte:131});try{const{sanitizePsbtForSharing:e}=await n(async()=>{const{sanitizePsbtForSharing:e}=await Promise.resolve().then(()=>ps);return{sanitizePsbtForSharing:e}},__VITE_PRELOAD__);c(await e(O.toBase64(),{profile:"publish"}))}catch{c(O.toBase64())}d("Signed seller offer PSBT created. Share it with the buyer to paste in Buy \u2192 Manual PSBT.")}catch(Pk){d(""),f(Pk?.message||String(Pk))}},[t,i,r,e]),O=Bc.useCallback(async r=>{b(""),g(""),x(null);let i=null;try{if(!e?.isConnected)throw new Error("Wallet not connected");const o=String(r||"").trim();if(!o)throw new Error("Paste a seller offer PSBT first");const s=Number(t||0);if(!Number.isFinite(s)||s<=0)throw new Error("Set a fee rate first (sat/vB) before buying from a seller PSBT.");const l=e?.provider||window.NexusWalletConnect;if(!l)throw new Error("Wallet provider not available");const c=e?.paymentAddress||e?.address||e?.ordinalsAddress,u=e?.ordinalsAddress||e?.address||e?.paymentAddress;if(!c)throw new Error("Wallet payment/change address not available");if(!u)throw new Error("Wallet ordinals/receive address not available");const d=P(c);if(!Array.isArray(d)||0===d.length)throw new Error("No spendable payment UTXOs loaded. Click \u201cFetch UTXOs\u201d first (or select UTXOs).");const p=d.reduce((e,t)=>e+(Number(t?.value)||0),0);let f=d;if(d.length<3){try{g("Checking offer requirements before split-funding\u2026");const{estimateBuyNeedFromSellerOfferPsbt:e}=await n(async()=>{const{estimateBuyNeedFromSellerOfferPsbt:e}=await Promise.resolve().then(()=>Zo);return{estimateBuyNeedFromSellerOfferPsbt:e}},__VITE_PRELOAD__),t=await e({walletProvider:l,sellerOfferPsbt:o,buyerChangeAddress:c,feeRateSatPerVb:s}),r=BigInt(Math.max(0,Math.floor(Number(p)||0))),i=BigInt(t?.needTotalSats||0n);if(i>0n&&r<i){const e=i-r;throw new Error(`Insufficient buyer funds to buy (skipping split-funding). Need >= ${i.toString()} sats (estFee\u2248${String(t?.feeEstimateSats||"?")}), have ${r.toString()} sats, short ${e.toString()} sats.`)}}catch(a){const e=a?.message||String(a);if(String(e).includes("skipping split-funding"))throw a}g("Not enough payment UTXOs \u2014 creating split funding tx first...");const{createSplitFundingTransaction:t}=await n(async()=>{const{createSplitFundingTransaction:e}=await Promise.resolve().then(()=>ms);return{createSplitFundingTransaction:e}},__VITE_PRELOAD__),r=await t({walletProvider:l,networkName:e.network?.toLowerCase?.()||"mainnet",paymentAddress:c,paymentPublicKeyHex:e?.paymentPublicKey||null,paymentCandidates:d,feeRateSatPerVb:s,dummySats:600,minRemainderSats:546,label:"buy-funding-split-manual"});if(i=r?.txid||null,i&&g(`Split funding tx broadcasted. Mempool: ${Tt(`/tx/${i}`)}. Continuing buy\u2026`),f=[...d.filter(e=>`${e.txid}:${e.vout}`!==r.spentOutpoint),...r.splitUtxos||[]],f.length<3)throw new Error("Split completed but still insufficient payment UTXOs to buy. Click \u201cFetch UTXOs\u201d and try again.")}const{createAndBroadcastBuyFromSellerOfferPsbt:m}=await n(async()=>{const{createAndBroadcastBuyFromSellerOfferPsbt:e}=await Promise.resolve().then(()=>Zo);return{createAndBroadcastBuyFromSellerOfferPsbt:e}},__VITE_PRELOAD__);g("Building buyer PSBT from seller offer \u2192 wallet signing...");const h=await m({walletProvider:l,sellerOfferPsbt:o,buyerPaymentUtxos:f,buyerChangeAddress:c,buyerReceiveAddress:u,feeRateSatPerVb:s,broadcast:!0});h?.buyTxid&&x({buyTxid:h.buyTxid,inferredPriceSats:h.inferredPriceSats||null,feeSats:h.feeSats||null,broadcasted:!0});const b=String(h?.buyTxid||"").slice(0,12);g(`Bought. txid=${b}\u2026 price\u2248${String(h?.inferredPriceSats||"?")} sats`)}catch(Pk){g("");let t=Pk?.message||String(Pk);i&&(t=`${t} | Split funding tx: ${i} | Mempool: ${Tt(`/tx/${i}`)}`),b(t)}},[t,P,e]),L=Bc.useCallback(()=>{x(null)},[]),F=Bc.useCallback(async r=>{I(""),E(""),v("");let i=null;try{if(!e?.isConnected)throw new Error("Wallet not connected");const o=String(r||"").trim();if(!o)throw new Error("Paste a seller PSBT first");const s=Number(t||0);if(!Number.isFinite(s)||s<=0)throw new Error("Set a fee rate first (sat/vB) before building a buyer-funded PSBT.");const l=e?.provider||window.NexusWalletConnect;if(!l)throw new Error("Wallet provider not available");const c=e?.paymentAddress||e?.address||e?.ordinalsAddress,u=e?.ordinalsAddress||e?.address||e?.paymentAddress;if(!c)throw new Error("Wallet payment/change address not available");if(!u)throw new Error("Wallet ordinals/receive address not available");const d=P(c);if(!Array.isArray(d)||0===d.length)throw new Error("No spendable payment UTXOs loaded. Click \u201cFetch UTXOs\u201d first (or select UTXOs).");const p=d.reduce((e,t)=>e+(Number(t?.value)||0),0);let f=d;if(d.length<3){try{E("Checking offer requirements before split-funding\u2026");const{estimateBuyNeedFromSellerOfferPsbt:e}=await n(async()=>{const{estimateBuyNeedFromSellerOfferPsbt:e}=await Promise.resolve().then(()=>Zo);return{estimateBuyNeedFromSellerOfferPsbt:e}},__VITE_PRELOAD__),t=await e({walletProvider:l,sellerOfferPsbt:o,buyerChangeAddress:c,feeRateSatPerVb:s}),r=BigInt(Math.max(0,Math.floor(Number(p)||0))),i=BigInt(t?.needTotalSats||0n);if(i>0n&&r<i){const e=i-r;throw new Error(`Insufficient buyer funds to proceed (skipping split-funding). Need >= ${i.toString()} sats (estFee\u2248${String(t?.feeEstimateSats||"?")}), have ${r.toString()} sats, short ${e.toString()} sats.`)}}catch(a){const e=a?.message||String(a);if(String(e).includes("skipping split-funding"))throw a}E("Not enough payment UTXOs \u2014 creating split funding tx first...");const{createSplitFundingTransaction:t}=await n(async()=>{const{createSplitFundingTransaction:e}=await Promise.resolve().then(()=>ms);return{createSplitFundingTransaction:e}},__VITE_PRELOAD__),r=await t({walletProvider:l,networkName:e.network?.toLowerCase?.()||"mainnet",paymentAddress:c,paymentPublicKeyHex:e?.paymentPublicKey||null,paymentCandidates:d,feeRateSatPerVb:s,dummySats:600,minRemainderSats:546,label:"buy-funding-split-manual-2step"});if(i=r?.txid||null,i&&E(`Split funding tx broadcasted. Mempool: ${Tt(`/tx/${i}`)}. Continuing\u2026`),f=[...d.filter(e=>`${e.txid}:${e.vout}`!==r.spentOutpoint),...r.splitUtxos||[]],f.length<3)throw new Error("Split completed but still insufficient payment UTXOs. Click \u201cFetch UTXOs\u201d and try again.")}const{createBuyerFundedPsbtForSellerCountersign:m}=await n(async()=>{const{createBuyerFundedPsbtForSellerCountersign:e}=await Promise.resolve().then(()=>Zo);return{createBuyerFundedPsbtForSellerCountersign:e}},__VITE_PRELOAD__);E("Building buyer-funded PSBT \u2192 wallet signing buyer inputs...");const g=await m({walletProvider:l,sellerOfferPsbt:o,buyerPaymentUtxos:f,buyerChangeAddress:c,buyerReceiveAddress:u,feeRateSatPerVb:s}),h=g?.signedBuyerPsbtBase64||"";if(h)try{const{sanitizePsbtForSharing:e}=await n(async()=>{const{sanitizePsbtForSharing:e}=await Promise.resolve().then(()=>ps);return{sanitizePsbtForSharing:e}},__VITE_PRELOAD__);v(await e(h,{profile:"wallet"}))}catch{v(h)}else v("");E("Buyer-funded PSBT ready. Send it to the seller to countersign & broadcast.")}catch(Pk){E("");let t=Pk?.message||String(Pk);i&&(t=`${t} | Split funding tx: ${i} | Mempool: ${Tt(`/tx/${i}`)}`),I(t)}},[t,P,e]),M=Bc.useCallback(async t=>{C(""),k("");try{if(!e?.isConnected)throw new Error("Wallet not connected");const r=String(t||"").trim();if(!r)throw new Error("Paste a buyer-funded PSBT first");const i=e?.provider||window.NexusWalletConnect;if(!i)throw new Error("Wallet provider not available");const{loadBitcoinLibFromInscription:a}=await n(async()=>{const{loadBitcoinLibFromInscription:e}=await Promise.resolve().then(()=>An);return{loadBitcoinLibFromInscription:e}},__VITE_PRELOAD__),{signAndBroadcastPsbt:o,broadcastTransaction:s}=await n(async()=>{const{signAndBroadcastPsbt:e,broadcastTransaction:t}=await Promise.resolve().then(()=>ir);return{signAndBroadcastPsbt:e,broadcastTransaction:t}},__VITE_PRELOAD__),l=await a(),c="undefined"!=typeof window&&window.__NEXUS_NETWORK__||"mainnet",u=String(c).toLowerCase(),d="testnet"===u||"signet"===u||"regtest"===u?l.networks.testnet:l.networks.bitcoin;let p;try{p=l.Psbt.fromBase64(r,{network:d})}catch{p=l.Psbt.fromHex(r,{network:d})}if(p.inputCount<3)throw new Error("Buyer-funded PSBT must have at least 3 inputs (Open Store template).");const f=2,m=e=>{if(!e)return null;try{return Buffer.from(e).toString("hex")}catch{return null}},g=(e,t)=>{try{const n=e?.txInputs?.[t];if(!n)return null;const r=n?.hash?Buffer.from(n.hash).reverse().toString("hex"):null,i="number"==typeof n?.index?n.index:"number"==typeof n?.vout?n.vout:null;return r&&null!==i?`${r.toLowerCase()}:${Math.floor(Number(i))}`:null}catch{return null}},h=e=>{const t=e?.txOutputs?.[1]||null,n=e?.txOutputs?.[2]||null,r=e?.txOutputs?.[3]||null;return{sellerPrevout:g(e,f),out1:{value:Number(t?.value??NaN),scriptHex:m(t?.script)},out2:{value:Number(n?.value??NaN),scriptHex:m(n?.script)},out3:r?{value:Number(r?.value??NaN),scriptHex:m(r?.script)}:null}},b=(e,t)=>{const n=h(t);if(!e?.sellerPrevout||!n?.sellerPrevout||e.sellerPrevout!==n.sellerPrevout)throw new Error("OODL_BUY_WALLET_MUTATED_SELLER_INPUT_OUTPOINT");if(!e?.out1?.scriptHex||!n?.out1?.scriptHex||e.out1.scriptHex!==n.out1.scriptHex)throw new Error("OODL_BUY_WALLET_MUTATED_INSCRIPTION_OUTPUT_SCRIPT");if(!Number.isFinite(e?.out1?.value)||!Number.isFinite(n?.out1?.value)||e.out1.value!==n.out1.value)throw new Error("OODL_BUY_WALLET_MUTATED_INSCRIPTION_OUTPUT_VALUE");if(!e?.out2?.scriptHex||!n?.out2?.scriptHex||e.out2.scriptHex!==n.out2.scriptHex)throw new Error("OODL_BUY_WALLET_MUTATED_SELLER_PAYOUT_SCRIPT");if(!Number.isFinite(e?.out2?.value)||!Number.isFinite(n?.out2?.value)||e.out2.value!==n.out2.value)throw new Error("OODL_BUY_WALLET_MUTATED_SELLER_PAYOUT_VALUE");if(e?.out3){if(!n?.out3)throw new Error("OODL_BUY_WALLET_MUTATED_PLATFORM_FEE_MISSING");if(!e.out3.scriptHex||!n.out3.scriptHex||e.out3.scriptHex!==n.out3.scriptHex)throw new Error("OODL_BUY_WALLET_MUTATED_PLATFORM_FEE_SCRIPT");if(!Number.isFinite(e.out3.value)||!Number.isFinite(n.out3.value)||e.out3.value!==n.out3.value)throw new Error("OODL_BUY_WALLET_MUTATED_PLATFORM_FEE_VALUE")}},y=h(p),x=p?.data?.inputs?.[f]||{};let w=null;try{const e=x?.witnessUtxo?.script||null;e&&(w=l.address.fromOutputScript(e,d))}catch{w=null}const v=w||e?.ordinalsAddress||e?.address||e?.paymentAddress||null;if(!v)throw new Error("Could not infer seller input address for signing.");k("Requesting seller signature (countersign)...");const S=await o(i,p.toHex(),{autoFinalized:!1,toSignInputs:[{index:f,address:v}]},!1),E=S?.signedPsbt||null;if(!E)throw new Error("Seller wallet did not return a signed PSBT");const N=l.Psbt.fromHex(E,{network:d});try{b(y,N)}catch(Pk){throw new Error(`Seller countersign mutated PSBT invariants: ${Pk?.message||Pk}`)}try{N.finalizeAllInputs()}catch{for(let e=0;e<N.inputCount;e+=1)try{N.finalizeInput(e)}catch{}}const I=N.extractTransaction().toHex(),A=await s(i,{txHex:I,psbtBase64:Buffer.from(E,"hex").toString("base64")},"testnet"===u||"signet"===u||"regtest"===u?"testnet":"mainnet","oodl-manual-2step-sell"),T=String(A||"").slice(0,12);k(A?`Broadcasted sale. txid=${T}\u2026`:"Broadcast attempted (no txid returned).")}catch(Pk){k(""),C(Pk?.message||String(Pk))}},[e]);return{manualSellerPsbt:l,manualSellerStatus:u,manualSellerError:p,onCreateManualSellerOfferPsbt:_,manualBuyStatus:m,manualBuyError:h,manualBuySuccessResult:y,clearManualBuySuccessResult:L,onBuyFromSellerOfferPsbt:O,manualBuyerFundedPsbt:w,manualBuyerFundedStatus:S,manualBuyerFundedError:N,onCreateBuyerFundedPsbtForSeller:F,manualSellerCountersignStatus:A,manualSellerCountersignError:T,onCountersignAndBroadcastFromBuyerFundedPsbt:M}}({walletState:e,feeRate:ce,selectedSaleInscription:Vt(),salePriceSats:ht,saleMinBlockHeight:It,selectedUtxos:ge,cachedFilteredUtxos:h}),Zt=function({walletState:e,feeRate:t,selectedParents:r,selectedUtxos:i,cachedFilteredUtxos:a,salePriceSats:o,listingScriptAddress:s,listingMarkerValueSats:l,listingDryRun:c,saleMinBlockHeight:u,beginTxBusy:d,endTxBusy:p}){const[f,m]=Bc.useState(""),[g,h]=Bc.useState(""),[b,y]=Bc.useState("");return{bulkSellerStatus:f,bulkSellerError:g,bulkBundleJson:b,onCreateBulkListingTx:async(f={})=>{h(""),m(""),y(""),d?.();try{if(!e?.isConnected)throw new Error("Wallet not connected");const d=Array.isArray(r)?r:[];if(0===d.length)throw new Error("Select one or more inscriptions first");const{parseUserPriceToSats:p}=await n(async()=>{const{parseUserPriceToSats:e}=await Promise.resolve().then(()=>LN);return{parseUserPriceToSats:e}},__VITE_PRELOAD__),g=p(o),h=String(s||"").trim()||null,b=(e=>{if(null==e||""===e)return null;const t=Number(e);if(!Number.isFinite(t))return null;const n=Math.floor(t);return n<0?null:n})(f?.minBlockHeight??u);if(null!==b){const{fetchBlockHeightViaProxy:e}=await n(async()=>{const{fetchBlockHeightViaProxy:e}=await Promise.resolve().then(()=>Ei);return{fetchBlockHeightViaProxy:e}},__VITE_PRELOAD__),t="undefined"!=typeof window&&window.__NEXUS_NETWORK__||"mainnet";let r;try{r=await e(t)}catch{r=null}const i=Number(r);if(!Number.isFinite(i))throw new Error('Unable to fetch chain tip height to validate "Not valid before block". Clear the field or try again.');const a=Math.floor(i);if(b<=a)throw new Error(`Not valid before block must be > tip height (${a}). Clear it to list immediately.`)}const x=String(l||"").trim();let w=null;if(x){if(!/^[0-9]+$/.test(x))throw new Error("Enter a valid listing script funding amount (integer sats)");const e=Number.parseInt(x,10);if(!Number.isFinite(e)||e<=0)throw new Error("Listing script funding must be > 0 sats");w=e}const v=a?Array.isArray(a)?a:a.spendable||[]:[],S=e?.provider||window.NexusWalletConnect;if(!S)throw new Error("Wallet provider not available");const E=e?.paymentAddress||e?.address;if(!E)throw new Error("Wallet payment address not available");const N=e?.ordinalsAddress||e?.address;if(!N)throw new Error("Wallet ordinals address not available");const I=t=>{if(!t)return null;const n=t?.fullUtxo||t?.utxo||t?.raw||t?.full||t,r=n.txid||n.txId||n.hash,i=n.vout??n.index??n.n,a=n.value??n.satoshis??n.amount,o=n.address||n.addr||E;if(!r||null==i)return null;const s=Number(a);if(!Number.isFinite(s)||s<=0)return null;const l=e?.ordinalsAddress||null,c=e?.paymentAddress||null;if(l&&c&&String(l).trim()!==String(c).trim()){const e=String(o||"").trim();if(e&&e===String(l).trim())return null}return{...t,txid:String(r),vout:Number(i),value:s,address:o}},A=new Set(d.map(e=>{const t=e?.utxo,n=t?.txid,r=t?.vout;return n&&null!=r?`${n}:${r}`:null}).filter(Boolean)),k=Array.isArray(i)?i:[],T=[...Array.isArray(v)?v:[],...k].map(I).filter(Boolean).filter(e=>!A.has(`${e.txid}:${e.vout}`)),C=new Map;T.forEach(e=>C.set(`${e.txid}:${e.vout}`,e));const B=Array.from(C.values()).sort((e,t)=>(t.value||0)-(e.value||0));if(B.length<d.length)throw new Error(`Bulk listing needs at least ${d.length} funding UTXO(s), but only ${B.length} are available. Fetch UTXOs, select more payment UTXOs, or consolidate.`);const{createAndBroadcast3TxSaleListingFlow:P}=await n(async()=>{const{createAndBroadcast3TxSaleListingFlow:e}=await Promise.resolve().then(()=>fo);return{createAndBroadcast3TxSaleListingFlow:e}},__VITE_PRELOAD__),{getOODLFeeOutput:_,getOODLCollectionFeeOutput:O,setDynamicOODLCollections:L}=await n(async()=>{const{getOODLFeeOutput:e,getOODLCollectionFeeOutput:t,setDynamicOODLCollections:n}=await Promise.resolve().then(()=>As);return{getOODLFeeOutput:e,getOODLCollectionFeeOutput:t,setDynamicOODLCollections:n}},__VITE_PRELOAD__),{loadCollectionsRegistry:F,matchCollectionForInscription:M}=await n(async()=>{const{loadCollectionsRegistry:e,matchCollectionForInscription:t}=await Promise.resolve().then(()=>Ol);return{loadCollectionsRegistry:e,matchCollectionForInscription:t}},__VITE_PRELOAD__),R=String(f?.collectionKey||"").trim()||null;let $=[];try{const e=await F({forceRefresh:!1});$=Array.isArray(e?.collections)?e.collections:[],L($)}catch{$=[]}const U=t=>{const n=t?.id||t?.inscriptionId||t?.inscription_id;if(!n)throw new Error("A selected inscription is missing inscription id");const r=t?.utxo;if(!r?.txid||void 0===r?.vout)throw new Error(`Selected inscription ${String(n).slice(0,12)}\u2026 is missing UTXO data. Refresh and try again.`);const i={...r,address:r?.address||r?.addr||e?.ordinalsAddress||null};if(!i?.address)throw new Error("Parent UTXO missing address. Ensure wallet ordinalsAddress is available.");return{inscriptionId:String(n),parentUtxo:i}},z=async e=>{if(!R){try{const t=await M(e,$);if(t)return String(t)}catch{}try{const{detectAndVerifyBitmapByInscriptionId:t}=await n(async()=>{const{detectAndVerifyBitmapByInscriptionId:e}=await Promise.resolve().then(()=>zs);return{detectAndVerifyBitmapByInscriptionId:e}},__VITE_PRELOAD__),r=await t(e);if("bitmap"===r?.type&&r?.verified)return"bitmap"}catch{}try{const{detectAndVerifyParcelByInscriptionId:t}=await n(async()=>{const{detectAndVerifyParcelByInscriptionId:e}=await Promise.resolve().then(()=>qs);return{detectAndVerifyParcelByInscriptionId:e}},__VITE_PRELOAD__),r=await t(e);if("parcel"===r?.type&&r?.verified)return"parcel"}catch{}return null}if("uncategorized"===R)return null;if("bitmap"===String(R).toLowerCase()){const{detectAndVerifyBitmapByInscriptionId:t}=await n(async()=>{const{detectAndVerifyBitmapByInscriptionId:e}=await Promise.resolve().then(()=>zs);return{detectAndVerifyBitmapByInscriptionId:e}},__VITE_PRELOAD__),r=await t(e);if("bitmap"!==r?.type||!r?.verified)throw new Error("Selected collection is bitmap, but at least one selected parent is not OCI-verified as a bitmap.");return"bitmap"}if("parcel"===String(R).toLowerCase()){const{detectAndVerifyParcelByInscriptionId:t}=await n(async()=>{const{detectAndVerifyParcelByInscriptionId:e}=await Promise.resolve().then(()=>qs);return{detectAndVerifyParcelByInscriptionId:e}},__VITE_PRELOAD__),r=await t(e);if("parcel"!==r?.type||!r?.verified)throw new Error('Selected collection is parcel, but at least one selected parent does not look like a parcel inscription (expected "{parcel}.{bitmap}.bitmap").');return"parcel"}const t=$.find(e=>String(e?.key||"").trim()===R)||null;if(!t)throw new Error("Selected collection not found in registry.");if(await M(e,[t])!==R)throw new Error("At least one selected parent does not match the selected collection rules.");return String(R)};m(c?`Dry run: creating ${d.length} listings (no broadcast)\u2026`:`Creating ${d.length} listings\u2026 watch for wallet popups.`);const D=d.map(U),H=[];for(const e of D)H.push(await z(e.inscriptionId));const W=[],j=new Set;for(let e=0;e<D.length;e++){const{inscriptionId:r,parentUtxo:i}=D[e],a=B.find(e=>!j.has(`${e.txid}:${e.vout}`));if(!a)throw new Error("Ran out of funding UTXOs during bulk listing. Consolidate and try again.");j.add(`${a.txid}:${a.vout}`);const o=H[e]||null,s=O(o)||_();let l=null,u=null;if("bitmap"===String(o||"").toLowerCase())try{const{detectAndVerifyBitmapByInscriptionId:e}=await n(async()=>{const{detectAndVerifyBitmapByInscriptionId:e}=await Promise.resolve().then(()=>zs);return{detectAndVerifyBitmapByInscriptionId:e}},__VITE_PRELOAD__),t=await e(r);l=Number.isFinite(Number(t?.bitmapNumber))?Math.floor(Number(t.bitmapNumber)):null}catch{l=null}if("parcel"===String(o||"").toLowerCase())try{const{detectAndVerifyParcelByInscriptionId:e}=await n(async()=>{const{detectAndVerifyParcelByInscriptionId:e}=await Promise.resolve().then(()=>qs);return{detectAndVerifyParcelByInscriptionId:e}},__VITE_PRELOAD__),t=await e(r);u=Number.isFinite(Number(t?.parcelNumber))?Math.floor(Number(t.parcelNumber)):null,l=Number.isFinite(Number(t?.bitmapNumber))?Math.floor(Number(t.bitmapNumber)):null}catch{u=null,l=null}const d=["Sign commit","Extract txid","Sign offer","Sign reveal","Local-sign carrier","Broadcast commit","Broadcast reveal"];m({title:`Listing ${e+1} of ${D.length}`,steps:IE(d,{step:0,status:"pending"})});const p={parentInscriptionId:r,collectionKey:o,sellerAddress:E,priceSats:BigInt(g),...null!==b?{minBlockHeight:b}:{},...Number.isFinite(Number(u))?{parcelNumber:Math.floor(Number(u))}:{},...Number.isFinite(Number(l))?{bitmapNumber:Math.floor(Number(l))}:{}},f=await P({walletProvider:S,parentUtxo:i,fundingUtxo:a,fundingUtxos:[a],listingScriptAddress:h,markerValueSats:w,sellerChangeAddress:E,feeRateSatPerVb:t,marker:p,emitOpReturnMarker:!1,emitParcelHintOpReturn:!1,broadcast:!c,oodlFeeAddress:s?.address||null,oodlFeeSats:s?.value||null,onProgress:c?null:t=>m({title:`Listing ${e+1} of ${D.length}`,steps:IE(d,t)})});if("3tx-complete"!==f?.mode)throw new Error(`Bulk listing halted: wallet cannot complete listing flow (mode=${String(f?.mode||"unknown")}).`);W.push({parentInscriptionId:r,collectionKey:o,commitTxid:f?.commitTxid||null,revealTxid:f?.revealTxid||f?.markerTxid||null,parentOutpointAfterCommit:f?.parentOutpointAfterCommit||null,listingFundingOutpoint:f?.listingFundingOutpoint||null,listingScriptAddress:f?.listingScriptAddress||h||null,sellerListingPsbtHashHex:f?.sellerListingPsbtHashHex||null,sellerListingPsbtBase64:f?.sellerListingPsbtBase64||null,broadcasted:!1!==f?.broadcasted}),e<D.length-1&&await new Promise(e=>setTimeout(e,350))}const V={version:1,type:"oodl-bulk-listings",createdAt:(new Date).toISOString(),network:String(e?.network||"").trim()||null,sellerAddress:E,ordinalsAddress:N,priceSats:String(g),listingDryRun:!!c,listings:W},q=JSON.stringify(V,null,2);y(q),m(`Bulk complete: ${W.length}/${d.length} listings. Bundle JSON ready.`)}catch(Pk){m(""),h(Pk?.message||String(Pk))}finally{p?.()}},setBulkBundleJson:y}}({walletState:e,feeRate:ce,selectedParents:p,selectedUtxos:ge,cachedFilteredUtxos:h,salePriceSats:ht,listingScriptAddress:yt,listingMarkerValueSats:wt,listingDryRun:St,saleMinBlockHeight:It,beginTxBusy:pt,endTxBusy:ft}),en=Zt?.onCreateBulkListingTx,nn=Zt?.bulkSellerStatus||"",rn=Zt?.bulkSellerError||"",an=Zt?.bulkBundleJson||"",on=function({walletState:e,feeRate:t,selectedParents:r,selectedUtxos:i,cachedFilteredUtxos:a,listingDryRun:o,saleMinBlockHeight:s,beginTxBusy:l,endTxBusy:c}){const[u,d]=Bc.useState(""),[p,f]=Bc.useState(""),[m,g]=Bc.useState(null),[h,b]=Bc.useState({}),y=Bc.useCallback((e,t)=>{b(n=>({...n,[e]:{...n[e]||{},priceBtc:String(t)}}))},[]),x=Bc.useCallback(e=>{const t=Array.isArray(r)?r:[],n={};for(const r of t){const t=r?.id||r?.inscriptionId||r?.inscription_id;t&&(n[t]={priceBtc:String(e)})}b(n)},[r]);return{multiSellerStatus:u,multiSellerError:p,multiListingResult:m,clearMultiListingResult:Bc.useCallback(()=>{g(null)},[]),assetPricing:h,updateAssetPrice:y,setUniformPrice:x,onCreateMultiListingTx:async(u={})=>{f(""),d(""),g(null),l?.();try{if(!e?.isConnected)throw new Error("Wallet not connected");const l=Array.isArray(r)?r:[];if(l.length<2)throw new Error("Select at least 2 inscriptions for multi-asset listing");const c=String(u?.collectionKey||"").trim()||null;if(!c||"uncategorized"===c)throw new Error("Select a collection before creating a multi-asset listing. All items must belong to the same collection.");d(`Verifying all ${l.length} inscriptions belong to "${c}"\u2026`);const{matchCollectionForInscription:p,loadCollectionsRegistry:m}=await n(async()=>{const{matchCollectionForInscription:e,loadCollectionsRegistry:t}=await Promise.resolve().then(()=>Ol);return{matchCollectionForInscription:e,loadCollectionsRegistry:t}},__VITE_PRELOAD__),{setDynamicOODLCollections:b}=await n(async()=>{const{setDynamicOODLCollections:e}=await Promise.resolve().then(()=>As);return{setDynamicOODLCollections:e}},__VITE_PRELOAD__);let y=[];try{const e=await m();y=Array.isArray(e?.collections)?e.collections:[],y.length>0&&b(y)}catch{y=[]}const x=[];for(const e of l){const t=e?.id||e?.inscriptionId||e?.inscription_id||"";if(t)if("bitmap"!==c)if("parcel"!==c){try{const e=await p(t,y);if(String(e||"").trim().toLowerCase()===c.toLowerCase())continue}catch{}x.push(t)}else{try{const{detectAndVerifyParcelByInscriptionId:e}=await n(async()=>{const{detectAndVerifyParcelByInscriptionId:e}=await Promise.resolve().then(()=>qs);return{detectAndVerifyParcelByInscriptionId:e}},__VITE_PRELOAD__),r=await e(t);if("parcel"===r?.type&&r?.verified)continue}catch{}x.push(t)}else{try{const{detectAndVerifyBitmapByInscriptionId:e}=await n(async()=>{const{detectAndVerifyBitmapByInscriptionId:e}=await Promise.resolve().then(()=>zs);return{detectAndVerifyBitmapByInscriptionId:e}},__VITE_PRELOAD__),r=await e(t);if("bitmap"===r?.type&&r?.verified)continue}catch{}x.push(t)}}if(x.length>0){const e=x.slice(0,3).map(e=>String(e).slice(0,12)+"\u2026").join(", ");throw new Error(`${x.length} inscription(s) don't match the "${c}" collection: ${e}${x.length>3?` (+${x.length-3} more)`:""}. All items in a multi-asset listing must be from the same collection.`)}const{parseUserPriceToSats:w}=await n(async()=>{const{parseUserPriceToSats:e}=await Promise.resolve().then(()=>LN);return{parseUserPriceToSats:e}},__VITE_PRELOAD__),v=u?.assetPricing&&"object"==typeof u.assetPricing&&Object.keys(u.assetPricing).length>0?u.assetPricing:h,S=[],E=[];for(let t=0;t<l.length;t++){const n=l[t],r=n?.id||n?.inscriptionId||n?.inscription_id;if(!r)throw new Error(`Inscription ${t+1} is missing an ID`);const i=n?.utxo;if(!i?.txid||void 0===i?.vout)throw new Error(`Inscription ${String(r).slice(0,12)}\u2026 is missing UTXO data. Refresh and try again.`);const a={...i,address:i?.address||i?.addr||e?.ordinalsAddress||null};if(!a?.address)throw new Error(`Inscription ${String(r).slice(0,12)}\u2026 UTXO has no address.`);const o=v[r],s=o?.priceBtc||"";if(!s.trim())throw new Error(`Set a price for inscription ${String(r).slice(0,12)}\u2026`);const c=w(s);if(!c||c<=0)throw new Error(`Invalid price for inscription ${String(r).slice(0,12)}\u2026`);E.push(a),S.push({inscriptionId:r,priceSats:BigInt(c),collectionKey:u?.collectionKey||null,bitmapNumber:null,parcelNumber:null,sellerAddress:e?.paymentAddress||e?.address})}if(c&&"uncategorized"!==c)for(let e=0;e<S.length;e++){if(S[e].collectionKey=c,"bitmap"===String(c).toLowerCase())try{const{detectAndVerifyBitmapByInscriptionId:t}=await n(async()=>{const{detectAndVerifyBitmapByInscriptionId:e}=await Promise.resolve().then(()=>zs);return{detectAndVerifyBitmapByInscriptionId:e}},__VITE_PRELOAD__),r=await t(S[e].inscriptionId);"bitmap"===r?.type&&r?.verified&&(S[e].bitmapNumber=Number.isFinite(Number(r?.bitmapNumber))?Math.floor(Number(r.bitmapNumber)):null)}catch{}if("parcel"===String(c).toLowerCase())try{const{detectAndVerifyParcelByInscriptionId:t}=await n(async()=>{const{detectAndVerifyParcelByInscriptionId:e}=await Promise.resolve().then(()=>qs);return{detectAndVerifyParcelByInscriptionId:e}},__VITE_PRELOAD__),r=await t(S[e].inscriptionId);"parcel"===r?.type&&r?.verified&&(S[e].parcelNumber=Number.isFinite(Number(r?.parcelNumber))?Math.floor(Number(r.parcelNumber)):null,S[e].bitmapNumber=Number.isFinite(Number(r?.bitmapNumber))?Math.floor(Number(r.bitmapNumber)):null)}catch{}}const N=(e=>{if(null==e||""===e)return null;const t=Number(e);if(!Number.isFinite(t))return null;const n=Math.floor(t);return n<0?null:n})(u?.minBlockHeight??s);if(null!==N){const{fetchBlockHeightViaProxy:e}=await n(async()=>{const{fetchBlockHeightViaProxy:e}=await Promise.resolve().then(()=>Ei);return{fetchBlockHeightViaProxy:e}},__VITE_PRELOAD__),t="undefined"!=typeof window&&window.__NEXUS_NETWORK__||"mainnet";let r;try{r=await e(t)}catch{r=null}const i=Number(r);if(Number.isFinite(i)&&N<=Math.floor(i))throw new Error(`"Not valid before block" must be > tip height (${Math.floor(i)}). Clear it to list immediately.`)}const I=e?.provider||window.NexusWalletConnect;if(!I)throw new Error("Wallet provider not available");const A=e?.paymentAddress||e?.address;if(!A)throw new Error("Wallet payment address not available");const k=a?Array.isArray(a)?a:a.spendable||[]:[],T=new Set(E.map(e=>`${e.txid}:${e.vout}`)),C=t=>{if(!t)return null;const n=t?.fullUtxo||t?.utxo||t?.raw||t?.full||t,r=n.txid||n.txId||n.hash,i=n.vout??n.index??n.n,a=n.value??n.satoshis??n.amount,o=n.address||n.addr||A;if(!r||null==i)return null;const s=Number(a);if(!Number.isFinite(s)||s<=0)return null;const l=e?.ordinalsAddress||null,c=e?.paymentAddress||null;return l&&c&&String(l).trim()!==String(c).trim()&&String(o||"").trim()===String(l).trim()?null:{...t,txid:String(r),vout:Number(i),value:s,address:o}},B=Array.isArray(i)?i:[],P=[...Array.isArray(k)?k:[],...B].map(C).filter(Boolean).filter(e=>!T.has(`${e.txid}:${e.vout}`)),_=new Map;P.forEach(e=>_.set(`${e.txid}:${e.vout}`,e));const O=Array.from(_.values()).sort((e,t)=>(t.value||0)-(e.value||0));if(0===O.length)throw new Error('No spendable funding UTXOs. Click "Fetch UTXOs" first.');const{getOODLFeeOutput:L,getOODLCollectionFeeOutput:F}=await n(async()=>{const{getOODLFeeOutput:e,getOODLCollectionFeeOutput:t}=await Promise.resolve().then(()=>As);return{getOODLFeeOutput:e,getOODLCollectionFeeOutput:t}},__VITE_PRELOAD__),M=F(c)||L(),R=["Sign commit","Extract txid","Sign offers","Sign reveal","Local-sign carrier","Broadcast commit","Broadcast reveal"];o&&d(`Dry run: building multi-asset listing for ${l.length} inscriptions\u2026`);const{createAndBroadcastMultiAsset3TxSaleListingFlow:$}=await n(async()=>{const{createAndBroadcastMultiAsset3TxSaleListingFlow:e}=await Promise.resolve().then(()=>fo);return{createAndBroadcastMultiAsset3TxSaleListingFlow:e}},__VITE_PRELOAD__),U=await $({walletProvider:I,parentUtxos:E,assetItems:S,fundingUtxos:O,sellerChangeAddress:A,feeRateSatPerVb:t,broadcast:!o,oodlFeeAddress:M?.address||null,oodlFeeSats:M?.value||null,compressEmbeddedOffer:!0,minBlockHeight:N,onProgress:o?null:e=>d(IE(R,e))});if("multi-asset-3tx-complete"===U?.mode){g(U);const e=String(U.commitTxid||"").slice(0,12),t=String(U.revealTxid||"").slice(0,12);d(U.broadcasted?`\u2705 Multi-asset listing complete! ${U.assetCount} assets in one TX. commit=${e}\u2026 reveal=${t}\u2026 (${U.embeddedPayloadBytes} bytes${U.compressed?", Brotli":""})`:`Dry run complete. ${U.assetCount} assets. commit=${e}\u2026 reveal=${t}\u2026`)}else"needs-external-signer"===U?.mode?(d(""),f(U.message||"Wallet refused to sign one or more offer PSBTs.")):(d(""),f("Unexpected result from multi-asset listing flow."))}catch(Pk){d(""),f(Pk?.message||String(Pk))}finally{c?.()}}}}({walletState:e,feeRate:ce,selectedParents:p,selectedUtxos:ge,cachedFilteredUtxos:h,listingDryRun:St,saleMinBlockHeight:It,beginTxBusy:pt,endTxBusy:ft}),sn=on?.onCreateMultiListingTx,ln=on?.multiSellerStatus||"",cn=on?.multiSellerError||"",un=on?.multiListingResult||null,dn=on?.clearMultiListingResult||(()=>{}),pn=on?.assetPricing||{},fn=on?.updateAssetPrice,mn=on?.setUniformPrice,gn=Bc.useRef("");Bc.useEffect(()=>{if("multi-asset-3tx-complete"!==un?.mode)return;const e=String(un?.revealTxid||"").trim();e&&gn.current!==e&&(gn.current=e,Jt({...un,commitTxid:un?.commitTxid||null,revealTxid:un?.revealTxid||null,broadcasted:!1!==un?.broadcasted}))},[un,Jt]);const hn=function({walletState:e,walletInscriptions:t,selectedParents:r,setSelectedParents:i,setReinscriptionTarget:a,setContentType:o,setContent:s,setFileName:l,setRequestedContentEditorTab:c}){const[u,d]=Pc.useState(""),[p,f]=Pc.useState(""),[m,g]=Pc.useState([]),[h,b]=Pc.useState(""),[y,x]=Pc.useState(null),[w,v]=Pc.useState(""),[S,E]=Pc.useState("");Pc.useEffect(()=>{let n=!0;return(async()=>{if(f(""),d(""),!e?.isConnected)return void(n&&(g([]),b("")));if(!zt())return void(n&&(g([]),b(""),d("Collections registry unavailable in this environment.")));const r=new Set((Array.isArray(t)?t:[]).map(e=>TA(e?.id||e?.inscriptionId||e?.inscription_id)).filter(Boolean));if(0!==r.size){d("Loading collection authority slots\u2026");try{const e=xl(),t=await Promise.all(e.map(e=>async function(e){const t=TA(e);if(!t)return[];const n=[];let r=0;for(;;){const e=kt(0===r?`/r/children/${t}`:`/r/children/${t}/${r}`),i=await PA(e);if(!i?.ids||!Array.isArray(i.ids)||0===i.ids.length)break;if(n.push(...i.ids),!i.more)break;if(r++,r>50)break}return n}(e).catch(()=>[]))),i=[...new Set(t.flat())].filter(e=>r.has(String(e)));if(!n)return;g(i),d(""),!TA(h)&&i.length>0&&b(i[0]),0===i.length&&d("No authority slot found. You must own a child of the collections registry parent to publish a collection.")}catch(Pk){if(!n)return;g([]),b(""),f(Pk?.message||String(Pk)),d("")}}else n&&(g([]),b(""))})(),()=>{n=!1}},[e?.isConnected,t]);const N=Pc.useCallback(async e=>{const t=TA(e||h);if(!t)return x(null),v(""),E(""),null;v("Loading existing manifesto\u2026"),E(""),x(null);try{const e=await LA(t);return x(e),v(e?"Previous manifesto loaded.":"No existing manifesto found on this authority sat."),e}catch(Pk){return E(Pk?.message||String(Pk)),v(""),null}},[h]);Pc.useEffect(()=>{let e=!0;const t=TA(h);return t?((async()=>{const n=await LA(t);e&&(x(n),v(n?"Previous manifesto loaded.":""),E(""))})().catch(t=>{e&&(E(t?.message||String(t)),v(""))}),()=>{e=!1}):(x(null),v(""),void E(""))},[h]);const I=Pc.useCallback(async({key:u,title:d,description:p,indexingAddress:f,feeSats:m,selectedItemIdsOverride:g,offerItemIdsOverride:b,catalogImageInscriptionId:x,galleryInscriptionId:w,includeSaleOffers:v=!1,salePriceSats:S="",salePriceByInscriptionId:E,minBlockHeightByInscriptionId:N,saleOfferItemIdsText:I="",minBlockHeight:A=null,navigateToEditor:k=!0,onProgress:T,inheritPreviousItems:C=!1,inheritPreviousOffers:B=!1}={})=>{const P=TA(h);if(!P)throw new Error("Select an authority slot (a child of the registry parent) to publish this collection.");const _=e=>{"function"==typeof T&&T(e)},O=Array.isArray(g)&&g.length>0?g.map(e=>TA(e)).filter(Boolean):(Array.isArray(r)?r:[]).map(e=>TA(e?.id)).filter(Boolean);let L=[];if(C){_("Loading previous manifesto from authority slot\u2026");const e=y??await LA(P);if(e&&Array.isArray(e.inscriptionIds)&&e.inscriptionIds.length>0){const t=new Set(O.map(e=>BA(e)).filter(Boolean));let n=0;for(const r of e.inscriptionIds){const e=BA(r);e&&(t.has(e)||(t.add(e),O.push(e),n++))}_(`Inherited ${n} inscription ID(s) from previous manifesto (${t.size} total).`),B&&Array.isArray(e.offers)&&e.offers.length>0&&(L=e.offers,_(`Carrying forward ${L.length} signed offer PSBT(s) from previous manifesto.`))}else _("No inscription IDs found in previous manifesto \u2014 starting fresh.")}const F=e=>{if(null==e||""===e)return null;const t=Number(e);if(!Number.isFinite(t))throw new Error("Block height must be a number.");const n=Math.floor(t);if(n<0)throw new Error("Block height must be >= 0.");return n},M=F(A),R=(()=>{if(!N||"object"!=typeof N)return!1;for(const e of Object.keys(N)){const t=N[e];if(null!=t&&""!==String(t).trim())return!0}return!1})();if(null!==M||R){const{fetchBlockHeightViaProxy:e}=await n(async()=>{const{fetchBlockHeightViaProxy:e}=await Promise.resolve().then(()=>Ei);return{fetchBlockHeightViaProxy:e}},__VITE_PRELOAD__),t="undefined"!=typeof window&&window.__NEXUS_NETWORK__||"mainnet";let r;try{r=await e(t)}catch{r=null}const i=Number(r);if(!Number.isFinite(i))throw new Error('Unable to fetch chain tip height to validate "Not valid before block". Clear the field or try again.');const a=Math.floor(i);if(null!==M&&M<=a)throw new Error(`Not valid before block must be > tip height (${a}). Clear it to publish immediately-valid offers.`);if(R)for(const[n,o]of Object.entries(N||{})){const e=BA(n);if(!e)continue;const t=F(o);if(null!==t&&t<=a)throw new Error(`Not valid before block for ${e} must be > tip height (${a}). Clear it to publish immediately-valid offers.`)}}let $;if(v){const r=new Set(O),i=Array.isArray(b)&&b.length>0?b.map(e=>TA(e)).filter(Boolean):function(e){const t=TA(e);if(!t)return[];const n=t.split(/[\s,]+/g).map(e=>TA(e)).filter(Boolean),r=new Set,i=[];for(const a of n)r.has(a)||(r.add(a),i.push(a));return i}(I),a=i&&i.length>0?i.filter(e=>r.has(e)):O;if(!e?.isConnected)throw new Error("Connect a wallet before generating sale offers.");const{parseUserPriceToSats:o}=await n(async()=>{const{parseUserPriceToSats:e}=await Promise.resolve().then(()=>LN);return{parseUserPriceToSats:e}},__VITE_PRELOAD__),s=!(!E||"object"!=typeof E),l=o(S);if(!s&&(!Number.isFinite(l)||l<=0))throw new Error("Sale price sats must be > 0 to generate offers.");const c=e?.provider||window.NexusWalletConnect;if(!c)throw new Error("Wallet provider not available");const u=e?.paymentAddress||e?.address||e?.ordinalsAddress;if(!u)throw new Error("Wallet payout address not available");const d=new Set(a);a&&0!==a.length?_(`Building seller offer PSBT(s) for up to ${a.length} inscription(s)\u2026`):(_("No items selected for sale offers; proceeding without embedded offers."),$=[]);const{loadBitcoinLibFromInscription:p}=await n(async()=>{const{loadBitcoinLibFromInscription:e}=await Promise.resolve().then(()=>An);return{loadBitcoinLibFromInscription:e}},__VITE_PRELOAD__),{sanitizePsbtForSharing:f}=await n(async()=>{const{sanitizePsbtForSharing:e}=await Promise.resolve().then(()=>ps);return{sanitizePsbtForSharing:e}},__VITE_PRELOAD__),{signPsbtsWithFallback:m}=await n(async()=>{const{signPsbtsWithFallback:e}=await Promise.resolve().then(()=>er);return{signPsbtsWithFallback:e}},__VITE_PRELOAD__),{assertOpenStoreSellerOfferSignedCorrectly:g}=await n(async()=>{const{assertOpenStoreSellerOfferSignedCorrectly:e}=await Promise.resolve().then(()=>cs);return{assertOpenStoreSellerOfferSignedCorrectly:e}},__VITE_PRELOAD__),h=await p(),y="undefined"!=typeof window&&window.__NEXUS_NETWORK__||"mainnet",x=String(y).toLowerCase(),w="testnet"===x||"signet"===x||"regtest"===x?h.networks.testnet:h.networks.bitcoin,v=546,A=(h.Transaction?.SIGHASH_SINGLE??3)|(h.Transaction?.SIGHASH_ANYONECANPAY??128),k=Buffer.alloc(32,0),T={script:Buffer.from("0014"+"00".repeat(20),"hex"),value:1},C=({parentUtxo:t,priceSats:n,minHeight:r})=>{const i=t&&"object"==typeof t?t:null;if(!i?.txid||null==i?.vout)throw new Error("Selected inscription is missing UTXO data. Refresh inscriptions/UTXOs and try again.");const a=Number(i?.value);if(!Number.isFinite(a)||a<=0)throw new Error("Selected inscription UTXO is missing value. Refresh UTXOs/inscriptions and try again.");const o=TA(i?.address||i?.addr||e?.ordinalsAddress);if(!o)throw new Error("Parent UTXO missing address. Ensure wallet ordinalsAddress is available.");const s=Number(n);if(!Number.isFinite(s)||s<=0)throw new Error("Each sale offer price must be > 0 sats.");const l=new h.Psbt({network:w});if(null!=r)try{l.setLocktime(Number(r))}catch{throw new Error("Failed to set offer PSBT locktime for min block height.")}l.addInput({hash:k,index:4294967294,sequence:4294967293,witnessUtxo:T}),l.addInput({hash:k,index:4294967295,sequence:4294967293,witnessUtxo:T});const d=h.address.toOutputScript(o,w);l.addInput({hash:i.txid,index:Number(i.vout),witnessUtxo:{script:d,value:Math.floor(a)},sighashType:A,sequence:4294967293});try{const t=c?.getState?.()?.ordinalsPublicKey||c?.getState?.()?.publicKey||e?.ordinalsPublicKey||e?.publicKey||null,n="string"==typeof t?t.startsWith("0x")?t.slice(2):t:null;if("string"==typeof o&&(o.startsWith("bc1p")||o.startsWith("tb1p"))&&n&&(64===n.length||66===n.length)&&l?.data?.inputs?.[2]){const e=66===n.length?n.slice(2):n;l.data.inputs[2].tapInternalKey=Buffer.from(e,"hex")}}catch{}l.addOutput({address:u,value:0}),l.addOutput({address:u,value:v});const p=a>v?BigInt(a)-BigInt(v):0n,f=BigInt(Math.floor(s))+p;return l.addOutput({address:u,value:Number(f)}),{offerPsbt:l,signOptions:{autoFinalized:!1,toSignInputs:[{index:2,address:o,sighashType:A}]}}},B=(e,t)=>{let n,r;try{n=h.Psbt.fromHex(String(e),{network:w})}catch{n=h.Psbt.fromBase64(String(e),{network:w})}try{r=h.Psbt.fromHex(String(t),{network:w})}catch{r=null}if(!r)throw new Error("Collection offer validation failed: missing unsigned PSBT context");return g({unsignedOfferPsbt:r,signedOfferPsbt:n,sellerInputIndex:2,expectedSighashByte:131}),n.toBase64()},P=[],L=[],R=[],U=[],z=Array.isArray(t)?t:[],D=new Map;for(const e of z){const t=TA(e?.id);t&&!D.has(t)&&D.set(t,e)}for(const t of a){if(!t)continue;if(!d.has(t))continue;const n=D.get(t),r=n?.utxo;if(!r){U.push({inscriptionId:t,reason:"not in wallet (missing utxo)"});continue}const i={...r||{},address:r?.address||r?.addr||e?.ordinalsAddress||null},a=s?o(s?E?.[t]:void 0):l;if(!Number.isFinite(a)||a<=0)throw new Error(`Missing/invalid sale price for ${t}. Set a sats value > 0.`);const c=N&&"object"==typeof N?N?.[t]:void 0,u=null==c||""===String(c).trim()?null:F(c),p=null!==u?u:M;try{const e=C({parentUtxo:i,priceSats:a,minHeight:p});P.push(e.offerPsbt.toHex()),L.push(e.signOptions),R.push({inscriptionId:t,priceSats:a})}catch(Pk){U.push({inscriptionId:t,reason:Pk?.message||"failed to build offer"})}}if(U.length>0&&_(`Skipping ${U.length} inscription(s) for sale offers (not in wallet / missing UTXO).`),0===P.length)$=[],_("No signable sale offers were generated; proceeding with manifest only.");else{_(`Requesting wallet signature for ${P.length} offer PSBT(s)\u2026`);const e=await m(c,P,L);if(!Array.isArray(e)||e.length!==P.length)throw new Error("Wallet returned an unexpected response when signing multiple PSBTs.");_(`Verifying + sanitizing ${e.length} signed offer PSBT(s)\u2026`);const t=[];for(let n=0;n<e.length;n++){const r=R[n]?.inscriptionId,i=R[n]?.priceSats,a=B(e[n],P[n]),o=await f(a,{profile:"publish"});t.push({inscriptionId:r,priceSats:i,sellerOfferPsbt:o})}$=t,_(`Generated ${t.length} offer PSBT(s). Building manifest\u2026`)}}if(L.length>0){const e=new Set(($||[]).map(e=>BA(e?.inscriptionId)).filter(Boolean));let t=0;for(const n of L){const r=BA(n?.inscriptionId);r&&!e.has(r)&&($.push(n),e.add(r),t++)}t>0&&_(`Carried forward ${t} offer(s) from previous manifesto.`)}const U=function({key:e,title:t,description:n,indexingAddress:r,feeSats:i,selectedItemIds:a,saleOffers:o,minBlockHeight:s,catalogImageInscriptionId:l,galleryInscriptionId:c}){const u=CA(e),d=TA(t)||u,p=TA(n),f=TA(r);if(!u)throw new Error("Collection key is required.");if(!d)throw new Error("Collection title is required.");if(!f)throw new Error("Indexing address is required.");const m=(()=>{const e=Array.isArray(a)?a:[],t=new Set,n=[];for(const r of e){const e=BA(r);e&&(t.has(e)||(t.add(e),n.push(e)))}return n.sort(),n})(),g=(()=>{const e=Number(null==i||""===i?330:i);if(!Number.isFinite(e))throw new Error("Indexing fee sats must be a number.");if(e<330)throw new Error("Indexing fee sats must be >= 330.");return Math.floor(e)})(),h={key:u,title:d,addresses:{indexing:f}},b=BA(l);b&&(h.catalogImage={inscriptionId:b}),p&&(h.description=p),h.fee={sats:g,minSats:g};const y=TA(c),x=y&&/^[a-f0-9]{64}i\d+$/i.test(y),w=x?void 0:function(e,{minCount:t=25}={}){const n=Array.isArray(e)?e:[];if(n.length<t)return null;let r="";const i=[];for(const s of n){const e=BA(s);if(!e)return null;const t=e.match(/^([0-9a-f]{64})i(\d+)$/);if(!t)return null;if(r||(r=t[1]),t[1]!==r)return null;const n=Number(t[2]);if(!Number.isSafeInteger(n)||n<0)return null;i.push(n)}i.sort((e,t)=>e-t);const a=i[0],o=i[i.length-1];if(o-a+1!==i.length)return null;for(let s=1;s<i.length;s++)if(i[s]!==i[s-1]+1)return null;return{txid:r,start:a,end:o}}(m,{minCount:25}),v=w?{children:{include:[`${w.txid}i${w.start}-${w.end}`]}}:void 0,S=(()=>{const e={};return x&&(e.galleryInscriptionId=y),!v&&!x&&m.length>0&&(e.inscriptionIds=m),Object.keys(e).length>0?e:void 0})(),E=(()=>{const e=Array.isArray(o)?o:[],t=new Set,n=[];for(const r of e){const e=BA(r?.inscriptionId||r?.id),i=TA(r?.sellerOfferPsbt||r?.psbt),a=Number(r?.priceSats??r?.price);e&&i&&(!Number.isFinite(a)||a<=0||t.has(e)||(t.add(e),n.push({inscriptionId:e,priceSats:Math.floor(a),sellerOfferPsbt:i})))}return n.sort((e,t)=>String(e.inscriptionId).localeCompare(String(t.inscriptionId))),n})();return S&&Object.keys(S).length>0&&(h.match=S),{p:"OODL-COLLECTION",version:"1.0",meta:{title:d,description:p||void 0},registry_entry:h,...v?{indexing:v}:{},...S?{match:S}:{},...E.length>0?{open_store:{version:"1",...Number.isFinite(Number(s))?{minBlockHeight:Math.floor(Number(s))}:{},offers:E}}:{}}}({key:u,title:d,description:p,indexingAddress:f,feeSats:m,selectedItemIds:O,saleOffers:$,catalogImageInscriptionId:x,galleryInscriptionId:w,...null===M||R?{}:{minBlockHeight:M}}),z=JSON.stringify(U);"function"==typeof i&&i([]),"function"==typeof a&&a(P),"function"==typeof o&&o("application/json"),"function"==typeof s&&s(z);const D=CA(u);return"function"==typeof l&&l(D?`oodl-collection-${D}.json`:"oodl-collection.json"),k&&"function"==typeof c&&c("text"),{manifest:U,json:z}},[h,r,e,y,i,a,o,s,l,c]);return{authoritySlots:m,authorityStatus:u,authorityError:p,selectedAuthoritySlotId:h,setSelectedAuthoritySlotId:b,loadManifestIntoInscriber:I,previousManifest:y,previousManifestStatus:w,previousManifestError:S,loadPreviousManifest:N}}({walletState:e,walletInscriptions:l,selectedParents:p,setSelectedParents:f,setReinscriptionTarget:g,setContentType:I,setContent:k,setFileName:P,setRequestedContentEditorTab:Qe}),bn=hn?.authoritySlots||[],yn=hn?.authorityStatus||"",xn=hn?.authorityError||"",wn=hn?.selectedAuthoritySlotId||"",vn=hn?.setSelectedAuthoritySlotId||(()=>{}),Sn=hn?.loadManifestIntoInscriber,En=hn?.previousManifest||null,Nn=hn?.previousManifestStatus||"",In=hn?.previousManifestError||"",kn=hn?.loadPreviousManifest,Tn=Pc.useCallback(async(t={})=>{if("function"!=typeof Sn)throw new Error("Collection registry flow is not available");pt();try{const n=e=>{const n=String(e||"").trim();if(n){try{"function"==typeof t?.onProgress&&t.onProgress(n)}catch{}Se({type:"info",message:n})}};if(V(""),X(!0),n("Preparing collection manifest\u2026"),await Sn({...t||{},navigateToEditor:!1,onProgress:n}),!e?.isConnected)throw new Error("Connect a wallet before launching.");if(!ge||0===ge.length)throw new Error("Select payment UTXOs in the UTXOs tab before launching.");n("Waiting for wallet prompt\u2026"),await new Promise(e=>setTimeout(e,50));const r=oe.current;if("function"!=typeof r)throw new Error("Internal error: inscribe function not ready yet. Please retry.");await r()}finally{ft()}},[Sn,e?.isConnected,ge]),Cn=function({walletState:e,walletInscriptions:t,selectedUtxos:r,feeRate:i,setToast:a,setContentEncoding:o,setCompressBeforeInscribe:s,setSelectedParents:l,setContentType:c,setFileName:u,setContent:d,setRequestedContentEditorTab:p,handleInscribeRef:f,beginTxBusy:m,endTxBusy:g}){const[h,b]=Pc.useState(""),y=Pc.useCallback(async(h={})=>{b(""),m();const y=(e,t)=>{b({title:"Bitmap Parcels Manifesto",steps:IE(MA,{step:e,status:"active",detail:t})})},x=e=>{b({title:"Bitmap Parcels Manifesto",steps:IE(MA,{step:e,status:"done"})})};try{const m=e=>{const t=String(e||"").trim();if(t){try{"function"==typeof h?.onProgress&&h.onProgress(t)}catch{}a?.({type:"info",message:t})}},g=FA(h?.bitmapInscriptionId),w=Number(h?.bitmapNumber);if(!/^[0-9a-fA-F]{64}i\d+$/.test(g))throw new Error("Bitmap inscription id must be <txid>i<index>.");if(!Number.isFinite(w)||w<0)throw new Error("Bitmap number must be a non-negative integer.");const v=Array.isArray(h?.itemIds)?h.itemIds:[];if(0===v.length)throw new Error("Select at least one parcel inscription id to include.");const S=!!h?.includeSaleOffers,E=h?.salePriceByInscriptionId&&"object"==typeof h.salePriceByInscriptionId?h.salePriceByInscriptionId:{},N=h?.minBlockHeightByInscriptionId&&"object"==typeof h.minBlockHeightByInscriptionId?h.minBlockHeightByInscriptionId:null,I=e=>{if(null==e||""===e)return null;const t=Number(e);if(!Number.isFinite(t))throw new Error("Block height must be a number.");const n=Math.floor(t);if(n<0)throw new Error("Block height must be >= 0.");return n},A=S?I(h?.minBlockHeight):null,k=(()=>{if(!S)return!1;if(!N)return!1;for(const e of Object.keys(N)){const t=N[e];if(null!=t&&""!==String(t).trim())return!0}return!1})(),T="undefined"!=typeof window&&window.__NEXUS_NETWORK__||"mainnet";if(null!==A||k){const{fetchBlockHeightViaProxy:e}=await n(async()=>{const{fetchBlockHeightViaProxy:e}=await Promise.resolve().then(()=>Ei);return{fetchBlockHeightViaProxy:e}},__VITE_PRELOAD__);let t;try{t=await e(T)}catch{t=null}const r=Number(t);if(!Number.isFinite(r))throw new Error('Unable to fetch chain tip height to validate "Not valid before block". Clear the field or try again.');const i=Math.floor(r);if(null!==A&&A<=i)throw new Error(`Not valid before block must be > tip height (${i}). Clear it to publish immediately-valid offers.`);if(k)for(const[n,a]of Object.entries(N||{})){const e=I(a);if(null!==e&&e<=i)throw new Error(`Not valid before block for ${String(n)} must be > tip height (${i}). Clear it to publish immediately-valid offers.`)}}m("Preparing Bitmap Parcels manifesto\u2026"),y(1,"Building manifest JSON\u2026"),o?.(""),s?.(!0);const{parseUserPriceToSats:C}=await n(async()=>{const{parseUserPriceToSats:e}=await Promise.resolve().then(()=>LN);return{parseUserPriceToSats:e}},__VITE_PRELOAD__),B={p:"Bitmap Parcel",v:1,bitmap:Math.floor(w),all:!0,items:v.map(e=>({inscription_id:String(e),price_sats:null!=E?.[e]&&""!==String(E[e]).trim()?C(E[e]):null,for_sale:!!S&&null!=E?.[e]&&""!==String(E[e]).trim()})),open_store:{version:1,network:String(T),...null===A||k?{}:{minBlockHeight:A},offers:[]}};if(S){m("Creating seller offer PSBTs\u2026"),x(1),y(2,"Preparing offer PSBTs for wallet\u2026");const n=e?.provider||window.NexusWalletConnect;if(!n)throw new Error("Wallet provider not available");const r=e?.paymentAddress||e?.address||e?.ordinalsAddress;if(!r)throw new Error("Wallet payout address not available");const a=Number(i||0);if(!Number.isFinite(a)||a<=0)throw new Error("Set a fee rate first (sat/vB).");const o=Array.isArray(t)?t:[],s=new Map(o.map(e=>[String(e?.id||e?.inscriptionId||e?.inscription_id||""),e])),l=[];for(const t of v){const n=E?.[t];if(null==n||""===String(n).trim())continue;const r=s.get(String(t)),i=r?.utxo;if(!i?.txid||void 0===i?.vout)throw new Error(`Selected inscription ${t} is missing UTXO data. Refresh inscriptions/UTXOs and try again.`);const a={...i,address:i?.address||i?.addr||e?.ordinalsAddress||null},o=C(n),c=N?N?.[t]:void 0,u=null==c||""===String(c).trim()?null:I(c),d=null!==u?u:A;l.push({inscriptionId:String(t),priceSats:o,parentUtxo:a,minBlockHeight:d})}if(l.length>0){m(`Requesting wallet signature for ${l.length} offer PSBT(s)\u2026`),y(2,`Signing ${l.length} offer PSBT(s)\u2026`);const t=await go({walletState:e,walletProvider:n,offers:l.map(e=>({parentUtxo:e.parentUtxo,priceSats:e.priceSats,minBlockHeight:e.minBlockHeight})),sellerPayoutAddress:r,...null===A||k?{}:{minBlockHeight:A}});B.open_store.offers=t.map((e,t)=>({inscription_id:l[t].inscriptionId,price_sats:Number(l[t].priceSats),seller_offer_psbt:String(e)}))}}if(l?.([{id:g,omitParentTag:!0}]),c?.("application/json"),u?.("nxs-parcel-manifest.json"),d?.(JSON.stringify(B)),p?.("review"),!e?.isConnected)throw new Error("Connect a wallet before launching.");if(!r||0===r.length)throw new Error("Select payment UTXOs in the UTXOs tab before launching.");S||(x(1),b(e=>{const t=e&&e.steps?[...e.steps]:IE(MA,{step:2,status:"done"});return t[1]&&(t[1]={...t[1],status:"skipped",detail:"No sale offers"}),{title:"Bitmap Parcels Manifesto",steps:t}})),m("Waiting for wallet prompt (manifest inscription)\u2026"),x(2),y(3,"Approve the inscription in your wallet\u2026"),await new Promise(e=>setTimeout(e,50));const P=f?.current;if("function"!=typeof P)throw new Error("Internal error: inscribe function not ready yet. Please retry.");const{OODL_COLLECTION_FEES:_}=await n(async()=>{const{OODL_COLLECTION_FEES:e}=await Promise.resolve().then(()=>As);return{OODL_COLLECTION_FEES:e}},__VITE_PRELOAD__),O=_?.parcel_manifest||_?.parcel||null,L=FA(O?.address),F=Number(O?.feeSats||600);if(!L)throw new Error("Parcel indexing address not configured");const M=await P({nxsParcelManifestSelfHint:{bitmapNumber:w,all:!0,indexingAddress:L,feeSats:F}});if(x(3),y(4,"Verifying inscription result\u2026"),!M?.revealTxIds||!Array.isArray(M.revealTxIds)||!Array.isArray(M.mapping))throw new Error("Manifest inscription completed but did not return reveal txids/mapping");if(M.mapping.length<1)throw new Error("Manifest inscription mapping missing");const R=M.mapping[0],$=M.revealTxIds?.[R.segment];if(!$)throw new Error("Manifest reveal txid missing");const U=`${String($)}i${Number(R.inputIndex)}`;return m("Parcel manifesto published."),x(4),{manifestInscriptionResult:M,manifestoInscriptionId:U}}finally{setTimeout(()=>b(""),1200),g()}},[m,g,i,f,r,s,d,o,c,u,p,l,a,t,e]);return{onLaunchParcelManifest:y,manifestoStatus:h}}({walletState:e,walletInscriptions:l,selectedUtxos:ge,feeRate:ce,setToast:Se,setContentEncoding:V,setCompressBeforeInscribe:X,setSelectedParents:f,setContentType:I,setFileName:P,setContent:k,setRequestedContentEditorTab:Qe,handleInscribeRef:oe,beginTxBusy:pt,endTxBusy:ft}),Bn=Cn?.onLaunchParcelManifest,Pn=Cn?.manifestoStatus||Xt||nn||Ft||Pt||Qt?.manualSellerStatus||Qt?.manualBuyStatus||Qt?.manualBuyerFundedStatus||Qt?.manualSellerCountersignStatus||"Processing transaction\u2026",_n=(()=>{try{if(!e?.isConnected)return!1;const t=h?Array.isArray(h)?h:h.spendable||[]:[],n=e?.paymentAddress||e?.address||e?.ordinalsAddress;if(!n)return!1;const r=[...Array.isArray(t)?t:[],...Array.isArray(ge)?ge:[]],i=t=>{if(!t)return null;const r=t?.fullUtxo||t?.utxo||t?.raw||t?.full||t,i=r.txid||r.txId||r.hash,a=r.vout??r.index??r.n,o=r.value??r.satoshis??r.amount,s=r.address||r.addr||n;if(!i||null==a)return null;const l=Number(o);if(!Number.isFinite(l)||l<=0)return null;const c=e?.ordinalsAddress||null,u=e?.paymentAddress||null;if(c&&u&&c!==u){const e=String(s||"").trim();if(e&&e===String(c).trim())return null}return{txid:String(i),vout:Number(a),value:l,address:s}},a=r.map(i).filter(Boolean),o=new Map;a.forEach(e=>o.set(`${e.txid}:${e.vout}`,e));const s=Array.from(o.values());return s.length>0&&s.length<3}catch{return!1}})(),On=()=>{t&&t()},[Ln,Fn]=Bc.useState([]),[Mn,Rn]=Bc.useState(null);Pc.useEffect(()=>{Array.isArray(Ln)&&Ln.length>0||Xe("content")},[Ve,Ln,A,N,B]),Pc.useEffect(()=>{Array.isArray(Ln)&&Ln.length>0||"review"!==tt&&"fees"!==tt||at("editor")},[Ve,Ln,tt,at]),Bc.useEffect(()=>{kE(),(async()=>{const{clearCachedInscriptions:e}=await n(async()=>{const{clearCachedInscriptions:e}=await Promise.resolve().then(()=>kk);return{clearCachedInscriptions:e}},__VITE_PRELOAD__),{clearCachedCompleteData:t}=await n(async()=>{const{clearCachedCompleteData:e}=await Promise.resolve().then(()=>Fr);return{clearCachedCompleteData:e}},__VITE_PRELOAD__);Object.keys(sessionStorage).filter(e=>e.startsWith("nexus_inscriptions_")).forEach(e=>sessionStorage.removeItem(e)),Object.keys(sessionStorage).filter(e=>e.startsWith("nexus_complete_")).forEach(e=>sessionStorage.removeItem(e))})()},[]),Bc.useEffect(()=>{(async()=>{if(!e?.isConnected)return;if(l.length>0)return;if(u)return;const t=e.ordinalsAddress||e.address;if(!t)return;const{getCachedInscriptions:r}=await n(async()=>{const{getCachedInscriptions:e}=await Promise.resolve().then(()=>kk);return{getCachedInscriptions:e}},__VITE_PRELOAD__),i=r(t);i&&i.length>0&&(c(i),d(!1))})()},[e?.isConnected,e?.ordinalsAddress,l.length,u]),Bc.useEffect(()=>{e?.isConnected||(we(!1),"undefined"!=typeof window&&"inscribing"===window.__nexusGlobalLoading&&(window.__nexusGlobalLoading=null),c([]),f([]),g(null),b(null),he([]),ye(null),Fn([]),Rn(null),Se(null),Ne(null),Jt(null),Ae(null),Mt(""),$t(""),Dt(null),bt(""),mt.current={key:null,started:!1})},[e?.isConnected]);const $n=Bc.useRef({wasConnected:!1,hasIdentity:!1,key:null});Bc.useEffect(()=>{if("undefined"==typeof window)return;const t=!!e?.isConnected,n=e?.walletType||"",r=e?.ordinalsAddress||"",i=e?.paymentAddress||"",a=e?.address||"",o=`${n}|${r}|${i}|${a}`,s=!!n&&!!(r||i||a),l=$n.current;if(l.wasConnected){if(!t){try{kE()}catch{}return void window.location.reload()}if(l.hasIdentity&&s&&l.key&&l.key!==o){try{kE()}catch{}return void window.location.reload()}}$n.current={wasConnected:t,hasIdentity:s,key:o}},[e?.isConnected,e?.walletType,e?.ordinalsAddress,e?.paymentAddress,e?.address]),Bc.useEffect(()=>{m&&1!==se&&le(1)},[m,se]),Bc.useEffect(()=>{if(!e?.isConnected)return;const t=(async()=>{const{startBlockHeightMonitor:t,stopBlockHeightMonitor:r,onBlockChange:i}=await n(async()=>{const{startBlockHeightMonitor:e,stopBlockHeightMonitor:t,onBlockChange:n}=await Promise.resolve().then(()=>KE);return{startBlockHeightMonitor:e,stopBlockHeightMonitor:t,onBlockChange:n}},__VITE_PRELOAD__),a=i(async(t,r,i)=>{const a=[...new Set([e?.ordinalsAddress||"",e?.paymentAddress||e?.address||""].filter(Boolean))];if(0===a.length)return;let o=!1;try{const e="undefined"!=typeof window&&window.__NEXUS_NETWORK__||"mainnet",{fetchCompleteWalletDataDirect:t}=await n(async()=>{const{fetchCompleteWalletDataDirect:e}=await Promise.resolve().then(()=>Ar);return{fetchCompleteWalletDataDirect:e}},__VITE_PRELOAD__),r=await t(a,e),s=new Set((Array.isArray(r?.utxos)?r.utxos:[]).filter(e=>e&&e.txid&&"number"==typeof e.vout).map(e=>`${e.txid}:${e.vout}`));try{const{setCachedCompleteData:e}=await n(async()=>{const{setCachedCompleteData:e}=await Promise.resolve().then(()=>Fr);return{setCachedCompleteData:e}},__VITE_PRELOAD__);e(a.slice().sort().join(","),r)}catch(l){}try{const{getCachedUtxoResult:e,setCachedUtxoResult:t}=await n(async()=>{const{getCachedUtxoResult:e,setCachedUtxoResult:t}=await Promise.resolve().then(()=>ri);return{getCachedUtxoResult:e,setCachedUtxoResult:t}},__VITE_PRELOAD__),r=a.slice().sort().join(","),i=e(r);if(i&&"object"==typeof i){const e=e=>Array.isArray(e)?e.filter(e=>e&&s.has(`${e.txid}:${e.vout}`)):e;t(r,{...i,spendable:e(i.spendable),unsafe:e(i.unsafe)})}}catch(l){}he(e=>(Array.isArray(e)?e:[]).filter(e=>e&&s.has(`${e.txid}:${e.vout}`))),b(e=>{if(!e)return e;if(Array.isArray(e))return e.filter(e=>e&&s.has(`${e.txid}:${e.vout}`));if("object"==typeof e){const t=e=>Array.isArray(e)?e.filter(e=>e&&s.has(`${e.txid}:${e.vout}`)):e;return{...e,spendable:t(e.spendable),unsafe:t(e.unsafe)}}return e}),c(e=>(Array.isArray(e)?e:[]).filter(e=>{const t=e?.utxo?.txid,n=e?.utxo?.vout;return!t||"number"!=typeof n||s.has(`${t}:${n}`)}));try{const{getCachedInscriptions:e,setCachedInscriptions:t}=await n(async()=>{const{getCachedInscriptions:e,setCachedInscriptions:t}=await Promise.resolve().then(()=>kk);return{getCachedInscriptions:e,setCachedInscriptions:t}},__VITE_PRELOAD__);for(const n of a){const r=e(n);if(!Array.isArray(r)||0===r.length)continue;const i=r.filter(e=>{const t=e?.utxo?.txid,n=e?.utxo?.vout;return!t||"number"!=typeof n||s.has(`${t}:${n}`)});i.length!==r.length&&t(n,i)}}catch(l){}x(e=>({...e||{},status:"ready"===String(e?.status||"").toLowerCase()?"unverified":e?.status||"unverified",phase:"block",message:i?"Chain reorg detected. Wallet data reconciled; please refresh to verify ownership.":"New block detected. Wallet data reconciled; please refresh to verify ownership.",ts:Date.now()})),o=!0}catch(_k){}const s=t-r;s>=1&&(Se({type:"info",message:o?`\ud83e\uddf1 ${s} new block${s>1?"s":""} confirmed. Wallet updated smoothly; click "Fetch UTXOs" to fully verify.`:`\ud83e\uddf1 ${s} new block${s>1?"s":""} confirmed. Click "Fetch UTXOs" to refresh.`}),setTimeout(()=>Se(null),1e4))});return t(!0),()=>{a(),r()}})();return()=>{t.then(e=>e&&e())}},[e?.isConnected,e?.ordinalsAddress,e?.paymentAddress,e?.address]),Bc.useEffect(()=>{if(A)try{if(A instanceof ArrayBuffer)return void C(A.byteLength);if("object"==typeof A&&void 0!==A.byteLength)return void C(A.byteLength||A.length||0);if("string"==typeof A&&A.startsWith("data:")){const e=A.indexOf(",");if(-1!==e){const t=A.slice(e+1),n="undefined"!=typeof atob?atob(t).length:Buffer.from(t,"base64").length;return void C(n)}}const e=new Blob([A]).size;C(e)}catch{C(A&&A.length?A.length:0)}else C(0)},[A]),Bc.useEffect(()=>{let e=!1;const t=++re.current;return!q||String(j||"").trim()||!A||"string"==typeof A&&A.startsWith("data:")?(G(null),J("idle"),Z(null),void te("idle")):(G(null),J("compressing"),te("unknown"),(async()=>{try{const r="string"==typeof(n=A)?(new TextEncoder).encode(n):n instanceof Uint8Array?n:n instanceof ArrayBuffer?new Uint8Array(n):"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(n)?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):(new TextEncoder).encode(String(n??"")),i=r?.length??null;e||re.current!==t||Z(Number.isFinite(i)?i:null);const a=await Pi(r);if(e||re.current!==t)return;const o=a?.length;G(Number.isFinite(o)?o:null),Number.isFinite(i)&&Number.isFinite(o)?te(o<i?"helps":o>i?"hurts":"same"):te("unknown"),J("idle")}catch(r){if(e||re.current!==t)return;G(null),J("idle"),Z(null),te("unknown")}var n})(),()=>{e=!0,re.current===t&&J("idle")})},[q,j,A]);const Un="compressing"===Y,zn=Pc.useMemo(()=>{const e=String(j||"").trim();return!(!q||e||"string"==typeof A&&A.startsWith("data:")||!Number.isFinite(Number(K))||!Number.isFinite(Number(Q))||!(Number(K)<Number(Q)))},[q,j,A,K,Q]),Dn=Pc.useCallback(e=>{const t=Number(e);return!Number.isFinite(t)||t<0?null:t<1024?`${Math.round(t).toLocaleString()} B`:t<1048576?`${(t/1024).toFixed(1)} KB`:t<1073741824?`${(t/1048576).toFixed(2)} MB`:`${(t/1073741824).toFixed(2)} GB`},[]);Bc.useEffect(()=>{ne.current=K},[K]),Bc.useEffect(()=>{Xn()},[A,N,ce,p,m,Ln,se,j,q,K,_,L,M,$,H,ie,z]),Bc.useEffect(()=>{m?"reinscription"!==o&&s("reinscription"):p.length>1?"multi-parent"!==o&&s("multi-parent"):1===p.length?"parent-child"!==o&&s("parent-child"):0===p.length&&"standard"!==o&&s("standard")},[p.length,m]);const Wn=e=>{const t=null==e?"":String(e).trim(),n=Number(t);return!Number.isFinite(n)||n<=0?a:Math.max(a,n)},jn=e=>{if(null==e||""===String(e).trim())return void ue(null);const t=Number(e);Number.isFinite(t)&&ue(Math.max(a,t))},Vn=e=>ki(e,Wn(ce)),Xn=()=>{const t=Ln&&Ln.length>0;if(t||A&&0!==A.length)try{if(t){const e=Vn(Ln);return void ye(e)}let n=null;if(m){const e=String(m).split(",").filter(Boolean);n=e[e.length-1]||null}const r={content:A,contentType:N,contentSize:q&&!String(j||"").trim()&&Number.isFinite(K)?K:T,recipientAddress:ie||e?.ordinalsAddress||e?.address,parentIds:p.map(e=>e.id),reinscriptionTargetId:n,mode:"standard",delegateId:_,metaprotocol:L,metadata:M,properties:$,customTags:z,contentEncoding:j,pointer:H,postage:546},i=n?1:Math.max(1,Math.min(200,parseInt(se,10)||1)),a=Array.from({length:i},()=>({...r}));ye(Vn(a))}catch(_k){ye(null)}else ye(null)},Kn=async(t=null)=>{const r=Ln&&Ln.length>0;let a=null;if(r){const e=Ln.filter(e=>{const t=!!String(e?.contentType||"").trim(),n=Qn(e?.content),r=Zn(e);return!t||!n&&!r});if(e.length>0)return void Se({type:"error",message:`${e.length} item(s) missing contentType or (content/tags)`})}else{const e=!!String(N||"").trim(),t=Qn(A),n=Zn({delegateId:_,metaprotocol:L,metadata:M,properties:$,selectedParents:p,reinscriptionTarget:m,pointer:H});if(!e||!t&&!n)return void Se({type:"error",message:"Please add content, or set delegate/metadata/properties/parents/reinscription."})}if(!e?.isConnected)return void Se({type:"error",message:"No wallet connected"});if(!ge||0===ge.length)return void Se({type:"error",message:"\u26a0\ufe0f Please select payment UTXOs in the UTXOs tab before proceeding"});if(!r&&q&&!String(j||"").trim()&&A&&("string"!=typeof A||!A.startsWith("data:"))&&!Number.isFinite(ne.current)){const e=Date.now(),t=4e3;for(Se({type:"info",message:"\ud83e\uddf1 Compressing (Brotli)\u2026"});!Number.isFinite(ne.current)&&Date.now()-e<t;)await new Promise(e=>setTimeout(e,50))}const o=ge.reduce((e,t)=>e+t.value,0);let s=be;if(!r){const t=q&&!String(j||"").trim()&&Number.isFinite(ne.current)?ne.current:T;let n=null;if(m){const e=m.split(",").filter(Boolean);n=e[e.length-1]||null}const r={content:A,contentType:N,contentSize:t,recipientAddress:ie||e?.ordinalsAddress||e?.address,parentIds:p.map(e=>e.id),parentIdsForEnvelope:p.filter(e=>!e?.omitParentTag).map(e=>e.id),reinscriptionTargetId:n,mode:"standard",delegateId:_,metaprotocol:L,metadata:M,properties:$,customTags:z,contentEncoding:j,pointer:H},i=n?1:Math.max(1,Math.min(200,parseInt(se,10)||1));s=Vn(Array.from({length:i},()=>({...r})))}if(s&&o<s.totalRequired)Se({type:"error",message:`\u274c Insufficient funds: need ${s.totalRequired} sats, have ${o} sats`});else{"undefined"!=typeof window&&(window.__nexusGlobalLoading="inscribing"),we(!0),Se(null);try{const o=async t=>{Se({type:"info",message:`\ud83d\udce6 Preparing batch of ${t.length} items...`});const{createInscriptionScript:r}=await n(async()=>{const{createInscriptionScript:e}=await Promise.resolve().then(()=>Et);return{createInscriptionScript:e}},__VITE_PRELOAD__),a=new Set;t.forEach(e=>{e.parentIds&&Array.isArray(e.parentIds)&&e.parentIds.forEach(e=>a.add(e))});let o=0;const s=new Map;a.size>0&&(o=(await Promise.all(Array.from(a).map(async e=>{try{const t=await Yt(e,{walletInscriptions:l});return s.set(e,t),t}catch(_k){const n=_k&&_k.message?_k.message:String(_k);throw new Error(`Cannot fetch exact parent UTXO value for ${e}. Refusing to assume 546 sats because that can misplace pointers/inscriptions. Error: ${n}`)}}))).reduce((e,t)=>e+t,0));const c=t.filter(e=>!!e.reinscriptionTargetId),u=new Map;if(c.length>0){const e=Array.from(new Set(c.map(e=>e.reinscriptionTargetId).filter(Boolean)));await Promise.all(e.map(async e=>{try{const t=await Yt(e,{walletInscriptions:l});u.set(e,t)}catch(_k){const n=_k&&_k.message?_k.message:String(_k);throw new Error(`Cannot fetch exact reinscription target UTXO value for ${e}. Refusing to assume 546 sats because that can misplace pointers/inscriptions. Error: ${n}`)}}))}const d=new Array(t.length).fill(0),p=[],f=[];for(let e=0;e<t.length;e++)t[e]?.reinscriptionTargetId?p.push(e):f.push(e);let m=0;for(const e of p){const n=t[e]?.reinscriptionTargetId,r=u.get(n),i="number"==typeof r&&Number.isFinite(r)&&r>0?r:546;d[e]=m,m+=i}const g=m+o;let b=0;for(const e of f){d[e]=g+b;const n=Number(t[e]?.postage);b+=Number.isFinite(n)&&n>0?Math.floor(n):546}t.length;const y=e=>e&&"string"==typeof e?e.split(":")[0].trim():e;let x=await Promise.all(t.map(async(t,n)=>{tr(t,`Item #${n+1}: `);const i=d[n]||0;let a,o;if(t.metadata)try{a=JSON.parse(t.metadata)}catch(Pk){throw new Error(`Item #${n+1}: Invalid metadata JSON`)}if(t.properties)try{o=JSON.parse(t.properties)}catch(Pk){throw new Error(`Item #${n+1}: Invalid properties JSON`)}let s=(t.contentEncoding||"").trim();if(s&&new Set(["br","gzip","deflate","identity"]).has(s),!s&&t&&t.compressBeforeInscribe)try{if("string"==typeof t.content&&t.content.startsWith("data:"))throw new Error("Cannot Brotli-compress a data: URL string; use binary content instead");const e="string"==typeof(c=t.content)?(new TextEncoder).encode(c):c instanceof Uint8Array?c:c instanceof ArrayBuffer?new Uint8Array(c):"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(c)?new Uint8Array(c.buffer,c.byteOffset,c.byteLength):(new TextEncoder).encode(String(c??"")),n=await Pi(e);t={...t,content:n,contentSize:n.length,contentEncoding:"br"},s="br"}catch(Pk){}var c;let u,p;if(t.reinscriptionTargetId){let e,r=t.reinscriptionTargetData;if(r||(r=l.find(e=>e.id===t.reinscriptionTargetId)),r||(r=l.find(e=>e.sameSatIds&&e.sameSatIds.includes(t.reinscriptionTargetId))),!r)throw new Error(`Item #${n+1}: Reinscription target ${t.reinscriptionTargetId} not found in wallet or same-sat chains. Please refresh your inscriptions list.`);if(r.sameSatIds&&r.sameSatIds.length>1){const e=r.sameSatIds[0];if(t.reinscriptionTargetId!==e){const t=l.find(t=>t.id===e);t&&(r=t)}}if(null!==r.utxo?.offset&&void 0!==r.utxo?.offset){const t=r.utxo.offset,n=r.utxo.value;t>=0&&(!n||t<n)&&(e=t,p=t)}if(void 0===p&&r.satpoint){const e=String(r.satpoint).split(":");if(e.length>=3){const t=Number(e[2]);Number.isFinite(t)&&t>=0&&(p=t)}}}let f=t.pointer;const m=null!=f&&String(f).length>0,g=!!t.reinscriptionTargetId;if(g&&!m){const e=null!=p?Number(p):0,t=i+(Number.isFinite(e)&&e>0?Math.floor(e):0);t>0&&(f=t)}if(g||m||i>0&&(f=i),t.reinscriptionTargetId&&null!=f&&String(f).length>0){const e=parseInt(f);if(!isNaN(e)&&e<0)throw new Error(`Item #${n+1}: Pointer cannot be negative (${e})`)}const b=t.parentIdsForEnvelope&&Array.isArray(t.parentIdsForEnvelope)?t.parentIdsForEnvelope:t.parentIds,x=r({content:t.content,contentType:t.contentType,parentIds:b&&b.length>0?b.map(y):void 0,delegateId:t.delegateId?y(t.delegateId):void 0,metaprotocol:t.metaprotocol||void 0,pointer:null!=f&&String(f).length>0?parseInt(f):void 0,metadata:a,properties:o,customTags:void 0,contentEncoding:s||void 0});try{import.meta,b&&b.length&&b.length}catch(N){}if(t.reinscriptionTargetId){let e,r,a,o,s,c,d=t.reinscriptionTargetData;if(d||(d=l.find(e=>e.id===t.reinscriptionTargetId)),!d&&(d=l.find(e=>e.sameSatIds&&e.sameSatIds.includes(t.reinscriptionTargetId)),!d))throw new Error(`Item #${n+1}: Reinscription target ${t.reinscriptionTargetId} not found in wallet or same-sat chains. Please refresh your inscriptions list.`);if(d.sameSatIds&&d.sameSatIds.length>1){const e=d.sameSatIds[0];if(t.reinscriptionTargetId!==e){const t=l.find(t=>t.id===e);if(!t)throw new Error(`Item #${n+1}: Latest inscription ${e} in same-sat chain not found in wallet. Please refresh your inscriptions list.`);d=t}}if(!d.utxo&&!d.satpoint)throw new Error(`Item #${n+1}: Reinscription target ${t.reinscriptionTargetId} is missing UTXO data. Please refresh your inscriptions list to fetch complete data.`);if(d.utxo&&(e=d.utxo.txid,r=d.utxo.vout,a=d.utxo.value,o=d.utxo.address,s=d.utxo.scriptHex||d.utxo.script,null!==d.utxo.offset&&void 0!==d.utxo.offset)){const e=d.utxo.offset;e>=0&&(!a||e<a)&&(c=e)}if((!e||void 0===r)&&d.satpoint){const t=String(d.satpoint).split(":");if(t.length>=2&&(e=t[0],r=parseInt(t[1]),t.length>=3)){const e=Number(t[2]);Number.isFinite(e)&&e>=0&&(c=e)}}if(o||(o=d.address),!e||void 0===r)throw new Error(`Item #${n+1}: Cannot extract UTXO location (txid/vout) for reinscription target ${t.reinscriptionTargetId}. This inscription may not be fully indexed yet. Please wait a few minutes and refresh.`);if(!o)throw new Error(`Item #${n+1}: Cannot extract address for reinscription target ${t.reinscriptionTargetId}. This inscription may not be fully indexed yet. Please wait and refresh.`);const p=[d.utxo?.value,d.value,d.output_value,d.outputValue].filter(e=>"number"==typeof e&&Number.isFinite(e)&&e>0);if(0===p.length)throw new Error(`Item #${n+1}: Reinscription target ${t.reinscriptionTargetId} missing spendable value. Refresh inscriptions list.`);const m=p[0];if(null!=f&&""!==f){const e=parseInt(f),t=i||0,r=t+m;if(!isNaN(e)&&(e<t||e>=r))throw new Error(`Item #${n+1}: CRITICAL SAT ALIGNMENT ERROR\n   Pointer: ${e}\n   Output start: ${t}\n   Target UTXO value: ${m} sats\n   Pointer must satisfy: ${t} \u2264 pointer < ${r}\n   \n   Why this matters:\n   - Commit output contains ${m} sats from target + reveal fee from payment\n   - Pointer outside the reinscription output selects the wrong sat stream\n   - This would inscribe the wrong sat (not the reinscription target sat)\n   \n   Fix: Leave pointer blank (auto) or set a pointer within that output's range`)}null!=c&&(c<0||c>=m)&&(c=0),u={txid:e,vout:r,value:m,address:o,inscriptionId:t.reinscriptionTargetId,...void 0!==c?{offset:c}:{}},s&&(u.scriptHex=s)}let w;if(t.parentIds&&t.parentIds.length>0&&(w=t.parentIds.map(e=>{let t,r,i,a,o=l.find(t=>t.id===e);if(!o&&(o=l.find(t=>t.sameSatIds&&t.sameSatIds.includes(e)),!o))throw new Error(`Item #${n+1}: Parent inscription ${e} not found in wallet or same-sat chains`);if(o.sameSatIds&&o.sameSatIds.length>1){const t=o.sameSatIds[0],n=l.find(e=>e.id===t);n&&n.id!==e&&(o={...n,id:e,originalParentId:e,effectiveParentId:t})}let s=null;if(o.utxo&&(t=o.utxo.txid,r=o.utxo.vout,s=o.utxo.value,i=o.utxo.address,a=o.utxo.scriptHex||o.utxo.script),(!t||void 0===r)&&o.satpoint){const e=o.satpoint.split(":");e.length>=2&&(t=e[0],r=parseInt(e[1]))}if(i||(i=o.address),t&&"number"==typeof r){const e=((e,t)=>{const n=h,r=[];Array.isArray(n)?r.push(n):n&&"object"==typeof n&&(Array.isArray(n.unsafe)&&r.push(n.unsafe),Array.isArray(n.spendable)&&r.push(n.spendable),Array.isArray(n.utxos)&&r.push(n.utxos));for(const i of r){const n=(i||[]).find(n=>n&&n.txid===e&&n.vout===t);if(n)return n}return null})(t,r);e&&(!i&&e.address&&(i=e.address),a||!e.scriptHex&&!e.script||(a=e.scriptHex||e.script),"number"==typeof e.value&&Number.isFinite(e.value)&&e.value>0&&("number"==typeof s&&Number.isFinite(s)&&s>0&&e.value,s=e.value))}if(!t||void 0===r)throw new Error(`Item #${n+1}: Parent ${e} missing txid/vout. Has satpoint: ${!!o.satpoint}, has utxo: ${!!o.utxo}`);if(!i)throw new Error(`Item #${n+1}: Parent ${e} missing address. This inscription may need to be refetched.`);if("number"!=typeof s||!Number.isFinite(s)||s<=0)throw new Error(`Item #${n+1}: Parent ${e} missing UTXO value for ${t}:${r}. Cannot sign parent input without the exact previous output amount.`);const c={txid:t,vout:r,value:Math.ceil(s),address:i};return a&&(c.scriptHex=a),c}),u)){const e=`${u.txid}:${u.vout}`;w=w.filter(t=>`${t.txid}:${t.vout}`!==e)}const v=x.length/2,S=e.ordinalsAddress||e.address;if(u&&!S)throw new Error(`Item #${n+1}: Cannot process reinscription - wallet address is missing. Please ensure your wallet is properly connected.`);const E=u?S:t.recipientAddress||S;if(u&&!u.address)throw new Error(`Item #${n+1}: Reinscription target missing address field.`);if(!E||"null"===E||"undefined"===E)throw new Error(`Item #${n+1}: Invalid recipient address "${E}". WalletState: ordinals=${e.ordinalsAddress}, address=${e.address}`);return{...t,inscriptionScript:x,scriptSizeBytes:v,recipientAddress:E,postage:u?0:t.postage||546,parentUtxos:w&&w.length>0?w:void 0,reinscriptionUtxo:u}}));const w=new Set((x||[]).filter(e=>e?.reinscriptionUtxo&&e.reinscriptionUtxo.txid&&"number"==typeof e.reinscriptionUtxo.vout).map(e=>`${e.reinscriptionUtxo.txid}:${e.reinscriptionUtxo.vout}`));if(w.size>0){x=(x||[]).map((e,t)=>{const n=Array.isArray(e?.parentUtxos)?e.parentUtxos:[];if(0===n.length)return e;n.length;const r=[],i=n.filter(e=>{if(!e||!e.txid||"number"!=typeof e.vout)return!1;const t=`${e.txid}:${e.vout}`,n=w.has(t);return n&&r.push(t),!n});return i.length,{...e,parentUtxos:i.length>0?i:void 0}});try{(x||[]).forEach((e,t)=>{Array.isArray(e?.parentIds)&&e.parentIds.length,Array.isArray(e?.parentUtxos)&&e.parentUtxos.length})}catch(_){}}if(x&&x.length>0){const e=new Map,t=[];if(x.forEach((n,r)=>{const i=n&&n.reinscriptionUtxo;if(!i||void 0===i.txid||void 0===i.vout)return;const a=`${i.txid}:${i.vout}`;e.has(a)?t.push({key:a,first:e.get(a),second:r}):e.set(a,r)}),t.length>0){const e=t[0],n=e=>`#${e+1}`;return void Se({type:"error",message:`This reinscription target is already used in batch item ${n(e.first)} and can only be reinscribed once per batch. You can still use it as a parent in other items.`})}}Se({type:"info",message:"\ud83d\udd28 Building batch PSBTs..."});let v=ge;if(e?.ordinalsAddress){const t=e.ordinalsAddress;e.paymentAddress||e.address,v.some(e=>e.address&&e.address!==t)&&(v=v.filter(e=>e.address!==t))}if(0===v.length)throw new Error("No valid payment UTXOs available after filtering");const S=e.network?.toLowerCase?.()||"mainnet",E=e.paymentAddress||e.address;let N;if(1===t.length){const e=t[0],n=(e=>{if("number"==typeof e.contentSize)return e.contentSize;const t=e.content;if("string"==typeof t)try{return new Blob([t]).size}catch{return t.length}if(t&&"object"==typeof t){if(t.byteLength)return t.byteLength;if(t.length)return t.length}return 0})(e),r=!!e.reinscriptionTargetId||!!e.reinscriptionUtxo;N=Hn(n,Wn(ce),e.parentIds?.length||0,{postage:r?0:e.postage||546,isReinscription:r,hasMetadata:!!e.metadata,hasMetaprotocol:!!e.metaprotocol,hasPointer:!!e.pointer,hasDelegate:!!e.delegateId})}else{const e=ki(x,Wn(ce));e&&(N={commitFee:e.commitFee,revealFee:e.revealFee,postage:e.postage,totalRequired:e.totalRequired})}const I=[...v],A=x.filter(e=>e.reinscriptionUtxo).map(e=>e.reinscriptionUtxo),k=new Set(A.map(e=>`${e.txid}:${e.vout}`));if(I.filter(e=>k.has(`${e.txid}:${e.vout}`)).length>0)return void Se({type:"error",message:"Selected payment UTXOs include reinscription targets. Deselect those UTXOs and try again."});let T=e.paymentPublicKey,C=e.ordinalsPublicKey;if(!T)try{const e=window.NexusWalletConnect;if(e?.getAccounts){const t=await e.getAccounts(),n=t.find(e=>"payment"===e.purpose),r=t.find(e=>"ordinals"===e.purpose);T=n?.publicKey,C=r?.publicKey,T?.startsWith("0x")&&(T=T.slice(2)),C?.startsWith("0x")&&(C=C.slice(2))}else if(e?.getPublicKey){let t=await e.getPublicKey();t?.startsWith("0x")&&(t=t.slice(2)),T=t,C=t}}catch(_k){}try{if(x.filter(e=>e.reinscriptionUtxo&&!Number.isInteger(e.reinscriptionUtxo.value)).length>0)return void Se({type:"error",message:"Invalid reinscription UTXO value. Refresh UTXOs and try again."});x.forEach(e=>{e.reinscriptionUtxo&&Number.isInteger(e.reinscriptionUtxo.value)&&(e.expectedRevealOutputValue=e.reinscriptionUtxo.value)})}catch(_){}const B=["Validate UTXOs","Build PSBTs","Sign PSBTs","Finalize","Broadcast commit","Broadcast reveals"],P=await pr({wallet:window.NexusWalletConnect,paymentUtxos:I.map(e=>({txid:e.txid,vout:e.vout,value:e.value,address:e.address||E})),items:x,changeAddress:(()=>{const e=new Set((I||[]).map(e=>e?.address).filter(Boolean));return 1===e.size?Array.from(e)[0]:E})(),network:S,fees:{commitFee:N.commitFee,revealFee:N.revealFee,postage:546,totalRequired:N.totalRequired},feeRate:Wn(ce),paymentPublicKey:T,ordinalsPublicKey:C,enforceExactTargetOutputs:!0,onProgress:e=>{Wt(IE(B,e))}});return Wt(""),Rn(P),Ne(P),i&&i(P),P};if(r)return await o(Ln);let s=null,c=null;if(m){const e=m.split(",").filter(Boolean),t=e[e.length-1];if(c=t,s=l.find(e=>e.id===t),!s)throw new Error(`Reinscription target ${t} not found in wallet inscriptions`)}const u=c?e?.ordinalsAddress||s?.utxo?.address||e?.address:ie||e?.ordinalsAddress||e?.address,d={id:Date.now()+Math.random(),__autoSingle:!0,content:A,contentType:N,contentSize:q&&!String(j||"").trim()&&Number.isFinite(ne.current)?ne.current:T,uncompressedContentSize:T,compressedContentSize:q&&!String(j||"").trim()&&Number.isFinite(ne.current)?ne.current:void 0,fileName:B,recipientAddress:u,parentIds:p.map(e=>e.id),reinscriptionTargetId:c,reinscriptionTargetData:s,delegateId:_,metaprotocol:L,metadata:M,properties:$,contentEncoding:j,compressBeforeInscribe:!!q,pointer:H,features:[],nxsParcelManifestSelfHint:t?.nxsParcelManifestSelfHint||void 0},f=c?1:Math.max(1,Math.min(200,parseInt(se,10)||1)),g=Array.from({length:f},()=>({...d,id:Date.now()+Math.random(),__autoSingle:!0}));return a=g.map(e=>e.id),Fn(e=>{const t=[...e,...g],n=Vn(t);return n&&ye(n),t}),await o(g)}catch(_k){if(!r&&Array.isArray(a)&&a.length>0){const e=new Set(a);Fn(t=>t.filter(t=>t&&!e.has(t.id)))}Se({type:"error",message:_k.message||"Inscription failed. Please try again."})}finally{we(!1),Wt(""),"undefined"!=typeof window&&"inscribing"===window.__nexusGlobalLoading&&(window.__nexusGlobalLoading=null)}}};oe.current=Kn;const Jn=e=>{if(e&&"object"==typeof e&&"bulk"===e.type&&Array.isArray(e.parents))return void f(e.parents);const t=e.id||e.inscriptionId||e.inscription_id,n=p.some(e=>(e.id||e.inscriptionId||e.inscription_id)===t);f(n?e=>e.filter(e=>(e.id||e.inscriptionId||e.inscription_id)!==t):t=>[...t,e])},Qn=e=>{if(null==e)return!1;if("string"==typeof e)return e.length>0;if(e instanceof ArrayBuffer)return e.byteLength>0;if("undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(e))return(e.byteLength||0)>0;if("[object ArrayBuffer]"===Object.prototype.toString.call(e))try{return(e.byteLength||0)>0}catch{return!0}return!0},Zn=e=>{if(!e||"object"!=typeof e)return!1;const t=String(e.delegateId||"").trim(),n=String(e.metaprotocol||"").trim(),r=String(e.metadata||"").trim(),i=String(e.properties||"").trim(),a=Array.isArray(e.parentIds)?e.parentIds:null,o=Array.isArray(e.selectedParents)?e.selectedParents:null,s=String(e.reinscriptionTargetId||"").trim(),l=String(e.reinscriptionTarget||"").trim(),c=e.pointer,u=!(null==c||""===String(c));return!!t||!!n||!!r||!!i||a&&a.length>0||o&&o.length>0||!!s||!!l||u},tr=(e,t="")=>{const n=(e?.contentEncoding||"").trim(),r=e?.content;if("string"==typeof r){if(n&&(e=>{if("string"!=typeof e)return!1;const t=e.trim();return/^\[object (ArrayBuffer|Uint8Array|Uint8ClampedArray|Int8Array|Int16Array|Int32Array|Uint16Array|Uint32Array|Float32Array|Float64Array|BigInt64Array|BigUint64Array|DataView)\]$/.test(t)})(r))throw new Error(`${t}Invalid content: encoded payload is a stringified binary object. Re-upload the file (.br/.gz) and do not use the Text tab.`);if(n&&!r.length)throw new Error(`${t}Invalid content: encoded payload is empty.`);return}const i=!!r&&(r instanceof ArrayBuffer||"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(r)||"[object ArrayBuffer]"===Object.prototype.toString.call(r));if(n&&!i)throw new Error(`${t}Invalid content: contentEncoding is set but content is not binary. Re-upload the file.`)},nr=Pc.useCallback(async t=>{try{let n;try{n=JSON.parse(String(t||""))}catch(Pk){return void Se({type:"error",message:`\u274c Invalid JSON: ${Pk?.message||String(Pk)}`})}if(!n||"object"!=typeof n)return void Se({type:"error",message:"\u274c JSON must be an object."});const r=n.defaults&&"object"==typeof n.defaults?n.defaults:{},i=n.feeRate??r.feeRate;if(void 0!==i)try{jn(i)}catch(Pk){return void Se({type:"error",message:`\u274c Invalid feeRate in JSON: ${Pk?.message||String(Pk)}`})}const a=n.developerFee??n.fees?.developer;if(void 0!==a)if(null===a)qn(null);else if("object"==typeof a){const e=a.enabled,t=a.amountSats??a.amount??0,n=Number(t);if(!1===e||!Number.isFinite(n)||n<=0)qn(null);else{const e=String(a.address||"").trim();if(!e)throw new Error("developerFee.address is required when amountSats > 0");qn({address:e,amountSats:n,description:a.description||a.label||"Developer API Fee",mode:a.mode,perItem:a.perItem})}}const o=n.customFees??n.fees?.customFees;if(void 0!==o)if(null===o)Yn();else if(Array.isArray(o)){Yn();for(let e=0;e<o.length;e++){const t=o[e];if(!t||"object"!=typeof t)throw new Error(`customFees[${e}] must be an object`);const n=String(t.address||"").trim(),r=Number(t.amountSats??t.amount),i=t.description||t.label||`Custom Fee ${e+1}`;if(!n)throw new Error(`customFees[${e}].address is required`);if(!Number.isFinite(r)||r<=0)throw new Error(`customFees[${e}].amountSats must be a positive number`);Gn(n,r,i)}}const s=await Kl(t,{defaultRecipient:e?.ordinalsAddress||e?.address,walletInscriptions:l||[]});if(!s||!s.items||0===s.items.length)return void Se({type:"error",message:"\u274c No items found in JSON"});const c=s.items.map((e,t)=>{let n=null,r=null;if(e.reinscriptionTargetId){const i=l.find(t=>t.id===e.reinscriptionTargetId);if(!i)throw new Error(`Item #${t+1}: Reinscription target ${e.reinscriptionTargetId} not found in wallet`);n=i,r=i.id}const i=(e.parentIds||[]).map(e=>l.find(t=>t.id===e)).filter(Boolean),a=[],o=Array.isArray(e.parentIds)?e.parentIds.length:0;return 1===o&&a.push("\ud83d\udc68\u200d\ud83d\udc67 Parent-Child"),o>1&&a.push(`\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d\udc66 Multi-Parent (${o})`),r&&a.push("\u267b\ufe0f Reinscription"),e.delegateId&&a.push("\ud83d\udd17 Delegate"),e.metaprotocol&&a.push(`\ud83d\udce1 ${e.metaprotocol}`),e.metadata&&a.push("\ud83d\udcca Metadata"),e.properties&&a.push("\ud83c\udfa8 Properties"),e.contentEncoding&&a.push("\ud83d\udddc\ufe0f Encoding"),e.compressBeforeInscribe&&!e.contentEncoding&&a.push("\ud83e\uddf1 Brotli"),void 0!==e.pointer&&null!==e.pointer&&""!==e.pointer&&a.push("\ud83c\udfaf Pointer"),{...e,id:Date.now()+Math.random()+t,mode:"standard",reinscriptionTargetId:r,reinscriptionTargetData:n,selectedParents:i,features:a}});for(let e=0;e<c.length;e++)try{tr(c[e],`Item #${e+1}: `)}catch(Pk){throw new Error(Pk?.message||String(Pk))}const u=new Set;for(const e of c)if(e.reinscriptionTargetId){if(u.has(e.reinscriptionTargetId))throw new Error(`Duplicate reinscriptionTargetId in batch: ${e.reinscriptionTargetId} (each target can only be reinscribed once per batch)`);u.add(e.reinscriptionTargetId)}if(1!==c.length||n.items)Fn(c),Se({type:"success",message:`\u2705 Imported batch: ${c.length} item(s)`});else{const e=c[0];k(e.content),I(e.contentType),P(e.fileName||""),f(e.selectedParents||[]),g(e.reinscriptionTargetId||null),O(e.delegateId||""),F(e.metaprotocol||""),R(e.metadata||""),U(e.properties||""),D(e.customTags||null),W(0===e.pointer?0:e.pointer||""),V(e.contentEncoding||""),ae(e.recipientAddress||""),Se({type:"success",message:"\u2705 Imported draft from JSON"})}}catch(Pk){Se({type:"error",message:`\u274c JSON import failed: ${Pk?.message||String(Pk)}`})}},[l,e?.ordinalsAddress,e?.address,tr,jn]),rr=t=>{const n=t.reinscriptionTarget;let r=null;if(n){const e=n.split(",").filter(Boolean),t=e[e.length-1];if(r=l.find(e=>e.id===t),!r)return void Se({type:"error",message:`\u26a0\ufe0f Reinscription target ${t} not found. Please refresh your inscriptions.`})}const i=!!r;if(i){const e=r;if(!(e.utxo&&e.utxo.txid&&void 0!==e.utxo.vout&&e.utxo.value&&e.utxo.address))return void Se({type:"error",message:`\u26a0\ufe0f Reinscription target ${e.id} is missing complete UTXO data. Please refresh your inscriptions list.`})}const a=i?r.id:null,o=i?r:null,s=a?e?.ordinalsAddress||o?.utxo?.address||e?.address:t.recipientAddress||ie||e?.ordinalsAddress||e?.address,c=((e,t=0)=>{try{if(!e)return 0;if(e instanceof ArrayBuffer)return e.byteLength;if("object"==typeof e&&void 0!==e.byteLength)return e.byteLength||e.length||0;if("string"==typeof e&&e.startsWith("data:")){const t=e.indexOf(",");if(-1!==t){const n=e.slice(t+1);return"undefined"!=typeof atob?atob(n).length:Buffer.from(n,"base64").length}}return"string"==typeof e?new Blob([e]).size:Number.isFinite(t)?t:e.length||0}catch{return Number.isFinite(t)?t:e&&e.length?e.length:0}})(t.content,t.contentSize),u={id:Date.now()+Math.random(),content:t.content,contentType:t.contentType,contentSize:c,uncompressedContentSize:c,fileName:t.fileName||"",recipientAddress:s,parentIds:t.selectedParents?.map(e=>e.id)||[],reinscriptionTargetId:a,reinscriptionTargetData:o,mode:"standard",delegateId:t.delegateId||"",metadata:t.metadata||"",metaprotocol:t.metaprotocol||"",properties:t.properties||"",customTags:t.customTags&&"object"==typeof t.customTags?t.customTags:null,contentEncoding:t.contentEncoding||"",compressBeforeInscribe:!!t.compressBeforeInscribe,pointer:t.pointer||"",postage:t.postage||546,features:t.features||[]};try{tr(u)}catch(Pk){return void Se({type:"error",message:Pk.message||"Invalid content"})}if(u.reinscriptionTargetId&&Ln.find(e=>e.reinscriptionTargetId===u.reinscriptionTargetId))return void Se({type:"error",message:`\u274c This reinscription target (${u.reinscriptionTargetId.substring(0,16)}...) is already in the batch. Each UTXO can only be reinscribed once per batch. You can still use it as a parent in other items.`});const d=parseInt(t.repeatCount,10),p=u.reinscriptionTargetId?1:Math.max(1,Math.min(200,Number.isFinite(d)?d:1)),m=Array.from({length:p},()=>({...u,id:Date.now()+Math.random()}));Fn(e=>{const t=[...e,...m],n=Vn(t);return n&&ye(n),t}),u.compressBeforeInscribe&&!String(u.contentEncoding||"").trim()&&(async()=>{try{if("string"==typeof u.content&&u.content.startsWith("data:"))return;const t="string"==typeof(e=u.content)?(new TextEncoder).encode(e):e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):(new TextEncoder).encode(String(e??"")),n=t?.length;if(!Number.isFinite(n)||n<=0)return;const r=await Pi(t),i=r?.length;if(!Number.isFinite(i)||i<=0)return;if(i>=n)return;const a=new Set(m.map(e=>e.id));Fn(e=>{const t=e.map(e=>{if(!e||!a.has(e.id))return e;if(String(e.contentEncoding||"").trim())return e;if(!e.compressBeforeInscribe)return e;const t=Array.isArray(e.features)?e.features.includes("\ud83e\uddf1 Brotli")?e.features:[...e.features,"\ud83e\uddf1 Brotli"]:["\ud83e\uddf1 Brotli"];return{...e,compressedContentSize:i,contentSize:i,features:t}}),n=Vn(t);return n&&ye(n),t})}catch(t){}var e})(),k(""),I("text/plain"),P(""),C(0),f([]),g(null),O(""),R(""),F(""),D(null),W(""),ae(""),X(!1),Xe("review"),at("review"),Se({type:"success",message:`\u2705 Added to batch (+${p}). Opening review\u2026`}),setTimeout(()=>Se(null),3e3)},ar=e=>{Fn(t=>{const n=t[e];if(!n)return t;if(n.reinscriptionTargetId)return Se({type:"error",message:"\u274c Cannot duplicate reinscription items \u2014 each target can only be reinscribed once per batch."}),t;const r={...n,id:Date.now()+Math.random()},i=[...t,r],a=Vn(i);return a&&ye(a),i})},or=e=>{Fn(t=>{const n=t.filter((t,n)=>n!==e),r=Vn(n);return ye(r),n}),Se({type:"info",message:"Removed item from batch"})},sr=(e,t)=>{if(t){if(Fn(n=>{const r=n.map((n,r)=>{if(r!==e)return n;const i={...n,...t},a=String(i.contentEncoding||"").trim(),o=!!i.compressBeforeInscribe&&!a,s=Number.isFinite(i.compressedContentSize)&&i.compressedContentSize>0,l=Number.isFinite(i.uncompressedContentSize)?i.uncompressedContentSize:Number.isFinite(i.contentSize)?i.contentSize:0,c=Array.isArray(i.features)?i.features:[];let u=c;return o?c.includes("\ud83e\uddf1 Brotli")||(u=[...c,"\ud83e\uddf1 Brotli"]):u=c.filter(e=>"\ud83e\uddf1 Brotli"!==e),{...i,uncompressedContentSize:l,contentSize:o?s?i.compressedContentSize:i.contentSize:l,features:u}}),i=Vn(r);return ye(i),r}),Object.prototype.hasOwnProperty.call(t,"compressBeforeInscribe")&&t.compressBeforeInscribe){const t=Ln[e],n=!!String(t?.contentEncoding||"").trim(),r=Number.isFinite(t?.compressedContentSize)&&t.compressedContentSize>0;n||!t||r||(async()=>{try{if("string"==typeof t.content&&t.content.startsWith("data:"))return;const n=e=>"string"==typeof e?(new TextEncoder).encode(e):e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):(new TextEncoder).encode(String(e??"")),r=await Pi(n(t.content)),i=r?.length;if(!Number.isFinite(i)||i<=0)return;Fn(t=>{const n=t.map((t,n)=>{if(n!==e)return t;if(String(t?.contentEncoding||"").trim())return t;if(!t.compressBeforeInscribe)return t;const r=Number.isFinite(t.uncompressedContentSize)?t.uncompressedContentSize:t.contentSize||0,a=Array.isArray(t.features)?t.features:[],o=a.includes("\ud83e\uddf1 Brotli")?a:[...a,"\ud83e\uddf1 Brotli"];return{...t,uncompressedContentSize:r,compressedContentSize:i,contentSize:i,features:o}}),r=Vn(n);return ye(r),n})}catch(n){}})()}return}const n=Ln[e];k(n.content),I(n.contentType),P(n.fileName||""),ae(n.recipientAddress),O(n.delegateId),R(n.metadata),F(n.metaprotocol),D(n.customTags||null),W(n.pointer),V(n.contentEncoding||""),X(!!n.compressBeforeInscribe);const r=l.filter(e=>n.parentIds.includes(e.id));f(r),n.reinscriptionTargetId?g(n.reinscriptionTargetId):g(null),Fn(t=>{const n=t.filter((t,n)=>n!==e),r=Vn(n);return ye(r),n}),Se({type:"info",message:'Editing item - make changes and click "Add to Batch"'})},lr=Pc.useMemo(()=>Ln.map(e=>e.reinscriptionTargetId).filter(Boolean),[Ln]),[cr,ur]=Pc.useState(()=>"undefined"!=typeof window&&window.innerWidth<1024);Pc.useEffect(()=>{if("undefined"==typeof window)return;const e=window.matchMedia("(max-width: 1023px)"),t=e=>ur(e.matches);return ur(e.matches),e.addEventListener("change",t),()=>e.removeEventListener("change",t)},[]);const dr=Pc.useMemo(()=>[{id:"editor",idx:0},{id:"options",idx:1},{id:"compression",idx:2},{id:"review",idx:3},{id:"fees",idx:4}],[]),fr=cr,mr=Pc.useCallback(e=>{if("oodl"===ke)return{};const t=dr.findIndex(e=>e.id===tt),n=dr.findIndex(t=>t.id===e);if(t<0||n<0)return{display:"none"};const r=n-t,i=Math.abs(r);if(0===r)return{position:"absolute",top:0,bottom:0,left:fr?"0%":"20%",width:fr?"100%":"60%",zIndex:10,"--nexus-cf-transform":"translateX(0) scale(1) rotateY(0deg)",opacity:1,transition:"all 0.45s cubic-bezier(0.22, 1, 0.36, 1)",pointerEvents:"auto",display:"flex",flexDirection:"column"};if(fr)return{display:"none"};const a=r>0?1:-1;return{position:"absolute",top:"2%",bottom:"2%",left:a<0?-2-18*(i-1)+"%":82+18*(i-1)+"%",width:"20%",zIndex:10-i,"--nexus-cf-transform":`scale(${Math.max(.7,.85-.1*(i-1))}) rotateY(${-12*a}deg)`,opacity:Math.max(.2,.65-.2*(i-1)),transition:"all 0.45s cubic-bezier(0.22, 1, 0.36, 1)",pointerEvents:"auto",overflow:"hidden",filter:i>1?"blur(2px)":"none",cursor:"pointer",borderRadius:"12px"}},[Ve,ke,dr,tt,fr]),gr=Pc.useCallback(e=>tt===e,[tt]),hr=Pc.useCallback(e=>{if("oodl"===ke)return null;if(tt!==e)return null;const t=[{id:"editor",label:"Content",num:1},{id:"options",label:"Options",num:2},{id:"compression",label:"Compression",num:3},{id:"review",label:"Review",num:4},{id:"fees",label:"Fees",num:5}],n=t.findIndex(e=>e.id===tt),r=n>=0?n:0,i=r>0,a=Array.isArray(Ln)&&Ln.length>0,o="options"===tt,s="compression"===tt,l="fees"===tt,c=null!=A&&("string"==typeof A?A.length>0:A instanceof ArrayBuffer?A.byteLength>0:"undefined"==typeof ArrayBuffer||!ArrayBuffer.isView||!ArrayBuffer.isView(A)||(A.byteLength||0)>0);String(_||"").trim(),String(L||"").trim(),String(M||"").trim(),String($||"").trim(),Array.isArray(p)&&p.length,null==H||String(H);const u=!!String(_||"").trim(),d=!!String(N||"").trim()&&(c||u);let f="fees"===tt?null:r<t.length-1?`${t[r+1].label} \u2192`:null;s&&(f=d?"Add to Batch \u2192 Review":a?"Back to Review \u2192":"Review \u2192");const g="review"===tt?"+ Add Another":r>0?`\u2190 ${t[r-1].label}`:"\u2190 Back",h=!!s&&!d&&!a;return Pc.createElement("div",{className:"shrink-0 z-[20] border-t border-neutral-800/70 bg-neutral-900/95 backdrop-blur-md",style:{marginTop:"auto"}},Pc.createElement("div",{className:"flex items-center gap-2 px-2 sm:px-3 py-2"},Pc.createElement("button",{onClick:e=>{e.stopPropagation(),"review"!==tt?r>0&&ot(t[r-1].id):ot("editor")},disabled:!i,className:"flex items-center gap-1 px-2.5 sm:px-4 py-2 sm:py-2.5 rounded-lg text-xs sm:text-sm font-medium transition-all duration-150 touch-manipulation shrink-0 "+(i?"review"===tt?"bg-green-600/20 text-green-300 border border-green-500/30 hover:bg-green-600/30 active:bg-green-600/40":"bg-neutral-800 text-neutral-200 hover:bg-neutral-700 active:bg-neutral-700":"bg-neutral-800/40 text-neutral-600 cursor-not-allowed")},"review"===tt?Pc.createElement("svg",{className:"w-3.5 h-3.5 sm:w-4 sm:h-4",viewBox:"0 0 20 20",fill:"currentColor"},Pc.createElement("path",{d:"M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z"})):Pc.createElement("svg",{className:"w-3.5 h-3.5 sm:w-4 sm:h-4",viewBox:"0 0 20 20",fill:"currentColor"},Pc.createElement("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z",clipRule:"evenodd"})),Pc.createElement("span",{className:"hidden sm:inline"},g)),Pc.createElement("div",{className:"flex-1 min-w-0 flex items-center justify-center gap-2 overflow-x-auto"},Pc.createElement("div",{className:"flex items-center gap-1.5 sm:gap-2 px-1"},t.map(e=>{const t="review"!==(n=e.id)&&"fees"!==n||a;var n;const r=e.id===tt;return Pc.createElement("button",{key:e.id,type:"button",onClick:n=>{n.stopPropagation(),t&&ot(e.id)},disabled:!t,className:"inline-flex items-center gap-1.5 px-2 py-1 rounded-full border text-[11px] whitespace-nowrap transition-colors "+(r?"bg-purple-500/20 text-purple-200 border-purple-500/35":t?"bg-neutral-950/30 text-neutral-300 border-neutral-800/70 hover:bg-neutral-900/60":"bg-neutral-900/20 text-neutral-600 border-neutral-900/40 cursor-not-allowed"),title:e.label},Pc.createElement("span",{className:"grid place-items-center h-5 w-5 rounded-full text-[11px] font-bold "+(r?"bg-purple-500/25 text-purple-200":t?"bg-neutral-900/40 text-neutral-200":"bg-neutral-900/20 text-neutral-600")},e.num),Pc.createElement("span",{className:"hidden md:inline"},e.label))})),Pc.createElement("span",{className:"text-[11px] text-neutral-500 shrink-0"},r+1,"/",t.length),l&&null!=be?.totalRequired&&Pc.createElement("span",{className:"hidden sm:inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs bg-fuchsia-500/10 border border-fuchsia-500/30 shrink-0"},Pc.createElement("span",{className:"text-fuchsia-200 font-semibold"},Number(be.totalRequired).toLocaleString()," sats")),o&&Ln.length>0&&Pc.createElement("span",{className:"hidden sm:inline text-[10px] px-2 py-0.5 rounded-full bg-green-500/15 text-green-300 border border-green-500/30 font-semibold shrink-0"},Ln.length," in batch")),l?Pc.createElement("button",{onClick:e=>{e.stopPropagation(),Kn()},disabled:xe||(()=>{if(Ln.length>0)return!1;const e=!!String(N||"").trim(),t=Qn(A),n=Zn({delegateId:_,metaprotocol:L,metadata:M,properties:$,selectedParents:p,reinscriptionTarget:m,pointer:H});return!(!q||String(j||"").trim()||!t||"string"==typeof A&&A.startsWith("data:")||!Un)||!e||!t&&!n})(),className:"flex items-center gap-1 sm:gap-1.5 px-2.5 sm:px-4 py-2 sm:py-2.5 rounded-lg text-xs sm:text-sm font-semibold transition-all duration-150 touch-manipulation shrink-0 "+(xe?"bg-neutral-800/60 text-neutral-400 cursor-wait":"bg-gradient-to-r from-purple-500 to-pink-500 text-white hover:from-purple-600 hover:to-pink-600 active:from-purple-700 active:to-pink-700 shadow-lg shadow-purple-500/30")},xe?Pc.createElement(Pc.Fragment,null,Pc.createElement("span",{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 rounded-full border-2 border-white/30 border-t-white animate-spin"}),Pc.createElement("span",{className:"hidden sm:inline"},"Inscribing\u2026")):Pc.createElement(Pc.Fragment,null,Pc.createElement("svg",{className:"w-3.5 h-3.5 sm:w-4 sm:h-4",viewBox:"0 0 20 20",fill:"currentColor"},Pc.createElement("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})),Pc.createElement("span",{className:"hidden sm:inline"},"Create Inscription"),Pc.createElement("span",{className:"sm:hidden"},"Inscribe"))):f?Pc.createElement("button",{onClick:e=>{e.stopPropagation(),(()=>{if(s)return d?((()=>{if(!d)return!1;const e=[];1===p.length&&e.push("Parent-Child"),p.length>1&&e.push(`Multi-Parent (${p.length})`),m&&e.push("Reinscription"),_&&e.push("Delegate"),L&&e.push(L),M&&e.push("Metadata"),$&&e.push("Properties"),j&&e.push("Encoding"),zn&&e.push("Brotli"),H&&e.push("Pointer"),rr({content:A,contentType:N,contentSize:T,fileName:B,selectedParents:p,reinscriptionTarget:m,delegateId:_,metaprotocol:L,metadata:M,properties:$,contentEncoding:j,compressBeforeInscribe:!!zn,pointer:H,recipientAddress:ie,repeatCount:se,features:e})})(),void ot("review")):(a||Se({type:"info",message:"Add content (or set a delegate) to add a new item before Review."}),void ot("review"));r<t.length-1&&ot(t[r+1].id)})()},disabled:h,className:"flex items-center gap-1 sm:gap-1.5 px-2.5 sm:px-4 py-2 sm:py-2.5 rounded-lg text-xs sm:text-sm font-medium transition-all duration-150 touch-manipulation shrink-0 "+(h?"bg-neutral-800/50 text-neutral-500 cursor-not-allowed":"bg-purple-600 text-white hover:bg-purple-500 active:bg-purple-700")},f,Pc.createElement("svg",{className:"w-3.5 h-3.5 sm:w-4 sm:h-4",viewBox:"0 0 20 20",fill:"currentColor"},Pc.createElement("path",{fillRule:"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z",clipRule:"evenodd"}))):Pc.createElement("div",{className:"w-10 sm:w-[100px]"})))},[Ve,ke,tt,Ln,j,Un,ot,A,N,T,B,p,m,_,L,M,$,H,ie,se,rr,Kn,xe,be,q,zn]);return Pc.createElement("div",{className:"fixed inset-0 bg-black/90 backdrop-blur-md z-[9999] flex items-center justify-center p-0"},Pc.createElement("div",{className:"flex flex-col bg-neutral-950 border-0 sm:border border-neutral-800 rounded-none sm:rounded-2xl w-full sm:w-[98vw] max-w-[2000px] h-full h-[100dvh] shadow-2xl overflow-hidden"},Pc.createElement(_E,{walletAddress:e?.ordinalsAddress||e?.address,walletType:e?.walletType,isConnected:e?.isConnected,onConnect:On,onDisconnect:r,connectDisabled:!1,utxoCount:ge?.length||0,scrollContainerRef:rt,activeSection:"utxos"===ke?"utxos":"oodl"===ke?"oodl":"inscribe",oodlSection:Ce,onSectionChange:e=>{if("utxos"!==e)return"marketplace"===e?(Je(Ge("oodl")),void Be("marketplace")):"hub"===e?(Je(Ge("oodl")),void Be("hub")):void Je(Ge("oodl"!==e?Ze||"text":"oodl"));Je(Ge("utxos"))}}),ut>0&&e?.isConnected&&Pc.createElement("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm z-[9200] flex items-center justify-center p-4"},Pc.createElement("div",{className:"bg-neutral-950 border border-neutral-800 rounded-2xl px-6 py-5 max-w-lg w-full shadow-2xl"},Pc.createElement("div",{className:"flex items-center gap-3 mb-4"},Pc.createElement("div",{className:"h-5 w-5 rounded-full border-2 border-blue-400 border-t-transparent animate-spin"}),Pc.createElement("div",{className:"text-sm font-semibold text-neutral-100"},"Transaction in progress")),(()=>{const e=Pn;return Array.isArray(e)?Pc.createElement(NE,{steps:e}):e&&"object"==typeof e&&e.steps?Pc.createElement(NE,{steps:e.steps,title:e.title}):Pc.createElement("div",{className:"text-xs text-neutral-400 leading-relaxed"},String(e||"Processing\u2026"))})(),Pc.createElement("div",{className:"mt-4 text-[11px] text-neutral-500"},"Approve or deny the request in your wallet popup."))),Pc.createElement("div",{ref:rt,className:"oodl"===ke?Pe?"isolate relative z-0 grid grid-cols-1 max-lg:auto-rows-auto lg:auto-rows-fr lg:grid-cols-[minmax(0,2fr)_minmax(0,1fr)] gap-2 sm:gap-4 p-1.5 sm:p-4 min-h-0 flex-1 overflow-y-auto overflow-x-hidden [&>*:nth-child(1)]:max-lg:order-2 [&>*:nth-child(2)]:max-lg:order-1":"isolate relative z-0 grid grid-cols-1 max-lg:auto-rows-fr gap-2 sm:gap-4 p-1.5 sm:p-4 min-h-0 flex-1 overflow-y-auto overflow-x-hidden":"isolate relative z-0 min-h-0 flex-1 overflow-hidden",style:"oodl"!==ke?{perspective:"1200px"}:void 0},Pc.createElement(IA,{className:"h-full min-h-0 "+("oodl"===ke&&"editor"!==tt?"max-lg:hidden":""),style:"oodl"!==ke?mr("editor"):void 0,onClick:"oodl"!==ke&&"editor"!==tt?()=>ot("editor"):void 0},"oodl"!==ke&&gr("editor")&&!e?.isConnected&&Pc.createElement("div",{className:"absolute inset-0 z-[40] flex items-center justify-center bg-black/70 backdrop-blur-sm rounded-xl",style:{pointerEvents:"auto"}},Pc.createElement("div",{className:"flex flex-col items-center gap-4 p-8 max-w-sm text-center"},Pc.createElement("div",{className:"w-16 h-16 rounded-full bg-purple-500/20 flex items-center justify-center"},Pc.createElement("svg",{className:"w-8 h-8 text-purple-400",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2"},Pc.createElement("path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4"}),Pc.createElement("path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5"}),Pc.createElement("path",{d:"M18 12a2 2 0 0 0 0 4h4v-4h-4z"}))),Pc.createElement("h3",{className:"text-lg font-semibold text-white"},"Connect Your Wallet"),Pc.createElement("p",{className:"text-sm text-neutral-400"},"Connect your Bitcoin wallet to start creating inscriptions"),Pc.createElement("button",{onClick:e=>{e.stopPropagation(),On()},className:"px-6 py-3 rounded-lg bg-purple-600 text-white font-medium hover:bg-purple-500 active:bg-purple-700 transition-colors touch-manipulation"},"Connect Wallet"))),Pc.createElement(rA,{content:A,contentType:N,fileName:B,onFileNameChange:P,onContentChange:k,onContentTypeChange:I,onContentEncodingChange:V,compressBeforeInscribe:q,onCompressBeforeInscribeChange:X,isDraftCompressing:Un,draftCompressedSize:K,onImportJson:nr,contentSize:T,feeRate:ce,onFeeRateChange:jn,feeEstimate:be,walletAddress:e?.address,walletState:e,onConnect:On,walletInscriptions:l,loadingInscriptions:u,selectedUtxos:ge,onUtxosChange:t=>{const n=new Set(Ln.filter(e=>e.reinscriptionTargetData?.utxo).map(e=>`${e.reinscriptionTargetData.utxo.txid}:${e.reinscriptionTargetData.utxo.vout}`));let r=Array.isArray(t)?t.filter(e=>!n.has(`${e.txid}:${e.vout}`)):[];const i=e?.ordinalsAddress,a=e?.paymentAddress||e?.address;i&&a&&i!==a&&r.some(e=>(e.address||a)===a)&&(r=r.filter(e=>(e.address||a)!==i)),he(r),gt(),t.length,r.length},onUtxoSelect:t=>{const n=new Set(Ln.filter(e=>e.reinscriptionTargetData?.utxo).map(e=>`${e.reinscriptionTargetData.utxo.txid}:${e.reinscriptionTargetData.utxo.vout}`)),r=`${t.txid}:${t.vout}`,i=e?.ordinalsAddress,a=e?.paymentAddress||e?.address;n.has(r)?Se({type:"error",message:"This UTXO is a reinscription target and cannot fund commit fees."}):he(e=>e.some(e=>e.txid===t.txid&&e.vout===t.vout)?e.filter(e=>!(e.txid===t.txid&&e.vout===t.vout)):i&&a&&i!==a&&(t.address||a)===i&&e.some(e=>(e.address||a)===a)?(Se({type:"error",message:"This UTXO belongs to your ordinals address and is excluded while payment UTXOs are available."}),e):[...e,t])},onFeesLoaded:e=>{if(pe(e),me(function(){const e=function(){try{const e=sessionStorage.getItem(AE);return e?JSON.parse(e):null}catch(tn){return null}}();return e?e.isDefault?{status:"default",message:"Using default rates (network unavailable)",color:"yellow"}:!(t=e.timestamp)||Date.now()-t>3e5?{status:"stale",message:"Fee rates are outdated (click refresh)",color:"orange"}:{status:"fresh",message:"Fee rates up to date",color:"green"}:{status:"not-loaded",message:"Fee rates not loaded",color:"gray"};var t}()),e&&!e.isDefault&&null===ce){const t="number"==typeof e.slow&&e.slow>=a?e.slow:"number"==typeof e.medium&&e.medium>=a?e.medium:null;null!==t&&ue(t)}},onFilteredUtxosLoaded:async t=>{try{if(!e?.isConnected)return;if(!t)return;x(e=>({...e||{},status:"extracting",phase:"inscriptions",message:"Extracting inscriptions from wallet UTXOs\u2026",error:"",ts:Date.now()})),gt(),d(!0);const i=e?.ordinalsAddress||e?.address||"",a=e?.paymentAddress||e?.address||"",{getCachedInscriptions:o,setCachedInscriptions:s}=await n(async()=>{const{getCachedInscriptions:e,setCachedInscriptions:t}=await Promise.resolve().then(()=>kk);return{getCachedInscriptions:e,setCachedInscriptions:t}},__VITE_PRELOAD__),u=i&&o(i)||[];let p=[];if(u.length>0)p=u;else{const e=Array.isArray(t)?t.filter(e=>e.reason||e.assetCheck):t.unsafe||[],{extractInscriptionsFromUtxos:r}=await n(async()=>{const{extractInscriptionsFromUtxos:e}=await Promise.resolve().then(()=>wk);return{extractInscriptionsFromUtxos:e}},__VITE_PRELOAD__);p=await r(e),a&&p.length>0&&s(a,p)}const f=i||a;let m=p.map(e=>{const t=l.find(t=>t.id===e.id||t.id===e.rawId);return t?{...t,address:e.address||t.address||f,utxo:{...t.utxo||{},...e.utxo||{},address:e.utxo?.address||e.address||t.utxo?.address||f}}:{...e,address:e.address||f,utxo:{...e.utxo||{},address:e.utxo?.address||e.address||f}}});const g=m.filter(e=>{const t=e.contentType||e.content_type;return!(t&&"application/octet-stream"!==t||e.satpoint)});if(g.length>0){const{enrichInscriptions:e}=await n(async()=>{const{enrichInscriptions:e}=await Promise.resolve().then(()=>sA);return{enrichInscriptions:e}},__VITE_PRELOAD__);try{(await e(g,e=>{})).forEach(e=>{const t=m.findIndex(t=>t.id===e.id);if(-1!==t){const n=m[t];m[t]={...e,address:e.address||n.address,utxo:{...e.utxo||{},...n.utxo||{},address:n.utxo?.address||e.address||n.address}}}})}catch(_k){}}try{const e=[i,a].filter(Boolean).flatMap(e=>o(e)||[]);if(e.length>0){const t=new Map;[...m,...e].forEach(e=>{e&&e.id&&t.set(e.id,{...t.get(e.id),...e})}),m=Array.from(t.values())}}catch(r){}try{const e=new Set((p||[]).map(e=>e&&(e.id||e.rawId)).filter(Boolean));e.size>0&&(m=m.filter(t=>e.has(t.id)))}catch(r){}c(m),d(!1);const h=m.filter(e=>e.utxo&&e.utxo.txid&&void 0!==e.utxo.vout&&e.utxo.value&&e.utxo.address);m.length,h.length,b(t),x(e=>({...e||{},status:"ready",phase:"done",message:`Wallet assets ready (${m.length} inscription(s)).`,error:"",ts:Date.now(),lastSuccessAt:Date.now(),inscriptionCount:m.length}))}catch(_k){d(!1),x(t=>({...t||{},status:"error",phase:"inscriptions",message:"",error:_k?.message||String(_k),ts:Date.now()}))}},utxoRescanRequestId:w,onUtxoScanStateChange:E,walletAssetScanState:y,onRequestWalletRescan:S,inscribing:xe,selectedParents:p,reinscriptionTarget:m,delegateId:_,metaprotocol:L,metadata:M,properties:$,pointer:H,contentEncoding:j,recipientAddress:ie,repeatCount:se,onRepeatCountChange:le,batchItems:Ln,onAddToBatch:rr,onRemoveFromBatch:or,onDuplicateBatchItem:ar,onEditBatchItem:sr,inscriptionMode:o,selectedSaleInscription:Vt(),salePriceSats:ht,onSalePriceSatsChange:bt,listingScriptAddress:yt,onListingScriptAddressChange:xt,markerValueSats:wt,onMarkerValueSatsChange:vt,listingDryRun:St,onListingDryRunChange:Nt,saleMinBlockHeight:It,onSaleMinBlockHeightChange:At,onCreateListingTx:qt,onCreateBulkListingTx:en,createListingDisabled:!e?.isConnected||!Vt()||!String(ht||"").trim(),multiListingDisabled:!e?.isConnected||(Array.isArray(p)?p.length:0)<2,sellerStatus:Xt,sellerError:Kt,bulkSellerStatus:nn,bulkSellerError:rn,bulkBundleJson:an,onCreateMultiListingTx:sn,multiSellerStatus:ln,multiSellerError:cn,multiListingResult:un,multiAssetPricing:pn,onMultiAssetPriceChange:fn,onMultiUniformPriceChange:mn,collectionAuthoritySlots:bn,collectionAuthorityStatus:yn,collectionAuthorityError:xn,collectionAuthoritySlotId:wn,onCollectionAuthoritySlotIdChange:vn,onLaunchCollection:Tn,onLaunchParcelManifest:Bn,previousManifest:En,previousManifestStatus:Nn,previousManifestError:In,onLoadPreviousManifest:kn,manualSellerPsbt:Qt.manualSellerPsbt,manualSellerStatus:Qt.manualSellerStatus,manualSellerError:Qt.manualSellerError,onCreateManualSellerOfferPsbt:Qt.onCreateManualSellerOfferPsbt?async()=>{pt();try{return await Qt.onCreateManualSellerOfferPsbt()}finally{ft()}}:void 0,manualBuyStatus:Qt.manualBuyStatus,manualBuyError:Qt.manualBuyError,onBuyFromSellerOfferPsbt:Qt.onBuyFromSellerOfferPsbt?async e=>{pt();try{return await Qt.onBuyFromSellerOfferPsbt(e)}finally{ft()}}:void 0,manualBuyerFundedPsbt:Qt.manualBuyerFundedPsbt,manualBuyerFundedStatus:Qt.manualBuyerFundedStatus,manualBuyerFundedError:Qt.manualBuyerFundedError,onCreateBuyerFundedPsbtForSeller:Qt.onCreateBuyerFundedPsbtForSeller?async e=>{pt();try{return await Qt.onCreateBuyerFundedPsbtForSeller(e)}finally{ft()}}:void 0,manualSellerCountersignStatus:Qt.manualSellerCountersignStatus,manualSellerCountersignError:Qt.manualSellerCountersignError,onCountersignAndBroadcastFromBuyerFundedPsbt:Qt.onCountersignAndBroadcastFromBuyerFundedPsbt?async e=>{pt();try{return await Qt.onCountersignAndBroadcastFromBuyerFundedPsbt(e)}finally{ft()}}:void 0,buyRevealTxid:Ct,onBuyRevealTxidChange:Bt,onBuyFromRevealTx:async()=>{Lt(""),_t("");let t=null;pt();try{if(!e?.isConnected)throw new Error("Wallet not connected");const i=String(Ct||"").trim(),a=/^[0-9a-fA-F]{64}$/.test(i),o=/^[0-9a-fA-F]{64}i\d+$/.test(i.split(":")[0]);if(!a&&!o)throw new Error("Enter a valid reveal txid (64 hex) or inscription id (<txid>i<index>)");const s=h?Array.isArray(h)?h:h.spendable||[]:[],l=t=>{const n=[...Array.isArray(s)?s:[],...Array.isArray(ge)?ge:[]];if(!Array.isArray(n)||0===n.length)return[];const r=n.map(n=>{if(!n)return null;const r=n?.fullUtxo||n?.utxo||n?.raw||n?.full||n,i=r.txid||r.txId||r.hash,a=r.vout??r.index??r.n,o=r.value??r.satoshis??r.amount,s=r.address||r.addr||t;if(!i||null==a)return null;const l=Number(o);if(!Number.isFinite(l)||l<=0)return null;const c=e?.ordinalsAddress||null,u=e?.paymentAddress||null;if(c&&u&&c!==u){const e=String(s||"").trim();if(e&&e===String(c).trim())return null}return{txid:String(i),vout:Number(a),value:l,address:s}}).filter(Boolean),i=new Map;return r.forEach(e=>i.set(`${e.txid}:${e.vout}`,e)),Array.from(i.values())},c=e?.provider||window.NexusWalletConnect;if(!c)throw new Error("Wallet provider not available");const u=e?.paymentAddress||e?.address||e?.ordinalsAddress,d=e?.ordinalsAddress||e?.address||e?.paymentAddress;if(!u)throw new Error("Wallet payment/change address not available");if(!d)throw new Error("Wallet ordinals/receive address not available");const p=l(u);if(!Array.isArray(p)||0===p.length)throw new Error("No spendable payment UTXOs loaded. Click \u201cFetch UTXOs\u201d first (or select UTXOs).");const f=p.reduce((e,t)=>e+(Number(t?.value)||0),0);let m=p;if(p.length<3){try{_t("Checking listing requirements before split-funding\u2026");const{estimateBuyNeedFromRevealTx:e,estimateBuyNeedFromInscriptionId:t}=await n(async()=>{const{estimateBuyNeedFromRevealTx:e,estimateBuyNeedFromInscriptionId:t}=await Promise.resolve().then(()=>Zo);return{estimateBuyNeedFromRevealTx:e,estimateBuyNeedFromInscriptionId:t}},__VITE_PRELOAD__),r=a?await e({walletProvider:c,revealTxid:i,buyerChangeAddress:u,feeRateSatPerVb:ce}):await t({walletProvider:c,inscriptionId:i,buyerChangeAddress:u,feeRateSatPerVb:ce}),o=BigInt(Math.max(0,Math.floor(Number(f)||0))),s=BigInt(r?.needTotalSats||0n);if(s>0n&&o<s){const e=s-o;throw new Error(`Insufficient buyer funds to buy (skipping split-funding). Need >= ${s.toString()} sats (estFee\u2248${String(r?.feeEstimateSats||"?")}), have ${o.toString()} sats, short ${e.toString()} sats.`)}}catch(r){const e=r?.message||String(r);if(String(e).includes("skipping split-funding"))throw r}_t("Not enough payment UTXOs \u2014 creating split funding tx first...");const{createSplitFundingTransaction:o}=await n(async()=>{const{createSplitFundingTransaction:e}=await Promise.resolve().then(()=>ms);return{createSplitFundingTransaction:e}},__VITE_PRELOAD__),s=await o({walletProvider:c,networkName:e.network?.toLowerCase?.()||"mainnet",paymentAddress:u,paymentPublicKeyHex:e?.paymentPublicKey||null,paymentCandidates:p,feeRateSatPerVb:ce,dummySats:600,minRemainderSats:546,label:"buy-funding-split"});if(t=s?.txid||null,t&&_t(`Split funding tx broadcasted (creates 2\xd7600 sat dummies). Mempool: ${Tt(`/tx/${t}`)}. Continuing buy\u2026`),m=[...p.filter(e=>`${e.txid}:${e.vout}`!==s.spentOutpoint),...s.splitUtxos||[]],m.length<3)throw new Error("Split completed but still insufficient payment UTXOs to buy. Click \u201cFetch UTXOs\u201d and try again.")}const{createAndBroadcastBuyFromRevealTx:g,createAndBroadcastBuyFromInscriptionId:b}=await n(async()=>{const{createAndBroadcastBuyFromRevealTx:e,createAndBroadcastBuyFromInscriptionId:t}=await Promise.resolve().then(()=>Zo);return{createAndBroadcastBuyFromRevealTx:e,createAndBroadcastBuyFromInscriptionId:t}},__VITE_PRELOAD__),y=t?` Split funding tx: ${Tt(`/tx/${t}`)}.`:"",x=["Fetch listing","Extract offer","Build transaction","Sign inputs","Finalize","Broadcast"],w=e=>{const t=IE(x,e);y&&t.push({label:y,status:"done"}),_t(t)},v=a?await g({walletProvider:c,revealTxid:i,buyerPaymentUtxos:m,buyerChangeAddress:u,buyerReceiveAddress:d,feeRateSatPerVb:ce,broadcast:!0,onProgress:w}):await b({walletProvider:c,inscriptionId:i,buyerPaymentUtxos:m,buyerChangeAddress:u,buyerReceiveAddress:d,feeRateSatPerVb:ce,broadcast:!0,onProgress:w});v?.buyTxid&&Ae({buyTxid:v.buyTxid,inferredPriceSats:v.inferredPriceSats||null,feeSats:v.feeSats||null});const S=String(v?.buyTxid||"").slice(0,12),E=v?.inferredPriceSats;_t(`Bought. txid=${S}\u2026 price\u2248${E} sats`)}catch(Pk){_t("");let n=Pk?.message||String(Pk);if(Pk?.response?.data){const t=Pk.response.data;"string"==typeof t?n=`${n} - ${t}`:t?.error?n=`${n} - ${t.error}`:t?.message&&(n=`${n} - ${t.message}`)}t&&(n=`${n} | Split funding tx: ${t} | Mempool: ${Tt(`/tx/${t}`)}`),Lt(n)}finally{ft()}},buyDisabled:!e?.isConnected||!String(Ct||"").trim(),buyStatus:Pt,buyError:Ot,buyFundingNeeded:_n,onCreateBuyFundingTx:async()=>{$t(""),Mt(""),pt();try{if(!e?.isConnected)throw new Error("Wallet not connected");const t=e?.provider||window.NexusWalletConnect;if(!t)throw new Error("Wallet provider not available");const r=e?.paymentAddress||e?.address||e?.ordinalsAddress;if(!r)throw new Error("Wallet payment address not available");const i=h?Array.isArray(h)?h:h.spendable||[]:[],a=[...Array.isArray(i)?i:[],...Array.isArray(ge)?ge:[]],o=t=>{if(!t)return null;const n=t?.fullUtxo||t?.utxo||t?.raw||t?.full||t,i=n.txid||n.txId||n.hash,a=n.vout??n.index??n.n,o=n.value??n.satoshis??n.amount,s=n.address||n.addr||r;if(!i||null==a)return null;const l=Number(o);if(!Number.isFinite(l)||l<=0)return null;const c=e?.ordinalsAddress||null,u=e?.paymentAddress||null;if(c&&u&&c!==u){const e=String(s||"").trim();if(e&&e===String(c).trim())return null}return{txid:String(i),vout:Number(a),value:l,address:s}},s=(Array.isArray(a)?a:[]).map(o).filter(Boolean),l=new Map;s.forEach(e=>l.set(`${e.txid}:${e.vout}`,e));const c=Array.from(l.values());if(!Array.isArray(c)||c.length<1)throw new Error("No payment UTXOs available to split. Fund your payment address first.");c.length>=3&&Mt("You already have 3+ payment UTXOs \u2014 splitting anyway (testing mode).");const u=Number(ce||0);if(!Number.isFinite(u)||u<=0)throw new Error("Set a fee rate first (sat/vB) before creating a split funding transaction.");const d=e.network?.toLowerCase?.()||"mainnet";Mt("Creating split funding tx (wallet popup)\u2026");const{createSplitFundingTransaction:p}=await n(async()=>{const{createSplitFundingTransaction:e}=await Promise.resolve().then(()=>ms);return{createSplitFundingTransaction:e}},__VITE_PRELOAD__),{txid:f}=await p({walletProvider:t,networkName:d,paymentAddress:r,paymentPublicKeyHex:e?.paymentPublicKey||null,paymentCandidates:c,feeRateSatPerVb:u,dummySats:600,minRemainderSats:546,label:"buy-funding-split"});Mt(`Split funding tx broadcasted. Mempool: ${Tt(`/tx/${f}`)}. Click \u201cFetch UTXOs\u201d to refresh.`),Dt({fundingTxid:f})}catch(Pk){Mt(""),$t(Pk?.message||String(Pk))}finally{ft()}},buyFundingDisabled:!e?.isConnected,buyFundingStatus:Ft,buyFundingError:Rt,tabRequest:Ye,oodlSection:Ce,onOodlSectionChange:Be,onOodlLayoutChange:e=>{_e(!!e?.showAdvancedOptions),"boolean"==typeof e?.isCollectionWizard&&je(e.isCollectionWizard),e?.openInscriptionsPanel?nt("options"):($e("string"==typeof e?.mobileDefaultPanel?e.mobileDefaultPanel:null),ze("string"==typeof e?.mobileOptionsLabel?e.mobileOptionsLabel:null),He("string"==typeof e?.mobileEditorLabel?e.mobileEditorLabel:null),e&&"object"==typeof e&&("boolean"==typeof e.limitParentSelection?Le(e.limitParentSelection):e?.showAdvancedOptions&&Le(!0),"string"==typeof e.parentsLabel&&e.parentsLabel.trim()?Me(e.parentsLabel.trim()):Me(e?.showAdvancedOptions?"Inscriptions":"Parents")))},onActiveTabChange:e=>{Te(e),"oodl"!==e&&_e(!1),e&&"utxos"!==e&&"oodl"!==e&&et(e)},onParentSelect:Jn,onMobilePanelChange:at,guidedFlowEnabled:Ve,guidedFlowStep:qe,onContinueToAdvancedOptions:st}),hr("editor"),"oodl"!==ke&&!gr("editor")&&Pc.createElement("div",{style:{position:"absolute",inset:0,zIndex:50}})),"oodl"===ke&&Pe&&!We&&Pc.createElement("div",{className:"lg:hidden fixed bottom-0 left-0 right-0 z-[9300] px-2 pt-2 bg-neutral-950/90 backdrop-blur border-t border-neutral-800/60",style:{paddingBottom:"calc(8px + env(safe-area-inset-bottom, 0px))"}},Pc.createElement("div",{className:"max-w-3xl mx-auto flex items-center gap-2"},Pc.createElement("button",{onClick:()=>ot("options"),className:"flex-1 px-3 py-2.5 text-sm font-semibold rounded-lg transition-colors "+("options"===tt?"bg-purple-600 text-white":"bg-neutral-800 hover:bg-neutral-700 text-white"),title:"Select the asset for sale"},Pc.createElement("span",{className:"inline-flex items-center gap-1.5"},Pc.createElement("span",{className:"grid place-items-center h-5 w-5 rounded-full bg-white/10 text-[11px] font-bold"},"1"),String(Ue||Fe||"Inscriptions"))),Pc.createElement("button",{onClick:()=>ot("editor"),disabled:!Vt?.(),className:"flex-1 px-3 py-2.5 text-sm font-semibold rounded-lg transition-colors "+(Vt?.()?"editor"===tt?"bg-emerald-500 text-neutral-950":"bg-emerald-500 hover:bg-emerald-400 text-neutral-950":"bg-neutral-800 text-neutral-500 cursor-not-allowed"),title:Vt?.()?"Configure the seller offer / listing":"Select an inscription first"},Pc.createElement("span",{className:"inline-flex items-center gap-1.5"},Pc.createElement("span",{className:"grid place-items-center h-5 w-5 rounded-full bg-black/10 text-[11px] font-bold"},"2"),String(De||"Setup")))),Vt?.()?null:Pc.createElement("div",{className:"mt-1 text-[11px] text-neutral-400 text-center"},"Select an inscription first to continue.")),"oodl"===ke&&We&&"options"===tt&&Pc.createElement("div",{className:"lg:hidden fixed bottom-0 left-0 right-0 z-[9300] px-2 pt-2 bg-neutral-950/90 backdrop-blur border-t border-neutral-800/60",style:{paddingBottom:"calc(8px + env(safe-area-inset-bottom, 0px))"}},Pc.createElement("div",{className:"max-w-3xl mx-auto"},Pc.createElement("button",{onClick:()=>ot("editor"),className:"w-full px-4 py-2.5 text-sm font-semibold rounded-lg bg-purple-600 hover:bg-purple-500 text-white transition-colors"},"\u2190 Back to Listing Wizard"))),"oodl"!==ke||Pe?Pc.createElement(IA,{className:`h-full min-h-0 ${"oodl"===ke&&"options"!==tt?"max-lg:hidden":""} ${"oodl"===ke&&We&&"options"===tt?"max-lg:pb-14":""}`,style:"oodl"!==ke?mr("options"):void 0,onClick:"oodl"!==ke&&"options"!==tt?()=>ot("options"):void 0},Pc.createElement("div",{id:"advanced-options-panel",className:"h-full bg-neutral-900/50 border border-neutral-800/50 rounded-xl flex flex-col overflow-hidden"},"oodl"!==ke&&gr("options")&&Pc.createElement("div",{className:"shrink-0 flex items-center gap-3 px-3 py-2 border-b border-neutral-800/50 bg-neutral-900/80"},(()=>{const e=String(N||"").toLowerCase();if(!A||!("string"==typeof A?A.length>0:!(A instanceof ArrayBuffer)||A.byteLength>0))return Pc.createElement("div",{className:"flex items-center gap-2 text-neutral-500 text-xs"},Pc.createElement("svg",{className:"w-4 h-4",viewBox:"0 0 20 20",fill:"currentColor"},Pc.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})),Pc.createElement("span",null,"No content loaded \u2014 go back to add content first"));if(e.startsWith("image/")&&A){let e="";try{if("string"==typeof A&&A.startsWith("data:"))e=A;else if(A instanceof ArrayBuffer||"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(A)){const t=new Blob([A],{type:N});e=URL.createObjectURL(t)}}catch{}return Pc.createElement(Pc.Fragment,null,e&&Pc.createElement("img",{src:e,alt:"",className:"w-8 h-8 rounded object-cover border border-neutral-700/50",onLoad:()=>{e.startsWith("blob:")&&URL.revokeObjectURL(e)}}),Pc.createElement("div",{className:"min-w-0 flex-1"},Pc.createElement("div",{className:"text-xs font-medium text-neutral-200 truncate"},B||N),Pc.createElement("div",{className:"text-[10px] text-neutral-500"},Dn(T))))}const t=e.includes("html")?"HTML":e.includes("json")?"JSON":e.includes("javascript")?"JS":e.split("/").pop()?.toUpperCase()||"File";return Pc.createElement(Pc.Fragment,null,Pc.createElement("div",{className:"w-8 h-8 rounded bg-purple-500/10 border border-purple-500/20 flex items-center justify-center text-purple-400 text-[10px] font-bold shrink-0"},t.slice(0,4)),Pc.createElement("div",{className:"min-w-0 flex-1"},Pc.createElement("div",{className:"text-xs font-medium text-neutral-200 truncate"},B||N),Pc.createElement("div",{className:"text-[10px] text-neutral-500"},Dn(T),"string"==typeof A&&A.length>0?` \xb7 ${A.length} chars`:"")))})(),Pc.createElement("span",{className:"text-[10px] text-purple-400 font-medium shrink-0"},"Step 2: Options")),Pc.createElement(uA,{guidedFlowEnabled:Ve,guidedFlowStep:qe,delegateId:_,onDelegateChange:O,reinscriptionTarget:m||"",onReinscriptionTargetChange:e=>{const t=e.split(",").filter(Boolean),n=t[t.length-1],r=l.find(e=>e.id===n);if(r){let e,n,i,a="unknown";if(r.utxo&&void 0!==r.utxo.txid&&void 0!==r.utxo.vout&&(e=r.utxo.txid,n=r.utxo.vout,i=r.utxo.address||r.address,a="utxo"),(!e||void 0===n)&&r.satpoint){const t=String(r.satpoint).split(":");t.length>=2&&(e=e||t[0],n=n??parseInt(t[1]),a="utxo"===a?"utxo+satpoint":"satpoint")}t.length}g(e)},recipientAddress:ie,onRecipientAddressChange:ae,selectedParents:p,inscriptionMode:o,onParentSelect:Jn,metaprotocol:L,onMetaprotocolChange:F,metadata:M,onMetadataChange:R,properties:$,onPropertiesChange:U,pointer:H,onPointerChange:W,walletInscriptions:l,loadingInscriptions:u,ordinalsAddress:e?.ordinalsAddress||e?.address||"",existingReinscriptionTargets:lr,limitParentSelection:!("oodl"!==ke||!Pe||!Oe),showOnlyParents:"oodl"===ke&&Pe,parentsLabel:"oodl"===ke&&Pe?Fe:"Parents",content:A,contentType:N,contentSize:T,contentEncoding:j,fileName:B,compressBeforeInscribe:q,onCompressBeforeInscribeChange:X,isDraftCompressing:Un,draftCompressedSize:K,repeatCount:se,onRepeatCountChange:le,batchItems:Ln,onAddToBatch:rr,onInscriptionSelected:()=>{lt()&&at("editor")}})),hr("options"),"oodl"!==ke&&!gr("options")&&Pc.createElement("div",{style:{position:"absolute",inset:0,zIndex:50}})):null,"oodl"!==ke?Pc.createElement(IA,{className:"h-full min-h-0  ",style:mr("compression"),onClick:"compression"!==tt?()=>{ot("compression")}:void 0},Pc.createElement(kA,{content:A,contentType:N,contentSize:T,fileName:B,contentEncoding:j,compressBeforeInscribe:q,onCompressBeforeInscribeChange:X,isDraftCompressing:Un,draftCompressedSize:K,draftCompressionInputSize:Q,draftCompressionOutcome:ee,onContentChange:k,onContentTypeChange:I,onFileNameChange:P,onContentEncodingChange:V}),hr("compression"),!gr("compression")&&Pc.createElement("div",{style:{position:"absolute",inset:0,zIndex:50}})):null,"oodl"!==ke?Pc.createElement(IA,{className:"h-full min-h-0  ",style:mr("review"),onClick:"review"!==tt?()=>{Array.isArray(Ln)&&Ln.length>0&&ot("review")}:void 0},Pc.createElement("div",{className:"content-editor inscription-card",style:{flex:1,minHeight:0,display:"flex",flexDirection:"column",minWidth:0}},Pc.createElement("div",{className:"inscription-card-header content-editor-header",style:{padding:"4px 8px",flexShrink:0,background:"rgb(23, 23, 23)",borderBottom:"1px solid rgb(38, 38, 38)",borderRadius:"12px 12px 0 0",overflow:"hidden"}},Pc.createElement("div",{className:"content-editor-header-main",style:{minWidth:0,width:"100%",display:"flex",alignItems:"center",gap:"4px"}},Pc.createElement("div",{className:"content-editor-tabs",style:{flex:1,minWidth:0}},Pc.createElement("button",{className:"tab-button active",style:{background:"var(--bgTertiary)",border:"none",borderBottom:"2px solid var(--accentPurple)",padding:"6px 12px",color:"var(--textPrimary)",fontWeight:"var(--fontWeight-medium)",fontSize:"13px",cursor:"default"}},"Review")))),Pc.createElement("div",{style:{flex:1,minHeight:0,overflow:"auto",padding:"8px"}},Pc.createElement(sN,{content:A,contentType:N,contentSize:T,feeEstimate:be,contentEncoding:j,compressBeforeInscribe:zn,onCompressBeforeInscribeChange:void 0,isDraftCompressing:Un,draftCompressedSize:K,fileName:B,selectedParents:p,reinscriptionTarget:m,delegateId:_,metaprotocol:L,metadata:M,properties:$,pointer:H,recipientAddress:ie,repeatCount:se,onRepeatCountChange:le,batchItems:Ln,onAddToBatch:void 0,onRemoveFromBatch:or,onDuplicateBatchItem:ar,onEditBatchItem:sr,onAddAnother:()=>ot("editor"),inscriptionMode:o}))),hr("review"),!gr("review")&&Pc.createElement("div",{style:{position:"absolute",inset:0,zIndex:50}})):null,"oodl"!==ke?Pc.createElement(IA,{className:"h-full min-h-0 overflow-hidden ",style:mr("fees"),onClick:"fees"!==tt?()=>ot("fees"):void 0},Pc.createElement(hA,{feeRate:ce,onFeeRateChange:jn,feeEstimate:be,contentSize:zn&&Number.isFinite(K)?K:T,feeRates:de,feeItemCount:Ln&&Ln.length>0?Ln.length:m?1:Math.max(1,Math.min(200,parseInt(se,10)||1)),onSubmit:Kn,isSubmitting:xe,hideSubmitButton:Ve,isDraftCompressing:Un&&!!q&&!String(j||"").trim(),isDisabled:(()=>{if(Ln.length>0)return!1;const e=!!String(N||"").trim(),t=Qn(A),n=Zn({delegateId:_,metaprotocol:L,metadata:M,properties:$,selectedParents:p,reinscriptionTarget:m,pointer:H});return!(!q||String(j||"").trim()||!t||"string"==typeof A&&A.startsWith("data:")||!Un)||!e||!t&&!n})()}),hr("fees"),!gr("fees")&&Pc.createElement("div",{style:{position:"absolute",inset:0,zIndex:50}})):null),!("oodl"!==ke)&&!("oodl"===ke&&Pe)&&Pc.createElement(NA,{activePanel:tt,onPanelChange:ot,visiblePanels:"oodl"===ke?["editor"]:["editor","options","review","fees"],swipeContainerRef:rt})),Ht&&Pc.createElement("div",{className:"fixed bottom-20 left-1/2 -translate-x-1/2 z-[9999] w-[90vw] max-w-lg"},Array.isArray(Ht)?Pc.createElement(NE,{steps:Ht}):Pc.createElement("div",{className:"text-xs text-blue-300 bg-blue-500/10 border border-blue-500/30 rounded-lg px-4 py-3 shadow-lg backdrop-blur-sm"},String(Ht))),ve&&Pc.createElement(bA,{type:ve.type,message:ve.message,onClose:()=>Se(null)}),Ee&&Pc.createElement(wA,{result:Ee,onClose:()=>{Ne(null),kE(),k(""),C(0),f([]),he([]),ye(null),Fn([]),Rn(null)}}),Gt&&Pc.createElement(SA,{kind:"listing",result:Gt,onClose:()=>{Jt(null),dn()}}),Ie&&Pc.createElement(SA,{kind:"buy",result:Ie,onClose:()=>Ae(null)}),Ut&&Pc.createElement(SA,{kind:"funding",result:Ut,onClose:()=>Dt(null)}),Qt?.manualBuySuccessResult&&Pc.createElement(SA,{kind:"buy",result:Qt.manualBuySuccessResult,onClose:()=>{try{"function"==typeof Qt.clearManualBuySuccessResult&&Qt.clearManualBuySuccessResult()}catch(Pk){}}}))}function $A({message:e="Loading...",subtext:t="",icon:n="\u23f3"}){return Pc.createElement("div",{className:"loading-overlay"},Pc.createElement("div",{className:"loading-spinner"},Pc.createElement("div",{className:"spinner-icon","aria-hidden":!0},n),Pc.createElement("h3",null,e),t?Pc.createElement("p",null,t):null))}function UA({walletName:e,url:t,copied:n}={}){if("undefined"==typeof window)return null;const r=String(e||"Wallet"),i=String(t||""),a=!!n,o=e=>String(e).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;");let s;try{s=window.open("","_blank")}catch{s=null}if(!s||!s.document)return null;try{s.opener=null}catch{}const l=`<!doctype html>\n<html lang="en">\n  <head>\n    <meta charset="utf-8" />\n    <meta name="viewport" content="width=device-width, initial-scale=1" />\n    <title>${o(r)} \u2014 Open in Wallet</title>\n    <style>\n      :root { color-scheme: dark; }\n      body { margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial; background: #050505; color: #f5f5f5; }\n      .wrap { max-width: 720px; margin: 0 auto; padding: 24px; }\n      .card { border: 1px solid rgba(255,255,255,0.12); background: rgba(255,255,255,0.06); border-radius: 14px; padding: 18px; }\n      h1 { font-size: 18px; margin: 0 0 10px; }\n      p { margin: 10px 0; color: rgba(255,255,255,0.78); line-height: 1.45; font-size: 14px; }\n      .url { margin-top: 12px; padding: 12px; border-radius: 10px; background: rgba(0,0,0,0.45); border: 1px solid rgba(255,255,255,0.10); word-break: break-all; font-size: 13px; user-select: all; }\n      .row { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 14px; }\n      button { appearance: none; border: 1px solid rgba(255,255,255,0.14); background: rgba(255,255,255,0.08); color: #fff; padding: 10px 12px; border-radius: 10px; font-weight: 650; cursor: pointer; }\n      button:hover { background: rgba(255,255,255,0.12); }\n      .muted { color: rgba(255,255,255,0.55); font-size: 12px; }\n      .badge { display: inline-block; font-size: 12px; font-weight: 750; padding: 4px 8px; border-radius: 999px; background: rgba(168,85,247,0.20); border: 1px solid rgba(168,85,247,0.35); color: #e9d5ff; }\n    </style>\n  </head>\n  <body>\n    <div class="wrap">\n      <div class="card">\n        <h1>${o(r)} \u2014 open this site in wallet</h1>\n        <p>\n          <span class="badge">${a?"Copied to clipboard":"Copy may be blocked"}</span>\n        </p>\n        <p>\n          If ${o(r)} didn\u2019t auto-open this site, paste the URL below into the wallet\u2019s browser / URL bar.\n          This is normal on some mobile/extension flows.\n        </p>\n        <div class="url" id="nexus-url">${o(i||"(URL unavailable)")}</div>\n        <div class="row">\n          <button id="copyBtn" type="button">Copy URL</button>\n          <button id="closeBtn" type="button">Close</button>\n        </div>\n        <p class="muted" id="status"></p>\n      </div>\n    </div>\n    \x3Cscript>\n      (function () {\n        const url = ${JSON.stringify(i)};\n        const status = document.getElementById('status');\n        function setStatus(t) { status.textContent = t || ''; }\n\n        document.getElementById('copyBtn').addEventListener('click', async () => {\n          if (!url) { setStatus('No URL available to copy.'); return; }\n          try {\n            if (navigator.clipboard && navigator.clipboard.writeText) {\n              await navigator.clipboard.writeText(url);\n              setStatus('Copied. Paste it in the wallet browser.');\n              return;\n            }\n          } catch (e) {}\n          try {\n            const el = document.createElement('textarea');\n            el.value = url;\n            el.setAttribute('readonly', '');\n            el.style.position = 'fixed';\n            el.style.top = '-9999px';\n            el.style.left = '-9999px';\n            document.body.appendChild(el);\n            el.select();\n            el.setSelectionRange(0, el.value.length);\n            document.execCommand('copy');\n            document.body.removeChild(el);\n            setStatus('Copied. Paste it in the wallet browser.');\n          } catch (e) {\n            setStatus('Copy failed. Select the URL text and copy manually.');\n          }\n        });\n\n        document.getElementById('closeBtn').addEventListener('click', () => {\n          try { window.close(); } catch (e) {}\n        });\n      })();\n    <\/script>\n  </body>\n</html>`;try{s.document.open(),s.document.write(l),s.document.close()}catch{}return s}const zA="nexus_last_wallet",DA={width:"100%",display:"flex",alignItems:"center",gap:"12px",fontSize:"15px",padding:"12px 14px",borderRadius:"10px",border:"1px solid rgba(255,255,255,0.12)",background:"rgba(255,255,255,0.08)",color:"#e5e5e5",cursor:"pointer",transition:"all 0.15s ease"},HA=({wallet:e,walletConfig:t,onClick:n,disabled:r,isConnecting:i,isLastUsed:a})=>Pc.createElement("button",{onClick:n,disabled:r,style:{...DA,opacity:r?.5:1,cursor:r?"not-allowed":"pointer"},onMouseEnter:e=>{r||(e.currentTarget.style.background="rgba(255,255,255,0.14)",e.currentTarget.style.borderColor="rgba(168,85,247,0.4)")},onMouseLeave:e=>{e.currentTarget.style.background="rgba(255,255,255,0.08)",e.currentTarget.style.borderColor="rgba(255,255,255,0.12)"}},Pc.createElement("span",{style:{flex:1,textAlign:"left",fontWeight:500}},i?"\u23f3 Connecting\u2026 ":"",e.name,a&&Pc.createElement("span",{style:{fontSize:"10px",marginLeft:"8px",color:"rgba(168,85,247,0.7)",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.05em"}},"Last used")),Pc.createElement("span",{style:{opacity:.25,fontSize:"14px",fontWeight:300}},"\u2192")),WA=({config:e})=>Pc.createElement("a",{href:e.installUrl,target:"_blank",rel:"noopener noreferrer",style:{...DA,opacity:.55,textDecoration:"none",cursor:"pointer"},onMouseEnter:e=>{e.currentTarget.style.opacity="0.8",e.currentTarget.style.borderColor="rgba(255,255,255,0.15)"},onMouseLeave:e=>{e.currentTarget.style.opacity="0.55",e.currentTarget.style.borderColor="rgba(255,255,255,0.12)"}},Pc.createElement("span",{style:{flex:1,textAlign:"left",fontWeight:500}},e.name),Pc.createElement("span",{style:{fontSize:"11px",opacity:.7,fontWeight:500}},"Install \u2197")),jA=({children:e,style:t})=>Pc.createElement("p",{style:{fontSize:"11px",textTransform:"uppercase",letterSpacing:"0.06em",color:"rgba(255,255,255,0.35)",margin:"0 0 6px 2px",fontWeight:600,...t}},e),VA=({mode:e,onChange:t,style:n})=>{const r=[{key:"extension",label:"\ud83d\udda5\ufe0f Extension",tip:"Use browser extension"},{key:"app",label:"\ud83d\udcf1 Open in App",tip:"Open in wallet app"}];return Pc.createElement("div",{style:{display:"flex",gap:0,borderRadius:"8px",border:"1px solid rgba(255,255,255,0.12)",overflow:"hidden",background:"rgba(255,255,255,0.04)",width:"100%",...n},title:r.find(t=>t.key===e)?.tip||""},r.map(n=>Pc.createElement("button",{key:n.key,onClick:()=>t(n.key),style:{flex:1,padding:"8px 6px",fontSize:"12px",fontWeight:600,border:"none",cursor:"pointer",background:e===n.key?"rgba(168,85,247,0.25)":"transparent",color:e===n.key?"#d8b4fe":"rgba(255,255,255,0.45)",transition:"all 0.15s ease"}},n.label)))},qA=e=>{const{isOpen:t,onClose:n,installedWallets:r,wallets:i,onConnectWallet:a,onOpenMobileWallet:o,loading:s,connectingWallet:l}=e,[c,u]=Bc.useState(!1),[d,p]=Bc.useState("extension");if(Bc.useEffect(()=>{t||u(!1)},[t]),!t)return null;const f=e=>String(e||"").toLowerCase().replace(/\s+/g,""),m=Array.isArray(i)?i:[],g=(()=>{try{return localStorage.getItem(zA)||null}catch{return null}})(),h=(()=>{try{return"undefined"!=typeof window?String(window.location?.href||""):""}catch{return""}})(),b=async()=>{try{const e=String(h||"");if(!e)return!1;if("undefined"!=typeof navigator&&navigator.clipboard&&navigator.clipboard.writeText)return await navigator.clipboard.writeText(e),!0}catch{}try{const e=String(h||"");if(!e||"undefined"==typeof document)return!1;const t=document.createElement("textarea");return t.value=e,t.setAttribute("readonly",""),t.style.position="fixed",t.style.top="-9999px",t.style.left="-9999px",document.body.appendChild(t),t.select(),t.setSelectionRange(0,t.value.length),document.execCommand("copy"),document.body.removeChild(t),!0}catch{}return!1},y=async e=>{try{const t=String(h||"");UA({walletName:"Magic Eden",url:t,copied:await b()});const n=e?.appUrl||(I&&"function"==typeof I.getMagicEdenMobileOpenAppUrl?I.getMagicEdenMobileOpenAppUrl(t):null);n&&setTimeout(()=>{try{window.location.href=n}catch{}},150)}catch{}},x=e=>{const t=f(e?.name),n=f(e?.id);return m.find(e=>f(e?.name)===t)||m.find(e=>f(e?.id)===n)||XA.find(e=>f(e?.name)===t)||XA.find(e=>f(e?.id)===n)},w=new Set((r||[]).map(e=>f(e?.name))),v=g?(r||[]).find(e=>f(e?.name)===f(g)):null,S=(r||[]).filter(e=>!(v&&f(e?.name)===f(v?.name))),E=XA.filter(e=>!w.has(f(e?.name))),N=E.length>0,I="undefined"!=typeof window?window.NexusWalletConnect:null,A=(()=>{try{if(I&&"function"==typeof I.isMobileDevice)return!!I.isMobileDevice()}catch{}try{const e=("undefined"!=typeof navigator&&navigator.userAgent||"").toLowerCase();if(/android|iphone|ipad|ipod|iemobile|opera mini|mobile/.test(e))return!0;if(/samsungbrowser/i.test(e))return!0;try{if("android"===navigator.userAgentData?.platform?.toLowerCase())return!0}catch{}}catch{}return!1})(),k=(()=>{try{if(I&&"function"==typeof I.isTabletDevice)return!!I.isTabletDevice()}catch{}try{try{const e=navigator.userAgentData;if(e&&"android"===(e.platform||"").toLowerCase()&&!1===e.mobile)return!0}catch{}const e=("undefined"!=typeof navigator&&navigator.userAgent||"").toLowerCase();if(/samsungbrowser/i.test(e)&&("number"==typeof navigator.maxTouchPoints?navigator.maxTouchPoints:0)>1&&Math.min(window.screen?.width||0,window.screen?.height||0)>=600)return!0;if(/macintosh/.test(e)&&"number"==typeof navigator.maxTouchPoints&&navigator.maxTouchPoints>1)return!0;if(/ipad/.test(e))return!0;if(/android/.test(e)&&!/mobile/.test(e))return!0;if(/sm-[txp]\d/i.test(navigator.userAgent||""))return!0;if("number"==typeof navigator.maxTouchPoints&&navigator.maxTouchPoints>1&&Math.min(window.screen?.width||0,window.screen?.height||0)>=768)return!0}catch{}return!1})(),T=(()=>{try{if(I&&"function"==typeof I.isHybridDevice)return!!I.isHybridDevice()}catch{}return k})();(()=>{try{if(I&&"function"==typeof I.getDeviceType)return I.getDeviceType()}catch{}})();const C=k||T,B=(()=>{try{if(I&&"function"==typeof I.listMobileWalletOptions)return I.listMobileWalletOptions({targetUrl:h,includeManual:!0})}catch{}return[]})(),P=(()=>{try{const e=("undefined"!=typeof navigator&&navigator.userAgent||"").toLowerCase();return/iphone|ipad|ipod/.test(e)}catch{return!1}})(),_=(()=>{try{if("undefined"==typeof window)return!1;const e=window.XverseProviders?.BitcoinProvider||window.BitcoinProvider;return!(!e||"function"!=typeof e.request)}catch{return!1}})(),O=e=>{if(A&&P&&"xverse"===f(e)&&!_){try{const e=(B||[]).find(e=>"xverse"===f(e?.name));if(e?.openUrl)return void(window.location.href=e.openUrl)}catch{}if("function"==typeof o)return void o("Xverse")}(e=>{try{e&&localStorage.setItem(zA,e)}catch{}})(e),a(e)};return Pc.createElement("div",{className:"modal-overlay",onClick:n,style:{zIndex:99999}},Pc.createElement("div",{className:"modal-card",onClick:e=>e.stopPropagation()},Pc.createElement("div",{className:"modal-header"},Pc.createElement("h2",{className:"modal-title"},"Select Wallet"),Pc.createElement("button",{className:"modal-close",onClick:n},"\u2715")),Pc.createElement("div",{className:"modal-body"},0===r.length?Pc.createElement("div",{className:"empty-state"},C?Pc.createElement(Pc.Fragment,null,Pc.createElement("div",{style:{width:"100%",marginBottom:"12px"}},Pc.createElement("div",{style:{fontSize:"12px",opacity:.55,marginBottom:"8px",lineHeight:1.4}},"\ud83d\udcbb\u200a/\u200a\ud83d\udcf1 Tablet detected \u2014 choose how to connect:"),Pc.createElement(VA,{mode:d,onChange:p})),"extension"===d?Pc.createElement(Pc.Fragment,null,Pc.createElement("div",{className:"empty-state-icon"},"\ud83d\udd0d"),Pc.createElement("h3",{className:"empty-state-title"},"No Extensions Detected"),Pc.createElement("p",{className:"empty-state-description",style:{fontSize:"13px"}},"No browser wallet extension was found.",Pc.createElement("br",null),Pc.createElement("br",null),"Some tablet browsers (Samsung Internet, Chrome) support extensions. Install one below, then refresh this page."),Pc.createElement(jA,{style:{margin:"12px 0 8px 2px",width:"100%"}},"Install extension"),Pc.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"6px",width:"100%"}},XA.filter(e=>e.installUrl).map(e=>Pc.createElement(WA,{key:e.id,config:e})))):Pc.createElement(Pc.Fragment,null,Pc.createElement(jA,{style:{margin:"0 0 8px 2px",width:"100%"}},"Open in wallet app"),h?Pc.createElement("div",{style:{display:"flex",gap:8,width:"100%",marginBottom:8,flexWrap:"wrap"}},Pc.createElement("button",{className:"btn btn-secondary",disabled:s,onClick:()=>{b()},style:{fontSize:"13px"}},"\ud83d\udccb Copy link")):null,Pc.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"6px",width:"100%"}},B.length>0?B.map(e=>{const t=e.title||e.name,n=e?.hasInAppBrowser||"inAppBrowser"===e?.mode;return Pc.createElement("div",{key:e.name,style:{display:"flex",flexDirection:"column",gap:6}},Pc.createElement("button",{className:"btn btn-secondary",disabled:s,onClick:()=>{try{if("magiceden"===f(e?.name))return void y(e);if(e.openUrl)return void(window.location.href=e.openUrl);if(e.connectUrl)return void(window.location.href=e.connectUrl);if("function"==typeof o)return void o(e.name);if(I&&"function"==typeof I.openMobileWallet)return void I.openMobileWallet(e.name,h);e.appUrl&&(window.location.href=e.appUrl)}catch{try{"function"==typeof o&&o(e.name)}catch{}}},style:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"14px"}},Pc.createElement("span",null,`Open ${t}`,n?Pc.createElement("span",{style:{fontSize:"10px",marginLeft:"6px",opacity:.5,fontWeight:400}},"\u2705 has browser"):null),Pc.createElement("span",{style:{opacity:.3,fontSize:"13px"}},"\u2197")),e.downloadUrl?Pc.createElement("div",{style:{fontSize:12,lineHeight:1.35,opacity:.65,padding:"0 2px"}},Pc.createElement("a",{href:e.downloadUrl,target:"_blank",rel:"noopener noreferrer",style:{opacity:.8,color:"rgba(168,85,247,0.85)",textDecoration:"none"}},"Get app ","\u2197")):null)}):Pc.createElement("div",{style:{fontSize:"12px",opacity:.6}},"No wallet app links available.",Pc.createElement("br",null),"Copy this URL and open it inside your wallet app browser.")),h?Pc.createElement("div",{style:{marginTop:"12px",width:"100%"}},Pc.createElement("div",{style:{fontSize:"12px",opacity:.5,marginBottom:"4px"}},"Or paste this URL in your wallet app:"),Pc.createElement("div",{style:{wordBreak:"break-all",fontSize:"11px",opacity:.4,userSelect:"all"}},h)):null)):A?null:Pc.createElement(Pc.Fragment,null,Pc.createElement("div",{className:"empty-state-icon"},"\ud83d\udd0d"),Pc.createElement("h3",{className:"empty-state-title"},"No Wallets Detected"),Pc.createElement("p",{className:"empty-state-description"},"No injected wallet provider was found.",Pc.createElement("br",null),Pc.createElement("br",null),Pc.createElement("strong",null,"Desktop:")," Install a Bitcoin wallet browser extension.",Pc.createElement("br",null),Pc.createElement("strong",null,"Mobile:")," Open this site inside your wallet app.")),A&&!C?Pc.createElement(Pc.Fragment,null,Pc.createElement(jA,{style:{margin:"12px 0 8px 2px",width:"100%"}},"Mobile wallets"),h?Pc.createElement("div",{style:{display:"flex",gap:8,width:"100%",marginBottom:8,flexWrap:"wrap"}},Pc.createElement("button",{className:"btn btn-secondary",disabled:s,onClick:()=>{b()},style:{fontSize:"13px"}},"Copy link")):null,Pc.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"6px",width:"100%"}},B.length>0?B.map(e=>{const t=e.title||e.name,n=e?.hasInAppBrowser||"inAppBrowser"===e?.mode;return Pc.createElement("div",{key:e.name,style:{display:"flex",flexDirection:"column",gap:6}},Pc.createElement("button",{className:"btn btn-secondary",disabled:s,onClick:()=>{try{if("magiceden"===f(e?.name))return void y(e);if(e.openUrl)return void(window.location.href=e.openUrl);if(e.connectUrl)return void(window.location.href=e.connectUrl);if("function"==typeof o)return void o(e.name);if(I&&"function"==typeof I.openMobileWallet)return void I.openMobileWallet(e.name,h);e.appUrl&&(window.location.href=e.appUrl)}catch{try{"function"==typeof o&&o(e.name)}catch{}}},style:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"14px"}},Pc.createElement("span",null,`Open ${t}`,n?Pc.createElement("span",{style:{fontSize:"10px",marginLeft:"6px",opacity:.5,fontWeight:400}},"\u2705 has browser"):null),Pc.createElement("span",{style:{opacity:.3,fontSize:"13px"}},"\u2197")),e.downloadUrl?Pc.createElement("div",{style:{fontSize:12,lineHeight:1.35,opacity:.65,padding:"0 2px"}},Pc.createElement("a",{href:e.downloadUrl,target:"_blank",rel:"noopener noreferrer",style:{opacity:.8,color:"rgba(168,85,247,0.85)",textDecoration:"none"}},"Get app ","\u2197")):null)}):Pc.createElement("div",{style:{fontSize:"12px",opacity:.6}},"Mobile deep links are not available in this build.",Pc.createElement("br",null),"Copy this URL and open it inside your wallet app browser."))):A||C?null:Pc.createElement(Pc.Fragment,null,Pc.createElement(jA,{style:{margin:"12px 0 8px 2px",width:"100%"}},"Install a wallet"),Pc.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"6px",width:"100%"}},XA.filter(e=>e.installUrl).map(e=>Pc.createElement(WA,{key:e.id,config:e})))),A||C||!h?null:Pc.createElement("div",{style:{marginTop:"16px",width:"100%"}},Pc.createElement("div",{style:{fontSize:"13px",opacity:.7,marginBottom:"8px"}},"Open this URL inside your wallet app:"),Pc.createElement("a",{href:h,style:{wordBreak:"break-all",fontSize:"11px",opacity:.5}},h))):Pc.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"4px"}},C&&Pc.createElement("div",{style:{marginBottom:"10px"}},Pc.createElement("div",{style:{fontSize:"11px",opacity:.45,marginBottom:"6px"}},"\ud83d\udcbb\u200a/\u200a\ud83d\udcf1 Tablet \u2014 switch connection method:"),Pc.createElement(VA,{mode:d,onChange:p})),(!C||"extension"===d)&&Pc.createElement(Pc.Fragment,null,v&&Pc.createElement(Pc.Fragment,null,Pc.createElement(jA,null,"Last used"),Pc.createElement(HA,{wallet:v,walletConfig:x(v),onClick:()=>O(v.name),disabled:s,isConnecting:l===v.name,isLastUsed:!0})),S.length>0&&Pc.createElement(Pc.Fragment,null,Pc.createElement(jA,{style:{marginTop:v?"14px":"0"}},"Detected"),S.map(e=>Pc.createElement(HA,{key:e.name,wallet:e,walletConfig:x(e),onClick:()=>O(e.name),disabled:s,isConnecting:l===e.name}))),(!A||C)&&N&&Pc.createElement(Pc.Fragment,null,c?Pc.createElement(Pc.Fragment,null,Pc.createElement(jA,{style:{marginTop:"14px"}},"Available"),E.map(e=>Pc.createElement(WA,{key:e.id,config:e}))):Pc.createElement("button",{onClick:()=>u(!0),style:{marginTop:"12px",background:"none",border:"none",color:"rgba(255,255,255,0.4)",fontSize:"12px",cursor:"pointer",padding:"6px 2px",textAlign:"left",fontWeight:500},onMouseEnter:e=>{e.currentTarget.style.color="rgba(255,255,255,0.65)"},onMouseLeave:e=>{e.currentTarget.style.color="rgba(255,255,255,0.4)"}},"\u25be"," Show ",E.length," more wallet",1!==E.length?"s":""))),C&&"app"===d&&Pc.createElement(Pc.Fragment,null,Pc.createElement(jA,null,"Open in wallet app"),h?Pc.createElement("div",{style:{display:"flex",gap:8,width:"100%",marginBottom:8,flexWrap:"wrap"}},Pc.createElement("button",{className:"btn btn-secondary",disabled:s,onClick:()=>{b()},style:{fontSize:"13px"}},"\ud83d\udccb Copy link")):null,Pc.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"6px",width:"100%"}},B.length>0?B.map(e=>{const t=e.title||e.name,n=e?.hasInAppBrowser||"inAppBrowser"===e?.mode;return Pc.createElement("div",{key:e.name,style:{display:"flex",flexDirection:"column",gap:6}},Pc.createElement("button",{className:"btn btn-secondary",disabled:s,onClick:()=>{try{if("magiceden"===f(e?.name))return void y(e);if(e.openUrl)return void(window.location.href=e.openUrl);if(e.connectUrl)return void(window.location.href=e.connectUrl);if("function"==typeof o)return void o(e.name);if(I&&"function"==typeof I.openMobileWallet)return void I.openMobileWallet(e.name,h);e.appUrl&&(window.location.href=e.appUrl)}catch{try{"function"==typeof o&&o(e.name)}catch{}}},style:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"14px"}},Pc.createElement("span",null,`Open ${t}`,n?Pc.createElement("span",{style:{fontSize:"10px",marginLeft:"6px",opacity:.5,fontWeight:400}},"\u2705 has browser"):null),Pc.createElement("span",{style:{opacity:.3,fontSize:"13px"}},"\u2197")),e.downloadUrl?Pc.createElement("div",{style:{fontSize:12,lineHeight:1.35,opacity:.65,padding:"0 2px"}},Pc.createElement("a",{href:e.downloadUrl,target:"_blank",rel:"noopener noreferrer",style:{opacity:.8,color:"rgba(168,85,247,0.85)",textDecoration:"none"}},"Get app ","\u2197")):null)}):Pc.createElement("div",{style:{fontSize:"12px",opacity:.6}},"No wallet app links available.",Pc.createElement("br",null),"Copy this URL and open it inside your wallet app browser.")),h?Pc.createElement("div",{style:{marginTop:"12px",width:"100%"}},Pc.createElement("div",{style:{fontSize:"12px",opacity:.5,marginBottom:"4px"}},"Or paste this URL in your wallet app:"),Pc.createElement("div",{style:{wordBreak:"break-all",fontSize:"11px",opacity:.4,userSelect:"all"}},h)):null)))))},XA=[{id:"bitmapwallet",name:"BitmapWallet",color:"cyan",installUrl:"https://chromewebstore.google.com/detail/bitmapwallet/cpmkedoipcpimgecpmgplbnienfhgfoi"},{id:"unisat",name:"UniSat",color:"orange",installUrl:"https://chromewebstore.google.com/detail/unisat-wallet/ppbibelpcjmhbdihakflkdcoccbgbkpo"},{id:"xverse",name:"Xverse",color:"blue",installUrl:"https://chromewebstore.google.com/detail/xverse-wallet/idnnbdplmphpflfnlkomgpfbpcgelopg"},{id:"leather",name:"Leather",color:"brown",installUrl:"https://chromewebstore.google.com/detail/leather/ldinpeekobnhjjdofggfgjlcehidnlci"},{id:"phantom",name:"Phantom",color:"purple",installUrl:"https://chromewebstore.google.com/detail/phantom/bfnaelmomeimhlpmgjnjophhpkkoljpa"},{id:"wizz",name:"Wizz",color:"green",installUrl:"https://chromewebstore.google.com/detail/wizz-wallet/ghlmndacnhlaekppcllcpcjjjomjkjpg"},{id:"oyl",name:"Oyl",color:"red",installUrl:"https://chromewebstore.google.com/detail/oyl-wallet/ilhmamhpjpgpmajkhnpcdiagbjfmmpnp"},{id:"magiceden",name:"Magic Eden",color:"violet",installUrl:"https://chromewebstore.google.com/detail/magic-eden/mkpegjkblkkefacfnmkajcjmabijhclg"}],KA="nexus_disclaimer_accepted",GA=()=>{const[e,t]=Bc.useState(()=>{try{return"1"===localStorage.getItem(KA)}catch{return!1}}),[r,i]=Bc.useState(!1),[a,o]=Bc.useState(!0),[s,l]=Bc.useState({isConnected:!1,walletType:null,address:null,balance:0}),[c,u]=Bc.useState(!1),[d,p]=Bc.useState(null),[f,m]=Bc.useState(!1),[g,h]=Bc.useState([]),b=XA,y=e=>(e||[]).slice().sort((e,t)=>{const n=b.findIndex(t=>t.name===e.name),r=b.findIndex(e=>e.name===t.name);return-1===n?1:-1===r?-1:n-r});Bc.useEffect(()=>{Ii(),async function(){if("undefined"==typeof window)return;const e=()=>{try{const e=window.bitmapWallet;return!!e&&("function"==typeof e.request||"function"==typeof e.requestAccounts||"function"==typeof e.connect||"function"==typeof e.getAccounts)}catch{return!1}},t=(e,t,n="operation")=>Promise.race([e,new Promise((e,r)=>setTimeout(()=>r(new Error(`${n} timed out after ${t}ms`)),t))]);try{await _t()}catch(tn){}const r=window.NexusBitcoinProxy;window.NexusBitcoinProxy={async isEnabled(){try{return e()?(await t(_t(),750,"initBitcoinApi"),Ot()||r&&await r.isEnabled()):r&&await r.isEnabled()}catch{return r&&await r.isEnabled()}},async getUrl(){try{if(await _t(),Ot())return"bitmap-wallet"}catch{}return r?await r.getUrl():null},async getFees(){try{if(!e())throw new Error("Bitmap Wallet bridge not present");if(await t(_t(),1500,"initBitcoinApi"),!Lt()){const e=await Rt();if(e)return e}}catch(tn){}if(r&&r.getFees)return await r.getFees();throw new Error("No network access method available - install Bitmap Wallet or enable Bitcoin Proxy")},async fetchUtxos(i,a="mainnet"){const o=Array.isArray(i)?i:[i];try{if(!e())throw new Error("Bitmap Wallet bridge not present");if(await t(_t(),1500,"initBitcoinApi"),!Lt()){const e=await Ft(o,a);if(e&&Array.isArray(e)&&e.length>0)return e}}catch(tn){}try{const{fetchCompleteWalletDataDirect:e}=await n(async()=>{const{fetchCompleteWalletDataDirect:e}=await Promise.resolve().then(()=>Ar);return{fetchCompleteWalletDataDirect:e}},__VITE_PRELOAD__),t=await e(o,a);if(t?.utxos&&Array.isArray(t.utxos)&&t.utxos.length>0)return t.utxos}catch(Pk){}if(r&&r.fetchUtxos)return await r.fetchUtxos(i,a);throw new Error("No network access method available - install Bitmap Wallet or enable Bitcoin Proxy")},async getUtxosWithFees(i,a="mainnet"){const o=Array.isArray(i)?i:[i];try{if(!e())throw new Error("Bitmap Wallet bridge not present");if(await t(_t(),1500,"initBitcoinApi"),!Lt()){const[e,t]=await Promise.all([Ft(o,a),Rt(a)]),n={};e&&Array.isArray(e)&&e.forEach(e=>{const t=`${e.txid}:${e.vout}`;n[t]=e.address});const r=t?{fast:t.fastestFee||25,medium:t.halfHourFee||15,slow:t.hourFee||5,isDefault:!1}:{fast:25,medium:15,slow:5,isDefault:!0};return{utxos:e||[],addresses:o,addressCount:o.length,addressUtxoMap:n,fees:r,providers:["ordinals.com","mempool.space"],method:"bitmap-wallet"}}}catch(tn){}try{const{fetchCompleteWalletDataDirect:e}=await n(async()=>{const{fetchCompleteWalletDataDirect:e}=await Promise.resolve().then(()=>Ar);return{fetchCompleteWalletDataDirect:e}},__VITE_PRELOAD__),t=await e(o,a);if(t?.utxos&&Array.isArray(t.utxos)&&t.utxos.length>0)return{utxos:t.utxos,addresses:t.addresses||o,addressCount:t.addressCount||o.length,addressUtxoMap:t.addressUtxoMap||{},fees:t.fees||{fast:25,medium:15,slow:5,isDefault:!0},providers:t.providers||{utxos:"direct",fees:"direct"},method:"direct"}}catch(Pk){}if(r&&r.getUtxosWithFees)return await r.getUtxosWithFees(i,a);throw new Error("No network access method available - install Bitmap Wallet or enable Bitcoin Proxy")},async broadcastTx(e,t="mainnet"){try{if(await _t(),!Lt())return await $t(e,t)}catch(tn){}if(r&&"function"==typeof r.broadcastTx)return await r.broadcastTx(e,t);throw new Error("No broadcast method available - install Bitmap Wallet or enable Bitcoin Proxy")},async broadcastPackage(e){try{if(await _t(),!Lt()){const t=[];for(const n of e)try{const e=await $t(n);t.push({success:!0,txid:e,error:null})}catch(tn){t.push({success:!1,txid:null,error:tn.message})}return{success:t.every(e=>e.success),results:t,method:"bitmap-wallet"}}}catch(tn){}if(r&&r.broadcastPackage)return await r.broadcastPackage(e);throw new Error("No broadcast method available - install Bitmap Wallet or enable Bitcoin Proxy")},async fetchInscriptions(e){try{if(await _t(),!Lt()){const t=await async function(e){if(Pt||await _t(),Lt())return[];const t=[];for(const n of e){const e=await Pt.proxyFetch(kt(`/wallet/${n}`),{method:"GET"});if(!e?.ok)continue;const r=await e.text();t.push(...Mt(r,n))}return t}([e]);return t}}catch(tn){}if(r&&r.fetchInscriptions)return await r.fetchInscriptions(e);throw new Error("No inscription fetch method available - install Bitmap Wallet or enable Bitcoin Proxy")}}}();const e=()=>{if(window.NexusWalletConnect){i(!0),l(window.NexusWalletConnect.getState());const e=[],t=()=>{const t=[250,750,1500,2500];for(const n of t)e.push(setTimeout(()=>{try{if(!window.NexusWalletConnect)return;const e=window.NexusWalletConnect.detectWallets();e&&e.length>0&&h(y(e))}catch(Pk){}},n))};try{const e=window.NexusWalletConnect.detectWallets();e&&0!==e.length||((()=>{try{return window.top===window.self}catch(e){return!1}})(),(()=>{try{return String(window.location&&window.location.href)}catch(e){return null}})(),(()=>{try{return String(window.location&&window.location.protocol)}catch(e){return null}})(),"undefined"!=typeof window&&window.isSecureContext,window.acquireVsCodeApi,(()=>{try{return String(navigator&&navigator.userAgent)}catch(e){return null}})(),window.unisat,window.okxwallet,(()=>{try{const e=window.XverseProviders?.BitcoinProvider||window.BitcoinProvider;return!(!e||"function"!=typeof e.request)}catch{return!1}})(),window.wizz,window.phantom,window.magicEden,void 0!==window.LeatherProvider||void 0!==window.HiroWalletProvider||Array.isArray(window.btc_providers),t()),h(y(e))}catch(Pk){h([]),t()}const n=window.NexusWalletConnect.subscribe(e=>{l(e)});return()=>{try{n&&n()}catch(t){}for(const n of e)try{clearTimeout(n)}catch(t){}}}i(!0),setTimeout(e,100)};return e()},[]),Bc.useEffect(()=>{},[f]),Bc.useEffect(()=>{const e=e=>{"Escape"===e.key&&f&&m(!1)};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[f]);const x=async e=>{try{if(!window.NexusWalletConnect?.openMobileWallet)throw new Error("Mobile wallet open is not available (openMobileWallet missing).");await window.NexusWalletConnect.openMobileWallet(e)}catch(_k){const n="undefined"!=typeof window&&window.location?.href?window.location.href:"";let r=!1;if(n)try{navigator?.clipboard?.writeText&&(await navigator.clipboard.writeText(n),r=!0)}catch{r=!1}if("magiceden"===String(e||"").toLowerCase().replace(/\s+/g,""))return UA({walletName:"Magic Eden",url:n,copied:r}),void(n&&!r&&window.prompt("Copy this URL:",n));alert(`Could not open ${e} automatically.\n\nOpen your mobile wallet app, then open its in-app browser / explorer and paste this URL:\n\n${n||"(URL unavailable)"}\n\n`+(r?"Copied to clipboard.":"If needed, press OK to copy.")),n&&!r&&window.prompt("Copy this URL:",n)}};return r?e?Pc.createElement("div",{className:"nexus-wallet-app "+(a?"dark-theme":"light-theme")},Pc.createElement("main",{className:"main-content",style:{padding:0}},Pc.createElement(RA,{walletState:s,onConnect:()=>{m(!0)},onDisconnect:async()=>{"undefined"==typeof window||"inscribing"!==window.__nexusGlobalLoading&&"wallet-connect"!==window.__nexusGlobalLoading||(window.__nexusGlobalLoading=null);try{await window.NexusWalletConnect.disconnect(),u(!1),p(null)}catch(tn){}finally{"undefined"==typeof window||"inscribing"!==window.__nexusGlobalLoading&&"wallet-connect"!==window.__nexusGlobalLoading||(window.__nexusGlobalLoading=null)}},onInscriptionCreated:e=>{}})),Pc.createElement(qA,{isOpen:f,onClose:()=>m(!1),installedWallets:g,wallets:b,onConnectWallet:async e=>{const t=String(e||"").toLowerCase().replace(/\s+/g,""),n=(()=>{try{const e="undefined"!=typeof window?window.NexusWalletConnect:null;if(e&&"function"==typeof e.isMobileDevice)return!!e.isMobileDevice()}catch{}try{const e=("undefined"!=typeof navigator&&navigator.userAgent||"").toLowerCase();return/android|iphone|ipad|ipod|iemobile|opera mini|mobile/.test(e)}catch{return!1}})(),r=(()=>{try{const e="undefined"!=typeof window?window.NexusWalletConnect:null;if(e&&"function"==typeof e.isTabletDevice)return!!e.isTabletDevice()}catch{}return!1})(),i=(()=>{try{const e=("undefined"!=typeof navigator&&navigator.userAgent||"").toLowerCase();return/iphone|ipad|ipod/.test(e)}catch{return!1}})(),a=(()=>{try{if("undefined"==typeof window)return!1;const e=window.XverseProviders?.BitcoinProvider||window.BitcoinProvider;return!(!e||"function"!=typeof e.request)}catch{return!1}})();if(n&&i&&"xverse"===t&&!a){m(!1);try{await x("Xverse")}finally{u(!1),p(null),"undefined"!=typeof window&&"wallet-connect"===window.__nexusGlobalLoading&&(window.__nexusGlobalLoading=null)}}else{m(!1),u(!0),p(e),"undefined"!=typeof window&&(window.__nexusGlobalLoading="wallet-connect");try{if(r&&"function"==typeof window.NexusWalletConnect.connectWithStrategy){const t=await window.NexusWalletConnect.connectWithStrategy(e,{strategy:"auto"});if(t?.redirected)return}else await window.NexusWalletConnect.connect(e);window.patchWalletInstance&&window.NexusWalletConnect.currentWallet&&window.patchWalletInstance(window.NexusWalletConnect.currentWallet),window.forceNormalizeAllProviders&&window.forceNormalizeAllProviders()}catch(_k){const a=String(_k?.message||_k||"Unknown error");n&&i&&"xverse"===t?alert(`Failed to connect to Xverse.\n\nOn iPhone/iPad, Xverse usually only injects its provider inside the Xverse app's in-app browser.\n\nTap \u201cOpen Xverse\u201d in the mobile wallet picker, or open this site inside Xverse \u2192 Browser.\n\nTechnical details:\n${a}`):alert(`Failed to connect to ${e}:\n\n${a}\n\nPlease check the console for more details.`),m(!0)}finally{u(!1),p(null),"undefined"!=typeof window&&"wallet-connect"===window.__nexusGlobalLoading&&(window.__nexusGlobalLoading=null)}}},onOpenMobileWallet:x,loading:c,connectingWallet:d}),(d||"undefined"!=typeof window&&window.__nexusGlobalLoading)&&Pc.createElement($A,{message:d?`Connecting to ${d}...`:"inscribing"===window.__nexusGlobalLoading?"Creating inscription(s)...":"Loading...",subtext:d?"Please approve the connection in your wallet":"inscribing"===window.__nexusGlobalLoading?"Please approve and wait for transaction building":"",icon:"inscribing"===window.__nexusGlobalLoading?"\ud83d\udcdd":"\u23f3"})):Pc.createElement("div",{className:"nexus-wallet-app "+(a?"dark-theme":"light-theme")},Pc.createElement("div",{className:"fixed inset-0 z-[99999] flex items-center justify-center bg-black/95 backdrop-blur-md p-4"},Pc.createElement("div",{className:"w-full max-w-md bg-neutral-950 border border-neutral-800 rounded-2xl shadow-2xl overflow-hidden"},Pc.createElement("div",{className:"px-5 pt-5 pb-3 border-b border-neutral-800/60"},Pc.createElement("div",{className:"flex items-center gap-2 mb-1"},Pc.createElement("span",{className:"text-xl"},"\u26a0\ufe0f"),Pc.createElement("h2",{className:"text-base font-bold text-white"},"Disclaimer")),Pc.createElement("p",{className:"text-[11px] text-neutral-500"},"Please read carefully before proceeding")),Pc.createElement("div",{className:"px-5 py-4 flex flex-col gap-3 max-h-[60vh] overflow-y-auto text-[13px] leading-relaxed text-neutral-300"},Pc.createElement("p",null,"This app is provided ",Pc.createElement("strong",{className:"text-amber-300"},"as-is")," and is currently in active development. Use it at your own risk."),Pc.createElement("p",null,"Always verify that all ",Pc.createElement("strong",{className:"text-neutral-100"},"inputs and outputs")," look correct in your wallet extension before approving or signing any transaction."),Pc.createElement("p",null,"The developers are not responsible for any loss of funds, incorrect transactions, or any other damages arising from the use of this application."),Pc.createElement("p",{className:"text-[11px] text-neutral-500"},'By clicking "I Understand & Agree" below you acknowledge that you have read, understood, and accept these terms.')),Pc.createElement("div",{className:"px-5 pb-5 pt-2"},Pc.createElement("button",{onClick:()=>{try{localStorage.setItem(KA,"1")}catch{}t(!0)},className:"w-full px-4 py-3 text-sm font-semibold rounded-lg bg-amber-500 hover:bg-amber-400 text-neutral-950 transition-colors shadow-[0_0_0_1px_rgba(245,158,11,0.35),0_10px_30px_rgba(245,158,11,0.12)] active:translate-y-[1px]"},"I Understand & Agree"))))):Pc.createElement("div",{className:"nexus-wallet-app "+(a?"dark-theme":"light-theme")},Pc.createElement("div",{className:"loading-state",style:{minHeight:"100vh"}},Pc.createElement("div",{className:"spinner"})))},YA=async()=>{try{await mi()}catch(_k){}if(void 0!==window.__NEXUS_LOADING_DEPS__){if(!0===window.__NEXUS_LOADING_DEPS__)return new Promise(e=>{window.addEventListener("nexus-deps-ready",()=>{YA().then(e)},{once:!0})});window.__NEXUS_DEPS_ERROR__}EE.createRoot(document.getElementById("root")).render(Pc.createElement(GA,null));try{const e=document.getElementById("app-loading");e&&e.classList.remove("active")}catch(e){}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",YA):YA();const JA=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));window.NexusWalletConnect=at,await new Promise(e=>{window.__NEXUS_CRYPTO_READY__?e():window.addEventListener("nexus-crypto-ready",()=>e(),{once:!0})});try{const e=window.bitmapWallet;if(e&&"function"==typeof e.request&&"function"==typeof e.connect&&!e.__nexusConnectShimInstalled){const t=e.connect.bind(e);e.__nexusConnectShimInstalled=!0,e.__nexusOriginalConnect=t,e.connect=async(n={})=>{try{let t;if("function"==typeof e.requestAccounts)t=await e.requestAccounts();else{const n=["requestAccounts","getAccounts","accounts"];let r;for(const i of n)try{const n=await e.request({method:i,params:[]});if(t=Array.isArray(n)?n:n?.accounts||(n?[n]:[]),t&&(!Array.isArray(t)||t.length))break}catch(Pk){r=Pk}if(!t)throw r||new Error("BitmapWallet: no accounts returned")}const n=Array.isArray(t)?t[0]:t;return{accounts:Array.isArray(t)?t:[t],address:n,connected:!0}}catch(Pk){return await t(n)}}}}catch(Pk){}window.__NEXUS_LOADING_DEPS__=!1,window.__NEXUS_DEPS_READY__=!0,window.dispatchEvent(new CustomEvent("nexus-deps-ready"));try{const e=await n(()=>Promise.resolve().then(()=>Gl),__VITE_PRELOAD__);window.NexusSDK=Object.freeze({indexCollectionListings:e.indexCollectionListings,indexAllListings:e.indexAllListings,getAvailableCollections:e.getAvailableCollections,indexOODLListings:e.indexOODLListings,getCachedListings:e.getCachedListings,clearListingsCache:e.clearListingsCache,OODL_CONFIG:Object.freeze({...e.OODL_CONFIG}),OODL_COLLECTION_FEES:Object.freeze(Object.fromEntries(Object.entries(e.OODL_COLLECTION_FEES||{}).map(([e,t])=>[e,Object.freeze({...t})]))),getOODLFeeOutput:e.getOODLFeeOutput,getOODLCollectionFeeOutput:e.getOODLCollectionFeeOutput,getOODLIndexingAddresses:e.getOODLIndexingAddresses,isValidOODLFee:e.isValidOODLFee,getOODLCollectionKeyFromFee:e.getOODLCollectionKeyFromFee,setDynamicOODLCollections:e.setDynamicOODLCollections,getDynamicOODLCollections:e.getDynamicOODLCollections,createAndBroadcastBuyFromRevealTx:e.createAndBroadcastBuyFromRevealTx,createAndBroadcastBuyFromInscriptionId:e.createAndBroadcastBuyFromInscriptionId,createAndBroadcastBuyFromSellerOfferPsbt:e.createAndBroadcastBuyFromSellerOfferPsbt,estimateBuyNeedFromRevealTx:e.estimateBuyNeedFromRevealTx,estimateBuyNeedFromInscriptionId:e.estimateBuyNeedFromInscriptionId,estimateBuyNeedFromSellerOfferPsbt:e.estimateBuyNeedFromSellerOfferPsbt,createAndBroadcast3TxSaleListingFlow:e.createAndBroadcast3TxSaleListingFlow,createAndBroadcastMultiAsset3TxSaleListingFlow:e.createAndBroadcastMultiAsset3TxSaleListingFlow,createSignedOpenStoreSellerOfferPsbt:e.createSignedOpenStoreSellerOfferPsbt,createSignedOpenStoreSellerOfferPsbtsBatch:e.createSignedOpenStoreSellerOfferPsbtsBatch,getSellerOfferPsbtBase64FromRevealTxid:e.getSellerOfferPsbtBase64FromRevealTxid,validateOodinalsSaleListing:e.validateOodinalsSaleListing,createMarketplaceClient:e.createMarketplaceClient,createMarketplaceClientFromInscription:e.createMarketplaceClientFromInscription,encodeOodinalsSaleMarker:e.encodeOodinalsSaleMarker,decodeOodinalsSaleMarker:e.decodeOodinalsSaleMarker,getInscriptionDetails:e.getInscriptionDetails,getInscriptionOutpoint:e.getInscriptionOutpoint,loadCollectionsRegistry:e.loadCollectionsRegistry,matchCollectionForInscription:e.matchCollectionForInscription,getCollectionsRegistryInscriptionId:e.getCollectionsRegistryInscriptionId,setCollectionsRegistryInscriptionIdOverride:e.setCollectionsRegistryInscriptionIdOverride,indexCollectionListings:e.indexCollectionListings,indexAllListings:e.indexAllListings,getAvailableCollections:e.getAvailableCollections,sanitizePsbtForSharing:e.sanitizePsbtForSharing}),window.dispatchEvent(new CustomEvent("nexus-sdk-ready"))}catch(Pk){}await n(()=>Promise.resolve().then(()=>JA),__VITE_PRELOAD__);const QA="nexus_pending_utxos";function ZA(e){if(!e)return[];try{const t=sessionStorage.getItem(QA);if(!t)return[];const n=JSON.parse(t),r=n[e]||[],i=Date.now(),a=r.filter(e=>i-e.usedAt<864e5);return a.length!==r.length&&(n[e]=a,sessionStorage.setItem(QA,JSON.stringify(n))),a}catch(tn){return[]}}const ek=Object.freeze(Object.defineProperty({__proto__:null,filterPendingUtxos:function(e,t){if(!e||!Array.isArray(e)||!t)return e;const n=ZA(t);if(0===n.length)return e;const r=e.filter(e=>!n.some(t=>t.txid===e.txid&&t.vout===e.vout));return e.length,r.length,r},getPendingUtxoCount:function(e){return ZA(e).length},getPendingUtxos:ZA},Symbol.toStringTag,{value:"Module"}));function tk(e){if(!e||"string"!=typeof e)return null;const t=e.match(/^([a-f0-9]{64})i(\d+)$/);return t?{txid:t[1],vout:parseInt(t[2]),inscriptionId:e}:null}const nk=Object.freeze(Object.defineProperty({__proto__:null,parseInscriptionId:tk,validateOrdinalsUtxoData:function(e,t){const n=[],r={...e};if(!e)return{isValid:!1,warnings:["No ordinals data"],correctedData:null};if(!t)return{isValid:!1,warnings:["No UTXO data to validate against"],correctedData:r};if(e.inscriptions&&Array.isArray(e.inscriptions)){const i=[];for(const r of e.inscriptions){const e=tk(r);e?(i.push(r),e.txid,t.txid):n.push(`Invalid inscription ID format: ${r}`)}r.inscriptions=i}return{isValid:!0,warnings:n,correctedData:r}}},Symbol.toStringTag,{value:"Module"}));function rk(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return t.toString(36)}const ik=Object.freeze(Object.defineProperty({__proto__:null,encodeAddresses:function(e,t){if(!e||0===e.length)throw new Error("No addresses to encode");if(!t||"string"!=typeof t)throw new Error("Platform address required for encoding");const n={addrs:e,ts:Date.now(),check:rk(e.join("")+t)};return function(e,t){const n=[];for(let r=0;r<e.length;r++)n.push(e.charCodeAt(r)^t.charCodeAt(r%t.length));return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}(JSON.stringify(n),t)}},Symbol.toStringTag,{value:"Module"})),ak=Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"}));function ok(e){if(!e||e.length<32||e.length>36)return null;const t=e.slice(0,32),n=function(e){const t=e instanceof Uint8Array?e:new Uint8Array(e);let n="";for(let r=0;r<t.length;r++)n+=t[r].toString(16).padStart(2,"0");return n}(new Uint8Array(t).reverse()),r=e.slice(32);let i=0;if(r.length>0)for(let a=0;a<Math.min(r.length,4);a++)i|=r[a]<<8*a;return`${n}i${i}`}function sk(e,t=0){if(t>=e.length)throw new Error("CBOR: unexpected end of data");const n=e[t],r=n>>5,i=31&n,a=t=>{if(i<24)return{value:i,nextOffset:t+1};if(24===i)return{value:e[t+1],nextOffset:t+2};if(25===i)return{value:e[t+1]<<8|e[t+2],nextOffset:t+3};if(26===i)return{value:(e[t+1]<<24|e[t+2]<<16|e[t+3]<<8|e[t+4])>>>0,nextOffset:t+5};throw new Error(`CBOR: unsupported additional info ${i}`)};if(0===r){const{value:e,nextOffset:n}=a(t);return{value:e,nextOffset:n}}if(1===r){const{value:e,nextOffset:n}=a(t);return{value:-1-e,nextOffset:n}}if(2===r){const{value:n,nextOffset:r}=a(t),i=r+n;if(i>e.length)throw new Error("CBOR: byte string overflows");return{value:e.slice(r,i),nextOffset:i}}if(3===r){const{value:n,nextOffset:r}=a(t),i=r+n;if(i>e.length)throw new Error("CBOR: text string overflows");const o=e.slice(r,i);return{value:"undefined"!=typeof TextDecoder?(new TextDecoder).decode(o):String.fromCharCode(...o),nextOffset:i}}if(4===r){const{value:n,nextOffset:r}=a(t),i=[];let o=r;for(let t=0;t<n;t++){const t=sk(e,o);i.push(t.value),o=t.nextOffset}return{value:i,nextOffset:o}}if(5===r){const{value:n,nextOffset:r}=a(t),i=new Map;let o=r;for(let t=0;t<n;t++){const t=sk(e,o),n=sk(e,t.nextOffset);i.set(t.value,n.value),o=n.nextOffset}return{value:i,nextOffset:o}}if(7===r){if(20===i)return{value:!1,nextOffset:t+1};if(21===i)return{value:!0,nextOffset:t+1};if(22===i)return{value:null,nextOffset:t+1};if(23===i)return{value:void 0,nextOffset:t+1};const{value:e,nextOffset:n}=a(t);return{value:e,nextOffset:n}}throw new Error(`CBOR: unsupported major type ${r} at offset ${t}`)}function lk(e,t){if(t>=e.length)return null;const n=e[t];if(0===n)return{data:new Uint8Array(0),nextOffset:t+1};if(n>=1&&n<=75){const r=t+1+n;return r>e.length?null:{data:e.slice(t+1,r),nextOffset:r}}if(76===n){if(t+2>e.length)return null;const n=t+2+e[t+1];return n>e.length?null:{data:e.slice(t+2,n),nextOffset:n}}if(77===n){if(t+3>e.length)return null;const n=t+3+(e[t+1]|e[t+2]<<8);return n>e.length?null:{data:e.slice(t+3,n),nextOffset:n}}if(78===n){if(t+5>e.length)return null;const n=t+5+(e[t+1]|e[t+2]<<8|e[t+3]<<16|e[t+4]<<24);return n>e.length?null:{data:e.slice(t+5,n),nextOffset:n}}return n>=81&&n<=96?{data:new Uint8Array([n-80]),nextOffset:t+1}:null}function ck(e){return 0===e.length?0:1===e.length?e[0]:null}function uk(e){const t=e instanceof Uint8Array?e:new Uint8Array(e);let n=-1;for(let s=0;s<t.length-5;s++)if(0===t[s]&&99===t[s+1]&&3===t[s+2]&&111===t[s+3]&&114===t[s+4]&&100===t[s+5]){n=s+6;break}if(n<0)return null;const r=new Map;let i=n,a=-1;for(;i<t.length&&104!==t[i];){const e=lk(t,i);if(!e){i++;continue}const n=ck(e.data);if(i=e.nextOffset,0===n){a=i;break}if(null===n)continue;if(i>=t.length||104===t[i])break;const o=lk(t,i);o?(i=o.nextOffset,r.has(n)||r.set(n,[]),r.get(n).push(o.data)):i++}let o=null;if(a>=0){const e=[];let n=a;for(;n<t.length&&104!==t[n];){const r=lk(t,n);r?(e.push(r.data),n=r.nextOffset):n++}if(e.length>0){const t=e.reduce((e,t)=>e+t.length,0);o=new Uint8Array(t);let n=0;for(const r of e)o.set(r,n),n+=r.length}}return{tags:r,body:o}}function dk(e){const t=[],n=e=>{if(e instanceof Uint8Array&&e.length>=32&&e.length<=36)return ok(e);if(e instanceof Map){const t=e.get(0);if(t instanceof Uint8Array&&t.length>=32&&t.length<=36)return ok(t)}if(e&&"object"==typeof e&&!(e instanceof Uint8Array)&&!(e instanceof Map)&&!Array.isArray(e)){const t=e[0];if(t instanceof Uint8Array&&t.length>=32&&t.length<=36)return ok(t)}return null};if(e instanceof Map){const r=e.get(0);if(Array.isArray(r))for(const e of r){const r=n(e);r&&t.push(r)}return t}if(Array.isArray(e)){for(const r of e){const e=n(r);e&&t.push(e)}return t}return t}function pk(e){const t=[],n=[161,0,88,32];let r=0;for(;r<e.length;){let i=!0;for(let t=0;t<n.length;t++)if(e[r+t]!==n[t]){i=!1;break}if(i){const i=r+n.length,a=i+32;if(a<=e.length){const n=ok(e.slice(i,a));n&&t.push(n)}r=i+1}else r++}return t}async function fk(e,t={}){const{network:r=null,bruteForce:i=!0}=t,a=String(e||"").trim();if(!a)return[];let o=a;if(o.includes("i")&&(o=function(e){const t=String(e||"").trim().match(/^([a-f0-9]{64})i\d+$/i);return t?t[1].toLowerCase():null}(a)),!o||!/^[a-f0-9]{64}$/i.test(o))throw new Error(`getGalleryInscriptionIds: invalid inscription ID or txid: ${a}`);o=o.toLowerCase();const[{loadBitcoinLibFromInscription:s},{fetchTxHexViaProxy:l}]=await Promise.all([n(()=>Promise.resolve().then(()=>An),__VITE_PRELOAD__),n(()=>Promise.resolve().then(()=>Ei),__VITE_PRELOAD__)]),c=await s(),u=r||"undefined"!=typeof window&&window.__NEXUS_NETWORK__||"mainnet",d=await l(o,u);if(!d||"string"!=typeof d||d.length<100)throw new Error(`getGalleryInscriptionIds: failed to fetch tx hex for ${o}`);const p=c.Transaction.fromHex(d),f=Array.isArray(p?.ins)?p.ins:[];if(0===f.length)throw new Error("getGalleryInscriptionIds: tx has no inputs");for(let n=0;n<f.length;n++){const e=f[n]?.witness;if(!Array.isArray(e)||e.length<2)continue;const t=e[e.length-2];if(!t||0===t.length)continue;const r=uk(t instanceof Uint8Array?t:new Uint8Array(t.buffer||t));if(!r)continue;const a=r.tags.get(17);if(!a||0===a.length)continue;const o=a.reduce((e,t)=>e+t.length,0),s=new Uint8Array(o);let l=0;for(const n of a)s.set(n,l),l+=n.length;let c=[];try{const{value:e}=sk(s,0);c=dk(e)}catch(Pk){}if(0===c.length&&i&&(c=pk(s)),c.length>0)return c}return[]}const mk=Object.freeze(Object.defineProperty({__proto__:null,decodeCBOR:sk,extractGalleryIdsBruteForce:pk,extractGalleryIdsFromCbor:dk,getGalleryInscriptionIds:fk,hasGalleryProperties:async function(e,t={}){try{return(await fk(e,t)).length>0}catch{return!1}},inscriptionIdFromBytes:ok,parseOrdinalsEnvelope:uk},Symbol.toStringTag,{value:"Module"})),gk=Object.freeze(Object.defineProperty({__proto__:null,clearAllCachesForWallet:async function(e){const t=Array.isArray(e)?e:[e],{clearCachedCompleteData:r,bumpCompleteDataCache:i}=await n(async()=>{const{clearCachedCompleteData:e,bumpCompleteDataCache:t}=await Promise.resolve().then(()=>Fr);return{clearCachedCompleteData:e,bumpCompleteDataCache:t}},__VITE_PRELOAD__);r(t.sort().join(","));const{clearCachedInscriptions:a,bumpInscriptionCache:o}=await n(async()=>{const{clearCachedInscriptions:e,bumpInscriptionCache:t}=await Promise.resolve().then(()=>kk);return{clearCachedInscriptions:e,bumpInscriptionCache:t}},__VITE_PRELOAD__);for(const n of t)a(n);const{bumpSessionCacheNamespace:s}=await n(async()=>{const{bumpSessionCacheNamespace:e}=await Promise.resolve().then(()=>ri);return{bumpSessionCacheNamespace:e}},__VITE_PRELOAD__);s("manual-refresh")}},Symbol.toStringTag,{value:"Module"})),hk=(globalThis.__NEXUS_DEBUG_WALLET__,(...e)=>{}),bk=(...e)=>{};async function yk(e){try{const t=kt(`/r/sat/${e}`),n=await fetch(t);return n.ok?(await n.json()).ids||[]:(n.status,[])}catch(Pk){return Pk.message,[]}}function xk(e){if(!e)return e;const t=e.inscriptionId||e.id||e.rawId,n=Xt(t);return{id:n,rawId:t,number:e.inscriptionNumber||e.number||null,contentType:e.contentType||e.content_type||null,satpoint:e.satpoint||e.output||null,value:e.value||e.output_value||null,inscriptionValue:"number"==typeof e.inscriptionValue?e.inscriptionValue:null,address:e.address||null,sat:e.sat||null,label:e.label||(null!=e.number?`#${e.inscriptionNumber||e.number}${e.contentType?" - "+(e.contentType||e.content_type):""}`:`${n.substring(0,12)}...${e.contentType?" - "+e.contentType:""}`),utxo:e.utxo||null,fromUtxo:!!e.fromUtxo,fromSatScan:!!e.fromSatScan,source:e.source||"wallet",sameSatIds:e.sameSatIds?[...e.sameSatIds].reverse():null}}const wk=Object.freeze(Object.defineProperty({__proto__:null,extractInscriptionsFromUtxos:async function(e){if(!e)return[];const t=Array.isArray(e)?e:e.unsafe||[];if(0===t.length)return[];const n=[];t.length;const r=new Map,i=new Set;for(const o of t){const e=o.assetCheck?.details?.utxoData||{},t=Array.isArray(e.sat_ranges)?e.sat_ranges:null,n=o.inscriptionIds||e.inscriptions||[],r=n.length>1,a=n.some(e=>{const t=e.match(/i(\d+)$/);return t&&parseInt(t[1])>0});(r||a)&&t&&t.length>0&&t.forEach(e=>{Array.isArray(e)&&"number"==typeof e[0]&&i.add(e[0])})}if(i.size>0){i.size;for(const e of i)try{const t=await yk(e);t&&t.length>0&&r.set(e,new Set(t))}catch(Pk){bk(Pk.message)}r.size}const a=new Map;r.forEach((e,t)=>{e.forEach(e=>a.set(e,t))});for(const o of t){const{txid:e,vout:t,address:i}=o,s=o.assetCheck?.details?.utxoData||{},l=Array.isArray(s.sat_ranges)?s.sat_ranges:null,c=o.inscriptionIds||s.inscriptions||[],u=e=>{if(!l||0===l.length)return null;const t=l[0]?.[0];if("number"!=typeof t)return null;const n=l.map(e=>Array.isArray(e)&&"number"==typeof e[0]?e[0]-t:null);return"number"==typeof e&&n.length!==e?null:n};if(o.assetCheck?.details?.inscriptionData){const s=o.assetCheck.details.inscriptionData.inscriptions||[],d=u(s.length),p=[];if(l&&l.length===s.length)for(const[e,t]of l)p.push(t-e);else if(1===s.length)p.push(o.value);else{const e=Math.floor(o.value/s.length);for(let t=0;t<s.length;t++)p.push(e)}for(let u=0;u<s.length;u++){const f=s[u],m=f.inscriptionId||`${e}i${t}`,g=Array.isArray(d)?d[u]:null,h=p[u]||o.value,b=a.get(m)||l?.[0]?.[0],y=b?r.get(b):null,x=y?Array.from(y).reverse():null;n.push(xk({inscriptionId:m,contentType:f.contentType,satpoint:`${e}:${t}${null!=g?":"+g:""}`,value:o.value,inscriptionValue:h,address:i,label:`${m.substring(0,12)}... - ${f.contentType}`,utxo:{txid:e,vout:t,value:o.value,inscriptionValue:h,address:i,offset:g,inscriptionIds:c},sat:b,sameSatIds:x,fromUtxo:!0,source:"utxo"}))}}else if(c.length>0){const s=u(c.length);hk(c.length);const d=[];if(l&&l.length===c.length){for(const[e,t]of l)d.push(t-e);hk()}else if(1===c.length)d.push(o.value);else{const e=Math.floor(o.value/c.length);for(let t=0;t<c.length;t++)d.push(e);hk(o.value)}for(let u=0;u<c.length;u++){const p=c[u],f=Array.isArray(s)?s[u]:null,m=d[u]||o.value,g=a.get(p)||l?.[0]?.[0],h=g?r.get(g):null,b=h?Array.from(h).reverse():null;hk(c.length),b&&b.length>1&&hk(b.length,b.map(e=>e.substring(0,16)+"...")),n.push(xk({inscriptionId:p,contentType:"application/octet-stream",satpoint:`${e}:${t}${null!=f?":"+f:""}`,value:o.value,inscriptionValue:m,address:i,label:p.substring(0,12)+"...",utxo:{txid:e,vout:t,value:o.value,inscriptionValue:m,address:i,offset:f,inscriptionIds:c,isSameSat:b&&b.length>1},sat:g,sameSatIds:b,fromUtxo:!0,source:"utxo"}))}}}return n.length,n.length,n.filter(e=>e.sameSatIds&&e.sameSatIds.length>1).length,r.size,n}},Symbol.toStringTag,{value:"Module"})),vk=3e5;let Sk="INS-v1";const Ek=(()=>{try{return window.sessionStorage}catch{return null}})(),Nk=new Map;function Ik(e){return`${Sk}:${e}`}function Ak(e,t){e&&Array.isArray(t)&&function(e,t){const n=Ik(e),r=Array.isArray(t)?{_cacheTimestamp:Date.now(),_data:t}:{...t,_cacheTimestamp:Date.now()};if(Nk.set(n,r),Ek)try{Ek.setItem(n,JSON.stringify(r))}catch(Pk){}}(`inscriptions:${e}`,t)}const kk=Object.freeze(Object.defineProperty({__proto__:null,bumpInscriptionCache:function(e=""){Sk=`INS-v1:${Date.now()}${e?":"+e:""}`},clearCachedInscriptions:function(e){e&&function(e){const t=Ik(e);if(Nk.delete(t),Ek)try{Ek.removeItem(t)}catch{}}(`inscriptions:${e}`)},getCachedInscriptions:function(e){if(!e)return null;const t=function(e){const t=Ik(e);if(Nk.has(t)){const e=Nk.get(t);if(e._cacheTimestamp&&Date.now()-e._cacheTimestamp>vk){if(Nk.delete(t),Ek)try{Ek.removeItem(t)}catch{}return null}return void 0!==e._data?e._data:e}if(Ek){const e=Ek.getItem(t);if(e)try{const n=JSON.parse(e);return n._cacheTimestamp&&Date.now()-n._cacheTimestamp>vk?(Ek.removeItem(t),null):(Nk.set(t,n),void 0!==n._data?n._data:n)}catch{}}return null}(`inscriptions:${e}`);if(!t)return null;let n=!1;const r=Array.isArray(t)?t.map(e=>{try{if(!e||!e.utxo)return e;const t=e.utxo.totalUtxoValue,r=e.utxo.value;if("number"==typeof t&&Number.isFinite(t)&&t>0&&"number"==typeof r&&Number.isFinite(r)&&r>0&&t!==r){n=!0;const i={...e,utxo:{...e.utxo}};return"number"!=typeof i.utxo.inscriptionValue&&(i.utxo.inscriptionValue=r),"number"!=typeof i.inscriptionValue&&(i.inscriptionValue="number"==typeof e.value?e.value:r),i.utxo.value=t,i.value=t,i}return e}catch{return e}}):t;if(n)try{Ak(e,r)}catch{}return r},setCachedInscriptions:Ak},Symbol.toStringTag,{value:"Module"}));function Tk(e){return(null==e?"":String(e)).trim()}function Ck(e,{indexingAddress:t,minFeeSats:n}){const r=Tk(t),i=Number(n);if(!r||!Number.isFinite(i)||i<=0)return!1;const a=Array.isArray(e?.vout)?e.vout:[];for(const o of a){const e=Tk(o?.scriptpubkey_address),t=Number(o?.value);if(e&&e===r&&Number.isFinite(t)&&t>=i)return!0}return!1}const Bk=Object.freeze(Object.defineProperty({__proto__:null,discoverParcelManifestRegistrations:async function({limit:e=50}={}){const t=hs?.parcel_manifest,n=Tk(t?.address),r=Number(t?.minFeeSats??t?.feeSats??600);if(!n)return[];const i=await async function(e){const t=Tk(e);if(!t)return[];try{const e=Tt(`/api/address/${t}/txs`),n=await fetch(e);if(!n.ok)return[];const r=await n.json();return Array.isArray(r)?r:[]}catch{return[]}}(n),a=[];for(const s of i){const e=Tk(s?.txid).toLowerCase();if(!/^[0-9a-f]{64}$/.test(e))continue;if(!Ck(s,{indexingAddress:n,minFeeSats:r}))continue;const t=`${e}i0`,i=s?.status?.block_time?1e3*Number(s.status.block_time):null;a.push({txid:e,blockTimeMs:Number.isFinite(i)?Math.floor(i):null,bitmapNumber:null,manifestoInscriptionId:t,all:!0})}a.sort((e,t)=>{const n=Number(e?.blockTimeMs||0),r=Number(t?.blockTimeMs||0);return r!==n?r-n:String(t?.txid||"").localeCompare(String(e?.txid||""))});const o=Number(e);return Number.isFinite(o)&&o>0?a.slice(0,Math.floor(o)):a}},Symbol.toStringTag,{value:"Module"}));

</script>
  <style>
*,:before,:after{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }*,:before,:after{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}:before,:after{--tw-content: ""}html,:host{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;-o-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,samp,pre{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dl,dd,h1,h2,h3,h4,h5,h6,hr,figure,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}ol,ul,menu{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{opacity:1;color:#9ca3af}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}button,[role=button]{cursor:pointer}:disabled{cursor:default}img,svg,video,canvas,audio,iframe,embed,object{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.\!container{width:100%!important}.container{width:100%}@media (min-width: 640px){.\!container{max-width:640px!important}.container{max-width:640px}}@media (min-width: 768px){.\!container{max-width:768px!important}.container{max-width:768px}}@media (min-width: 1024px){.\!container{max-width:1024px!important}.container{max-width:1024px}}@media (min-width: 1280px){.\!container{max-width:1280px!important}.container{max-width:1280px}}@media (min-width: 1536px){.\!container{max-width:1536px!important}.container{max-width:1536px}}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}.pointer-events-none{pointer-events:none}.pointer-events-auto{pointer-events:auto}.\!visible{visibility:visible!important}.visible{visibility:visible}.collapse{visibility:collapse}.static{position:static}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.sticky{position:sticky}.inset-0{inset:0}.bottom-0{bottom:0}.bottom-1\.5{bottom:.375rem}.bottom-2{bottom:.5rem}.bottom-20{bottom:5rem}.bottom-4{bottom:1rem}.left-0{left:0}.left-1\.5{left:.375rem}.left-1\/2{left:50%}.left-2{left:.5rem}.left-2\.5{left:.625rem}.left-\[9px\]{left:9px}.right-0{right:0}.right-1{right:.25rem}.right-1\.5{right:.375rem}.right-2{right:.5rem}.right-3{right:.75rem}.right-4{right:1rem}.top-0{top:0}.top-1\.5{top:.375rem}.top-1\/2{top:50%}.top-14{top:3.5rem}.top-16{top:4rem}.top-2{top:.5rem}.top-3{top:.75rem}.top-5{top:1.25rem}.isolate{isolation:isolate}.z-0{z-index:0}.z-10{z-index:10}.z-20{z-index:20}.z-50{z-index:50}.z-\[10000\]{z-index:10000}.z-\[100\]{z-index:100}.z-\[200\]{z-index:200}.z-\[20\]{z-index:20}.z-\[40\]{z-index:40}.z-\[50\]{z-index:50}.z-\[9200\]{z-index:9200}.z-\[9300\]{z-index:9300}.z-\[9500\]{z-index:9500}.z-\[9800\]{z-index:9800}.z-\[99999\]{z-index:99999}.z-\[9999\]{z-index:9999}.m-3{margin:.75rem}.-mx-0{margin-left:-0px;margin-right:-0px}.mx-0{margin-left:0;margin-right:0}.mx-0\.5{margin-left:.125rem;margin-right:.125rem}.mx-4{margin-left:1rem;margin-right:1rem}.mx-auto{margin-left:auto;margin-right:auto}.my-1{margin-top:.25rem;margin-bottom:.25rem}.-mt-0\.5{margin-top:-.125rem}.-mt-1{margin-top:-.25rem}.mb-0\.5{margin-bottom:.125rem}.mb-1{margin-bottom:.25rem}.mb-1\.5{margin-bottom:.375rem}.mb-2{margin-bottom:.5rem}.mb-3{margin-bottom:.75rem}.mb-4{margin-bottom:1rem}.ml-1{margin-left:.25rem}.ml-2{margin-left:.5rem}.ml-5{margin-left:1.25rem}.ml-auto{margin-left:auto}.mr-3{margin-right:.75rem}.mt-0\.5{margin-top:.125rem}.mt-1{margin-top:.25rem}.mt-1\.5{margin-top:.375rem}.mt-2{margin-top:.5rem}.mt-3{margin-top:.75rem}.mt-4{margin-top:1rem}.mt-\[3px\]{margin-top:3px}.line-clamp-2{overflow:hidden;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2}.block{display:block}.inline-block{display:inline-block}.inline{display:inline}.inline-flex{display:inline-flex}.table{display:table}.grid{display:grid}.contents{display:contents}.hidden{display:none}.aspect-square{aspect-ratio:1 / 1}.h-0\.5{height:.125rem}.h-1\.5{height:.375rem}.h-10{height:2.5rem}.h-14{height:3.5rem}.h-16{height:4rem}.h-2{height:.5rem}.h-2\.5{height:.625rem}.h-2\/3{height:66.666667%}.h-20{height:5rem}.h-3{height:.75rem}.h-3\.5{height:.875rem}.h-4{height:1rem}.h-40{height:10rem}.h-5{height:1.25rem}.h-6{height:1.5rem}.h-7{height:1.75rem}.h-8{height:2rem}.h-9{height:2.25rem}.h-\[100dvh\]{height:100dvh}.h-\[18px\]{height:18px}.h-\[2px\]{height:2px}.h-auto{height:auto}.h-full{height:100%}.h-px{height:1px}.max-h-40{max-height:10rem}.max-h-48{max-height:12rem}.max-h-64{max-height:16rem}.max-h-\[28rem\]{max-height:28rem}.max-h-\[60vh\]{max-height:60vh}.max-h-\[85dvh\]{max-height:85dvh}.max-h-\[85vh\]{max-height:85vh}.max-h-\[90dvh\]{max-height:90dvh}.max-h-\[90vh\]{max-height:90vh}.max-h-full{max-height:100%}.min-h-0{min-height:0px}.min-h-\[32px\]{min-height:32px}.min-h-\[34px\]{min-height:34px}.min-h-\[36px\]{min-height:36px}.min-h-\[44px\]{min-height:44px}.w-0\.5{width:.125rem}.w-1\.5{width:.375rem}.w-10{width:2.5rem}.w-12{width:3rem}.w-14{width:3.5rem}.w-16{width:4rem}.w-2{width:.5rem}.w-2\.5{width:.625rem}.w-2\/3{width:66.666667%}.w-20{width:5rem}.w-24{width:6rem}.w-28{width:7rem}.w-3{width:.75rem}.w-3\.5{width:.875rem}.w-4{width:1rem}.w-5{width:1.25rem}.w-52{width:13rem}.w-6{width:1.5rem}.w-7{width:1.75rem}.w-8{width:2rem}.w-9{width:2.25rem}.w-\[18px\]{width:18px}.w-\[2px\]{width:2px}.w-\[90vw\]{width:90vw}.w-\[92vw\]{width:92vw}.w-auto{width:auto}.w-full{width:100%}.w-px{width:1px}.min-w-0{min-width:0px}.min-w-\[32px\]{min-width:32px}.min-w-\[80px\]{min-width:80px}.min-w-max{min-width:-moz-max-content;min-width:max-content}.max-w-2xl{max-width:42rem}.max-w-3xl{max-width:48rem}.max-w-5xl{max-width:64rem}.max-w-\[1200px\]{max-width:1200px}.max-w-\[120px\]{max-width:120px}.max-w-\[2000px\]{max-width:2000px}.max-w-\[220px\]{max-width:220px}.max-w-\[360px\]{max-width:360px}.max-w-\[420px\]{max-width:420px}.max-w-\[45\%\]{max-width:45%}.max-w-\[560px\]{max-width:560px}.max-w-\[60px\]{max-width:60px}.max-w-\[820px\]{max-width:820px}.max-w-full{max-width:100%}.max-w-lg{max-width:32rem}.max-w-md{max-width:28rem}.max-w-none{max-width:none}.max-w-sm{max-width:24rem}.flex-1{flex:1 1 0%}.flex-shrink-0,.shrink-0{flex-shrink:0}.-translate-x-1\/2{--tw-translate-x: -50%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.-translate-y-1\/2{--tw-translate-y: -50%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.translate-x-1{--tw-translate-x: .25rem;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.translate-x-6{--tw-translate-x: 1.5rem;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.rotate-180{--tw-rotate: 180deg;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.transform{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}@keyframes pulse{50%{opacity:.5}}.animate-pulse{animation:pulse 2s cubic-bezier(.4,0,.6,1) infinite}@keyframes slideDown{0%{transform:translateY(-20px);opacity:0}to{transform:translateY(0);opacity:1}}.animate-slide-down{animation:slideDown .3s ease-out}.animate-spin{animation:spin 1s linear infinite}.cursor-not-allowed{cursor:not-allowed}.cursor-pointer{cursor:pointer}.cursor-wait{cursor:wait}.touch-manipulation{touch-action:manipulation}.select-none{-webkit-user-select:none;-moz-user-select:none;user-select:none}.resize-y{resize:vertical}.resize{resize:both}.list-inside{list-style-position:inside}.list-decimal{list-style-type:decimal}.list-disc{list-style-type:disc}.appearance-none{-webkit-appearance:none;-moz-appearance:none;appearance:none}.auto-rows-fr{grid-auto-rows:minmax(0,1fr)}.grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.grid-cols-\[1fr_2fr_120px\]{grid-template-columns:1fr 2fr 120px}.grid-cols-\[auto_1fr\]{grid-template-columns:auto 1fr}.flex-wrap{flex-wrap:wrap}.place-items-center{place-items:center}.items-start{align-items:flex-start}.items-end{align-items:flex-end}.items-baseline{align-items:baseline}.items-stretch{align-items:stretch}.gap-0{gap:0px}.gap-0\.5{gap:.125rem}.gap-1{gap:.25rem}.gap-1\.5{gap:.375rem}.gap-2{gap:.5rem}.gap-2\.5{gap:.625rem}.gap-3{gap:.75rem}.gap-4{gap:1rem}.gap-x-3{-moz-column-gap:.75rem;column-gap:.75rem}.gap-x-4{-moz-column-gap:1rem;column-gap:1rem}.gap-y-1{row-gap:.25rem}.gap-y-2{row-gap:.5rem}.space-y-0>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(0px * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(0px * var(--tw-space-y-reverse))}.space-y-1>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(.25rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.25rem * var(--tw-space-y-reverse))}.space-y-1\.5>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(.375rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.375rem * var(--tw-space-y-reverse))}.space-y-2>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.5rem * var(--tw-space-y-reverse))}.space-y-3>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(.75rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.75rem * var(--tw-space-y-reverse))}.space-y-4>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(1rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1rem * var(--tw-space-y-reverse))}.divide-y>:not([hidden])~:not([hidden]){--tw-divide-y-reverse: 0;border-top-width:calc(1px * calc(1 - var(--tw-divide-y-reverse)));border-bottom-width:calc(1px * var(--tw-divide-y-reverse))}.divide-neutral-800\/30>:not([hidden])~:not([hidden]){border-color:#2626264d}.divide-neutral-800\/40>:not([hidden])~:not([hidden]){border-color:#26262666}.overflow-auto{overflow:auto}.overflow-hidden{overflow:hidden}.overflow-visible{overflow:visible}.overflow-x-auto{overflow-x:auto}.overflow-y-auto{overflow-y:auto}.overflow-x-hidden{overflow-x:hidden}.truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.whitespace-nowrap{white-space:nowrap}.whitespace-pre-wrap{white-space:pre-wrap}.break-words{overflow-wrap:break-word}.break-all{word-break:break-all}.rounded{border-radius:.25rem}.rounded-2xl{border-radius:1rem}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:.5rem}.rounded-md{border-radius:.375rem}.rounded-none{border-radius:0}.rounded-sm{border-radius:.125rem}.rounded-xl{border-radius:.75rem}.rounded-t-2xl{border-top-left-radius:1rem;border-top-right-radius:1rem}.border{border-width:1px}.border-0{border-width:0px}.border-2{border-width:2px}.border-b{border-bottom-width:1px}.border-l-2{border-left-width:2px}.border-t{border-top-width:1px}.border-dashed{border-style:dashed}.border-amber-400\/40{border-color:#fbbf2466}.border-amber-500{--tw-border-opacity: 1;border-color:rgb(245 158 11 / var(--tw-border-opacity, 1))}.border-amber-500\/30{border-color:#f59e0b4d}.border-amber-500\/50{border-color:#f59e0b80}.border-amber-600\/50{border-color:#d9770680}.border-blue-400{--tw-border-opacity: 1;border-color:rgb(96 165 250 / var(--tw-border-opacity, 1))}.border-blue-400\/30{border-color:#60a5fa4d}.border-blue-500\/30{border-color:#3b82f64d}.border-blue-600\/40{border-color:#2563eb66}.border-blue-700{--tw-border-opacity: 1;border-color:rgb(29 78 216 / var(--tw-border-opacity, 1))}.border-cyan-400\/80{border-color:#22d3eecc}.border-cyan-500\/20{border-color:#06b6d433}.border-cyan-500\/25{border-color:#06b6d440}.border-cyan-500\/30{border-color:#06b6d44d}.border-fuchsia-400\/70{border-color:#e879f9b3}.border-fuchsia-500\/30{border-color:#d946ef4d}.border-fuchsia-500\/40{border-color:#d946ef66}.border-gray-600{--tw-border-opacity: 1;border-color:rgb(75 85 99 / var(--tw-border-opacity, 1))}.border-gray-700{--tw-border-opacity: 1;border-color:rgb(55 65 81 / var(--tw-border-opacity, 1))}.border-green-400\/30{border-color:#4ade804d}.border-green-500{--tw-border-opacity: 1;border-color:rgb(34 197 94 / var(--tw-border-opacity, 1))}.border-green-500\/30{border-color:#22c55e4d}.border-green-500\/40{border-color:#22c55e66}.border-indigo-500\/60{border-color:#6366f199}.border-neutral-700{--tw-border-opacity: 1;border-color:rgb(64 64 64 / var(--tw-border-opacity, 1))}.border-neutral-700\/30{border-color:#4040404d}.border-neutral-700\/40{border-color:#40404066}.border-neutral-700\/50{border-color:#40404080}.border-neutral-700\/60{border-color:#40404099}.border-neutral-800{--tw-border-opacity: 1;border-color:rgb(38 38 38 / var(--tw-border-opacity, 1))}.border-neutral-800\/30{border-color:#2626264d}.border-neutral-800\/40{border-color:#26262666}.border-neutral-800\/50{border-color:#26262680}.border-neutral-800\/60{border-color:#26262699}.border-neutral-800\/70{border-color:#262626b3}.border-neutral-900\/40{border-color:#17171766}.border-orange-500\/20{border-color:#f9731633}.border-orange-500\/30{border-color:#f973164d}.border-purple-400{--tw-border-opacity: 1;border-color:rgb(192 132 252 / var(--tw-border-opacity, 1))}.border-purple-400\/30{border-color:#c084fc4d}.border-purple-400\/70{border-color:#c084fcb3}.border-purple-500\/20{border-color:#a855f733}.border-purple-500\/25{border-color:#a855f740}.border-purple-500\/30{border-color:#a855f74d}.border-purple-500\/35{border-color:#a855f759}.border-purple-500\/40{border-color:#a855f766}.border-purple-500\/50{border-color:#a855f780}.border-purple-500\/60{border-color:#a855f799}.border-purple-600\/40{border-color:#9333ea66}.border-red-400\/30{border-color:#f871714d}.border-red-500\/30{border-color:#ef44444d}.border-red-500\/40{border-color:#ef444466}.border-transparent{border-color:transparent}.border-white\/30{border-color:#ffffff4d}.border-white\/\[0\.06\]{border-color:#ffffff0f}.border-yellow-500\/30{border-color:#eab3084d}.border-yellow-500\/40{border-color:#eab30866}.border-yellow-500\/50{border-color:#eab30880}.border-t-purple-400{--tw-border-opacity: 1;border-top-color:rgb(192 132 252 / var(--tw-border-opacity, 1))}.border-t-transparent{border-top-color:transparent}.border-t-white{--tw-border-opacity: 1;border-top-color:rgb(255 255 255 / var(--tw-border-opacity, 1))}.border-t-white\/80{border-top-color:#fffc}.bg-amber-500{--tw-bg-opacity: 1;background-color:rgb(245 158 11 / var(--tw-bg-opacity, 1))}.bg-amber-500\/10{background-color:#f59e0b1a}.bg-amber-500\/20{background-color:#f59e0b33}.bg-amber-600{--tw-bg-opacity: 1;background-color:rgb(217 119 6 / var(--tw-bg-opacity, 1))}.bg-amber-900\/30{background-color:#78350f4d}.bg-black{--tw-bg-opacity: 1;background-color:rgb(0 0 0 / var(--tw-bg-opacity, 1))}.bg-black\/10{background-color:#0000001a}.bg-black\/40{background-color:#0006}.bg-black\/50{background-color:#00000080}.bg-black\/55{background-color:#0000008c}.bg-black\/60{background-color:#0009}.bg-black\/70{background-color:#000000b3}.bg-black\/90{background-color:#000000e6}.bg-black\/95{background-color:#000000f2}.bg-blue-400{--tw-bg-opacity: 1;background-color:rgb(96 165 250 / var(--tw-bg-opacity, 1))}.bg-blue-500\/10{background-color:#3b82f61a}.bg-blue-500\/20{background-color:#3b82f633}.bg-blue-500\/90{background-color:#3b82f6e6}.bg-blue-900{--tw-bg-opacity: 1;background-color:rgb(30 58 138 / var(--tw-bg-opacity, 1))}.bg-blue-900\/30{background-color:#1e3a8a4d}.bg-cyan-400{--tw-bg-opacity: 1;background-color:rgb(34 211 238 / var(--tw-bg-opacity, 1))}.bg-cyan-500\/10{background-color:#06b6d41a}.bg-emerald-500{--tw-bg-opacity: 1;background-color:rgb(16 185 129 / var(--tw-bg-opacity, 1))}.bg-fuchsia-500\/10{background-color:#d946ef1a}.bg-fuchsia-500\/15{background-color:#d946ef26}.bg-gray-600{--tw-bg-opacity: 1;background-color:rgb(75 85 99 / var(--tw-bg-opacity, 1))}.bg-gray-700{--tw-bg-opacity: 1;background-color:rgb(55 65 81 / var(--tw-bg-opacity, 1))}.bg-gray-800{--tw-bg-opacity: 1;background-color:rgb(31 41 55 / var(--tw-bg-opacity, 1))}.bg-gray-900{--tw-bg-opacity: 1;background-color:rgb(17 24 39 / var(--tw-bg-opacity, 1))}.bg-green-500{--tw-bg-opacity: 1;background-color:rgb(34 197 94 / var(--tw-bg-opacity, 1))}.bg-green-500\/10{background-color:#22c55e1a}.bg-green-500\/15{background-color:#22c55e26}.bg-green-500\/20{background-color:#22c55e33}.bg-green-500\/40{background-color:#22c55e66}.bg-green-500\/5{background-color:#22c55e0d}.bg-green-500\/80{background-color:#22c55ecc}.bg-green-500\/90{background-color:#22c55ee6}.bg-green-600{--tw-bg-opacity: 1;background-color:rgb(22 163 74 / var(--tw-bg-opacity, 1))}.bg-green-600\/20{background-color:#16a34a33}.bg-green-900{--tw-bg-opacity: 1;background-color:rgb(20 83 45 / var(--tw-bg-opacity, 1))}.bg-indigo-500\/10{background-color:#6366f11a}.bg-neutral-200{--tw-bg-opacity: 1;background-color:rgb(229 229 229 / var(--tw-bg-opacity, 1))}.bg-neutral-800{--tw-bg-opacity: 1;background-color:rgb(38 38 38 / var(--tw-bg-opacity, 1))}.bg-neutral-800\/40{background-color:#26262666}.bg-neutral-800\/50{background-color:#26262680}.bg-neutral-800\/60{background-color:#26262699}.bg-neutral-800\/70{background-color:#262626b3}.bg-neutral-800\/80{background-color:#262626cc}.bg-neutral-900{--tw-bg-opacity: 1;background-color:rgb(23 23 23 / var(--tw-bg-opacity, 1))}.bg-neutral-900\/20{background-color:#17171733}.bg-neutral-900\/30{background-color:#1717174d}.bg-neutral-900\/40{background-color:#17171766}.bg-neutral-900\/50{background-color:#17171780}.bg-neutral-900\/60{background-color:#17171799}.bg-neutral-900\/80{background-color:#171717cc}.bg-neutral-900\/90{background-color:#171717e6}.bg-neutral-900\/95{background-color:#171717f2}.bg-neutral-950{--tw-bg-opacity: 1;background-color:rgb(10 10 10 / var(--tw-bg-opacity, 1))}.bg-neutral-950\/20{background-color:#0a0a0a33}.bg-neutral-950\/30{background-color:#0a0a0a4d}.bg-neutral-950\/40{background-color:#0a0a0a66}.bg-neutral-950\/50{background-color:#0a0a0a80}.bg-neutral-950\/60{background-color:#0a0a0a99}.bg-neutral-950\/70{background-color:#0a0a0ab3}.bg-neutral-950\/75{background-color:#0a0a0abf}.bg-neutral-950\/80{background-color:#0a0a0acc}.bg-neutral-950\/90{background-color:#0a0a0ae6}.bg-neutral-950\/95{background-color:#0a0a0af2}.bg-orange-500\/10{background-color:#f973161a}.bg-orange-500\/15{background-color:#f9731626}.bg-orange-500\/5{background-color:#f973160d}.bg-orange-600{--tw-bg-opacity: 1;background-color:rgb(234 88 12 / var(--tw-bg-opacity, 1))}.bg-purple-200{--tw-bg-opacity: 1;background-color:rgb(233 213 255 / var(--tw-bg-opacity, 1))}.bg-purple-400{--tw-bg-opacity: 1;background-color:rgb(192 132 252 / var(--tw-bg-opacity, 1))}.bg-purple-500{--tw-bg-opacity: 1;background-color:rgb(168 85 247 / var(--tw-bg-opacity, 1))}.bg-purple-500\/10{background-color:#a855f71a}.bg-purple-500\/15{background-color:#a855f726}.bg-purple-500\/20{background-color:#a855f733}.bg-purple-500\/25{background-color:#a855f740}.bg-purple-500\/30{background-color:#a855f74d}.bg-purple-500\/5{background-color:#a855f70d}.bg-purple-600{--tw-bg-opacity: 1;background-color:rgb(147 51 234 / var(--tw-bg-opacity, 1))}.bg-purple-600\/10{background-color:#9333ea1a}.bg-purple-600\/30{background-color:#9333ea4d}.bg-purple-600\/80{background-color:#9333eacc}.bg-purple-600\/90{background-color:#9333eae6}.bg-purple-900\/30{background-color:#581c874d}.bg-purple-950\/30{background-color:#3b07644d}.bg-red-500\/10{background-color:#ef44441a}.bg-red-500\/90{background-color:#ef4444e6}.bg-teal-600{--tw-bg-opacity: 1;background-color:rgb(13 148 136 / var(--tw-bg-opacity, 1))}.bg-white{--tw-bg-opacity: 1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.bg-white\/10{background-color:#ffffff1a}.bg-white\/60{background-color:#fff9}.bg-white\/80{background-color:#fffc}.bg-white\/90{background-color:#ffffffe6}.bg-white\/\[0\.04\]{background-color:#ffffff0a}.bg-yellow-400\/70{background-color:#facc15b3}.bg-yellow-500\/10{background-color:#eab3081a}.bg-yellow-500\/15{background-color:#eab30826}.bg-yellow-500\/20{background-color:#eab30833}.bg-opacity-30{--tw-bg-opacity: .3}.bg-opacity-50{--tw-bg-opacity: .5}.bg-gradient-to-b{background-image:linear-gradient(to bottom,var(--tw-gradient-stops))}.bg-gradient-to-br{background-image:linear-gradient(to bottom right,var(--tw-gradient-stops))}.bg-gradient-to-r{background-image:linear-gradient(to right,var(--tw-gradient-stops))}.from-black\/0{--tw-gradient-from: rgb(0 0 0 / 0) var(--tw-gradient-from-position);--tw-gradient-to: rgb(0 0 0 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.from-cyan-500\/20{--tw-gradient-from: rgb(6 182 212 / .2) var(--tw-gradient-from-position);--tw-gradient-to: rgb(6 182 212 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.from-neutral-900{--tw-gradient-from: #171717 var(--tw-gradient-from-position);--tw-gradient-to: rgb(23 23 23 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.from-neutral-900\/60{--tw-gradient-from: rgb(23 23 23 / .6) var(--tw-gradient-from-position);--tw-gradient-to: rgb(23 23 23 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.from-neutral-900\/80{--tw-gradient-from: rgb(23 23 23 / .8) var(--tw-gradient-from-position);--tw-gradient-to: rgb(23 23 23 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.from-neutral-950\/70{--tw-gradient-from: rgb(10 10 10 / .7) var(--tw-gradient-from-position);--tw-gradient-to: rgb(10 10 10 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.from-neutral-950\/75{--tw-gradient-from: rgb(10 10 10 / .75) var(--tw-gradient-from-position);--tw-gradient-to: rgb(10 10 10 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.from-purple-300{--tw-gradient-from: #d8b4fe var(--tw-gradient-from-position);--tw-gradient-to: rgb(216 180 254 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.from-purple-500{--tw-gradient-from: #a855f7 var(--tw-gradient-from-position);--tw-gradient-to: rgb(168 85 247 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.from-purple-500\/10{--tw-gradient-from: rgb(168 85 247 / .1) var(--tw-gradient-from-position);--tw-gradient-to: rgb(168 85 247 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.from-purple-600{--tw-gradient-from: #9333ea var(--tw-gradient-from-position);--tw-gradient-to: rgb(147 51 234 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.via-black\/0{--tw-gradient-to: rgb(0 0 0 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), rgb(0 0 0 / 0) var(--tw-gradient-via-position), var(--tw-gradient-to)}.via-neutral-900\/60{--tw-gradient-to: rgb(23 23 23 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), rgb(23 23 23 / .6) var(--tw-gradient-via-position), var(--tw-gradient-to)}.via-purple-400{--tw-gradient-to: rgb(192 132 252 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), #c084fc var(--tw-gradient-via-position), var(--tw-gradient-to)}.via-purple-500\/20{--tw-gradient-to: rgb(168 85 247 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), rgb(168 85 247 / .2) var(--tw-gradient-via-position), var(--tw-gradient-to)}.to-black\/35{--tw-gradient-to: rgb(0 0 0 / .35) var(--tw-gradient-to-position)}.to-black\/45{--tw-gradient-to: rgb(0 0 0 / .45) var(--tw-gradient-to-position)}.to-indigo-600{--tw-gradient-to: #4f46e5 var(--tw-gradient-to-position)}.to-neutral-900\/50{--tw-gradient-to: rgb(23 23 23 / .5) var(--tw-gradient-to-position)}.to-neutral-950{--tw-gradient-to: #0a0a0a var(--tw-gradient-to-position)}.to-neutral-950\/35{--tw-gradient-to: rgb(10 10 10 / .35) var(--tw-gradient-to-position)}.to-neutral-950\/40{--tw-gradient-to: rgb(10 10 10 / .4) var(--tw-gradient-to-position)}.to-neutral-950\/80{--tw-gradient-to: rgb(10 10 10 / .8) var(--tw-gradient-to-position)}.to-pink-500{--tw-gradient-to: #ec4899 var(--tw-gradient-to-position)}.to-pink-500\/20{--tw-gradient-to: rgb(236 72 153 / .2) var(--tw-gradient-to-position)}.to-purple-500{--tw-gradient-to: #a855f7 var(--tw-gradient-to-position)}.bg-clip-text{-webkit-background-clip:text;background-clip:text}.object-contain{-o-object-fit:contain;object-fit:contain}.object-cover{-o-object-fit:cover;object-fit:cover}.p-0{padding:0}.p-1{padding:.25rem}.p-1\.5{padding:.375rem}.p-2{padding:.5rem}.p-2\.5{padding:.625rem}.p-3{padding:.75rem}.p-4{padding:1rem}.p-6{padding:1.5rem}.p-8{padding:2rem}.px-1{padding-left:.25rem;padding-right:.25rem}.px-1\.5{padding-left:.375rem;padding-right:.375rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-2\.5{padding-left:.625rem;padding-right:.625rem}.px-3{padding-left:.75rem;padding-right:.75rem}.px-4{padding-left:1rem;padding-right:1rem}.px-5{padding-left:1.25rem;padding-right:1.25rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.py-0{padding-top:0;padding-bottom:0}.py-0\.5{padding-top:.125rem;padding-bottom:.125rem}.py-1{padding-top:.25rem;padding-bottom:.25rem}.py-1\.5{padding-top:.375rem;padding-bottom:.375rem}.py-10{padding-top:2.5rem;padding-bottom:2.5rem}.py-12{padding-top:3rem;padding-bottom:3rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.py-2\.5{padding-top:.625rem;padding-bottom:.625rem}.py-3{padding-top:.75rem;padding-bottom:.75rem}.py-3\.5{padding-top:.875rem;padding-bottom:.875rem}.py-4{padding-top:1rem;padding-bottom:1rem}.py-5{padding-top:1.25rem;padding-bottom:1.25rem}.pb-0{padding-bottom:0}.pb-0\.5{padding-bottom:.125rem}.pb-1{padding-bottom:.25rem}.pb-1\.5{padding-bottom:.375rem}.pb-12{padding-bottom:3rem}.pb-2{padding-bottom:.5rem}.pb-3{padding-bottom:.75rem}.pb-5{padding-bottom:1.25rem}.pb-\[calc\(env\(safe-area-inset-bottom\,0px\)\+0\.25rem\)\]{padding-bottom:calc(env(safe-area-inset-bottom,0px) + .25rem)}.pl-5{padding-left:1.25rem}.pl-6{padding-left:1.5rem}.pl-8{padding-left:2rem}.pr-2{padding-right:.5rem}.pr-7{padding-right:1.75rem}.pt-0\.5{padding-top:.125rem}.pt-1{padding-top:.25rem}.pt-2{padding-top:.5rem}.pt-2\.5{padding-top:.625rem}.pt-3{padding-top:.75rem}.pt-5{padding-top:1.25rem}.text-left{text-align:left}.text-right{text-align:right}.font-mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-\[10px\]{font-size:10px}.text-\[11px\]{font-size:11px}.text-\[12px\]{font-size:12px}.text-\[13px\]{font-size:13px}.text-\[14px\]{font-size:14px}.text-\[7px\]{font-size:7px}.text-\[8px\]{font-size:8px}.text-\[9px\]{font-size:9px}.text-base{font-size:1rem;line-height:1.5rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-xs{font-size:.75rem;line-height:1rem}.font-bold{font-weight:700}.font-extrabold{font-weight:800}.font-medium{font-weight:500}.font-normal{font-weight:400}.font-semibold{font-weight:600}.uppercase{text-transform:uppercase}.capitalize{text-transform:capitalize}.italic{font-style:italic}.ordinal{--tw-ordinal: ordinal;font-variant-numeric:var(--tw-ordinal) var(--tw-slashed-zero) var(--tw-numeric-figure) var(--tw-numeric-spacing) var(--tw-numeric-fraction)}.tabular-nums{--tw-numeric-spacing: tabular-nums;font-variant-numeric:var(--tw-ordinal) var(--tw-slashed-zero) var(--tw-numeric-figure) var(--tw-numeric-spacing) var(--tw-numeric-fraction)}.leading-4{line-height:1rem}.leading-5{line-height:1.25rem}.leading-relaxed{line-height:1.625}.leading-snug{line-height:1.375}.leading-tight{line-height:1.25}.tracking-tight{letter-spacing:-.025em}.tracking-wide{letter-spacing:.025em}.tracking-wider{letter-spacing:.05em}.tracking-widest{letter-spacing:.1em}.text-amber-100{--tw-text-opacity: 1;color:rgb(254 243 199 / var(--tw-text-opacity, 1))}.text-amber-200{--tw-text-opacity: 1;color:rgb(253 230 138 / var(--tw-text-opacity, 1))}.text-amber-300{--tw-text-opacity: 1;color:rgb(252 211 77 / var(--tw-text-opacity, 1))}.text-amber-300\/80{color:#fcd34dcc}.text-amber-300\/90{color:#fcd34de6}.text-amber-400{--tw-text-opacity: 1;color:rgb(251 191 36 / var(--tw-text-opacity, 1))}.text-amber-400\/80{color:#fbbf24cc}.text-blue-100{--tw-text-opacity: 1;color:rgb(219 234 254 / var(--tw-text-opacity, 1))}.text-blue-200{--tw-text-opacity: 1;color:rgb(191 219 254 / var(--tw-text-opacity, 1))}.text-blue-300{--tw-text-opacity: 1;color:rgb(147 197 253 / var(--tw-text-opacity, 1))}.text-blue-300\/70{color:#93c5fdb3}.text-blue-400{--tw-text-opacity: 1;color:rgb(96 165 250 / var(--tw-text-opacity, 1))}.text-cyan-200{--tw-text-opacity: 1;color:rgb(165 243 252 / var(--tw-text-opacity, 1))}.text-emerald-300\/90{color:#6ee7b7e6}.text-fuchsia-100{--tw-text-opacity: 1;color:rgb(250 232 255 / var(--tw-text-opacity, 1))}.text-fuchsia-200{--tw-text-opacity: 1;color:rgb(245 208 254 / var(--tw-text-opacity, 1))}.text-fuchsia-300{--tw-text-opacity: 1;color:rgb(240 171 252 / var(--tw-text-opacity, 1))}.text-fuchsia-300\/90{color:#f0abfce6}.text-gray-200{--tw-text-opacity: 1;color:rgb(229 231 235 / var(--tw-text-opacity, 1))}.text-gray-300{--tw-text-opacity: 1;color:rgb(209 213 219 / var(--tw-text-opacity, 1))}.text-gray-400{--tw-text-opacity: 1;color:rgb(156 163 175 / var(--tw-text-opacity, 1))}.text-green-200{--tw-text-opacity: 1;color:rgb(187 247 208 / var(--tw-text-opacity, 1))}.text-green-300{--tw-text-opacity: 1;color:rgb(134 239 172 / var(--tw-text-opacity, 1))}.text-green-300\/90{color:#86eface6}.text-green-400{--tw-text-opacity: 1;color:rgb(74 222 128 / var(--tw-text-opacity, 1))}.text-green-400\/80{color:#4ade80cc}.text-indigo-200{--tw-text-opacity: 1;color:rgb(199 210 254 / var(--tw-text-opacity, 1))}.text-indigo-300\/90{color:#a5b4fce6}.text-neutral-100{--tw-text-opacity: 1;color:rgb(245 245 245 / var(--tw-text-opacity, 1))}.text-neutral-200{--tw-text-opacity: 1;color:rgb(229 229 229 / var(--tw-text-opacity, 1))}.text-neutral-300{--tw-text-opacity: 1;color:rgb(212 212 212 / var(--tw-text-opacity, 1))}.text-neutral-400{--tw-text-opacity: 1;color:rgb(163 163 163 / var(--tw-text-opacity, 1))}.text-neutral-500{--tw-text-opacity: 1;color:rgb(115 115 115 / var(--tw-text-opacity, 1))}.text-neutral-600{--tw-text-opacity: 1;color:rgb(82 82 82 / var(--tw-text-opacity, 1))}.text-neutral-700{--tw-text-opacity: 1;color:rgb(64 64 64 / var(--tw-text-opacity, 1))}.text-neutral-800{--tw-text-opacity: 1;color:rgb(38 38 38 / var(--tw-text-opacity, 1))}.text-neutral-950{--tw-text-opacity: 1;color:rgb(10 10 10 / var(--tw-text-opacity, 1))}.text-orange-300{--tw-text-opacity: 1;color:rgb(253 186 116 / var(--tw-text-opacity, 1))}.text-orange-300\/80{color:#fdba74cc}.text-orange-300\/90{color:#fdba74e6}.text-orange-400{--tw-text-opacity: 1;color:rgb(251 146 60 / var(--tw-text-opacity, 1))}.text-purple-200{--tw-text-opacity: 1;color:rgb(233 213 255 / var(--tw-text-opacity, 1))}.text-purple-300{--tw-text-opacity: 1;color:rgb(216 180 254 / var(--tw-text-opacity, 1))}.text-purple-300\/70{color:#d8b4feb3}.text-purple-300\/80{color:#d8b4fecc}.text-purple-300\/90{color:#d8b4fee6}.text-purple-400{--tw-text-opacity: 1;color:rgb(192 132 252 / var(--tw-text-opacity, 1))}.text-purple-400\/70{color:#c084fcb3}.text-purple-50{--tw-text-opacity: 1;color:rgb(250 245 255 / var(--tw-text-opacity, 1))}.text-red-300{--tw-text-opacity: 1;color:rgb(252 165 165 / var(--tw-text-opacity, 1))}.text-red-400{--tw-text-opacity: 1;color:rgb(248 113 113 / var(--tw-text-opacity, 1))}.text-sky-300\/90{color:#7dd3fce6}.text-sky-400{--tw-text-opacity: 1;color:rgb(56 189 248 / var(--tw-text-opacity, 1))}.text-teal-300{--tw-text-opacity: 1;color:rgb(94 234 212 / var(--tw-text-opacity, 1))}.text-teal-300\/90{color:#5eead4e6}.text-transparent{color:transparent}.text-white{--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.text-white\/70{color:#ffffffb3}.text-white\/80{color:#fffc}.text-yellow-300{--tw-text-opacity: 1;color:rgb(253 224 71 / var(--tw-text-opacity, 1))}.text-yellow-300\/50{color:#fde04780}.text-yellow-300\/80{color:#fde047cc}.text-yellow-300\/90{color:#fde047e6}.text-yellow-400{--tw-text-opacity: 1;color:rgb(250 204 21 / var(--tw-text-opacity, 1))}.text-yellow-400\/70{color:#facc15b3}.text-yellow-400\/80{color:#facc15cc}.underline{text-decoration-line:underline}.underline-offset-2{text-underline-offset:2px}.accent-amber-500{accent-color:#f59e0b}.accent-fuchsia-500{accent-color:#d946ef}.accent-purple-500{accent-color:#a855f7}.accent-sky-500{accent-color:#0ea5e9}.opacity-0{opacity:0}.opacity-25{opacity:.25}.opacity-40{opacity:.4}.opacity-70{opacity:.7}.opacity-75{opacity:.75}.opacity-80{opacity:.8}.shadow{--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-2xl{--tw-shadow: 0 25px 50px -12px rgb(0 0 0 / .25);--tw-shadow-colored: 0 25px 50px -12px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-\[0_0_0_1px_rgba\(16\,185\,129\,0\.35\)\,0_10px_30px_rgba\(16\,185\,129\,0\.15\)\]{--tw-shadow: 0 0 0 1px rgba(16,185,129,.35),0 10px 30px rgba(16,185,129,.15);--tw-shadow-colored: 0 0 0 1px var(--tw-shadow-color), 0 10px 30px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-\[0_0_0_1px_rgba\(168\,85\,247\,0\.08\)\,0_12px_50px_rgba\(0\,0\,0\,0\.35\)\]{--tw-shadow: 0 0 0 1px rgba(168,85,247,.08),0 12px 50px rgba(0,0,0,.35);--tw-shadow-colored: 0 0 0 1px var(--tw-shadow-color), 0 12px 50px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-\[0_0_0_1px_rgba\(168\,85\,247\,0\.35\)\,0_10px_30px_rgba\(168\,85\,247\,0\.15\)\]{--tw-shadow: 0 0 0 1px rgba(168,85,247,.35),0 10px 30px rgba(168,85,247,.15);--tw-shadow-colored: 0 0 0 1px var(--tw-shadow-color), 0 10px 30px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-\[0_0_0_1px_rgba\(236\,72\,153\,0\.10\)\,0_20px_80px_rgba\(0\,0\,0\,0\.6\)\]{--tw-shadow: 0 0 0 1px rgba(236,72,153,.1),0 20px 80px rgba(0,0,0,.6);--tw-shadow-colored: 0 0 0 1px var(--tw-shadow-color), 0 20px 80px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-\[0_0_0_1px_rgba\(245\,158\,11\,0\.35\)\,0_10px_30px_rgba\(245\,158\,11\,0\.12\)\]{--tw-shadow: 0 0 0 1px rgba(245,158,11,.35),0 10px 30px rgba(245,158,11,.12);--tw-shadow-colored: 0 0 0 1px var(--tw-shadow-color), 0 10px 30px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-\[0_0_0_1px_rgba\(34\,211\,238\,0\.06\)\,0_12px_50px_rgba\(0\,0\,0\,0\.35\)\]{--tw-shadow: 0 0 0 1px rgba(34,211,238,.06),0 12px 50px rgba(0,0,0,.35);--tw-shadow-colored: 0 0 0 1px var(--tw-shadow-color), 0 12px 50px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-\[0_0_0_1px_rgba\(59\,130\,246\,0\.10\)\,0_0_18px_rgba\(59\,130\,246\,0\.06\)\]{--tw-shadow: 0 0 0 1px rgba(59,130,246,.1),0 0 18px rgba(59,130,246,.06);--tw-shadow-colored: 0 0 0 1px var(--tw-shadow-color), 0 0 18px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-\[0_0_0_1px_rgba\(59\,130\,246\,0\.10\)\,0_0_22px_rgba\(59\,130\,246\,0\.08\)\]{--tw-shadow: 0 0 0 1px rgba(59,130,246,.1),0 0 22px rgba(59,130,246,.08);--tw-shadow-colored: 0 0 0 1px var(--tw-shadow-color), 0 0 22px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-\[0_0_0_1px_rgba\(59\,130\,246\,0\.15\)\,0_0_30px_rgba\(59\,130\,246\,0\.10\)\]{--tw-shadow: 0 0 0 1px rgba(59,130,246,.15),0 0 30px rgba(59,130,246,.1);--tw-shadow-colored: 0 0 0 1px var(--tw-shadow-color), 0 0 30px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-\[0_0_12px_rgba\(34\,211\,238\,0\.45\)\]{--tw-shadow: 0 0 12px rgba(34,211,238,.45);--tw-shadow-colored: 0 0 12px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-\[0_0_6px_rgba\(168\,85\,247\,0\.4\)\]{--tw-shadow: 0 0 6px rgba(168,85,247,.4);--tw-shadow-colored: 0 0 6px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-\[0_4px_20px_rgba\(0\,0\,0\,0\.25\)\]{--tw-shadow: 0 4px 20px rgba(0,0,0,.25);--tw-shadow-colored: 0 4px 20px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-lg{--tw-shadow: 0 10px 15px -3px rgb(0 0 0 / .1), 0 4px 6px -4px rgb(0 0 0 / .1);--tw-shadow-colored: 0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-cyan-500\/10{--tw-shadow-color: rgb(6 182 212 / .1);--tw-shadow: var(--tw-shadow-colored)}.shadow-purple-500\/10{--tw-shadow-color: rgb(168 85 247 / .1);--tw-shadow: var(--tw-shadow-colored)}.shadow-purple-500\/20{--tw-shadow-color: rgb(168 85 247 / .2);--tw-shadow: var(--tw-shadow-colored)}.shadow-purple-500\/25{--tw-shadow-color: rgb(168 85 247 / .25);--tw-shadow: var(--tw-shadow-colored)}.shadow-purple-500\/30{--tw-shadow-color: rgb(168 85 247 / .3);--tw-shadow: var(--tw-shadow-colored)}.outline-none{outline:2px solid transparent;outline-offset:2px}.ring-1{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.ring-2{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.ring-amber-500\/15{--tw-ring-color: rgb(245 158 11 / .15)}.ring-indigo-500\/30{--tw-ring-color: rgb(99 102 241 / .3)}.ring-neutral-700\/40{--tw-ring-color: rgb(64 64 64 / .4)}.ring-neutral-800\/70{--tw-ring-color: rgb(38 38 38 / .7)}.ring-neutral-900\/60{--tw-ring-color: rgb(23 23 23 / .6)}.ring-purple-500{--tw-ring-opacity: 1;--tw-ring-color: rgb(168 85 247 / var(--tw-ring-opacity, 1))}.ring-purple-500\/30{--tw-ring-color: rgb(168 85 247 / .3)}.ring-purple-500\/50{--tw-ring-color: rgb(168 85 247 / .5)}.ring-white\/10{--tw-ring-color: rgb(255 255 255 / .1)}.ring-white\/\[0\.06\]{--tw-ring-color: rgb(255 255 255 / .06)}.blur{--tw-blur: blur(8px);filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.drop-shadow-\[0_0_10px_rgba\(251\,191\,36\,0\.10\)\]{--tw-drop-shadow: drop-shadow(0 0 10px rgba(251,191,36,.1));filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.drop-shadow-\[0_0_10px_rgba\(251\,191\,36\,0\.15\)\]{--tw-drop-shadow: drop-shadow(0 0 10px rgba(251,191,36,.15));filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.drop-shadow-\[0_0_10px_rgba\(251\,191\,36\,0\.18\)\]{--tw-drop-shadow: drop-shadow(0 0 10px rgba(251,191,36,.18));filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.drop-shadow-lg{--tw-drop-shadow: drop-shadow(0 10px 8px rgb(0 0 0 / .04)) drop-shadow(0 4px 3px rgb(0 0 0 / .1));filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.backdrop-blur{--tw-backdrop-blur: blur(8px);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.backdrop-blur-md{--tw-backdrop-blur: blur(12px);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.backdrop-blur-sm{--tw-backdrop-blur: blur(4px);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.transition{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-all{transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-colors{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-transform{transition-property:transform;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.duration-150{transition-duration:.15s}.duration-200{transition-duration:.2s}.duration-300{transition-duration:.3s}.ease-in-out{transition-timing-function:cubic-bezier(.4,0,.2,1)}.ease-out{transition-timing-function:cubic-bezier(0,0,.2,1)}:root{--bgPrimary: #0a0118;--bgSecondary: #1a0b2e;--bgCard: #1a0b2e;--bgElevated: #2d1b4e;--bgHover: #3d2b5e;--inputBg: var(--bgSecondary);--inputBorder: var(--borderMedium);--inputFocus: var(--borderActive);--textPrimary: #f1f5f9;--textSecondary: #e2e8f0;--textMuted: #94a3b8;--textDisabled: #64748b;--accentPurple: #a855f7;--accentPink: var(--accentPurple);--accentBlue: #3b82f6;--accentCyan: #06b6d4;--accentAmber: #f59e0b;--accentRed: #ef4444;--accentGreen: #22c55e;--borderSubtle: rgba(168, 85, 247, .1);--borderMedium: rgba(168, 85, 247, .2);--borderBright: rgba(168, 85, 247, .4);--borderActive: #a855f7;--gradientPurplePink: linear-gradient(135deg, var(--accentPurple) 0%, var(--accentPurple) 100%);--gradientSecondary: linear-gradient(135deg, #2d1b4e 0%, #1a0b2e 100%);--gradientCardBg: linear-gradient(135deg, rgba(45, 27, 78, .8), rgba(26, 11, 46, .6));--gradientHover: linear-gradient(135deg, var(--accentPurple) 0%, var(--accentPurple) 100%);--shadowSm: 0 1px 2px 0 rgba(0, 0, 0, .5);--shadowMd: 0 4px 6px -1px rgba(0, 0, 0, .5);--shadowLg: 0 10px 15px -3px rgba(0, 0, 0, .5);--shadowXl: 0 20px 25px -5px rgba(0, 0, 0, .5);--shadowPurple: 0 10px 15px -3px rgba(168, 85, 247, .3);--glowPurple: 0 0 20px rgba(168, 85, 247, .5);--shadowPink: var(--shadowPurple);--glowPink: var(--glowPurple);--fontFamily-sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;--fontFamily-mono: "SF Mono", Monaco, "Cascadia Code", "Roboto Mono", Consolas, "Courier New", monospace;--fontSize-xs: .75rem;--fontSize-sm: .875rem;--fontSize-base: 1rem;--fontSize-lg: 1.125rem;--fontSize-xl: 1.25rem;--fontSize-2xl: 1.5rem;--fontSize-3xl: 1.875rem;--fontSize-4xl: 2.25rem;--fontWeight-normal: 400;--fontWeight-medium: 500;--fontWeight-semibold: 600;--fontWeight-bold: 700;--spacing-xs: .25rem;--spacing-sm: .5rem;--spacing-md: 1rem;--spacing-lg: 1.5rem;--spacing-xl: 2rem;--spacing-xxl: 3rem;--radius-sm: .25rem;--radius-md: .5rem;--radius-lg: .75rem;--radius-xl: 1rem;--radius-xxl: 1.5rem;--radius-round: 9999px;--transition-fast: all .15s ease;--transition-normal: all .3s ease;--transition-slow: all .5s ease}.inscription-container{background:var(--bgPrimary);color:var(--textPrimary);min-height:100vh;min-height:100dvh;padding:var(--spacing-xl);font-family:var(--fontFamily-sans);overflow-x:hidden;width:100%;max-width:100vw}@media (max-width: 640px){.inscription-container{padding:var(--spacing-sm)}}.inscription-section{margin-bottom:var(--spacing-xxl)}.inscription-card{background:var(--gradientCardBg);border:1px solid var(--borderMedium);border-radius:var(--radius-xl);padding:var(--spacing-xl);box-shadow:var(--shadowPurple);transition:var(--transition-normal)}.inscription-card:hover{border-color:var(--borderBright);box-shadow:var(--glowPurple);transform:translateY(-2px)}.content-editor.inscription-card{padding:0}.content-editor-body{display:flex;gap:var(--spacing-md);height:100%;min-height:0}.content-editor-workspace{flex:1;min-width:0;display:flex;flex-direction:column;gap:var(--spacing-md);min-height:0;overflow:hidden}.content-editor-workspace>.fade-in{flex:1;min-height:0;display:flex;flex-direction:column}.content-editor-workspace textarea{flex:1}.content-fee-panel{flex:0 0 25%;min-width:240px;max-width:none;display:flex;flex-direction:column;min-height:0}.content-fee-panel>*{flex:1;min-height:0}@media (max-width: 1024px){.content-editor-body{flex-direction:column}.content-fee-panel{flex:1 1 auto;max-width:none;min-width:0}}.content-editor-header{align-items:center;gap:var(--spacing-lg);flex-wrap:wrap}.content-editor-header.inscription-card-header{border-bottom:none;padding-bottom:0;margin-bottom:var(--spacing-md)}.content-editor-header-main{display:flex;align-items:center;gap:var(--spacing-lg);flex:1;min-width:0;flex-wrap:wrap}.content-editor-tabs{display:flex;gap:4px;padding:4px;align-items:flex-end;border-bottom:1px solid var(--borderMedium);border-radius:var(--radius-md) var(--radius-md) 0 0;max-width:100%;overflow-x:auto;-webkit-overflow-scrolling:touch;flex-wrap:nowrap}.content-editor-tabs .tab-button{white-space:nowrap;flex-shrink:0;min-height:36px;padding:6px 10px;font-size:12px}@media (max-width: 640px){.content-editor-tabs{gap:2px;padding:2px}.content-editor-tabs .tab-button{padding:5px 6px!important;font-size:11px!important}}.inscription-card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--spacing-lg);padding-bottom:var(--spacing-md);border-bottom:1px solid var(--borderSubtle)}.inscription-card-title{font-size:var(--fontSize-xl);font-weight:var(--fontWeight-semibold);color:var(--textPrimary);display:flex;align-items:center;gap:var(--spacing-sm)}.inscription-card-body{color:var(--textSecondary)}.mode-badge{background:var(--gradientPurplePink);color:#fff;padding:var(--spacing-sm) var(--spacing-lg);border-radius:var(--radius-round);font-weight:var(--fontWeight-semibold);font-size:var(--fontSize-sm);display:inline-flex;align-items:center;gap:var(--spacing-sm);box-shadow:var(--shadowPink);transition:var(--transition-normal)}.mode-badge:hover{box-shadow:var(--glowPink);transform:scale(1.05)}.mode-badge-large{padding:var(--spacing-md) var(--spacing-xl);font-size:var(--fontSize-base);border-radius:var(--radius-xxl)}.inscription-preview{background:var(--bgSecondary);border:2px solid var(--borderMedium);border-radius:var(--radius-lg);padding:var(--spacing-lg);overflow:hidden;transition:var(--transition-normal);cursor:pointer;position:relative}.inscription-preview:hover{border-color:var(--borderBright);box-shadow:var(--shadowPurple);transform:translateY(-2px)}.inscription-preview.selected{border-color:var(--accentPurple);box-shadow:var(--glowPurple);background:#a855f71a}.inscription-preview-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--spacing-md);padding-bottom:var(--spacing-sm);border-bottom:1px solid var(--borderSubtle)}.inscription-preview-content{max-height:300px;overflow:auto;margin-bottom:var(--spacing-md);border-radius:var(--radius-md);background:var(--bgPrimary);padding:var(--spacing-md)}.inscription-preview-meta{display:flex;flex-direction:column;gap:var(--spacing-sm);font-size:var(--fontSize-sm);color:var(--textMuted)}.meta-item{display:flex;gap:var(--spacing-xs);align-items:baseline}.meta-label{color:var(--textMuted);font-weight:var(--fontWeight-medium)}.meta-value{color:var(--textSecondary);font-family:var(--fontFamily-mono)}.inscription-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px;margin-top:var(--spacing-lg);width:100%}@media (max-width: 768px){.inscription-grid{grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:8px}}@media (max-width: 480px){.inscription-grid{grid-template-columns:repeat(2,1fr);gap:6px}}.btn-primary-purple{background:var(--gradientButton);color:#fff;border:none;padding:var(--spacing-md) var(--spacing-xl);border-radius:var(--radius-md);font-weight:var(--fontWeight-semibold);font-size:var(--fontSize-base);cursor:pointer;transition:var(--transition-normal);box-shadow:var(--shadowPurple);display:inline-flex;align-items:center;gap:var(--spacing-sm)}.btn-primary-purple:hover{background:var(--gradientButtonHover);box-shadow:var(--glowPurple);transform:translateY(-2px)}.btn-primary-purple:active{transform:translateY(0)}.btn-primary-purple:disabled{opacity:.5;cursor:not-allowed;transform:none}.btn-secondary{background:var(--bgTertiary);color:var(--textPrimary);border:1px solid var(--borderMedium);padding:var(--spacing-md) var(--spacing-xl);border-radius:var(--radius-md);font-weight:var(--fontWeight-medium);font-size:var(--fontSize-base);cursor:pointer;transition:var(--transition-normal)}.btn-secondary:hover{border-color:var(--borderBright);background:var(--bgQuaternary)}.btn-icon{background:transparent;border:none;color:var(--textSecondary);cursor:pointer;padding:var(--spacing-sm);border-radius:var(--radius-md);transition:var(--transition-fast);display:inline-flex;align-items:center;justify-content:center}.btn-icon:hover{color:var(--textPrimary);background:var(--bgTertiary)}.step-indicator{display:flex;gap:var(--spacing-md);padding:var(--spacing-lg);background:var(--bgSecondary);border-radius:var(--radius-lg);margin-bottom:var(--spacing-xl)}.step-item{flex:1;text-align:center;padding:var(--spacing-lg);border-radius:var(--radius-md);background:var(--bgTertiary);border:2px solid var(--borderSubtle);transition:var(--transition-normal);cursor:pointer}.step-item.active{background:var(--gradientPurpleDeep);border-color:var(--accentPurple);box-shadow:var(--shadowPurple)}.step-item.completed{border-color:var(--accentCyan);background:#06b6d41a}.step-emoji{font-size:var(--fontSize-3xl);display:block;margin-bottom:var(--spacing-sm)}.step-title{font-weight:var(--fontWeight-semibold);color:var(--textPrimary);margin-bottom:var(--spacing-xs)}.step-description{font-size:var(--fontSize-sm);color:var(--textMuted)}.validation-warning{background:var(--warningBg);border:1px solid var(--accentAmber);border-radius:var(--radius-md);padding:var(--spacing-md);color:var(--accentAmber);margin:var(--spacing-sm) 0;display:flex;align-items:flex-start;gap:var(--spacing-sm)}.validation-error{background:var(--errorBg);border:1px solid var(--accentRed);border-radius:var(--radius-md);padding:var(--spacing-md);color:var(--accentRed);margin:var(--spacing-sm) 0;display:flex;align-items:flex-start;gap:var(--spacing-sm)}.validation-success{background:var(--successBg);border:1px solid var(--accentGreen);border-radius:var(--radius-md);padding:var(--spacing-md);color:var(--accentGreen);margin:var(--spacing-sm) 0;display:flex;align-items:flex-start;gap:var(--spacing-sm)}.validation-info{background:var(--infoBg);border:1px solid var(--accentCyan);border-radius:var(--radius-md);padding:var(--spacing-md);color:var(--accentCyan);margin:var(--spacing-sm) 0;display:flex;align-items:flex-start;gap:var(--spacing-sm)}.form-label{display:block;margin-bottom:var(--spacing-sm);font-weight:var(--fontWeight-medium);color:var(--textPrimary);font-size:var(--fontSize-sm)}.form-input{width:100%;background:var(--inputBg);border:1px solid var(--inputBorder);border-radius:var(--radius-md);padding:var(--spacing-md);color:var(--textPrimary);font-size:var(--fontSize-base);font-family:var(--fontFamily-mono);transition:var(--transition-fast)}.form-input:focus{outline:none;border-color:var(--inputFocus);box-shadow:0 0 0 3px #a855f733}.form-input::-moz-placeholder{color:var(--textMuted)}.form-input::placeholder{color:var(--textMuted)}.form-textarea{min-height:120px;resize:vertical;font-family:var(--fontFamily-mono);direction:ltr!important;unicode-bidi:plaintext;text-align:left}input,textarea,select,[contenteditable]{direction:ltr;unicode-bidi:plaintext;text-align:left}.form-select{width:100%;background:var(--inputBg);border:1px solid var(--inputBorder);border-radius:var(--radius-md);padding:var(--spacing-md);color:var(--textPrimary);font-size:var(--fontSize-base);cursor:pointer;transition:var(--transition-fast)}.form-select:focus{outline:none;border-color:var(--inputFocus);box-shadow:0 0 0 3px #a855f733}.feature-chips{display:flex;flex-wrap:wrap;gap:var(--spacing-sm);margin-top:var(--spacing-md)}.feature-chip{background:var(--bgTertiary);border:1px solid var(--borderMedium);border-radius:var(--radius-round);padding:var(--spacing-xs) var(--spacing-md);font-size:var(--fontSize-sm);color:var(--textSecondary);display:inline-flex;align-items:center;gap:var(--spacing-xs);transition:var(--transition-fast)}.feature-chip:hover{border-color:var(--borderBright);background:var(--bgQuaternary)}.feature-chip-active{background:var(--gradientPurpleDeep);border-color:var(--accentPurple);color:var(--textPrimary)}.toggle-switch{display:flex;align-items:center;gap:var(--spacing-md);cursor:pointer;-webkit-user-select:none;-moz-user-select:none;user-select:none}.toggle-track{width:44px;height:24px;background:var(--bgTertiary);border:1px solid var(--borderMedium);border-radius:var(--radius-round);position:relative;transition:var(--transition-fast)}.toggle-track.active{background:var(--gradientPurplePink);border-color:var(--accentPurple)}.toggle-thumb{width:18px;height:18px;background:#fff;border-radius:50%;position:absolute;top:2px;left:2px;transition:var(--transition-fast);box-shadow:0 2px 4px #0003}.toggle-track.active .toggle-thumb{left:22px}.toggle-advanced{background:transparent;border:none;color:var(--accentPurple);font-weight:var(--fontWeight-semibold);cursor:pointer;display:flex;align-items:center;gap:var(--spacing-sm);padding:var(--spacing-md);transition:var(--transition-fast)}.toggle-advanced:hover{color:var(--accentPink)}.advanced-section{margin-top:var(--spacing-lg);padding:var(--spacing-lg);background:var(--bgSecondary);border:1px solid var(--borderMedium);border-radius:var(--radius-lg)}.advanced-section-title{font-weight:var(--fontWeight-semibold);color:var(--textPrimary);margin-bottom:var(--spacing-md);display:flex;align-items:center;gap:var(--spacing-sm)}.fee-breakdown{background:var(--bgSecondary);border:1px solid var(--borderMedium);border-radius:var(--radius-lg);padding:var(--spacing-lg)}.fee-item{display:flex;justify-content:space-between;padding:var(--spacing-sm) 0;color:var(--textSecondary)}.fee-item-label{font-weight:var(--fontWeight-medium)}.fee-item-value{font-family:var(--fontFamily-mono);color:var(--textPrimary)}.fee-divider{border-top:1px solid var(--borderSubtle);margin:var(--spacing-md) 0}.fee-total{font-size:var(--fontSize-lg);font-weight:var(--fontWeight-bold);color:var(--accentPurple)}.tooltip{position:relative;display:inline-block}.tooltip-text{visibility:hidden;background:var(--tooltipBg);color:var(--textPrimary);text-align:center;border-radius:var(--radius-md);padding:var(--spacing-sm) var(--spacing-md);position:absolute;z-index:var(--zIndex-tooltip);bottom:125%;left:50%;transform:translate(-50%);white-space:nowrap;font-size:var(--fontSize-sm);border:1px solid var(--borderMedium);box-shadow:var(--shadowPurple);opacity:0;transition:var(--transition-fast)}.tooltip:hover .tooltip-text{visibility:visible;opacity:1}.spinner{width:40px;height:40px;border:3px solid var(--borderMedium);border-top-color:var(--accentPurple);border-radius:50%;animation:spin .8s linear infinite}.inscription-container ::-webkit-scrollbar{width:10px;height:10px}.inscription-container ::-webkit-scrollbar-track{background:var(--bgSecondary);border-radius:var(--radius-md)}.inscription-container ::-webkit-scrollbar-thumb{background:var(--primaryMedium);border-radius:var(--radius-md)}.inscription-container ::-webkit-scrollbar-thumb:hover{background:var(--primaryLight)}@media (max-width: 768px){.inscription-container{padding:var(--spacing-sm)}.inscription-card{padding:var(--spacing-sm);border-radius:var(--radius-md)}}@media (max-width: 480px){.inscription-container{padding:var(--spacing-xs)}.step-indicator{flex-direction:column;gap:var(--spacing-sm);padding:var(--spacing-sm)}.inscription-card{padding:var(--spacing-xs);border-radius:var(--radius-sm)}.inscription-preview-content{max-height:200px}}@keyframes fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}@keyframes pulse{0%,to{opacity:1}50%{opacity:.5}}.fade-in{animation:fadeIn .3s ease}.pulse{animation:pulse 2s ease-in-out infinite}.nexus-wizard-card{position:relative;border-radius:14px;overflow:hidden;background:#0803128c;border:1px solid rgba(168,85,247,.18);box-shadow:0 0 0 1px #00000059 inset,0 12px 30px #00000073;transform:var(--nexus-cf-transform, none);will-change:transform,box-shadow;transition:transform .18s ease,border-color .16s ease,box-shadow .22s ease}.nexus-wizard-card--clickable{cursor:pointer}.nexus-wizard-card:before{content:"";position:absolute;inset:-1px;border-radius:inherit;pointer-events:none;opacity:0;transition:opacity .22s ease;background:radial-gradient(160px 160px at 0% 0%,rgba(168,85,247,.38),transparent 60%),radial-gradient(160px 160px at 100% 0%,rgba(236,72,153,.3),transparent 62%),radial-gradient(180px 180px at 0% 100%,rgba(59,130,246,.22),transparent 62%),radial-gradient(180px 180px at 100% 100%,rgba(168,85,247,.3),transparent 62%);mix-blend-mode:screen}.nexus-wizard-card:hover{border-color:#a855f752;box-shadow:0 0 0 1px #a855f729 inset,0 16px 40px #0000008c;transform:var(--nexus-cf-transform, none) translateY(-2px)}.nexus-wizard-card:hover:before{opacity:1}.nexus-review-batch{display:flex;flex-direction:column;gap:10px}.nexus-review-batch__bar{padding:8px 14px;background:#08031266;border:1px solid rgba(168,85,247,.18);border-radius:12px;display:flex;justify-content:center;align-items:center;gap:10px;box-shadow:0 10px 22px #00000059}.nexus-review-batch__title{font-size:14px;font-weight:700;color:var(--textPrimary)}.nexus-review-batch__count{font-size:11px;color:var(--textMuted)}.nexus-review-batch__status{padding:3px 8px;background:#22c55e24;color:#4ade80;border-radius:999px;font-size:10px;font-weight:700;border:1px solid rgba(34,197,94,.28)}.nexus-review-list{display:flex;flex-direction:column;gap:10px}.nexus-review-item{border-radius:14px;overflow:hidden;background:#08031259;border:1px solid rgba(168,85,247,.18);box-shadow:0 12px 26px #0006;transition:transform .16s ease,border-color .16s ease,box-shadow .22s ease}.nexus-review-item:hover{border-color:#a855f752;box-shadow:0 16px 38px #0000008c;transform:translateY(-2px)}.nexus-review-item__row{display:flex;align-items:stretch}.nexus-review-item__left{flex:1;min-width:0;padding:10px 12px 12px;display:flex;flex-direction:column}.nexus-review-item__head{display:flex;align-items:flex-start;gap:10px}.nexus-review-item__index{flex-shrink:0;font-size:10px;font-family:var(--fontFamily-mono);color:var(--textMuted);background:#a855f71a;border:1px solid rgba(168,85,247,.2);border-radius:999px;padding:2px 7px;line-height:1.4}.nexus-review-item__meta{flex:1;min-width:0}.nexus-review-item__title{font-size:13px;font-weight:700;color:var(--textPrimary);line-height:1.2;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.nexus-review-item__title--mono{font-family:var(--fontFamily-mono);font-size:12px;font-weight:700}.nexus-review-item__sub{margin-top:3px;font-size:11px;color:var(--textMuted);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.nexus-review-item__remove{flex-shrink:0;padding:4px 7px;background:#ef44441a;border:1px solid rgba(239,68,68,.3);border-radius:8px;color:#f87171;font-size:12px;cursor:pointer;line-height:1;transition:transform .12s ease,background .14s ease,border-color .14s ease}.nexus-review-item__remove:hover{transform:translateY(-1px);background:#ef444429;border-color:#ef44446b}.nexus-review-item__features{margin-top:8px;display:flex;flex-wrap:wrap;gap:6px}.nexus-review-item__chip{font-size:10px;padding:2px 8px;background:#a855f71f;color:#e9d5ff;border-radius:999px;border:1px solid rgba(168,85,247,.22)}.nexus-review-item__controls{margin-top:auto;padding-top:10px;border-top:1px solid rgba(168,85,247,.1);display:flex;flex-direction:column;gap:8px}.nexus-review-item__controlsRow{display:flex;align-items:center;gap:8px;flex-wrap:wrap}.nexus-review-item__controlsLabel,.nexus-review-item__controlsUnit{font-size:10px;color:var(--textMuted)}.nexus-review-item__controlsCheck{display:inline-flex;align-items:center;gap:6px;padding:2px 8px;border-radius:999px;border:1px solid rgba(168,85,247,.18);background:#a855f714;font-size:10px;color:var(--textPrimary);cursor:pointer;-webkit-user-select:none;-moz-user-select:none;user-select:none}.nexus-review-item__controlsCheck--disabled{opacity:.55;cursor:not-allowed}.nexus-review-input{padding:5px 8px;background:#00000047;border:1px solid rgba(168,85,247,.22);border-radius:10px;color:var(--textPrimary);font-size:11px;font-family:var(--fontFamily-mono);outline:none}.nexus-review-input:focus{border-color:#a855f780;box-shadow:0 0 0 2px #a855f71f}.nexus-review-input--postage{width:84px}.nexus-review-input--dest{width:100%}.nexus-review-item__preview{width:min(320px,42%);flex-shrink:0;aspect-ratio:1 / 1;border-left:1px solid rgba(168,85,247,.18);background:#0000001f;display:flex;align-items:stretch;justify-content:stretch;overflow:hidden}.placeholder\:text-neutral-500::-moz-placeholder{--tw-text-opacity: 1;color:rgb(115 115 115 / var(--tw-text-opacity, 1))}.placeholder\:text-neutral-500::placeholder{--tw-text-opacity: 1;color:rgb(115 115 115 / var(--tw-text-opacity, 1))}.first\:border-t-0:first-child{border-top-width:0px}.last\:border-b-0:last-child{border-bottom-width:0px}.focus-within\:ring-2:focus-within{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.focus-within\:ring-sky-500\/30:focus-within{--tw-ring-color: rgb(14 165 233 / .3)}.focus-within\:ring-offset-0:focus-within{--tw-ring-offset-width: 0px}.hover\:-translate-y-0\.5:hover{--tw-translate-y: -.125rem;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.hover\:translate-y-\[-1px\]:hover{--tw-translate-y: -1px;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.hover\:scale-\[1\.02\]:hover{--tw-scale-x: 1.02;--tw-scale-y: 1.02;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.hover\:border-amber-500\/40:hover{border-color:#f59e0b66}.hover\:border-emerald-500\/40:hover{border-color:#10b98166}.hover\:border-fuchsia-500\/40:hover{border-color:#d946ef66}.hover\:border-green-500\/40:hover{border-color:#22c55e66}.hover\:border-indigo-500\/40:hover{border-color:#6366f166}.hover\:border-neutral-600\/60:hover{border-color:#52525299}.hover\:border-neutral-700:hover{--tw-border-opacity: 1;border-color:rgb(64 64 64 / var(--tw-border-opacity, 1))}.hover\:border-neutral-700\/60:hover{border-color:#40404099}.hover\:border-purple-500\/40:hover{border-color:#a855f766}.hover\:border-purple-500\/60:hover{border-color:#a855f799}.hover\:border-red-500\/60:hover{border-color:#ef444499}.hover\:border-sky-500\/25:hover{border-color:#0ea5e940}.hover\:border-sky-500\/40:hover{border-color:#0ea5e966}.hover\:border-teal-500\/40:hover{border-color:#14b8a666}.hover\:border-white\/10:hover{border-color:#ffffff1a}.hover\:bg-amber-400:hover{--tw-bg-opacity: 1;background-color:rgb(251 191 36 / var(--tw-bg-opacity, 1))}.hover\:bg-amber-500\/30:hover{background-color:#f59e0b4d}.hover\:bg-amber-500\/5:hover{background-color:#f59e0b0d}.hover\:bg-amber-700:hover{--tw-bg-opacity: 1;background-color:rgb(180 83 9 / var(--tw-bg-opacity, 1))}.hover\:bg-black\/70:hover{background-color:#000000b3}.hover\:bg-blue-900\/50:hover{background-color:#1e3a8a80}.hover\:bg-emerald-400:hover{--tw-bg-opacity: 1;background-color:rgb(52 211 153 / var(--tw-bg-opacity, 1))}.hover\:bg-emerald-500\/5:hover{background-color:#10b9810d}.hover\:bg-fuchsia-500\/20:hover{background-color:#d946ef33}.hover\:bg-fuchsia-500\/5:hover{background-color:#d946ef0d}.hover\:bg-gray-500:hover{--tw-bg-opacity: 1;background-color:rgb(107 114 128 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-600:hover{--tw-bg-opacity: 1;background-color:rgb(75 85 99 / var(--tw-bg-opacity, 1))}.hover\:bg-green-500:hover{--tw-bg-opacity: 1;background-color:rgb(34 197 94 / var(--tw-bg-opacity, 1))}.hover\:bg-green-500\/25:hover{background-color:#22c55e40}.hover\:bg-green-500\/5:hover{background-color:#22c55e0d}.hover\:bg-green-600\/30:hover{background-color:#16a34a4d}.hover\:bg-green-700:hover{--tw-bg-opacity: 1;background-color:rgb(21 128 61 / var(--tw-bg-opacity, 1))}.hover\:bg-indigo-500\/5:hover{background-color:#6366f10d}.hover\:bg-neutral-700:hover{--tw-bg-opacity: 1;background-color:rgb(64 64 64 / var(--tw-bg-opacity, 1))}.hover\:bg-neutral-700\/50:hover{background-color:#40404080}.hover\:bg-neutral-700\/60:hover{background-color:#40404099}.hover\:bg-neutral-800:hover{--tw-bg-opacity: 1;background-color:rgb(38 38 38 / var(--tw-bg-opacity, 1))}.hover\:bg-neutral-800\/20:hover{background-color:#26262633}.hover\:bg-neutral-800\/40:hover{background-color:#26262666}.hover\:bg-neutral-800\/60:hover{background-color:#26262699}.hover\:bg-neutral-800\/90:hover{background-color:#262626e6}.hover\:bg-neutral-900\/60:hover{background-color:#17171799}.hover\:bg-neutral-900\/70:hover{background-color:#171717b3}.hover\:bg-orange-700:hover{--tw-bg-opacity: 1;background-color:rgb(194 65 12 / var(--tw-bg-opacity, 1))}.hover\:bg-purple-400:hover{--tw-bg-opacity: 1;background-color:rgb(192 132 252 / var(--tw-bg-opacity, 1))}.hover\:bg-purple-500:hover{--tw-bg-opacity: 1;background-color:rgb(168 85 247 / var(--tw-bg-opacity, 1))}.hover\:bg-purple-500\/10:hover{background-color:#a855f71a}.hover\:bg-purple-500\/20:hover{background-color:#a855f733}.hover\:bg-purple-500\/25:hover{background-color:#a855f740}.hover\:bg-purple-500\/5:hover{background-color:#a855f70d}.hover\:bg-purple-500\/80:hover{background-color:#a855f7cc}.hover\:bg-purple-600\/40:hover{background-color:#9333ea66}.hover\:bg-purple-700:hover{--tw-bg-opacity: 1;background-color:rgb(126 34 206 / var(--tw-bg-opacity, 1))}.hover\:bg-purple-900\/50:hover{background-color:#581c8780}.hover\:bg-red-500\/10:hover{background-color:#ef44441a}.hover\:bg-red-500\/20:hover{background-color:#ef444433}.hover\:bg-sky-500\/5:hover{background-color:#0ea5e90d}.hover\:bg-teal-500:hover{--tw-bg-opacity: 1;background-color:rgb(20 184 166 / var(--tw-bg-opacity, 1))}.hover\:bg-teal-500\/5:hover{background-color:#14b8a60d}.hover\:from-cyan-500\/25:hover{--tw-gradient-from: rgb(6 182 212 / .25) var(--tw-gradient-from-position);--tw-gradient-to: rgb(6 182 212 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.hover\:from-purple-500:hover{--tw-gradient-from: #a855f7 var(--tw-gradient-from-position);--tw-gradient-to: rgb(168 85 247 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.hover\:from-purple-600:hover{--tw-gradient-from: #9333ea var(--tw-gradient-from-position);--tw-gradient-to: rgb(147 51 234 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.hover\:via-purple-500\/25:hover{--tw-gradient-to: rgb(168 85 247 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), rgb(168 85 247 / .25) var(--tw-gradient-via-position), var(--tw-gradient-to)}.hover\:to-indigo-500:hover{--tw-gradient-to: #6366f1 var(--tw-gradient-to-position)}.hover\:to-pink-500\/25:hover{--tw-gradient-to: rgb(236 72 153 / .25) var(--tw-gradient-to-position)}.hover\:to-pink-600:hover{--tw-gradient-to: #db2777 var(--tw-gradient-to-position)}.hover\:text-blue-300:hover{--tw-text-opacity: 1;color:rgb(147 197 253 / var(--tw-text-opacity, 1))}.hover\:text-neutral-100:hover{--tw-text-opacity: 1;color:rgb(245 245 245 / var(--tw-text-opacity, 1))}.hover\:text-neutral-200:hover{--tw-text-opacity: 1;color:rgb(229 229 229 / var(--tw-text-opacity, 1))}.hover\:text-neutral-300:hover{--tw-text-opacity: 1;color:rgb(212 212 212 / var(--tw-text-opacity, 1))}.hover\:text-purple-100:hover{--tw-text-opacity: 1;color:rgb(243 232 255 / var(--tw-text-opacity, 1))}.hover\:text-purple-200:hover{--tw-text-opacity: 1;color:rgb(233 213 255 / var(--tw-text-opacity, 1))}.hover\:text-purple-300:hover{--tw-text-opacity: 1;color:rgb(216 180 254 / var(--tw-text-opacity, 1))}.hover\:text-red-200:hover{--tw-text-opacity: 1;color:rgb(254 202 202 / var(--tw-text-opacity, 1))}.hover\:text-red-300:hover{--tw-text-opacity: 1;color:rgb(252 165 165 / var(--tw-text-opacity, 1))}.hover\:text-sky-100:hover{--tw-text-opacity: 1;color:rgb(224 242 254 / var(--tw-text-opacity, 1))}.hover\:text-sky-200:hover{--tw-text-opacity: 1;color:rgb(186 230 253 / var(--tw-text-opacity, 1))}.hover\:text-sky-300:hover{--tw-text-opacity: 1;color:rgb(125 211 252 / var(--tw-text-opacity, 1))}.hover\:text-white:hover{--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.hover\:shadow-xl:hover{--tw-shadow: 0 20px 25px -5px rgb(0 0 0 / .1), 0 8px 10px -6px rgb(0 0 0 / .1);--tw-shadow-colored: 0 20px 25px -5px var(--tw-shadow-color), 0 8px 10px -6px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.hover\:shadow-purple-500\/50:hover{--tw-shadow-color: rgb(168 85 247 / .5);--tw-shadow: var(--tw-shadow-colored)}.hover\:ring-purple-400\/60:hover{--tw-ring-color: rgb(192 132 252 / .6)}.hover\:ring-red-500\/20:hover{--tw-ring-color: rgb(239 68 68 / .2)}.hover\:ring-sky-500\/25:hover{--tw-ring-color: rgb(14 165 233 / .25)}.focus\:border-amber-500:focus{--tw-border-opacity: 1;border-color:rgb(245 158 11 / var(--tw-border-opacity, 1))}.focus\:border-fuchsia-500:focus{--tw-border-opacity: 1;border-color:rgb(217 70 239 / var(--tw-border-opacity, 1))}.focus\:border-orange-400\/60:focus{border-color:#fb923c99}.focus\:border-purple-500\/40:focus{border-color:#a855f766}.focus\:border-purple-500\/60:focus{border-color:#a855f799}.focus\:border-sky-500\/60:focus{border-color:#0ea5e999}.focus\:border-yellow-500\/60:focus{border-color:#eab30899}.focus\:outline-none:focus{outline:2px solid transparent;outline-offset:2px}.focus\:ring-1:focus{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.focus\:ring-2:focus{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.focus\:ring-amber-500:focus{--tw-ring-opacity: 1;--tw-ring-color: rgb(245 158 11 / var(--tw-ring-opacity, 1))}.focus\:ring-fuchsia-500:focus{--tw-ring-opacity: 1;--tw-ring-color: rgb(217 70 239 / var(--tw-ring-opacity, 1))}.focus\:ring-purple-400\/30:focus{--tw-ring-color: rgb(192 132 252 / .3)}.focus\:ring-purple-500\/20:focus{--tw-ring-color: rgb(168 85 247 / .2)}.focus\:ring-sky-500\/20:focus{--tw-ring-color: rgb(14 165 233 / .2)}.focus\:ring-sky-500\/30:focus{--tw-ring-color: rgb(14 165 233 / .3)}.focus-visible\:outline-none:focus-visible{outline:2px solid transparent;outline-offset:2px}.focus-visible\:ring-2:focus-visible{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.focus-visible\:ring-amber-500\/40:focus-visible{--tw-ring-color: rgb(245 158 11 / .4)}.focus-visible\:ring-emerald-500\/40:focus-visible{--tw-ring-color: rgb(16 185 129 / .4)}.focus-visible\:ring-fuchsia-500\/40:focus-visible{--tw-ring-color: rgb(217 70 239 / .4)}.focus-visible\:ring-green-500\/40:focus-visible{--tw-ring-color: rgb(34 197 94 / .4)}.focus-visible\:ring-indigo-500\/40:focus-visible{--tw-ring-color: rgb(99 102 241 / .4)}.focus-visible\:ring-purple-500\/40:focus-visible{--tw-ring-color: rgb(168 85 247 / .4)}.focus-visible\:ring-sky-500\/40:focus-visible{--tw-ring-color: rgb(14 165 233 / .4)}.focus-visible\:ring-teal-500\/40:focus-visible{--tw-ring-color: rgb(20 184 166 / .4)}.active\:translate-y-\[1px\]:active{--tw-translate-y: 1px;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.active\:scale-95:active{--tw-scale-x: .95;--tw-scale-y: .95;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.active\:scale-\[0\.97\]:active{--tw-scale-x: .97;--tw-scale-y: .97;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.active\:scale-\[0\.98\]:active{--tw-scale-x: .98;--tw-scale-y: .98;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.active\:bg-green-600\/40:active{background-color:#16a34a66}.active\:bg-neutral-700:active{--tw-bg-opacity: 1;background-color:rgb(64 64 64 / var(--tw-bg-opacity, 1))}.active\:bg-neutral-900\/60:active{background-color:#17171799}.active\:bg-purple-500\/15:active{background-color:#a855f726}.active\:bg-purple-600\/50:active{background-color:#9333ea80}.active\:bg-purple-700:active{--tw-bg-opacity: 1;background-color:rgb(126 34 206 / var(--tw-bg-opacity, 1))}.active\:from-purple-700:active{--tw-gradient-from: #7e22ce var(--tw-gradient-from-position);--tw-gradient-to: rgb(126 34 206 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.active\:to-pink-700:active{--tw-gradient-to: #be185d var(--tw-gradient-to-position)}.active\:text-neutral-100:active{--tw-text-opacity: 1;color:rgb(245 245 245 / var(--tw-text-opacity, 1))}.active\:text-neutral-200:active{--tw-text-opacity: 1;color:rgb(229 229 229 / var(--tw-text-opacity, 1))}.active\:text-purple-300:active{--tw-text-opacity: 1;color:rgb(216 180 254 / var(--tw-text-opacity, 1))}.disabled\:cursor-not-allowed:disabled{cursor:not-allowed}.disabled\:opacity-40:disabled{opacity:.4}.disabled\:opacity-50:disabled{opacity:.5}.disabled\:opacity-60:disabled{opacity:.6}.group\/search:focus-within .group-focus-within\/search\:text-purple-400{--tw-text-opacity: 1;color:rgb(192 132 252 / var(--tw-text-opacity, 1))}.group:focus-within .group-focus-within\:opacity-100{opacity:1}.group:hover .group-hover\:text-amber-200{--tw-text-opacity: 1;color:rgb(253 230 138 / var(--tw-text-opacity, 1))}.group:hover .group-hover\:text-emerald-200{--tw-text-opacity: 1;color:rgb(167 243 208 / var(--tw-text-opacity, 1))}.group:hover .group-hover\:text-fuchsia-200{--tw-text-opacity: 1;color:rgb(245 208 254 / var(--tw-text-opacity, 1))}.group:hover .group-hover\:text-green-200{--tw-text-opacity: 1;color:rgb(187 247 208 / var(--tw-text-opacity, 1))}.group:hover .group-hover\:text-indigo-200{--tw-text-opacity: 1;color:rgb(199 210 254 / var(--tw-text-opacity, 1))}.group:hover .group-hover\:text-neutral-100{--tw-text-opacity: 1;color:rgb(245 245 245 / var(--tw-text-opacity, 1))}.group:hover .group-hover\:text-purple-200{--tw-text-opacity: 1;color:rgb(233 213 255 / var(--tw-text-opacity, 1))}.group:hover .group-hover\:text-sky-200{--tw-text-opacity: 1;color:rgb(186 230 253 / var(--tw-text-opacity, 1))}.group:hover .group-hover\:text-teal-200{--tw-text-opacity: 1;color:rgb(153 246 228 / var(--tw-text-opacity, 1))}.group:hover .group-hover\:text-white{--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.group:hover .group-hover\:opacity-100{opacity:1}.group:hover .group-hover\:ring-sky-500\/25{--tw-ring-color: rgb(14 165 233 / .25)}@media not all and (min-width: 1024px){.max-lg\:hidden{display:none}.max-lg\:auto-rows-auto{grid-auto-rows:auto}.max-lg\:auto-rows-fr{grid-auto-rows:minmax(0,1fr)}.max-lg\:pb-14{padding-bottom:3.5rem}}@media not all and (min-width: 640px){.max-sm\:pointer-events-none{pointer-events:none}.max-sm\:h-0{height:0px}.max-sm\:-translate-y-full{--tw-translate-y: -100%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.max-sm\:overflow-hidden{overflow:hidden}.max-sm\:opacity-0{opacity:0}}@media (min-width: 640px){.sm\:sticky{position:sticky}.sm\:left-1{left:.25rem}.sm\:left-5{left:1.25rem}.sm\:right-5{right:1.25rem}.sm\:top-0{top:0}.sm\:top-1{top:.25rem}.sm\:top-20{top:5rem}.sm\:col-span-2{grid-column:span 2 / span 2}.sm\:mx-0{margin-left:0;margin-right:0}.sm\:mx-4{margin-left:1rem;margin-right:1rem}.sm\:mb-2{margin-bottom:.5rem}.sm\:mt-2{margin-top:.5rem}.sm\:line-clamp-3{overflow:hidden;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:3}.sm\:block{display:block}.sm\:inline{display:inline}.sm\:flex{display:flex}.sm\:inline-flex{display:inline-flex}.sm\:hidden{display:none}.sm\:h-10{height:2.5rem}.sm\:h-12{height:3rem}.sm\:h-16{height:4rem}.sm\:h-24{height:6rem}.sm\:h-3\.5{height:.875rem}.sm\:h-4{height:1rem}.sm\:h-6{height:1.5rem}.sm\:h-7{height:1.75rem}.sm\:h-9{height:2.25rem}.sm\:min-h-\[44px\]{min-height:44px}.sm\:w-10{width:2.5rem}.sm\:w-12{width:3rem}.sm\:w-16{width:4rem}.sm\:w-24{width:6rem}.sm\:w-3\.5{width:.875rem}.sm\:w-32{width:8rem}.sm\:w-4{width:1rem}.sm\:w-6{width:1.5rem}.sm\:w-7{width:1.75rem}.sm\:w-9{width:2.25rem}.sm\:w-\[100px\]{width:100px}.sm\:w-\[200px\]{width:200px}.sm\:w-\[98vw\]{width:98vw}.sm\:w-auto{width:auto}.sm\:min-w-\[44px\]{min-width:44px}.sm\:max-w-\[160px\]{max-width:160px}.sm\:max-w-\[280px\]{max-width:280px}.sm\:max-w-\[600px\]{max-width:600px}.sm\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.sm\:grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.sm\:grid-cols-\[200px_1fr\]{grid-template-columns:200px 1fr}.sm\:flex-row{flex-direction:row}.sm\:items-center{align-items:center}.sm\:gap-1{gap:.25rem}.sm\:gap-1\.5{gap:.375rem}.sm\:gap-2{gap:.5rem}.sm\:gap-2\.5{gap:.625rem}.sm\:gap-3{gap:.75rem}.sm\:gap-4{gap:1rem}.sm\:rounded-2xl{border-radius:1rem}.sm\:rounded-lg{border-radius:.5rem}.sm\:rounded-md{border-radius:.375rem}.sm\:rounded-b-2xl{border-bottom-right-radius:1rem;border-bottom-left-radius:1rem}.sm\:border{border-width:1px}.sm\:p-3{padding:.75rem}.sm\:p-4{padding:1rem}.sm\:p-6{padding:1.5rem}.sm\:px-1\.5{padding-left:.375rem;padding-right:.375rem}.sm\:px-2{padding-left:.5rem;padding-right:.5rem}.sm\:px-2\.5{padding-left:.625rem;padding-right:.625rem}.sm\:px-3{padding-left:.75rem;padding-right:.75rem}.sm\:px-4{padding-left:1rem;padding-right:1rem}.sm\:px-6{padding-left:1.5rem;padding-right:1.5rem}.sm\:py-0{padding-top:0;padding-bottom:0}.sm\:py-1{padding-top:.25rem;padding-bottom:.25rem}.sm\:py-1\.5{padding-top:.375rem;padding-bottom:.375rem}.sm\:py-2{padding-top:.5rem;padding-bottom:.5rem}.sm\:py-2\.5{padding-top:.625rem;padding-bottom:.625rem}.sm\:py-3{padding-top:.75rem;padding-bottom:.75rem}.sm\:py-4{padding-top:1rem;padding-bottom:1rem}.sm\:pb-3{padding-bottom:.75rem}.sm\:pb-4{padding-bottom:1rem}.sm\:pb-6{padding-bottom:1.5rem}.sm\:text-\[10px\]{font-size:10px}.sm\:text-\[11px\]{font-size:11px}.sm\:text-\[14px\]{font-size:14px}.sm\:text-\[8px\]{font-size:8px}.sm\:text-\[9px\]{font-size:9px}.sm\:text-base{font-size:1rem;line-height:1.5rem}.sm\:text-lg{font-size:1.125rem;line-height:1.75rem}.sm\:text-sm{font-size:.875rem;line-height:1.25rem}.sm\:text-xl{font-size:1.25rem;line-height:1.75rem}.sm\:text-xs{font-size:.75rem;line-height:1rem}.sm\:leading-relaxed{line-height:1.625}}@media (min-width: 768px){.md\:col-span-2{grid-column:span 2 / span 2}.md\:-mx-0{margin-left:-0px;margin-right:-0px}.md\:mx-0{margin-left:0;margin-right:0}.md\:inline{display:inline}.md\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.md\:grid-cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}.md\:grid-cols-\[minmax\(0\,520px\)_minmax\(0\,600px\)\]{grid-template-columns:minmax(0,520px) minmax(0,600px)}.md\:grid-cols-\[minmax\(260px\,520px\)_1fr\]{grid-template-columns:minmax(260px,520px) 1fr}.md\:gap-4{gap:1rem}.md\:p-4{padding:1rem}.md\:px-4{padding-left:1rem;padding-right:1rem}}@media (min-width: 1024px){.lg\:hidden{display:none}.lg\:auto-rows-fr{grid-auto-rows:minmax(0,1fr)}.lg\:grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.lg\:grid-cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}.lg\:grid-cols-5{grid-template-columns:repeat(5,minmax(0,1fr))}.lg\:grid-cols-6{grid-template-columns:repeat(6,minmax(0,1fr))}.lg\:grid-cols-\[minmax\(0\,2fr\)_minmax\(0\,1fr\)\]{grid-template-columns:minmax(0,2fr) minmax(0,1fr)}.lg\:grid-cols-\[minmax\(0\,2fr\)_minmax\(0\,1fr\)_minmax\(0\,1fr\)\]{grid-template-columns:minmax(0,2fr) minmax(0,1fr) minmax(0,1fr)}}@media not all and (min-width: 1024px){.\[\&\>\*\:nth-child\(1\)\]\:max-lg\:order-2>*:nth-child(1){order:2}.\[\&\>\*\:nth-child\(2\)\]\:max-lg\:order-1>*:nth-child(2){order:1}}:root{--color-bg-light: #f9fafb;--color-card-light: #ffffff;--color-text-light: #111827;--color-text-secondary-light: #6b7280;--color-border-light: #e5e7eb;--color-bg-dark: #14001f;--color-card-dark: rgba(31, 41, 55, .5);--color-text-dark: #ffffff;--color-text-secondary-dark: #9ca3af;--color-border-dark: #374151;--color-purple-600: #9333ea;--color-purple-700: #7e22ce;--color-purple-50: #faf5ff;--color-purple-100: #f3e8ff;--spacing-xs: .5rem;--spacing-sm: .625rem;--spacing-md: .75rem;--spacing-lg: 1rem;--spacing-xl: 1.25rem;--spacing-2xl: 2rem;--radius-sm: 8px;--radius-md: 12px;--radius-lg: 16px;--radius-xl: 24px;--transition-fast: .2s ease;--transition-base: .3s ease}*{box-sizing:border-box;margin:0;padding:0}*{scrollbar-width:none;-ms-overflow-style:none}*::-webkit-scrollbar{display:none}html{overflow-x:hidden;-webkit-text-size-adjust:100%;overscroll-behavior-x:none}body{margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;overflow-x:hidden;padding-left:env(safe-area-inset-left,0px);padding-right:env(safe-area-inset-right,0px);overscroll-behavior-y:contain}button,[role=button],input,select,textarea{-webkit-tap-highlight-color:transparent;touch-action:manipulation}button,[role=button]{min-height:36px}.nexus-wallet-app{min-height:100vh;transition:background-color var(--transition-base),color var(--transition-base)}.nexus-wallet-app.light-theme{background-color:var(--color-bg-light);color:var(--color-text-light)}.nexus-wallet-app.dark-theme{background-color:var(--color-bg-dark);color:var(--color-text-dark)}.top-navigation{position:fixed;top:0;left:0;right:0;z-index:1000;padding:var(--spacing-md) var(--spacing-xl);display:flex;justify-content:space-between;align-items:center;backdrop-filter:blur(10px);transition:all var(--transition-base)}.light-theme .top-navigation{background-color:#ffffffe6;border-bottom:1px solid var(--color-border-light)}.dark-theme .top-navigation{background-color:#14001fe6;border-bottom:1px solid var(--color-border-dark)}.nav-left{display:flex;align-items:center;gap:var(--spacing-md)}.nav-logo{width:40px;height:40px;background:linear-gradient(135deg,var(--color-purple-600),var(--color-purple-700));border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center;font-weight:700;color:#fff;font-size:1.25rem}.nav-title-group{display:flex;flex-direction:column}.nav-title{font-size:1.125rem;font-weight:700;line-height:1.2}.nav-subtitle{font-size:.75rem;font-weight:500;opacity:.6;letter-spacing:.05em}.nav-right{display:flex;align-items:center;gap:var(--spacing-md)}.main-content{max-width:1280px;margin:0 auto;padding:calc(70px + var(--spacing-xl)) var(--spacing-xl) var(--spacing-xl);overflow-x:hidden;width:100%}@media (max-width: 768px){.main-content{padding:calc(70px + var(--spacing-md)) var(--spacing-sm) var(--spacing-sm)}}@media (max-width: 480px){.main-content{padding:calc(70px + var(--spacing-xs)) var(--spacing-xs) var(--spacing-xs)}}.welcome-screen{display:flex;justify-content:center;align-items:center;min-height:calc(100vh - 140px)}.welcome-card{max-width:600px;width:100%;padding:var(--spacing-2xl);border-radius:var(--radius-xl);text-align:center;transition:all var(--transition-base)}.light-theme .welcome-card{background:var(--color-card-light);border:1px solid var(--color-border-light);box-shadow:0 20px 25px -5px #0000001a}.dark-theme .welcome-card{background:var(--color-card-dark);border:1px solid var(--color-border-dark);backdrop-filter:blur(10px)}.welcome-icon{width:80px;height:80px;background:linear-gradient(135deg,var(--color-purple-600),var(--color-purple-700));border-radius:var(--radius-lg);margin:0 auto var(--spacing-xl);display:flex;align-items:center;justify-content:center;font-size:2.5rem}.welcome-heading{font-size:2rem;font-weight:700;margin-bottom:var(--spacing-md)}.welcome-description{font-size:1rem;margin-bottom:var(--spacing-xl);line-height:1.6}.light-theme .welcome-description{color:var(--color-text-secondary-light)}.dark-theme .welcome-description{color:var(--color-text-secondary-dark)}.tab-navigation{padding:var(--spacing-sm);border-radius:var(--radius-lg);margin-bottom:var(--spacing-xl);display:flex;justify-content:space-between;align-items:center;gap:var(--spacing-md);transition:all var(--transition-base)}.light-theme .tab-navigation{background:var(--color-card-light);border:1px solid var(--color-border-light)}.dark-theme .tab-navigation{background:var(--color-card-dark);border:1px solid var(--color-border-dark)}.tab-navigation-left{display:inline-flex;gap:var(--spacing-xs);flex:1}.tab-navigation-right{display:flex;align-items:center}.tab-button{padding:var(--spacing-sm) var(--spacing-lg);border-radius:var(--radius-sm);border:none;background:none;cursor:pointer;font-size:.875rem;font-weight:600;transition:all var(--transition-fast);white-space:nowrap}.light-theme .tab-button{color:var(--color-text-secondary-light)}.dark-theme .tab-button{color:var(--color-text-secondary-dark)}.tab-button:hover{opacity:.7}.tab-button.active{background:var(--color-purple-600);color:#fff}.tab-button:disabled{opacity:.4;cursor:not-allowed}.card{padding:var(--spacing-xl);border-radius:var(--radius-lg);transition:all var(--transition-base)}.light-theme .card{background:var(--color-card-light);border:1px solid var(--color-border-light)}.dark-theme .card{background:var(--color-card-dark);border:1px solid var(--color-border-dark);backdrop-filter:blur(10px)}.card-header{margin-bottom:var(--spacing-lg)}.card-title{font-size:1.25rem;font-weight:700;margin-bottom:var(--spacing-xs)}.card-subtitle{font-size:.875rem}.light-theme .card-subtitle{color:var(--color-text-secondary-light)}.dark-theme .card-subtitle{color:var(--color-text-secondary-dark)}.grid-2col{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:var(--spacing-lg);margin-bottom:var(--spacing-lg)}@media (max-width: 768px){.grid-2col{grid-template-columns:1fr}}.btn{padding:.625rem 1rem;border-radius:var(--radius-sm);border:none;font-size:.875rem;font-weight:600;cursor:pointer;transition:all var(--transition-fast);display:inline-flex;align-items:center;justify-content:center;gap:var(--spacing-xs)}.btn:disabled{opacity:.5;cursor:not-allowed}.btn-primary{background:var(--color-purple-600);color:#fff}.btn-primary:hover:not(:disabled){background:var(--color-purple-700)}.btn-secondary{color:inherit}.light-theme .btn-secondary{background:var(--color-bg-light);border:1px solid var(--color-border-light)}.dark-theme .btn-secondary{background:#4b556380;border:1px solid var(--color-border-dark)}.btn-secondary:hover:not(:disabled){opacity:.8}.btn-large{padding:1rem 2rem;font-size:1rem}.btn-sm{padding:.5rem 1rem;font-size:.875rem}.btn-icon{width:40px;height:40px;padding:0;border-radius:var(--radius-sm)}h1,h2,h3,h4,h5,h6{font-weight:700;line-height:1.2}.text-3xl{font-size:1.875rem}.text-2xl{font-size:1.5rem}.text-xl{font-size:1.25rem}.text-lg{font-size:1.125rem}.text-base{font-size:1rem}.text-sm{font-size:.875rem}.text-xs{font-size:.75rem}.monospace{font-family:Courier New,Courier,monospace}.address-section{margin-bottom:var(--spacing-md)}.address-label{font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;margin-bottom:var(--spacing-xs);opacity:.7}.address-display{padding:var(--spacing-md);border-radius:var(--radius-sm);font-family:Courier New,monospace;font-size:.875rem;word-break:break-all;transition:all var(--transition-base)}.light-theme .address-display{background:var(--color-bg-light);border:1px solid var(--color-border-light);color:var(--color-text-light)}.dark-theme .address-display{background:#0000004d;border:1px solid var(--color-border-dark);color:var(--color-text-dark)}.balance-display{font-size:2rem;font-weight:700;margin:var(--spacing-md) 0}.balance-amount{display:block}.balance-note{font-size:.875rem;font-weight:400;margin-top:var(--spacing-xs);opacity:.7;font-style:italic}.balance-unavailable{color:#f59e0b;font-size:1rem;font-weight:500}.balance-label{font-size:.875rem;font-weight:500;margin-bottom:var(--spacing-xs)}.light-theme .balance-label{color:var(--color-text-secondary-light)}.dark-theme .balance-label{color:var(--color-text-secondary-dark)}.action-buttons{display:flex;gap:var(--spacing-md);margin-top:var(--spacing-lg)}@media (max-width: 640px){.action-buttons{flex-direction:column}.action-buttons .btn{width:100%}}.stat-item{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-md) 0;border-bottom:1px solid}.light-theme .stat-item{border-bottom-color:var(--color-border-light)}.dark-theme .stat-item{border-bottom-color:var(--color-border-dark)}.stat-item:last-child{border-bottom:none}.stat-label{font-size:.875rem;font-weight:500}.light-theme .stat-label{color:var(--color-text-secondary-light)}.dark-theme .stat-label{color:var(--color-text-secondary-dark)}.stat-value{font-size:.875rem;font-weight:600}.inscriptions-list{display:flex;flex-direction:column;gap:var(--spacing-md)}.empty-state{text-align:center;padding:var(--spacing-2xl)}.light-theme .empty-state{color:var(--color-text-secondary-light)}.dark-theme .empty-state{color:var(--color-text-secondary-dark)}.modal-overlay{position:fixed;inset:0;background:#000000d9;backdrop-filter:blur(4px);display:flex;justify-content:center;align-items:center;z-index:2000;padding:var(--spacing-md);padding-bottom:calc(var(--spacing-md) + env(safe-area-inset-bottom,0px))}.modal-card{max-width:448px;width:100%;max-height:90vh;max-height:90dvh;overflow-y:auto;border-radius:var(--radius-lg);transition:all var(--transition-base)}@media (max-width: 480px){.modal-overlay{padding:var(--spacing-xs);align-items:flex-end}.modal-card{max-height:95vh;max-height:95dvh;border-radius:var(--radius-lg) var(--radius-lg) 0 0}}.light-theme .modal-card{background:var(--color-card-light);border:1px solid var(--color-border-light)}.dark-theme .modal-card{background:var(--color-card-dark);border:1px solid var(--color-border-dark)}.modal-header{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-xl);border-bottom:1px solid}.light-theme .modal-header{border-bottom-color:var(--color-border-light)}.dark-theme .modal-header{border-bottom-color:var(--color-border-dark)}.modal-title{font-size:1.25rem;font-weight:700}.modal-close{width:32px;height:32px;border-radius:50%;border:none;background:none;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all var(--transition-fast)}.modal-close:hover{background:#0000001a}.modal-body{padding:var(--spacing-xl)}.form-group{margin-bottom:var(--spacing-lg)}.form-label{display:block;font-size:.875rem;font-weight:600;margin-bottom:var(--spacing-xs)}.form-input,.form-select,.form-textarea{width:100%;padding:var(--spacing-sm) var(--spacing-md);border-radius:var(--radius-sm);border:1px solid;font-size:.875rem;transition:all var(--transition-fast)}.light-theme .form-input,.light-theme .form-select,.light-theme .form-textarea{background:var(--color-card-light);border-color:var(--color-border-light);color:var(--color-text-light)}.dark-theme .form-input,.dark-theme .form-select,.dark-theme .form-textarea{background:#0000004d;border-color:var(--color-border-dark);color:var(--color-text-dark)}.form-input:focus,.form-select:focus,.form-textarea:focus{outline:none;border-color:var(--color-purple-600)}.form-textarea{min-height:100px;resize:vertical}.badge{display:inline-flex;align-items:center;padding:.25rem .75rem;border-radius:9999px;font-size:.75rem;font-weight:600}.badge-purple{background:var(--color-purple-100);color:var(--color-purple-700)}.badge-gray{background:#0000001a}.light-theme .badge-gray{color:var(--color-text-secondary-light)}.dark-theme .badge-gray{background:#ffffff1a;color:var(--color-text-secondary-dark)}.loading-state{display:flex;justify-content:center;align-items:center;padding:var(--spacing-xl)}.spinner{border:3px solid rgba(147,51,234,.3);border-top-color:var(--color-purple-600);border-radius:50%;width:40px;height:40px;animation:spin 1s linear infinite}@keyframes spin{to{transform:rotate(360deg)}}.error-message{padding:var(--spacing-md);border-radius:var(--radius-sm);background:#dc26261a;border:1px solid rgba(220,38,38,.3);color:#dc2626;font-size:.875rem}.success-message{padding:var(--spacing-md);border-radius:var(--radius-sm);background:#22c55e1a;border:1px solid rgba(34,197,94,.3);color:#16a34a;font-size:.875rem}.flex{display:flex}.flex-col{flex-direction:column}.items-center{align-items:center}.justify-between{justify-content:space-between}.justify-center{justify-content:center}.gap-sm{gap:var(--spacing-sm)}.gap-md{gap:var(--spacing-md)}.gap-lg{gap:var(--spacing-lg)}.text-center{text-align:center}.mb-sm{margin-bottom:var(--spacing-sm)}.mb-md{margin-bottom:var(--spacing-md)}.mb-lg{margin-bottom:var(--spacing-lg)}.mt-sm{margin-top:var(--spacing-sm)}.mt-md{margin-top:var(--spacing-md)}.mt-lg{margin-top:var(--spacing-lg)}.info-message{padding:var(--spacing-sm);border-radius:var(--radius-md);background:#3b82f61a;color:#3b82f6;text-align:center}.info-display{padding:var(--spacing-sm) var(--spacing-md);border-radius:var(--radius-md);font-size:.875rem}.info-display.code{font-family:Courier New,monospace;word-break:break-all}.light-theme .info-display{background:var(--color-bg-secondary-light);color:var(--color-text-primary-light)}.dark-theme .info-display{background:var(--color-bg-secondary-dark);color:var(--color-text-primary-dark)}.form-hint{display:block;margin-top:var(--spacing-xs);font-size:.75rem;opacity:.7}.divider{border:none;border-top:1px solid;margin:var(--spacing-lg) 0}.light-theme .divider{border-color:#0000001a}.dark-theme .divider{border-color:#ffffff1a}.btn-danger{background:#dc2626;color:#fff}.btn-danger:hover:not(:disabled){background:#b91c1c}.loading-overlay{position:fixed;inset:0;background:#000c;backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;z-index:10001;animation:fadeIn .2s ease-out}.loading-spinner{background:var(--color-bg-primary-dark);border:1px solid rgba(255,255,255,.1);border-radius:var(--radius-lg);padding:var(--spacing-xl);text-align:center;max-width:400px;box-shadow:0 20px 60px #00000080}.spinner-icon{font-size:3rem;margin-bottom:var(--spacing-md);animation:spin 2s linear infinite}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.loading-spinner h3{margin:0 0 var(--spacing-sm) 0;color:var(--color-text-primary-dark);font-size:1.25rem}.loading-spinner p{margin:0;color:var(--color-text-secondary-dark);font-size:.875rem}@keyframes fadeIn{0%{opacity:0}to{opacity:1}}.xverse-helper-box{background:#9333ea0d;border:1px solid rgba(147,51,234,.2);border-radius:var(--radius-md);padding:var(--spacing-md);margin-bottom:var(--spacing-lg)}.dark-theme .xverse-helper-box{background:#9333ea1a;border-color:#9333ea4d}.xverse-helper-box p{margin:0 0 var(--spacing-xs) 0;font-size:.875rem;font-weight:600;color:var(--color-purple-600)}.xverse-helper-box ul{margin:var(--spacing-xs) 0 var(--spacing-xs) var(--spacing-lg);padding:0}.xverse-helper-box li{margin-bottom:var(--spacing-xs);font-size:.875rem;line-height:1.6}.xverse-example{font-family:Courier New,monospace;font-size:.875rem!important;margin-top:var(--spacing-sm)!important;padding:var(--spacing-xs) var(--spacing-sm);background:#22c55e1a;border-radius:var(--radius-sm);color:#16a34a!important}.xverse-input-group{margin-bottom:var(--spacing-lg)}.xverse-input-group label{display:block;font-size:.875rem;font-weight:600;margin-bottom:var(--spacing-xs)}.xverse-input-group input,.xverse-input-group textarea{width:100%;padding:var(--spacing-sm) var(--spacing-md);border-radius:var(--radius-sm);border:1px solid;font-size:.875rem;transition:all var(--transition-fast)}.light-theme .xverse-input-group input,.light-theme .xverse-input-group textarea{background:var(--color-card-light);border-color:var(--color-border-light);color:var(--color-text-light)}.dark-theme .xverse-input-group input,.dark-theme .xverse-input-group textarea{background:#0000004d;border-color:var(--color-border-dark);color:var(--color-text-dark)}.xverse-input-group input:focus,.xverse-input-group textarea:focus{outline:none;border-color:var(--color-purple-600)}.xverse-input-invalid{border-color:#dc2626!important;background:#dc26260d!important}.xverse-input-invalid:focus{border-color:#dc2626!important}.xverse-validation-error{display:block;margin-top:var(--spacing-xs);font-size:.75rem;color:#dc2626;font-weight:500}.xverse-validation-success{display:block;margin-top:var(--spacing-xs);font-size:.75rem;color:#16a34a;font-weight:500}.xverse-help-text{display:block;margin-top:var(--spacing-xs);font-size:.75rem;opacity:.7;font-style:italic}.xverse-button-disabled{opacity:.5;cursor:not-allowed}.xverse-checkbox-group{display:flex;align-items:flex-start;gap:var(--spacing-xs)}.xverse-checkbox-group label{display:flex;align-items:center;gap:var(--spacing-xs);margin-bottom:0}.xverse-checkbox-group input[type=checkbox]{width:auto;cursor:pointer}.xverse-checkbox-group span{font-weight:600}

</style>
</head>
<body>

<style>

*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{height:100%;-webkit-text-size-adjust:100%}
body{height:100%;background:var(--bg);color:var(--fg);font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','Inter',Roboto,Helvetica,sans-serif;line-height:1.5;-webkit-font-smoothing:antialiased;overflow:hidden}
:root{
  --bg:#050510;
  --surface:rgba(255,255,255,.04);
  --surface2:rgba(255,255,255,.06);
  --border:rgba(255,255,255,.07);
  --border2:rgba(255,255,255,.12);
  --fg:#e8e8e8;
  --fg2:#aaa;
  --fg3:#777;
  --fg4:#555;
  --accent:#a855f7;
  --accent-dim:#7c3aed;
  --accent-bg:rgba(168,85,247,.08);
  --radius:10px;
}

/*  Starfield  */
#starfield{position:fixed;inset:0;z-index:0;pointer-events:none;overflow:hidden}
.star-layer{position:absolute;inset:-50% -10%;width:120%;height:200%}
.star-layer svg{position:absolute;top:0;left:0;width:100%;height:100%}
.stars-far{animation:drift-far 120s linear infinite}
.stars-mid{animation:drift-mid 80s linear infinite}
.stars-near{animation:drift-near 50s linear infinite}
@keyframes drift-far{from{transform:translateX(0)}to{transform:translateX(-8%)}}
@keyframes drift-mid{from{transform:translateX(0)}to{transform:translateX(-12%)}}
@keyframes drift-near{from{transform:translateX(0)}to{transform:translateX(-18%)}}

/*  Landing (single viewport)  */
#landing{position:relative;z-index:10;height:100vh;display:flex;flex-direction:column}

/*  Nav  */
.nav{flex-shrink:0;height:48px;padding:0 24px;display:flex;align-items:center;justify-content:space-between;gap:12px;border-bottom:1px solid var(--border);background:rgba(5,5,16,.8);backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px)}
.nav-brand{display:flex;align-items:center;gap:8px}
.nav-mark{width:26px;height:26px;background:var(--accent-bg);border:1px solid rgba(168,85,247,.2);border-radius:6px;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:12px;color:var(--accent)}
.nav-name{font-size:14px;font-weight:700;color:var(--fg);letter-spacing:-.02em}
.nav-tag{font-size:8px;font-weight:700;color:var(--fg4);border:1px solid var(--border2);padding:2px 5px;border-radius:3px;letter-spacing:.06em;text-transform:uppercase}
.nav-right{display:flex;align-items:center;gap:6px}
.nav-link{color:var(--fg4);font-size:11px;text-decoration:none;font-weight:600;padding:6px 10px;border-radius:5px;transition:color .15s,background .15s}
.nav-link:hover{color:var(--fg);background:rgba(255,255,255,.05)}
.nav-launch{color:var(--accent);border:1px solid rgba(168,85,247,.25);border-radius:6px;padding:5px 12px;font-size:11px;font-weight:700;cursor:pointer;background:none;font-family:inherit;transition:all .15s}
.nav-launch:hover{background:rgba(168,85,247,.1);border-color:rgba(168,85,247,.4)}

/*  Main content (fills remaining)  */
.main{flex:1;display:flex;flex-direction:column;justify-content:center;align-items:center;padding:0 24px;max-width:820px;margin:0 auto;width:100%}

/*  Hero  */
.hero{text-align:center;margin-bottom:28px}
.hero-banner{display:flex;align-items:flex-end;justify-content:center;gap:18px;margin-bottom:8px}
.hero h1{font-size:clamp(2rem,5vw,3rem);font-weight:700;letter-spacing:-.04em;line-height:1.05;color:var(--fg);margin:0;padding:0 6px}
.hero h1 em{font-style:normal;color:var(--accent)}
.hero-sub{font-size:14px;color:var(--fg2);line-height:1.6;max-width:480px;margin:0 auto 16px}
.hero-actions{display:flex;gap:8px;justify-content:center;flex-wrap:wrap;align-items:center}
#hp-open-wallet{display:none}
#hp-mobile-hint{display:none;font-size:11px;color:var(--fg4);margin-top:6px;text-align:center}

/*  Buttons  */
.btn{display:inline-flex;align-items:center;justify-content:center;font-size:12px;font-weight:600;padding:8px 16px;border-radius:7px;border:1px solid transparent;cursor:pointer;transition:all .15s;text-decoration:none;white-space:nowrap;line-height:1;font-family:inherit}
.btn-primary{background:var(--accent);color:#fff;border-color:var(--accent)}
.btn-primary:hover{background:var(--accent-dim);border-color:var(--accent-dim)}
.btn-secondary{background:transparent;color:var(--fg2);border-color:var(--border2)}
.btn-secondary:hover{color:var(--fg);border-color:var(--fg4);background:rgba(255,255,255,.04)}
.btn-ghost{background:transparent;color:var(--fg3);border:none;padding:8px 10px}
.btn-ghost:hover{color:var(--fg)}

/*  Cards grid  */
.cards{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;width:100%;margin-bottom:24px}
.card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:14px 16px;cursor:pointer;transition:border-color .15s,background .15s}
.card:hover{border-color:rgba(168,85,247,.2);background:var(--surface2)}
.card h3{font-size:13px;font-weight:650;color:var(--fg);margin-bottom:3px;letter-spacing:-.01em}
.card p{font-size:11px;color:var(--fg3);line-height:1.5}

/*  Footer  */
.foot{flex-shrink:0;padding:12px 24px;display:flex;align-items:center;justify-content:center;gap:16px;border-top:1px solid var(--border);font-size:11px;color:var(--fg4)}
.foot a{color:var(--fg4);text-decoration:none;font-weight:500;transition:color .15s}
.foot a:hover{color:var(--fg2)}
.foot .proto-link{color:var(--accent);font-weight:600}
.foot .proto-link:hover{color:var(--accent-dim)}

/*  Mobile modal  */
.hp-modal{display:none;position:fixed;inset:0;z-index:99998;background:rgba(0,0,0,.7);backdrop-filter:blur(4px)}
.hp-modal.active{display:flex;align-items:center;justify-content:center}
.hp-modal-card{width:min(480px,calc(100vw - 32px));background:rgba(20,20,35,.95);border:1px solid var(--border2);border-radius:12px;overflow:hidden;backdrop-filter:blur(12px)}
.hp-modal-h{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--border)}
.hp-modal-h h4{font-size:13px;font-weight:650;color:var(--fg)}
.hp-x{appearance:none;background:transparent;border:1px solid var(--border);color:var(--fg3);border-radius:6px;padding:4px 10px;font-weight:700;cursor:pointer;font-size:13px}
.hp-x:hover{color:var(--fg);border-color:var(--border2)}
.hp-modal-b{padding:16px}
.hp-modal-b p{font-size:13px;line-height:1.55;color:var(--fg3);margin-bottom:12px}
.hp-wallets{display:flex;flex-direction:column;gap:8px}
.hp-wallet-btn{display:flex;align-items:center;justify-content:space-between;gap:10px;border:1px solid var(--border);background:var(--surface2);color:var(--fg);border-radius:8px;padding:12px 14px;font-weight:600;font-size:13px;cursor:pointer;transition:border-color .15s}
.hp-wallet-btn:hover{border-color:var(--fg4)}
.hp-wallet-sub{font-size:11px;color:var(--fg4);font-weight:500;margin-top:2px}
.hp-wallet-r{color:var(--fg4);font-weight:700}
.hp-modal-actions{display:flex;gap:8px;justify-content:flex-end;margin-top:14px}

/*  Loading overlay  */
@keyframes spin{to{transform:rotate(360deg)}}
#app-loading{display:none;position:fixed;inset:0;background:var(--bg);z-index:9999;justify-content:center;align-items:center;flex-direction:column;gap:12px}
#app-loading.active{display:flex}
.hp-spinner{width:24px;height:24px;border:2px solid var(--border2);border-top-color:var(--fg3);border-radius:50%;animation:spin .7s linear infinite}
.hp-load-t{color:var(--fg4);font-size:11px;letter-spacing:.06em;text-transform:uppercase;font-weight:600}

/*  Block ticker  */
.block-ticker{flex-shrink:0;overflow:hidden;position:relative;height:72px;border-bottom:1px solid var(--border);background:rgba(5,5,16,.6)}
.block-ticker-track{display:flex;gap:6px;padding:4px 0;position:absolute;left:0;top:0;height:100%;align-items:center;will-change:transform;transition:transform 0s linear}
.blk{width:64px;height:64px;border-radius:6px;background:var(--surface);border:1px solid var(--border);flex-shrink:0;display:flex;align-items:center;justify-content:center;transition:border-color .3s,color .3s,background .3s}
.blk.blk-new{border-color:var(--accent);color:var(--accent);background:var(--accent-bg);animation:blk-glow .6s ease}
@keyframes blk-glow{0%{box-shadow:0 0 8px rgba(168,85,247,.5)}100%{box-shadow:none}}
.blk-h{font-size:10px;font-weight:700;color:var(--fg4);line-height:1;text-align:center}

/*  Stick figures (inline in hero)  */
.stick-fig{width:48px;height:72px;flex-shrink:0}
.sf-body{stroke:var(--fg3);stroke-width:2;stroke-linecap:round;fill:none}
.sf-head{fill:none;stroke:var(--fg3);stroke-width:2}
.sf-label{font-size:9px;fill:var(--fg4);font-weight:600;font-family:inherit}
.seller-arm{transform-origin:30px 32px;transition:transform .25s}
.buyer-arm{transform-origin:30px 32px;transition:transform .25s}
/*  Floating art & BTC  */
.float-art{position:absolute;left:0;top:0;width:42px;opacity:0;pointer-events:none;z-index:60;will-change:transform}
.float-art-frame{width:42px;height:42px;border-radius:4px;overflow:hidden;border:1.5px solid var(--accent);background:#0d0818;transition:box-shadow .3s}
.float-art-frame svg{display:block;width:100%;height:100%}
.float-art.in-chain .float-art-frame{box-shadow:0 0 12px rgba(168,85,247,.5)}
.float-art-tag{font-size:6.5px;font-weight:800;color:#fff;background:var(--accent);padding:1px 5px;border-radius:2px;text-align:center;margin-top:2px;opacity:0;transition:opacity .3s;white-space:nowrap;letter-spacing:.03em}
.float-art-tag.show{opacity:1}
.float-btc{position:absolute;left:0;top:0;width:26px;height:26px;opacity:0;pointer-events:none;z-index:60;will-change:transform}
.float-btc svg{display:block;width:100%;height:100%}

/*  Responsive  */
@media(max-width:768px){
  body{overflow:auto}
  #landing{height:auto;min-height:100vh}
  .nav{padding:0 16px}
  .main{padding:24px 16px}
  .cards{grid-template-columns:1fr 1fr}
  .nav-right .nav-link:not(.nav-launch){display:none}
  .foot{padding:10px 16px}
  .stick-fig{width:36px;height:54px}
  .float-art{width:32px}
  .float-art-frame{width:32px;height:32px}
  .float-btc{width:20px;height:20px}
  .block-ticker{height:58px}
  .blk{width:52px;height:52px}
  .blk-h{font-size:8px}
}
@media(max-width:480px){
  .hero h1{font-size:clamp(1.6rem,8vw,2.2rem)}
  .cards{grid-template-columns:1fr}
  .stick-fig{width:28px;height:42px}
  .float-art{width:24px}
  .float-art-frame{width:24px;height:24px}
  .float-art-tag{font-size:5px;padding:1px 3px}
  .float-btc{width:16px;height:16px}
}

</style>

<div id="starfield"></div>

<div id="landing">

  
  <nav class="nav">
    <div class="nav-brand">
      <div class="nav-mark">O</div>
      <span class="nav-name">Oodinals</span>
      <span class="nav-tag">Beta</span>
    </div>
    <div class="nav-right">
      <a href="oodl_protocol_inscription.html" class="nav-link">OODL Protocol</a>
      <button class="nav-launch" onclick="launchApp()">Launch App</button>
    </div>
  </nav>

  
  <div class="block-ticker" id="block-ticker">
    <div class="block-ticker-track" id="block-track"></div>
  </div>

  
  <div class="main">

    
    <div class="hero">
      <div class="hero-banner">
        
        <svg class="stick-fig" id="stick-seller" viewBox="0 0 60 85" xmlns="http://www.w3.org/2000/svg">
          <circle class="sf-head" cx="30" cy="12" r="8"/>
          <line class="sf-body" x1="30" y1="20" x2="30" y2="50"/>
          <line class="sf-body" x1="30" y1="50" x2="20" y2="68"/>
          <line class="sf-body" x1="30" y1="50" x2="40" y2="68"/>
          <line class="sf-body" x1="30" y1="32" x2="15" y2="44"/>
          <g class="seller-arm" id="seller-arm"><line class="sf-body" x1="30" y1="32" x2="48" y2="26"/></g>
          <text class="sf-label" x="30" y="82" text-anchor="middle">Seller</text>
        </svg>
        <h1><em>Oodinals</em></h1>
        
        <svg class="stick-fig" id="stick-buyer" viewBox="0 0 60 85" xmlns="http://www.w3.org/2000/svg">
          <circle class="sf-head" cx="30" cy="12" r="8"/>
          <line class="sf-body" x1="30" y1="20" x2="30" y2="50"/>
          <line class="sf-body" x1="30" y1="50" x2="20" y2="68"/>
          <line class="sf-body" x1="30" y1="50" x2="40" y2="68"/>
          <g class="buyer-arm" id="buyer-arm"><line class="sf-body" x1="30" y1="32" x2="12" y2="26"/></g>
          <line class="sf-body" x1="30" y1="32" x2="45" y2="44"/>
          <text class="sf-label" x="30" y="82" text-anchor="middle">Buyer</text>
        </svg>
      </div>
      <p class="hero-sub">
        Inscribe, list, and trade on Bitcoin. No backend, no custody, no middlemen.
      </p>
      <div class="hero-actions">
        <button id="hp-primary" class="btn btn-primary" onclick="launchApp()">Launch App</button>
        <button id="hp-open-wallet" class="btn btn-secondary" onclick="showMobileChooser()">Open in Wallet</button>
      </div>
      <div id="hp-mobile-hint"></div>
    </div>

    
    <div class="cards">
      <div class="card" onclick="launchApp('inscribe')">
        <h3>Inscribe</h3>
        <p>Put anything on Bitcoin  images, text, HTML, 3D, BRC-20. Brotli compression, parent-child, batch.</p>
      </div>
      <div class="card" onclick="launchApp('marketplace')">
        <h3>Marketplace</h3>
        <p>Browse and buy inscriptions peer-to-peer. Every trade settles atomically  no middleman.</p>
      </div>
      <div class="card" onclick="launchApp('trade')">
        <h3>List &amp; Sell</h3>
        <p>Create trustless listings with one wallet signature. Your inscription never leaves your custody.</p>
      </div>
      <div class="card" onclick="launchApp('hub')">
        <h3>Collections</h3>
        <p>On-chain collection registry. Launch, curate, and manage  all inscribed on Bitcoin.</p>
      </div>
      <div class="card" onclick="launchApp('openstores')">
        <h3>Open Stores</h3>
        <p>Your own decentralised storefront on Bitcoin. No platform fee, no approval needed.</p>
      </div>
      <div class="card" onclick="launchApp('bitmaps')">
        <h3>Bitmaps</h3>
        <p>Bitmap metaverse integration. Inscribe blocks, create parcels, trade via OODL.</p>
      </div>
    </div>

  </div>

  
  <div class="float-art" id="float-art">
    <div class="float-art-frame">
      <svg viewBox="0 0 42 42" xmlns="http://www.w3.org/2000/svg">
        <rect width="42" height="42" fill="#0d0818"/>
        <path d="M0 34 L10 18 L17 26 L27 10 L37 22 L42 16 L42 42 L0 42Z" fill="rgba(168,85,247,.25)" stroke="rgba(168,85,247,.5)" stroke-width=".5"/>
        <circle cx="34" cy="9" r="5" fill="rgba(247,147,26,.4)"/>
        <path d="M3 38Q12 32 22 36Q32 40 39 35" stroke="rgba(168,85,247,.3)" fill="none" stroke-width=".5"/>
      </svg>
    </div>
    <div class="float-art-tag" id="float-art-tag">FOR SALE</div>
  </div>
  
  <div class="float-btc" id="float-btc">
    <svg viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg">
      <circle cx="13" cy="13" r="12" fill="#f7931a" stroke="#c77800" stroke-width="1.5"/>
      <text x="13" y="18" text-anchor="middle" fill="#fff" font-size="13" font-weight="800" font-family="inherit">&#x20bf;</text>
    </svg>
  </div>

  
  <div class="foot">
    <span>Oodinals</span>
    <a href="oodl_protocol_inscription.html" class="proto-link">OODL Protocol</a>
    <a href="#" onclick="launchApp();return false">Open App</a>
  </div>

</div>


<div id="mobile-chooser" class="hp-modal" aria-hidden="true" onclick="hideMobileChooser()">
  <div class="hp-modal-card" onclick="event.stopPropagation()">
    <div class="hp-modal-h">
      <h4>Open in wallet</h4>
      <button class="hp-x" onclick="hideMobileChooser()" aria-label="Close">&#10005;</button>
    </div>
    <div class="hp-modal-b">
      <p>To connect and sign on mobile, open Oodinals inside a wallet app browser. Pick one below, or continue in your current browser.</p>
      <div id="hp-wallets" class="hp-wallets"></div>
      <div class="hp-modal-actions">
        <button class="btn btn-secondary" onclick="copyCurrentUrl()">Copy link</button>
        <button class="btn btn-primary" onclick="launchApp()">Continue here</button>
      </div>
    </div>
  </div>
</div>



<div class="hp-load-t">Loading</div></div>



<div id="root" style="display:none"></div>
<div id="app-loading"><div class="hp-spinner"></div><div class="hp-load-t">Loading</div></div>

<style>
  @keyframes hp-spin{to{transform:rotate(360deg)}}
  #app-loading{display:none;position:fixed;inset:0;background:#050505;z-index:9999;justify-content:center;align-items:center;flex-direction:column;gap:12px}
  #app-loading.active{display:flex}
  .hp-spinner{width:28px;height:28px;border:1.5px solid rgba(255,255,255,.08);border-top-color:rgba(255,255,255,.55);border-radius:50%;animation:hp-spin .8s linear infinite}
  .hp-load-t{color:rgba(255,255,255,.22);font-size:11px;letter-spacing:.08em;text-transform:uppercase;font-weight:700}
</style>

<script>

(function () {
  function showAppForHash() {
    var h = String(window.location.hash || '').replace(/^#/, '');
    if (!h || h === 'landing') return false;

    var landing = document.getElementById('landing');
    var starfield = document.getElementById('starfield');
    var chooser = document.getElementById('mobile-chooser');

    if (landing) landing.style.display = 'none';
    if (starfield) starfield.style.display = 'none';
    if (chooser) chooser.style.display = 'none';

    var loading = document.getElementById('app-loading');
    if (loading) loading.classList.add('active');

    var root = document.getElementById('root');
    if (root) root.style.display = '';

    try {
      if (loading) {
        if (window.__NEXUS_DEPS_READY__ === true || window.__NEXUS_LOADING_DEPS__ === false) {
          loading.classList.remove('active');
        } else {
          window.addEventListener('nexus-deps-ready', function () {
            try { loading.classList.remove('active'); } catch (_) {}
          }, { once: true });

          setTimeout(function () {
            try { loading.classList.remove('active'); } catch (_) {}
          }, 12000);
        }
      }
    } catch (_) {}

    window.__OODINALS_INITIAL_TAB__ = h;
    return true;
  }

  window.__launchApp = function (hash) {
    try {
      window.location.hash = hash || '#app';
    } catch (_) {}
    showAppForHash();
  };

  showAppForHash();

  window.addEventListener('hashchange', showAppForHash);
})();
</script>


<script>



function launchApp(tab) {
  var hash = tab ? '#' + tab : '';
  if (window.__launchApp) {
    window.__launchApp(hash);
  } else {
    window.location.hash = hash || '#app';
  }
}


(function () {
  var h = window.location.hash.replace(/^#/, '');
  if (h && h !== '' && h !== 'landing') launchApp(h);
})();



function createStarfield() {
  var container = document.getElementById('starfield');
  if (!container) return;

  var layers = [
    { cls: 'stars-far',  count: 80,  minR: 0.3, maxR: 0.7, opacity: 0.3 },
    { cls: 'stars-mid',  count: 50,  minR: 0.5, maxR: 1.0, opacity: 0.5 },
    { cls: 'stars-near', count: 25,  minR: 0.8, maxR: 1.4, opacity: 0.7 }
  ];

  layers.forEach(function (layer) {
    var div = document.createElement('div');
    div.className = 'star-layer ' + layer.cls;
    var circles = '';
    for (var i = 0; i < layer.count; i++) {
      var cx = (Math.random() * 100).toFixed(2);
      var cy = (Math.random() * 100).toFixed(2);
      var r  = (layer.minR + Math.random() * (layer.maxR - layer.minR)).toFixed(2);
      circles += '<circle cx="' + cx + '%" cy="' + cy + '%" r="' + r + '" fill="white" opacity="' + layer.opacity + '"/>';
    }
    div.innerHTML = '<svg viewBox="0 0 1200 800" preserveAspectRatio="none" xmlns="http://www.w3.org/2000/svg">' + circles + '</svg>';
    container.appendChild(div);
  });
}



function isMobile() {
  return /Android|iPhone|iPad|iPod|Mobile/i.test(navigator.userAgent);
}

function isInsideWalletBrowser() {
  return !!(window.unisat || window.xverse || (window.bitcoin && window.bitcoin.isPhantom) || window.okxwallet);
}

var _walletOptions = [
  { name: 'UniSat', sub: 'unisat.io', url: 'https://unisat.io/browser?url=' },
  { name: 'Xverse', sub: 'xverse.app', url: 'https://connect.xverse.app/browser?url=' },
  { name: 'OKX', sub: 'okx.com', url: 'okx://discover?url=' },
  { name: 'Phantom', sub: 'phantom.app', url: 'https://phantom.app/ul/browse/' }
];

function renderWalletButtons() {
  var container = document.getElementById('hp-wallets');
  if (!container) return;
  container.innerHTML = '';
  var currentUrl = encodeURIComponent(window.location.href);
  _walletOptions.forEach(function (w) {
    var btn = document.createElement('button');
    btn.className = 'hp-wallet-btn';
    btn.innerHTML = '<div><strong>' + w.name + '</strong><div class="hp-wallet-sub">' + w.sub + '</div></div><span class="hp-wallet-r"></span>';
    btn.onclick = function () { window.location.href = w.url + currentUrl; };
    container.appendChild(btn);
  });
}

function showMobileChooser() {
  var modal = document.getElementById('mobile-chooser');
  if (!modal) return;
  renderWalletButtons();
  modal.classList.add('active');
  modal.setAttribute('aria-hidden', 'false');
}

function hideMobileChooser() {
  var modal = document.getElementById('mobile-chooser');
  if (!modal) return;
  modal.classList.remove('active');
  modal.setAttribute('aria-hidden', 'true');
}

function copyCurrentUrl() {
  if (navigator.clipboard) {
    navigator.clipboard.writeText(window.location.href).catch(function () {});
  }
}



function initMobileLandingFlow() {
  if (!isMobile()) return;
  var hint = document.getElementById('hp-mobile-hint');
  var openWallet = document.getElementById('hp-open-wallet');

  if (isInsideWalletBrowser()) {
    if (hint) { hint.style.display = 'block'; hint.textContent = 'Wallet detected '; }
  } else {
    if (openWallet) openWallet.style.display = '';
    if (hint) { hint.style.display = 'block'; hint.textContent = 'Open inside a wallet app for seamless signing on mobile.'; }
  }
}



function initLanding() {
  createStarfield();
  initMobileLandingFlow();
  initBlockTicker();
  initTradeScene();
}



var _tickerOffset = 0;
var _tickerDir = 0; // -1 left, 0 stopped, 1 right
var _tickerSpeed = 0.3; // px per frame
var _tickerTrack = null;
var _tickerRAF = null;

function scrollTicker(dir, speed) {
  _tickerDir = dir;
  if (typeof speed === 'number') _tickerSpeed = speed;
}

function stopTicker() { _tickerDir = 0; }

function _tickerLoop() {
  if (_tickerTrack && _tickerDir !== 0) {
    _tickerOffset += _tickerDir * _tickerSpeed;

    var halfW = _tickerTrack.scrollWidth / 2;
    if (halfW > 0) {
      if (_tickerOffset < -halfW) _tickerOffset += halfW;
      if (_tickerOffset > 0) _tickerOffset -= halfW;
    }
    _tickerTrack.style.transform = 'translateX(' + _tickerOffset + 'px)';
  }
  _tickerRAF = requestAnimationFrame(_tickerLoop);
}

function initBlockTicker() {
  var track = document.getElementById('block-track');
  if (!track) return;
  _tickerTrack = track;

  var startHeight = 880000;
  var count = 80;

  function renderBlocks() {
    var html = '';
    for (var dup = 0; dup < 2; dup++) {
      for (var i = 0; i < count; i++) {
        html += '<div class="blk"><span class="blk-h">' + (startHeight + i) + '</span></div>';
      }
    }
    track.innerHTML = html;
  }

  renderBlocks();

  _tickerDir = -1;
  _tickerSpeed = 0.3;
  _tickerLoop();

  setInterval(function () {
    var all = track.querySelectorAll('.blk');
    if (all.length === 0) return;
    var idx = Math.floor(Math.random() * (all.length / 2));
    var el = all[idx];
    if (el) {
      el.classList.add('blk-new');
      setTimeout(function () { el.classList.remove('blk-new'); }, 1200);
    }
  }, 4000);
}



function initTradeScene() {
  var landing = document.getElementById('landing');
  var ticker = document.getElementById('block-ticker');
  var seller = document.getElementById('stick-seller');
  var buyer  = document.getElementById('stick-buyer');
  var sellerArm = document.getElementById('seller-arm');
  var buyerArm  = document.getElementById('buyer-arm');
  var art = document.getElementById('float-art');
  var tag = document.getElementById('float-art-tag');
  var btc = document.getElementById('float-btc');

  if (!landing || !ticker || !seller || !buyer || !art || !btc) return;

  function rel(el) {
    var r = el.getBoundingClientRect();
    var p = landing.getBoundingClientRect();
    return { x: r.left - p.left + r.width / 2, y: r.top - p.top + r.height / 2 };
  }

  function artSize() { return art.offsetWidth || 42; }
  function btcSize() { return btc.offsetWidth || 26; }

  function placeArt(x, y) {
    var s = artSize() / 2;
    art.style.transform = 'translate(' + (x - s) + 'px,' + (y - s) + 'px)';
  }
  function placeBtc(x, y) {
    var s = btcSize() / 2;
    btc.style.transform = 'translate(' + (x - s) + 'px,' + (y - s) + 'px)';
  }
  function moveArt(x, y, ms, ease) {
    art.style.transition = 'transform ' + ms + 'ms ' + (ease || 'ease') + ',opacity .3s';
    placeArt(x, y);
  }
  function moveBtc(x, y, ms, ease) {
    btc.style.transition = 'transform ' + ms + 'ms ' + (ease || 'ease') + ',opacity .3s';
    placeBtc(x, y);
  }

  function cycle() {

    var sc = rel(seller);
    var bc = rel(buyer);
    var tc = rel(ticker);
    var fw = seller.getBoundingClientRect().width;
    var hOff = fw * 0.35; // hand offset from center
    var vOff = fw * 0.45; // hand up from center
    var sh = { x: sc.x + hOff, y: sc.y - vOff }; // seller hand (right side)
    var bh = { x: bc.x - hOff, y: bc.y - vOff }; // buyer hand (left side)
    var ty = tc.y;                                  // ticker Y

    art.style.transition = 'none'; btc.style.transition = 'none';
    art.style.opacity = '0'; btc.style.opacity = '0';
    art.classList.remove('in-chain');
    tag.classList.remove('show');
    if (sellerArm) sellerArm.style.transform = '';
    if (buyerArm)  buyerArm.style.transform = '';
    placeArt(sh.x, sh.y);
    scrollTicker(-1, 0.3); // gentle leftward idle
    void art.offsetWidth; // force reflow

    setTimeout(function () {
      art.style.transition = 'opacity .6s';
      art.style.opacity = '1';
      var n = 0;
      var w = setInterval(function () {
        n++;
        if (sellerArm) sellerArm.style.transform = 'rotate(' + (n % 2 ? -12 : 10) + 'deg)';
        if (n >= 6) { clearInterval(w); if (sellerArm) sellerArm.style.transform = ''; }
      }, 180);
    }, 300);

    setTimeout(function () { tag.classList.add('show'); }, 1600);

    setTimeout(function () {
      if (sellerArm) sellerArm.style.transform = 'rotate(-40deg)';
      moveArt(sc.x, ty, 650, 'cubic-bezier(.15,.8,.3,1)');
      setTimeout(function () {
        if (sellerArm) sellerArm.style.transform = '';
        art.classList.add('in-chain');
      }, 650);
    }, 2400);

    setTimeout(function () {
      scrollTicker(1, 0.6); // chain moves right
      moveArt(bc.x, ty, 3300, 'linear');
    }, 3200);

    setTimeout(function () {
      stopTicker(); // chain pauses briefly
      btc.style.transition = 'none';
      placeBtc(bh.x, bh.y);
      void btc.offsetWidth;
      btc.style.opacity = '1';
      if (buyerArm) buyerArm.style.transform = 'rotate(40deg)';
      setTimeout(function () {
        moveBtc(bc.x, ty, 500, 'cubic-bezier(.15,.8,.3,1)');
        setTimeout(function () { if (buyerArm) buyerArm.style.transform = ''; }, 400);
      }, 50);
    }, 6200);

    setTimeout(function () {
      tag.classList.remove('show');
      art.classList.remove('in-chain');
      moveArt(bh.x, bh.y, 550, 'cubic-bezier(.6,0,.85,1)');
    }, 6800);

    setTimeout(function () {
      scrollTicker(-1, 0.6); // chain moves left
      moveBtc(sc.x, ty, 2800, 'linear');
    }, 7000);

    setTimeout(function () {
      stopTicker();
      moveBtc(sh.x, sh.y, 500, 'cubic-bezier(.6,0,.85,1)');
    }, 10000);

    setTimeout(function () {
      art.style.transition = 'opacity .6s'; art.style.opacity = '0';
      btc.style.transition = 'opacity .6s'; btc.style.opacity = '0';
      scrollTicker(-1, 0.3); // back to idle
    }, 11200);

    setTimeout(cycle, 13000);
  }

  setTimeout(cycle, 1000);
}


try {
  window.launchApp = launchApp;
  window.showMobileChooser = showMobileChooser;
  window.hideMobileChooser = hideMobileChooser;
  window.copyCurrentUrl = copyCurrentUrl;
} catch (_) {}

initLanding();

</script>

 <script>
  (function () {
    try {
      const origin = (typeof window.__NEXUS_ORDINALS_ORIGIN__ === 'string' ? window.__NEXUS_ORDINALS_ORIGIN__ : '') || '';


      const isOrdinals = /ordinals\.com$/i.test(window.location.hostname);
      const effectiveOrigin = origin || (isOrdinals ? '' : 'https://ordinals.com');
      const src = effectiveOrigin + '/content/6f3ff06fb6414bf40c1dac14c3a78fd3979476467cf8a0e5f107c79e9455fc02i0';
      const s = document.createElement('script');
      s.defer = true;
      s.src = src;
      document.body.appendChild(s);
    } catch (e) {
      try { window.__NEXUS_DEBUG_APPEND__ && window.__NEXUS_DEBUG_APPEND__('bootstrap inject failed: ' + (e && e.message ? e.message : e)); } catch (_) {}
    }
  })();
 </script>


</body>
</html>
