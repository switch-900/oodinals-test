<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Oodinals-test</title>


  <script>
    window.__NEXUS_ORDINALS_ORIGIN__ = 'https://ordinals.com';
    window.__NEXUS_ORDINALS_ORIGIN_CONFIRMED__ = true;
    window.__NEXUS_WEB_BUILD__ = true;
  </script>

 <script>
(function nexusOrdinalsViewerWrapper() {
  if (window.NexusOrdinalsWrapper && window.NexusOrdinalsWrapper.__installed__) return;

 const FALLBACK_ORIGIN = 'https://ordinals.com';

  function isHttpLike() {
    try {
      return window.location.protocol === 'http:' || window.location.protocol === 'https:';
    } catch (_) {
      return false;
    }
  }

  if (!window.__NEXUS_RAW_FETCH__ && window.fetch) {
    try {
      window.__NEXUS_RAW_FETCH__ = window.fetch.bind(window);
    } catch (_) {}
  }

  function isOrdinalsDomainHost() {
    try {
      const hostname = window.location.hostname;
      return hostname === 'ordinals.com' || hostname.endsWith('.ordinals.com');
    } catch (_) {
      return false;
    }
  }

  function shouldFallbackPath(pathname) {
    return (
      pathname === '/r/blockheight' ||
      pathname === '/blockheight' ||
      pathname === '/blockhash' ||
      pathname.startsWith('/blockhash/') ||
      pathname === '/blocktime' ||
      pathname.startsWith('/r/') ||
      pathname.startsWith('/content/')
    );
  }

  function joinOrdinals(origin, pathOrUrl) {
    if (!pathOrUrl) return origin;
    if (/^(https?:)?\/\//i.test(pathOrUrl)) return pathOrUrl;
    return `${origin}${pathOrUrl}`;
  }

  function getPreferredOriginSync() {
    if (!isHttpLike()) return '';
    if (isOrdinalsDomainHost()) return '';
    if (typeof window.__NEXUS_ORDINALS_ORIGIN__ === 'string') {
      const origin = window.__NEXUS_ORDINALS_ORIGIN__;
      return origin || '';
    }
    return '';
  }

  function rewriteOrdinalsUrlCandidate(value) {
    if (typeof value !== 'string') return value;
    const origin = getPreferredOriginSync();
    if (/^(https?:)?\/\//i.test(value)) return value;
    if (value.startsWith('/') && shouldFallbackPath(value.split('?')[0])) {
      return origin ? `${origin}${value}` : value;
    }
    return value;
  }

  function isHtmlResponse(resp) {
    try {
      const ct = String(resp && resp.headers && resp.headers.get ? (resp.headers.get('content-type') || '') : '');
      return /text\/html/i.test(ct);
    } catch (_) {
      return false;
    }
  }

  async function detectOrdinalsOrigin() {
   return window.__NEXUS_ORDINALS_ORIGIN__ || FALLBACK_ORIGIN;
  }

  function detectOrdinalsOriginCached() {
    if (!window.__NEXUS_ORDINALS_ORIGIN_PROMISE__) {
      window.__NEXUS_ORDINALS_ORIGIN_PROMISE__ = Promise.resolve(
        window.__NEXUS_ORDINALS_ORIGIN__ || FALLBACK_ORIGIN
      );
    }
    return window.__NEXUS_ORDINALS_ORIGIN_PROMISE__;
  }

  function installFetchFallback() {
    if (window.__NEXUS_ORDINALS_FETCH_FALLBACK_INSTALLED__) return;
    window.__NEXUS_ORDINALS_FETCH_FALLBACK_INSTALLED__ = true;

    const originalFetch = window.__NEXUS_RAW_FETCH__ || (window.fetch && window.fetch.bind(window));
    if (!originalFetch) return;

    window.fetch = async function fetchWithOrdinalsFallback(input, init) {
      const method = String((init && init.method) || (input && input.method) || 'GET').toUpperCase();
      if (method !== 'GET' && method !== 'HEAD') return originalFetch(input, init);

      let url;
      try {
        if (typeof input === 'string' || input instanceof URL) {
          url = new URL(String(input), window.location.href);
        } else if (input && typeof input.url === 'string') {
          url = new URL(input.url);
        }
      } catch (_) {
        return originalFetch(input, init);
      }

      if (!url || !shouldFallbackPath(url.pathname)) return originalFetch(input, init);

     const origin = getPreferredOriginSync() || FALLBACK_ORIGIN;
      if (origin) {
        const rewritten = `${origin}${url.pathname}${url.search}`;
        try {
          const resp = await originalFetch(rewritten, init);
          if (resp && resp.ok && !isHtmlResponse(resp)) return resp;
        } catch (_) {}
      }

     return originalFetch(input, init);
    };
  }

  function installSrcHrefRewriter() {
    if (window.__NEXUS_ORDINALS_SRC_HREF_REWRITER_INSTALLED__) return;
    window.__NEXUS_ORDINALS_SRC_HREF_REWRITER_INSTALLED__ = true;

    try {
      const scriptSrc = Object.getOwnPropertyDescriptor(HTMLScriptElement.prototype, 'src');
      if (scriptSrc && typeof scriptSrc.set === 'function' && typeof scriptSrc.get === 'function') {
        Object.defineProperty(HTMLScriptElement.prototype, 'src', {
          configurable: true,
          enumerable: scriptSrc.enumerable,
          get: function() { return scriptSrc.get.call(this); },
          set: function(v) { return scriptSrc.set.call(this, rewriteOrdinalsUrlCandidate(v)); }
        });
      }
    } catch (_) {}

    try {
      const linkHref = Object.getOwnPropertyDescriptor(HTMLLinkElement.prototype, 'href');
      if (linkHref && typeof linkHref.set === 'function' && typeof linkHref.get === 'function') {
        Object.defineProperty(HTMLLinkElement.prototype, 'href', {
          configurable: true,
          enumerable: linkHref.enumerable,
          get: function() { return linkHref.get.call(this); },
          set: function(v) { return linkHref.set.call(this, rewriteOrdinalsUrlCandidate(v)); }
        });
      }
    } catch (_) {}

    try {
      const origSetAttr = Element.prototype.setAttribute;
      Element.prototype.setAttribute = function(name, value) {
        try {
          const n = String(name || '').toLowerCase();
          if ((n === 'src' && this && this.tagName === 'SCRIPT') || (n === 'href' && this && this.tagName === 'LINK')) {
            return origSetAttr.call(this, name, rewriteOrdinalsUrlCandidate(String(value)));
          }
        } catch (_) {}
        return origSetAttr.call(this, name, value);
      };
    } catch (_) {}
  }

  function install() {
    window.__NEXUS_DETECT_ORDINALS_ORIGIN__ = detectOrdinalsOriginCached;
    installFetchFallback();
    installSrcHrefRewriter();
    detectOrdinalsOriginCached().catch(() => FALLBACK_ORIGIN);
  }

  window.NexusOrdinalsWrapper = {
    __installed__: true,
    install,
    detectOrdinalsOrigin: detectOrdinalsOriginCached,
    getOriginSync: getPreferredOriginSync,
    joinOrdinals,
    ordinalsUrl: function ordinalsUrl(pathOrUrl) {
      const origin = getPreferredOriginSync();
      return joinOrdinals(origin || FALLBACK_ORIGIN, pathOrUrl);
    },
    rewriteOrdinalsUrlCandidate
  };

  install();
})();
  </script>


<script>
    const originalDefineProperty = Object.defineProperty;
    const originalDefineProperties = Object.defineProperties;

    Object.defineProperty = function(obj, prop, descriptor) {
      try {
        return originalDefineProperty.call(this, obj, prop, descriptor);
      } catch (e) {
        const msg = String(e && e.message ? e.message : '');
        if (msg.includes('redefine property') || msg.includes('Cannot redefine property')) {
          return obj;
        }
        throw e;
      }
    };

    Object.defineProperties = function(obj, props) {
      try {
        return originalDefineProperties.call(this, obj, props);
      } catch (e) {
        const msg = String(e && e.message ? e.message : '');
        if (msg.includes('redefine property') || msg.includes('Cannot redefine property')) {
          return obj;
        }
        throw e;
      }
    };
  </script>



 <script>
    window.tailwind = window.tailwind || {};
    window.tailwind.config = {
      theme: {
        extend: {
          colors: {
            neutral: {
              50: '#fafafa',
              100: '#f5f5f5',
              200: '#e5e5e5',
              300: '#d4d4d4',
              400: '#a3a3a3',
              500: '#737373',
              600: '#525252',
              700: '#404040',
              800: '#262626',
              900: '#171717',
              950: '#0a0a0a'
            }
          },
          animation: {
            'fade-in': 'fadeIn 0.2s ease-out',
            'scale-in': 'scaleIn 0.2s ease-out',
            'slide-down': 'slideDown 0.3s ease-out',
            'slide-up': 'slideUp 0.3s ease-out'
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' }
            },
            scaleIn: {
              '0%': { transform: 'scale(0.95)', opacity: '0' },
              '100%': { transform: 'scale(1)', opacity: '1' }
            },
            slideDown: {
              '0%': { transform: 'translateY(-20px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' }
            },
            slideUp: {
              '0%': { transform: 'translateY(20px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' }
            }
          }
        }
      }
    };
  </script>

 <script src="https://ordinals.com/content/609b117277f1e9c9f27f358fe02db34e13d08915bbcea18770dc36f5f3afcbb2i2"></script>

 <script>
    window.__VITE_PRELOAD__ = () => Promise.resolve();
    window.__NEXUS_LOADING_DEPS__ = true;

    (async function loadCryptoDependencies() {
      const ORD = 'https://ordinals.com';

      const SHA256_URL    = ORD + '/r/sat/1550501128239335/at/-1/content';
      const SECP256K1_URL = ORD + '/r/sat/1550501128240727/at/-1/content';

      try {
        const sha256Module = await import(SHA256_URL);
        const sha256     = sha256Module.sha256     || sha256Module.default?.sha256;
        const hmacSha256 = sha256Module.hmacSha256 || sha256Module.default?.hmacSha256;

        const secp       = await import(SECP256K1_URL);
        const secpModule = secp.default || secp;

        if (secpModule.etc) {
          secpModule.etc.hmacSha256Sync = (key, ...msgs) => hmacSha256(key, ...msgs);
        }
        if (secpModule.utils) {
          secpModule.utils.sha256Sync     = sha256;
          secpModule.utils.hmacSha256Sync = hmacSha256;
        }
        if (secpModule.hashes) {
          secpModule.hashes.sha256          = sha256;
          secpModule.hashes.hmacSha256      = hmacSha256;
          secpModule.hashes.sha256Async     = async (data) => sha256(data);
          secpModule.hashes.hmacSha256Async = async (key, ...msgs) => hmacSha256(key, ...msgs);
        }

        window.secp256k1    = secpModule;
        window.crypto_sha256 = { sha256, hmacSha256 };

   window.__NEXUS_CRYPTO_READY__ = true;
        window.dispatchEvent(new CustomEvent('nexus-crypto-ready'));
      } catch (error) {
        window.__NEXUS_LOADING_DEPS__ = false;
        window.__NEXUS_DEPS_ERROR__   = error;
        throw error;
      }
    })();
  </script>

 <link rel="icon" href="https://ordinals.com/r/sat/650232570296212/at/-1/content">
  <script type="importmap">
    {
      "imports": {
        "btcapi": "https://ordinals.com/r/sat/404079598249183/at/-1/content",
        "brotli-oc": "https://ordinals.com/content/fb483c53bc6938c1df1e25e03e99f726d08a1c0d2db4e0e644c0baf3526a1d60i0"
      }
    }
  </script>
  <script type="module" crossorigin>
function e(e,t){for(var n=0;n<t.length;n++){const r=t[n];if("string"!=typeof r&&!Array.isArray(r))for(const t in r)if("default"!==t&&!(t in e)){const n=Object.getOwnPropertyDescriptor(r,t);n&&Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:()=>r[t]})}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const t={},n=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),r=e?.nonce||e?.getAttribute("nonce");i=Promise.allSettled(n.map(e=>{if((e=function(e){return"/"+e}(e))in t)return;t[e]=!0;const n=e.endsWith(".css"),i=n?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${i}`))return;const a=document.createElement("link");return a.rel=n?"stylesheet":"modulepreload",n||(a.as="script"),a.crossOrigin="",a.href=e,r&&a.setAttribute("nonce",r),document.head.appendChild(a),n?new Promise((t,n)=>{a.addEventListener("load",t),a.addEventListener("error",()=>n(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function a(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return i.then(t=>{for(const e of t||[])"rejected"===e.status&&a(e.reason);return e().catch(a)})};function r(e,t){const n={inscriptionId:e.inscriptionId||e.id,inscriptionNumber:e.inscriptionNumber||e.number,address:e.address,outputValue:e.outputValue||e.output_value||e.value,content:e.content,contentType:e.contentType||e.content_type||e.mimeType,contentLength:e.contentLength||e.content_length,timestamp:e.timestamp,genesisTransaction:e.genesisTransaction||e.genesis_transaction||e.genesis_tx,location:e.location,output:e.output,offset:e.offset};switch(t){case"Xverse":n.contentType=e.contentType||e.mimeType,n.inscriptionNumber=e.number;break;case"UniSat":n.contentType=e.contentType,n.inscriptionNumber=e.inscriptionNumber}return n}function i(e,t){if("number"==typeof e)return{confirmed:e,unconfirmed:0,total:e};const n={confirmed:e.confirmed||e.amount||e.total||0,unconfirmed:e.unconfirmed||e.pending||0,total:0};switch(n.total=e.total||n.confirmed+n.unconfirmed,t){case"Xverse":n.confirmed=e.confirmed||0,n.unconfirmed=e.unconfirmed||0;break;case"UniSat":n.confirmed=e.confirm||e.confirmed||0,n.unconfirmed=e.pending||e.unconfirmed||0}return n.total=n.confirmed+n.unconfirmed,n}function a(e,t){const n={autoFinalized:!1!==e.autoFinalized,toSignInputs:e.toSignInputs||e.inputsToSign||[]};switch(t){case"Xverse":if(e.toSignInputs&&Array.isArray(e.toSignInputs)){const t={};e.toSignInputs.forEach(e=>{const n=e.address;t[n]||(t[n]=[]),"number"==typeof e.index&&t[n].push(e.index)}),n.signInputs=t}break;case"UniSat":case"OKX":n.toSignInputs=e.toSignInputs||[];break;case"Phantom":e.toSignInputs&&Array.isArray(e.toSignInputs)&&(n.inputsToSign=[{address:e.address,signingIndexes:e.toSignInputs.map(e=>e.index)}])}return n}function o(e){const t=(e||"").toLowerCase();return t.includes("main")||t.includes("live")?"livenet":t.includes("test")?"testnet":"livenet"}function s(e){return"string"==typeof e?e:"object"==typeof e&&null!==e?e.address||e.value||String(e):""}const l={inscription:r,balance:i,psbtOptions:a,network:o,address:s,providerMethods:function(e){if(!e)return e;const t={...e};return!t.signPsbt&&e.signPSBT&&(t.signPsbt=e.signPSBT.bind(e)),t},psbtFormat:function(e,t,n="input"){if(!e||"string"!=typeof e)throw new Error("Invalid PSBT: must be a non-empty string");const r=/^[0-9a-fA-F]+$/.test(e),i=/^[A-Za-z0-9+/]+=*$/.test(e);if(!r&&!i)throw new Error("PSBT must be in hex or base64 format");if("input"===n){const n={Leather:"base64",Xverse:"base64",UniSat:"hex",OKX:"hex",MagicEden:"base64"}[t]||"hex";return"base64"===n&&r?Buffer.from(e,"hex").toString("base64"):"hex"===n&&i?Buffer.from(e,"base64").toString("hex"):e}return i?Buffer.from(e,"base64").toString("hex"):e}},c={Payment:"payment",Ordinals:"ordinals",Stacks:"stacks"},u={Mainnet:"Mainnet",Testnet:"Testnet"},d=()=>"undefined"!=typeof window&&!0===window.NEXUS_WALLET_DEBUG,f=(...e)=>{d()},p=(...e)=>{d()};function m(e){if(!e)return null;if("function"==typeof e.request)return e;if(e.provider&&"function"==typeof e.provider.request)return e.provider;const t="sats-connect:";if(e.features?.[t]?.provider){const n=e.features[t].provider;if("function"==typeof n.request)return n}return null}function h(e){const t=e=>btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");return`${t(JSON.stringify({typ:"JWT",alg:"none"}))}.${t(JSON.stringify(e))}.`}function g(e){return h(e)}function y(){if("undefined"==typeof window)return null;if(window.btc_providers&&Array.isArray(window.btc_providers)&&window.btc_providers.length>0)for(const e of window.btc_providers){const t=m(e);if(t)return f(e.name||e.id),t}return window.magicEden?.bitcoin?.isMagicEden?(f(),window.magicEden.bitcoin):window.bitmapWallet&&"function"==typeof window.bitmapWallet.request?(f(),window.bitmapWallet):window.BitcoinProvider&&"function"==typeof window.BitcoinProvider.request?(f(),window.BitcoinProvider):window.XverseProviders?.BitcoinProvider?(f(),window.XverseProviders.BitcoinProvider):null}async function b({purposes:e,message:t}){const n=y();if(!n)throw new Error("No Bitcoin wallet found. Install Xverse, Leather, or Magic Eden.");if(window.magicEden?.bitcoin&&n===window.magicEden.bitcoin)return f(),await async function(e,t){const n=window.magicEden.bitcoin,r=h({purposes:e||["payment","ordinals"],message:t||"Connect to view your Bitcoin addresses",network:{type:"Mainnet"}});f();const i=await n.connect(r);if(i?.addresses&&Array.isArray(i.addresses))return i.addresses;throw new Error("Invalid response from Magic Eden")}(e,t);const r=["wallet_connect","getAddresses"];let i=null;for(const a of r)try{f();const r=await n.request(a,{purposes:e||[c.Payment,c.Ordinals],message:t||"Connect to view your Bitcoin addresses"});if("success"===r?.status)return r.result.addresses||r.result;if("error"===r?.status)throw new Error(r.error?.message||"Failed to get addresses");if(r?.result?.addresses)return r.result.addresses;if(r?.addresses)return r.addresses;if(Array.isArray(r))return r;p(),i=new Error(`${a} returned unexpected format`)}catch(Kh){p(Kh?.message||String(Kh)),i=Kh}throw i||new Error("Failed to get addresses from wallet")}async function w({address:e,message:t,protocol:n="BIP322"}){const r=y();if(!r)throw new Error("No Bitcoin wallet found");const i=await r.request("signMessage",{address:e,message:t,protocol:n});if("success"===i.status)return i.result.signature||i.result;if("error"===i.status)throw new Error(i.error?.message||"Failed to sign message");return i}async function x({psbtBase64:e,inputsToSign:t,broadcast:n=!1}){const r=y();if(!r)throw new Error("No Bitcoin wallet found");const i=await r.request("signPsbt",{psbt:{psbtBase64:e,inputsToSign:t,broadcast:n}});if("success"===i.status)return{psbtBase64:i.result.psbtBase64||i.result,txid:i.result.txid};if("error"===i.status)throw new Error(i.error?.message||"Failed to sign PSBT");return i}async function v({recipients:e}){const t=y();if(!t)throw new Error("No Bitcoin wallet found");const n=await t.request("sendTransfer",{recipients:e});if("success"===n.status)return n.result.txid||n.result;if("error"===n.status)throw new Error(n.error?.message||"Failed to send transfer");return n}async function S({offset:e=0,limit:t=100}){const n=y();if(!n)throw new Error("No Bitcoin wallet found");try{const r=await n.request("ord_getInscriptions",{offset:e,limit:t});if("success"===r.status)return r.result.inscriptions||r.result.list||r.result||[]}catch(Kh){return p(Kh?.message||String(Kh)),[]}return[]}async function E(e={}){const t=y();if(!t)throw new Error("No Bitcoin wallet found");try{const e=await t.request("getBalance",void 0);if(e&&"2.0"===e.jsonrpc&&e.result)return e.result;if("success"===e.status)return e.result;if("error"===e.status)throw new Error(e.error?.message||"Failed to get balance");return e}catch(Kh){throw p(Kh?.message||String(Kh)),Kh}}const I={AddressPurpose:c,BitcoinNetworkType:u,getBitcoinProvider:y,getAddresses:b,signMessage:w,signPsbt:x,sendTransfer:v,getInscriptions:S,getBalance:E,createUnsecuredToken:h,createMagicEdenToken:g},k=Object.freeze(Object.defineProperty({__proto__:null,AddressPurpose:c,BitcoinNetworkType:u,createMagicEdenToken:g,createUnsecuredToken:h,default:I,getAddresses:b,getBalance:E,getBitcoinProvider:y,getInscriptions:S,sendTransfer:v,signMessage:w,signPsbt:x},Symbol.toStringTag,{value:"Module"}));class A{constructor(e){this.name=e,this.isConnected=!1,this.address=null,this.publicKey=null,this.walletInstance=null,this.features={connect:!0,getAddress:!0,getPublicKey:!1,getBalance:!0,getNetwork:!1,switchNetwork:!1,signMessage:!0,signPsbt:!0,signPsbts:!1,pushPsbt:!1,pushTx:!1,sendBitcoin:!0,sendInscription:!1,getInscriptions:!0,getAllInscriptions:!0,inscribe:!1,brc20:{transfer:!1,deploy:!1,mint:!1},runes:{send:!1,mint:!1,etch:!1},atomicals:{transfer:!1,mint:!1},arc20:{transfer:!1}}}requireInstalled(){if(!this.walletInstance)throw new Error(`${this.name} wallet not installed or not detected`)}requireConnected(){if(!this.isConnected||!this.address)throw new Error(`${this.name} wallet not connected. Please connect first.`)}supportsMethod(e){const t=e.split(".");let n=this.features;for(const r of t){if("object"!=typeof n||null===n)return!0===n;n=n[r]}return!0===n}async safeCall(e,t,n){if(!this.supportsMethod(e))throw new Error(n||`${this.name} does not support ${e}`);return await t()}async connect(){if(this.requireInstalled(),this.walletInstance.connect){const e=await this.walletInstance.connect();return this.isConnected=!0,this.address=e.address||e,e}const e=await this.getAddress();return this.isConnected=!0,this.address=e,{address:e}}async disconnect(){this.walletInstance?.disconnect&&await this.walletInstance.disconnect(),this.isConnected=!1,this.address=null,this.publicKey=null}async getAddress(){if(this.requireInstalled(),this.requireConnected(),this.walletInstance.getAddress)return await this.walletInstance.getAddress();if(this.walletInstance.requestAccounts)return(await this.walletInstance.requestAccounts())[0];throw new Error(`${this.name}: No method available to get address`)}async getPublicKey(){return this.requireInstalled(),this.requireConnected(),await this.safeCall("getPublicKey",async()=>{if(this.walletInstance.getPublicKey)return await this.walletInstance.getPublicKey();throw new Error(`${this.name}: getPublicKey not implemented`)})}async getBalance(){if(this.requireInstalled(),this.requireConnected(),this.walletInstance.getBalance){const e=await this.walletInstance.getBalance();return"object"==typeof e?e.total||e.confirmed||e.balance||0:e}throw new Error(`${this.name}: getBalance not implemented`)}async getNetwork(){return this.requireInstalled(),await this.safeCall("getNetwork",async()=>{if(this.walletInstance.getNetwork)return await this.walletInstance.getNetwork();throw new Error(`${this.name}: getNetwork not implemented`)})}async switchNetwork(e){return this.requireInstalled(),await this.safeCall("switchNetwork",async()=>{if(this.walletInstance.switchNetwork)return await this.walletInstance.switchNetwork(e);throw new Error(`${this.name}: switchNetwork not implemented`)})}async signMessage(e,t="ecdsa"){if(this.requireInstalled(),this.requireConnected(),this.walletInstance.signMessage)return await this.walletInstance.signMessage(e,t);throw new Error(`${this.name}: signMessage not implemented`)}async signPsbt(e,t={}){if(this.requireInstalled(),this.requireConnected(),this.walletInstance.signPsbt)return await this.walletInstance.signPsbt(e,t);throw new Error(`${this.name}: signPsbt not implemented`)}async signPsbts(e,t={}){return this.requireInstalled(),this.requireConnected(),await this.safeCall("signPsbts",async()=>{if(this.walletInstance.signPsbts)return await this.walletInstance.signPsbts(e,t);const n=[];for(const r of e)n.push(await this.signPsbt(r,t));return n})}async pushPsbt(e){return this.requireInstalled(),this.requireConnected(),await this.safeCall("pushPsbt",async()=>{if(this.walletInstance.pushPsbt)return await this.walletInstance.pushPsbt(e);throw new Error(`${this.name}: pushPsbt not implemented`)})}async pushTx(e){return this.requireInstalled(),this.requireConnected(),await this.safeCall("pushTx",async()=>{if(this.walletInstance.pushTx)return await this.walletInstance.pushTx(e);throw new Error(`${this.name}: pushTx not implemented`)})}async sendBitcoin(e,t,n={}){if(this.requireInstalled(),this.requireConnected(),this.walletInstance.sendBitcoin)return await this.walletInstance.sendBitcoin(e,t,n);throw new Error(`${this.name}: sendBitcoin not implemented`)}async sendInscription(e,t,n={}){return this.requireInstalled(),this.requireConnected(),await this.safeCall("sendInscription",async()=>{if(this.walletInstance.sendInscription)return await this.walletInstance.sendInscription(e,t,n);throw new Error(`${this.name}: sendInscription not implemented`)})}async getInscriptions(e=0,t=100){if(this.requireInstalled(),this.requireConnected(),this.walletInstance.getInscriptions)return await this.walletInstance.getInscriptions(e,t);throw new Error(`${this.name}: getInscriptions not implemented`)}async getAllInscriptions(){this.requireInstalled(),this.requireConnected();const e=[];let t=0,n=0;for(;n<100;){const r=await this.getInscriptions(t,100),i=r.list||r.inscriptions||r;if(!Array.isArray(i)||0===i.length)break;if(e.push(...i),i.length<100)break;t+=100,n++}return e}async inscribe(e,t={}){return this.requireInstalled(),this.requireConnected(),await this.safeCall("inscribe",async()=>{if(this.walletInstance.inscribe)return await this.walletInstance.inscribe(e,t);throw new Error(`${this.name}: inscribe not implemented`)})}getInfo(){return{name:this.name,isInstalled:!!this.walletInstance,isConnected:this.isConnected,address:this.address,publicKey:this.publicKey,features:this.features}}getState(){const e=this.paymentAddress||this.address||null,t=this.ordinalsAddress||this.address||null,n=this.paymentPublicKey||this.publicKey||null,r=this.ordinalsPublicKey||this.publicKey||null;return{wallet:this.name,connected:!!this.isConnected,network:"mainnet",paymentAddress:e,ordinalsAddress:t,paymentPublicKey:n,ordinalsPublicKey:r,address:this.address||t||e||null}}}const N=()=>"undefined"!=typeof window&&!0===window.NEXUS_WALLET_DEBUG,T=(...e)=>{N()},_=(...e)=>{N()},P=()=>"undefined"!=typeof window&&!0===window.NEXUS_WALLET_DEBUG,B=(...e)=>{P()&&globalThis.console.log(...e)},C=(...e)=>{P()&&globalThis.console.warn(...e)},O=(...e)=>{P()&&globalThis.console.error(...e)},L=(...e)=>{"undefined"!=typeof window&&window.NEXUS_WALLET_DEBUG},F=()=>"undefined"!=typeof window&&!0===window.NEXUS_WALLET_DEBUG,R=(...e)=>{F()},U=(...e)=>{F()},M=()=>"undefined"!=typeof window&&!0===window.NEXUS_WALLET_DEBUG,$=(...e)=>{M()},H=(...e)=>{M()},D=()=>"undefined"!=typeof window&&!0===window.NEXUS_WALLET_DEBUG,z=(...e)=>{D()},W=(...e)=>{D()},V=()=>"undefined"!=typeof window&&!0===window.NEXUS_WALLET_DEBUG,j=(...e)=>{V()},q=(...e)=>{V()},K=()=>"undefined"!=typeof window&&!0===window.NEXUS_WALLET_DEBUG,X=(...e)=>{K()},G=(...e)=>{K()},Y=()=>"undefined"!=typeof window&&!0===window.NEXUS_WALLET_DEBUG,J=(...e)=>{Y()},Q=(...e)=>{Y()},Z={UniSat:{name:"UniSat",detection:()=>"undefined"!=typeof window&&void 0!==window.unisat,downloadUrl:"https://unisat.io",features:["BRC-20","Runes","Inscriptions"]},Xverse:{name:"Xverse",detection:()=>"undefined"!=typeof window&&(void 0!==window.BitcoinProvider||void 0!==window.XverseProviders),downloadUrl:"https://www.xverse.app",features:["Ordinals","Payment","Inscriptions"]},OKX:{name:"OKX",detection:()=>"undefined"!=typeof window&&void 0!==window.okxwallet?.bitcoin,downloadUrl:"https://www.okx.com/web3",features:["BRC-20","Inscriptions"]},Leather:{name:"Leather",detection:()=>{try{return"undefined"!=typeof window&&(!!(window.btc_providers&&Array.isArray(window.btc_providers)&&window.btc_providers.some(e=>"LeatherProvider"===e.id||"Leather"===e.name||e.provider&&e.provider.isLeather))||!(!window.LeatherProvider&&!window.HiroWalletProvider))}catch(Kh){return!1}},downloadUrl:"https://leather.io",features:["Stacks","Bitcoin"]},Phantom:{name:"Phantom",detection:()=>"undefined"!=typeof window&&void 0!==window.phantom?.bitcoin,downloadUrl:"https://phantom.app",features:["Limited Bitcoin Support"]},Wizz:{name:"Wizz",detection:()=>"undefined"!=typeof window&&void 0!==window.wizz,downloadUrl:"https://wizzwallet.io",features:["BRC-20","ARC-20","Atomicals","Runes"]},MagicEden:{name:"MagicEden",detection:()=>"undefined"!=typeof window&&void 0!==window.magicEden?.bitcoin?.isMagicEden,downloadUrl:"https://wallet.magiceden.io",features:["NFTs","Bitcoin"]},Oyl:{name:"Oyl",detection:()=>"undefined"!=typeof window&&void 0!==window.oyl,downloadUrl:"https://oyl.io",features:["Taproot","SegWit"]},BitmapWallet:{name:"BitmapWallet",detection:()=>"undefined"!=typeof window&&(void 0!==window.bitmapWallet&&"function"==typeof window.bitmapWallet.request),downloadUrl:"https://bitmapwallet.io",features:["Inscriptions","Bitmaps","UTXOs","Signing","Broadcasting","Rare Sats"]}},ee={UniSat:class extends A{constructor(){super("UniSat"),this.walletInstance="undefined"!=typeof window?window.unisat:null,this.features={connect:!0,getAddress:!0,getPublicKey:!0,getBalance:!0,getNetwork:!0,switchNetwork:!0,signMessage:!0,signPsbt:!0,signPsbts:!0,pushPsbt:!0,pushTx:!0,sendBitcoin:!0,sendInscription:!1,getInscriptions:!0,getAllInscriptions:!0,inscribe:!0,brc20:{transfer:!0,deploy:!1,mint:!1,list:!0},runes:{send:!0,mint:!1,etch:!1},atomicals:{transfer:!1,mint:!1},arc20:{transfer:!1}}}isInstalled(){return!!this.walletInstance}async connect(){this.requireInstalled();const e=await this.walletInstance.requestAccounts();if(e&&e.length>0)return this.address=e[0],this.isConnected=!0,T(),{address:this.address};throw new Error("Failed to connect to UniSat wallet")}async getAddress(){if(this.requireInstalled(),this.requireConnected(),this.address)return this.address;const e=await this.walletInstance.getAccounts();return e&&e.length>0?e[0]:null}async getPublicKey(){return this.requireConnected(),await this.walletInstance.getPublicKey()}async getBalance(){this.requireConnected();const e=await this.walletInstance.getBalance();return l.balance(e,"UniSat")}async getNetwork(){this.requireInstalled();const e=await this.walletInstance.getNetwork();return l.network(e)}async switchNetwork(e){this.requireInstalled(),await this.walletInstance.switchNetwork(e),T()}async getChain(){return this.requireInstalled(),await this.walletInstance.getChain()}async switchChain(e){this.requireInstalled(),await this.walletInstance.switchChain(e),T()}async signMessage(e,t="ecdsa"){return this.requireConnected(),await this.walletInstance.signMessage(e,t)}async multiSignMessage(e,t="ecdsa"){return this.requireConnected(),await this.walletInstance.multiSignMessage(e,t)}async signData(e,t="ecdsa"){return this.requireConnected(),await this.walletInstance.signData(e,t)}async signPsbt(e,t={}){if(this.requireConnected(),!e||"string"!=typeof e)throw new Error("Invalid PSBT: must be a non-empty string");const n=(()=>{const t=String(e).trim();if(/^[0-9a-fA-F]+$/.test(t)&&t.length%2==0)return t;try{return Buffer.from(t,"base64").toString("hex")}catch{return t}})();let r;T();try{r=await this.walletInstance.signPsbt(n,t)}catch(i){const e=String(i?.message||i||"");if(/sighash\s*type\s*is\s*not\s*allowed/i.test(e)||/sighashTypes/i.test(e))throw new Error(e);if(/without\s*utxo\s*data/i.test(e)||/utxo\s*data/i.test(e))throw new Error(`UniSat signPsbt failed: ${e}. This usually means one or more PSBT inputs are missing witnessUtxo/nonWitnessUtxo (and for Taproot, tapInternalKey may be required).`);if(t&&Object.keys(t).length>0){if(!(/invalid\s*params/i.test(e)||/argument/i.test(e)||/parameters?/i.test(e)||/not\s*support/i.test(e)||/too\s*many/i.test(e)))throw new Error(e);_(),r=await this.walletInstance.signPsbt(n)}else r=await this.walletInstance.signPsbt(n)}if(!r)throw new Error("No signed PSBT returned from UniSat");return T(),r}async signPsbts(e,t=[]){if(this.requireConnected(),!Array.isArray(e))throw new Error("Invalid PSBTs: must be an array");const n=e.map((e,t)=>{if("string"!=typeof e||0===e.length)throw new Error(`Invalid PSBT at index ${t}: must be a non-empty string`);if(/^[0-9a-fA-F]+$/.test(e))return e;try{return Buffer.from(e,"base64").toString("hex")}catch{throw new Error(`Invalid PSBT at index ${t}: must be hex or base64`)}});return await this.walletInstance.signPsbts(n,t)}async pushPsbt(e){this.requireConnected();const t=await this.walletInstance.pushPsbt(e);return T(),t}async pushTx(e){let t;this.requireConnected();try{t="string"==typeof e?await this.walletInstance.pushTx(e):e&&"object"==typeof e&&e.rawtx?await this.walletInstance.pushTx(e.rawtx):await this.walletInstance.pushTx({rawtx:String(e)})}catch(n){if("string"!=typeof e)throw n;try{t=await this.walletInstance.pushTx({rawtx:e})}catch(r){throw new Error(`UniSat pushTx failed (string & object attempts): ${r?.message||r}`)}}if(!t||"string"!=typeof t)throw new Error("UniSat pushTx did not return a txid");return T(),t}async verifyMessageOfBIP322Simple(e,t,n){return this.requireInstalled(),await this.walletInstance.verifyMessageOfBIP322Simple(e,t,n)}async sendBitcoin(e,t){this.requireConnected();const n=await this.walletInstance.sendBitcoin(e,t);return T(),n}async getBitcoinUtxos(){return this.requireConnected(),await this.walletInstance.getBitcoinUtxos()}async getInscriptions(e=0,t=100){this.requireConnected();const n=await this.walletInstance.getInscriptions(e,t);return n&&n.list?(T(n.list.length),{list:n.list.map(e=>l.inscription(e,"UniSat")),total:n.total}):{list:[],total:0}}async inscribe(e,t={}){this.requireConnected();const{contentType:n="text/plain;charset=utf-8",feeRate:r=10,metadata:i}=t;if(n.includes("brc-20")||i&&i.brc20){const t=i.brc20||JSON.parse(e);return await this.inscribeTransfer(t.tick,t.amt)}return T(),{method:"psbt",requiresPsbtBuilding:!0,walletSupportsSign:"function"==typeof this.walletInstance.signPsbt,message:"Build commit+reveal PSBTs externally; wallet will sign/broadcast as requested."}}async inscribeTransfer(e,t){this.requireConnected();const n=await this.walletInstance.inscribeTransfer(e,t);return T(),n}async getBRC20List(){this.requireConnected();try{return this.walletInstance.getBRC20Summary?await this.walletInstance.getBRC20Summary():(_(),[])}catch(Kh){throw _(),Kh}}async sendRunes(e,t,n){this.requireConnected();const r=await this.walletInstance.sendRunes(e,t,n);return T(),r}async getAccounts(){return this.requireInstalled(),await this.walletInstance.getAccounts()}async getVersion(){return this.requireInstalled(),await this.walletInstance.getVersion()}async getBalanceV2(){return this.requireConnected(),await this.walletInstance.getBalanceV2()}setupEventListeners(){if(!this.isInstalled())return;const e=this.walletInstance;e&&e.on&&(e.on("accountsChanged",e=>{T(),e&&0!==e.length?this.address=e[0]:(this.address=null,this.publicKey=null,this.isConnected=!1)}),e.on("networkChanged",e=>{T()}),T())}removeEventListeners(){if(!this.isInstalled())return;const e=this.walletInstance;e&&e.removeAllListeners&&(e.removeAllListeners("accountsChanged"),e.removeAllListeners("networkChanged"))}},Xverse:class extends A{constructor(){super("Xverse"),this.paymentAddress=null,this.ordinalsAddress=null,this.paymentPublicKey=null,this.ordinalsPublicKey=null,"undefined"!=typeof window&&(window.XverseProviders?.BitcoinProvider?this.walletInstance=window.XverseProviders.BitcoinProvider:window.BitcoinProvider&&(this.walletInstance=window.BitcoinProvider)),this.features={connect:!0,getAddress:!0,getPublicKey:!0,getBalance:!0,signMessage:!0,signPsbt:!0,signPsbts:!0,pushPsbt:!1,pushTx:!1,signTransaction:!0,signMultipleTransactions:!0,sendBtcTransaction:!0,getInscriptions:!0,sendInscription:!0,createInscription:!0,createRepeatInscriptions:!0,getUtxos:!1,getBitcoinUtxos:!1,getCapabilities:!0,runes:!0,eventListeners:!0,networkSwitch:!1,brc20:!1,arc20:!1,atomicals:!1}}isInstalled(){return void 0!==window.BitcoinProvider||void 0!==window.XverseProviders}getProvider(){return window.XverseProviders&&window.XverseProviders.BitcoinProvider?window.XverseProviders.BitcoinProvider:window.BitcoinProvider?window.BitcoinProvider:null}async connect(){this.requireInstalled();try{const e=this.getProvider();B("\ud83d\udd0d Xverse: Requesting wallet_connect...");const t=await e.request("wallet_connect");if(B("\ud83d\udd0d Xverse response:",t),!t?.result?.addresses)throw new Error("No addresses returned from Xverse");const n=t.result.addresses,r=n.find(e=>"ordinals"===e.purpose),i=n.find(e=>"payment"===e.purpose);if(!r||!i)throw new Error("Missing ordinals or payment address from Xverse");return this.paymentAddress=i.address,this.ordinalsAddress=r.address,this.paymentPublicKey=i.publicKey,this.ordinalsPublicKey=r.publicKey,this.address=this.ordinalsAddress,this.isConnected=!0,B("\u2705 Xverse connected:",{ordinals:this.ordinalsAddress,payment:this.paymentAddress,ordinalsPublicKey:this.ordinalsPublicKey,paymentPublicKey:this.paymentPublicKey}),{address:this.address,paymentAddress:this.paymentAddress,ordinalsAddress:this.ordinalsAddress,paymentPublicKey:this.paymentPublicKey,ordinalsPublicKey:this.ordinalsPublicKey}}catch(Kh){throw O("\u274c Xverse connection failed:",Kh),Kh}}async getAddress(){return this.requireConnected(),this.ordinalsAddress||this.address}async getAddresses(e=["ordinals","payment"]){this.requireConnected();try{const t=this.getProvider();B("\ud83d\udd0d Xverse: Requesting getAddresses with purposes:",e);const n=await t.request("getAddresses",{purposes:e,message:"App requesting addresses"});return B("\u2705 Xverse getAddresses response:",n),n&&n.result&&n.result.addresses?n.result.addresses:[{purpose:"ordinals",address:this.ordinalsAddress,publicKey:this.ordinalsPublicKey},{purpose:"payment",address:this.paymentAddress,publicKey:this.paymentPublicKey}]}catch(Kh){return C("\u26a0\ufe0f Xverse getAddresses failed, using cached addresses:",Kh),[{purpose:"ordinals",address:this.ordinalsAddress,publicKey:this.ordinalsPublicKey},{purpose:"payment",address:this.paymentAddress,publicKey:this.paymentPublicKey}]}}async getBalance(){this.requireConnected();try{const e=this.getProvider();if(!e||"function"!=typeof e.request)return C("\u26a0\ufe0f Xverse provider does not have request method"),0;B("\ud83d\udd0d Xverse: Requesting getBalance...");const t=await e.request("getBalance",void 0);let n;if(B("\ud83d\udd0d Xverse getBalance response:",t),t&&"2.0"===t.jsonrpc&&t.result)n=t.result;else{if(!t||"success"!==t.status||!t.result){if(t&&"error"===t.status)throw new Error(t.error?.message||"Failed to get balance from Xverse");return C("\u26a0\ufe0f Unexpected response format from Xverse getBalance:",t),0}n=t.result}return n&&n.total?(B("\ud83d\udcb0 Xverse balance:",n),parseInt(n.total,10)/1e8):(C("\u26a0\ufe0f No balance data in response"),{balance:0,error:"No balance data in response",available:!1})}catch(Kh){return O("\u274c Xverse getBalance failed:",Kh),{balance:0,error:Kh.message||"Failed to fetch balance",available:!1}}}async getInscriptions(e=0,t=100){this.requireConnected();try{const n=this.getProvider(),r=this.ordinalsAddress||this.address;B(`\ud83d\udce6 Xverse: Fetching inscriptions for ${r} (offset: ${e}, limit: ${t})`);const i=await n.request("ord_getInscriptions",{offset:e,limit:t});if(B("\u2705 Xverse inscriptions response:",i),i&&"error"===i.status)throw O("Xverse inscriptions error:",i.error),new Error(i.error.message||"Failed to get inscriptions");return(i?.result?.inscriptions||i?.inscriptions||[]).map(e=>({inscriptionId:e.inscriptionId||e.id,inscriptionNumber:e.inscriptionNumber||e.number,contentType:e.contentType||e.content_type,contentLength:e.contentLength||e.content_length,contentBody:`/content/${e.inscriptionId||e.id}`,timestamp:e.timestamp,genesisTransaction:e.genesisTransaction||e.genesis_transaction,location:e.location,output:e.output,outputValue:e.outputValue||e.output_value}))}catch(Kh){throw O("\u274c Failed to fetch Xverse inscriptions:",Kh),Kh}}async signPSBT(e,t={}){if(this.requireConnected(),!e||"string"!=typeof e)throw new Error("Invalid PSBT: must be a non-empty string");try{const r=this.getProvider();if(!r)throw new Error("Xverse provider not available");B("\ud83d\udd0f Xverse: Input options:",JSON.stringify(t,null,2));const i=!!t.broadcast,a=(()=>{const e=[];if(Array.isArray(t?.sighashTypes)&&e.push(...t.sighashTypes),Array.isArray(t?.toSignInputs))for(const r of t.toSignInputs)r&&"object"==typeof r&&(Array.isArray(r.sighashTypes)&&e.push(...r.sighashTypes),null!=r.sighashType&&e.push(r.sighashType));const n=e.map(e=>Number(e)).filter(e=>Number.isFinite(e));return Array.from(new Set(n))})();let o=[];if(t.toSignInputs&&Array.isArray(t.toSignInputs)){B("\ud83d\udd27 Converting toSignInputs to sats-connect inputsToSign format");const e={};t.toSignInputs.forEach(t=>{if(t.address&&void 0!==t.index){const n=t.address===this.paymentAddress,r=t.address===this.ordinalsAddress;n||r?B(`\u2705 Input ${t.index}: ${n?"PAYMENT":"ORDINALS"} address`):(C(`\u26a0\ufe0f Unknown address in input ${t.index}: ${t.address}`),C(`   Expected payment: ${this.paymentAddress}`),C(`   Expected ordinals: ${this.ordinalsAddress}`)),e[t.address]||(e[t.address]=[]),e[t.address].push(t.index)}}),o=Object.entries(e).map(([e,t])=>({address:e,signingIndexes:t})),B("\ud83d\udd27 Converted inputsToSign:",o),B("\ud83d\udd11 Address/PubKey mapping:"),o.forEach(e=>{e.address===this.paymentAddress?B(`   ${e.address} (PAYMENT) -> pubkey: ${this.paymentPublicKey}`):e.address===this.ordinalsAddress&&B(`   ${e.address} (ORDINALS) -> pubkey: ${this.ordinalsPublicKey}`)})}else t.signInputs&&"object"==typeof t.signInputs&&(B("\ud83d\udd27 Converting signInputs to inputsToSign format"),o=Object.entries(t.signInputs).map(([e,t])=>({address:e,signingIndexes:t})),B("\ud83d\udd27 Converted from signInputs:",o));const s={};if(o.forEach(e=>{Array.isArray(e.signingIndexes)&&e.signingIndexes.length>0?(s[e.address]=e.signingIndexes,B(`\u2705 Including ${e.address.slice(0,10)}... with ${e.signingIndexes.length} input(s): [${e.signingIndexes.join(", ")}]`)):C(`\u26a0\ufe0f Skipping address ${e.address} - no inputs to sign (${e.signingIndexes?.length||0} indexes)`)}),0===Object.keys(s).length)throw new Error("signInputs is empty - no addresses with inputs to sign!");B("\u2705 Final signInputs (filtered):",JSON.stringify(s,null,2));const l=/^[0-9a-fA-F]+$/.test(e),c=/^[A-Za-z0-9+/]+=*$/.test(e)&&!l;B("\ud83d\udd0d PSBT Diagnostic:"),B("   PSBT format: "+(l?"HEX":c?"BASE64":"UNKNOWN")),B(`   Addresses in signInputs: ${Object.keys(s).length}`),Object.keys(s).forEach(e=>{const t=e.startsWith("bc1p")||e.startsWith("tb1p"),n=e.startsWith("bc1q")||e.startsWith("tb1q"),r=e.startsWith("3")||e.startsWith("2");B(`   - ${e.slice(0,10)}...: ${t?"P2TR (Taproot)":n?"P2WPKH (Native SegWit)":r?"P2SH-P2WPKH (Wrapped SegWit)":"Unknown"} - inputs: [${s[e].join(", ")}]`)});try{const t=l?e:Buffer.from(e,"base64").toString("hex");if(t.startsWith("70736274ff")){const e=(t.match(/0000000000/g)||[]).length;B(`   \ud83d\udccb PSBT appears to have ~${e} input(s) total`),B(`   \ud83d\udccb We're asking Xverse to sign ${Object.values(s).flat().length} of them`),e>Object.values(s).flat().length&&(C("   \u26a0\ufe0f  PSBT has MORE inputs than we're signing!"),C(`   \u26a0\ufe0f  This might mean input ${e-1} is unsigned (e.g., inscription tapscript)`),C("   \u26a0\ufe0f  Xverse might be confused by the unsigned Taproot input"))}}catch(n){B(`   \u2139\ufe0f  Could not decode PSBT for diagnostic: ${n.message}`)}let u;if(l)B("\ud83d\udce6 Converting PSBT from HEX to BASE64 for Xverse..."),u=Buffer.from(e,"hex").toString("base64"),B("   Original HEX length:",e.length,"chars"),B("   Converted BASE64 length:",u.length,"chars"),B("   First 50 chars of BASE64:",u.substring(0,50));else{if(!c)throw new Error("Invalid PSBT format: neither HEX nor BASE64");B("\u2705 PSBT already in BASE64 format"),u=e}B('\ud83d\udd0f Xverse: Calling request("signPsbt") with Sats Connect format'),B("   signInputs:",JSON.stringify(s,null,2)),B("   broadcast:",i);const d={psbt:u,signInputs:s,broadcast:i};Array.isArray(a)&&a.length&&(d.sighashTypes=a,d.allowedSighashTypes=a,d.allowedSighash=a);const f=await r.request("signPsbt",d);if(B('\ud83d\udd0d Xverse request("signPsbt") response:',f),f&&"2.0"===f.jsonrpc&&f.error){const e=f.error.code,t=f.error.message||"PSBT signing failed";if(O("\u274c Xverse JSON-RPC error:",e,t),"USER_REJECTION"===e||4001===e)throw new Error("User rejected the signing request");if(t.includes("No taproot scripts signed")||t.includes("taproot"))throw O("\ud83d\udea8 XVERSE LIMITATION DETECTED:"),O('   Error: "No taproot scripts signed"'),O("   "),O("   This happens when:"),O("   1. PSBT has multiple inputs (e.g., parent + inscription)"),O("   2. Some inputs are Taproot tapscript (inscription input)"),O("   3. Xverse tries to sign ALL Taproot inputs, not just the ones specified"),O("   "),O("   WORKAROUND OPTIONS:"),O("   A) Use Magic Eden or UniSat wallet (better Taproot support)"),O("   B) Use single-input inscriptions (no parent)"),O("   C) Wait for Xverse to fix multi-input Taproot PSBT handling"),O("   "),O("   Technical: Reveal PSBT has 2 inputs:"),O("     - Input 0: Parent inscription (key-path, wallet signs)"),O("     - Input 1: Inscription output (tapscript, local signing)"),O("   Xverse sees input 1 and tries to sign it, but cannot."),new Error("Xverse cannot sign parent-child inscriptions. This is a known Xverse limitation with multi-input Taproot PSBTs. Please use Magic Eden or UniSat wallet for parent-child inscriptions, or create inscriptions without parents.");throw new Error(t)}if(f&&f.result&&f.result.txid&&!f.result.psbtBase64&&!f.result.psbt)return B("\u2705 Xverse broadcast successful! Transaction ID:",f.result.txid),B("   (No signed PSBT returned - wallet broadcasted directly)"),{broadcasted:!0,txid:f.result.txid,message:"Xverse broadcasted transaction automatically"};if(f&&"success"===f.status&&f.result){const e=f.result.psbtBase64||f.result.psbt||f.result;if(!e)throw new Error("No signed PSBT in response result");B('\u2705 Xverse PSBT signed successfully via request("signPsbt")'),B("   \u2139\ufe0f  Xverse v1.6.1 ignores broadcast flag - manual broadcast required");const t=Buffer.from(e,"base64").toString("hex");return B("\ud83d\udd27 Converted signed PSBT: BASE64 \u2192 HEX for downstream processing"),t}if(f&&"error"===f.status){const e=f.error?.code;if("USER_REJECTION"===e||4001===e)throw new Error("User rejected the signing request");throw new Error(f.error?.message||"PSBT signing failed")}if(f&&"2.0"===f.jsonrpc&&f.result){if(f.result.txid&&!f.result.psbt&&!f.result.psbtBase64)return B("\u2705 Xverse broadcast successful! Transaction ID:",f.result.txid),{broadcasted:!0,txid:f.result.txid,message:"Xverse broadcasted transaction automatically"};const e=f.result.psbt||f.result.psbtBase64;if(!e)throw new Error("No signed PSBT in JSON-RPC result");B("\u2705 Xverse PSBT signed successfully (JSON-RPC format)"),B("   \u2139\ufe0f  Xverse v1.6.1 ignores broadcast flag - manual broadcast required");const t=Buffer.from(e,"base64").toString("hex");return B("\ud83d\udd27 Converted signed PSBT: BASE64 \u2192 HEX for downstream processing"),t}if(f&&f.psbtBase64){B("\u2705 Xverse PSBT signed successfully (direct format)");const e=Buffer.from(f.psbtBase64,"base64").toString("hex");return B("\ud83d\udd27 Converted signed PSBT: BASE64 \u2192 HEX for downstream processing"),e}throw new Error("Invalid response format from Xverse wallet")}catch(Kh){throw O("\u274c Xverse PSBT signing failed:",Kh),new Error(`Xverse: ${Kh?.message||"Unknown Xverse signing error"}`)}}async signPsbt(e,t={}){return await this.signPSBT(e,t)}async pushPsbt(e,t={}){C("\u26a0\ufe0f Xverse: Manual broadcast required"),C("   (Automatic broadcast via signPsbt should be attempted first)"),C("   Throwing error to trigger manual broadcast UI...");const n=new Error("Xverse requires manual broadcast");throw n.walletType="Xverse",n.requiresManualBroadcast=!0,n}async pushTx(e){C("\u26a0\ufe0f Xverse: Manual broadcast required"),C("   (Automatic broadcast via signPsbt should be attempted first)"),C("   Throwing error to trigger manual broadcast UI...");const t=new Error("Xverse requires manual broadcast");throw t.walletType="Xverse",t.requiresManualBroadcast=!0,t}async sendBitcoin(e,t){this.requireConnected();try{const n=this.getProvider(),r=await n.request("sendTransfer",{recipients:[{address:e,amount:Number(t)}]});if("success"===r.status)return B("\u2705 Transaction sent:",r.result.txid),r.result.txid;if("error"===r.status)throw new Error(r.error?.message||"sendTransfer failed");return B("\u2705 Transaction sent:",r.txid||r.result?.txid),r.txid||r.result?.txid}catch(Kh){throw O("\u274c Failed to send Bitcoin:",Kh),Kh}}async getCapabilities(){this.requireConnected();try{return{walletType:"Xverse",methods:Object.keys(this.features).filter(e=>!0===this.features[e]),features:{multiAddress:!0,runes:!0,inscriptions:!0,batchOperations:!0,utxos:!1},addresses:{payment:this.paymentAddress,ordinals:this.ordinalsAddress}}}catch(Kh){throw O("\u274c Failed to get capabilities:",Kh),Kh}}async signMessage(e){this.requireConnected();try{const t=this.getProvider();return await t.request("signMessage",{address:this.ordinalsAddress||this.address,message:e})}catch(Kh){throw O("\u274c Failed to sign message:",Kh),Kh}}async signTransaction(e,t={}){this.requireConnected();try{const n=this.getProvider(),r=await n.signTransaction(e,t);return B("\u2705 Transaction signed via Xverse signTransaction"),r}catch(Kh){throw O("\u274c Failed to sign transaction:",Kh),Kh}}async signMultipleTransactions(e,t={}){this.requireConnected();try{const n=this.getProvider(),r=await n.signMultipleTransactions(e,t);return B(`\u2705 ${r.length} transactions signed via Xverse`),r}catch(Kh){throw O("\u274c Failed to sign multiple transactions:",Kh),Kh}}async createInscription(e,t={}){this.requireConnected();try{const n=this.getProvider(),r=await n.createInscription({...e,...t});return B("\u2705 Inscription created via Xverse:",r),r}catch(Kh){throw O("\u274c Failed to create inscription:",Kh),Kh}}async createRepeatInscriptions(e){this.requireConnected();try{const t=this.getProvider();if(!t)throw new Error("Xverse provider not found");B("\ud83d\udd0d Xverse: Creating repeat inscriptions with payload:",{repeat:e.repeat,contentType:e.contentType,payloadType:e.payloadType,feeRate:e.suggestedMinerFeeRate});const n=h(e);B("\ud83d\udd0d Xverse: Created JWT token for repeat inscriptions request");const r=await t.createRepeatInscriptions(n);if(B("\u2705 Xverse repeat inscriptions response:",r),!r)throw new Error("No response from Xverse wallet");if(r.error)throw new Error(r.error.message||"Provider returned an error");const i={txId:r.txId,inscriptionIds:r.inscriptionIds||[],count:e.repeat};return B(`\u2705 ${e.repeat} inscriptions created via Xverse:`,i),i}catch(Kh){if(O("\u274c Failed to create repeat inscriptions:",Kh),4001===Kh.code||Kh.message?.includes("cancel"))throw new Error("Batch inscription cancelled by user");throw new Error(`Batch inscription failed: ${Kh.message}`)}}async getNetwork(){return"mainnet"}async getPublicKey(){return this.requireConnected(),this.ordinalsPublicKey||this.paymentPublicKey}async getAccounts(){return this.requireConnected(),[{purpose:"ordinals",address:this.ordinalsAddress,publicKey:this.ordinalsPublicKey},{purpose:"payment",address:this.paymentAddress,publicKey:this.paymentPublicKey}]}getState(){return{wallet:"Xverse",connected:!!this.isConnected,network:"mainnet",paymentAddress:this.paymentAddress,ordinalsAddress:this.ordinalsAddress,paymentPublicKey:this.paymentPublicKey,ordinalsPublicKey:this.ordinalsPublicKey}}async inscribe(e,t={}){this.requireConnected();try{const n=this.getProvider();if(!n)throw new Error("Xverse provider not found");const{contentType:r="text/plain;charset=utf-8",feeRate:i=10,receiverAddress:a,devAddress:o,devFee:s=0}=t;let l="PLAIN_TEXT",c=e;if((e instanceof ArrayBuffer||r.startsWith("image/"))&&(l="BASE_64",e instanceof ArrayBuffer)){const t=new Uint8Array(e);let n="";for(let e=0;e<t.byteLength;e++)n+=String.fromCharCode(t[e]);c=btoa(n)}const u={contentType:r,content:c,payloadType:l,network:{type:"Mainnet"}};i&&(u.suggestedMinerFeeRate=i),o&&s>0&&(u.appFeeAddress=o,u.appFee=s),B("\ud83d\udd0d Xverse: Creating inscription with payload:",{contentType:u.contentType,payloadType:u.payloadType,contentLength:c.length,feeRate:u.suggestedMinerFeeRate,hasServiceFee:!(!o||!s)});const d=h(u);B("\ud83d\udd0d Xverse: Created JWT token for inscription request");const f=await n.createInscription(d);if(B("\u2705 Xverse inscription response:",f),!f)throw new Error("No response from Xverse wallet");if(f.error)throw new Error(f.error.message||"Provider returned an error");const p={txId:f.txId,inscriptionId:f.inscriptionId||f.txId};return B("\u2705 Xverse inscription created:",p),p}catch(Kh){if(O("\u274c Xverse inscribe error:",Kh),4001===Kh.code||Kh.message?.includes("cancel"))throw new Error("Inscription cancelled by user");throw new Error(`Inscription failed: ${Kh.message}`)}}async getRunesBalance(){this.requireConnected();try{const e=this.getProvider();B("\ud83d\udd0d Xverse: Requesting runes_getBalance...");const t=await e.request("runes_getBalance",void 0);return B("\u2705 Xverse runes balance:",t),t&&t.result?t.result:t}catch(Kh){throw O("\u274c Xverse getRunesBalance failed:",Kh),Kh}}async transferRunes(e){this.requireConnected();try{const t=this.getProvider();B("\ud83d\udd0d Xverse: Transferring runes:",e);const n=await t.request("runes_transfer",e);return B("\u2705 Xverse runes transfer:",n),n}catch(Kh){throw O("\u274c Xverse transferRunes failed:",Kh),Kh}}async mintRunes(e){this.requireConnected();try{const t=this.getProvider();B("\ud83d\udd0d Xverse: Minting runes:",e);const n=await t.request("runes_mint",e);return B("\u2705 Xverse runes mint:",n),n}catch(Kh){throw O("\u274c Xverse mintRunes failed:",Kh),Kh}}async etchRunes(e){this.requireConnected();try{const t=this.getProvider();B("\ud83d\udd0d Xverse: Etching runes:",e);const n=await t.request("runes_etch",e);return B("\u2705 Xverse runes etch:",n),n}catch(Kh){throw O("\u274c Xverse etchRunes failed:",Kh),Kh}}async getRunesOrder(e){this.requireConnected();try{const t=this.getProvider();B("\ud83d\udd0d Xverse: Getting runes order:",e);const n=await t.request("runes_getOrder",{orderId:e});return B("\u2705 Xverse runes order:",n),n}catch(Kh){throw O("\u274c Xverse getRunesOrder failed:",Kh),Kh}}async sendInscriptions(e){this.requireConnected();try{const t=this.getProvider();B("\ud83d\udd0d Xverse: Sending inscriptions:",e);const n=await t.request("ord_sendInscriptions",e);return B("\u2705 Xverse inscriptions sent:",n),n}catch(Kh){throw O("\u274c Xverse sendInscriptions failed:",Kh),Kh}}},OKX:class extends A{constructor(){super("OKX"),this._walletInstanceCache=null,this.features={connect:!0,getAddress:!1,getPublicKey:!0,getBalance:!0,getNetwork:!0,switchNetwork:!1,signMessage:!0,signPsbt:!0,signPsbts:!0,pushPsbt:!1,pushTx:!1,sendBitcoin:!0,sendInscription:!0,getInscriptions:!0,getAllInscriptions:!0,inscribe:!0,brc20:{transfer:!0,deploy:!0,mint:!0},runes:{send:!1,mint:!1,etch:!1},atomicals:{transfer:!1,mint:!1},arc20:{transfer:!1}}}get walletInstance(){return this._walletInstanceCache?this._walletInstanceCache:"undefined"==typeof window?null:window.okxwallet?.bitcoin?(this._walletInstanceCache=window.okxwallet.bitcoin,L(),this._walletInstanceCache):window.okxwallet&&"function"==typeof window.okxwallet.connect&&"function"==typeof window.okxwallet.signPsbt?(L(),this._walletInstanceCache=window.okxwallet,this._walletInstanceCache):null}set walletInstance(e){this._walletInstanceCache=e}isInstalled(){return!!this.walletInstance}async _waitForProvider(e=3e3){if(this.walletInstance)return this.walletInstance;L();const t=Date.now();return new Promise((n,r)=>{const i=()=>{if(this._walletInstanceCache=null,this.walletInstance)return L(Date.now()),void n(this.walletInstance);Date.now()-t>e?r(new Error("OKX wallet provider not detected. If using OKX mobile, please open this page inside the OKX Wallet app browser.")):setTimeout(i,150)};i()})}_getWallet(){const e=this.walletInstance;if(!e)throw new Error("OKX wallet provider is not available. Please open this page inside the OKX Wallet app browser.");return e}async connect(){const e=await this._waitForProvider(),t=await e.connect();return this.address=t.address||t,this.publicKey=t.publicKey,this.isConnected=!0,L(),t}async getAddress(){this.requireConnected();const e=await this._getWallet().getAccounts();return e&&e.length>0?e[0]:this.address}async getPublicKey(){return this.requireConnected(),await this._getWallet().getPublicKey()}async getBalance(){this.requireConnected();const e=await this._getWallet().getBalance();return l.balance(e,"OKX")}async getNetwork(){this.requireInstalled();const e=await this._getWallet().getNetwork();return l.network(e)}async signMessage(e,t="ecdsa"){return this.requireConnected(),await this._getWallet().signMessage(e,t)}async signPsbt(e,t={}){this.requireConnected(),L();const n=(()=>{if("string"!=typeof e||0===e.length)throw new Error("Invalid PSBT: must be a non-empty string");if(/^[0-9a-fA-F]+$/.test(e))return e;try{return Buffer.from(e,"base64").toString("hex")}catch{throw new Error("Invalid PSBT: must be hex or base64")}})(),r={...t||{}};!1===r.autoFinalized&&(r.autoFinalize=!1);const i=await this._getWallet().signPsbt(n,r);return L(),i}async signPsbts(e,t=[]){if(this.requireConnected(),L(),!Array.isArray(e))throw new Error("Invalid PSBTs: must be an array");const n=e.map((e,t)=>{if("string"!=typeof e||0===e.length)throw new Error(`Invalid PSBT at index ${t}: must be a non-empty string`);if(/^[0-9a-fA-F]+$/.test(e))return e;try{return Buffer.from(e,"base64").toString("hex")}catch{throw new Error(`Invalid PSBT at index ${t}: must be hex or base64`)}}),r=await this._getWallet().signPsbts(n,t);return L(),r}async pushPsbt(e){throw new Error("OKX broadcast not supported - use OrdNexus extension or Bitcoin Proxy")}async pushTx(e){throw new Error("OKX broadcast not supported - use OrdNexus extension or Bitcoin Proxy")}async sendBitcoin(e,t){if(this.requireConnected(),!e||"string"!=typeof e)throw new Error("Invalid recipient address: must be a non-empty string");if(!/^(bc1|[13]|tb1|[mn2])[a-zA-HJ-NP-Z0-9]{25,87}$/.test(e))throw new Error("Invalid Bitcoin address format");if(!t||t<=0)throw new Error("Invalid amount: must be positive number in satoshis");const n=await this._getWallet().sendBitcoin(e,t);return L(),n}async sendInscription(e,t,n={}){this.requireConnected();const r=await this._getWallet().sendInscription(e,t,n);return L(),r}async getInscriptions(e=0,t=100){this.requireConnected();const n=await this._getWallet().getInscriptions(e,t);return n&&n.list?{list:n.list.map(e=>l.inscription(e,"OKX")),total:n.total}:{list:[],total:0}}async inscribe(e,t={}){if(this.requireConnected(),"string"==typeof e&&e.length<=5&&!t.contentType&&!t.receiveAddress)return L(),await this._getWallet().inscribe({type:51,from:this.address,tick:e});L();const n={contentType:t.contentType||"text/plain;charset=utf-8",body:e},r={type:61,from:this.address,inscriptions:[n]};return L(),await this._getWallet().mint(r)}async inscribeTransfer(e,t){this.requireConnected();const n=await this._getWallet().inscribe({type:51,from:this.address,tick:e});return L(),n}async getAccounts(){return this.requireInstalled(),await this._getWallet().getAccounts()}async splitUtxo(e){return this.requireConnected(),await this._getWallet().splitUtxo(e)}async transferNft(e,t){return this.requireConnected(),await this._getWallet().transferNft(e,t)}async watchAsset(e){return this.requireInstalled(),await this._getWallet().watchAsset(e)}async mint(e){return this.requireConnected(),e.from||(e.from=this.address),await this._getWallet().mint(e)}setupEventListeners(){if(!this.isInstalled())return;const e=this.walletInstance;e&&e.on&&(e.on("accountsChanged",e=>{L(),e&&0!==e.length?this.address=e[0]:(this.address=null,this.publicKey=null,this.isConnected=!1)}),e.on("networkChanged",e=>{L()}),L())}removeEventListeners(){if(!this.isInstalled())return;const e=this.walletInstance;e&&e.removeAllListeners&&(e.removeAllListeners("accountsChanged"),e.removeAllListeners("networkChanged"))}},Leather:class extends A{constructor(){super("Leather"),this.walletInstance=this.getProvider(),this.features={connect:!0,getAddress:!0,getPublicKey:!1,getBalance:!1,getNetwork:!1,switchNetwork:!1,signMessage:!0,signPsbt:!0,signPsbts:!1,pushPsbt:!1,pushTx:!1,sendBitcoin:!1,sendInscription:!1,getInscriptions:!1,getAllInscriptions:!1,inscribe:!1,brc20:!1,runes:!1,atomicals:!1,arc20:!1,stacksSupport:!0,structuredData:!0,authentication:!0,stacksTransaction:!0,profileUpdate:!0,getProductInfo:!0,getURL:!0}}getProvider(){if("undefined"==typeof window)return null;if(window.LeatherProvider)return R(),window.LeatherProvider;if(window.HiroWalletProvider)return R(),window.HiroWalletProvider;if(window.btc_providers&&Array.isArray(window.btc_providers))for(const e of window.btc_providers)if(("LeatherProvider"===e.id||"Leather"===e.name)&&"function"==typeof e.request)return R(),e;return null}isInstalled(){return!!this.walletInstance}async connect(){this.requireInstalled();try{const e=this.getProvider();if(!e||"function"!=typeof e.request)throw new Error("Leather provider.request method not available");R();const t=await e.request("getAddresses"),n=t.result?.addresses||t.addresses;if(!n||0===n.length)throw new Error("No addresses returned from Leather");R(n.map(e=>e.type));const r=n.find(e=>"p2tr"===e.type),i=n.find(e=>"p2wpkh"===e.type),a=r||i||n[0],o=i||r||n[0];return r&&i||r||i?R():U(),this.address=a?.address,this.ordinalsAddress=a?.address,this.paymentAddress=o?.address,this.isConnected=!0,R(),{address:this.address,ordinalsAddress:this.ordinalsAddress,paymentAddress:this.paymentAddress,allAddresses:n}}catch(Kh){throw U(),Kh}}async getAddress(){return this.requireConnected(),this.address}async getAccounts(){this.requireConnected();try{const e=this.getProvider(),t=await e.request("getAddresses");return t.result?.addresses||t.addresses}catch(Kh){throw U(),Kh}}async getProductInfo(){this.requireInstalled();try{const e=this.getProvider(),t=await e.getProductInfo();return R(),t}catch(Kh){throw U(),Kh}}async getURL(){this.requireInstalled();try{const e=this.getProvider();return await e.getURL()}catch(Kh){throw U(),Kh}}async signMessage(e,t={}){this.requireConnected();try{const n=this.getProvider();R();const r=await n.signatureRequest({message:e,...t});return R(),r}catch(Kh){throw U(),Kh}}async signStructuredData(e){this.requireConnected();try{const t=this.getProvider();R();const n=await t.structuredDataSignatureRequest(e);return R(),n}catch(Kh){throw U(),Kh}}async signPsbt(e,t={}){if(this.requireConnected(),!e||"string"!=typeof e)throw new Error("Invalid PSBT: must be a non-empty string");try{const a=this.getProvider();if(!a)throw new Error("Leather provider not available");R(),R();const o=t?.toSignInputs||t?.inputsToSign||[],s=Array.isArray(o)?o.map(e=>"number"==typeof e?.index?e.index:null).filter(e=>null!==e):void 0,l={};Array.isArray(o)&&o.forEach(e=>{if("number"==typeof e?.index)if("number"==typeof e.sighashType)l[e.index]=e.sighashType;else if(Array.isArray(e.sighashTypes)&&e.sighashTypes.length>0){const t=e.sighashTypes.find(e=>0!==e&&0!==e);t&&(l[e.index]=t)}});const c=(e,n=!1)=>{const r=n?{psbt:e}:{hex:e};return"boolean"==typeof t?.broadcast&&(r.broadcast=!!t.broadcast),t?.network&&(r.network=t.network),s&&s.length>0&&(r.signAtIndex=s),Object.keys(l).length>0&&(r.inputSighashMap=l,R()),r};try{R();const t=await a.request("signPsbt",c(e));return R(),t?.result?.hex||t?.hex||t?.psbt||t}catch(n){U()}try{R();const t=Buffer.from(e,"hex").toString("base64"),n=await a.request("signPsbt",c(t));R();const r=n?.result?.hex||n?.hex||n?.psbt||n;return/^[A-Za-z0-9+/]+=*$/.test(r)?Buffer.from(r,"base64").toString("hex"):r}catch(r){U()}try{R();const t=Buffer.from(e,"hex").toString("base64"),n=await a.request("signPsbt",c(t,!0));R();const r=n?.result?.hex||n?.hex||n?.psbt||n;return/^[A-Za-z0-9+/]+=*$/.test(r)?Buffer.from(r,"base64").toString("hex"):r}catch(i){throw U(),new Error("All PSBT format attempts failed.")}}catch(Kh){U(),U();const t=Kh?.message||Kh?.toString()||"Unknown Leather signing error";if(t.includes("User rejected")||t.includes("cancelled"))throw new Error("User rejected the signing request");throw new Error(`Leather signing failed: ${t}`)}}async authenticate(e={}){this.requireInstalled();try{const t=this.getProvider();R();const n=await t.authenticationRequest(e);return R(),n}catch(Kh){throw U(),Kh}}async sendStacksTransaction(e){this.requireConnected();try{const t=this.getProvider();R();const n=await t.transactionRequest(e);return R(),n}catch(Kh){throw U(),Kh}}async updateProfile(e){this.requireConnected();try{const t=this.getProvider();R();const n=await t.profileUpdateRequest(e);return R(),n}catch(Kh){throw U(),Kh}}},Phantom:class extends A{constructor(){super("Phantom"),this.publicKey=null,this.paymentAddress=null,this.paymentPublicKey=null,this.walletInstance="undefined"!=typeof window?window.phantom?.bitcoin:null,this.features={connect:!0,getAddress:!0,getPublicKey:!0,getBalance:!0,getNetwork:!0,signMessage:!0,signPsbt:!0,sendBitcoin:!0,eventListeners:!0}}isInstalled(){return!!this.walletInstance}async connect(){this.requireInstalled();try{const e=await this.walletInstance.requestAccounts();if(!e||!Array.isArray(e)||0===e.length)throw new Error("No accounts returned from Phantom wallet");$(),$(e.length);const t=e.find(e=>"ordinals"===e.purpose),n=e.find(e=>"payment"===e.purpose);if(t&&n)$(),this.address=t.address,this.publicKey=t.publicKey,this.paymentAddress=n.address,this.paymentPublicKey=n.publicKey;else{$();const t=e[0];this.address=t.address,this.publicKey=t.publicKey,this.paymentAddress=t.address,this.paymentPublicKey=t.publicKey,H(),H()}return this.isConnected=!0,$(),{address:this.address,ordinalsAddress:this.address===this.paymentAddress?null:this.address,paymentAddress:this.paymentAddress,publicKey:this.publicKey,paymentPublicKey:this.paymentPublicKey}}catch(Kh){throw H(),Kh}}async getAddress(){this.requireConnected();try{return(await this.walletInstance.getAccounts())[0].address}catch(Kh){return H(),this.address}}async getPublicKey(){return this.requireConnected(),this.publicKey}async getAccounts(){this.requireConnected();try{return[this.address]}catch(Kh){throw H(),Kh}}async signMessage(e){this.requireConnected();try{const t=await this.walletInstance.signMessage(e);return"string"==typeof t?t:t.signature}catch(Kh){throw H(),Kh}}async signPsbt(e,t={}){this.requireConnected();try{$();let d=null,f=null,p=e;try{if("string"==typeof e&&e.toLowerCase().startsWith("70736274")){const t=new Uint8Array(e.match(/.{1,2}/g).map(e=>parseInt(e,16)));d=t,f="undefined"!=typeof Buffer?Buffer.from(t).toString("base64"):btoa(String.fromCharCode(...t)),$()}else if("string"==typeof e&&e.startsWith("cHNidP")){if("undefined"!=typeof Buffer)d=new Uint8Array(Buffer.from(e,"base64"));else{const t=atob(e);d=new Uint8Array([...t].map(e=>e.charCodeAt(0)))}f=e,$()}else e instanceof Uint8Array&&(d=e,f="undefined"!=typeof Buffer?Buffer.from(e).toString("base64"):btoa(String.fromCharCode(...e)),$())}catch(n){H()}const m=a({...t,address:this.address},"Phantom");let h;$();const g=async(e=null)=>{$();const t=d||f||p;return e?await this.walletInstance.signPSBT(t,e):await this.walletInstance.signPSBT(t)},y=async(e=null)=>{$();const t=d||f||p;return e?await this.walletInstance.signPsbt(t,e):await this.walletInstance.signPsbt(t)},b=async()=>{if("function"!=typeof this.walletInstance.request)throw H(),new Error("Phantom Bitcoin API does not support request() method. Please ensure Phantom wallet is updated.");$();try{return await this.walletInstance.request({method:"signPSBT",params:{psbt:d||f||p,options:m}})}catch(e){return H(),await this.walletInstance.request({method:"signPSBT",params:[d||f||p,m]})}};if("function"==typeof this.walletInstance.signPSBT)try{h=await g(null)}catch(r){H();try{H(),h=await g(m)}catch(i){H();try{h=await g({})}catch(o){if(H(),"function"==typeof this.walletInstance.signPsbt)try{h=await y(null)}catch(s){try{h=await y(m)}catch(l){H();try{h=await b()}catch(c){throw H(),new Error(`Phantom signing failed: ${r.message}. Tried signPSBT and signPsbt methods.`)}}}else{H();try{h=await b()}catch(s){throw H(),new Error(`Phantom signing failed: ${r.message}. Tried signPSBT, signPsbt, and request() methods.`)}}}}}else if("function"==typeof this.walletInstance.signPsbt)try{h=await y(null)}catch(r){try{h=await y(m)}catch(i){throw new Error(`Phantom signPsbt failed: ${i.message}`)}}else try{h=await b()}catch(u){throw new Error("Phantom wallet does not have signPSBT, signPsbt, or request() methods available. Please update your Phantom wallet.")}let w;if($(),h instanceof Uint8Array)$(),w=Array.from(h,e=>e.toString(16).padStart(2,"0")).join(""),$();else if("undefined"!=typeof Buffer&&Buffer.isBuffer(h))$(),w=h.toString("hex");else if("string"==typeof h)if(h.startsWith("cHNidP"))if($(),"undefined"!=typeof Buffer)w=Buffer.from(h,"base64").toString("hex");else{const e=atob(h);w=Array.from(e,e=>e.charCodeAt(0).toString(16).padStart(2,"0")).join("")}else w=h;else if(h?.signedPsbtHex)w=h.signedPsbtHex;else if(h?.signedPsbt)w=h.signedPsbt;else{if(!h?.psbt)throw H(),new Error("Phantom returned unexpected PSBT format");w=h.psbt}return $(),w}catch(Kh){throw H(),Kh}}async getBalance(){this.requireConnected();try{return H(),{confirmed:0,unconfirmed:0,total:0}}catch(Kh){throw H(),Kh}}async getNetwork(){this.requireInstalled();try{return o(await this.walletInstance.getNetwork())}catch(Kh){return H(),"livenet"}}async sendBitcoin(e,t,n={}){this.requireConnected();try{const r=await this.walletInstance.sendTransfer({recipientAddress:e,amount:t,...n});return $(),r}catch(Kh){throw H(),Kh}}setupEventListeners(){this.isInstalled()&&(this.walletInstance.on("accountsChanged",e=>{$(),e&&e.length>0?(this.address=e[0].address,this.publicKey=e[0].publicKey):(this.address=null,this.publicKey=null,this.isConnected=!1)}),$())}removeEventListeners(){this.isInstalled()&&(this.walletInstance.removeAllListeners("accountsChanged"),$())}},Wizz:class extends A{constructor(){super("Wizz"),this.walletInstance="undefined"!=typeof window?window.wizz:null,this.features={connect:!0,getAddress:!0,getPublicKey:!0,getBalance:!0,getNetwork:!0,switchNetwork:!0,signMessage:!0,signPsbt:!0,signPsbts:!1,pushPsbt:!0,pushTx:!0,sendBitcoin:!0,sendInscription:!1,getInscriptions:!0,getAllInscriptions:!0,inscribe:!0,brc20:{transfer:!0,deploy:!0,mint:!0},runes:{send:!0,mint:!1,etch:!1},atomicals:{transfer:!0,mint:!0},arc20:{transfer:!0},biHelix:!0,cpfp:!0,mempoolInjection:!0,bip322:!0}}isInstalled(){return!!this.walletInstance}async connect(){this.requireInstalled();try{z();const t=this.walletInstance;let n=null;if("function"==typeof t.connect)z(),n=await t.connect();else if("function"==typeof t.requestAccounts)z(),n=await t.requestAccounts();else{if("function"!=typeof t.getAccounts)throw new Error("Wizz wallet has no connection methods available");z(),n=await t.getAccounts()}if(z(),!n)throw new Error("No response from Wizz wallet");if("object"==typeof n&&n.address)this.address=n.address,this.publicKey=n.publicKey;else if(Array.isArray(n)&&n.length>0)this.address=n[0];else{if("string"!=typeof n)throw new Error("Unexpected response format from Wizz wallet");this.address=n}if(!this.address)throw new Error("Could not extract address from Wizz response");if(!this.publicKey&&"function"==typeof t.getPublicKey)try{this.publicKey=await t.getPublicKey(),z()}catch(e){W()}return this.isConnected=!0,z(),{address:this.address,publicKey:this.publicKey}}catch(Kh){if(W(),-32603===Kh.code)throw new Error("Wizz wallet error: Please unlock your wallet and refresh the page");if(Kh.message?.includes("User rejected"))throw new Error("Connection request was rejected");throw Kh}}async getAddress(){return this.requireConnected(),(await this.walletInstance.getAccounts())[0]}async getPublicKey(){return this.requireConnected(),await this.walletInstance.getPublicKey()}async getAccounts(){return this.requireInstalled(),await this.walletInstance.getAccounts()}async getBalance(){this.requireConnected();const e=await this.walletInstance.getBalance();return l.balance(e,"Wizz")}async getNetwork(){this.requireInstalled();try{const e=await this.walletInstance.getNetwork();return l.network(e)}catch(Kh){return W(),"livenet"}}async switchNetwork(e){this.requireInstalled(),await this.walletInstance.switchNetwork(e),z()}async getChain(){return this.requireInstalled(),await this.walletInstance.getChain()}async switchChain(e){this.requireInstalled(),await this.walletInstance.switchChain(e),z()}async signMessage(e,t="ecdsa"){return this.requireConnected(),await this.walletInstance.signMessage(e,t)}async verifyMessage(e,t,n){return this.requireInstalled(),await this.walletInstance.verifyMessage(e,t,n)}async verifyMessageOfBIP322Simple(e,t,n){return this.requireInstalled(),await this.walletInstance.verifyMessageOfBIP322Simple(e,t,n)}async signPsbt(e,t={}){return this.requireConnected(),await this.walletInstance.signPsbt(e,t)}async pushPsbt(e){this.requireConnected();const t=await this.walletInstance.pushPsbt(e);return z(),t}async pushTx(e){this.requireConnected();const t=await this.walletInstance.pushTx({rawtx:e});return z(),t}async sendBitcoin(e,t,n={}){this.requireConnected();const r=await this.walletInstance.sendBitcoin(e,t,n);return z(),r}async getBitcoinUtxos(){return this.requireConnected(),await this.walletInstance.getBitcoinUtxos()}async injectMempool(e){return this.requireConnected(),await this.walletInstance.injectMempool(e)}async requestCPFP(e){this.requireConnected();const t=await this.walletInstance.requestCPFP(e);return z(),t}async getInscriptions(e=0,t=100){this.requireConnected();try{const n=this.walletInstance;let r=[];if("function"==typeof n.getInscriptions){z();const i=await n.getInscriptions(e,t);Array.isArray(i)?r=i:i&&i.list?r=i.list:i&&i.inscriptions?r=i.inscriptions:i&&i.result&&(r=i.result.inscriptions||i.result.list||[])}else{if("function"!=typeof n.getOrdinals)return W(),{list:[],total:0};{z();const i=await n.getOrdinals(e,t);r=Array.isArray(i)?i:i.list||i.inscriptions||[]}}return z(r.length),{list:r.map(e=>l.inscription(e,"Wizz")),total:r.length}}catch(Kh){return W(),{list:[],total:0}}}async getInscriptionsByAddress(e,t=0,n=100){return this.requireInstalled(),await this.walletInstance.getInscriptionsByAddress(e,t,n)}async getAssets(){return this.requireConnected(),await this.walletInstance.getAssets()}async inscribe(e,t={}){this.requireConnected();try{const{contentType:n="text/plain;charset=utf-8",encoding:r="utf8",feeRate:i,receiveAddress:a,serviceFee:o=0,metadata:s}=t,l={type:61,from:this.address,inscriptions:[{contentType:n,body:e}]};if(i&&(l.feeRate=i),n.includes("brc-20")||s&&s.brc20){l.type=51;const t=s.brc20||JSON.parse(e);l.tick=t.tick}n.startsWith("image/")&&(l.type=62);const c=await this.walletInstance.inscribe(l);return z(),{inscriptionId:c.inscriptionId||c.revealTxs?.[0],txId:c.commitTx||c.txId,revealTxIds:c.revealTxs,commitTxFee:c.commitTxFee,revealTxFees:c.revealTxFees}}catch(Kh){throw W(),new Error(`Inscription failed: ${Kh.message}`)}}async requestMint(e){return this.requireConnected(),await this.walletInstance.requestMint(e)}async sendARC20(e,t,n){this.requireConnected();const r=await this.walletInstance.sendARC20(e,t,n);return z(),r}async sendAtomicals(e){this.requireConnected();const t=await this.walletInstance.sendAtomicals(e);return z(),t}async isAtomicalsEnabled(){return this.requireInstalled(),await this.walletInstance.isAtomicalsEnabled()}async isBiHelixAddress(e){return this.requireInstalled(),await this.walletInstance.isBiHelixAddress(e)}async getBiHelixDescriptor(){return this.requireConnected(),await this.walletInstance.getBiHelixDescriptor()}async viewAddress(e){this.requireInstalled(),await this.walletInstance.viewAddress(e)}async getVersion(){return this.requireInstalled(),await this.walletInstance.getVersion()}setupEventListeners(){if(!this.isInstalled())return;const e=this.walletInstance;e&&e.on&&(e.on("accountsChanged",e=>{z(),e&&0!==e.length?this.address=e[0]:(this.address=null,this.publicKey=null,this.isConnected=!1)}),e.on("networkChanged",e=>{z()}),z())}removeEventListeners(){if(!this.isInstalled())return;const e=this.walletInstance;e&&e.removeAllListeners&&(e.removeAllListeners("accountsChanged"),e.removeAllListeners("networkChanged"))}},MagicEden:class extends A{constructor(){super("MagicEden"),this.paymentAddress=null,this.ordinalsAddress=null,this.walletInstance=this.getProvider(),this.features={connect:!0,getAddress:!0,getPublicKey:!1,getBalance:!1,getNetwork:!0,switchNetwork:!1,signMessage:!0,signPsbt:!0,signPsbts:!0,signTransaction:!0,pushPsbt:!1,pushTx:!1,sendBitcoin:!0,sendInscription:!1,getInscriptions:!1,getAllInscriptions:!1,inscribe:!1,brc20:{transfer:!1,deploy:!1,mint:!1},runes:{send:!1,mint:!1,etch:!1},atomicals:{transfer:!1,mint:!1},arc20:{transfer:!1},jwtAuth:!0,hardwareDetection:!0}}getProvider(){return"undefined"==typeof window?null:window.magicEden?.bitcoin?.isMagicEden?window.magicEden.bitcoin:window.BitcoinProvider?.isMagicEden?window.BitcoinProvider:null}isInstalled(){return!!this.walletInstance}async connect(){this.requireInstalled();const e=this.walletInstance,t=void 0!==window.XverseProviders||"function"==typeof window.BitcoinProvider?.request,n=void 0!==window.LeatherProvider;if((t||n)&&!e?.isMagicEden)throw new Error(`\ud83d\udea8 WALLET CONFLICT DETECTED\n\nMagic Eden cannot coexist with other Bitcoin wallets.\nDetected: ${t?"Xverse ":""}${n?"Leather":""}\n\nSOLUTIONS:\n1. Disable Xverse and Leather extensions\n2. Refresh the page\n3. Try again\n\nOR use Xverse wallet instead (recommended for multi-wallet support)`);if(!e||!e.isMagicEden)throw new Error("\u26a0\ufe0f Magic Eden wallet is installed but cannot be accessed.\n\nThis happens when multiple Bitcoin wallets are installed.\n\nSOLUTION:\n1. Disable Xverse and Leather extensions\n2. Refresh the page\n3. Try again\n\nOR use Xverse wallet instead (recommended)");try{const t=h({purposes:["payment","ordinals"],message:"Connect to view your Bitcoin addresses",network:{type:"Mainnet"}}),n=await e.connect(t);if(!n?.addresses||!Array.isArray(n.addresses))throw new Error("No addresses returned from Magic Eden wallet");const r=n.addresses.find(e=>"payment"===e.purpose),i=n.addresses.find(e=>"ordinals"===e.purpose);if(!r&&!i)throw new Error("No valid addresses returned");return this.paymentAddress=r?.address,this.ordinalsAddress=i?.address,this.address=i?.address||r?.address,this.publicKey=r?.publicKey||i?.publicKey,this.isConnected=!0,j(),{address:this.address,paymentAddress:this.paymentAddress,ordinalsAddress:this.ordinalsAddress,publicKey:this.publicKey}}catch(Kh){throw q(),Kh}}async getAddress(){return this.requireConnected(),this.address}async getAccounts(){return this.requireConnected(),[{address:this.paymentAddress,publicKey:this.publicKey,purpose:"payment"},{address:this.ordinalsAddress,publicKey:this.publicKey,purpose:"ordinals"}].filter(e=>e.address)}getState(){const e=this.paymentAddress||this.address||null,t=this.ordinalsAddress||this.address||null;return{wallet:"MagicEden",connected:!!this.isConnected,network:"mainnet",paymentAddress:e,ordinalsAddress:t,paymentPublicKey:this.publicKey||null,ordinalsPublicKey:this.publicKey||null,address:this.address||t||e||null}}async getBalance(){return this.requireConnected(),j(),{confirmed:0,unconfirmed:0,total:0}}async getNetwork(){return"mainnet"}async signMessage(e){this.requireConnected();try{const t=h({address:this.address,message:e,protocol:"BIP322"}),n=await this.walletInstance.signMessage(t);return j(),n}catch(Kh){throw q(),new Error(`Message signing failed: ${Kh.message}`)}}async signPsbt(e,t={}){this.requireConnected();try{const n=e=>"string"==typeof e&&/^[0-9a-fA-F]+$/.test(e)&&e.length%2==0,r=e=>{const t=e.length,n=new Uint8Array(t/2);for(let r=0;r<t;r+=2)n[r/2]=parseInt(e.slice(r,r+2),16);return n},i=e=>{let t="";for(let n=0;n<e.length;n++)t+=e[n].toString(16).padStart(2,"0");return t},a=e=>{if("undefined"!=typeof Buffer)return Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("base64");let t="";for(let n=0;n<e.length;n+=32768){const r=e.subarray(n,n+32768);t+=String.fromCharCode.apply(null,Array.from(r))}return btoa(t)},o=e=>{if("undefined"!=typeof Buffer){const t=Buffer.from(e,"base64");return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}const t=atob(e),n=new Uint8Array(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n},s=e=>a(r(e)),l=e=>i(o(e));let c=e;n(e)&&(j(),c=s(e));const u=(()=>{const e=Array.isArray(t?.toSignInputs)?t.toSignInputs:[],n=new Map;for(const t of e){if(!t||"object"!=typeof t)continue;const e=t.address||this.ordinalsAddress||this.paymentAddress||this.address,r=Number(t.index);!e||!Number.isFinite(r)||r<0||(n.has(e)||n.set(e,[]),n.get(e).push(r))}if(0===n.size){const e=this.ordinalsAddress||this.address;e&&n.set(e,[0])}return Array.from(n.entries()).map(([e,t])=>({address:e,signingIndexes:Array.from(new Set(t)).sort((e,t)=>e-t)}))})();j(),j(u.length);const d=h({network:{type:"Mainnet"},message:"Sign inscription transaction",psbtBase64:c,broadcast:!1,inputsToSign:u}),f=await this.walletInstance.signTransaction(d);if(j(),f?.psbtBase64)return n(e)?l(f.psbtBase64):f.psbtBase64;throw new Error("No signed PSBT returned from Magic Eden")}catch(Kh){if(q(),Kh.message?.includes("Magic Number"))throw new Error("PSBT format error: Magic Eden expects base64 format. This error has been fixed - please try again.");throw new Error(`PSBT signing failed: ${Kh.message}`)}}async signPsbts(e,t=[]){this.requireConnected();try{j(e.length);const n=[];for(let r=0;r<e.length;r++){const i=e[r],a=Array.isArray(t)?t[r]||{}:t;j(e.length);const o=await this.signPsbt(i,a);n.push(o)}return j(n.length),n}catch(Kh){throw q(),new Error(`Batch PSBT signing failed: ${Kh.message}`)}}async signTransaction(e){this.requireConnected();const t=await this.walletInstance.signTransaction(e);return j(),t}async signMultipleTransactions(e){this.requireConnected();const t=await this.walletInstance.signMultipleTransactions(e);return j(t.length),t}async sendBitcoin(e,t){if(this.requireConnected(),!e||"string"!=typeof e)throw new Error("Invalid recipient address: must be a valid Bitcoin address string");if(!/^(bc1|[13]|tb1)[a-zA-HJ-NP-Z0-9]{25,90}$/.test(e))throw new Error(`Invalid Bitcoin address format: ${e}`);try{const n=t>1e5?t:Math.floor(1e8*t);if(n<=0)throw new Error("Amount must be greater than 0");const r=this.paymentAddress;if(!r)throw new Error("Payment address not available. Please reconnect wallet.");const i=h({recipients:[{address:e,amountSats:n}],senderAddress:r}),a=await this.walletInstance.sendBtcTransaction(i);return j(),a}catch(Kh){q();let t=Kh.message||"Unknown error";throw t.includes("validation")?t="Invalid address format. Please check the recipient address.":t.includes("rejected")?t="Transaction was rejected by user":t.includes("insufficient")&&(t="Insufficient balance to complete transaction"),new Error(`Send transaction failed: ${t}`)}}async getInscriptions(e=0,t=100){return this.requireConnected(),{list:[],total:0}}async isHardware(){if(!this.walletInstance)throw new Error("Provider not initialized");try{return await this.walletInstance.isHardware()}catch(Kh){return q(),!1}}async call(e,t={}){if(!this.walletInstance||!this.walletInstance.call)throw new Error("Magic Eden RPC call method not available");try{j();const n=await this.walletInstance.call(e,t);return j(),n}catch(Kh){throw q(),new Error(`RPC call failed: ${Kh.message}`)}}setupEventListeners(){if(!this.isInstalled())return;const e=this.walletInstance;e&&e.on&&(e.on("accountsChanged",e=>{j(),e&&0!==e.length?(this.paymentAddress=e[0],this.ordinalsAddress=e[0]):(this.paymentAddress=null,this.ordinalsAddress=null,this.isConnected=!1)}),j())}removeEventListeners(){if(!this.isInstalled())return;const e=this.walletInstance;e&&e.removeAllListeners&&e.removeAllListeners("accountsChanged")}},Oyl:class extends A{constructor(){super("Oyl"),this.paymentAddress=null,this.ordinalsAddress=null,this.walletInstance="undefined"!=typeof window?window.oyl:null,this.features={connect:!0,getAddress:!0,getPublicKey:!1,getBalance:!0,getNetwork:!0,switchNetwork:!0,signMessage:!0,signPsbt:!0,signPsbts:!0,pushPsbt:!0,pushTx:!1,sendBitcoin:!0,sendInscription:!1,getInscriptions:!0,getAllInscriptions:!0,inscribe:!1,brc20:{transfer:!1,deploy:!1,mint:!1},runes:{send:!1,mint:!1,etch:!1},atomicals:{transfer:!1,mint:!1},arc20:{transfer:!1},relayProvider:!0}}isInstalled(){return!!this.walletInstance}async connect(){this.requireInstalled();try{X();const e=this.walletInstance,t=await e.getAddresses();if(X(),!t)throw new Error("No response from Oyl wallet");if(t.taproot&&t.taproot.address&&(this.address=t.taproot.address,this.ordinalsAddress=t.taproot.address,this.publicKey=t.taproot.publicKey),t.nativeSegwit&&t.nativeSegwit.address&&(this.paymentAddress=t.nativeSegwit.address,this.address||(this.address=t.nativeSegwit.address)),!this.address)throw new Error("No valid address returned from Oyl wallet");return this.isConnected=!0,X(),{address:this.address,ordinalsAddress:this.ordinalsAddress,paymentAddress:this.paymentAddress,publicKey:this.publicKey}}catch(Kh){throw G(),Kh}}async disconnect(){this.requireInstalled(),await this.walletInstance.disconnect(),this.isConnected=!1,this.address=null,this.ordinalsAddress=null,this.paymentAddress=null,X()}async isConnectedCheck(){if(!this.isInstalled())return!1;try{return await this.walletInstance.isConnected()}catch(Kh){return this.isConnected}}async getAddress(){this.requireConnected();try{const e=await this.walletInstance.getAddresses();return e&&e.taproot&&e.taproot.address?e.taproot.address:this.address}catch(Kh){return G(),this.address}}async getAccounts(){this.requireInstalled();try{const e=await this.walletInstance.getAddresses();return e&&e.taproot?[e.taproot.address,e.nativeSegwit.address]:[]}catch(Kh){throw G(),Kh}}async getBalance(){this.requireConnected();try{if("function"==typeof this.walletInstance.getBalance){const e=await this.walletInstance.getBalance();return l.balance(e,"Oyl")}throw new Error("Oyl wallet does not support balance fetching")}catch(Kh){throw new Error(`Failed to get Oyl balance: ${Kh.message}`)}}async getNetwork(){this.requireInstalled();try{if("function"==typeof this.walletInstance.getNetwork){const e=await this.walletInstance.getNetwork();return l.network(e)}return"livenet"}catch(Kh){return G(),"livenet"}}async switchNetwork(e){this.requireInstalled(),await this.walletInstance.switchNetwork(e),X()}async signMessage(e,t={}){this.requireConnected();const n=t.toSignAddress||this.paymentAddress||this.address,r=await this.walletInstance.signMessage({address:n,message:e,protocol:t.protocol});return r?.signature||r}async signPsbt(e,t={}){this.requireConnected(),X();try{let n,r=e;if(e instanceof Uint8Array)X(),r=Array.from(e,e=>e.toString(16).padStart(2,"0")).join(""),X();else if("string"==typeof e&&e.startsWith("cHNidP")){if(X(),"undefined"!=typeof Buffer)r=Buffer.from(e,"base64").toString("hex");else{const t=atob(e);r=Array.from(t,e=>e.charCodeAt(0).toString(16).padStart(2,"0")).join("")}X()}else if("string"==typeof e){const t=e.toLowerCase().trim();if(!/^[0-9a-f]+$/.test(t))throw G(),new Error("Invalid PSBT format provided to OYL wallet");r=t,X()}if(!r.toLowerCase().startsWith("70736274"))throw G(),new Error("Invalid PSBT: missing magic bytes");X(),X(r.length);try{const e={psbt:r,finalize:t.autoFinalized??t.finalize??!1,broadcast:t.broadcast??!1};X(),n=await this.walletInstance.signPsbt(e),X()}catch(Kh){throw G(),new Error(`OYL wallet failed to sign PSBT: ${Kh?.message}. Make sure you are connected to OYL wallet and try again.`)}let i=n?.psbt||n;if(!i)throw new Error("OYL returned invalid response - no psbt property found");if(X(),"string"==typeof i&&i.startsWith("cHNidP")){if(X(),"undefined"!=typeof Buffer)return Buffer.from(i,"base64").toString("hex");const e=atob(i);return Array.from(e,e=>e.charCodeAt(0).toString(16).padStart(2,"0")).join("")}return i}catch(Kh){throw G(),Kh}}async signPsbts(e,t={}){this.requireConnected(),X();const n=(e||[]).map(e=>{if("string"!=typeof e)return e;if(e.startsWith("cHNidP")){if("undefined"!=typeof Buffer)return Buffer.from(e,"base64").toString("hex");const t=atob(e);return Array.from(t,e=>e.charCodeAt(0).toString(16).padStart(2,"0")).join("")}return e}),r=n.map(e=>({psbt:e,finalize:t.autoFinalized??t.finalize??!1,broadcast:t.broadcast??!1}));X();const i=await this.walletInstance.signPsbts(r);return X(),Array.isArray(i)?i.map(e=>{const t=e?.psbt||e;if("string"==typeof t&&t.startsWith("cHNidP")){if("undefined"!=typeof Buffer)return Buffer.from(t,"base64").toString("hex");const e=atob(t);return Array.from(e,e=>e.charCodeAt(0).toString(16).padStart(2,"0")).join("")}return t}):i}async pushPsbt(e){this.requireConnected();const t=await this.walletInstance.pushPsbt({psbt:e}),n=t?.txid||t;return X(),n}async sendBitcoin(e,t){if(this.requireConnected(),"function"!=typeof this.walletInstance.sendBitcoin)throw G(),new Error("Oyl wallet does not support sendBitcoin() method.\nUse sendToRelayProvider() or external transaction building.");try{const n=await this.walletInstance.sendBitcoin(e,t);return X(),n}catch(Kh){throw G(),Kh}}async getInscriptions(e=0,t=100){this.requireConnected();try{if("function"!=typeof this.walletInstance.getInscriptions)return G(),{list:[],total:0};const n=await this.walletInstance.getInscriptions(e,t),r=Array.isArray(n)?n:n.list||[];return{list:r.map(e=>l.inscription(e,"Oyl")),total:r.length}}catch(Kh){return G(),{list:[],total:0}}}async sendToRelayProvider(e){if(this.requireInstalled(),"function"!=typeof this.walletInstance.sendToRelayProvider)throw new Error("Oyl wallet does not support sendToRelayProvider()");return await this.walletInstance.sendToRelayProvider(e)}},BitmapWallet:class extends A{constructor(){super("BitmapWallet"),this._events=new Map,this.walletInstance="undefined"!=typeof window&&window.bitmapWallet?window.bitmapWallet:null,this.isConnected=!!this.walletInstance?.isConnected,this.address=this.isConnected&&this.walletInstance.getAddress?this.walletInstance.getAddress():null}isInstalled(){return"undefined"!=typeof window&&window.bitmapWallet&&"function"==typeof window.bitmapWallet.request}setupEventListeners(){this.walletInstance&&"function"==typeof this.walletInstance.on&&(this.walletInstance.on("accountsChanged",e=>{e&&e.length>0&&(this.address=e[0],this._emit("accountsChanged",{accounts:e,address:this.address}))}),this.walletInstance.on("networkChanged",e=>{this._emit("networkChanged",{network:e})}),this.walletInstance.on("disconnect",()=>{this.isConnected=!1,this.address=null,this._emit("disconnect")}))}async request(e,t){let n,r;switch("object"==typeof e&&null!==e?(n=e.method,r=e.params):(n=e,r=t),n){case"connect":return await this.connect(r?.options);case"disconnect":return await this.disconnect();case"requestAccounts":case"getAccounts":return await this.getAccounts();case"getAddress":return await this.getAddress();case"getBalance":return await this.getBalance(r);case"getInscriptions":return await this.getInscriptions(r||{});case"signMessage":return await this.signMessage(r);case"signPsbt":return await this.signPsbt(r?.psbt||r);case"signPsbts":return await this.signPsbts(r?.psbts||r);case"pushPsbt":return await this.pushPsbt(r?.psbt||r);case"pushTx":return await this.pushTx(r?.hex||r);case"getUtxos":return await this.getUtxos(r?.address||r);case"getFeeRate":return await this.getFeeRate();case"getNetwork":return await this.getNetwork();case"switchNetwork":return await this.switchNetwork(r?.network||r);case"getSpendableUtxos":return await this.getSpendableUtxos(r?.address||r);case"getRunes":return await this.getRunes(r?.address||r);case"getRareSats":return await this.getRareSats(r?.address||r);case"sendBitcoin":return await this.sendBitcoin(r?.toAddress,r?.satoshis,r?.options);case"sendInscription":return await this.sendInscription(r?.address,r?.inscriptionId,r?.options);case"detectBitmaps":return await this.detectBitmaps();default:if(this.walletInstance&&"function"==typeof this.walletInstance.request)return await this.walletInstance.request({method:n,params:r});throw new Error(`Unsupported method: ${n}`)}}async connect(e={}){if(J(this.walletInstance),!this.walletInstance)throw new Error("BitmapWallet not installed or not detected at window.bitmapWallet");if(this.setupEventListeners(),"function"==typeof this.walletInstance.connect){J();const n=await this.walletInstance.connect(e);J(),this.isConnected=!0;try{this.address=await this.getAddress(),J()}catch(t){Q()}return{...n,address:this.address||n.address||n.accounts?.[0],connected:!0}}if("function"==typeof this.walletInstance.requestAccounts){J();const e=await this.walletInstance.requestAccounts();return J(),this.isConnected=!0,this.address=Array.isArray(e)?e[0]:e,{address:this.address,accounts:e,connected:!0}}Q(),this.isConnected=!0;try{this.address=await this.getAddress(),J()}catch(t){throw Q(),new Error("BitmapWallet: Could not retrieve address. Wallet may not be connected.")}return this._emit("connect",{address:this.address}),{address:this.address,connected:!0}}async disconnect(){if(this.walletInstance?.disconnect){const e=await this.walletInstance.disconnect();return this.isConnected=!1,this.address=null,this._emit("disconnect"),e}return this.isConnected=!1,this.address=null,this._emit("disconnect"),{disconnected:!0}}async getAccounts(){return this.walletInstance?.getAccounts?await this.walletInstance.getAccounts():this.address?[this.address]:[]}async getAddress(){return this.walletInstance?.getAddress?await this.walletInstance.getAddress():this.address}async getPublicKey(){if(this.walletInstance?.getPublicKey)return await this.walletInstance.getPublicKey();throw new Error("getPublicKey not available")}async getBalance(){if(this.walletInstance?.getBalance)return await this.walletInstance.getBalance();throw new Error("getBalance not available")}async getUtxos(e){if(this.walletInstance?.getUtxos)return await this.walletInstance.getUtxos(e);throw new Error("getUtxos not available")}async getInscriptions({offset:e=0,limit:t=100}={}){return this.walletInstance?.getInscriptions?await this.walletInstance.getInscriptions({offset:e,limit:t}):[]}async detectBitmaps(){return this.walletInstance?.detectBitmaps?await this.walletInstance.detectBitmaps():[]}async signMessage({address:e,message:t,protocol:n="BIP322"}={}){if(this.walletInstance?.signMessage)return await this.walletInstance.signMessage({address:e,message:t,protocol:n});throw new Error("signMessage not available")}_isHexString(e){return"string"==typeof e&&/^[0-9a-fA-F]+$/.test(e)&&e.length%2==0}_looksLikePsbtBase64(e){return"string"==typeof e&&e.startsWith("cHNidP8")}_isMagicNumberError(e){const t=String(e?.message||e||"");return/magic\s*number/i.test(t)}async _getBitcoinJs(){return"undefined"!=typeof window&&window.bitcoin?.Psbt?window.bitcoin:await n(()=>Promise.resolve().then(()=>gB),__VITE_PRELOAD__)}async _convertPsbtString(e,t){const n=await this._getBitcoinJs();return"base64"===t?this._looksLikePsbtBase64(e)?e:this._isHexString(e)?n.Psbt.fromHex(e).toBase64():n.Psbt.fromBase64(e).toBase64():"hex"===t?this._isHexString(e)?e:this._looksLikePsbtBase64(e)?n.Psbt.fromBase64(e).toHex():n.Psbt.fromHex(e).toHex():e}async signPsbt(e,t={}){if(!e)throw new Error("psbt required");if(!this.walletInstance?.signPsbt)throw new Error("signPsbt not available");const n=e,r=this._isHexString(n),i=this._looksLikePsbtBase64(n),a=r?"hex":i?"base64":null;try{return await this.walletInstance.signPsbt(n,t)}catch(o){if(!this._isMagicNumberError(o))throw o;const e=r?"base64":i?"hex":"base64",s=await this._convertPsbtString(n,e),l=await this.walletInstance.signPsbt(s,t);return"string"==typeof l&&a&&a!==e?await this._convertPsbtString(l,a):l}}async signPsbts(e,t={}){if(!Array.isArray(e))throw new Error("psbts must be an array");if(this.walletInstance?.signPsbts)try{return await this.walletInstance.signPsbts(e,t)}catch(r){if(!this._isMagicNumberError(r))throw r}const n=[];for(let i=0;i<e.length;i++)n.push(await this.signPsbt(e[i],t));return n}async pushPsbt(e){if(this.walletInstance?.pushPsbt){let n=e;if("string"==typeof e&&!e.startsWith("02"))try{const t=await this._getBitcoinJs();let r;r=this._isHexString(e)?t.Psbt.fromHex(e):t.Psbt.fromBase64(e),n=r.extractTransaction().toHex()}catch(t){Q()}return await this.walletInstance.pushPsbt(n)}throw new Error("pushPsbt not available")}async pushTx(e){if(this.walletInstance?.pushTx)return await this.walletInstance.pushTx(e);throw new Error("pushTx not available")}async getFeeRate(){if(this.walletInstance?.getFeeRate)return await this.walletInstance.getFeeRate();throw new Error("getFeeRate not available")}async getNetwork(){return this.walletInstance?.getNetwork?await this.walletInstance.getNetwork():"mainnet"}async switchNetwork(e){if(this.walletInstance?.switchNetwork){const t=await this.walletInstance.switchNetwork(e);return this._emit("networkChanged",{network:e}),t}throw new Error("switchNetwork not available")}async getSpendableUtxos(e){if(this.walletInstance?.getSpendableUtxos)return await this.walletInstance.getSpendableUtxos(e);if(this.walletInstance?.getUtxos)return await this.walletInstance.getUtxos(e);throw new Error("getSpendableUtxos not available")}async getRunes(e){return this.walletInstance?.getRunes?await this.walletInstance.getRunes(e):[]}async getRareSats(e){return this.walletInstance?.getRareSats?await this.walletInstance.getRareSats(e):[]}async sendBitcoin(e,t,n={}){if(this.walletInstance?.sendBitcoin)return await this.walletInstance.sendBitcoin(e,t,n);throw new Error("sendBitcoin not available")}async sendInscription(e,t,n={}){if(this.walletInstance?.sendInscription)return await this.walletInstance.sendInscription(e,t,n);throw new Error("sendInscription not available")}on(e,t){return this._events.has(e)||this._events.set(e,new Set),this._events.get(e).add(t),()=>this._events.get(e).delete(t)}_emit(e,t){const n=this._events.get(e);if(n)for(const i of n)try{i(t)}catch(r){Q()}}}};let te={isConnected:!1,walletType:null,address:null,publicKey:null,paymentAddress:null,ordinalsAddress:null,paymentPublicKey:null,ordinalsPublicKey:null,balance:null,provider:null};const ne=new Set;function re(e){te={...te,...e},ne.forEach(e=>e(te))}async function ie(...e){if(!te.provider)throw new Error("No wallet connected");return await te.provider.sendBitcoin(...e)}function ae(e){const t=ee[e];if(!t)throw new Error(`Unknown wallet: ${e}`);const n=new t;if(!n.isInstalled()){const t=Z[e];throw new Error(`${e} wallet is not installed.\n\nDownload: ${t?.downloadUrl||"Visit wallet website"}`)}return n}const oe="nexus.mobileWalletDeepLinks.v1";function se(){if("undefined"==typeof window)return{};const e=window.NEXUS_MOBILE_WALLET_DEEPLINKS;if(e&&"object"==typeof e)return e;try{const e=window.localStorage?.getItem(oe);if(!e)return{};const t=JSON.parse(e);return t&&"object"==typeof t?t:{}}catch{return{}}}function le(e,t){if("undefined"==typeof window)return null;const n=t||window.location?.href;if(!n)return null;const r=function(e){const t=se(),n=t?.[e];return!n||"function"!=typeof n&&"string"!=typeof n?null:n}(e);if(!r)return null;const i=encodeURIComponent(n);if("function"==typeof r)try{return r(n)}catch{return null}return r.replace(/\{url\}/g,i)}const ce={createProvider:ae,detectWallets:function(){const e=[];for(const[t,n]of Object.entries(Z))n.detection&&n.detection()&&e.push({name:t,...n});return e},connect:async function(e){const t=ae(e);if(!t)throw new Error(`Failed to create provider for ${e}`);try{const r=await t.connect();re({isConnected:!0,walletType:e,address:r.address||t.address,publicKey:r.publicKey||t.publicKey,paymentAddress:r.paymentAddress||t.paymentAddress,ordinalsAddress:r.ordinalsAddress||t.ordinalsAddress,paymentPublicKey:r.paymentPublicKey||t.paymentPublicKey,ordinalsPublicKey:r.ordinalsPublicKey||t.ordinalsPublicKey,provider:t});try{const e=await t.getBalance();let n,r=0;"number"==typeof e?e<1&&e>0?(n=e,r=Math.round(1e8*e)):(r=e,n=e/1e8):e&&"object"==typeof e?(r=e.total||e.confirmed||0,n=r/1e8):n=0,re({balance:n})}catch(n){re({balance:null})}return t}catch(Kh){throw Kh}},disconnect:async function(){if(te.provider)try{await te.provider.disconnect()}catch(Kh){}re({isConnected:!1,walletType:null,address:null,publicKey:null,paymentAddress:null,ordinalsAddress:null,paymentPublicKey:null,ordinalsPublicKey:null,balance:null,provider:null})},getState:function(){return{...te}},subscribe:function(e){return ne.add(e),()=>ne.delete(e)},getCurrentProvider:function(){return te.provider},getWalletInfo:function(e){return Z[e]||null},getAllWalletInfo:function(){return{...Z}},setMobileWalletDeepLinks:function(e){return function(e){if("undefined"==typeof window)return;const t=e&&"object"==typeof e?e:{};window.NEXUS_MOBILE_WALLET_DEEPLINKS=t;try{window.localStorage?.setItem(oe,JSON.stringify(t))}catch{}}(e),se()},getMobileConnectUrl:le,openMobileWallet:async function(e,t){if("undefined"==typeof window)throw new Error("openMobileWallet requires a browser environment");const n=le(e,t);if(!n)throw new Error(`No mobile deep link configured for ${e}.\n\nConfigure window.NEXUS_MOBILE_WALLET_DEEPLINKS['${e}'] = '<template>' where <template> includes {url} placeholder.\nExample: { '${e}': 'your-scheme://browse?url={url}' }`);return window.location.href=n,n},loadNormalizers:async function(){return{normalizeInscription:r,normalizeBalance:i,normalizers:l||l,normalizePsbtOptions:a,normalizeNetwork:o,normalizeAddress:s}},loadWalletConnector:async function(){return k},getBalance:async function(){if(!te.provider)throw new Error("No wallet connected");const e=await te.provider.getBalance();let t;return t="number"==typeof e?e<1&&e>0?e:e/1e8:e&&"object"==typeof e?(e.total||e.confirmed||0)/1e8:0,re({balance:t}),t},getInscriptions:async function(...e){if(!te.provider)throw new Error("No wallet connected");const t=await te.provider.getInscriptions(...e);return t&&"object"==typeof t&&Array.isArray(t.list)?t.list:Array.isArray(t)?t:[]},getAllInscriptions:async function(){if(!te.provider)throw new Error("No wallet connected");return await te.provider.getAllInscriptions()},signMessage:async function(...e){if(!te.provider)throw new Error("No wallet connected");return await te.provider.signMessage(...e)},signPsbt:async function(...e){if(!te.provider)throw new Error("No wallet connected");return await te.provider.signPsbt(...e)},signPsbts:async function(...e){if(!te.provider)throw new Error("No wallet connected");return await te.provider.signPsbts(...e)},sendBitcoin:ie,sendBTC:async function(...e){return await ie(...e)},getNetwork:async function(){if(!te.provider)throw new Error("No wallet connected");return await te.provider.getNetwork()},switchNetwork:async function(...e){if(!te.provider)throw new Error("No wallet connected");return await te.provider.switchNetwork(...e)},getPublicKey:async function(){if(!te.provider)throw new Error("No wallet connected");return await te.provider.getPublicKey()},getAddress:async function(){if(!te.provider)throw new Error("No wallet connected");return await te.provider.getAddress()},getAccounts:async function(){if(!te.provider)throw new Error("No wallet connected");return await te.provider.getAccounts()},pushPsbt:async function(...e){if(!te.provider)throw new Error("No wallet connected");return await te.provider.pushPsbt(...e)},pushTx:async function(...e){if(!te.provider)throw new Error("No wallet connected");return await te.provider.pushTx(...e)},sendInscription:async function(...e){if(!te.provider)throw new Error("No wallet connected");return await te.provider.sendInscription(...e)},inscribe:async function(...e){if(!te.provider)throw new Error("No wallet connected");return await te.provider.inscribe(...e)},sendRunes:async function(...e){if(!te.provider)throw new Error("No wallet connected");return await te.provider.sendRunes(...e)},getWalletFeatures:function(){if(!te.provider)throw new Error("No wallet connected");return te.provider.getInfo()},getAddresses:async function(...e){if(!te.provider)throw new Error("No wallet connected");if("function"!=typeof te.provider.getAddresses)throw new Error(`${te.walletType} does not support getAddresses()`);return await te.provider.getAddresses(...e)},createRepeatInscriptions:async function(...e){if(!te.provider)throw new Error("No wallet connected");if("function"!=typeof te.provider.createRepeatInscriptions)throw new Error(`${te.walletType} does not support batch inscriptions`);return await te.provider.createRepeatInscriptions(...e)},sendInscriptions:async function(...e){if(!te.provider)throw new Error("No wallet connected");if("function"!=typeof te.provider.sendInscriptions)throw new Error(`${te.walletType} does not support sendInscriptions()`);return await te.provider.sendInscriptions(...e)},getRunesBalance:async function(){if(!te.provider)throw new Error("No wallet connected");if("function"!=typeof te.provider.getRunesBalance)throw new Error(`${te.walletType} does not support Runes`);return await te.provider.getRunesBalance()},transferRunes:async function(...e){if(!te.provider)throw new Error("No wallet connected");if("function"!=typeof te.provider.transferRunes)throw new Error(`${te.walletType} does not support Runes transfer`);return await te.provider.transferRunes(...e)},mintRunes:async function(...e){if(!te.provider)throw new Error("No wallet connected");if("function"!=typeof te.provider.mintRunes)throw new Error(`${te.walletType} does not support Runes minting`);return await te.provider.mintRunes(...e)},etchRunes:async function(...e){if(!te.provider)throw new Error("No wallet connected");if("function"!=typeof te.provider.etchRunes)throw new Error(`${te.walletType} does not support Runes etching`);return await te.provider.etchRunes(...e)},getRunesOrder:async function(...e){if(!te.provider)throw new Error("No wallet connected");if("function"!=typeof te.provider.getRunesOrder)throw new Error(`${te.walletType} does not support getRunesOrder()`);return await te.provider.getRunesOrder(...e)},signMultipleTransactions:async function(...e){if(!te.provider)throw new Error("No wallet connected");if("function"!=typeof te.provider.signMultipleTransactions)throw new Error(`${te.walletType} does not support signMultipleTransactions()`);return await te.provider.signMultipleTransactions(...e)},createInscription:async function(...e){if(!te.provider)throw new Error("No wallet connected");if("function"!=typeof te.provider.createInscription)throw new Error(`${te.walletType} does not support createInscription()`);return await te.provider.createInscription(...e)},getProductInfo:async function(){if(!te.provider)throw new Error("No wallet connected");if("function"!=typeof te.provider.getProductInfo)throw new Error(`${te.walletType} does not support getProductInfo() (Leather only)`);return await te.provider.getProductInfo()},getURL:async function(){if(!te.provider)throw new Error("No wallet connected");if("function"!=typeof te.provider.getURL)throw new Error(`${te.walletType} does not support getURL() (Leather only)`);return await te.provider.getURL()},signStructuredData:async function(...e){if(!te.provider)throw new Error("No wallet connected");if("function"!=typeof te.provider.signStructuredData)throw new Error(`${te.walletType} does not support signStructuredData() (Leather only)`);return await te.provider.signStructuredData(...e)},authenticate:async function(...e){if(!te.provider)throw new Error("No wallet connected");if("function"!=typeof te.provider.authenticate)throw new Error(`${te.walletType} does not support authenticate() (Leather only)`);return await te.provider.authenticate(...e)},sendStacksTransaction:async function(...e){if(!te.provider)throw new Error("No wallet connected");if("function"!=typeof te.provider.sendStacksTransaction)throw new Error(`${te.walletType} does not support Stacks transactions (Leather only)`);return await te.provider.sendStacksTransaction(...e)},updateProfile:async function(...e){if(!te.provider)throw new Error("No wallet connected");if("function"!=typeof te.provider.updateProfile)throw new Error(`${te.walletType} does not support updateProfile() (Leather only)`);return await te.provider.updateProfile(...e)},isHardware:async function(){if(!te.provider)throw new Error("No wallet connected");if("function"!=typeof te.provider.isHardware)throw new Error(`${te.walletType} does not support isHardware() (MagicEden only)`);return await te.provider.isHardware()},call:async function(...e){if(!te.provider)throw new Error("No wallet connected");if("function"!=typeof te.provider.call)throw new Error(`${te.walletType} does not support call() (MagicEden only)`);return await te.provider.call(...e)},inscribeTransfer:async function(...e){if(!te.provider)throw new Error("No wallet connected");if("function"!=typeof te.provider.inscribeTransfer)throw new Error(`${te.walletType} does not support inscribeTransfer()`);return await te.provider.inscribeTransfer(...e)},splitUtxo:async function(...e){if(!te.provider)throw new Error("No wallet connected");if("function"!=typeof te.provider.splitUtxo)throw new Error(`${te.walletType} does not support splitUtxo() (OKX only)`);return await te.provider.splitUtxo(...e)},transferNft:async function(...e){if(!te.provider)throw new Error("No wallet connected");if("function"!=typeof te.provider.transferNft)throw new Error(`${te.walletType} does not support transferNft() (OKX only)`);return await te.provider.transferNft(...e)},watchAsset:async function(...e){if(!te.provider)throw new Error("No wallet connected");if("function"!=typeof te.provider.watchAsset)throw new Error(`${te.walletType} does not support watchAsset() (OKX only)`);return await te.provider.watchAsset(...e)},mint:async function(...e){if(!te.provider)throw new Error("No wallet connected");if("function"!=typeof te.provider.mint)throw new Error(`${te.walletType} does not support mint() (OKX only)`);return await te.provider.mint(...e)},getCapabilities:async function(){if(!te.provider)throw new Error("No wallet connected");if("function"!=typeof te.provider.getCapabilities)throw new Error(`${te.walletType} does not support getCapabilities()`);return await te.provider.getCapabilities()},getUtxos:async function(){if(!te.provider)throw new Error("No wallet connected");if("function"!=typeof te.provider.getUtxos&&"function"!=typeof te.provider.getBitcoinUtxos&&"function"!=typeof te.provider.splitUtxo)throw new Error(`${te.walletType} does not support UTXO fetching. Only UniSat and Wizz provide confirmed UTXO access. OKX has splitUtxo() method with different API.`);let e;return"function"==typeof te.provider.getUtxos?e=await te.provider.getUtxos():"function"==typeof te.provider.getBitcoinUtxos?e=await te.provider.getBitcoinUtxos():"function"==typeof te.provider.splitUtxo&&(e=(await te.provider.splitUtxo({from:te.address,amount:2})).utxos||[]),e},getBRC20List:async function(){if(!te.provider)throw new Error("No wallet connected");if("function"!=typeof te.provider.getBRC20List&&"function"!=typeof te.provider.getBRC20Summary)throw new Error(`${te.walletType} does not support BRC-20 listing. Only UniSat provides BRC-20 token listing.`);return"function"==typeof te.provider.getBRC20List?await te.provider.getBRC20List():await te.provider.getBRC20Summary()},WALLET_INFO:Z};function ue(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}for(var de={},fe={byteLength:function(e){var t=be(e),n=t[0],r=t[1];return 3*(n+r)/4-r},toByteArray:function(e){var t,n,r=be(e),i=r[0],a=r[1],o=new he(function(e,t,n){return 3*(t+n)/4-n}(0,i,a)),s=0,l=a>0?i-4:i;for(n=0;n<l;n+=4)t=me[e.charCodeAt(n)]<<18|me[e.charCodeAt(n+1)]<<12|me[e.charCodeAt(n+2)]<<6|me[e.charCodeAt(n+3)],o[s++]=t>>16&255,o[s++]=t>>8&255,o[s++]=255&t;return 2===a&&(t=me[e.charCodeAt(n)]<<2|me[e.charCodeAt(n+1)]>>4,o[s++]=255&t),1===a&&(t=me[e.charCodeAt(n)]<<10|me[e.charCodeAt(n+1)]<<4|me[e.charCodeAt(n+2)]>>2,o[s++]=t>>8&255,o[s++]=255&t),o},fromByteArray:function(e){for(var t,n=e.length,r=n%3,i=[],a=16383,o=0,s=n-r;o<s;o+=a)i.push(xe(e,o,o+a>s?s:o+a));return 1===r?(t=e[n-1],i.push(pe[t>>2]+pe[t<<4&63]+"==")):2===r&&(t=(e[n-2]<<8)+e[n-1],i.push(pe[t>>10]+pe[t>>4&63]+pe[t<<2&63]+"=")),i.join("")}},pe=[],me=[],he="undefined"!=typeof Uint8Array?Uint8Array:Array,ge="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ye=0;ye<64;++ye)pe[ye]=ge[ye],me[ge.charCodeAt(ye)]=ye;function be(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function we(e){return pe[e>>18&63]+pe[e>>12&63]+pe[e>>6&63]+pe[63&e]}function xe(e,t,n){for(var r,i=[],a=t;a<n;a+=3)r=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),i.push(we(r));return i.join("")}me["-".charCodeAt(0)]=62,me["_".charCodeAt(0)]=63;var ve={read:function(e,t,n,r,i){var a,o,s=8*i-r-1,l=(1<<s)-1,c=l>>1,u=-7,d=n?i-1:0,f=n?-1:1,p=e[t+d];for(d+=f,a=p&(1<<-u)-1,p>>=-u,u+=s;u>0;a=256*a+e[t+d],d+=f,u-=8);for(o=a&(1<<-u)-1,a>>=-u,u+=r;u>0;o=256*o+e[t+d],d+=f,u-=8);if(0===a)a=1-c;else{if(a===l)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,r),a-=c}return(p?-1:1)*o*Math.pow(2,a-r)},write:function(e,t,n,r,i,a){var o,s,l,c=8*a-i-1,u=(1<<c)-1,d=u>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:a-1,m=r?1:-1,h=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+d>=1?f/l:f*Math.pow(2,1-d))*l>=2&&(o++,l/=2),o+d>=u?(s=0,o=u):o+d>=1?(s=(t*l-1)*Math.pow(2,i),o+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,i),o=0));i>=8;e[n+p]=255&s,p+=m,s/=256,i-=8);for(o=o<<i|s,c+=i;c>0;e[n+p]=255&o,p+=m,o/=256,c-=8);e[n+p-m]|=128*h}};!function(e){const t=fe,n=ve,r="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=o,e.SlowBuffer=function(e){return+e!=e&&(e=0),o.alloc(+e)},e.INSPECT_MAX_BYTES=50;const i=2147483647;function a(e){if(e>i)throw new RangeError('The value "'+e+'" is invalid for option "size"');const t=new Uint8Array(e);return Object.setPrototypeOf(t,o.prototype),t}function o(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return c(e)}return s(e,t,n)}function s(e,t,n){if("string"==typeof e)return function(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!o.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const n=0|p(e,t);let r=a(n);const i=r.write(e,t);return i!==n&&(r=r.slice(0,i)),r}(e,t);if(ArrayBuffer.isView(e))return function(e){if(K(e,Uint8Array)){const t=new Uint8Array(e);return d(t.buffer,t.byteOffset,t.byteLength)}return u(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(K(e,ArrayBuffer)||e&&K(e.buffer,ArrayBuffer))return d(e,t,n);if("undefined"!=typeof SharedArrayBuffer&&(K(e,SharedArrayBuffer)||e&&K(e.buffer,SharedArrayBuffer)))return d(e,t,n);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');const r=e.valueOf&&e.valueOf();if(null!=r&&r!==e)return o.from(r,t,n);const i=function(e){if(o.isBuffer(e)){const t=0|f(e.length),n=a(t);return 0===n.length||e.copy(n,0,0,t),n}return void 0!==e.length?"number"!=typeof e.length||X(e.length)?a(0):u(e):"Buffer"===e.type&&Array.isArray(e.data)?u(e.data):void 0}(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return o.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function c(e){return l(e),a(e<0?0:0|f(e))}function u(e){const t=e.length<0?0:0|f(e.length),n=a(t);for(let r=0;r<t;r+=1)n[r]=255&e[r];return n}function d(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');let r;return r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),Object.setPrototypeOf(r,o.prototype),r}function f(e){if(e>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return 0|e}function p(e,t){if(o.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||K(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);const n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;let i=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return V(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return j(e).length;default:if(i)return r?-1:V(e).length;t=(""+t).toLowerCase(),i=!0}}function m(e,t,n){let r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return T(this,t,n);case"utf8":case"utf-8":return I(this,t,n);case"ascii":return A(this,t,n);case"latin1":case"binary":return N(this,t,n);case"base64":return E(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function h(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function g(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),X(n=+n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=o.from(t,r)),o.isBuffer(t))return 0===t.length?-1:y(e,t,n,r,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):y(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function y(e,t,n,r,i){let a,o=1,s=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;o=2,s/=2,l/=2,n/=2}function c(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){let r=-1;for(a=n;a<s;a++)if(c(e,a)===c(t,-1===r?0:a-r)){if(-1===r&&(r=a),a-r+1===l)return r*o}else-1!==r&&(a-=a-r),r=-1}else for(n+l>s&&(n=s-l),a=n;a>=0;a--){let n=!0;for(let r=0;r<l;r++)if(c(e,a+r)!==c(t,r)){n=!1;break}if(n)return a}return-1}function b(e,t,n,r){n=Number(n)||0;const i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;const a=t.length;let o;for(r>a/2&&(r=a/2),o=0;o<r;++o){const r=parseInt(t.substr(2*o,2),16);if(X(r))return o;e[n+o]=r}return o}function w(e,t,n,r){return q(V(t,e.length-n),e,n,r)}function x(e,t,n,r){return q(function(e){const t=[];for(let n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function v(e,t,n,r){return q(j(t),e,n,r)}function S(e,t,n,r){return q(function(e,t){let n,r,i;const a=[];for(let o=0;o<e.length&&!((t-=2)<0);++o)n=e.charCodeAt(o),r=n>>8,i=n%256,a.push(i),a.push(r);return a}(t,e.length-n),e,n,r)}function E(e,n,r){return 0===n&&r===e.length?t.fromByteArray(e):t.fromByteArray(e.slice(n,r))}function I(e,t,n){n=Math.min(e.length,n);const r=[];let i=t;for(;i<n;){const t=e[i];let a=null,o=t>239?4:t>223?3:t>191?2:1;if(i+o<=n){let n,r,s,l;switch(o){case 1:t<128&&(a=t);break;case 2:n=e[i+1],128==(192&n)&&(l=(31&t)<<6|63&n,l>127&&(a=l));break;case 3:n=e[i+1],r=e[i+2],128==(192&n)&&128==(192&r)&&(l=(15&t)<<12|(63&n)<<6|63&r,l>2047&&(l<55296||l>57343)&&(a=l));break;case 4:n=e[i+1],r=e[i+2],s=e[i+3],128==(192&n)&&128==(192&r)&&128==(192&s)&&(l=(15&t)<<18|(63&n)<<12|(63&r)<<6|63&s,l>65535&&l<1114112&&(a=l))}}null===a?(a=65533,o=1):a>65535&&(a-=65536,r.push(a>>>10&1023|55296),a=56320|1023&a),r.push(a),i+=o}return function(e){const t=e.length;if(t<=k)return String.fromCharCode.apply(String,e);let n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=k));return n}(r)}e.kMaxLength=i,o.TYPED_ARRAY_SUPPORT=function(){try{const e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),!o.TYPED_ARRAY_SUPPORT&&"undefined"!=typeof console&&console.error,Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}}),o.poolSize=8192,o.from=function(e,t,n){return s(e,t,n)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array),o.alloc=function(e,t,n){return function(e,t,n){return l(e),e<=0?a(e):void 0!==t?"string"==typeof n?a(e).fill(t,n):a(e).fill(t):a(e)}(e,t,n)},o.allocUnsafe=function(e){return c(e)},o.allocUnsafeSlow=function(e){return c(e)},o.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==o.prototype},o.compare=function(e,t){if(K(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),K(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),!o.isBuffer(e)||!o.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let n=e.length,r=t.length;for(let i=0,a=Math.min(n,r);i<a;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);let n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;const r=o.allocUnsafe(t);let i=0;for(n=0;n<e.length;++n){let t=e[n];if(K(t,Uint8Array))i+t.length>r.length?(o.isBuffer(t)||(t=o.from(t)),t.copy(r,i)):Uint8Array.prototype.set.call(r,t,i);else{if(!o.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(r,i)}i+=t.length}return r},o.byteLength=p,o.prototype._isBuffer=!0,o.prototype.swap16=function(){const e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)h(this,t,t+1);return this},o.prototype.swap32=function(){const e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)h(this,t,t+3),h(this,t+1,t+2);return this},o.prototype.swap64=function(){const e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)h(this,t,t+7),h(this,t+1,t+6),h(this,t+2,t+5),h(this,t+3,t+4);return this},o.prototype.toString=function(){const e=this.length;return 0===e?"":0===arguments.length?I(this,0,e):m.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(e){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){let t="";const n=e.INSPECT_MAX_BYTES;return t=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(t+=" ... "),"<Buffer "+t+">"},r&&(o.prototype[r]=o.prototype.inspect),o.prototype.compare=function(e,t,n,r,i){if(K(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),!o.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;let a=(i>>>=0)-(r>>>=0),s=(n>>>=0)-(t>>>=0);const l=Math.min(a,s),c=this.slice(r,i),u=e.slice(t,n);for(let o=0;o<l;++o)if(c[o]!==u[o]){a=c[o],s=u[o];break}return a<s?-1:s<a?1:0},o.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},o.prototype.indexOf=function(e,t,n){return g(this,e,t,n,!0)},o.prototype.lastIndexOf=function(e,t,n){return g(this,e,t,n,!1)},o.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}const i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");let a=!1;for(;;)switch(r){case"hex":return b(this,e,t,n);case"utf8":case"utf-8":return w(this,e,t,n);case"ascii":case"latin1":case"binary":return x(this,e,t,n);case"base64":return v(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,e,t,n);default:if(a)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),a=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const k=4096;function A(e,t,n){let r="";n=Math.min(e.length,n);for(let i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function N(e,t,n){let r="";n=Math.min(e.length,n);for(let i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function T(e,t,n){const r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);let i="";for(let a=t;a<n;++a)i+=G[e[a]];return i}function _(e,t,n){const r=e.slice(t,n);let i="";for(let a=0;a<r.length-1;a+=2)i+=String.fromCharCode(r[a]+256*r[a+1]);return i}function P(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function B(e,t,n,r,i,a){if(!o.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function C(e,t,n,r,i){H(t,r,i,e,n,7);let a=Number(t&BigInt(4294967295));e[n++]=a,a>>=8,e[n++]=a,a>>=8,e[n++]=a,a>>=8,e[n++]=a;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o,n}function O(e,t,n,r,i){H(t,r,i,e,n,7);let a=Number(t&BigInt(4294967295));e[n+7]=a,a>>=8,e[n+6]=a,a>>=8,e[n+5]=a,a>>=8,e[n+4]=a;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[n+3]=o,o>>=8,e[n+2]=o,o>>=8,e[n+1]=o,o>>=8,e[n]=o,n+8}function L(e,t,n,r,i,a){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function F(e,t,r,i,a){return t=+t,r>>>=0,a||L(e,0,r,4),n.write(e,t,r,i,23,4),r+4}function R(e,t,r,i,a){return t=+t,r>>>=0,a||L(e,0,r,8),n.write(e,t,r,i,52,8),r+8}o.prototype.slice=function(e,t){const n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);const r=this.subarray(e,t);return Object.setPrototypeOf(r,o.prototype),r},o.prototype.readUintLE=o.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||P(e,t,this.length);let r=this[e],i=1,a=0;for(;++a<t&&(i*=256);)r+=this[e+a]*i;return r},o.prototype.readUintBE=o.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||P(e,t,this.length);let r=this[e+--t],i=1;for(;t>0&&(i*=256);)r+=this[e+--t]*i;return r},o.prototype.readUint8=o.prototype.readUInt8=function(e,t){return e>>>=0,t||P(e,1,this.length),this[e]},o.prototype.readUint16LE=o.prototype.readUInt16LE=function(e,t){return e>>>=0,t||P(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUint16BE=o.prototype.readUInt16BE=function(e,t){return e>>>=0,t||P(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUint32LE=o.prototype.readUInt32LE=function(e,t){return e>>>=0,t||P(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},o.prototype.readUint32BE=o.prototype.readUInt32BE=function(e,t){return e>>>=0,t||P(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readBigUInt64LE=Y(function(e){D(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||z(e,this.length-8);const r=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,i=this[++e]+256*this[++e]+65536*this[++e]+n*2**24;return BigInt(r)+(BigInt(i)<<BigInt(32))}),o.prototype.readBigUInt64BE=Y(function(e){D(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||z(e,this.length-8);const r=t*2**24+65536*this[++e]+256*this[++e]+this[++e],i=this[++e]*2**24+65536*this[++e]+256*this[++e]+n;return(BigInt(r)<<BigInt(32))+BigInt(i)}),o.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||P(e,t,this.length);let r=this[e],i=1,a=0;for(;++a<t&&(i*=256);)r+=this[e+a]*i;return i*=128,r>=i&&(r-=Math.pow(2,8*t)),r},o.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||P(e,t,this.length);let r=t,i=1,a=this[e+--r];for(;r>0&&(i*=256);)a+=this[e+--r]*i;return i*=128,a>=i&&(a-=Math.pow(2,8*t)),a},o.prototype.readInt8=function(e,t){return e>>>=0,t||P(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},o.prototype.readInt16LE=function(e,t){e>>>=0,t||P(e,2,this.length);const n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},o.prototype.readInt16BE=function(e,t){e>>>=0,t||P(e,2,this.length);const n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},o.prototype.readInt32LE=function(e,t){return e>>>=0,t||P(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return e>>>=0,t||P(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readBigInt64LE=Y(function(e){D(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||z(e,this.length-8);const r=this[e+4]+256*this[e+5]+65536*this[e+6]+(n<<24);return(BigInt(r)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)}),o.prototype.readBigInt64BE=Y(function(e){D(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||z(e,this.length-8);const r=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(r)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+n)}),o.prototype.readFloatLE=function(e,t){return e>>>=0,t||P(e,4,this.length),n.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return e>>>=0,t||P(e,4,this.length),n.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return e>>>=0,t||P(e,8,this.length),n.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return e>>>=0,t||P(e,8,this.length),n.read(this,e,!1,52,8)},o.prototype.writeUintLE=o.prototype.writeUIntLE=function(e,t,n,r){e=+e,t>>>=0,n>>>=0,r||B(this,e,t,n,Math.pow(2,8*n)-1,0);let i=1,a=0;for(this[t]=255&e;++a<n&&(i*=256);)this[t+a]=e/i&255;return t+n},o.prototype.writeUintBE=o.prototype.writeUIntBE=function(e,t,n,r){e=+e,t>>>=0,n>>>=0,r||B(this,e,t,n,Math.pow(2,8*n)-1,0);let i=n-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+n},o.prototype.writeUint8=o.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||B(this,e,t,1,255,0),this[t]=255&e,t+1},o.prototype.writeUint16LE=o.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||B(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeUint16BE=o.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||B(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeUint32LE=o.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||B(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},o.prototype.writeUint32BE=o.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||B(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeBigUInt64LE=Y(function(e,t=0){return C(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),o.prototype.writeBigUInt64BE=Y(function(e,t=0){return O(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),o.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t>>>=0,!r){const r=Math.pow(2,8*n-1);B(this,e,t,n,r-1,-r)}let i=0,a=1,o=0;for(this[t]=255&e;++i<n&&(a*=256);)e<0&&0===o&&0!==this[t+i-1]&&(o=1),this[t+i]=(e/a|0)-o&255;return t+n},o.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t>>>=0,!r){const r=Math.pow(2,8*n-1);B(this,e,t,n,r-1,-r)}let i=n-1,a=1,o=0;for(this[t+i]=255&e;--i>=0&&(a*=256);)e<0&&0===o&&0!==this[t+i+1]&&(o=1),this[t+i]=(e/a|0)-o&255;return t+n},o.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||B(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||B(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||B(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||B(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},o.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||B(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeBigInt64LE=Y(function(e,t=0){return C(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),o.prototype.writeBigInt64BE=Y(function(e,t=0){return O(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),o.prototype.writeFloatLE=function(e,t,n){return F(this,e,t,!0,n)},o.prototype.writeFloatBE=function(e,t,n){return F(this,e,t,!1,n)},o.prototype.writeDoubleLE=function(e,t,n){return R(this,e,t,!0,n)},o.prototype.writeDoubleBE=function(e,t,n){return R(this,e,t,!1,n)},o.prototype.copy=function(e,t,n,r){if(!o.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);const i=r-n;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,r):Uint8Array.prototype.set.call(e,this.subarray(n,r),t),i},o.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!o.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===e.length){const t=e.charCodeAt(0);("utf8"===r&&t<128||"latin1"===r)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;let i;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{const a=o.isBuffer(e)?e:o.from(e,r),s=a.length;if(0===s)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<n-t;++i)this[i+t]=a[i%s]}return this};const U={};function M(e,t,n){U[e]=class extends n{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function $(e){let t="",n=e.length;const r="-"===e[0]?1:0;for(;n>=r+4;n-=3)t=`_${e.slice(n-3,n)}${t}`;return`${e.slice(0,n)}${t}`}function H(e,t,n,r,i,a){if(e>n||e<t){const n="bigint"==typeof t?"n":"";let r;throw r=0===t||t===BigInt(0)?`>= 0${n} and < 2${n} ** ${8*(a+1)}${n}`:`>= -(2${n} ** ${8*(a+1)-1}${n}) and < 2 ** ${8*(a+1)-1}${n}`,new U.ERR_OUT_OF_RANGE("value",r,e)}!function(e,t,n){D(t,"offset"),void 0!==e[t]&&void 0!==e[t+n]||z(t,e.length-(n+1))}(r,i,a)}function D(e,t){if("number"!=typeof e)throw new U.ERR_INVALID_ARG_TYPE(t,"number",e)}function z(e,t,n){if(Math.floor(e)!==e)throw D(e,n),new U.ERR_OUT_OF_RANGE("offset","an integer",e);if(t<0)throw new U.ERR_BUFFER_OUT_OF_BOUNDS;throw new U.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${t}`,e)}M("ERR_BUFFER_OUT_OF_BOUNDS",function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),M("ERR_INVALID_ARG_TYPE",function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`},TypeError),M("ERR_OUT_OF_RANGE",function(e,t,n){let r=`The value of "${e}" is out of range.`,i=n;return Number.isInteger(n)&&Math.abs(n)>2**32?i=$(String(n)):"bigint"==typeof n&&(i=String(n),(n>BigInt(2)**BigInt(32)||n<-(BigInt(2)**BigInt(32)))&&(i=$(i)),i+="n"),r+=` It must be ${t}. Received ${i}`,r},RangeError);const W=/[^+/0-9A-Za-z-_]/g;function V(e,t){let n;t=t||1/0;const r=e.length;let i=null;const a=[];for(let o=0;o<r;++o){if(n=e.charCodeAt(o),n>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&a.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&a.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;a.push(n)}else if(n<2048){if((t-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return a}function j(e){return t.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(W,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function q(e,t,n,r){let i;for(i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function K(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function X(e){return e!=e}const G=function(){const e="0123456789abcdef",t=new Array(256);for(let n=0;n<16;++n){const r=16*n;for(let i=0;i<16;++i)t[r+i]=e[n]+e[i]}return t}();function Y(e){return"undefined"==typeof BigInt?J:e}function J(){throw new Error("BigInt not supported")}}(de);const Se=e({__proto__:null,default:ue(de)},[de]);window.Buffer=de.Buffer,globalThis.Buffer=de.Buffer;var Ee={exports:{}},Ie={},ke=Symbol.for("react.transitional.element"),Ae=Symbol.for("react.portal"),Ne=Symbol.for("react.fragment"),Te=Symbol.for("react.strict_mode"),_e=Symbol.for("react.profiler"),Pe=Symbol.for("react.consumer"),Be=Symbol.for("react.context"),Ce=Symbol.for("react.forward_ref"),Oe=Symbol.for("react.suspense"),Le=Symbol.for("react.memo"),Fe=Symbol.for("react.lazy"),Re=Symbol.iterator,Ue={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Me=Object.assign,$e={};function He(e,t,n){this.props=e,this.context=t,this.refs=$e,this.updater=n||Ue}function De(){}function ze(e,t,n){this.props=e,this.context=t,this.refs=$e,this.updater=n||Ue}He.prototype.isReactComponent={},He.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},He.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},De.prototype=He.prototype;var We=ze.prototype=new De;We.constructor=ze,Me(We,He.prototype),We.isPureReactComponent=!0;var Ve=Array.isArray,je={H:null,A:null,T:null,S:null,V:null},qe=Object.prototype.hasOwnProperty;function Ke(e,t,n,r,i,a){return n=a.ref,{$$typeof:ke,type:e,key:t,ref:void 0!==n?n:null,props:a}}function Xe(e){return"object"==typeof e&&null!==e&&e.$$typeof===ke}var Ge=/\/+/g;function Ye(e,t){return"object"==typeof e&&null!==e&&null!=e.key?(n=""+e.key,r={"=":"=0",":":"=2"},"$"+n.replace(/[=:]/g,function(e){return r[e]})):t.toString(36);var n,r}function Je(){}function Qe(e,t,n,r,i){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var o,s,l=!1;if(null===e)l=!0;else switch(a){case"bigint":case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case ke:case Ae:l=!0;break;case Fe:return Qe((l=e._init)(e._payload),t,n,r,i)}}if(l)return i=i(e),l=""===r?"."+Ye(e,0):r,Ve(i)?(n="",null!=l&&(n=l.replace(Ge,"$&/")+"/"),Qe(i,t,n,"",function(e){return e})):null!=i&&(Xe(i)&&(o=i,s=n+(null==i.key||e&&e.key===i.key?"":(""+i.key).replace(Ge,"$&/")+"/")+l,i=Ke(o.type,s,void 0,0,0,o.props)),t.push(i)),1;l=0;var c,u=""===r?".":r+":";if(Ve(e))for(var d=0;d<e.length;d++)l+=Qe(r=e[d],t,n,a=u+Ye(r,d),i);else if("function"==typeof(d=null===(c=e)||"object"!=typeof c?null:"function"==typeof(c=Re&&c[Re]||c["@@iterator"])?c:null))for(e=d.call(e),d=0;!(r=e.next()).done;)l+=Qe(r=r.value,t,n,a=u+Ye(r,d++),i);else if("object"===a){if("function"==typeof e.then)return Qe(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"==typeof e.status?e.then(Je,Je):(e.status="pending",e.then(function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)},function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(e),t,n,r,i);throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return l}function Ze(e,t,n){if(null==e)return e;var r=[],i=0;return Qe(e,r,"","",function(e){return t.call(n,e,i++)}),r}function et(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var tt="function"==typeof reportError?reportError:function(e){if("object"==typeof window&&"function"==typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"==typeof e&&null!==e&&"string"==typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"==typeof process&&"function"==typeof process.emit)return void process.emit("uncaughtException",e)};function nt(){}Ie.Children={map:Ze,forEach:function(e,t,n){Ze(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return Ze(e,function(){t++}),t},toArray:function(e){return Ze(e,function(e){return e})||[]},only:function(e){if(!Xe(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},Ie.Component=He,Ie.Fragment=Ne,Ie.Profiler=_e,Ie.PureComponent=ze,Ie.StrictMode=Te,Ie.Suspense=Oe,Ie.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=je,Ie.__COMPILER_RUNTIME={__proto__:null,c:function(e){return je.H.useMemoCache(e)}},Ie.cache=function(e){return function(){return e.apply(null,arguments)}},Ie.cloneElement=function(e,t,n){if(null==e)throw Error("The argument must be a React element, but you passed "+e+".");var r=Me({},e.props),i=e.key;if(null!=t)for(a in t.ref,void 0!==t.key&&(i=""+t.key),t)!qe.call(t,a)||"key"===a||"__self"===a||"__source"===a||"ref"===a&&void 0===t.ref||(r[a]=t[a]);var a=arguments.length-2;if(1===a)r.children=n;else if(1<a){for(var o=Array(a),s=0;s<a;s++)o[s]=arguments[s+2];r.children=o}return Ke(e.type,i,void 0,0,0,r)},Ie.createContext=function(e){return(e={$$typeof:Be,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:Pe,_context:e},e},Ie.createElement=function(e,t,n){var r,i={},a=null;if(null!=t)for(r in void 0!==t.key&&(a=""+t.key),t)qe.call(t,r)&&"key"!==r&&"__self"!==r&&"__source"!==r&&(i[r]=t[r]);var o=arguments.length-2;if(1===o)i.children=n;else if(1<o){for(var s=Array(o),l=0;l<o;l++)s[l]=arguments[l+2];i.children=s}if(e&&e.defaultProps)for(r in o=e.defaultProps)void 0===i[r]&&(i[r]=o[r]);return Ke(e,a,void 0,0,0,i)},Ie.createRef=function(){return{current:null}},Ie.forwardRef=function(e){return{$$typeof:Ce,render:e}},Ie.isValidElement=Xe,Ie.lazy=function(e){return{$$typeof:Fe,_payload:{_status:-1,_result:e},_init:et}},Ie.memo=function(e,t){return{$$typeof:Le,type:e,compare:void 0===t?null:t}},Ie.startTransition=function(e){var t=je.T,n={};je.T=n;try{var r=e(),i=je.S;null!==i&&i(n,r),"object"==typeof r&&null!==r&&"function"==typeof r.then&&r.then(nt,tt)}catch(Kh){tt(Kh)}finally{je.T=t}},Ie.unstable_useCacheRefresh=function(){return je.H.useCacheRefresh()},Ie.use=function(e){return je.H.use(e)},Ie.useActionState=function(e,t,n){return je.H.useActionState(e,t,n)},Ie.useCallback=function(e,t){return je.H.useCallback(e,t)},Ie.useContext=function(e){return je.H.useContext(e)},Ie.useDebugValue=function(){},Ie.useDeferredValue=function(e,t){return je.H.useDeferredValue(e,t)},Ie.useEffect=function(e,t,n){var r=je.H;if("function"==typeof n)throw Error("useEffect CRUD overload is not enabled in this build of React.");return r.useEffect(e,t)},Ie.useId=function(){return je.H.useId()},Ie.useImperativeHandle=function(e,t,n){return je.H.useImperativeHandle(e,t,n)},Ie.useInsertionEffect=function(e,t){return je.H.useInsertionEffect(e,t)},Ie.useLayoutEffect=function(e,t){return je.H.useLayoutEffect(e,t)},Ie.useMemo=function(e,t){return je.H.useMemo(e,t)},Ie.useOptimistic=function(e,t){return je.H.useOptimistic(e,t)},Ie.useReducer=function(e,t,n){return je.H.useReducer(e,t,n)},Ie.useRef=function(e){return je.H.useRef(e)},Ie.useState=function(e){return je.H.useState(e)},Ie.useSyncExternalStore=function(e,t,n){return je.H.useSyncExternalStore(e,t,n)},Ie.useTransition=function(){return je.H.useTransition()},Ie.version="19.1.1",Ee.exports=Ie;var rt=Ee.exports;const it=ue(rt);var at={exports:{}},ot={},st={exports:{}},lt={};!function(e){function t(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,a=e[r];if(!(0<i(a,t)))break e;e[r]=t,e[n]=a,n=r}}function n(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,a=e.length,o=a>>>1;r<o;){var s=2*(r+1)-1,l=e[s],c=s+1,u=e[c];if(0>i(l,n))c<a&&0>i(u,l)?(e[r]=u,e[c]=n,r=c):(e[r]=l,e[s]=n,r=s);else{if(!(c<a&&0>i(u,n)))break e;e[r]=u,e[c]=n,r=c}}}return t}function i(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if(e.unstable_now=void 0,"object"==typeof performance&&"function"==typeof performance.now){var a=performance;e.unstable_now=function(){return a.now()}}else{var o=Date,s=o.now();e.unstable_now=function(){return o.now()-s}}var l=[],c=[],u=1,d=null,f=3,p=!1,m=!1,h=!1,g=!1,y="function"==typeof setTimeout?setTimeout:null,b="function"==typeof clearTimeout?clearTimeout:null,w="undefined"!=typeof setImmediate?setImmediate:null;function x(e){for(var i=n(c);null!==i;){if(null===i.callback)r(c);else{if(!(i.startTime<=e))break;r(c),i.sortIndex=i.expirationTime,t(l,i)}i=n(c)}}function v(e){if(h=!1,x(e),!m)if(null!==n(l))m=!0,E||(E=!0,S());else{var t=n(c);null!==t&&B(v,t.startTime-e)}}var S,E=!1,I=-1,k=5,A=-1;function N(){return!(!g&&e.unstable_now()-A<k)}function T(){if(g=!1,E){var t=e.unstable_now();A=t;var i=!0;try{e:{m=!1,h&&(h=!1,b(I),I=-1),p=!0;var a=f;try{t:{for(x(t),d=n(l);null!==d&&!(d.expirationTime>t&&N());){var o=d.callback;if("function"==typeof o){d.callback=null,f=d.priorityLevel;var s=o(d.expirationTime<=t);if(t=e.unstable_now(),"function"==typeof s){d.callback=s,x(t),i=!0;break t}d===n(l)&&r(l),x(t)}else r(l);d=n(l)}if(null!==d)i=!0;else{var u=n(c);null!==u&&B(v,u.startTime-t),i=!1}}break e}finally{d=null,f=a,p=!1}i=void 0}}finally{i?S():E=!1}}}if("function"==typeof w)S=function(){w(T)};else if("undefined"!=typeof MessageChannel){var _=new MessageChannel,P=_.port2;_.port1.onmessage=T,S=function(){P.postMessage(null)}}else S=function(){y(T,0)};function B(t,n){I=y(function(){t(e.unstable_now())},n)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(e){e.callback=null},e.unstable_forceFrameRate=function(e){0>e||125<e||(k=0<e?Math.floor(1e3/e):5)},e.unstable_getCurrentPriorityLevel=function(){return f},e.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},e.unstable_requestPaint=function(){g=!0},e.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},e.unstable_scheduleCallback=function(r,i,a){var o=e.unstable_now();switch(a="object"==typeof a&&null!==a&&"number"==typeof(a=a.delay)&&0<a?o+a:o,r){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return r={id:u++,callback:i,priorityLevel:r,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>o?(r.sortIndex=a,t(c,r),null===n(l)&&r===n(c)&&(h?(b(I),I=-1):h=!0,B(v,a-o))):(r.sortIndex=s,t(l,r),m||p||(m=!0,E||(E=!0,S()))),r},e.unstable_shouldYield=N,e.unstable_wrapCallback=function(e){var t=f;return function(){var n=f;f=t;try{return e.apply(this,arguments)}finally{f=n}}}}(lt),st.exports=lt;var ct=st.exports,ut={exports:{}},dt={},ft=rt;function pt(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function mt(){}var ht={d:{f:mt,r:function(){throw Error(pt(522))},D:mt,C:mt,L:mt,m:mt,X:mt,S:mt,M:mt},p:0,findDOMNode:null},gt=Symbol.for("react.portal"),yt=ft.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function bt(e,t){return"font"===e?"":"string"==typeof t?"use-credentials"===t?t:"":void 0}dt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=ht,dt.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)throw Error(pt(299));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:gt,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},dt.flushSync=function(e){var t=yt.T,n=ht.p;try{if(yt.T=null,ht.p=2,e)return e()}finally{yt.T=t,ht.p=n,ht.d.f()}},dt.preconnect=function(e,t){"string"==typeof e&&(t=t?"string"==typeof(t=t.crossOrigin)?"use-credentials"===t?t:"":void 0:null,ht.d.C(e,t))},dt.prefetchDNS=function(e){"string"==typeof e&&ht.d.D(e)},dt.preinit=function(e,t){if("string"==typeof e&&t&&"string"==typeof t.as){var n=t.as,r=bt(n,t.crossOrigin),i="string"==typeof t.integrity?t.integrity:void 0,a="string"==typeof t.fetchPriority?t.fetchPriority:void 0;"style"===n?ht.d.S(e,"string"==typeof t.precedence?t.precedence:void 0,{crossOrigin:r,integrity:i,fetchPriority:a}):"script"===n&&ht.d.X(e,{crossOrigin:r,integrity:i,fetchPriority:a,nonce:"string"==typeof t.nonce?t.nonce:void 0})}},dt.preinitModule=function(e,t){if("string"==typeof e)if("object"==typeof t&&null!==t){if(null==t.as||"script"===t.as){var n=bt(t.as,t.crossOrigin);ht.d.M(e,{crossOrigin:n,integrity:"string"==typeof t.integrity?t.integrity:void 0,nonce:"string"==typeof t.nonce?t.nonce:void 0})}}else null==t&&ht.d.M(e)},dt.preload=function(e,t){if("string"==typeof e&&"object"==typeof t&&null!==t&&"string"==typeof t.as){var n=t.as,r=bt(n,t.crossOrigin);ht.d.L(e,n,{crossOrigin:r,integrity:"string"==typeof t.integrity?t.integrity:void 0,nonce:"string"==typeof t.nonce?t.nonce:void 0,type:"string"==typeof t.type?t.type:void 0,fetchPriority:"string"==typeof t.fetchPriority?t.fetchPriority:void 0,referrerPolicy:"string"==typeof t.referrerPolicy?t.referrerPolicy:void 0,imageSrcSet:"string"==typeof t.imageSrcSet?t.imageSrcSet:void 0,imageSizes:"string"==typeof t.imageSizes?t.imageSizes:void 0,media:"string"==typeof t.media?t.media:void 0})}},dt.preloadModule=function(e,t){if("string"==typeof e)if(t){var n=bt(t.as,t.crossOrigin);ht.d.m(e,{as:"string"==typeof t.as&&"script"!==t.as?t.as:void 0,crossOrigin:n,integrity:"string"==typeof t.integrity?t.integrity:void 0})}else ht.d.m(e)},dt.requestFormReset=function(e){ht.d.r(e)},dt.unstable_batchedUpdates=function(e,t){return e(t)},dt.useFormState=function(e,t,n){return yt.H.useFormState(e,t,n)},dt.useFormStatus=function(){return yt.H.useHostTransitionStatus()},dt.version="19.1.1",function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){}}(),ut.exports=dt;var wt=ut.exports;const xt=ue(wt);var vt=ct,St=rt,Et=wt;function It(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function kt(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function At(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{!!(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Nt(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&null!==(e=e.alternate)&&(t=e.memoizedState),null!==t)return t.dehydrated}return null}function Tt(e){if(At(e)!==e)throw Error(It(188))}function _t(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e;for(e=e.child;null!==e;){if(null!==(t=_t(e)))return t;e=e.sibling}return null}var Pt=Object.assign,Bt=Symbol.for("react.element"),Ct=Symbol.for("react.transitional.element"),Ot=Symbol.for("react.portal"),Lt=Symbol.for("react.fragment"),Ft=Symbol.for("react.strict_mode"),Rt=Symbol.for("react.profiler"),Ut=Symbol.for("react.provider"),Mt=Symbol.for("react.consumer"),$t=Symbol.for("react.context"),Ht=Symbol.for("react.forward_ref"),Dt=Symbol.for("react.suspense"),zt=Symbol.for("react.suspense_list"),Wt=Symbol.for("react.memo"),Vt=Symbol.for("react.lazy"),jt=Symbol.for("react.activity"),qt=Symbol.for("react.memo_cache_sentinel"),Kt=Symbol.iterator;function Xt(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=Kt&&e[Kt]||e["@@iterator"])?e:null}var Gt=Symbol.for("react.client.reference");function Yt(e){if(null==e)return null;if("function"==typeof e)return e.$$typeof===Gt?null:e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case Lt:return"Fragment";case Rt:return"Profiler";case Ft:return"StrictMode";case Dt:return"Suspense";case zt:return"SuspenseList";case jt:return"Activity"}if("object"==typeof e)switch(e.$$typeof){case Ot:return"Portal";case $t:return(e.displayName||"Context")+".Provider";case Mt:return(e._context.displayName||"Context")+".Consumer";case Ht:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case Wt:return null!==(t=e.displayName||null)?t:Yt(e.type)||"Memo";case Vt:t=e._payload,e=e._init;try{return Yt(e(t))}catch(n){}}return null}var Jt=Array.isArray,Qt=St.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Zt=Et.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,en={pending:!1,data:null,method:null,action:null},tn=[],nn=-1;function rn(e){return{current:e}}function an(e){0>nn||(e.current=tn[nn],tn[nn]=null,nn--)}function on(e,t){nn++,tn[nn]=e.current,e.current=t}var sn=rn(null),ln=rn(null),cn=rn(null),un=rn(null);function dn(e,t){switch(on(cn,t),on(ln,e),on(sn,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?Ep(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)e=Ip(t=Ep(t),e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}an(sn),on(sn,e)}function fn(){an(sn),an(ln),an(cn)}function pn(e){null!==e.memoizedState&&on(un,e);var t=sn.current,n=Ip(t,e.type);t!==n&&(on(ln,e),on(sn,n))}function mn(e){ln.current===e&&(an(sn),an(ln)),un.current===e&&(an(un),pm._currentValue=en)}var hn=Object.prototype.hasOwnProperty,gn=vt.unstable_scheduleCallback,yn=vt.unstable_cancelCallback,bn=vt.unstable_shouldYield,wn=vt.unstable_requestPaint,xn=vt.unstable_now,vn=vt.unstable_getCurrentPriorityLevel,Sn=vt.unstable_ImmediatePriority,En=vt.unstable_UserBlockingPriority,In=vt.unstable_NormalPriority,kn=vt.unstable_LowPriority,An=vt.unstable_IdlePriority,Nn=vt.log,Tn=vt.unstable_setDisableYieldValue,_n=null,Pn=null;function Bn(e){if("function"==typeof Nn&&Tn(e),Pn&&"function"==typeof Pn.setStrictMode)try{Pn.setStrictMode(_n,e)}catch(t){}}var Cn=Math.clz32?Math.clz32:function(e){return 0==(e>>>=0)?32:31-(On(e)/Ln|0)|0},On=Math.log,Ln=Math.LN2,Fn=256,Rn=4194304;function Un(e){var t=42&e;if(0!==t)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194048&e;case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&e;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function Mn(e,t,n){var r=e.pendingLanes;if(0===r)return 0;var i=0,a=e.suspendedLanes,o=e.pingedLanes;e=e.warmLanes;var s=134217727&r;return 0!==s?0!==(r=s&~a)?i=Un(r):0!==(o&=s)?i=Un(o):n||0!==(n=s&~e)&&(i=Un(n)):0!==(s=r&~a)?i=Un(s):0!==o?i=Un(o):n||0!==(n=r&~e)&&(i=Un(n)),0===i?0:0!==t&&t!==i&&0===(t&a)&&((a=i&-i)>=(n=t&-t)||32===a&&4194048&n)?t:i}function $n(e,t){return 0===(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)}function Hn(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function Dn(){var e=Fn;return!(4194048&(Fn<<=1))&&(Fn=256),e}function zn(){var e=Rn;return!(62914560&(Rn<<=1))&&(Rn=4194304),e}function Wn(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Vn(e,t){e.pendingLanes|=t,268435456!==t&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function jn(e,t,n){e.pendingLanes|=t,e.suspendedLanes&=~t;var r=31-Cn(t);e.entangledLanes|=t,e.entanglements[r]=1073741824|e.entanglements[r]|4194090&n}function qn(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-Cn(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}function Kn(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function Xn(e){return 2<(e&=-e)?8<e?134217727&e?32:268435456:8:2}function Gn(){var e=Zt.p;return 0!==e?e:void 0===(e=window.event)?32:Tm(e.type)}var Yn=Math.random().toString(36).slice(2),Jn="__reactFiber$"+Yn,Qn="__reactProps$"+Yn,Zn="__reactContainer$"+Yn,er="__reactEvents$"+Yn,tr="__reactListeners$"+Yn,nr="__reactHandles$"+Yn,rr="__reactResources$"+Yn,ir="__reactMarker$"+Yn;function ar(e){delete e[Jn],delete e[Qn],delete e[er],delete e[tr],delete e[nr]}function or(e){var t=e[Jn];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Zn]||n[Jn]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=Mp(e);null!==e;){if(n=e[Jn])return n;e=Mp(e)}return t}n=(e=n).parentNode}return null}function sr(e){if(e=e[Jn]||e[Zn]){var t=e.tag;if(5===t||6===t||13===t||26===t||27===t||3===t)return e}return null}function lr(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e.stateNode;throw Error(It(33))}function cr(e){var t=e[rr];return t||(t=e[rr]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function ur(e){e[ir]=!0}var dr=new Set,fr={};function pr(e,t){mr(e,t),mr(e+"Capture",t)}function mr(e,t){for(fr[e]=t,e=0;e<t.length;e++)dr.add(t[e])}var hr,gr,yr=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),br={},wr={};function xr(e,t,n){if(i=t,hn.call(wr,i)||!hn.call(br,i)&&(yr.test(i)?wr[i]=!0:(br[i]=!0,0)))if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":return void e.removeAttribute(t);case"boolean":var r=t.toLowerCase().slice(0,5);if("data-"!==r&&"aria-"!==r)return void e.removeAttribute(t)}e.setAttribute(t,""+n)}var i}function vr(e,t,n){if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(t)}e.setAttribute(t,""+n)}}function Sr(e,t,n,r){if(null===r)e.removeAttribute(n);else{switch(typeof r){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(n)}e.setAttributeNS(t,n,""+r)}}function Er(e){if(void 0===hr)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);hr=t&&t[1]||"",gr=-1<n.stack.indexOf("\n    at")?" (<anonymous>)":-1<n.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+hr+e+gr}var Ir=!1;function kr(e,t){if(!e||Ir)return"";Ir=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var r={DetermineComponentFrameRoot:function(){try{if(t){var n=function(){throw Error()};if(Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(n,[])}catch(i){var r=i}Reflect.construct(e,[],n)}else{try{n.call()}catch(a){r=a}e.call(n.prototype)}}else{try{throw Error()}catch(o){r=o}(n=e())&&"function"==typeof n.catch&&n.catch(function(){})}}catch(s){if(s&&r&&"string"==typeof s.stack)return[s.stack,r.stack]}return[null,null]}};r.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var i=Object.getOwnPropertyDescriptor(r.DetermineComponentFrameRoot,"name");i&&i.configurable&&Object.defineProperty(r.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var a=r.DetermineComponentFrameRoot(),o=a[0],s=a[1];if(o&&s){var l=o.split("\n"),c=s.split("\n");for(i=r=0;r<l.length&&!l[r].includes("DetermineComponentFrameRoot");)r++;for(;i<c.length&&!c[i].includes("DetermineComponentFrameRoot");)i++;if(r===l.length||i===c.length)for(r=l.length-1,i=c.length-1;1<=r&&0<=i&&l[r]!==c[i];)i--;for(;1<=r&&0<=i;r--,i--)if(l[r]!==c[i]){if(1!==r||1!==i)do{if(r--,0>--i||l[r]!==c[i]){var u="\n"+l[r].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=r&&0<=i);break}}}finally{Ir=!1,Error.prepareStackTrace=n}return(n=e?e.displayName||e.name:"")?Er(n):""}function Ar(e){switch(e.tag){case 26:case 27:case 5:return Er(e.type);case 16:return Er("Lazy");case 13:return Er("Suspense");case 19:return Er("SuspenseList");case 0:case 15:return kr(e.type,!1);case 11:return kr(e.type.render,!1);case 1:return kr(e.type,!0);case 31:return Er("Activity");default:return""}}function Nr(e){try{var t="";do{t+=Ar(e),e=e.return}while(e);return t}catch(n){return"\nError generating stack: "+n.message+"\n"+n.stack}}function Tr(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function _r(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function Pr(e){e._valueTracker||(e._valueTracker=function(e){var t=_r(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var i=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function Br(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=_r(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function Cr(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}var Or=/[\n"\\]/g;function Lr(e){return e.replace(Or,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function Fr(e,t,n,r,i,a,o,s){e.name="",null!=o&&"function"!=typeof o&&"symbol"!=typeof o&&"boolean"!=typeof o?e.type=o:e.removeAttribute("type"),null!=t?"number"===o?(0===t&&""===e.value||e.value!=t)&&(e.value=""+Tr(t)):e.value!==""+Tr(t)&&(e.value=""+Tr(t)):"submit"!==o&&"reset"!==o||e.removeAttribute("value"),null!=t?Ur(e,o,Tr(t)):null!=n?Ur(e,o,Tr(n)):null!=r&&e.removeAttribute("value"),null==i&&null!=a&&(e.defaultChecked=!!a),null!=i&&(e.checked=i&&"function"!=typeof i&&"symbol"!=typeof i),null!=s&&"function"!=typeof s&&"symbol"!=typeof s&&"boolean"!=typeof s?e.name=""+Tr(s):e.removeAttribute("name")}function Rr(e,t,n,r,i,a,o,s){if(null!=a&&"function"!=typeof a&&"symbol"!=typeof a&&"boolean"!=typeof a&&(e.type=a),null!=t||null!=n){if(("submit"===a||"reset"===a)&&null==t)return;n=null!=n?""+Tr(n):"",t=null!=t?""+Tr(t):n,s||t===e.value||(e.value=t),e.defaultValue=t}r="function"!=typeof(r=null!=r?r:i)&&"symbol"!=typeof r&&!!r,e.checked=s?e.checked:!!r,e.defaultChecked=!!r,null!=o&&"function"!=typeof o&&"symbol"!=typeof o&&"boolean"!=typeof o&&(e.name=o)}function Ur(e,t,n){"number"===t&&Cr(e.ownerDocument)===e||e.defaultValue===""+n||(e.defaultValue=""+n)}function Mr(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+Tr(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function $r(e,t,n){null==t||((t=""+Tr(t))!==e.value&&(e.value=t),null!=n)?e.defaultValue=null!=n?""+Tr(n):"":e.defaultValue!==t&&(e.defaultValue=t)}function Hr(e,t,n,r){if(null==t){if(null!=r){if(null!=n)throw Error(It(92));if(Jt(r)){if(1<r.length)throw Error(It(93));r=r[0]}n=r}null==n&&(n=""),t=n}n=Tr(t),e.defaultValue=n,(r=e.textContent)===n&&""!==r&&null!==r&&(e.value=r)}function Dr(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var zr=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Wr(e,t,n){var r=0===t.indexOf("--");null==n||"boolean"==typeof n||""===n?r?e.setProperty(t,""):"float"===t?e.cssFloat="":e[t]="":r?e.setProperty(t,n):"number"!=typeof n||0===n||zr.has(t)?"float"===t?e.cssFloat=n:e[t]=(""+n).trim():e[t]=n+"px"}function Vr(e,t,n){if(null!=t&&"object"!=typeof t)throw Error(It(62));if(e=e.style,null!=n){for(var r in n)!n.hasOwnProperty(r)||null!=t&&t.hasOwnProperty(r)||(0===r.indexOf("--")?e.setProperty(r,""):"float"===r?e.cssFloat="":e[r]="");for(var i in t)r=t[i],t.hasOwnProperty(i)&&n[i]!==r&&Wr(e,i,r)}else for(var a in t)t.hasOwnProperty(a)&&Wr(e,a,t[a])}function jr(e){if(-1===e.indexOf("-"))return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var qr=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Kr=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Xr(e){return Kr.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var Gr=null;function Yr(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Jr=null,Qr=null;function Zr(e){var t=sr(e);if(t&&(e=t.stateNode)){var n=e[Qn]||null;e:switch(e=t.stateNode,t.type){case"input":if(Fr(e,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll('input[name="'+Lr(""+t)+'"][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=r[Qn]||null;if(!i)throw Error(It(90));Fr(r,i.value,i.defaultValue,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name)}}for(t=0;t<n.length;t++)(r=n[t]).form===e.form&&Br(r)}break e;case"textarea":$r(e,n.value,n.defaultValue);break e;case"select":null!=(t=n.value)&&Mr(e,!!n.multiple,t,!1)}}}var ei=!1;function ti(e,t,n){if(ei)return e(t,n);ei=!0;try{return e(t)}finally{if(ei=!1,(null!==Jr||null!==Qr)&&(of(),Jr&&(t=Jr,e=Qr,Qr=Jr=null,Zr(t),e)))for(t=0;t<e.length;t++)Zr(e[t])}}function ni(e,t){var n=e.stateNode;if(null===n)return null;var r=n[Qn]||null;if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!=typeof n)throw Error(It(231,t,typeof n));return n}var ri=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),ii=!1;if(ri)try{var ai={};Object.defineProperty(ai,"passive",{get:function(){ii=!0}}),window.addEventListener("test",ai,ai),window.removeEventListener("test",ai,ai)}catch(cC){ii=!1}var oi=null,si=null,li=null;function ci(){if(li)return li;var e,t,n=si,r=n.length,i="value"in oi?oi.value:oi.textContent,a=i.length;for(e=0;e<r&&n[e]===i[e];e++);var o=r-e;for(t=1;t<=o&&n[r-t]===i[a-t];t++);return li=i.slice(e,1<t?1-t:void 0)}function ui(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function di(){return!0}function fi(){return!1}function pi(e){function t(t,n,r,i,a){for(var o in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(i):i[o]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?di:fi,this.isPropagationStopped=fi,this}return Pt(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=di)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=di)},persist:function(){},isPersistent:di}),t}var mi,hi,gi,yi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},bi=pi(yi),wi=Pt({},yi,{view:0,detail:0}),xi=pi(wi),vi=Pt({},wi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ci,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==gi&&(gi&&"mousemove"===e.type?(mi=e.screenX-gi.screenX,hi=e.screenY-gi.screenY):hi=mi=0,gi=e),mi)},movementY:function(e){return"movementY"in e?e.movementY:hi}}),Si=pi(vi),Ei=pi(Pt({},vi,{dataTransfer:0})),Ii=pi(Pt({},wi,{relatedTarget:0})),ki=pi(Pt({},yi,{animationName:0,elapsedTime:0,pseudoElement:0})),Ai=pi(Pt({},yi,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),Ni=pi(Pt({},yi,{data:0})),Ti={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},_i={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Pi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Bi(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Pi[e])&&!!t[e]}function Ci(){return Bi}var Oi=pi(Pt({},wi,{key:function(e){if(e.key){var t=Ti[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=ui(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?_i[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ci,charCode:function(e){return"keypress"===e.type?ui(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?ui(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),Li=pi(Pt({},vi,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Fi=pi(Pt({},wi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ci})),Ri=pi(Pt({},yi,{propertyName:0,elapsedTime:0,pseudoElement:0})),Ui=pi(Pt({},vi,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),Mi=pi(Pt({},yi,{newState:0,oldState:0})),$i=[9,13,27,32],Hi=ri&&"CompositionEvent"in window,Di=null;ri&&"documentMode"in document&&(Di=document.documentMode);var zi=ri&&"TextEvent"in window&&!Di,Wi=ri&&(!Hi||Di&&8<Di&&11>=Di),Vi=String.fromCharCode(32),ji=!1;function qi(e,t){switch(e){case"keyup":return-1!==$i.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ki(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var Xi=!1,Gi={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Yi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Gi[e.type]:"textarea"===t}function Ji(e,t,n,r){Jr?Qr?Qr.push(r):Qr=[r]:Jr=r,0<(t=cp(t,"onChange")).length&&(n=new bi("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Qi=null,Zi=null;function ea(e){tp(e,0)}function ta(e){if(Br(lr(e)))return e}function na(e,t){if("change"===e)return t}var ra=!1;if(ri){var ia;if(ri){var aa="oninput"in document;if(!aa){var oa=document.createElement("div");oa.setAttribute("oninput","return;"),aa="function"==typeof oa.oninput}ia=aa}else ia=!1;ra=ia&&(!document.documentMode||9<document.documentMode)}function sa(){Qi&&(Qi.detachEvent("onpropertychange",la),Zi=Qi=null)}function la(e){if("value"===e.propertyName&&ta(Zi)){var t=[];Ji(t,Zi,e,Yr(e)),ti(ea,t)}}function ca(e,t,n){"focusin"===e?(sa(),Zi=n,(Qi=t).attachEvent("onpropertychange",la)):"focusout"===e&&sa()}function ua(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return ta(Zi)}function da(e,t){if("click"===e)return ta(t)}function fa(e,t){if("input"===e||"change"===e)return ta(t)}var pa="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t};function ma(e,t){if(pa(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!hn.call(t,i)||!pa(e[i],t[i]))return!1}return!0}function ha(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ga(e,t){var n,r=ha(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=ha(r)}}function ya(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?ya(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function ba(e){for(var t=Cr((e=null!=e&&null!=e.ownerDocument&&null!=e.ownerDocument.defaultView?e.ownerDocument.defaultView:window).document);t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=Cr((e=t.contentWindow).document)}return t}function wa(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var xa=ri&&"documentMode"in document&&11>=document.documentMode,va=null,Sa=null,Ea=null,Ia=!1;function ka(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;Ia||null==va||va!==Cr(r)||(r="selectionStart"in(r=va)&&wa(r)?{start:r.selectionStart,end:r.selectionEnd}:{anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},Ea&&ma(Ea,r)||(Ea=r,0<(r=cp(Sa,"onSelect")).length&&(t=new bi("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=va)))}function Aa(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Na={animationend:Aa("Animation","AnimationEnd"),animationiteration:Aa("Animation","AnimationIteration"),animationstart:Aa("Animation","AnimationStart"),transitionrun:Aa("Transition","TransitionRun"),transitionstart:Aa("Transition","TransitionStart"),transitioncancel:Aa("Transition","TransitionCancel"),transitionend:Aa("Transition","TransitionEnd")},Ta={},_a={};function Pa(e){if(Ta[e])return Ta[e];if(!Na[e])return e;var t,n=Na[e];for(t in n)if(n.hasOwnProperty(t)&&t in _a)return Ta[e]=n[t];return e}ri&&(_a=document.createElement("div").style,"AnimationEvent"in window||(delete Na.animationend.animation,delete Na.animationiteration.animation,delete Na.animationstart.animation),"TransitionEvent"in window||delete Na.transitionend.transition);var Ba=Pa("animationend"),Ca=Pa("animationiteration"),Oa=Pa("animationstart"),La=Pa("transitionrun"),Fa=Pa("transitionstart"),Ra=Pa("transitioncancel"),Ua=Pa("transitionend"),Ma=new Map,$a="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ha(e,t){Ma.set(e,t),pr(t,[e])}$a.push("scrollEnd");var Da=new WeakMap;function za(e,t){if("object"==typeof e&&null!==e){var n=Da.get(e);return void 0!==n?n:(t={value:e,source:t,stack:Nr(t)},Da.set(e,t),t)}return{value:e,source:t,stack:Nr(t)}}var Wa=[],Va=0,ja=0;function qa(){for(var e=Va,t=ja=Va=0;t<e;){var n=Wa[t];Wa[t++]=null;var r=Wa[t];Wa[t++]=null;var i=Wa[t];Wa[t++]=null;var a=Wa[t];if(Wa[t++]=null,null!==r&&null!==i){var o=r.pending;null===o?i.next=i:(i.next=o.next,o.next=i),r.pending=i}0!==a&&Ya(n,i,a)}}function Ka(e,t,n,r){Wa[Va++]=e,Wa[Va++]=t,Wa[Va++]=n,Wa[Va++]=r,ja|=r,e.lanes|=r,null!==(e=e.alternate)&&(e.lanes|=r)}function Xa(e,t,n,r){return Ka(e,t,n,r),Ja(e)}function Ga(e,t){return Ka(e,null,null,t),Ja(e)}function Ya(e,t,n){e.lanes|=n;var r=e.alternate;null!==r&&(r.lanes|=n);for(var i=!1,a=e.return;null!==a;)a.childLanes|=n,null!==(r=a.alternate)&&(r.childLanes|=n),22===a.tag&&(null===(e=a.stateNode)||1&e._visibility||(i=!0)),e=a,a=a.return;return 3===e.tag?(a=e.stateNode,i&&null!==t&&(i=31-Cn(n),null===(r=(e=a.hiddenUpdates)[i])?e[i]=[t]:r.push(t),t.lane=536870912|n),a):null}function Ja(e){if(50<Yd)throw Yd=0,Jd=null,Error(It(185));for(var t=e.return;null!==t;)t=(e=t).return;return 3===e.tag?e.stateNode:null}var Qa={};function Za(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function eo(e,t,n,r){return new Za(e,t,n,r)}function to(e){return!(!(e=e.prototype)||!e.isReactComponent)}function no(e,t){var n=e.alternate;return null===n?((n=eo(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=65011712&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n.refCleanup=e.refCleanup,n}function ro(e,t){e.flags&=65011714;var n=e.alternate;return null===n?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=n.childLanes,e.lanes=n.lanes,e.child=n.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,e.type=n.type,t=n.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function io(e,t,n,r,i,a){var o=0;if(r=e,"function"==typeof e)to(e)&&(o=1);else if("string"==typeof e)o=function(e,t){if(1===sn.current||null!=t.itemProp)return!1;switch(e){case"meta":case"title":return!0;case"style":if("string"!=typeof t.precedence||"string"!=typeof t.href||""===t.href)break;return!0;case"link":if("string"!=typeof t.rel||"string"!=typeof t.href||""===t.href||t.onLoad||t.onError)break;return"stylesheet"!==t.rel||(e=t.disabled,"string"==typeof t.precedence&&null==e);case"script":if(t.async&&"function"!=typeof t.async&&"symbol"!=typeof t.async&&!t.onLoad&&!t.onError&&t.src&&"string"==typeof t.src)return!0}return!1}(e,n)?26:"html"===e||"head"===e||"body"===e?27:5;else e:switch(e){case jt:return(e=eo(31,n,t,i)).elementType=jt,e.lanes=a,e;case Lt:return ao(n.children,i,a,t);case Ft:o=8,i|=24;break;case Rt:return(e=eo(12,n,t,2|i)).elementType=Rt,e.lanes=a,e;case Dt:return(e=eo(13,n,t,i)).elementType=Dt,e.lanes=a,e;case zt:return(e=eo(19,n,t,i)).elementType=zt,e.lanes=a,e;default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case Ut:case $t:o=10;break e;case Mt:o=9;break e;case Ht:o=11;break e;case Wt:o=14;break e;case Vt:o=16,r=null;break e}o=29,n=Error(It(130,null===e?"null":typeof e,"")),r=null}return(t=eo(o,n,t,i)).elementType=e,t.type=r,t.lanes=a,t}function ao(e,t,n,r){return(e=eo(7,e,r,t)).lanes=n,e}function oo(e,t,n){return(e=eo(6,e,null,t)).lanes=n,e}function so(e,t,n){return(t=eo(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var lo=[],co=0,uo=null,fo=0,po=[],mo=0,ho=null,go=1,yo="";function bo(e,t){lo[co++]=fo,lo[co++]=uo,uo=e,fo=t}function wo(e,t,n){po[mo++]=go,po[mo++]=yo,po[mo++]=ho,ho=e;var r=go;e=yo;var i=32-Cn(r)-1;r&=~(1<<i),n+=1;var a=32-Cn(t)+i;if(30<a){var o=i-i%5;a=(r&(1<<o)-1).toString(32),r>>=o,i-=o,go=1<<32-Cn(t)+i|n<<i|r,yo=a+e}else go=1<<a|n<<i|r,yo=e}function xo(e){null!==e.return&&(bo(e,1),wo(e,1,0))}function vo(e){for(;e===uo;)uo=lo[--co],lo[co]=null,fo=lo[--co],lo[co]=null;for(;e===ho;)ho=po[--mo],po[mo]=null,yo=po[--mo],po[mo]=null,go=po[--mo],po[mo]=null}var So=null,Eo=null,Io=!1,ko=null,Ao=!1,No=Error(It(519));function To(e){throw Lo(za(Error(It(418,"")),e)),No}function _o(e){var t=e.stateNode,n=e.type,r=e.memoizedProps;switch(t[Jn]=e,t[Qn]=r,n){case"dialog":np("cancel",t),np("close",t);break;case"iframe":case"object":case"embed":np("load",t);break;case"video":case"audio":for(n=0;n<Zf.length;n++)np(Zf[n],t);break;case"source":np("error",t);break;case"img":case"image":case"link":np("error",t),np("load",t);break;case"details":np("toggle",t);break;case"input":np("invalid",t),Rr(t,r.value,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name,!0),Pr(t);break;case"select":np("invalid",t);break;case"textarea":np("invalid",t),Hr(t,r.value,r.defaultValue,r.children),Pr(t)}"string"!=typeof(n=r.children)&&"number"!=typeof n&&"bigint"!=typeof n||t.textContent===""+n||!0===r.suppressHydrationWarning||hp(t.textContent,n)?(null!=r.popover&&(np("beforetoggle",t),np("toggle",t)),null!=r.onScroll&&np("scroll",t),null!=r.onScrollEnd&&np("scrollend",t),null!=r.onClick&&(t.onclick=gp),t=!0):t=!1,t||To(e)}function Po(e){for(So=e.return;So;)switch(So.tag){case 5:case 13:return void(Ao=!1);case 27:case 3:return void(Ao=!0);default:So=So.return}}function Bo(e){if(e!==So)return!1;if(!Io)return Po(e),Io=!0,!1;var t,n=e.tag;if((t=3!==n&&27!==n)&&((t=5===n)&&(t=!("form"!==(t=e.type)&&"button"!==t)||kp(e.type,e.memoizedProps)),t=!t),t&&Eo&&To(e),Po(e),13===n){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(It(317));e:{for(e=e.nextSibling,n=0;e;){if(8===e.nodeType)if("/$"===(t=e.data)){if(0===n){Eo=Rp(e.nextSibling);break e}n--}else"$"!==t&&"$!"!==t&&"$?"!==t||n++;e=e.nextSibling}Eo=null}}else 27===n?(n=Eo,Cp(e.type)?(e=Up,Up=null,Eo=e):Eo=n):Eo=So?Rp(e.stateNode.nextSibling):null;return!0}function Co(){Eo=So=null,Io=!1}function Oo(){var e=ko;return null!==e&&(null===Ud?Ud=e:Ud.push.apply(Ud,e),ko=null),e}function Lo(e){null===ko?ko=[e]:ko.push(e)}var Fo=rn(null),Ro=null,Uo=null;function Mo(e,t,n){on(Fo,t._currentValue),t._currentValue=n}function $o(e){e._currentValue=Fo.current,an(Fo)}function Ho(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Do(e,t,n,r){var i=e.child;for(null!==i&&(i.return=e);null!==i;){var a=i.dependencies;if(null!==a){var o=i.child;a=a.firstContext;e:for(;null!==a;){var s=a;a=i;for(var l=0;l<t.length;l++)if(s.context===t[l]){a.lanes|=n,null!==(s=a.alternate)&&(s.lanes|=n),Ho(a.return,n,e),r||(o=null);break e}a=s.next}}else if(18===i.tag){if(null===(o=i.return))throw Error(It(341));o.lanes|=n,null!==(a=o.alternate)&&(a.lanes|=n),Ho(o,n,e),o=null}else o=i.child;if(null!==o)o.return=i;else for(o=i;null!==o;){if(o===e){o=null;break}if(null!==(i=o.sibling)){i.return=o.return,o=i;break}o=o.return}i=o}}function zo(e,t,n,r){e=null;for(var i=t,a=!1;null!==i;){if(!a)if(524288&i.flags)a=!0;else if(262144&i.flags)break;if(10===i.tag){var o=i.alternate;if(null===o)throw Error(It(387));if(null!==(o=o.memoizedProps)){var s=i.type;pa(i.pendingProps.value,o.value)||(null!==e?e.push(s):e=[s])}}else if(i===un.current){if(null===(o=i.alternate))throw Error(It(387));o.memoizedState.memoizedState!==i.memoizedState.memoizedState&&(null!==e?e.push(pm):e=[pm])}i=i.return}null!==e&&Do(t,e,n,r),t.flags|=262144}function Wo(e){for(e=e.firstContext;null!==e;){if(!pa(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Vo(e){Ro=e,Uo=null,null!==(e=e.dependencies)&&(e.firstContext=null)}function jo(e){return Ko(Ro,e)}function qo(e,t){return null===Ro&&Vo(e),Ko(e,t)}function Ko(e,t){var n=t._currentValue;if(t={context:t,memoizedValue:n,next:null},null===Uo){if(null===e)throw Error(It(308));Uo=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else Uo=Uo.next=t;return n}var Xo="undefined"!=typeof AbortController?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach(function(e){return e()})}},Go=vt.unstable_scheduleCallback,Yo=vt.unstable_NormalPriority,Jo={$$typeof:$t,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Qo(){return{controller:new Xo,data:new Map,refCount:0}}function Zo(e){e.refCount--,0===e.refCount&&Go(Yo,function(){e.controller.abort()})}var es=null,ts=0,ns=0,rs=null;function is(){if(0===--ts&&null!==es){null!==rs&&(rs.status="fulfilled");var e=es;es=null,ns=0,rs=null;for(var t=0;t<e.length;t++)(0,e[t])()}}var as=Qt.S;Qt.S=function(e,t){"object"==typeof t&&null!==t&&"function"==typeof t.then&&function(e,t){if(null===es){var n=es=[];ts=0,ns=Xf(),rs={status:"pending",value:void 0,then:function(e){n.push(e)}}}ts++,t.then(is,is)}(0,t),null!==as&&as(e,t)};var os=rn(null);function ss(){var e=os.current;return null!==e?e:vd.pooledCache}function ls(e,t){on(os,null===t?os.current:t.pool)}function cs(){var e=ss();return null===e?null:{parent:Jo._currentValue,pool:e}}var us=Error(It(460)),ds=Error(It(474)),fs=Error(It(542)),ps={then:function(){}};function ms(e){return"fulfilled"===(e=e.status)||"rejected"===e}function hs(){}function gs(e,t,n){switch(void 0===(n=e[n])?e.push(t):n!==t&&(t.then(hs,hs),t=n),t.status){case"fulfilled":return t.value;case"rejected":throw ws(e=t.reason),e;default:if("string"==typeof t.status)t.then(hs,hs);else{if(null!==(e=vd)&&100<e.shellSuspendCounter)throw Error(It(482));(e=t).status="pending",e.then(function(e){if("pending"===t.status){var n=t;n.status="fulfilled",n.value=e}},function(e){if("pending"===t.status){var n=t;n.status="rejected",n.reason=e}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw ws(e=t.reason),e}throw ys=t,us}}var ys=null;function bs(){if(null===ys)throw Error(It(459));var e=ys;return ys=null,e}function ws(e){if(e===us||e===fs)throw Error(It(483))}var xs=!1;function vs(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Ss(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function Es(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function Is(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,2&xd){var i=r.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,t=Ja(e),Ya(e,null,n),t}return Ka(e,r,t,n),Ja(e)}function ks(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,4194048&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,qn(e,n)}}function As(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var o={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};null===a?i=a=o:a=a.next=o,n=n.next}while(null!==n);null===a?i=a=t:a=a.next=t}else i=a=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:r.shared,callbacks:r.callbacks},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}var Ns=!1;function Ts(){if(Ns&&null!==rs)throw rs}function _s(e,t,n,r){Ns=!1;var i=e.updateQueue;xs=!1;var a=i.firstBaseUpdate,o=i.lastBaseUpdate,s=i.shared.pending;if(null!==s){i.shared.pending=null;var l=s,c=l.next;l.next=null,null===o?a=c:o.next=c,o=l;var u=e.alternate;null!==u&&(s=(u=u.updateQueue).lastBaseUpdate)!==o&&(null===s?u.firstBaseUpdate=c:s.next=c,u.lastBaseUpdate=l)}if(null!==a){var d=i.baseState;for(o=0,u=c=l=null,s=a;;){var f=-536870913&s.lane,p=f!==s.lane;if(p?(Ed&f)===f:(r&f)===f){0!==f&&f===ns&&(Ns=!0),null!==u&&(u=u.next={lane:0,tag:s.tag,payload:s.payload,callback:null,next:null});e:{var m=e,h=s;f=t;var g=n;switch(h.tag){case 1:if("function"==typeof(m=h.payload)){d=m.call(g,d,f);break e}d=m;break e;case 3:m.flags=-65537&m.flags|128;case 0:if(null==(f="function"==typeof(m=h.payload)?m.call(g,d,f):m))break e;d=Pt({},d,f);break e;case 2:xs=!0}}null!==(f=s.callback)&&(e.flags|=64,p&&(e.flags|=8192),null===(p=i.callbacks)?i.callbacks=[f]:p.push(f))}else p={lane:f,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===u?(c=u=p,l=d):u=u.next=p,o|=f;if(null===(s=s.next)){if(null===(s=i.shared.pending))break;s=(p=s).next,p.next=null,i.lastBaseUpdate=p,i.shared.pending=null}}null===u&&(l=d),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,null===a&&(i.shared.lanes=0),Bd|=o,e.lanes=o,e.memoizedState=d}}function Ps(e,t){if("function"!=typeof e)throw Error(It(191,e));e.call(t)}function Bs(e,t){var n=e.callbacks;if(null!==n)for(e.callbacks=null,e=0;e<n.length;e++)Ps(n[e],t)}var Cs=rn(null),Os=rn(0);function Ls(e,t){on(Os,e=_d),on(Cs,t),_d=e|t.baseLanes}function Fs(){on(Os,_d),on(Cs,Cs.current)}function Rs(){_d=Os.current,an(Cs),an(Os)}var Us=0,Ms=null,$s=null,Hs=null,Ds=!1,zs=!1,Ws=!1,Vs=0,js=0,qs=null,Ks=0;function Xs(){throw Error(It(321))}function Gs(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!pa(e[n],t[n]))return!1;return!0}function Ys(e,t,n,r,i,a){return Us=a,Ms=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Qt.H=null===e||null===e.memoizedState?uc:dc,Ws=!1,a=n(r,i),Ws=!1,zs&&(a=Qs(t,n,r,i)),Js(e),a}function Js(e){Qt.H=cc;var t=null!==$s&&null!==$s.next;if(Us=0,Hs=$s=Ms=null,Ds=!1,js=0,qs=null,t)throw Error(It(300));null===e||jc||null!==(e=e.dependencies)&&Wo(e)&&(jc=!0)}function Qs(e,t,n,r){Ms=e;var i=0;do{if(zs&&(qs=null),js=0,zs=!1,25<=i)throw Error(It(301));if(i+=1,Hs=$s=null,null!=e.updateQueue){var a=e.updateQueue;a.lastEffect=null,a.events=null,a.stores=null,null!=a.memoCache&&(a.memoCache.index=0)}Qt.H=fc,a=t(n,r)}while(zs);return a}function Zs(){var e=Qt.H,t=e.useState()[0];return t="function"==typeof t.then?al(t):t,e=e.useState()[0],(null!==$s?$s.memoizedState:null)!==e&&(Ms.flags|=1024),t}function el(){var e=0!==Vs;return Vs=0,e}function tl(e,t,n){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n}function nl(e){if(Ds){for(e=e.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}Ds=!1}Us=0,Hs=$s=Ms=null,zs=!1,js=Vs=0,qs=null}function rl(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Hs?Ms.memoizedState=Hs=e:Hs=Hs.next=e,Hs}function il(){if(null===$s){var e=Ms.alternate;e=null!==e?e.memoizedState:null}else e=$s.next;var t=null===Hs?Ms.memoizedState:Hs.next;if(null!==t)Hs=t,$s=e;else{if(null===e){if(null===Ms.alternate)throw Error(It(467));throw Error(It(310))}e={memoizedState:($s=e).memoizedState,baseState:$s.baseState,baseQueue:$s.baseQueue,queue:$s.queue,next:null},null===Hs?Ms.memoizedState=Hs=e:Hs=Hs.next=e}return Hs}function al(e){var t=js;return js+=1,null===qs&&(qs=[]),e=gs(qs,e,t),t=Ms,null===(null===Hs?t.memoizedState:Hs.next)&&(t=t.alternate,Qt.H=null===t||null===t.memoizedState?uc:dc),e}function ol(e){if(null!==e&&"object"==typeof e){if("function"==typeof e.then)return al(e);if(e.$$typeof===$t)return jo(e)}throw Error(It(438,String(e)))}function sl(e){var t=null,n=Ms.updateQueue;if(null!==n&&(t=n.memoCache),null==t){var r=Ms.alternate;null!==r&&null!==(r=r.updateQueue)&&null!=(r=r.memoCache)&&(t={data:r.data.map(function(e){return e.slice()}),index:0})}if(null==t&&(t={data:[],index:0}),null===n&&(n={lastEffect:null,events:null,stores:null,memoCache:null},Ms.updateQueue=n),n.memoCache=t,void 0===(n=t.data[t.index]))for(n=t.data[t.index]=Array(e),r=0;r<e;r++)n[r]=qt;return t.index++,n}function ll(e,t){return"function"==typeof t?t(e):t}function cl(e){return ul(il(),$s,e)}function ul(e,t,n){var r=e.queue;if(null===r)throw Error(It(311));r.lastRenderedReducer=n;var i=e.baseQueue,a=r.pending;if(null!==a){if(null!==i){var o=i.next;i.next=a.next,a.next=o}t.baseQueue=i=a,r.pending=null}if(a=e.baseState,null===i)e.memoizedState=a;else{var s=o=null,l=null,c=t=i.next,u=!1;do{var d=-536870913&c.lane;if(d!==c.lane?(Ed&d)===d:(Us&d)===d){var f=c.revertLane;if(0===f)null!==l&&(l=l.next={lane:0,revertLane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),d===ns&&(u=!0);else{if((Us&f)===f){c=c.next,f===ns&&(u=!0);continue}d={lane:0,revertLane:c.revertLane,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null},null===l?(s=l=d,o=a):l=l.next=d,Ms.lanes|=f,Bd|=f}d=c.action,Ws&&n(a,d),a=c.hasEagerState?c.eagerState:n(a,d)}else f={lane:d,revertLane:c.revertLane,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null},null===l?(s=l=f,o=a):l=l.next=f,Ms.lanes|=d,Bd|=d;c=c.next}while(null!==c&&c!==t);if(null===l?o=a:l.next=s,!pa(a,e.memoizedState)&&(jc=!0,u&&null!==(n=rs)))throw n;e.memoizedState=a,e.baseState=o,e.baseQueue=l,r.lastRenderedState=a}return null===i&&(r.lanes=0),[e.memoizedState,r.dispatch]}function dl(e){var t=il(),n=t.queue;if(null===n)throw Error(It(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,a=t.memoizedState;if(null!==i){n.pending=null;var o=i=i.next;do{a=e(a,o.action),o=o.next}while(o!==i);pa(a,t.memoizedState)||(jc=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,r]}function fl(e,t,n){var r=Ms,i=il(),a=Io;if(a){if(void 0===n)throw Error(It(407));n=n()}else n=t();var o=!pa(($s||i).memoizedState,n);if(o&&(i.memoizedState=n,jc=!0),i=i.queue,Fl(2048,8,hl.bind(null,r,i,e),[e]),i.getSnapshot!==t||o||null!==Hs&&1&Hs.memoizedState.tag){if(r.flags|=2048,Cl(9,{destroy:void 0,resource:void 0},ml.bind(null,r,i,n,t),null),null===vd)throw Error(It(349));a||124&Us||pl(r,t,n)}return n}function pl(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=Ms.updateQueue)?(t={lastEffect:null,events:null,stores:null,memoCache:null},Ms.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function ml(e,t,n,r){t.value=n,t.getSnapshot=r,gl(t)&&yl(e)}function hl(e,t,n){return n(function(){gl(t)&&yl(e)})}function gl(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!pa(e,n)}catch(Kh){return!0}}function yl(e){var t=Ga(e,2);null!==t&&ef(t,0,2)}function bl(e){var t=rl();if("function"==typeof e){var n=e;if(e=n(),Ws){Bn(!0);try{n()}finally{Bn(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ll,lastRenderedState:e},t}function wl(e,t,n,r){return e.baseState=n,ul(e,$s,"function"==typeof r?r:ll)}function xl(e,t,n,r,i){if(oc(e))throw Error(It(485));if(null!==(e=t.action)){var a={payload:i,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(e){a.listeners.push(e)}};null!==Qt.T?n(!0):a.isTransition=!1,r(a),null===(n=t.pending)?(a.next=t.pending=a,vl(t,a)):(a.next=n.next,t.pending=n.next=a)}}function vl(e,t){var n=t.action,r=t.payload,i=e.state;if(t.isTransition){var a=Qt.T,o={};Qt.T=o;try{var s=n(i,r),l=Qt.S;null!==l&&l(o,s),Sl(e,t,s)}catch(Kh){Il(e,t,Kh)}finally{Qt.T=a}}else try{Sl(e,t,a=n(i,r))}catch(c){Il(e,t,c)}}function Sl(e,t,n){null!==n&&"object"==typeof n&&"function"==typeof n.then?n.then(function(n){El(e,t,n)},function(n){return Il(e,t,n)}):El(e,t,n)}function El(e,t,n){t.status="fulfilled",t.value=n,kl(t),e.state=n,null!==(t=e.pending)&&((n=t.next)===t?e.pending=null:(n=n.next,t.next=n,vl(e,n)))}function Il(e,t,n){var r=e.pending;if(e.pending=null,null!==r){r=r.next;do{t.status="rejected",t.reason=n,kl(t),t=t.next}while(t!==r)}e.action=null}function kl(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function Al(e,t){return t}function Nl(e,t){if(Io){var n=vd.formState;if(null!==n){e:{var r=Ms;if(Io){if(Eo){t:{for(var i=Eo,a=Ao;8!==i.nodeType;){if(!a){i=null;break t}if(null===(i=Rp(i.nextSibling))){i=null;break t}}i="F!"===(a=i.data)||"F"===a?i:null}if(i){Eo=Rp(i.nextSibling),r="F!"===i.data;break e}}To(r)}r=!1}r&&(t=n[0])}}return(n=rl()).memoizedState=n.baseState=t,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Al,lastRenderedState:t},n.queue=r,n=rc.bind(null,Ms,r),r.dispatch=n,r=bl(!1),a=ac.bind(null,Ms,!1,r.queue),i={state:t,dispatch:null,action:e,pending:null},(r=rl()).queue=i,n=xl.bind(null,Ms,i,a,n),i.dispatch=n,r.memoizedState=e,[t,n,!1]}function Tl(e){return _l(il(),$s,e)}function _l(e,t,n){if(t=ul(e,t,Al)[0],e=cl(ll)[0],"object"==typeof t&&null!==t&&"function"==typeof t.then)try{var r=al(t)}catch(o){if(o===us)throw fs;throw o}else r=t;var i=(t=il()).queue,a=i.dispatch;return n!==t.memoizedState&&(Ms.flags|=2048,Cl(9,{destroy:void 0,resource:void 0},Pl.bind(null,i,n),null)),[r,a,e]}function Pl(e,t){e.action=t}function Bl(e){var t=il(),n=$s;if(null!==n)return _l(t,n,e);il(),t=t.memoizedState;var r=(n=il()).queue.dispatch;return n.memoizedState=e,[t,r,!1]}function Cl(e,t,n,r){return e={tag:e,create:n,deps:r,inst:t,next:null},null===(t=Ms.updateQueue)&&(t={lastEffect:null,events:null,stores:null,memoCache:null},Ms.updateQueue=t),null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Ol(){return il().memoizedState}function Ll(e,t,n,r){var i=rl();r=void 0===r?null:r,Ms.flags|=e,i.memoizedState=Cl(1|t,{destroy:void 0,resource:void 0},n,r)}function Fl(e,t,n,r){var i=il();r=void 0===r?null:r;var a=i.memoizedState.inst;null!==$s&&null!==r&&Gs(r,$s.memoizedState.deps)?i.memoizedState=Cl(t,a,n,r):(Ms.flags|=e,i.memoizedState=Cl(1|t,a,n,r))}function Rl(e,t){Ll(8390656,8,e,t)}function Ul(e,t){Fl(2048,8,e,t)}function Ml(e,t){return Fl(4,2,e,t)}function $l(e,t){return Fl(4,4,e,t)}function Hl(e,t){if("function"==typeof t){e=e();var n=t(e);return function(){"function"==typeof n?n():t(null)}}if(null!=t)return e=e(),t.current=e,function(){t.current=null}}function Dl(e,t,n){n=null!=n?n.concat([e]):null,Fl(4,4,Hl.bind(null,t,e),n)}function zl(){}function Wl(e,t){var n=il();t=void 0===t?null:t;var r=n.memoizedState;return null!==t&&Gs(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Vl(e,t){var n=il();t=void 0===t?null:t;var r=n.memoizedState;if(null!==t&&Gs(t,r[1]))return r[0];if(r=e(),Ws){Bn(!0);try{e()}finally{Bn(!1)}}return n.memoizedState=[r,t],r}function jl(e,t,n){return void 0===n||1073741824&Us?e.memoizedState=t:(e.memoizedState=n,e=Zd(),Ms.lanes|=e,Bd|=e,n)}function ql(e,t,n,r){return pa(n,t)?n:null!==Cs.current?(e=jl(e,n,r),pa(e,t)||(jc=!0),e):42&Us?(e=Zd(),Ms.lanes|=e,Bd|=e,t):(jc=!0,e.memoizedState=n)}function Kl(e,t,n,r,i){var a=Zt.p;Zt.p=0!==a&&8>a?a:8;var o,s,l,c=Qt.T,u={};Qt.T=u,ac(e,!1,t,n);try{var d=i(),f=Qt.S;if(null!==f&&f(u,d),null!==d&&"object"==typeof d&&"function"==typeof d.then){var p=(o=r,s=[],l={status:"pending",value:null,reason:null,then:function(e){s.push(e)}},d.then(function(){l.status="fulfilled",l.value=o;for(var e=0;e<s.length;e++)(0,s[e])(o)},function(e){for(l.status="rejected",l.reason=e,e=0;e<s.length;e++)(0,s[e])(void 0)}),l);ic(e,t,p,Qd())}else ic(e,t,r,Qd())}catch(Kh){ic(e,t,{then:function(){},status:"rejected",reason:Kh},Qd())}finally{Zt.p=a,Qt.T=c}}function Xl(){}function Gl(e,t,n,r){if(5!==e.tag)throw Error(It(476));var i=Yl(e).queue;Kl(e,i,t,en,null===n?Xl:function(){return Jl(e),n(r)})}function Yl(e){var t=e.memoizedState;if(null!==t)return t;var n={};return(t={memoizedState:en,baseState:en,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ll,lastRenderedState:en},next:null}).next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ll,lastRenderedState:n},next:null},e.memoizedState=t,null!==(e=e.alternate)&&(e.memoizedState=t),t}function Jl(e){ic(e,Yl(e).next.queue,{},Qd())}function Ql(){return jo(pm)}function Zl(){return il().memoizedState}function ec(){return il().memoizedState}function tc(e){for(var t=e.return;null!==t;){switch(t.tag){case 24:case 3:var n=Qd(),r=Is(t,e=Es(n),n);return null!==r&&(ef(r,0,n),ks(r,t,n)),t={cache:Qo()},void(e.payload=t)}t=t.return}}function nc(e,t,n){var r=Qd();n={lane:r,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null},oc(e)?sc(t,n):null!==(n=Xa(e,t,n,r))&&(ef(n,0,r),lc(n,t,r))}function rc(e,t,n){ic(e,t,n,Qd())}function ic(e,t,n,r){var i={lane:r,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null};if(oc(e))sc(t,i);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var o=t.lastRenderedState,s=a(o,n);if(i.hasEagerState=!0,i.eagerState=s,pa(s,o))return Ka(e,t,i,0),null===vd&&qa(),!1}catch(Kh){}if(null!==(n=Xa(e,t,i,r)))return ef(n,0,r),lc(n,t,r),!0}return!1}function ac(e,t,n,r){if(r={lane:2,revertLane:Xf(),action:r,hasEagerState:!1,eagerState:null,next:null},oc(e)){if(t)throw Error(It(479))}else null!==(t=Xa(e,n,r,2))&&ef(t,0,2)}function oc(e){var t=e.alternate;return e===Ms||null!==t&&t===Ms}function sc(e,t){zs=Ds=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function lc(e,t,n){if(4194048&n){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,qn(e,n)}}var cc={readContext:jo,use:ol,useCallback:Xs,useContext:Xs,useEffect:Xs,useImperativeHandle:Xs,useLayoutEffect:Xs,useInsertionEffect:Xs,useMemo:Xs,useReducer:Xs,useRef:Xs,useState:Xs,useDebugValue:Xs,useDeferredValue:Xs,useTransition:Xs,useSyncExternalStore:Xs,useId:Xs,useHostTransitionStatus:Xs,useFormState:Xs,useActionState:Xs,useOptimistic:Xs,useMemoCache:Xs,useCacheRefresh:Xs},uc={readContext:jo,use:ol,useCallback:function(e,t){return rl().memoizedState=[e,void 0===t?null:t],e},useContext:jo,useEffect:Rl,useImperativeHandle:function(e,t,n){n=null!=n?n.concat([e]):null,Ll(4194308,4,Hl.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Ll(4194308,4,e,t)},useInsertionEffect:function(e,t){Ll(4,2,e,t)},useMemo:function(e,t){var n=rl();t=void 0===t?null:t;var r=e();if(Ws){Bn(!0);try{e()}finally{Bn(!1)}}return n.memoizedState=[r,t],r},useReducer:function(e,t,n){var r=rl();if(void 0!==n){var i=n(t);if(Ws){Bn(!0);try{n(t)}finally{Bn(!1)}}}else i=t;return r.memoizedState=r.baseState=i,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:i},r.queue=e,e=e.dispatch=nc.bind(null,Ms,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},rl().memoizedState=e},useState:function(e){var t=(e=bl(e)).queue,n=rc.bind(null,Ms,t);return t.dispatch=n,[e.memoizedState,n]},useDebugValue:zl,useDeferredValue:function(e,t){return jl(rl(),e,t)},useTransition:function(){var e=bl(!1);return e=Kl.bind(null,Ms,e.queue,!0,!1),rl().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,n){var r=Ms,i=rl();if(Io){if(void 0===n)throw Error(It(407));n=n()}else{if(n=t(),null===vd)throw Error(It(349));124&Ed||pl(r,t,n)}i.memoizedState=n;var a={value:n,getSnapshot:t};return i.queue=a,Rl(hl.bind(null,r,a,e),[e]),r.flags|=2048,Cl(9,{destroy:void 0,resource:void 0},ml.bind(null,r,a,n,t),null),n},useId:function(){var e=rl(),t=vd.identifierPrefix;if(Io){var n=yo;t="\xab"+t+"R"+(n=(go&~(1<<32-Cn(go)-1)).toString(32)+n),0<(n=Vs++)&&(t+="H"+n.toString(32)),t+="\xbb"}else t="\xab"+t+"r"+(n=Ks++).toString(32)+"\xbb";return e.memoizedState=t},useHostTransitionStatus:Ql,useFormState:Nl,useActionState:Nl,useOptimistic:function(e){var t=rl();t.memoizedState=t.baseState=e;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=n,t=ac.bind(null,Ms,!0,n),n.dispatch=t,[e,t]},useMemoCache:sl,useCacheRefresh:function(){return rl().memoizedState=tc.bind(null,Ms)}},dc={readContext:jo,use:ol,useCallback:Wl,useContext:jo,useEffect:Ul,useImperativeHandle:Dl,useInsertionEffect:Ml,useLayoutEffect:$l,useMemo:Vl,useReducer:cl,useRef:Ol,useState:function(){return cl(ll)},useDebugValue:zl,useDeferredValue:function(e,t){return ql(il(),$s.memoizedState,e,t)},useTransition:function(){var e=cl(ll)[0],t=il().memoizedState;return["boolean"==typeof e?e:al(e),t]},useSyncExternalStore:fl,useId:Zl,useHostTransitionStatus:Ql,useFormState:Tl,useActionState:Tl,useOptimistic:function(e,t){return wl(il(),0,e,t)},useMemoCache:sl,useCacheRefresh:ec},fc={readContext:jo,use:ol,useCallback:Wl,useContext:jo,useEffect:Ul,useImperativeHandle:Dl,useInsertionEffect:Ml,useLayoutEffect:$l,useMemo:Vl,useReducer:dl,useRef:Ol,useState:function(){return dl(ll)},useDebugValue:zl,useDeferredValue:function(e,t){var n=il();return null===$s?jl(n,e,t):ql(n,$s.memoizedState,e,t)},useTransition:function(){var e=dl(ll)[0],t=il().memoizedState;return["boolean"==typeof e?e:al(e),t]},useSyncExternalStore:fl,useId:Zl,useHostTransitionStatus:Ql,useFormState:Bl,useActionState:Bl,useOptimistic:function(e,t){var n=il();return null!==$s?wl(n,0,e,t):(n.baseState=e,[e,n.queue.dispatch])},useMemoCache:sl,useCacheRefresh:ec},pc=null,mc=0;function hc(e){var t=mc;return mc+=1,null===pc&&(pc=[]),gs(pc,e,t)}function gc(e,t){t=t.props.ref,e.ref=void 0!==t?t:null}function yc(e,t){if(t.$$typeof===Bt)throw Error(It(525));throw e=Object.prototype.toString.call(t),Error(It(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function bc(e){return(0,e._init)(e._payload)}function wc(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e){for(var t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function i(e,t){return(e=no(e,t)).index=0,e.sibling=null,e}function a(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=67108866,n):r:(t.flags|=67108866,n):(t.flags|=1048576,n)}function o(t){return e&&null===t.alternate&&(t.flags|=67108866),t}function s(e,t,n,r){return null===t||6!==t.tag?((t=oo(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function l(e,t,n,r){var a=n.type;return a===Lt?u(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===a||"object"==typeof a&&null!==a&&a.$$typeof===Vt&&bc(a)===t.type)?(gc(t=i(t,n.props),n),t.return=e,t):(gc(t=io(n.type,n.key,n.props,null,e.mode,r),n),t.return=e,t)}function c(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=so(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function u(e,t,n,r,a){return null===t||7!==t.tag?((t=ao(n,e.mode,r,a)).return=e,t):((t=i(t,n)).return=e,t)}function d(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t||"bigint"==typeof t)return(t=oo(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case Ct:return gc(n=io(t.type,t.key,t.props,null,e.mode,n),t),n.return=e,n;case Ot:return(t=so(t,e.mode,n)).return=e,t;case Vt:return d(e,t=(0,t._init)(t._payload),n)}if(Jt(t)||Xt(t))return(t=ao(t,e.mode,n,null)).return=e,t;if("function"==typeof t.then)return d(e,hc(t),n);if(t.$$typeof===$t)return d(e,qo(e,t),n);yc(e,t)}return null}function f(e,t,n,r){var i=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n||"bigint"==typeof n)return null!==i?null:s(e,t,""+n,r);if("object"==typeof n&&null!==n){switch(n.$$typeof){case Ct:return n.key===i?l(e,t,n,r):null;case Ot:return n.key===i?c(e,t,n,r):null;case Vt:return f(e,t,n=(i=n._init)(n._payload),r)}if(Jt(n)||Xt(n))return null!==i?null:u(e,t,n,r,null);if("function"==typeof n.then)return f(e,t,hc(n),r);if(n.$$typeof===$t)return f(e,t,qo(e,n),r);yc(e,n)}return null}function p(e,t,n,r,i){if("string"==typeof r&&""!==r||"number"==typeof r||"bigint"==typeof r)return s(t,e=e.get(n)||null,""+r,i);if("object"==typeof r&&null!==r){switch(r.$$typeof){case Ct:return l(t,e=e.get(null===r.key?n:r.key)||null,r,i);case Ot:return c(t,e=e.get(null===r.key?n:r.key)||null,r,i);case Vt:return p(e,t,n,r=(0,r._init)(r._payload),i)}if(Jt(r)||Xt(r))return u(t,e=e.get(n)||null,r,i,null);if("function"==typeof r.then)return p(e,t,n,hc(r),i);if(r.$$typeof===$t)return p(e,t,n,qo(t,r),i);yc(t,r)}return null}function m(s,l,c,u){if("object"==typeof c&&null!==c&&c.type===Lt&&null===c.key&&(c=c.props.children),"object"==typeof c&&null!==c){switch(c.$$typeof){case Ct:e:{for(var h=c.key;null!==l;){if(l.key===h){if((h=c.type)===Lt){if(7===l.tag){n(s,l.sibling),(u=i(l,c.props.children)).return=s,s=u;break e}}else if(l.elementType===h||"object"==typeof h&&null!==h&&h.$$typeof===Vt&&bc(h)===l.type){n(s,l.sibling),gc(u=i(l,c.props),c),u.return=s,s=u;break e}n(s,l);break}t(s,l),l=l.sibling}c.type===Lt?((u=ao(c.props.children,s.mode,u,c.key)).return=s,s=u):(gc(u=io(c.type,c.key,c.props,null,s.mode,u),c),u.return=s,s=u)}return o(s);case Ot:e:{for(h=c.key;null!==l;){if(l.key===h){if(4===l.tag&&l.stateNode.containerInfo===c.containerInfo&&l.stateNode.implementation===c.implementation){n(s,l.sibling),(u=i(l,c.children||[])).return=s,s=u;break e}n(s,l);break}t(s,l),l=l.sibling}(u=so(c,s.mode,u)).return=s,s=u}return o(s);case Vt:return m(s,l,c=(h=c._init)(c._payload),u)}if(Jt(c))return function(i,o,s,l){for(var c=null,u=null,m=o,h=o=0,g=null;null!==m&&h<s.length;h++){m.index>h?(g=m,m=null):g=m.sibling;var y=f(i,m,s[h],l);if(null===y){null===m&&(m=g);break}e&&m&&null===y.alternate&&t(i,m),o=a(y,o,h),null===u?c=y:u.sibling=y,u=y,m=g}if(h===s.length)return n(i,m),Io&&bo(i,h),c;if(null===m){for(;h<s.length;h++)null!==(m=d(i,s[h],l))&&(o=a(m,o,h),null===u?c=m:u.sibling=m,u=m);return Io&&bo(i,h),c}for(m=r(m);h<s.length;h++)null!==(g=p(m,i,h,s[h],l))&&(e&&null!==g.alternate&&m.delete(null===g.key?h:g.key),o=a(g,o,h),null===u?c=g:u.sibling=g,u=g);return e&&m.forEach(function(e){return t(i,e)}),Io&&bo(i,h),c}(s,l,c,u);if(Xt(c)){if("function"!=typeof(h=Xt(c)))throw Error(It(150));return function(i,o,s,l){if(null==s)throw Error(It(151));for(var c=null,u=null,m=o,h=o=0,g=null,y=s.next();null!==m&&!y.done;h++,y=s.next()){m.index>h?(g=m,m=null):g=m.sibling;var b=f(i,m,y.value,l);if(null===b){null===m&&(m=g);break}e&&m&&null===b.alternate&&t(i,m),o=a(b,o,h),null===u?c=b:u.sibling=b,u=b,m=g}if(y.done)return n(i,m),Io&&bo(i,h),c;if(null===m){for(;!y.done;h++,y=s.next())null!==(y=d(i,y.value,l))&&(o=a(y,o,h),null===u?c=y:u.sibling=y,u=y);return Io&&bo(i,h),c}for(m=r(m);!y.done;h++,y=s.next())null!==(y=p(m,i,h,y.value,l))&&(e&&null!==y.alternate&&m.delete(null===y.key?h:y.key),o=a(y,o,h),null===u?c=y:u.sibling=y,u=y);return e&&m.forEach(function(e){return t(i,e)}),Io&&bo(i,h),c}(s,l,c=h.call(c),u)}if("function"==typeof c.then)return m(s,l,hc(c),u);if(c.$$typeof===$t)return m(s,l,qo(s,c),u);yc(s,c)}return"string"==typeof c&&""!==c||"number"==typeof c||"bigint"==typeof c?(c=""+c,null!==l&&6===l.tag?(n(s,l.sibling),(u=i(l,c)).return=s,s=u):(n(s,l),(u=oo(c,s.mode,u)).return=s,s=u),o(s)):n(s,l)}return function(e,t,n,r){try{mc=0;var i=m(e,t,n,r);return pc=null,i}catch(o){if(o===us||o===fs)throw o;var a=eo(29,o,null,e.mode);return a.lanes=r,a.return=e,a}}}var xc=wc(!0),vc=wc(!1),Sc=rn(null),Ec=null;function Ic(e){var t=e.alternate;on(Tc,1&Tc.current),on(Sc,e),null===Ec&&(null===t||null!==Cs.current||null!==t.memoizedState)&&(Ec=e)}function kc(e){if(22===e.tag){if(on(Tc,Tc.current),on(Sc,e),null===Ec){var t=e.alternate;null!==t&&null!==t.memoizedState&&(Ec=e)}}else Ac()}function Ac(){on(Tc,Tc.current),on(Sc,Sc.current)}function Nc(e){an(Sc),Ec===e&&(Ec=null),an(Tc)}var Tc=rn(0);function _c(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||Fp(n)))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(128&t.flags)return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function Pc(e,t,n,r){n=null==(n=n(r,t=e.memoizedState))?t:Pt({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Bc={enqueueSetState:function(e,t,n){e=e._reactInternals;var r=Qd(),i=Es(r);i.payload=t,null!=n&&(i.callback=n),null!==(t=Is(e,i,r))&&(ef(t,0,r),ks(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=Qd(),i=Es(r);i.tag=1,i.payload=t,null!=n&&(i.callback=n),null!==(t=Is(e,i,r))&&(ef(t,0,r),ks(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Qd(),r=Es(n);r.tag=2,null!=t&&(r.callback=t),null!==(t=Is(e,r,n))&&(ef(t,0,n),ks(t,e,n))}};function Cc(e,t,n,r,i,a,o){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,o):!(t.prototype&&t.prototype.isPureReactComponent&&ma(n,r)&&ma(i,a))}function Oc(e,t,n,r){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Bc.enqueueReplaceState(t,t.state,null)}function Lc(e,t){var n=t;if("ref"in t)for(var r in n={},t)"ref"!==r&&(n[r]=t[r]);if(e=e.defaultProps)for(var i in n===t&&(n=Pt({},n)),e)void 0===n[i]&&(n[i]=e[i]);return n}var Fc="function"==typeof reportError?reportError:function(e){if("object"==typeof window&&"function"==typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"==typeof e&&null!==e&&"string"==typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"==typeof process&&"function"==typeof process.emit)return void process.emit("uncaughtException",e)};function Rc(e){Fc(e)}function Uc(e){}function Mc(e){Fc(e)}function $c(e,t){try{(0,e.onUncaughtError)(t.value,{componentStack:t.stack})}catch(n){setTimeout(function(){throw n})}}function Hc(e,t,n){try{(0,e.onCaughtError)(n.value,{componentStack:n.stack,errorBoundary:1===t.tag?t.stateNode:null})}catch(r){setTimeout(function(){throw r})}}function Dc(e,t,n){return(n=Es(n)).tag=3,n.payload={element:null},n.callback=function(){$c(e,t)},n}function zc(e){return(e=Es(e)).tag=3,e}function Wc(e,t,n,r){var i=n.type.getDerivedStateFromError;if("function"==typeof i){var a=r.value;e.payload=function(){return i(a)},e.callback=function(){Hc(t,n,r)}}var o=n.stateNode;null!==o&&"function"==typeof o.componentDidCatch&&(e.callback=function(){Hc(t,n,r),"function"!=typeof i&&(null===zd?zd=new Set([this]):zd.add(this));var e=r.stack;this.componentDidCatch(r.value,{componentStack:null!==e?e:""})})}var Vc=Error(It(461)),jc=!1;function qc(e,t,n,r){t.child=null===e?vc(t,null,n,r):xc(t,e.child,n,r)}function Kc(e,t,n,r,i){n=n.render;var a=t.ref;if("ref"in r){var o={};for(var s in r)"ref"!==s&&(o[s]=r[s])}else o=r;return Vo(t),r=Ys(e,t,n,o,a,i),s=el(),null===e||jc?(Io&&s&&xo(t),t.flags|=1,qc(e,t,r,i),t.child):(tl(e,t,i),pu(e,t,i))}function Xc(e,t,n,r,i){if(null===e){var a=n.type;return"function"!=typeof a||to(a)||void 0!==a.defaultProps||null!==n.compare?((e=io(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,Gc(e,t,a,r,i))}if(a=e.child,!mu(e,i)){var o=a.memoizedProps;if((n=null!==(n=n.compare)?n:ma)(o,r)&&e.ref===t.ref)return pu(e,t,i)}return t.flags|=1,(e=no(a,r)).ref=t.ref,e.return=t,t.child=e}function Gc(e,t,n,r,i){if(null!==e){var a=e.memoizedProps;if(ma(a,r)&&e.ref===t.ref){if(jc=!1,t.pendingProps=r=a,!mu(e,i))return t.lanes=e.lanes,pu(e,t,i);131072&e.flags&&(jc=!0)}}return Zc(e,t,n,r,i)}function Yc(e,t,n){var r=t.pendingProps,i=r.children,a=null!==e?e.memoizedState:null;if("hidden"===r.mode){if(128&t.flags){if(r=null!==a?a.baseLanes|n:n,null!==e){for(i=t.child=e.child,a=0;null!==i;)a=a|i.lanes|i.childLanes,i=i.sibling;t.childLanes=a&~r}else t.childLanes=0,t.child=null;return Jc(e,t,r,n)}if(!(536870912&n))return t.lanes=t.childLanes=536870912,Jc(e,t,null!==a?a.baseLanes|n:n,n);t.memoizedState={baseLanes:0,cachePool:null},null!==e&&ls(0,null!==a?a.cachePool:null),null!==a?Ls(t,a):Fs(),kc(t)}else null!==a?(ls(0,a.cachePool),Ls(t,a),Ac(),t.memoizedState=null):(null!==e&&ls(0,null),Fs(),Ac());return qc(e,t,i,n),t.child}function Jc(e,t,n,r){var i=ss();return i=null===i?null:{parent:Jo._currentValue,pool:i},t.memoizedState={baseLanes:n,cachePool:i},null!==e&&ls(0,null),Fs(),kc(t),null!==e&&zo(e,t,r,!0),null}function Qc(e,t){var n=t.ref;if(null===n)null!==e&&null!==e.ref&&(t.flags|=4194816);else{if("function"!=typeof n&&"object"!=typeof n)throw Error(It(284));null!==e&&e.ref===n||(t.flags|=4194816)}}function Zc(e,t,n,r,i){return Vo(t),n=Ys(e,t,n,r,void 0,i),r=el(),null===e||jc?(Io&&r&&xo(t),t.flags|=1,qc(e,t,n,i),t.child):(tl(e,t,i),pu(e,t,i))}function eu(e,t,n,r,i,a){return Vo(t),t.updateQueue=null,n=Qs(t,r,n,i),Js(e),r=el(),null===e||jc?(Io&&r&&xo(t),t.flags|=1,qc(e,t,n,a),t.child):(tl(e,t,a),pu(e,t,a))}function tu(e,t,n,r,i){if(Vo(t),null===t.stateNode){var a=Qa,o=n.contextType;"object"==typeof o&&null!==o&&(a=jo(o)),a=new n(r,a),t.memoizedState=null!==a.state&&void 0!==a.state?a.state:null,a.updater=Bc,t.stateNode=a,a._reactInternals=t,(a=t.stateNode).props=r,a.state=t.memoizedState,a.refs={},vs(t),o=n.contextType,a.context="object"==typeof o&&null!==o?jo(o):Qa,a.state=t.memoizedState,"function"==typeof(o=n.getDerivedStateFromProps)&&(Pc(t,n,o,r),a.state=t.memoizedState),"function"==typeof n.getDerivedStateFromProps||"function"==typeof a.getSnapshotBeforeUpdate||"function"!=typeof a.UNSAFE_componentWillMount&&"function"!=typeof a.componentWillMount||(o=a.state,"function"==typeof a.componentWillMount&&a.componentWillMount(),"function"==typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount(),o!==a.state&&Bc.enqueueReplaceState(a,a.state,null),_s(t,r,a,i),Ts(),a.state=t.memoizedState),"function"==typeof a.componentDidMount&&(t.flags|=4194308),r=!0}else if(null===e){a=t.stateNode;var s=t.memoizedProps,l=Lc(n,s);a.props=l;var c=a.context,u=n.contextType;o=Qa,"object"==typeof u&&null!==u&&(o=jo(u));var d=n.getDerivedStateFromProps;u="function"==typeof d||"function"==typeof a.getSnapshotBeforeUpdate,s=t.pendingProps!==s,u||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(s||c!==o)&&Oc(t,a,r,o),xs=!1;var f=t.memoizedState;a.state=f,_s(t,r,a,i),Ts(),c=t.memoizedState,s||f!==c||xs?("function"==typeof d&&(Pc(t,n,d,r),c=t.memoizedState),(l=xs||Cc(t,n,l,r,f,c,o))?(u||"function"!=typeof a.UNSAFE_componentWillMount&&"function"!=typeof a.componentWillMount||("function"==typeof a.componentWillMount&&a.componentWillMount(),"function"==typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"==typeof a.componentDidMount&&(t.flags|=4194308)):("function"==typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=c),a.props=r,a.state=c,a.context=o,r=l):("function"==typeof a.componentDidMount&&(t.flags|=4194308),r=!1)}else{a=t.stateNode,Ss(e,t),u=Lc(n,o=t.memoizedProps),a.props=u,d=t.pendingProps,f=a.context,c=n.contextType,l=Qa,"object"==typeof c&&null!==c&&(l=jo(c)),(c="function"==typeof(s=n.getDerivedStateFromProps)||"function"==typeof a.getSnapshotBeforeUpdate)||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(o!==d||f!==l)&&Oc(t,a,r,l),xs=!1,f=t.memoizedState,a.state=f,_s(t,r,a,i),Ts();var p=t.memoizedState;o!==d||f!==p||xs||null!==e&&null!==e.dependencies&&Wo(e.dependencies)?("function"==typeof s&&(Pc(t,n,s,r),p=t.memoizedState),(u=xs||Cc(t,n,u,r,f,p,l)||null!==e&&null!==e.dependencies&&Wo(e.dependencies))?(c||"function"!=typeof a.UNSAFE_componentWillUpdate&&"function"!=typeof a.componentWillUpdate||("function"==typeof a.componentWillUpdate&&a.componentWillUpdate(r,p,l),"function"==typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(r,p,l)),"function"==typeof a.componentDidUpdate&&(t.flags|=4),"function"==typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof a.componentDidUpdate||o===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),"function"!=typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),a.props=r,a.state=p,a.context=l,r=u):("function"!=typeof a.componentDidUpdate||o===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),"function"!=typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),r=!1)}return a=r,Qc(e,t),r=!!(128&t.flags),a||r?(a=t.stateNode,n=r&&"function"!=typeof n.getDerivedStateFromError?null:a.render(),t.flags|=1,null!==e&&r?(t.child=xc(t,e.child,null,i),t.child=xc(t,null,n,i)):qc(e,t,n,i),t.memoizedState=a.state,e=t.child):e=pu(e,t,i),e}function nu(e,t,n,r){return Co(),t.flags|=256,qc(e,t,n,r),t.child}var ru={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function iu(e){return{baseLanes:e,cachePool:cs()}}function au(e,t,n){return e=null!==e?e.childLanes&~n:0,t&&(e|=Ld),e}function ou(e,t,n){var r,i=t.pendingProps,a=!1,o=!!(128&t.flags);if((r=o)||(r=(null===e||null!==e.memoizedState)&&!!(2&Tc.current)),r&&(a=!0,t.flags&=-129),r=!!(32&t.flags),t.flags&=-33,null===e){if(Io){if(a?Ic(t):Ac(),Io){var s,l=Eo;if(s=l){e:{for(s=l,l=Ao;8!==s.nodeType;){if(!l){l=null;break e}if(null===(s=Rp(s.nextSibling))){l=null;break e}}l=s}null!==l?(t.memoizedState={dehydrated:l,treeContext:null!==ho?{id:go,overflow:yo}:null,retryLane:536870912,hydrationErrors:null},(s=eo(18,null,null,0)).stateNode=l,s.return=t,t.child=s,So=t,Eo=null,s=!0):s=!1}s||To(t)}if(null!==(l=t.memoizedState)&&null!==(l=l.dehydrated))return Fp(l)?t.lanes=32:t.lanes=536870912,null;Nc(t)}return l=i.children,i=i.fallback,a?(Ac(),l=lu({mode:"hidden",children:l},a=t.mode),i=ao(i,a,n,null),l.return=t,i.return=t,l.sibling=i,t.child=l,(a=t.child).memoizedState=iu(n),a.childLanes=au(e,r,n),t.memoizedState=ru,i):(Ic(t),su(t,l))}if(null!==(s=e.memoizedState)&&null!==(l=s.dehydrated)){if(o)256&t.flags?(Ic(t),t.flags&=-257,t=cu(e,t,n)):null!==t.memoizedState?(Ac(),t.child=e.child,t.flags|=128,t=null):(Ac(),a=i.fallback,l=t.mode,i=lu({mode:"visible",children:i.children},l),(a=ao(a,l,n,null)).flags|=2,i.return=t,a.return=t,i.sibling=a,t.child=i,xc(t,e.child,null,n),(i=t.child).memoizedState=iu(n),i.childLanes=au(e,r,n),t.memoizedState=ru,t=a);else if(Ic(t),Fp(l)){if(r=l.nextSibling&&l.nextSibling.dataset)var c=r.dgst;r=c,(i=Error(It(419))).stack="",i.digest=r,Lo({value:i,source:null,stack:null}),t=cu(e,t,n)}else if(jc||zo(e,t,n,!1),r=0!==(n&e.childLanes),jc||r){if(null!==(r=vd)&&0!==(i=0!==((i=42&(i=n&-n)?1:Kn(i))&(r.suspendedLanes|n))?0:i)&&i!==s.retryLane)throw s.retryLane=i,Ga(e,i),ef(r,0,i),Vc;"$?"===l.data||ff(),t=cu(e,t,n)}else"$?"===l.data?(t.flags|=192,t.child=e.child,t=null):(e=s.treeContext,Eo=Rp(l.nextSibling),So=t,Io=!0,ko=null,Ao=!1,null!==e&&(po[mo++]=go,po[mo++]=yo,po[mo++]=ho,go=e.id,yo=e.overflow,ho=t),(t=su(t,i.children)).flags|=4096);return t}return a?(Ac(),a=i.fallback,l=t.mode,c=(s=e.child).sibling,(i=no(s,{mode:"hidden",children:i.children})).subtreeFlags=65011712&s.subtreeFlags,null!==c?a=no(c,a):(a=ao(a,l,n,null)).flags|=2,a.return=t,i.return=t,i.sibling=a,t.child=i,i=a,a=t.child,null===(l=e.child.memoizedState)?l=iu(n):(null!==(s=l.cachePool)?(c=Jo._currentValue,s=s.parent!==c?{parent:c,pool:c}:s):s=cs(),l={baseLanes:l.baseLanes|n,cachePool:s}),a.memoizedState=l,a.childLanes=au(e,r,n),t.memoizedState=ru,i):(Ic(t),e=(n=e.child).sibling,(n=no(n,{mode:"visible",children:i.children})).return=t,n.sibling=null,null!==e&&(null===(r=t.deletions)?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n)}function su(e,t){return(t=lu({mode:"visible",children:t},e.mode)).return=e,e.child=t}function lu(e,t){return(e=eo(22,e,null,t)).lanes=0,e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},e}function cu(e,t,n){return xc(t,e.child,null,n),(e=su(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function uu(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Ho(e.return,t,n)}function du(e,t,n,r,i){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=i)}function fu(e,t,n){var r=t.pendingProps,i=r.revealOrder,a=r.tail;if(qc(e,t,r.children,n),2&(r=Tc.current))r=1&r|2,t.flags|=128;else{if(null!==e&&128&e.flags)e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&uu(e,n,t);else if(19===e.tag)uu(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}switch(on(Tc,r),i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===_c(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),du(t,!1,i,n,a);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===_c(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}du(t,!0,n,null,a);break;case"together":du(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function pu(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Bd|=t.lanes,0===(n&t.childLanes)){if(null===e)return null;if(zo(e,t,n,!1),0===(n&t.childLanes))return null}if(null!==e&&t.child!==e.child)throw Error(It(153));if(null!==t.child){for(n=no(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=no(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function mu(e,t){return 0!==(e.lanes&t)||!(null===(e=e.dependencies)||!Wo(e))}function hu(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps)jc=!0;else{if(!(mu(e,n)||128&t.flags))return jc=!1,function(e,t,n){switch(t.tag){case 3:dn(t,t.stateNode.containerInfo),Mo(0,Jo,e.memoizedState.cache),Co();break;case 27:case 5:pn(t);break;case 4:dn(t,t.stateNode.containerInfo);break;case 10:Mo(0,t.type,t.memoizedProps.value);break;case 13:var r=t.memoizedState;if(null!==r)return null!==r.dehydrated?(Ic(t),t.flags|=128,null):0!==(n&t.child.childLanes)?ou(e,t,n):(Ic(t),null!==(e=pu(e,t,n))?e.sibling:null);Ic(t);break;case 19:var i=!!(128&e.flags);if((r=0!==(n&t.childLanes))||(zo(e,t,n,!1),r=0!==(n&t.childLanes)),i){if(r)return fu(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),on(Tc,Tc.current),r)break;return null;case 22:case 23:return t.lanes=0,Yc(e,t,n);case 24:Mo(0,Jo,e.memoizedState.cache)}return pu(e,t,n)}(e,t,n);jc=!!(131072&e.flags)}else jc=!1,Io&&1048576&t.flags&&wo(t,fo,t.index);switch(t.lanes=0,t.tag){case 16:e:{e=t.pendingProps;var r=t.elementType,i=r._init;if(r=i(r._payload),t.type=r,"function"!=typeof r){if(null!=r){if((i=r.$$typeof)===Ht){t.tag=11,t=Kc(null,t,r,e,n);break e}if(i===Wt){t.tag=14,t=Xc(null,t,r,e,n);break e}}throw t=Yt(r)||r,Error(It(306,t,""))}to(r)?(e=Lc(r,e),t.tag=1,t=tu(null,t,r,e,n)):(t.tag=0,t=Zc(null,t,r,e,n))}return t;case 0:return Zc(e,t,t.type,t.pendingProps,n);case 1:return tu(e,t,r=t.type,i=Lc(r,t.pendingProps),n);case 3:e:{if(dn(t,t.stateNode.containerInfo),null===e)throw Error(It(387));r=t.pendingProps;var a=t.memoizedState;i=a.element,Ss(e,t),_s(t,r,null,n);var o=t.memoizedState;if(r=o.cache,Mo(0,Jo,r),r!==a.cache&&Do(t,[Jo],n,!0),Ts(),r=o.element,a.isDehydrated){if(a={element:r,isDehydrated:!1,cache:o.cache},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=nu(e,t,r,n);break e}if(r!==i){Lo(i=za(Error(It(424)),t)),t=nu(e,t,r,n);break e}for(e=9===(e=t.stateNode.containerInfo).nodeType?e.body:"HTML"===e.nodeName?e.ownerDocument.body:e,Eo=Rp(e.firstChild),So=t,Io=!0,ko=null,Ao=!0,n=vc(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(Co(),r===i){t=pu(e,t,n);break e}qc(e,t,r,n)}t=t.child}return t;case 26:return Qc(e,t),null===e?(n=Kp(t.type,null,t.pendingProps,null))?t.memoizedState=n:Io||(n=t.type,e=t.pendingProps,(r=Sp(cn.current).createElement(n))[Jn]=t,r[Qn]=e,wp(r,n,e),ur(r),t.stateNode=r):t.memoizedState=Kp(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return pn(t),null===e&&Io&&(r=t.stateNode=$p(t.type,t.pendingProps,cn.current),So=t,Ao=!0,i=Eo,Cp(t.type)?(Up=i,Eo=Rp(r.firstChild)):Eo=i),qc(e,t,t.pendingProps.children,n),Qc(e,t),null===e&&(t.flags|=4194304),t.child;case 5:return null===e&&Io&&((i=r=Eo)&&(null!==(r=function(e,t,n,r){for(;1===e.nodeType;){var i=n;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!r&&("INPUT"!==e.nodeName||"hidden"!==e.type))break}else if(r){if(!e[ir])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if("stylesheet"===(a=e.getAttribute("rel"))&&e.hasAttribute("data-precedence"))break;if(a!==i.rel||e.getAttribute("href")!==(null==i.href||""===i.href?null:i.href)||e.getAttribute("crossorigin")!==(null==i.crossOrigin?null:i.crossOrigin)||e.getAttribute("title")!==(null==i.title?null:i.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(((a=e.getAttribute("src"))!==(null==i.src?null:i.src)||e.getAttribute("type")!==(null==i.type?null:i.type)||e.getAttribute("crossorigin")!==(null==i.crossOrigin?null:i.crossOrigin))&&a&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else{if("input"!==t||"hidden"!==e.type)return e;var a=null==i.name?null:""+i.name;if("hidden"===i.type&&e.getAttribute("name")===a)return e}if(null===(e=Rp(e.nextSibling)))break}return null}(r,t.type,t.pendingProps,Ao))?(t.stateNode=r,So=t,Eo=Rp(r.firstChild),Ao=!1,i=!0):i=!1),i||To(t)),pn(t),i=t.type,a=t.pendingProps,o=null!==e?e.memoizedProps:null,r=a.children,kp(i,a)?r=null:null!==o&&kp(i,o)&&(t.flags|=32),null!==t.memoizedState&&(i=Ys(e,t,Zs,null,null,n),pm._currentValue=i),Qc(e,t),qc(e,t,r,n),t.child;case 6:return null===e&&Io&&((e=n=Eo)&&(null!==(n=function(e,t,n){if(""===t)return null;for(;3!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!n)return null;if(null===(e=Rp(e.nextSibling)))return null}return e}(n,t.pendingProps,Ao))?(t.stateNode=n,So=t,Eo=null,e=!0):e=!1),e||To(t)),null;case 13:return ou(e,t,n);case 4:return dn(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=xc(t,null,r,n):qc(e,t,r,n),t.child;case 11:return Kc(e,t,t.type,t.pendingProps,n);case 7:return qc(e,t,t.pendingProps,n),t.child;case 8:case 12:return qc(e,t,t.pendingProps.children,n),t.child;case 10:return r=t.pendingProps,Mo(0,t.type,r.value),qc(e,t,r.children,n),t.child;case 9:return i=t.type._context,r=t.pendingProps.children,Vo(t),r=r(i=jo(i)),t.flags|=1,qc(e,t,r,n),t.child;case 14:return Xc(e,t,t.type,t.pendingProps,n);case 15:return Gc(e,t,t.type,t.pendingProps,n);case 19:return fu(e,t,n);case 31:return r=t.pendingProps,n=t.mode,r={mode:r.mode,children:r.children},null===e?((n=lu(r,n)).ref=t.ref,t.child=n,n.return=t,t=n):((n=no(e.child,r)).ref=t.ref,t.child=n,n.return=t,t=n),t;case 22:return Yc(e,t,n);case 24:return Vo(t),r=jo(Jo),null===e?(null===(i=ss())&&(i=vd,a=Qo(),i.pooledCache=a,a.refCount++,null!==a&&(i.pooledCacheLanes|=n),i=a),t.memoizedState={parent:r,cache:i},vs(t),Mo(0,Jo,i)):(0!==(e.lanes&n)&&(Ss(e,t),_s(t,null,null,n),Ts()),i=e.memoizedState,a=t.memoizedState,i.parent!==r?(i={parent:r,cache:r},t.memoizedState=i,0===t.lanes&&(t.memoizedState=t.updateQueue.baseState=i),Mo(0,Jo,r)):(r=a.cache,Mo(0,Jo,r),r!==i.cache&&Do(t,[Jo],n,!0))),qc(e,t,t.pendingProps.children,n),t.child;case 29:throw t.pendingProps}throw Error(It(156,t.tag))}function gu(e){e.flags|=4}function yu(e,t){if("stylesheet"!==t.type||4&t.state.loading)e.flags&=-16777217;else if(e.flags|=16777216,!om(t)){if(null!==(t=Sc.current)&&((4194048&Ed)===Ed?null!==Ec:(62914560&Ed)!==Ed&&!(536870912&Ed)||t!==Ec))throw ys=ps,ds;e.flags|=8192}}function bu(e,t){null!==t&&(e.flags|=4),16384&e.flags&&(t=22!==e.tag?zn():536870912,e.lanes|=t,Fd|=t)}function wu(e,t){if(!Io)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function xu(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=65011712&i.subtreeFlags,r|=65011712&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function vu(e,t,n){var r=t.pendingProps;switch(vo(t),t.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return xu(t),null;case 3:return n=t.stateNode,r=null,null!==e&&(r=e.memoizedState.cache),t.memoizedState.cache!==r&&(t.flags|=2048),$o(Jo),fn(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(Bo(t)?gu(t):null===e||e.memoizedState.isDehydrated&&!(256&t.flags)||(t.flags|=1024,Oo())),xu(t),null;case 26:return n=t.memoizedState,null===e?(gu(t),null!==n?(xu(t),yu(t,n)):(xu(t),t.flags&=-16777217)):n?n!==e.memoizedState?(gu(t),xu(t),yu(t,n)):(xu(t),t.flags&=-16777217):(e.memoizedProps!==r&&gu(t),xu(t),t.flags&=-16777217),null;case 27:mn(t),n=cn.current;var i=t.type;if(null!==e&&null!=t.stateNode)e.memoizedProps!==r&&gu(t);else{if(!r){if(null===t.stateNode)throw Error(It(166));return xu(t),null}e=sn.current,Bo(t)?_o(t):(e=$p(i,r,n),t.stateNode=e,gu(t))}return xu(t),null;case 5:if(mn(t),n=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==r&&gu(t);else{if(!r){if(null===t.stateNode)throw Error(It(166));return xu(t),null}if(e=sn.current,Bo(t))_o(t);else{switch(i=Sp(cn.current),e){case 1:e=i.createElementNS("http://www.w3.org/2000/svg",n);break;case 2:e=i.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;default:switch(n){case"svg":e=i.createElementNS("http://www.w3.org/2000/svg",n);break;case"math":e=i.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;case"script":(e=i.createElement("div")).innerHTML="\x3Cscript><\/script>",e=e.removeChild(e.firstChild);break;case"select":e="string"==typeof r.is?i.createElement("select",{is:r.is}):i.createElement("select"),r.multiple?e.multiple=!0:r.size&&(e.size=r.size);break;default:e="string"==typeof r.is?i.createElement(n,{is:r.is}):i.createElement(n)}}e[Jn]=t,e[Qn]=r;e:for(i=t.child;null!==i;){if(5===i.tag||6===i.tag)e.appendChild(i.stateNode);else if(4!==i.tag&&27!==i.tag&&null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break e;for(;null===i.sibling;){if(null===i.return||i.return===t)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}t.stateNode=e;e:switch(wp(e,n,r),n){case"button":case"input":case"select":case"textarea":e=!!r.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&gu(t)}}return xu(t),t.flags&=-16777217,null;case 6:if(e&&null!=t.stateNode)e.memoizedProps!==r&&gu(t);else{if("string"!=typeof r&&null===t.stateNode)throw Error(It(166));if(e=cn.current,Bo(t)){if(e=t.stateNode,n=t.memoizedProps,r=null,null!==(i=So))switch(i.tag){case 27:case 5:r=i.memoizedProps}e[Jn]=t,(e=!!(e.nodeValue===n||null!==r&&!0===r.suppressHydrationWarning||hp(e.nodeValue,n)))||To(t)}else(e=Sp(e).createTextNode(r))[Jn]=t,t.stateNode=e}return xu(t),null;case 13:if(r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(i=Bo(t),null!==r&&null!==r.dehydrated){if(null===e){if(!i)throw Error(It(318));if(!(i=null!==(i=t.memoizedState)?i.dehydrated:null))throw Error(It(317));i[Jn]=t}else Co(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;xu(t),i=!1}else i=Oo(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=i),i=!0;if(!i)return 256&t.flags?(Nc(t),t):(Nc(t),null)}if(Nc(t),128&t.flags)return t.lanes=n,t;if(n=null!==r,e=null!==e&&null!==e.memoizedState,n){i=null,null!==(r=t.child).alternate&&null!==r.alternate.memoizedState&&null!==r.alternate.memoizedState.cachePool&&(i=r.alternate.memoizedState.cachePool.pool);var a=null;null!==r.memoizedState&&null!==r.memoizedState.cachePool&&(a=r.memoizedState.cachePool.pool),a!==i&&(r.flags|=2048)}return n!==e&&n&&(t.child.flags|=8192),bu(t,t.updateQueue),xu(t),null;case 4:return fn(),null===e&&ap(t.stateNode.containerInfo),xu(t),null;case 10:return $o(t.type),xu(t),null;case 19:if(an(Tc),null===(i=t.memoizedState))return xu(t),null;if(r=!!(128&t.flags),null===(a=i.rendering))if(r)wu(i,!1);else{if(0!==Pd||null!==e&&128&e.flags)for(e=t.child;null!==e;){if(null!==(a=_c(e))){for(t.flags|=128,wu(i,!1),e=a.updateQueue,t.updateQueue=e,bu(t,e),t.subtreeFlags=0,e=n,n=t.child;null!==n;)ro(n,e),n=n.sibling;return on(Tc,1&Tc.current|2),t.child}e=e.sibling}null!==i.tail&&xn()>Hd&&(t.flags|=128,r=!0,wu(i,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=_c(a))){if(t.flags|=128,r=!0,e=e.updateQueue,t.updateQueue=e,bu(t,e),wu(i,!0),null===i.tail&&"hidden"===i.tailMode&&!a.alternate&&!Io)return xu(t),null}else 2*xn()-i.renderingStartTime>Hd&&536870912!==n&&(t.flags|=128,r=!0,wu(i,!1),t.lanes=4194304);i.isBackwards?(a.sibling=t.child,t.child=a):(null!==(e=i.last)?e.sibling=a:t.child=a,i.last=a)}return null!==i.tail?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=xn(),t.sibling=null,e=Tc.current,on(Tc,r?1&e|2:1&e),t):(xu(t),null);case 22:case 23:return Nc(t),Rs(),r=null!==t.memoizedState,null!==e?null!==e.memoizedState!==r&&(t.flags|=8192):r&&(t.flags|=8192),r?!!(536870912&n)&&!(128&t.flags)&&(xu(t),6&t.subtreeFlags&&(t.flags|=8192)):xu(t),null!==(n=t.updateQueue)&&bu(t,n.retryQueue),n=null,null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),r=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(r=t.memoizedState.cachePool.pool),r!==n&&(t.flags|=2048),null!==e&&an(os),null;case 24:return n=null,null!==e&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),$o(Jo),xu(t),null;case 25:case 30:return null}throw Error(It(156,t.tag))}function Su(e,t){switch(vo(t),t.tag){case 1:return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return $o(Jo),fn(),65536&(e=t.flags)&&!(128&e)?(t.flags=-65537&e|128,t):null;case 26:case 27:case 5:return mn(t),null;case 13:if(Nc(t),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(It(340));Co()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return an(Tc),null;case 4:return fn(),null;case 10:return $o(t.type),null;case 22:case 23:return Nc(t),Rs(),null!==e&&an(os),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 24:return $o(Jo),null;default:return null}}function Eu(e,t){switch(vo(t),t.tag){case 3:$o(Jo),fn();break;case 26:case 27:case 5:mn(t);break;case 4:fn();break;case 13:Nc(t);break;case 19:an(Tc);break;case 10:$o(t.type);break;case 22:case 23:Nc(t),Rs(),null!==e&&an(os);break;case 24:$o(Jo)}}function Iu(e,t){try{var n=t.updateQueue,r=null!==n?n.lastEffect:null;if(null!==r){var i=r.next;n=i;do{if((n.tag&e)===e){r=void 0;var a=n.create,o=n.inst;r=a(),o.destroy=r}n=n.next}while(n!==i)}}catch(Kh){_f(t,t.return,Kh)}}function ku(e,t,n){try{var r=t.updateQueue,i=null!==r?r.lastEffect:null;if(null!==i){var a=i.next;r=a;do{if((r.tag&e)===e){var o=r.inst,s=o.destroy;if(void 0!==s){o.destroy=void 0,i=t;var l=n,c=s;try{c()}catch(Kh){_f(i,l,Kh)}}}r=r.next}while(r!==a)}}catch(Kh){_f(t,t.return,Kh)}}function Au(e){var t=e.updateQueue;if(null!==t){var n=e.stateNode;try{Bs(t,n)}catch(Kh){_f(e,e.return,Kh)}}}function Nu(e,t,n){n.props=Lc(e.type,e.memoizedProps),n.state=e.memoizedState;try{n.componentWillUnmount()}catch(Kh){_f(e,t,Kh)}}function Tu(e,t){try{var n=e.ref;if(null!==n){switch(e.tag){case 26:case 27:case 5:var r=e.stateNode;break;default:r=e.stateNode}"function"==typeof n?e.refCleanup=n(r):n.current=r}}catch(Kh){_f(e,t,Kh)}}function _u(e,t){var n=e.ref,r=e.refCleanup;if(null!==n)if("function"==typeof r)try{r()}catch(Kh){_f(e,t,Kh)}finally{e.refCleanup=null,null!=(e=e.alternate)&&(e.refCleanup=null)}else if("function"==typeof n)try{n(null)}catch(i){_f(e,t,i)}else n.current=null}function Pu(e){var t=e.type,n=e.memoizedProps,r=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":n.autoFocus&&r.focus();break e;case"img":n.src?r.src=n.src:n.srcSet&&(r.srcset=n.srcSet)}}catch(Kh){_f(e,e.return,Kh)}}function Bu(e,t,n){try{var r=e.stateNode;!function(e,t,n,r){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var i=null,a=null,o=null,s=null,l=null,c=null,u=null;for(p in n){var d=n[p];if(n.hasOwnProperty(p)&&null!=d)switch(p){case"checked":case"value":break;case"defaultValue":l=d;default:r.hasOwnProperty(p)||yp(e,t,p,null,r,d)}}for(var f in r){var p=r[f];if(d=n[f],r.hasOwnProperty(f)&&(null!=p||null!=d))switch(f){case"type":a=p;break;case"name":i=p;break;case"checked":c=p;break;case"defaultChecked":u=p;break;case"value":o=p;break;case"defaultValue":s=p;break;case"children":case"dangerouslySetInnerHTML":if(null!=p)throw Error(It(137,t));break;default:p!==d&&yp(e,t,f,p,r,d)}}return void Fr(e,o,s,l,c,u,a,i);case"select":for(a in p=o=s=f=null,n)if(l=n[a],n.hasOwnProperty(a)&&null!=l)switch(a){case"value":break;case"multiple":p=l;default:r.hasOwnProperty(a)||yp(e,t,a,null,r,l)}for(i in r)if(a=r[i],l=n[i],r.hasOwnProperty(i)&&(null!=a||null!=l))switch(i){case"value":f=a;break;case"defaultValue":s=a;break;case"multiple":o=a;default:a!==l&&yp(e,t,i,a,r,l)}return t=s,n=o,r=p,void(null!=f?Mr(e,!!n,f,!1):!!r!=!!n&&(null!=t?Mr(e,!!n,t,!0):Mr(e,!!n,n?[]:"",!1)));case"textarea":for(s in p=f=null,n)if(i=n[s],n.hasOwnProperty(s)&&null!=i&&!r.hasOwnProperty(s))switch(s){case"value":case"children":break;default:yp(e,t,s,null,r,i)}for(o in r)if(i=r[o],a=n[o],r.hasOwnProperty(o)&&(null!=i||null!=a))switch(o){case"value":f=i;break;case"defaultValue":p=i;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=i)throw Error(It(91));break;default:i!==a&&yp(e,t,o,i,r,a)}return void $r(e,f,p);case"option":for(var m in n)f=n[m],n.hasOwnProperty(m)&&null!=f&&!r.hasOwnProperty(m)&&("selected"===m?e.selected=!1:yp(e,t,m,null,r,f));for(l in r)f=r[l],p=n[l],!r.hasOwnProperty(l)||f===p||null==f&&null==p||("selected"===l?e.selected=f&&"function"!=typeof f&&"symbol"!=typeof f:yp(e,t,l,f,r,p));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var h in n)f=n[h],n.hasOwnProperty(h)&&null!=f&&!r.hasOwnProperty(h)&&yp(e,t,h,null,r,f);for(c in r)if(f=r[c],p=n[c],r.hasOwnProperty(c)&&f!==p&&(null!=f||null!=p))switch(c){case"children":case"dangerouslySetInnerHTML":if(null!=f)throw Error(It(137,t));break;default:yp(e,t,c,f,r,p)}return;default:if(jr(t)){for(var g in n)f=n[g],n.hasOwnProperty(g)&&void 0!==f&&!r.hasOwnProperty(g)&&bp(e,t,g,void 0,r,f);for(u in r)f=r[u],p=n[u],!r.hasOwnProperty(u)||f===p||void 0===f&&void 0===p||bp(e,t,u,f,r,p);return}}for(var y in n)f=n[y],n.hasOwnProperty(y)&&null!=f&&!r.hasOwnProperty(y)&&yp(e,t,y,null,r,f);for(d in r)f=r[d],p=n[d],!r.hasOwnProperty(d)||f===p||null==f&&null==p||yp(e,t,d,f,r,p)}(r,e.type,n,t),r[Qn]=t}catch(Kh){_f(e,e.return,Kh)}}function Cu(e){return 5===e.tag||3===e.tag||26===e.tag||27===e.tag&&Cp(e.type)||4===e.tag}function Ou(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||Cu(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(27===e.tag&&Cp(e.type))continue e;if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function Lu(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?(9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).insertBefore(e,t):((t=9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).appendChild(e),null!=(n=n._reactRootContainer)||null!==t.onclick||(t.onclick=gp));else if(4!==r&&(27===r&&Cp(e.type)&&(n=e.stateNode,t=null),null!==(e=e.child)))for(Lu(e,t,n),e=e.sibling;null!==e;)Lu(e,t,n),e=e.sibling}function Fu(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&(27===r&&Cp(e.type)&&(n=e.stateNode),null!==(e=e.child)))for(Fu(e,t,n),e=e.sibling;null!==e;)Fu(e,t,n),e=e.sibling}function Ru(e){var t=e.stateNode,n=e.memoizedProps;try{for(var r=e.type,i=t.attributes;i.length;)t.removeAttributeNode(i[0]);wp(t,r,n),t[Jn]=e,t[Qn]=n}catch(Kh){_f(e,e.return,Kh)}}var Uu=!1,Mu=!1,$u=!1,Hu="function"==typeof WeakSet?WeakSet:Set,Du=null;function zu(e,t,n){var r=n.flags;switch(n.tag){case 0:case 11:case 15:td(e,n),4&r&&Iu(5,n);break;case 1:if(td(e,n),4&r)if(e=n.stateNode,null===t)try{e.componentDidMount()}catch(Kh){_f(n,n.return,Kh)}else{var i=Lc(n.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(i,t,e.__reactInternalSnapshotBeforeUpdate)}catch(o){_f(n,n.return,o)}}64&r&&Au(n),512&r&&Tu(n,n.return);break;case 3:if(td(e,n),64&r&&null!==(e=n.updateQueue)){if(t=null,null!==n.child)switch(n.child.tag){case 27:case 5:case 1:t=n.child.stateNode}try{Bs(e,t)}catch(Kh){_f(n,n.return,Kh)}}break;case 27:null===t&&4&r&&Ru(n);case 26:case 5:td(e,n),null===t&&4&r&&Pu(n),512&r&&Tu(n,n.return);break;case 12:td(e,n);break;case 13:td(e,n),4&r&&Xu(e,n),64&r&&null!==(e=n.memoizedState)&&null!==(e=e.dehydrated)&&function(e,t){var n=e.ownerDocument;if("$?"!==e.data||"complete"===n.readyState)t();else{var r=function(){t(),n.removeEventListener("DOMContentLoaded",r)};n.addEventListener("DOMContentLoaded",r),e._reactRetry=r}}(e,n=Of.bind(null,n));break;case 22:if(!(r=null!==n.memoizedState||Uu)){t=null!==t&&null!==t.memoizedState||Mu,i=Uu;var a=Mu;Uu=r,(Mu=t)&&!a?rd(e,n,!!(8772&n.subtreeFlags)):td(e,n),Uu=i,Mu=a}break;case 30:break;default:td(e,n)}}function Wu(e){var t=e.alternate;null!==t&&(e.alternate=null,Wu(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&null!==(t=e.stateNode)&&ar(t),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Vu=null,ju=!1;function qu(e,t,n){for(n=n.child;null!==n;)Ku(e,t,n),n=n.sibling}function Ku(e,t,n){if(Pn&&"function"==typeof Pn.onCommitFiberUnmount)try{Pn.onCommitFiberUnmount(_n,n)}catch(a){}switch(n.tag){case 26:Mu||_u(n,t),qu(e,t,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode).parentNode.removeChild(n);break;case 27:Mu||_u(n,t);var r=Vu,i=ju;Cp(n.type)&&(Vu=n.stateNode,ju=!1),qu(e,t,n),Hp(n.stateNode),Vu=r,ju=i;break;case 5:Mu||_u(n,t);case 6:if(r=Vu,i=ju,Vu=null,qu(e,t,n),ju=i,null!==(Vu=r))if(ju)try{(9===Vu.nodeType?Vu.body:"HTML"===Vu.nodeName?Vu.ownerDocument.body:Vu).removeChild(n.stateNode)}catch(Kh){_f(n,t,Kh)}else try{Vu.removeChild(n.stateNode)}catch(Kh){_f(n,t,Kh)}break;case 18:null!==Vu&&(ju?(Op(9===(e=Vu).nodeType?e.body:"HTML"===e.nodeName?e.ownerDocument.body:e,n.stateNode),qm(e)):Op(Vu,n.stateNode));break;case 4:r=Vu,i=ju,Vu=n.stateNode.containerInfo,ju=!0,qu(e,t,n),Vu=r,ju=i;break;case 0:case 11:case 14:case 15:Mu||ku(2,n,t),Mu||ku(4,n,t),qu(e,t,n);break;case 1:Mu||(_u(n,t),"function"==typeof(r=n.stateNode).componentWillUnmount&&Nu(n,t,r)),qu(e,t,n);break;case 21:qu(e,t,n);break;case 22:Mu=(r=Mu)||null!==n.memoizedState,qu(e,t,n),Mu=r;break;default:qu(e,t,n)}}function Xu(e,t){if(null===t.memoizedState&&null!==(e=t.alternate)&&null!==(e=e.memoizedState)&&null!==(e=e.dehydrated))try{qm(e)}catch(Kh){_f(t,t.return,Kh)}}function Gu(e,t){var n=function(e){switch(e.tag){case 13:case 19:var t=e.stateNode;return null===t&&(t=e.stateNode=new Hu),t;case 22:return null===(t=(e=e.stateNode)._retryCache)&&(t=e._retryCache=new Hu),t;default:throw Error(It(435,e.tag))}}(e);t.forEach(function(t){var r=Lf.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))})}function Yu(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var i=n[r],a=e,o=t,s=o;e:for(;null!==s;){switch(s.tag){case 27:if(Cp(s.type)){Vu=s.stateNode,ju=!1;break e}break;case 5:Vu=s.stateNode,ju=!1;break e;case 3:case 4:Vu=s.stateNode.containerInfo,ju=!0;break e}s=s.return}if(null===Vu)throw Error(It(160));Ku(a,o,i),Vu=null,ju=!1,null!==(a=i.alternate)&&(a.return=null),i.return=null}if(13878&t.subtreeFlags)for(t=t.child;null!==t;)Qu(t,e),t=t.sibling}var Ju=null;function Qu(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Yu(t,e),Zu(e),4&r&&(ku(3,e,e.return),Iu(3,e),ku(5,e,e.return));break;case 1:Yu(t,e),Zu(e),512&r&&(Mu||null===n||_u(n,n.return)),64&r&&Uu&&null!==(e=e.updateQueue)&&null!==(r=e.callbacks)&&(n=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=null===n?r:n.concat(r));break;case 26:var i=Ju;if(Yu(t,e),Zu(e),512&r&&(Mu||null===n||_u(n,n.return)),4&r){var a=null!==n?n.memoizedState:null;if(r=e.memoizedState,null===n)if(null===r)if(null===e.stateNode){e:{r=e.type,n=e.memoizedProps,i=i.ownerDocument||i;t:switch(r){case"title":(!(a=i.getElementsByTagName("title")[0])||a[ir]||a[Jn]||"http://www.w3.org/2000/svg"===a.namespaceURI||a.hasAttribute("itemprop"))&&(a=i.createElement(r),i.head.insertBefore(a,i.querySelector("head > title"))),wp(a,r,n),a[Jn]=e,ur(a),r=a;break e;case"link":var o=im("link","href",i).get(r+(n.href||""));if(o)for(var s=0;s<o.length;s++)if((a=o[s]).getAttribute("href")===(null==n.href||""===n.href?null:n.href)&&a.getAttribute("rel")===(null==n.rel?null:n.rel)&&a.getAttribute("title")===(null==n.title?null:n.title)&&a.getAttribute("crossorigin")===(null==n.crossOrigin?null:n.crossOrigin)){o.splice(s,1);break t}wp(a=i.createElement(r),r,n),i.head.appendChild(a);break;case"meta":if(o=im("meta","content",i).get(r+(n.content||"")))for(s=0;s<o.length;s++)if((a=o[s]).getAttribute("content")===(null==n.content?null:""+n.content)&&a.getAttribute("name")===(null==n.name?null:n.name)&&a.getAttribute("property")===(null==n.property?null:n.property)&&a.getAttribute("http-equiv")===(null==n.httpEquiv?null:n.httpEquiv)&&a.getAttribute("charset")===(null==n.charSet?null:n.charSet)){o.splice(s,1);break t}wp(a=i.createElement(r),r,n),i.head.appendChild(a);break;default:throw Error(It(468,r))}a[Jn]=e,ur(a),r=a}e.stateNode=r}else am(i,e.type,e.stateNode);else e.stateNode=Zp(i,r,e.memoizedProps);else a!==r?(null===a?null!==n.stateNode&&(n=n.stateNode).parentNode.removeChild(n):a.count--,null===r?am(i,e.type,e.stateNode):Zp(i,r,e.memoizedProps)):null===r&&null!==e.stateNode&&Bu(e,e.memoizedProps,n.memoizedProps)}break;case 27:Yu(t,e),Zu(e),512&r&&(Mu||null===n||_u(n,n.return)),null!==n&&4&r&&Bu(e,e.memoizedProps,n.memoizedProps);break;case 5:if(Yu(t,e),Zu(e),512&r&&(Mu||null===n||_u(n,n.return)),32&e.flags){i=e.stateNode;try{Dr(i,"")}catch(Kh){_f(e,e.return,Kh)}}4&r&&null!=e.stateNode&&Bu(e,i=e.memoizedProps,null!==n?n.memoizedProps:i),1024&r&&($u=!0);break;case 6:if(Yu(t,e),Zu(e),4&r){if(null===e.stateNode)throw Error(It(162));r=e.memoizedProps,n=e.stateNode;try{n.nodeValue=r}catch(Kh){_f(e,e.return,Kh)}}break;case 3:if(rm=null,i=Ju,Ju=Wp(t.containerInfo),Yu(t,e),Ju=i,Zu(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{qm(t.containerInfo)}catch(Kh){_f(e,e.return,Kh)}$u&&($u=!1,ed(e));break;case 4:r=Ju,Ju=Wp(e.stateNode.containerInfo),Yu(t,e),Zu(e),Ju=r;break;case 12:default:Yu(t,e),Zu(e);break;case 13:Yu(t,e),Zu(e),8192&e.child.flags&&null!==e.memoizedState!=(null!==n&&null!==n.memoizedState)&&($d=xn()),4&r&&null!==(r=e.updateQueue)&&(e.updateQueue=null,Gu(e,r));break;case 22:i=null!==e.memoizedState;var l=null!==n&&null!==n.memoizedState,c=Uu,u=Mu;if(Uu=c||i,Mu=u||l,Yu(t,e),Mu=u,Uu=c,Zu(e),8192&r)e:for(t=e.stateNode,t._visibility=i?-2&t._visibility:1|t._visibility,i&&(null===n||l||Uu||Mu||nd(e)),n=null,t=e;;){if(5===t.tag||26===t.tag){if(null===n){l=n=t;try{if(a=l.stateNode,i)"function"==typeof(o=a.style).setProperty?o.setProperty("display","none","important"):o.display="none";else{s=l.stateNode;var d=l.memoizedProps.style,f=null!=d&&d.hasOwnProperty("display")?d.display:null;s.style.display=null==f||"boolean"==typeof f?"":(""+f).trim()}}catch(Kh){_f(l,l.return,Kh)}}}else if(6===t.tag){if(null===n){l=t;try{l.stateNode.nodeValue=i?"":l.memoizedProps}catch(Kh){_f(l,l.return,Kh)}}}else if((22!==t.tag&&23!==t.tag||null===t.memoizedState||t===e)&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;null===t.sibling;){if(null===t.return||t.return===e)break e;n===t&&(n=null),t=t.return}n===t&&(n=null),t.sibling.return=t.return,t=t.sibling}4&r&&null!==(r=e.updateQueue)&&null!==(n=r.retryQueue)&&(r.retryQueue=null,Gu(e,n));break;case 19:Yu(t,e),Zu(e),4&r&&null!==(r=e.updateQueue)&&(e.updateQueue=null,Gu(e,r));case 30:case 21:}}function Zu(e){var t=e.flags;if(2&t){try{for(var n,r=e.return;null!==r;){if(Cu(r)){n=r;break}r=r.return}if(null==n)throw Error(It(160));switch(n.tag){case 27:var i=n.stateNode;Fu(e,Ou(e),i);break;case 5:var a=n.stateNode;32&n.flags&&(Dr(a,""),n.flags&=-33),Fu(e,Ou(e),a);break;case 3:case 4:var o=n.stateNode.containerInfo;Lu(e,Ou(e),o);break;default:throw Error(It(161))}}catch(Kh){_f(e,e.return,Kh)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function ed(e){if(1024&e.subtreeFlags)for(e=e.child;null!==e;){var t=e;ed(t),5===t.tag&&1024&t.flags&&t.stateNode.reset(),e=e.sibling}}function td(e,t){if(8772&t.subtreeFlags)for(t=t.child;null!==t;)zu(e,t.alternate,t),t=t.sibling}function nd(e){for(e=e.child;null!==e;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:ku(4,t,t.return),nd(t);break;case 1:_u(t,t.return);var n=t.stateNode;"function"==typeof n.componentWillUnmount&&Nu(t,t.return,n),nd(t);break;case 27:Hp(t.stateNode);case 26:case 5:_u(t,t.return),nd(t);break;case 22:null===t.memoizedState&&nd(t);break;default:nd(t)}e=e.sibling}}function rd(e,t,n){for(n=n&&!!(8772&t.subtreeFlags),t=t.child;null!==t;){var r=t.alternate,i=e,a=t,o=a.flags;switch(a.tag){case 0:case 11:case 15:rd(i,a,n),Iu(4,a);break;case 1:if(rd(i,a,n),"function"==typeof(i=(r=a).stateNode).componentDidMount)try{i.componentDidMount()}catch(Kh){_f(r,r.return,Kh)}if(null!==(i=(r=a).updateQueue)){var s=r.stateNode;try{var l=i.shared.hiddenCallbacks;if(null!==l)for(i.shared.hiddenCallbacks=null,i=0;i<l.length;i++)Ps(l[i],s)}catch(Kh){_f(r,r.return,Kh)}}n&&64&o&&Au(a),Tu(a,a.return);break;case 27:Ru(a);case 26:case 5:rd(i,a,n),n&&null===r&&4&o&&Pu(a),Tu(a,a.return);break;case 12:rd(i,a,n);break;case 13:rd(i,a,n),n&&4&o&&Xu(i,a);break;case 22:null===a.memoizedState&&rd(i,a,n),Tu(a,a.return);break;case 30:break;default:rd(i,a,n)}t=t.sibling}}function id(e,t){var n=null;null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),e=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(e=t.memoizedState.cachePool.pool),e!==n&&(null!=e&&e.refCount++,null!=n&&Zo(n))}function ad(e,t){e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Zo(e))}function od(e,t,n,r){if(10256&t.subtreeFlags)for(t=t.child;null!==t;)sd(e,t,n,r),t=t.sibling}function sd(e,t,n,r){var i=t.flags;switch(t.tag){case 0:case 11:case 15:od(e,t,n,r),2048&i&&Iu(9,t);break;case 1:case 13:default:od(e,t,n,r);break;case 3:od(e,t,n,r),2048&i&&(e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Zo(e)));break;case 12:if(2048&i){od(e,t,n,r),e=t.stateNode;try{var a=t.memoizedProps,o=a.id,s=a.onPostCommit;"function"==typeof s&&s(o,null===t.alternate?"mount":"update",e.passiveEffectDuration,-0)}catch(Kh){_f(t,t.return,Kh)}}else od(e,t,n,r);break;case 23:break;case 22:a=t.stateNode,o=t.alternate,null!==t.memoizedState?2&a._visibility?od(e,t,n,r):cd(e,t):2&a._visibility?od(e,t,n,r):(a._visibility|=2,ld(e,t,n,r,!!(10256&t.subtreeFlags))),2048&i&&id(o,t);break;case 24:od(e,t,n,r),2048&i&&ad(t.alternate,t)}}function ld(e,t,n,r,i){for(i=i&&!!(10256&t.subtreeFlags),t=t.child;null!==t;){var a=e,o=t,s=n,l=r,c=o.flags;switch(o.tag){case 0:case 11:case 15:ld(a,o,s,l,i),Iu(8,o);break;case 23:break;case 22:var u=o.stateNode;null!==o.memoizedState?2&u._visibility?ld(a,o,s,l,i):cd(a,o):(u._visibility|=2,ld(a,o,s,l,i)),i&&2048&c&&id(o.alternate,o);break;case 24:ld(a,o,s,l,i),i&&2048&c&&ad(o.alternate,o);break;default:ld(a,o,s,l,i)}t=t.sibling}}function cd(e,t){if(10256&t.subtreeFlags)for(t=t.child;null!==t;){var n=e,r=t,i=r.flags;switch(r.tag){case 22:cd(n,r),2048&i&&id(r.alternate,r);break;case 24:cd(n,r),2048&i&&ad(r.alternate,r);break;default:cd(n,r)}t=t.sibling}}var ud=8192;function dd(e){if(e.subtreeFlags&ud)for(e=e.child;null!==e;)fd(e),e=e.sibling}function fd(e){switch(e.tag){case 26:dd(e),e.flags&ud&&null!==e.memoizedState&&function(e,t,n){if(null===sm)throw Error(It(475));var r=sm;if(!("stylesheet"!==t.type||"string"==typeof n.media&&!1===matchMedia(n.media).matches||4&t.state.loading)){if(null===t.instance){var i=Xp(n.href),a=e.querySelector(Gp(i));if(a)return null!==(e=a._p)&&"object"==typeof e&&"function"==typeof e.then&&(r.count++,r=cm.bind(r),e.then(r,r)),t.state.loading|=4,t.instance=a,void ur(a);a=e.ownerDocument||e,n=Yp(n),(i=Dp.get(i))&&tm(n,i),ur(a=a.createElement("link"));var o=a;o._p=new Promise(function(e,t){o.onload=e,o.onerror=t}),wp(a,"link",n),t.instance=a}null===r.stylesheets&&(r.stylesheets=new Map),r.stylesheets.set(t,e),(e=t.state.preload)&&!(3&t.state.loading)&&(r.count++,t=cm.bind(r),e.addEventListener("load",t),e.addEventListener("error",t))}}(Ju,e.memoizedState,e.memoizedProps);break;case 5:default:dd(e);break;case 3:case 4:var t=Ju;Ju=Wp(e.stateNode.containerInfo),dd(e),Ju=t;break;case 22:null===e.memoizedState&&(null!==(t=e.alternate)&&null!==t.memoizedState?(t=ud,ud=16777216,dd(e),ud=t):dd(e))}}function pd(e){var t=e.alternate;if(null!==t&&null!==(e=t.child)){t.child=null;do{t=e.sibling,e.sibling=null,e=t}while(null!==e)}}function md(e){var t=e.deletions;if(16&e.flags){if(null!==t)for(var n=0;n<t.length;n++){var r=t[n];Du=r,yd(r,e)}pd(e)}if(10256&e.subtreeFlags)for(e=e.child;null!==e;)hd(e),e=e.sibling}function hd(e){switch(e.tag){case 0:case 11:case 15:md(e),2048&e.flags&&ku(9,e,e.return);break;case 3:case 12:default:md(e);break;case 22:var t=e.stateNode;null!==e.memoizedState&&2&t._visibility&&(null===e.return||13!==e.return.tag)?(t._visibility&=-3,gd(e)):md(e)}}function gd(e){var t=e.deletions;if(16&e.flags){if(null!==t)for(var n=0;n<t.length;n++){var r=t[n];Du=r,yd(r,e)}pd(e)}for(e=e.child;null!==e;){switch((t=e).tag){case 0:case 11:case 15:ku(8,t,t.return),gd(t);break;case 22:2&(n=t.stateNode)._visibility&&(n._visibility&=-3,gd(t));break;default:gd(t)}e=e.sibling}}function yd(e,t){for(;null!==Du;){var n=Du;switch(n.tag){case 0:case 11:case 15:ku(8,n,t);break;case 23:case 22:if(null!==n.memoizedState&&null!==n.memoizedState.cachePool){var r=n.memoizedState.cachePool.pool;null!=r&&r.refCount++}break;case 24:Zo(n.memoizedState.cache)}if(null!==(r=n.child))r.return=n,Du=r;else e:for(n=e;null!==Du;){var i=(r=Du).sibling,a=r.return;if(Wu(r),r===n){Du=null;break e}if(null!==i){i.return=a,Du=i;break e}Du=a}}}var bd={getCacheForType:function(e){var t=jo(Jo),n=t.data.get(e);return void 0===n&&(n=e(),t.data.set(e,n)),n}},wd="function"==typeof WeakMap?WeakMap:Map,xd=0,vd=null,Sd=null,Ed=0,Id=0,kd=null,Ad=!1,Nd=!1,Td=!1,_d=0,Pd=0,Bd=0,Cd=0,Od=0,Ld=0,Fd=0,Rd=null,Ud=null,Md=!1,$d=0,Hd=1/0,Dd=null,zd=null,Wd=0,Vd=null,jd=null,qd=0,Kd=0,Xd=null,Gd=null,Yd=0,Jd=null;function Qd(){return 2&xd&&0!==Ed?Ed&-Ed:null!==Qt.T?0!==ns?ns:Xf():Gn()}function Zd(){0===Ld&&(Ld=536870912&Ed&&!Io?536870912:Dn());var e=Sc.current;return null!==e&&(e.flags|=32),Ld}function ef(e,t,n){(e!==vd||2!==Id&&9!==Id)&&null===e.cancelPendingCommit||(lf(e,0),af(e,Ed,Ld,!1)),Vn(e,n),2&xd&&e===vd||(e===vd&&(!(2&xd)&&(Cd|=n),4===Pd&&af(e,Ed,Ld,!1)),Df(e))}function tf(e,t,n){if(6&xd)throw Error(It(327));for(var r=!n&&!(124&t)&&0===(t&e.expiredLanes)||$n(e,t),i=r?function(e,t){var n=xd;xd|=2;var r=uf(),i=df();vd!==e||Ed!==t?(Dd=null,Hd=xn()+500,lf(e,t)):Nd=$n(e,t);e:for(;;)try{if(0!==Id&&null!==Sd){t=Sd;var a=kd;t:switch(Id){case 1:Id=0,kd=null,bf(e,t,a,1);break;case 2:case 9:if(ms(a)){Id=0,kd=null,yf(t);break}t=function(){2!==Id&&9!==Id||vd!==e||(Id=7),Df(e)},a.then(t,t);break e;case 3:Id=7;break e;case 4:Id=5;break e;case 7:ms(a)?(Id=0,kd=null,yf(t)):(Id=0,kd=null,bf(e,t,a,7));break;case 5:var o=null;switch(Sd.tag){case 26:o=Sd.memoizedState;case 5:case 27:var s=Sd;if(!o||om(o)){Id=0,kd=null;var l=s.sibling;if(null!==l)Sd=l;else{var c=s.return;null!==c?(Sd=c,wf(c)):Sd=null}break t}}Id=0,kd=null,bf(e,t,a,5);break;case 6:Id=0,kd=null,bf(e,t,a,6);break;case 8:sf(),Pd=6;break e;default:throw Error(It(462))}}hf();break}catch(u){cf(e,u)}return Uo=Ro=null,Qt.H=r,Qt.A=i,xd=n,null!==Sd?0:(vd=null,Ed=0,qa(),Pd)}(e,t):pf(e,t,!0),a=r;;){if(0===i){Nd&&!r&&af(e,t,0,!1);break}if(n=e.current.alternate,!a||rf(n)){if(2===i){if(a=t,e.errorRecoveryDisabledLanes&a)var o=0;else o=0!=(o=-536870913&e.pendingLanes)?o:536870912&o?536870912:0;if(0!==o){t=o;e:{var s=e;i=Rd;var l=s.current.memoizedState.isDehydrated;if(l&&(lf(s,o).flags|=256),2!==(o=pf(s,o,!1))){if(Td&&!l){s.errorRecoveryDisabledLanes|=a,Cd|=a,i=4;break e}a=Ud,Ud=i,null!==a&&(null===Ud?Ud=a:Ud.push.apply(Ud,a))}i=o}if(a=!1,2!==i)continue}}if(1===i){lf(e,0),af(e,t,0,!0);break}e:{switch(r=e,a=i){case 0:case 1:throw Error(It(345));case 4:if((4194048&t)!==t)break;case 6:af(r,t,Ld,!Ad);break e;case 2:Ud=null;break;case 3:case 5:break;default:throw Error(It(329))}if((62914560&t)===t&&10<(i=$d+300-xn())){if(af(r,t,Ld,!Ad),0!==Mn(r,0,!0))break e;r.timeoutHandle=Np(nf.bind(null,r,n,Ud,Dd,Md,t,Ld,Cd,Fd,Ad,a,2,-0,0),i)}else nf(r,n,Ud,Dd,Md,t,Ld,Cd,Fd,Ad,a,0,-0,0)}break}i=pf(e,t,!1),a=!1}Df(e)}function nf(e,t,n,r,i,a,o,s,l,c,u,d,f,p){if(e.timeoutHandle=-1,(8192&(d=t.subtreeFlags)||!(16785408&~d))&&(sm={stylesheets:null,count:0,unsuspend:lm},fd(t),null!==(d=function(){if(null===sm)throw Error(It(475));var e=sm;return e.stylesheets&&0===e.count&&dm(e,e.stylesheets),0<e.count?function(t){var n=setTimeout(function(){if(e.stylesheets&&dm(e,e.stylesheets),e.unsuspend){var t=e.unsuspend;e.unsuspend=null,t()}},6e4);return e.unsuspend=t,function(){e.unsuspend=null,clearTimeout(n)}}:null}())))return e.cancelPendingCommit=d(vf.bind(null,e,t,a,n,r,i,o,s,l,u,1,f,p)),void af(e,a,o,!c);vf(e,t,a,n,r,i,o,s,l)}function rf(e){for(var t=e;;){var n=t.tag;if((0===n||11===n||15===n)&&16384&t.flags&&null!==(n=t.updateQueue)&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],a=i.getSnapshot;i=i.value;try{if(!pa(a(),i))return!1}catch(Kh){return!1}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function af(e,t,n,r){t&=~Od,t&=~Cd,e.suspendedLanes|=t,e.pingedLanes&=~t,r&&(e.warmLanes|=t),r=e.expirationTimes;for(var i=t;0<i;){var a=31-Cn(i),o=1<<a;r[a]=-1,i&=~o}0!==n&&jn(e,n,t)}function of(){return!!(6&xd)||(zf(0),!1)}function sf(){if(null!==Sd){if(0===Id)var e=Sd.return;else Uo=Ro=null,nl(e=Sd),pc=null,mc=0,e=Sd;for(;null!==e;)Eu(e.alternate,e),e=e.return;Sd=null}}function lf(e,t){var n=e.timeoutHandle;-1!==n&&(e.timeoutHandle=-1,Tp(n)),null!==(n=e.cancelPendingCommit)&&(e.cancelPendingCommit=null,n()),sf(),vd=e,Sd=n=no(e.current,null),Ed=t,Id=0,kd=null,Ad=!1,Nd=$n(e,t),Td=!1,Fd=Ld=Od=Cd=Bd=Pd=0,Ud=Rd=null,Md=!1,8&t&&(t|=32&t);var r=e.entangledLanes;if(0!==r)for(e=e.entanglements,r&=t;0<r;){var i=31-Cn(r),a=1<<i;t|=e[i],r&=~a}return _d=t,qa(),n}function cf(e,t){Ms=null,Qt.H=cc,t===us||t===fs?(t=bs(),Id=3):t===ds?(t=bs(),Id=4):Id=t===Vc?8:null!==t&&"object"==typeof t&&"function"==typeof t.then?6:1,kd=t,null===Sd&&(Pd=1,$c(e,za(t,e.current)))}function uf(){var e=Qt.H;return Qt.H=cc,null===e?cc:e}function df(){var e=Qt.A;return Qt.A=bd,e}function ff(){Pd=4,Ad||(4194048&Ed)!==Ed&&null!==Sc.current||(Nd=!0),!(134217727&Bd)&&!(134217727&Cd)||null===vd||af(vd,Ed,Ld,!1)}function pf(e,t,n){var r=xd;xd|=2;var i=uf(),a=df();vd===e&&Ed===t||(Dd=null,lf(e,t)),t=!1;var o=Pd;e:for(;;)try{if(0!==Id&&null!==Sd){var s=Sd,l=kd;switch(Id){case 8:sf(),o=6;break e;case 3:case 2:case 9:case 6:null===Sc.current&&(t=!0);var c=Id;if(Id=0,kd=null,bf(e,s,l,c),n&&Nd){o=0;break e}break;default:c=Id,Id=0,kd=null,bf(e,s,l,c)}}mf(),o=Pd;break}catch(u){cf(e,u)}return t&&e.shellSuspendCounter++,Uo=Ro=null,xd=r,Qt.H=i,Qt.A=a,null===Sd&&(vd=null,Ed=0,qa()),o}function mf(){for(;null!==Sd;)gf(Sd)}function hf(){for(;null!==Sd&&!bn();)gf(Sd)}function gf(e){var t=hu(e.alternate,e,_d);e.memoizedProps=e.pendingProps,null===t?wf(e):Sd=t}function yf(e){var t=e,n=t.alternate;switch(t.tag){case 15:case 0:t=eu(n,t,t.pendingProps,t.type,void 0,Ed);break;case 11:t=eu(n,t,t.pendingProps,t.type.render,t.ref,Ed);break;case 5:nl(t);default:Eu(n,t),t=hu(n,t=Sd=ro(t,_d),_d)}e.memoizedProps=e.pendingProps,null===t?wf(e):Sd=t}function bf(e,t,n,r){Uo=Ro=null,nl(t),pc=null,mc=0;var i=t.return;try{if(function(e,t,n,r,i){if(n.flags|=32768,null!==r&&"object"==typeof r&&"function"==typeof r.then){if(null!==(t=n.alternate)&&zo(t,n,i,!0),null!==(n=Sc.current)){switch(n.tag){case 13:return null===Ec?ff():null===n.alternate&&0===Pd&&(Pd=3),n.flags&=-257,n.flags|=65536,n.lanes=i,r===ps?n.flags|=16384:(null===(t=n.updateQueue)?n.updateQueue=new Set([r]):t.add(r),Pf(e,r,i)),!1;case 22:return n.flags|=65536,r===ps?n.flags|=16384:(null===(t=n.updateQueue)?(t={transitions:null,markerInstances:null,retryQueue:new Set([r])},n.updateQueue=t):null===(n=t.retryQueue)?t.retryQueue=new Set([r]):n.add(r),Pf(e,r,i)),!1}throw Error(It(435,n.tag))}return Pf(e,r,i),ff(),!1}if(Io)return null!==(t=Sc.current)?(!(65536&t.flags)&&(t.flags|=256),t.flags|=65536,t.lanes=i,r!==No&&Lo(za(e=Error(It(422),{cause:r}),n))):(r!==No&&Lo(za(t=Error(It(423),{cause:r}),n)),(e=e.current.alternate).flags|=65536,i&=-i,e.lanes|=i,r=za(r,n),As(e,i=Dc(e.stateNode,r,i)),4!==Pd&&(Pd=2)),!1;var a=Error(It(520),{cause:r});if(a=za(a,n),null===Rd?Rd=[a]:Rd.push(a),4!==Pd&&(Pd=2),null===t)return!0;r=za(r,n),n=t;do{switch(n.tag){case 3:return n.flags|=65536,e=i&-i,n.lanes|=e,As(n,e=Dc(n.stateNode,r,e)),!1;case 1:if(t=n.type,a=n.stateNode,!(128&n.flags||"function"!=typeof t.getDerivedStateFromError&&(null===a||"function"!=typeof a.componentDidCatch||null!==zd&&zd.has(a))))return n.flags|=65536,i&=-i,n.lanes|=i,Wc(i=zc(i),e,n,r),As(n,i),!1}n=n.return}while(null!==n);return!1}(e,i,t,n,Ed))return Pd=1,$c(e,za(n,e.current)),void(Sd=null)}catch(Kh){if(null!==i)throw Sd=i,Kh;return Pd=1,$c(e,za(n,e.current)),void(Sd=null)}32768&t.flags?(Io||1===r?e=!0:Nd||536870912&Ed?e=!1:(Ad=e=!0,(2===r||9===r||3===r||6===r)&&null!==(r=Sc.current)&&13===r.tag&&(r.flags|=16384)),xf(t,e)):wf(t)}function wf(e){var t=e;do{if(32768&t.flags)return void xf(t,Ad);e=t.return;var n=vu(t.alternate,t,_d);if(null!==n)return void(Sd=n);if(null!==(t=t.sibling))return void(Sd=t);Sd=t=e}while(null!==t);0===Pd&&(Pd=5)}function xf(e,t){do{var n=Su(e.alternate,e);if(null!==n)return n.flags&=32767,void(Sd=n);if(null!==(n=e.return)&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!t&&null!==(e=e.sibling))return void(Sd=e);Sd=e=n}while(null!==e);Pd=6,Sd=null}function vf(e,t,n,r,i,a,o,s,l){e.cancelPendingCommit=null;do{Af()}while(0!==Wd);if(6&xd)throw Error(It(327));if(null!==t){if(t===e.current)throw Error(It(177));if(a=t.lanes|t.childLanes,function(e,t,n,r,i,a){var o=e.pendingLanes;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=n,e.entangledLanes&=n,e.errorRecoveryDisabledLanes&=n,e.shellSuspendCounter=0;var s=e.entanglements,l=e.expirationTimes,c=e.hiddenUpdates;for(n=o&~n;0<n;){var u=31-Cn(n),d=1<<u;s[u]=0,l[u]=-1;var f=c[u];if(null!==f)for(c[u]=null,u=0;u<f.length;u++){var p=f[u];null!==p&&(p.lane&=-536870913)}n&=~d}0!==r&&jn(e,r,0),0!==a&&0===i&&0!==e.tag&&(e.suspendedLanes|=a&~(o&~t))}(e,n,a|=ja,o,s,l),e===vd&&(Sd=vd=null,Ed=0),jd=t,Vd=e,qd=n,Kd=a,Xd=i,Gd=r,10256&t.subtreeFlags||10256&t.flags?(e.callbackNode=null,e.callbackPriority=0,gn(In,function(){return Nf(),null})):(e.callbackNode=null,e.callbackPriority=0),r=!!(13878&t.flags),13878&t.subtreeFlags||r){r=Qt.T,Qt.T=null,i=Zt.p,Zt.p=2,o=xd,xd|=4;try{!function(e,t){if(e=e.containerInfo,xp=vm,wa(e=ba(e))){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var i=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{n.nodeType,a.nodeType}catch(h){n=null;break e}var o=0,s=-1,l=-1,c=0,u=0,d=e,f=null;t:for(;;){for(var p;d!==n||0!==i&&3!==d.nodeType||(s=o+i),d!==a||0!==r&&3!==d.nodeType||(l=o+r),3===d.nodeType&&(o+=d.nodeValue.length),null!==(p=d.firstChild);)f=d,d=p;for(;;){if(d===e)break t;if(f===n&&++c===i&&(s=o),f===a&&++u===r&&(l=o),null!==(p=d.nextSibling))break;f=(d=f).parentNode}d=p}n=-1===s||-1===l?null:{start:s,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(vp={focusedElem:e,selectionRange:n},vm=!1,Du=t;null!==Du;)if(e=(t=Du).child,1024&t.subtreeFlags&&null!==e)e.return=t,Du=e;else for(;null!==Du;){switch(a=(t=Du).alternate,e=t.flags,t.tag){case 0:case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(1024&e&&null!==a){e=void 0,n=t,i=a.memoizedProps,a=a.memoizedState,r=n.stateNode;try{var m=Lc(n.type,i,(n.elementType,n.type));e=r.getSnapshotBeforeUpdate(m,a),r.__reactInternalSnapshotBeforeUpdate=e}catch(Kh){_f(n,n.return,Kh)}}break;case 3:if(1024&e)if(9===(n=(e=t.stateNode.containerInfo).nodeType))Lp(e);else if(1===n)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":Lp(e);break;default:e.textContent=""}break;default:if(1024&e)throw Error(It(163))}if(null!==(e=t.sibling)){e.return=t.return,Du=e;break}Du=t.return}}(e,t)}finally{xd=o,Zt.p=i,Qt.T=r}}Wd=1,Sf(),Ef(),If()}}function Sf(){if(1===Wd){Wd=0;var e=Vd,t=jd,n=!!(13878&t.flags);if(13878&t.subtreeFlags||n){n=Qt.T,Qt.T=null;var r=Zt.p;Zt.p=2;var i=xd;xd|=4;try{Qu(t,e);var a=vp,o=ba(e.containerInfo),s=a.focusedElem,l=a.selectionRange;if(o!==s&&s&&s.ownerDocument&&ya(s.ownerDocument.documentElement,s)){if(null!==l&&wa(s)){var c=l.start,u=l.end;if(void 0===u&&(u=c),"selectionStart"in s)s.selectionStart=c,s.selectionEnd=Math.min(u,s.value.length);else{var d=s.ownerDocument||document,f=d&&d.defaultView||window;if(f.getSelection){var p=f.getSelection(),m=s.textContent.length,h=Math.min(l.start,m),g=void 0===l.end?h:Math.min(l.end,m);!p.extend&&h>g&&(o=g,g=h,h=o);var y=ga(s,h),b=ga(s,g);if(y&&b&&(1!==p.rangeCount||p.anchorNode!==y.node||p.anchorOffset!==y.offset||p.focusNode!==b.node||p.focusOffset!==b.offset)){var w=d.createRange();w.setStart(y.node,y.offset),p.removeAllRanges(),h>g?(p.addRange(w),p.extend(b.node,b.offset)):(w.setEnd(b.node,b.offset),p.addRange(w))}}}}for(d=[],p=s;p=p.parentNode;)1===p.nodeType&&d.push({element:p,left:p.scrollLeft,top:p.scrollTop});for("function"==typeof s.focus&&s.focus(),s=0;s<d.length;s++){var x=d[s];x.element.scrollLeft=x.left,x.element.scrollTop=x.top}}vm=!!xp,vp=xp=null}finally{xd=i,Zt.p=r,Qt.T=n}}e.current=t,Wd=2}}function Ef(){if(2===Wd){Wd=0;var e=Vd,t=jd,n=!!(8772&t.flags);if(8772&t.subtreeFlags||n){n=Qt.T,Qt.T=null;var r=Zt.p;Zt.p=2;var i=xd;xd|=4;try{zu(e,t.alternate,t)}finally{xd=i,Zt.p=r,Qt.T=n}}Wd=3}}function If(){if(4===Wd||3===Wd){Wd=0,wn();var e=Vd,t=jd,n=qd,r=Gd;10256&t.subtreeFlags||10256&t.flags?Wd=5:(Wd=0,jd=Vd=null,kf(e,e.pendingLanes));var i=e.pendingLanes;if(0===i&&(zd=null),Xn(n),t=t.stateNode,Pn&&"function"==typeof Pn.onCommitFiberRoot)try{Pn.onCommitFiberRoot(_n,t,void 0,!(128&~t.current.flags))}catch(l){}if(null!==r){t=Qt.T,i=Zt.p,Zt.p=2,Qt.T=null;try{for(var a=e.onRecoverableError,o=0;o<r.length;o++){var s=r[o];a(s.value,{componentStack:s.stack})}}finally{Qt.T=t,Zt.p=i}}3&qd&&Af(),Df(e),i=e.pendingLanes,4194090&n&&42&i?e===Jd?Yd++:(Yd=0,Jd=e):Yd=0,zf(0)}}function kf(e,t){0===(e.pooledCacheLanes&=t)&&null!=(t=e.pooledCache)&&(e.pooledCache=null,Zo(t))}function Af(e){return Sf(),Ef(),If(),Nf()}function Nf(){if(5!==Wd)return!1;var e=Vd,t=Kd;Kd=0;var n=Xn(qd),r=Qt.T,i=Zt.p;try{Zt.p=32>n?32:n,Qt.T=null,n=Xd,Xd=null;var a=Vd,o=qd;if(Wd=0,jd=Vd=null,qd=0,6&xd)throw Error(It(331));var s=xd;if(xd|=4,hd(a.current),sd(a,a.current,o,n),xd=s,zf(0),Pn&&"function"==typeof Pn.onPostCommitFiberRoot)try{Pn.onPostCommitFiberRoot(_n,a)}catch(l){}return!0}finally{Zt.p=i,Qt.T=r,kf(e,t)}}function Tf(e,t,n){t=za(n,t),null!==(e=Is(e,t=Dc(e.stateNode,t,2),2))&&(Vn(e,2),Df(e))}function _f(e,t,n){if(3===e.tag)Tf(e,e,n);else for(;null!==t;){if(3===t.tag){Tf(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof r.componentDidCatch&&(null===zd||!zd.has(r))){e=za(n,e),null!==(r=Is(t,n=zc(2),2))&&(Wc(n,r,t,e),Vn(r,2),Df(r));break}}t=t.return}}function Pf(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new wd;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(Td=!0,i.add(n),e=Bf.bind(null,e,t,n),t.then(e,e))}function Bf(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),e.pingedLanes|=e.suspendedLanes&n,e.warmLanes&=~n,vd===e&&(Ed&n)===n&&(4===Pd||3===Pd&&(62914560&Ed)===Ed&&300>xn()-$d?!(2&xd)&&lf(e,0):Od|=n,Fd===Ed&&(Fd=0)),Df(e)}function Cf(e,t){0===t&&(t=zn()),null!==(e=Ga(e,t))&&(Vn(e,t),Df(e))}function Of(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Cf(e,n)}function Lf(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:r=e.stateNode;break;case 22:r=e.stateNode._retryCache;break;default:throw Error(It(314))}null!==r&&r.delete(t),Cf(e,n)}var Ff=null,Rf=null,Uf=!1,Mf=!1,$f=!1,Hf=0;function Df(e){e!==Rf&&null===e.next&&(null===Rf?Ff=Rf=e:Rf=Rf.next=e),Mf=!0,Uf||(Uf=!0,Pp(function(){6&xd?gn(Sn,Wf):Vf()}))}function zf(e,t){if(!$f&&Mf){$f=!0;do{for(var n=!1,r=Ff;null!==r;){if(0!==e){var i=r.pendingLanes;if(0===i)var a=0;else{var o=r.suspendedLanes,s=r.pingedLanes;a=(1<<31-Cn(42|e)+1)-1,a=201326741&(a&=i&~(o&~s))?201326741&a|1:a?2|a:0}0!==a&&(n=!0,Kf(r,a))}else a=Ed,!(3&(a=Mn(r,r===vd?a:0,null!==r.cancelPendingCommit||-1!==r.timeoutHandle)))||$n(r,a)||(n=!0,Kf(r,a));r=r.next}}while(n);$f=!1}}function Wf(){Vf()}function Vf(){Mf=Uf=!1;var e,t=0;0!==Hf&&(((e=window.event)&&"popstate"===e.type?e!==Ap&&(Ap=e,!0):(Ap=null,!1))&&(t=Hf),Hf=0);for(var n=xn(),r=null,i=Ff;null!==i;){var a=i.next,o=jf(i,n);0===o?(i.next=null,null===r?Ff=a:r.next=a,null===a&&(Rf=r)):(r=i,(0!==t||3&o)&&(Mf=!0)),i=a}zf(t)}function jf(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,a=-62914561&e.pendingLanes;0<a;){var o=31-Cn(a),s=1<<o,l=i[o];-1===l?0!==(s&n)&&0===(s&r)||(i[o]=Hn(s,t)):l<=t&&(e.expiredLanes|=s),a&=~s}if(n=Ed,n=Mn(e,e===(t=vd)?n:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle),r=e.callbackNode,0===n||e===t&&(2===Id||9===Id)||null!==e.cancelPendingCommit)return null!==r&&null!==r&&yn(r),e.callbackNode=null,e.callbackPriority=0;if(!(3&n)||$n(e,n)){if((t=n&-n)===e.callbackPriority)return t;switch(null!==r&&yn(r),Xn(n)){case 2:case 8:n=En;break;case 32:default:n=In;break;case 268435456:n=An}return r=qf.bind(null,e),n=gn(n,r),e.callbackPriority=t,e.callbackNode=n,t}return null!==r&&null!==r&&yn(r),e.callbackPriority=2,e.callbackNode=null,2}function qf(e,t){if(0!==Wd&&5!==Wd)return e.callbackNode=null,e.callbackPriority=0,null;var n=e.callbackNode;if(Af()&&e.callbackNode!==n)return null;var r=Ed;return 0===(r=Mn(e,e===vd?r:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle))?null:(tf(e,r,t),jf(e,xn()),null!=e.callbackNode&&e.callbackNode===n?qf.bind(null,e):null)}function Kf(e,t){if(Af())return null;tf(e,t,!0)}function Xf(){return 0===Hf&&(Hf=Dn()),Hf}function Gf(e){return null==e||"symbol"==typeof e||"boolean"==typeof e?null:"function"==typeof e?e:Xr(""+e)}function Yf(e,t){var n=t.ownerDocument.createElement("input");return n.name=t.name,n.value=t.value,e.id&&n.setAttribute("form",e.id),t.parentNode.insertBefore(n,t),e=new FormData(e),n.parentNode.removeChild(n),e}for(var Jf=0;Jf<$a.length;Jf++){var Qf=$a[Jf];Ha(Qf.toLowerCase(),"on"+(Qf[0].toUpperCase()+Qf.slice(1)))}Ha(Ba,"onAnimationEnd"),Ha(Ca,"onAnimationIteration"),Ha(Oa,"onAnimationStart"),Ha("dblclick","onDoubleClick"),Ha("focusin","onFocus"),Ha("focusout","onBlur"),Ha(La,"onTransitionRun"),Ha(Fa,"onTransitionStart"),Ha(Ra,"onTransitionCancel"),Ha(Ua,"onTransitionEnd"),mr("onMouseEnter",["mouseout","mouseover"]),mr("onMouseLeave",["mouseout","mouseover"]),mr("onPointerEnter",["pointerout","pointerover"]),mr("onPointerLeave",["pointerout","pointerover"]),pr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),pr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),pr("onBeforeInput",["compositionend","keypress","textInput","paste"]),pr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),pr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),pr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Zf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ep=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Zf));function tp(e,t){t=!!(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var o=r.length-1;0<=o;o--){var s=r[o],l=s.instance,c=s.currentTarget;if(s=s.listener,l!==a&&i.isPropagationStopped())break e;a=s,i.currentTarget=c;try{a(i)}catch(Kh){Fc(Kh)}i.currentTarget=null,a=l}else for(o=0;o<r.length;o++){if(l=(s=r[o]).instance,c=s.currentTarget,s=s.listener,l!==a&&i.isPropagationStopped())break e;a=s,i.currentTarget=c;try{a(i)}catch(Kh){Fc(Kh)}i.currentTarget=null,a=l}}}}function np(e,t){var n=t[er];void 0===n&&(n=t[er]=new Set);var r=e+"__bubble";n.has(r)||(op(t,e,2,!1),n.add(r))}function rp(e,t,n){var r=0;t&&(r|=4),op(n,e,r,t)}var ip="_reactListening"+Math.random().toString(36).slice(2);function ap(e){if(!e[ip]){e[ip]=!0,dr.forEach(function(t){"selectionchange"!==t&&(ep.has(t)||rp(t,!1,e),rp(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[ip]||(t[ip]=!0,rp("selectionchange",!1,t))}}function op(e,t,n,r){switch(Tm(t)){case 2:var i=Sm;break;case 8:i=Em;break;default:i=Im}n=i.bind(null,t,n,e),i=void 0,!ii||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function sp(e,t,n,r,i){var a=r;if(!(1&t||2&t||null===r))e:for(;;){if(null===r)return;var o=r.tag;if(3===o||4===o){var s=r.stateNode.containerInfo;if(s===i)break;if(4===o)for(o=r.return;null!==o;){var l=o.tag;if((3===l||4===l)&&o.stateNode.containerInfo===i)return;o=o.return}for(;null!==s;){if(null===(o=or(s)))return;if(5===(l=o.tag)||6===l||26===l||27===l){r=a=o;continue e}s=s.parentNode}}r=r.return}ti(function(){var r=a,i=Yr(n),o=[];e:{var s=Ma.get(e);if(void 0!==s){var l=bi,c=e;switch(e){case"keypress":if(0===ui(n))break e;case"keydown":case"keyup":l=Oi;break;case"focusin":c="focus",l=Ii;break;case"focusout":c="blur",l=Ii;break;case"beforeblur":case"afterblur":l=Ii;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=Si;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=Ei;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Fi;break;case Ba:case Ca:case Oa:l=ki;break;case Ua:l=Ri;break;case"scroll":case"scrollend":l=xi;break;case"wheel":l=Ui;break;case"copy":case"cut":case"paste":l=Ai;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Li;break;case"toggle":case"beforetoggle":l=Mi}var u=!!(4&t),d=!u&&("scroll"===e||"scrollend"===e),f=u?null!==s?s+"Capture":null:s;u=[];for(var p,m=r;null!==m;){var h=m;if(p=h.stateNode,5!==(h=h.tag)&&26!==h&&27!==h||null===p||null===f||null!=(h=ni(m,f))&&u.push(lp(m,h,p)),d)break;m=m.return}0<u.length&&(s=new l(s,c,null,n,i),o.push({event:s,listeners:u}))}}if(!(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===Gr||!(c=n.relatedTarget||n.fromElement)||!or(c)&&!c[Zn])&&(l||s)&&(s=i.window===i?i:(s=i.ownerDocument)?s.defaultView||s.parentWindow:window,l?(l=r,null!==(c=(c=n.relatedTarget||n.toElement)?or(c):null)&&(d=At(c),u=c.tag,c!==d||5!==u&&27!==u&&6!==u)&&(c=null)):(l=null,c=r),l!==c)){if(u=Si,h="onMouseLeave",f="onMouseEnter",m="mouse","pointerout"!==e&&"pointerover"!==e||(u=Li,h="onPointerLeave",f="onPointerEnter",m="pointer"),d=null==l?s:lr(l),p=null==c?s:lr(c),(s=new u(h,m+"leave",l,n,i)).target=d,s.relatedTarget=p,h=null,or(i)===r&&((u=new u(f,m+"enter",c,n,i)).target=p,u.relatedTarget=d,h=u),d=h,l&&c)e:{for(f=c,m=0,p=u=l;p;p=up(p))m++;for(p=0,h=f;h;h=up(h))p++;for(;0<m-p;)u=up(u),m--;for(;0<p-m;)f=up(f),p--;for(;m--;){if(u===f||null!==f&&u===f.alternate)break e;u=up(u),f=up(f)}u=null}else u=null;null!==l&&dp(o,s,l,u,!1),null!==c&&null!==d&&dp(o,d,c,u,!0)}if("select"===(l=(s=r?lr(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===l&&"file"===s.type)var g=na;else if(Yi(s))if(ra)g=fa;else{g=ua;var y=ca}else!(l=s.nodeName)||"input"!==l.toLowerCase()||"checkbox"!==s.type&&"radio"!==s.type?r&&jr(r.elementType)&&(g=na):g=da;switch(g&&(g=g(e,r))?Ji(o,g,n,i):(y&&y(e,s,r),"focusout"===e&&r&&"number"===s.type&&null!=r.memoizedProps.value&&Ur(s,"number",s.value)),y=r?lr(r):window,e){case"focusin":(Yi(y)||"true"===y.contentEditable)&&(va=y,Sa=r,Ea=null);break;case"focusout":Ea=Sa=va=null;break;case"mousedown":Ia=!0;break;case"contextmenu":case"mouseup":case"dragend":Ia=!1,ka(o,n,i);break;case"selectionchange":if(xa)break;case"keydown":case"keyup":ka(o,n,i)}var b;if(Hi)e:{switch(e){case"compositionstart":var w="onCompositionStart";break e;case"compositionend":w="onCompositionEnd";break e;case"compositionupdate":w="onCompositionUpdate";break e}w=void 0}else Xi?qi(e,n)&&(w="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(w="onCompositionStart");w&&(Wi&&"ko"!==n.locale&&(Xi||"onCompositionStart"!==w?"onCompositionEnd"===w&&Xi&&(b=ci()):(si="value"in(oi=i)?oi.value:oi.textContent,Xi=!0)),0<(y=cp(r,w)).length&&(w=new Ni(w,e,null,n,i),o.push({event:w,listeners:y}),(b||null!==(b=Ki(n)))&&(w.data=b))),(b=zi?function(e,t){switch(e){case"compositionend":return Ki(t);case"keypress":return 32!==t.which?null:(ji=!0,Vi);case"textInput":return(e=t.data)===Vi&&ji?null:e;default:return null}}(e,n):function(e,t){if(Xi)return"compositionend"===e||!Hi&&qi(e,t)?(e=ci(),li=si=oi=null,Xi=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Wi&&"ko"!==t.locale?null:t.data}}(e,n))&&0<(w=cp(r,"onBeforeInput")).length&&(y=new Ni("onBeforeInput","beforeinput",null,n,i),o.push({event:y,listeners:w}),y.data=b),function(e,t,n,r,i){if("submit"===t&&n&&n.stateNode===i){var a=Gf((i[Qn]||null).action),o=r.submitter;o&&null!==(t=(t=o[Qn]||null)?Gf(t.formAction):o.getAttribute("formAction"))&&(a=t,o=null);var s=new bi("action","action",null,r,i);e.push({event:s,listeners:[{instance:null,listener:function(){if(r.defaultPrevented){if(0!==Hf){var e=o?Yf(i,o):new FormData(i);Gl(n,{pending:!0,data:e,method:i.method,action:a},null,e)}}else"function"==typeof a&&(s.preventDefault(),e=o?Yf(i,o):new FormData(i),Gl(n,{pending:!0,data:e,method:i.method,action:a},a,e))},currentTarget:i}]})}}(o,e,r,n,i)}tp(o,t)})}function lp(e,t,n){return{instance:e,listener:t,currentTarget:n}}function cp(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,a=i.stateNode;if(5!==(i=i.tag)&&26!==i&&27!==i||null===a||(null!=(i=ni(e,n))&&r.unshift(lp(e,i,a)),null!=(i=ni(e,t))&&r.push(lp(e,i,a))),3===e.tag)return r;e=e.return}return[]}function up(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag&&27!==e.tag);return e||null}function dp(e,t,n,r,i){for(var a=t._reactName,o=[];null!==n&&n!==r;){var s=n,l=s.alternate,c=s.stateNode;if(s=s.tag,null!==l&&l===r)break;5!==s&&26!==s&&27!==s||null===c||(l=c,i?null!=(c=ni(n,a))&&o.unshift(lp(n,c,l)):i||null!=(c=ni(n,a))&&o.push(lp(n,c,l))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}var fp=/\r\n?/g,pp=/\u0000|\uFFFD/g;function mp(e){return("string"==typeof e?e:""+e).replace(fp,"\n").replace(pp,"")}function hp(e,t){return t=mp(t),mp(e)===t}function gp(){}function yp(e,t,n,r,i,a){switch(n){case"children":"string"==typeof r?"body"===t||"textarea"===t&&""===r||Dr(e,r):("number"==typeof r||"bigint"==typeof r)&&"body"!==t&&Dr(e,""+r);break;case"className":vr(e,"class",r);break;case"tabIndex":vr(e,"tabindex",r);break;case"dir":case"role":case"viewBox":case"width":case"height":vr(e,n,r);break;case"style":Vr(e,r,a);break;case"data":if("object"!==t){vr(e,"data",r);break}case"src":case"href":if(""===r&&("a"!==t||"href"!==n)){e.removeAttribute(n);break}if(null==r||"function"==typeof r||"symbol"==typeof r||"boolean"==typeof r){e.removeAttribute(n);break}r=Xr(""+r),e.setAttribute(n,r);break;case"action":case"formAction":if("function"==typeof r){e.setAttribute(n,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"==typeof a&&("formAction"===n?("input"!==t&&yp(e,t,"name",i.name,i,null),yp(e,t,"formEncType",i.formEncType,i,null),yp(e,t,"formMethod",i.formMethod,i,null),yp(e,t,"formTarget",i.formTarget,i,null)):(yp(e,t,"encType",i.encType,i,null),yp(e,t,"method",i.method,i,null),yp(e,t,"target",i.target,i,null))),null==r||"symbol"==typeof r||"boolean"==typeof r){e.removeAttribute(n);break}r=Xr(""+r),e.setAttribute(n,r);break;case"onClick":null!=r&&(e.onclick=gp);break;case"onScroll":null!=r&&np("scroll",e);break;case"onScrollEnd":null!=r&&np("scrollend",e);break;case"dangerouslySetInnerHTML":if(null!=r){if("object"!=typeof r||!("__html"in r))throw Error(It(61));if(null!=(n=r.__html)){if(null!=i.children)throw Error(It(60));e.innerHTML=n}}break;case"multiple":e.multiple=r&&"function"!=typeof r&&"symbol"!=typeof r;break;case"muted":e.muted=r&&"function"!=typeof r&&"symbol"!=typeof r;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":break;case"xlinkHref":if(null==r||"function"==typeof r||"boolean"==typeof r||"symbol"==typeof r){e.removeAttribute("xlink:href");break}n=Xr(""+r),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=r&&"function"!=typeof r&&"symbol"!=typeof r?e.setAttribute(n,""+r):e.removeAttribute(n);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":r&&"function"!=typeof r&&"symbol"!=typeof r?e.setAttribute(n,""):e.removeAttribute(n);break;case"capture":case"download":!0===r?e.setAttribute(n,""):!1!==r&&null!=r&&"function"!=typeof r&&"symbol"!=typeof r?e.setAttribute(n,r):e.removeAttribute(n);break;case"cols":case"rows":case"size":case"span":null!=r&&"function"!=typeof r&&"symbol"!=typeof r&&!isNaN(r)&&1<=r?e.setAttribute(n,r):e.removeAttribute(n);break;case"rowSpan":case"start":null==r||"function"==typeof r||"symbol"==typeof r||isNaN(r)?e.removeAttribute(n):e.setAttribute(n,r);break;case"popover":np("beforetoggle",e),np("toggle",e),xr(e,"popover",r);break;case"xlinkActuate":Sr(e,"http://www.w3.org/1999/xlink","xlink:actuate",r);break;case"xlinkArcrole":Sr(e,"http://www.w3.org/1999/xlink","xlink:arcrole",r);break;case"xlinkRole":Sr(e,"http://www.w3.org/1999/xlink","xlink:role",r);break;case"xlinkShow":Sr(e,"http://www.w3.org/1999/xlink","xlink:show",r);break;case"xlinkTitle":Sr(e,"http://www.w3.org/1999/xlink","xlink:title",r);break;case"xlinkType":Sr(e,"http://www.w3.org/1999/xlink","xlink:type",r);break;case"xmlBase":Sr(e,"http://www.w3.org/XML/1998/namespace","xml:base",r);break;case"xmlLang":Sr(e,"http://www.w3.org/XML/1998/namespace","xml:lang",r);break;case"xmlSpace":Sr(e,"http://www.w3.org/XML/1998/namespace","xml:space",r);break;case"is":xr(e,"is",r);break;case"innerText":case"textContent":break;default:(!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])&&xr(e,n=qr.get(n)||n,r)}}function bp(e,t,n,r,i,a){switch(n){case"style":Vr(e,r,a);break;case"dangerouslySetInnerHTML":if(null!=r){if("object"!=typeof r||!("__html"in r))throw Error(It(61));if(null!=(n=r.__html)){if(null!=i.children)throw Error(It(60));e.innerHTML=n}}break;case"children":"string"==typeof r?Dr(e,r):("number"==typeof r||"bigint"==typeof r)&&Dr(e,""+r);break;case"onScroll":null!=r&&np("scroll",e);break;case"onScrollEnd":null!=r&&np("scrollend",e);break;case"onClick":null!=r&&(e.onclick=gp);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break;default:fr.hasOwnProperty(n)||("o"!==n[0]||"n"!==n[1]||(i=n.endsWith("Capture"),t=n.slice(2,i?n.length-7:void 0),"function"==typeof(a=null!=(a=e[Qn]||null)?a[n]:null)&&e.removeEventListener(t,a,i),"function"!=typeof r)?n in e?e[n]=r:!0===r?e.setAttribute(n,""):xr(e,n,r):("function"!=typeof a&&null!==a&&(n in e?e[n]=null:e.hasAttribute(n)&&e.removeAttribute(n)),e.addEventListener(t,r,i)))}}function wp(e,t,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":np("error",e),np("load",e);var r,i=!1,a=!1;for(r in n)if(n.hasOwnProperty(r)){var o=n[r];if(null!=o)switch(r){case"src":i=!0;break;case"srcSet":a=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(It(137,t));default:yp(e,t,r,o,n,null)}}return a&&yp(e,t,"srcSet",n.srcSet,n,null),void(i&&yp(e,t,"src",n.src,n,null));case"input":np("invalid",e);var s=r=o=a=null,l=null,c=null;for(i in n)if(n.hasOwnProperty(i)){var u=n[i];if(null!=u)switch(i){case"name":a=u;break;case"type":o=u;break;case"checked":l=u;break;case"defaultChecked":c=u;break;case"value":r=u;break;case"defaultValue":s=u;break;case"children":case"dangerouslySetInnerHTML":if(null!=u)throw Error(It(137,t));break;default:yp(e,t,i,u,n,null)}}return Rr(e,r,s,l,c,o,a,!1),void Pr(e);case"select":for(a in np("invalid",e),i=o=r=null,n)if(n.hasOwnProperty(a)&&null!=(s=n[a]))switch(a){case"value":r=s;break;case"defaultValue":o=s;break;case"multiple":i=s;default:yp(e,t,a,s,n,null)}return t=r,n=o,e.multiple=!!i,void(null!=t?Mr(e,!!i,t,!1):null!=n&&Mr(e,!!i,n,!0));case"textarea":for(o in np("invalid",e),r=a=i=null,n)if(n.hasOwnProperty(o)&&null!=(s=n[o]))switch(o){case"value":i=s;break;case"defaultValue":a=s;break;case"children":r=s;break;case"dangerouslySetInnerHTML":if(null!=s)throw Error(It(91));break;default:yp(e,t,o,s,n,null)}return Hr(e,i,a,r),void Pr(e);case"option":for(l in n)n.hasOwnProperty(l)&&null!=(i=n[l])&&("selected"===l?e.selected=i&&"function"!=typeof i&&"symbol"!=typeof i:yp(e,t,l,i,n,null));return;case"dialog":np("beforetoggle",e),np("toggle",e),np("cancel",e),np("close",e);break;case"iframe":case"object":np("load",e);break;case"video":case"audio":for(i=0;i<Zf.length;i++)np(Zf[i],e);break;case"image":np("error",e),np("load",e);break;case"details":np("toggle",e);break;case"embed":case"source":case"link":np("error",e),np("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(c in n)if(n.hasOwnProperty(c)&&null!=(i=n[c]))switch(c){case"children":case"dangerouslySetInnerHTML":throw Error(It(137,t));default:yp(e,t,c,i,n,null)}return;default:if(jr(t)){for(u in n)n.hasOwnProperty(u)&&void 0!==(i=n[u])&&bp(e,t,u,i,n,void 0);return}}for(s in n)n.hasOwnProperty(s)&&null!=(i=n[s])&&yp(e,t,s,i,n,null)}var xp=null,vp=null;function Sp(e){return 9===e.nodeType?e:e.ownerDocument}function Ep(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Ip(e,t){if(0===e)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return 1===e&&"foreignObject"===t?0:e}function kp(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"bigint"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var Ap=null,Np="function"==typeof setTimeout?setTimeout:void 0,Tp="function"==typeof clearTimeout?clearTimeout:void 0,_p="function"==typeof Promise?Promise:void 0,Pp="function"==typeof queueMicrotask?queueMicrotask:void 0!==_p?function(e){return _p.resolve(null).then(e).catch(Bp)}:Np;function Bp(e){setTimeout(function(){throw e})}function Cp(e){return"head"===e}function Op(e,t){var n=t,r=0,i=0;do{var a=n.nextSibling;if(e.removeChild(n),a&&8===a.nodeType)if("/$"===(n=a.data)){if(0<r&&8>r){n=r;var o=e.ownerDocument;if(1&n&&Hp(o.documentElement),2&n&&Hp(o.body),4&n)for(Hp(n=o.head),o=n.firstChild;o;){var s=o.nextSibling,l=o.nodeName;o[ir]||"SCRIPT"===l||"STYLE"===l||"LINK"===l&&"stylesheet"===o.rel.toLowerCase()||n.removeChild(o),o=s}}if(0===i)return e.removeChild(a),void qm(t);i--}else"$"===n||"$?"===n||"$!"===n?i++:r=n.charCodeAt(0)-48;else r=0;n=a}while(n);qm(t)}function Lp(e){var t=e.firstChild;for(t&&10===t.nodeType&&(t=t.nextSibling);t;){var n=t;switch(t=t.nextSibling,n.nodeName){case"HTML":case"HEAD":case"BODY":Lp(n),ar(n);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===n.rel.toLowerCase())continue}e.removeChild(n)}}function Fp(e){return"$!"===e.data||"$?"===e.data&&"complete"===e.ownerDocument.readyState}function Rp(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t||"F!"===t||"F"===t)break;if("/$"===t)return null}}return e}var Up=null;function Mp(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}function $p(e,t,n){switch(t=Sp(n),e){case"html":if(!(e=t.documentElement))throw Error(It(452));return e;case"head":if(!(e=t.head))throw Error(It(453));return e;case"body":if(!(e=t.body))throw Error(It(454));return e;default:throw Error(It(451))}}function Hp(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);ar(e)}var Dp=new Map,zp=new Set;function Wp(e){return"function"==typeof e.getRootNode?e.getRootNode():9===e.nodeType?e:e.ownerDocument}var Vp=Zt.d;Zt.d={f:function(){var e=Vp.f(),t=of();return e||t},r:function(e){var t=sr(e);null!==t&&5===t.tag&&"form"===t.type?Jl(t):Vp.r(e)},D:function(e){Vp.D(e),qp("dns-prefetch",e,null)},C:function(e,t){Vp.C(e,t),qp("preconnect",e,t)},L:function(e,t,n){Vp.L(e,t,n);var r=jp;if(r&&e&&t){var i='link[rel="preload"][as="'+Lr(t)+'"]';"image"===t&&n&&n.imageSrcSet?(i+='[imagesrcset="'+Lr(n.imageSrcSet)+'"]',"string"==typeof n.imageSizes&&(i+='[imagesizes="'+Lr(n.imageSizes)+'"]')):i+='[href="'+Lr(e)+'"]';var a=i;switch(t){case"style":a=Xp(e);break;case"script":a=Jp(e)}Dp.has(a)||(e=Pt({rel:"preload",href:"image"===t&&n&&n.imageSrcSet?void 0:e,as:t},n),Dp.set(a,e),null!==r.querySelector(i)||"style"===t&&r.querySelector(Gp(a))||"script"===t&&r.querySelector(Qp(a))||(wp(t=r.createElement("link"),"link",e),ur(t),r.head.appendChild(t)))}},m:function(e,t){Vp.m(e,t);var n=jp;if(n&&e){var r=t&&"string"==typeof t.as?t.as:"script",i='link[rel="modulepreload"][as="'+Lr(r)+'"][href="'+Lr(e)+'"]',a=i;switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":a=Jp(e)}if(!Dp.has(a)&&(e=Pt({rel:"modulepreload",href:e},t),Dp.set(a,e),null===n.querySelector(i))){switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(n.querySelector(Qp(a)))return}wp(r=n.createElement("link"),"link",e),ur(r),n.head.appendChild(r)}}},X:function(e,t){Vp.X(e,t);var n=jp;if(n&&e){var r=cr(n).hoistableScripts,i=Jp(e),a=r.get(i);a||((a=n.querySelector(Qp(i)))||(e=Pt({src:e,async:!0},t),(t=Dp.get(i))&&nm(e,t),ur(a=n.createElement("script")),wp(a,"link",e),n.head.appendChild(a)),a={type:"script",instance:a,count:1,state:null},r.set(i,a))}},S:function(e,t,n){Vp.S(e,t,n);var r=jp;if(r&&e){var i=cr(r).hoistableStyles,a=Xp(e);t=t||"default";var o=i.get(a);if(!o){var s={loading:0,preload:null};if(o=r.querySelector(Gp(a)))s.loading=5;else{e=Pt({rel:"stylesheet",href:e,"data-precedence":t},n),(n=Dp.get(a))&&tm(e,n);var l=o=r.createElement("link");ur(l),wp(l,"link",e),l._p=new Promise(function(e,t){l.onload=e,l.onerror=t}),l.addEventListener("load",function(){s.loading|=1}),l.addEventListener("error",function(){s.loading|=2}),s.loading|=4,em(o,t,r)}o={type:"stylesheet",instance:o,count:1,state:s},i.set(a,o)}}},M:function(e,t){Vp.M(e,t);var n=jp;if(n&&e){var r=cr(n).hoistableScripts,i=Jp(e),a=r.get(i);a||((a=n.querySelector(Qp(i)))||(e=Pt({src:e,async:!0,type:"module"},t),(t=Dp.get(i))&&nm(e,t),ur(a=n.createElement("script")),wp(a,"link",e),n.head.appendChild(a)),a={type:"script",instance:a,count:1,state:null},r.set(i,a))}}};var jp="undefined"==typeof document?null:document;function qp(e,t,n){var r=jp;if(r&&"string"==typeof t&&t){var i=Lr(t);i='link[rel="'+e+'"][href="'+i+'"]',"string"==typeof n&&(i+='[crossorigin="'+n+'"]'),zp.has(i)||(zp.add(i),e={rel:e,crossOrigin:n,href:t},null===r.querySelector(i)&&(wp(t=r.createElement("link"),"link",e),ur(t),r.head.appendChild(t)))}}function Kp(e,t,n,r){var i,a,o,s,l=(l=cn.current)?Wp(l):null;if(!l)throw Error(It(446));switch(e){case"meta":case"title":return null;case"style":return"string"==typeof n.precedence&&"string"==typeof n.href?(t=Xp(n.href),(r=(n=cr(l).hoistableStyles).get(t))||(r={type:"style",instance:null,count:0,state:null},n.set(t,r)),r):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===n.rel&&"string"==typeof n.href&&"string"==typeof n.precedence){e=Xp(n.href);var c=cr(l).hoistableStyles,u=c.get(e);if(u||(l=l.ownerDocument||l,u={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},c.set(e,u),(c=l.querySelector(Gp(e)))&&!c._p&&(u.instance=c,u.state.loading=5),Dp.has(e)||(n={rel:"preload",as:"style",href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},Dp.set(e,n),c||(i=l,a=e,o=n,s=u.state,i.querySelector('link[rel="preload"][as="style"]['+a+"]")?s.loading=1:(a=i.createElement("link"),s.preload=a,a.addEventListener("load",function(){return s.loading|=1}),a.addEventListener("error",function(){return s.loading|=2}),wp(a,"link",o),ur(a),i.head.appendChild(a))))),t&&null===r)throw Error(It(528,""));return u}if(t&&null!==r)throw Error(It(529,""));return null;case"script":return t=n.async,"string"==typeof(n=n.src)&&t&&"function"!=typeof t&&"symbol"!=typeof t?(t=Jp(n),(r=(n=cr(l).hoistableScripts).get(t))||(r={type:"script",instance:null,count:0,state:null},n.set(t,r)),r):{type:"void",instance:null,count:0,state:null};default:throw Error(It(444,e))}}function Xp(e){return'href="'+Lr(e)+'"'}function Gp(e){return'link[rel="stylesheet"]['+e+"]"}function Yp(e){return Pt({},e,{"data-precedence":e.precedence,precedence:null})}function Jp(e){return'[src="'+Lr(e)+'"]'}function Qp(e){return"script[async]"+e}function Zp(e,t,n){if(t.count++,null===t.instance)switch(t.type){case"style":var r=e.querySelector('style[data-href~="'+Lr(n.href)+'"]');if(r)return t.instance=r,ur(r),r;var i=Pt({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return ur(r=(e.ownerDocument||e).createElement("style")),wp(r,"style",i),em(r,n.precedence,e),t.instance=r;case"stylesheet":i=Xp(n.href);var a=e.querySelector(Gp(i));if(a)return t.state.loading|=4,t.instance=a,ur(a),a;r=Yp(n),(i=Dp.get(i))&&tm(r,i),ur(a=(e.ownerDocument||e).createElement("link"));var o=a;return o._p=new Promise(function(e,t){o.onload=e,o.onerror=t}),wp(a,"link",r),t.state.loading|=4,em(a,n.precedence,e),t.instance=a;case"script":return a=Jp(n.src),(i=e.querySelector(Qp(a)))?(t.instance=i,ur(i),i):(r=n,(i=Dp.get(a))&&nm(r=Pt({},n),i),ur(i=(e=e.ownerDocument||e).createElement("script")),wp(i,"link",r),e.head.appendChild(i),t.instance=i);case"void":return null;default:throw Error(It(443,t.type))}else"stylesheet"===t.type&&!(4&t.state.loading)&&(r=t.instance,t.state.loading|=4,em(r,n.precedence,e));return t.instance}function em(e,t,n){for(var r=n.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),i=r.length?r[r.length-1]:null,a=i,o=0;o<r.length;o++){var s=r[o];if(s.dataset.precedence===t)a=s;else if(a!==i)break}a?a.parentNode.insertBefore(e,a.nextSibling):(t=9===n.nodeType?n.head:n).insertBefore(e,t.firstChild)}function tm(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.title&&(e.title=t.title)}function nm(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.integrity&&(e.integrity=t.integrity)}var rm=null;function im(e,t,n){if(null===rm){var r=new Map,i=rm=new Map;i.set(n,r)}else(r=(i=rm).get(n))||(r=new Map,i.set(n,r));if(r.has(e))return r;for(r.set(e,null),n=n.getElementsByTagName(e),i=0;i<n.length;i++){var a=n[i];if(!(a[ir]||a[Jn]||"link"===e&&"stylesheet"===a.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==a.namespaceURI){var o=a.getAttribute(t)||"";o=e+o;var s=r.get(o);s?s.push(a):r.set(o,[a])}}return r}function am(e,t,n){(e=e.ownerDocument||e).head.insertBefore(n,"title"===t?e.querySelector("head > title"):null)}function om(e){return!!("stylesheet"!==e.type||3&e.state.loading)}var sm=null;function lm(){}function cm(){if(this.count--,0===this.count)if(this.stylesheets)dm(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}var um=null;function dm(e,t){e.stylesheets=null,null!==e.unsuspend&&(e.count++,um=new Map,t.forEach(fm,e),um=null,cm.call(e))}function fm(e,t){if(!(4&t.state.loading)){var n=um.get(e);if(n)var r=n.get(null);else{n=new Map,um.set(e,n);for(var i=e.querySelectorAll("link[data-precedence],style[data-precedence]"),a=0;a<i.length;a++){var o=i[a];"LINK"!==o.nodeName&&"not all"===o.getAttribute("media")||(n.set(o.dataset.precedence,o),r=o)}r&&n.set(null,r)}o=(i=t.instance).getAttribute("data-precedence"),(a=n.get(o)||r)===r&&n.set(null,i),n.set(o,i),this.count++,r=cm.bind(this),i.addEventListener("load",r),i.addEventListener("error",r),a?a.parentNode.insertBefore(i,a.nextSibling):(e=9===e.nodeType?e.head:e).insertBefore(i,e.firstChild),t.state.loading|=4}}var pm={$$typeof:$t,Provider:null,Consumer:null,_currentValue:en,_currentValue2:en,_threadCount:0};function mm(e,t,n,r,i,a,o,s){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Wn(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Wn(0),this.hiddenUpdates=Wn(null),this.identifierPrefix=r,this.onUncaughtError=i,this.onCaughtError=a,this.onRecoverableError=o,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=s,this.incompleteTransitions=new Map}function hm(e,t,n,r,i,a,o,s,l,c,u,d){return e=new mm(e,t,n,o,s,l,c,d),t=1,!0===a&&(t|=24),a=eo(3,null,null,t),e.current=a,a.stateNode=e,(t=Qo()).refCount++,e.pooledCache=t,t.refCount++,a.memoizedState={element:r,isDehydrated:n,cache:t},vs(a),e}function gm(e){return e?e=Qa:Qa}function ym(e,t,n,r,i,a){i=gm(i),null===r.context?r.context=i:r.pendingContext=i,(r=Es(t)).payload={element:n},null!==(a=void 0===a?null:a)&&(r.callback=a),null!==(n=Is(e,r,t))&&(ef(n,0,t),ks(n,e,t))}function bm(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function wm(e,t){bm(e,t),(e=e.alternate)&&bm(e,t)}function xm(e){if(13===e.tag){var t=Ga(e,67108864);null!==t&&ef(t,0,67108864),wm(e,67108864)}}var vm=!0;function Sm(e,t,n,r){var i=Qt.T;Qt.T=null;var a=Zt.p;try{Zt.p=2,Im(e,t,n,r)}finally{Zt.p=a,Qt.T=i}}function Em(e,t,n,r){var i=Qt.T;Qt.T=null;var a=Zt.p;try{Zt.p=8,Im(e,t,n,r)}finally{Zt.p=a,Qt.T=i}}function Im(e,t,n,r){if(vm){var i=km(r);if(null===i)sp(e,t,r,Am,n),Um(e,r);else if(function(e,t,n,r,i){switch(t){case"focusin":return Pm=Mm(Pm,e,t,n,r,i),!0;case"dragenter":return Bm=Mm(Bm,e,t,n,r,i),!0;case"mouseover":return Cm=Mm(Cm,e,t,n,r,i),!0;case"pointerover":var a=i.pointerId;return Om.set(a,Mm(Om.get(a)||null,e,t,n,r,i)),!0;case"gotpointercapture":return a=i.pointerId,Lm.set(a,Mm(Lm.get(a)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r))r.stopPropagation();else if(Um(e,r),4&t&&-1<Rm.indexOf(e)){for(;null!==i;){var a=sr(i);if(null!==a)switch(a.tag){case 3:if((a=a.stateNode).current.memoizedState.isDehydrated){var o=Un(a.pendingLanes);if(0!==o){var s=a;for(s.pendingLanes|=2,s.entangledLanes|=2;o;){var l=1<<31-Cn(o);s.entanglements[1]|=l,o&=~l}Df(a),!(6&xd)&&(Hd=xn()+500,zf(0))}}break;case 13:null!==(s=Ga(a,2))&&ef(s,0,2),of(),wm(a,2)}if(null===(a=km(r))&&sp(e,t,r,Am,n),a===i)break;i=a}null!==i&&r.stopPropagation()}else sp(e,t,r,null,n)}}function km(e){return Nm(e=Yr(e))}var Am=null;function Nm(e){if(Am=null,null!==(e=or(e))){var t=At(e);if(null===t)e=null;else{var n=t.tag;if(13===n){if(null!==(e=Nt(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return Am=e,null}function Tm(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(vn()){case Sn:return 2;case En:return 8;case In:case kn:return 32;case An:return 268435456;default:return 32}default:return 32}}var _m=!1,Pm=null,Bm=null,Cm=null,Om=new Map,Lm=new Map,Fm=[],Rm="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Um(e,t){switch(e){case"focusin":case"focusout":Pm=null;break;case"dragenter":case"dragleave":Bm=null;break;case"mouseover":case"mouseout":Cm=null;break;case"pointerover":case"pointerout":Om.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Lm.delete(t.pointerId)}}function Mm(e,t,n,r,i,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[i]},null!==t&&null!==(t=sr(t))&&xm(t),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function $m(e){var t=or(e.target);if(null!==t){var n=At(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Nt(n)))return e.blockedOn=t,void function(e){var t=Zt.p;try{return Zt.p=e,function(){if(13===n.tag){var e=Qd();e=Kn(e);var t=Ga(n,e);null!==t&&ef(t,0,e),wm(n,e)}}()}finally{Zt.p=t}}(e.priority)}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Hm(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=km(e.nativeEvent);if(null!==n)return null!==(t=sr(n))&&xm(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);Gr=r,n.target.dispatchEvent(r),Gr=null,t.shift()}return!0}function Dm(e,t,n){Hm(e)&&n.delete(t)}function zm(){_m=!1,null!==Pm&&Hm(Pm)&&(Pm=null),null!==Bm&&Hm(Bm)&&(Bm=null),null!==Cm&&Hm(Cm)&&(Cm=null),Om.forEach(Dm),Lm.forEach(Dm)}function Wm(e,t){e.blockedOn===t&&(e.blockedOn=null,_m||(_m=!0,vt.unstable_scheduleCallback(vt.unstable_NormalPriority,zm)))}var Vm=null;function jm(e){Vm!==e&&(Vm=e,vt.unstable_scheduleCallback(vt.unstable_NormalPriority,function(){Vm===e&&(Vm=null);for(var t=0;t<e.length;t+=3){var n=e[t],r=e[t+1],i=e[t+2];if("function"!=typeof r){if(null===Nm(r||n))continue;break}var a=sr(n);null!==a&&(e.splice(t,3),t-=3,Gl(a,{pending:!0,data:i,method:n.method,action:r},r,i))}}))}function qm(e){function t(t){return Wm(t,e)}null!==Pm&&Wm(Pm,e),null!==Bm&&Wm(Bm,e),null!==Cm&&Wm(Cm,e),Om.forEach(t),Lm.forEach(t);for(var n=0;n<Fm.length;n++){var r=Fm[n];r.blockedOn===e&&(r.blockedOn=null)}for(;0<Fm.length&&null===(n=Fm[0]).blockedOn;)$m(n),null===n.blockedOn&&Fm.shift();if(null!=(n=(e.ownerDocument||e).$$reactFormReplay))for(r=0;r<n.length;r+=3){var i=n[r],a=n[r+1],o=i[Qn]||null;if("function"==typeof a)o||jm(n);else if(o){var s=null;if(a&&a.hasAttribute("formAction")){if(i=a,o=a[Qn]||null)s=o.formAction;else if(null!==Nm(i))continue}else s=o.action;"function"==typeof s?n[r+1]=s:(n.splice(r,3),r-=3),jm(n)}}}function Km(e){this._internalRoot=e}function Xm(e){this._internalRoot=e}Xm.prototype.render=Km.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(It(409));ym(t.current,Qd(),e,t,null,null)},Xm.prototype.unmount=Km.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;ym(e.current,2,null,e,null,null),of(),t[Zn]=null}},Xm.prototype.unstable_scheduleHydration=function(e){if(e){var t=Gn();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Fm.length&&0!==t&&t<Fm[n].priority;n++);Fm.splice(n,0,e),0===n&&$m(e)}};var Gm=St.version;if("19.1.1"!==Gm)throw Error(It(527,Gm,"19.1.1"));Zt.findDOMNode=function(e){var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(It(188));throw e=Object.keys(e).join(","),Error(It(268,e))}return e=function(e){var t=e.alternate;if(!t){if(null===(t=At(e)))throw Error(It(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var a=i.alternate;if(null===a){if(null!==(r=i.return)){n=r;continue}break}if(i.child===a.child){for(a=i.child;a;){if(a===n)return Tt(i),e;if(a===r)return Tt(i),t;a=a.sibling}throw Error(It(188))}if(n.return!==r.return)n=i,r=a;else{for(var o=!1,s=i.child;s;){if(s===n){o=!0,n=i,r=a;break}if(s===r){o=!0,r=i,n=a;break}s=s.sibling}if(!o){for(s=a.child;s;){if(s===n){o=!0,n=a,r=i;break}if(s===r){o=!0,r=a,n=i;break}s=s.sibling}if(!o)throw Error(It(189))}}if(n.alternate!==r)throw Error(It(190))}if(3!==n.tag)throw Error(It(188));return n.stateNode.current===n?e:t}(t),null===(e=null!==e?_t(e):null)?null:e.stateNode};var Ym={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:Qt,reconcilerVersion:"19.1.1"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var Jm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Jm.isDisabled&&Jm.supportsFiber)try{_n=Jm.inject(Ym),Pn=Jm}catch(uC){}}ot.createRoot=function(e,t){if(!kt(e))throw Error(It(299));var n=!1,r="",i=Rc,a=Uc,o=Mc;return null!=t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onUncaughtError&&(i=t.onUncaughtError),void 0!==t.onCaughtError&&(a=t.onCaughtError),void 0!==t.onRecoverableError&&(o=t.onRecoverableError),void 0!==t.unstable_transitionCallbacks&&t.unstable_transitionCallbacks),t=hm(e,1,!1,null,0,n,r,i,a,o,0,null),e[Zn]=t.current,ap(e),new Km(t)},ot.hydrateRoot=function(e,t,n){if(!kt(e))throw Error(It(299));var r=!1,i="",a=Rc,o=Uc,s=Mc,l=null;return null!=n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(i=n.identifierPrefix),void 0!==n.onUncaughtError&&(a=n.onUncaughtError),void 0!==n.onCaughtError&&(o=n.onCaughtError),void 0!==n.onRecoverableError&&(s=n.onRecoverableError),void 0!==n.unstable_transitionCallbacks&&n.unstable_transitionCallbacks,void 0!==n.formState&&(l=n.formState)),(t=hm(e,1,!0,t,0,r,i,a,o,s,0,l)).context=gm(null),n=t.current,(i=Es(r=Kn(r=Qd()))).callback=null,Is(n,i,r),n=r,t.current.lanes=n,Vn(t,n),Df(t),e[Zn]=t.current,ap(e),new Xm(t)},ot.version="19.1.1",function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(uC){}}(),at.exports=ot;const Qm=ue(at.exports),Zm=(()=>{if("undefined"!=typeof window){const e=window.__NEXUS_ORDINALS_ORIGIN__;if("string"==typeof e)return e}return""})();(()=>{if("undefined"==typeof window)return!1;const e=window.location.hostname;"ordinals.com"===e||e.endsWith(".ordinals.com"),"localhost"===e&&window.location.search.includes("inscription=true")})();const eh=(e,t=Zm)=>("undefined"==typeof window||t&&""!==t||"string"!=typeof window.__NEXUS_ORDINALS_ORIGIN__||!window.__NEXUS_ORDINALS_ORIGIN__||(t=window.__NEXUS_ORDINALS_ORIGIN__),"string"==typeof e&&/^(https?:)?\/\//i.test(e)?e:`${t}${e.startsWith("/")?e:`/${e}`}`),th=e=>eh(e,Zm),nh=e=>eh(e,"https://mempool.space"),rh="/r/sat/404079598249183/at/-1/content",ih="btcapi";let ah=null;async function oh(){if(ah)return ah;const e=function(){try{if(import.meta?.env?.DEV)return!0}catch{}try{const e=window.location.hostname;return"localhost"===e||"127.0.0.1"===e||e.endsWith(".local")}catch{}return!1}()?[rh,ih]:[ih,rh];let t=null;for(const n of e)try{const e=await import(n);ah=e.default||e;break}catch(cC){t=cC}if(!ah)throw t||new Error("Failed to import btcapi");return ah._fallbackMode=!ah.isBitmapWalletInstalled(),ah}function sh(){return!(!ah||!1!==ah._fallbackMode)}function lh(){return!0===ah?._fallbackMode}async function ch(e,t="mainnet"){if(ah||await oh(),lh())return[];const n=[];for(const r of e){const e=await ah.getAddressUtxos(r,t);n.push(...e.map(e=>({...e,address:r})))}return n}function uh(e,t){const n=/\/inscription\/([a-f0-9]{64}i\d+)/g,r=[];let i;for(;null!==(i=n.exec(e));)r.push({id:i[1],address:t});return r}async function dh(e="mainnet"){return ah||await oh(),lh()?{fastestFee:25,halfHourFee:15,hourFee:10,economyFee:5,minimumFee:1}:ah.getFeeRates(e)}async function fh(e,t="mainnet"){if(ah||await oh(),lh())throw new Error("Bitmap Wallet required for broadcasting");return ah.broadcastTransaction(e,t)}function ph(){if("undefined"==typeof window)return!1;try{const e="__nexus_storage_test__";return window.sessionStorage.setItem(e,"1"),window.sessionStorage.removeItem(e),!0}catch{return!1}}function mh(){return!function(){if("undefined"==typeof window)return!1;try{if(window.top&&window.top!==window)return!0}catch{return!0}if(!ph())return!0;try{if(window.location&&"null"===window.location.origin)return!0}catch{return!0}try{const e=window.location?.protocol;if(e&&"https:"!==e&&"http:"!==e)return!0}catch{return!0}try{const e=window.frameElement;if(e&&e.getAttribute&&null!=e.getAttribute("sandbox"))return!0}catch{return!0}return!1}()}function hh(){return"undefined"!=typeof window&&void 0!==window.NexusBitcoinProxy&&"function"==typeof window.NexusBitcoinProxy.isEnabled&&window.NexusBitcoinProxy.isEnabled()}async function gh(e,t={}){const n=String(e||""),r=String(t?.method||"GET").toUpperCase(),i="GET"===r||"HEAD"===r,a=(e=>{const t=String(e||"");if(!t)return t;if(/^(https?:)?\/\//i.test(t))return t;if(!t.startsWith("/"))return t;try{const e=window?.location?.hostname||"",n="ordinals.com"===e||e.endsWith(".ordinals.com"),r="undefined"!=typeof window&&"string"==typeof window.__NEXUS_ORDINALS_ORIGIN__?window.__NEXUS_ORDINALS_ORIGIN__:null;return(n?window.location.origin:r&&r.length>0?r:"https://ordinals.com")+t}catch{return"https://ordinals.com"+t}})(n),o=e=>{const t=String(e||"").trim();if(!t)return null;if(t.startsWith("/"))return t;try{const e=new URL(t);if("ordinals.com"===e.hostname||e.hostname.endsWith(".ordinals.com"))return e.pathname+(e.search||"")}catch{}return null};try{const e=await oh();if(!lh())return await e.proxyFetch(a,t)}catch(Kh){}try{if(!mh()&&i&&hh()){const e=o(n)||o(a);if(e){const t=await window.NexusBitcoinProxy.fetchOrdinals(e),n=Number(t?.status),r=String(t?.contentType||"text/plain"),i="string"==typeof t?.text?t.text:"";return new Response(i,{status:Number.isFinite(n)?n:200,headers:{"Content-Type":r}})}}}catch(s){}try{return await fetch(a,t)}catch(l){try{if(i&&hh()){const e=o(n)||o(a);if(e){const t=await window.NexusBitcoinProxy.fetchOrdinals(e),n=Number(t?.status),r=String(t?.contentType||"text/plain"),i="string"==typeof t?.text?t.text:"";return new Response(i,{status:Number.isFinite(n)?n:200,headers:{"Content-Type":r}})}}}catch(c){}return await fetch(n,t)}}const yh=new Map,bh=new Map;function wh(e){const t=Number(e);if(Number.isFinite(t)&&!(t<=0))return Math.floor(t)}function xh(e){const t=e?.output||e?.satpoint||e?.location;if(!t||"string"!=typeof t)return;const n=t.split(":");if(n.length<2)return;const r=n[0],i=n[1];if(!/^[0-9a-f]{64}$/i.test(r))return;const a=Number(i);return!Number.isFinite(a)||a<0?void 0:`${r}:${Math.floor(a)}`}function vh(e){if(!e)return e;const t=e.split(":")[0];return t.match(/^[0-9a-f]{64}i\d+$/),t}async function Sh(e){const t=vh(e),n=th(`/r/inscription/${t}`),r=await gh(n);if(!r.ok)throw new Error(`Failed to fetch inscription: ${r.statusText}`);return await r.json()}async function Eh(e){const t=xh(await Sh(e));if(!t){const t=vh(e);throw new Error(`Cannot resolve outpoint for inscription ${t} from ordinals details`)}return t}async function Ih(e,t={}){const n=vh(e);if(!n)throw new Error("Missing inscriptionId");if(yh.has(n))return yh.get(n);const r=function(e,t){const n=vh(t);if(!Array.isArray(e)||0===e.length)return;let r=e.find(e=>vh(e?.id||e?.inscriptionId||e?.rawId)===n);if(r||(r=e.find(e=>Array.isArray(e?.sameSatIds)&&e.sameSatIds.includes(n))),!r)return;const i=Array.isArray(r.sameSatIds)&&r.sameSatIds.length>0?r.sameSatIds[0]:null;if(i&&vh(i)!==n){const t=e.find(e=>vh(e?.id||e?.inscriptionId||e?.rawId)===vh(i));if(t)return t}return r}(t.walletInscriptions,n);if(r){const e=wh(r?.utxo?.value),t=wh(r?.value),i=e??t;if(void 0!==i)return yh.set(n,i),i}if("undefined"!=typeof window&&window?.Bitcoin?.fetchInscriptionUtxo){const e=await window.Bitcoin.fetchInscriptionUtxo(n),t=wh(e?.value);if(void 0===t)throw new Error(`fetchInscriptionUtxo(${n}) returned invalid value: ${e?.value}`);return yh.set(n,t),t}const i=xh(await Sh(n));if(!i)throw new Error(`Cannot resolve outpoint for inscription ${n} from ordinals details`);const a=await async function(e){if(bh.has(e))return bh.get(e);const t=await gh(th(`/r/utxo/${e}`));if(!t.ok)throw new Error(`Failed to fetch /r/utxo/${e} (status ${t.status})`);const n=await t.json(),r=wh(n?.value);if(void 0===r)throw new Error(`Invalid /r/utxo value for ${e}: ${n?.value}`);return bh.set(e,r),r}(i);return yh.set(n,a),a}const kh=Object.freeze(Object.defineProperty({__proto__:null,getInscriptionDetails:Sh,getInscriptionOutpoint:Eh,resolveExactInscriptionUtxoValue:Ih,sanitizeInscriptionId:vh},Symbol.toStringTag,{value:"Module"}));function Ah(e){const t=[];for(let n=0;n<e.length;n+=2)t.push(parseInt(e.substr(n,2),16));return t}function Nh(e){try{if("undefined"!=typeof TextEncoder)return Array.from((new TextEncoder).encode(e))}catch{}const t=[];for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);if(r<128)t.push(r);else if(r<2048)t.push(192|r>>6),t.push(128|63&r);else if(r>=55296&&r<=56319){n++;const i=65536+((1023&r)<<10|1023&e.charCodeAt(n));t.push(240|i>>18),t.push(128|i>>12&63),t.push(128|i>>6&63),t.push(128|63&i)}else t.push(224|r>>12),t.push(128|r>>6&63),t.push(128|63&r)}return t}function Th(e,t){const n=e<<5;if(t<=23)return[n|t];if(t<=255)return[24|n,t];if(t<=65535)return[25|n,t>>8&255,255&t];if(t<=4294967295)return[26|n,t>>>24&255,t>>>16&255,t>>>8&255,255&t];throw new Error("Length too large for CBOR definite length")}function _h(e){const t=new ArrayBuffer(8);return new DataView(t).setFloat64(0,e,!1),Array.from(new Uint8Array(t))}function Ph(e){if(null==e)return[246];if(!0===e)return[245];if(!1===e)return[244];if(e instanceof Uint8Array)return[...Th(2,e.length),...Array.from(e)];if(Array.isArray(e)&&!0===e._cborBstr&&Array.isArray(e.bytes)){const t=e.bytes;return[...Th(2,t.length),...t]}if(Number.isInteger(e))return e>=0?Th(0,e):Th(1,-1-e);if("number"==typeof e)return[251,..._h(e)];if("string"==typeof e){const t=Nh(e);return[...Th(3,t.length),...t]}if(Array.isArray(e)){const t=e.map(Ph);return[...Th(4,e.length),...t.flat()]}if("object"==typeof e){if(e instanceof Map){const t=Array.from(e.entries());t.sort(([e],[t])=>{const n="number"==typeof e&&Number.isFinite(e),r="number"==typeof t&&Number.isFinite(t);return n&&r?e-t:n&&!r?-1:!n&&r?1:String(e).localeCompare(String(t))});const n=Th(5,t.length),r=[];for(const[e,i]of t)r.push(...Ph(e)),r.push(...Ph(i));return[...n,...r]}const t=Object.entries(e).map(([e,t])=>[/^\d+$/.test(e)?Number(e):e,t]);t.sort(([e],[t])=>{const n="number"==typeof e&&Number.isFinite(e),r="number"==typeof t&&Number.isFinite(t);return n&&r?e-t:n&&!r?-1:!n&&r?1:String(e).localeCompare(String(t))});const n=Th(5,t.length),r=[];for(const[e,i]of t)r.push(...Ph(e)),r.push(...Ph(i));return[...n,...r]}throw new Error("Unsupported CBOR type")}function Bh(e,t=520){const n=[];for(let r=0;r<e.length;r+=t)n.push(e.slice(r,r+t));return n}function Ch(e){const t=(e=>{if(null==e)return"";let t=String(e).trim();t=t.replace(/[\u200B-\u200D\uFEFF]/g,""),t=t.replace(/^["'\s]+|["'\s]+$/g,""),t=t.replace(/\s+/g,""),t=t.replace(/\)\s*\(/g,""),t=t.split("#")[0],t=t.split("?")[0];const n=t.split("/").filter(Boolean);return n.length>0&&(t.startsWith("http://")||t.startsWith("https://")||t.includes("/inscription/"))&&(t=n[n.length-1]),t.includes(":")&&(t=t.split(":")[0]),t=t.replace(/\(i\)/gi,"i"),t})(e),n=t.match(/^([0-9a-fA-F]{64})i(\d+)$/);if(!n)throw new Error(`Invalid inscription ID format. Expected <txid>i<index>. Got: ${t||"(empty)"}`);const r=n[1],i=n[2],a=function(e){const t=(e||"").toLowerCase();if(!/^[0-9a-f]+$/.test(t)||64!==t.length)throw new Error("Invalid TXID");return t.match(/.{2}/g).reverse().join("")}(r),o=function(e){if(0===e)return[];const t=new Uint8Array(4);t[0]=255&e,t[1]=e>>8&255,t[2]=e>>16&255,t[3]=e>>24&255;let n=4;for(;n>1&&0===t[n-1];)n--;return Array.from(t.slice(0,n))}(parseInt(i));return a+Array.from(o).map(e=>e.toString(16).padStart(2,"0")).join("")}const Oh=Ch,Lh={OP_0:0,OP_FALSE:0,OP_IF:99,OP_ENDIF:104,OP_1:81,OP_3:83,OP_5:85,OP_7:87,OP_11:91,OP_PUSHDATA1:76,OP_PUSHDATA2:77};function Fh(e){const t="string"==typeof e?Ah(e):e instanceof Uint8Array?Array.from(e):Array.isArray(e)?e:[],n=t.length;if(n<=75)return[n,...t];if(n<=255)return[Lh.OP_PUSHDATA1,n,...t];if(n<=65535)return[Lh.OP_PUSHDATA2,255&n,n>>8&255,...t];throw new Error("Data too large")}function Rh(e){if(!Number.isInteger(e)||e<0||e>255)throw new Error(`Invalid tag ${e}, must be 0..255`);return 0===e?[Lh.OP_0]:e>=1&&e<=16?[80+e]:Fh([e])}function Uh(e){const{content:t,contentType:n,parentId:r,parentIds:i,delegateId:a,metaprotocol:o,pointer:s,metadata:l,properties:c,contentEncoding:u,customTags:d={}}=e,f=[];f.push(Lh.OP_FALSE),f.push(Lh.OP_IF);const p=Array.from("ord").map(e=>e.charCodeAt(0).toString(16).padStart(2,"0")).join("");if(f.push(...Fh(p)),f.push(...Rh(1)),f.push(...Fh(Nh(n))),null!=s){f.push(...Rh(2));const e=function(e){if(null==e)return[];const t=parseInt(e);if(t<0||t>4294967295)throw new Error("Pointer must be between 0 and 4294967295");const n=[];let r=t;do{n.push(255&r),r>>>=8}while(r>0);return n}(s);f.push(...Fh(e))}let m=[];if(i&&Array.isArray(i)?m=i:r&&(m=Array.isArray(r)?r:[r]),m.forEach(e=>{if(e&&e.trim()){f.push(...Rh(3));const t=Oh(e.trim());f.push(...Fh(t))}}),l&&"object"==typeof l){const e=function(e){if(!e||"object"!=typeof e)return[];try{return Ph(e)}catch(cC){return[]}}(l);Bh(e,520).forEach(e=>{f.push(...Rh(5)),f.push(...Fh(e))})}if(o&&(f.push(...Rh(7)),f.push(...Fh(Nh(o)))),u&&(f.push(...Rh(9)),f.push(...Fh(Nh(u)))),a){f.push(...Rh(11));const e=Ch(a);f.push(...Fh(e))}if(c&&"object"==typeof c){const e=function(e){if(!e||"object"!=typeof e)return[];try{const t=e=>{if(!e||"string"!=typeof e)throw new Error("Gallery inscription ID must be a string like <txid>i<index>");const t=Ah(Ch(e.trim()));if(t.length<32||t.length>36)throw new Error(`Serialized inscription ID must be 32..36 bytes, got ${t.length}`);return new Uint8Array(t)},n=e=>{if(e instanceof Uint8Array)return e;if(Array.isArray(e))return e.map(e=>"string"==typeof e?{0:t(e)}:"object"==typeof e&&null!==e?n(e):e);if("object"==typeof e&&null!==e){const r=e[0]??e[0];if("string"==typeof r&&r.length>=64&&/^[a-f0-9]{64}i\d+$/i.test(r)){const i={...e};return i[0]=t(String(r)),delete i[0],n(i)}const i={};for(const[t,a]of Object.entries(e))i[/^\d+$/.test(t)?parseInt(t,10):t]="object"==typeof a&&null!==a?n(a):a;return i}return e},r=(e=>{try{if(e&&"object"==typeof e&&Array.isArray(e.gallery)){const n=e.gallery.filter(Boolean).map(e=>({0:t(String(e))})),r={...e};delete r.gallery;const i=r[0]??r[0];return Array.isArray(i)?(r[0]=[...i,...n],delete r[0]):r[0]=n,r}}catch(cC){}return e})(e);return Ph(n(r))}catch(cC){const t=cC&&cC.message?cC.message:String(cC);throw new Error(`Failed to serialize properties to CBOR: ${t}`)}}(c);Bh(e,520).forEach((e,t)=>{f.push(...Rh(17)),f.push(...Fh(e))})}if(f.push(...Rh(0)),!a){let e;const r=(g=t)?(e=>!!e&&(e instanceof ArrayBuffer||"[object ArrayBuffer]"===Object.prototype.toString.call(e)))(g)?new Uint8Array(g):"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(g)?new Uint8Array(g.buffer,g.byteOffset||0,g.byteLength||0):null:null;if(r)e=Array.from(r);else if("string"==typeof t){if(u&&(e=>{if("string"!=typeof e)return!1;const t=e.trim();return/^\[object (ArrayBuffer|Uint8Array|Uint8ClampedArray|Int8Array|Int16Array|Int32Array|Uint16Array|Uint32Array|Float32Array|Float64Array|BigInt64Array|BigUint64Array|DataView)\]$/.test(t)})(t))throw new Error("Invalid content: encoded payload is a stringified binary object. Re-upload the file (do not use the Text tab for .br/.gz).");if((h=n)&&(h.startsWith("text/")||h.includes("json")||h.includes("javascript")||h.includes("css")))e=Nh(t);else try{const n="undefined"!=typeof atob?atob(t):Buffer.from(t,"base64").toString("binary");e=Array.from(n).map(e=>e.charCodeAt(0))}catch(cC){e=Nh(t)}}else e=Nh(String(t??""));const i=520;for(let t=0;t<e.length;t+=i){const n=e.slice(t,t+i);f.push(...Fh(n))}}var h,g;return f.push(Lh.OP_ENDIF),f.map(e=>e.toString(16).padStart(2,"0")).join("")}function Mh(e){return Uh(e).length/2}function $h(e,t=null){return Uh({content:e,contentType:"text/plain;charset=utf-8",parentId:t})}function Hh(e,t=null){return Uh({content:JSON.stringify(e,null,2),contentType:"application/json",parentId:t})}function Dh(e,t=null){return Uh({content:e,contentType:"text/html;charset=utf-8",parentId:t})}function zh(e,t){e.length,t.parentId,t.delegateId,t.metaprotocol}"undefined"!=typeof window&&(window.NexusInscriptionUtils={createInscriptionScript:Uh,createTextInscription:$h,createJsonInscription:Hh,createHtmlInscription:Dh,calculateInscriptionSize:Mh,printInscriptionInfo:zh,serializeParentId:Oh,OP_CODES:Lh});const Wh=Object.freeze(Object.defineProperty({__proto__:null,OP_CODES:Lh,calculateInscriptionSize:Mh,createHtmlInscription:Dh,createInscriptionScript:Uh,createJsonInscription:Hh,createTextInscription:$h,printInscriptionInfo:zh,serializeParentId:Oh},Symbol.toStringTag,{value:"Module"})),Vh=new class{debug(...e){}warn(...e){}error(...e){}info(...e){}success(...e){}},{debug:jh,warn:qh,error:Kh,info:Xh,success:Gh}=Vh,Yh=th("/content/ce1f29db15be493a22c0e97ce19815f10273913706703120baa86fa44269af0fi0");let Jh=null;async function Qh(){if("undefined"==typeof window)throw new Error("Bitcoin initialization requires browser environment");if(!window.secp256k1)throw new Error("window.secp256k1 not found. Ensure index.html loads Noble secp256k1 first.\nExpected: window.secp256k1 (from frontend/components/secp256k1.bundle.mjs)");const e=await async function(){if("undefined"==typeof window)throw new Error("Bitcoin library requires browser environment");return window.BitcoinLib||window.bitcoin?window.BitcoinLib||window.bitcoin:(Jh||(Jh=(async()=>{Vh.debug("\ud83d\udce6 Loading bitcoinjs-lib from inscription..."),await import(Yh);const e=window.BitcoinLib||window.bitcoin;if(!e)throw new Error("Failed to load bitcoinjs-lib - window.BitcoinLib not set");return Vh.debug("\u2705 bitcoinjs-lib loaded"),e})()),Jh)}();return window.__bitcoinInitialized||(Vh.debug("\ud83d\udd27 Initializing bitcoinjs-lib with Noble secp256k1..."),Vh.debug("   Available Noble exports:",Object.keys(window.secp256k1)),e.initEccLib({isPoint:e=>{try{const t=e instanceof Uint8Array?Buffer.from(e).toString("hex"):e;return window.secp256k1.Point.fromHex(t),!0}catch{return!1}},isPrivate:e=>e instanceof Uint8Array&&32===e.length&&window.secp256k1.utils.isValidSecretKey(e),isXOnlyPoint:e=>{if(!(e instanceof Uint8Array)||32!==e.length)return!1;try{return window.secp256k1.Point.fromHex("02"+Buffer.from(e).toString("hex")),!0}catch{return!1}},pointFromScalar:(e,t=!0)=>window.secp256k1.getPublicKey(e,t),xOnlyPointAddTweak:(e,t)=>{try{const n=Buffer.from(e).toString("hex"),r=Buffer.from(t).toString("hex"),i=window.secp256k1.Point.fromHex("02"+n),a=BigInt("0x"+r),o=window.secp256k1.Point.BASE.multiply(a),s=i.add(o);if(s.equals(window.secp256k1.Point.ZERO))return null;const{x:l,y:c}=s.toAffine(),u=window.secp256k1.etc.numberToBytesBE(l,32);return{parity:Number(1n&c),xOnlyPubkey:Uint8Array.from(u)}}catch(cC){return Vh.error("\u274c xOnlyPointAddTweak error:",cC),Vh.error("   Stack:",cC.stack),null}},sign:(e,t)=>window.secp256k1.sign(e,t).toCompactRawBytes(),signSchnorr:(e,t,n)=>window.secp256k1.schnorr.sign(e,t,n),verify:(e,t,n)=>{try{return window.secp256k1.verify(n,e,t)}catch{return!1}},verifySchnorr:(e,t,n)=>{try{return window.secp256k1.schnorr.verify(n,e,t)}catch{return!1}},pointAddScalar:(e,t,n)=>{const r=e instanceof Uint8Array?Buffer.from(e).toString("hex"):e,i=window.secp256k1.Point.fromHex(r),a=BigInt("0x"+Buffer.from(t).toString("hex")),o=window.secp256k1.Point.BASE.multiply(a);return i.add(o).toRawBytes(n)},privateAdd:(e,t)=>{const n=BigInt("0x"+Buffer.from(e).toString("hex")),r=BigInt("0x"+Buffer.from(t).toString("hex")),i=window.secp256k1.etc.mod(n+r,window.secp256k1.Point.CURVE().n);return window.secp256k1.etc.numberToBytesBE(i,32)}}),window.__bitcoinInitialized=!0,Vh.debug("\u2705 bitcoinjs-lib initialized with Noble secp256k1")),e}const Zh="__nexusBufferReady";let eg=null;function tg(e){const t=e.concat;e.concat=function(n,r){const i=n.map((t,n)=>{if(e.isBuffer(t)&&"Buffer"===t.constructor.name)return t;if(t instanceof Promise)throw new Error(`Buffer.concat called with unresolved Promise at index ${n}`);return t instanceof Uint8Array?e.from(t.buffer,t.byteOffset,t.byteLength):e.isBuffer(t)?t.buffer&&void 0!==t.byteOffset&&void 0!==t.byteLength?e.from(t.buffer,t.byteOffset,t.byteLength):e.from(Uint8Array.from(t)):e.from(t)});return t.call(this,i,r)},Vh.debug("\u2705 Patched Buffer.concat for safe Uint8Array handling")}function ng(){if("undefined"==typeof window)return Promise.reject(new Error("Buffer polyfill is browser-only"));const e="undefined"!=typeof globalThis?globalThis:window;return e.Buffer?(e[Zh]||(e[Zh]=!0,e.global||(e.global=e),tg(e.Buffer)),Promise.resolve(e.Buffer)):(eg||(eg=(async()=>{const t=await n(()=>Promise.resolve().then(()=>Se),__VITE_PRELOAD__),r=t?.Buffer||t?.default?.Buffer;if(!r)throw new Error("Buffer polyfill not found in imported module");return e.Buffer||(e.Buffer=r),e.global||(e.global=e),e[Zh]=!0,tg(e.Buffer),e.Buffer})().catch(e=>{throw eg=null,e})),eg)}function rg(e,t){if(Buffer.isBuffer(e)&&"Buffer"===e.constructor.name)return e;if(e instanceof Uint8Array)return Buffer.from(e.buffer,e.byteOffset,e.byteLength);if(ArrayBuffer.isView(e))return Buffer.from(e.buffer,e.byteOffset,e.byteLength);if(e instanceof ArrayBuffer)return Buffer.from(e);if("string"==typeof e){const t=e.startsWith("0x")?e.slice(2):e;return Buffer.from(t,"hex")}if("Buffer"===e?.type&&Array.isArray(e.data))return Buffer.from(e.data);throw new Error(`Expected Buffer-like value for ${t||"parameter"}, got ${typeof e}`)}function ig(){if("undefined"==typeof window)return;const e=window.BitcoinLib||window.bitcoin;return e&&(window.BitcoinLib||(window.BitcoinLib=e),window.bitcoin||(window.bitcoin=e),void 0===window.Buffer&&e.Buffer&&(window.Buffer=e.Buffer)),window.BitcoinLib}const ag=Object.freeze(Object.defineProperty({__proto__:null,ensureBufferPolyfill:ng,ensureProperBuffer:rg,patchBufferConcat:tg,resolveBitcoinGlobal:ig},Symbol.toStringTag,{value:"Module"}));function og(e){if(e<253)return Buffer.from([e]);if(e<=65535)return Buffer.from([253,255&e,e>>8&255]);if(e<=4294967295)return Buffer.from([254,255&e,e>>8&255,e>>16&255,e>>24&255]);const t=Buffer.allocUnsafe(9);return t[0]=255,t.writeBigUInt64LE(BigInt(e),1),t}function sg(e){let t=0;e.forEach(e=>{const n=e.length;t+=n<253?1:n<=65535?3:n<=4294967295?5:9,t+=n});const n=e.length;t+=n<253?1:n<=65535?3:n<=4294967295?5:9;const r=Buffer.allocUnsafe(t);let i=0;const a=og(n);return a.copy(r,i),i+=a.length,e.forEach(e=>{const t=og(e.length);t.copy(r,i),i+=t.length,e.copy(r,i),i+=e.length}),r}function lg(e,t,n=192){const r=rg(t,"tapleaf script");return function(e,t,n){const r=e.sha256(Buffer.from("TapLeaf","utf8"));return e.sha256(Buffer.concat([r,r,n]))}(e,0,Buffer.concat([Buffer.from([n]),og(r.length),r]))}function cg(e,t="mainnet"){switch(t){case"testnet":return e.networks?.testnet||e.networks?.bitcoin;case"regtest":return e.networks?.regtest||e.networks?.testnet||e.networks?.bitcoin;default:return e.networks?.bitcoin||e.networks?.mainnet}}function ug(e,t,n){try{return e.address.toOutputScript(t,n)}catch(cC){throw new Error(`Invalid Bitcoin address "${t}": ${cC.message}`)}}th("/r/sat/1550501128240727/at/-1/content"),th("/r/sat/1550501128239335/at/-1/content");const dg=th("/content/ce1f29db15be493a22c0e97ce19815f10273913706703120baa86fa44269af0fi0"),fg="nexus-lib-cache-v1";async function pg(e){try{if("undefined"==typeof caches||!caches?.open)return null;const t=await caches.open(fg),n=await t.match(e);return n&&n.ok?await n.arrayBuffer():null}catch{return null}}async function mg(e,t){try{if("undefined"==typeof caches||!caches?.open)return!1;const n=await caches.open(fg),r=new Response(t,{headers:{"content-type":"text/javascript","x-nexus-cached-at":(new Date).toISOString()}});return await n.put(e,r),!0}catch{return!1}}let hg=null;async function gg(){if("undefined"==typeof window)throw new Error("loadBitcoinLibFromInscription: Browser environment required");hg||(hg=(async()=>{const e=ig();return e?(await ng(),await Qh(),e):(await ng(),window.secp256k1||Vh.warn("\u26a0\ufe0f window.secp256k1 not found! Ensure index.html loads Noble secp256k1 correctly."),ig()?(await Qh(),window.BitcoinLib):new Promise((e,t)=>{const n=document.createElement("script"),r=function(){const e="undefined"!=typeof window?window.__NEXUS_LIB_PINS__:null,t=e?.bitcoinjs||e?.bitcoinLib||null;if(!t)return null;const n=t?.url?String(t.url).trim():"",r=function(e){const t=null==e?"":String(e).trim().toLowerCase();return/^[0-9a-f]{64}$/.test(t)?t:null}(t?.sha256||t?.sha256Hex||t?.hash);return n&&r?{url:n,sha256Hex:r}:null}(),i=r?.url?r.url:dg;!r&&String(i).includes("/at/-1/")&&Vh.warn("\u26a0\ufe0f bitcoinjs-lib is being loaded from a mutable /at/-1 URL without an integrity pin. This is unsafe for production.");const a=e=>{const t=new Blob([String(e)],{type:"text/javascript"}),r=URL.createObjectURL(t);n.src=r,n.dataset.nexusBlobUrl=r};(async()=>{try{const e="undefined"!=typeof navigator&&!1===navigator.onLine;if(r){const e=await fetch(i,{cache:"no-store"});if(!e.ok)throw new Error(`Failed to fetch pinned bitcoinjs-lib (status ${e.status})`);const t=await e.arrayBuffer(),n=await async function(e){const t=e instanceof ArrayBuffer?e:e?.buffer||null;if(!t)throw new Error("sha256Hex: missing bytes");const n="undefined"!=typeof globalThis&&globalThis.crypto?globalThis.crypto:null;if(n?.subtle?.digest){const e=await n.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(e)).map(e=>e.toString(16).padStart(2,"0")).join("")}throw new Error("sha256Hex: WebCrypto not available")}(t);if(n.toLowerCase()!==r.sha256Hex.toLowerCase())throw new Error("LIB_INTEGRITY_FAIL: bitcoinjs-lib sha256 mismatch");await mg(i,t);const o=new TextDecoder("utf-8").decode(t);a(o)}else{if(e){const e=await pg(i);if(e){const t=new TextDecoder("utf-8").decode(e);return void a(t)}}let t=null;try{const e=await fetch(i,{cache:"force-cache"});e.ok&&(t=await e.arrayBuffer(),await mg(i,t))}catch{t=null}if(!t){const e=await pg(i);e&&(t=e)}if(t){const e=new TextDecoder("utf-8").decode(t);a(e)}else n.src=`${i}${String(i).includes("?")?"&":"?"}t=${Date.now()}`}}catch(cC){t(cC)}})(),n.async=!0,n.onload=async()=>{try{const e=n.dataset.nexusBlobUrl;e&&URL.revokeObjectURL(e)}catch{}const r=ig();if(!r)return n.remove(),hg=null,void t(new Error("bitcoinlib global not found after script load"));try{await Qh(),e(r)}catch(Kh){n.remove(),hg=null,t(Kh)}},n.onerror=()=>{try{const e=n.dataset.nexusBlobUrl;e&&URL.revokeObjectURL(e)}catch{}n.remove(),hg=null,t(new Error("Failed to load bitcoinlib.js from inscription"))},document.head.appendChild(n)}))})());const e=ig();if(e)return e;const t=await hg;if(!t||!t.script||!t.opcodes)throw hg=null,new Error("bitcoinjs-lib loaded but is missing expected properties (script, opcodes). The library may have failed to initialize. Check network connectivity to ordinals.com.");return t}const yg=Object.freeze(Object.defineProperty({__proto__:null,loadBitcoinLib:async function(){return gg()},loadBitcoinLibFromInscription:gg},Symbol.toStringTag,{value:"Module"})),bg="nexus_inscription_local_keypair";let wg=null;async function xg(){if(wg)return wg;if(!window.secp256k1)throw new Error("window.secp256k1 not found - ensure Noble secp256k1 is loaded in index.html");const e=window.secp256k1,t=!("undefined"==typeof globalThis||!0!==globalThis.__NEXUS_PERSIST_INSCRIPTION_KEYPAIR__)||!1;if(!t)try{localStorage.removeItem(bg)}catch(l){}if(t){const t=(()=>{try{return localStorage.getItem(bg)}catch{return null}})();if(t)try{const{privateKeyHex:n}=JSON.parse(t),r=Buffer.from(n,"hex");if(32!==r.length)throw new Error("Stored private key has invalid length");if(!e.utils.isValidSecretKey(r))throw new Error("Stored private key is out of valid range");const i=e.getPublicKey(r,!0);if(!i)throw new Error("Failed to derive public key from stored private key");const a=Buffer.from(i),o=a.slice(1,33),s={privateKey:r,publicKey:a,xOnlyPubKey:o};return wg=s,s}catch(cC){Vh.warn("\u26a0\ufe0f Stored inscription keypair is invalid, generating new one:",cC.message)}}let n;const r="undefined"!=typeof globalThis&&globalThis.crypto?globalThis.crypto:null;if(!r?.getRandomValues)throw new Error("Secure randomness unavailable (globalThis.crypto.getRandomValues missing)");for(let c=0;c<16;c++){const t=Buffer.from(r.getRandomValues(new Uint8Array(32)));if(32===t.length&&e.utils.isValidSecretKey(t)){n=t;break}}if(!n)throw new Error("Failed to generate a valid private key after 16 attempts");const i=e.getPublicKey(n,!0);if(!i)throw new Error("Failed to derive public key from generated private key");const a=Buffer.from(i),o=a.slice(1,33),s={privateKey:n,publicKey:a,xOnlyPubKey:o};if(wg=s,t)try{localStorage.setItem(bg,JSON.stringify({privateKeyHex:n.toString("hex"),publicKeyHex:a.toString("hex"),xOnlyPubKeyHex:o.toString("hex")}))}catch(cC){Vh.warn("\u26a0\ufe0f Unable to store inscription keypair in localStorage:",cC.message)}return s}async function vg(e,t,n,r,i){if(!window.secp256k1)throw new Error("window.secp256k1 not found - ensure Noble secp256k1 is loaded in index.html");const a=window.secp256k1,o=(()=>{try{return!(!globalThis||!globalThis.__INSCRIBE_DEBUG_SIGNING__)}catch{return!1}})();let s;try{if(Buffer.isBuffer(r))s=Buffer.from(r);else if(r instanceof Uint8Array)s=Buffer.from(r.buffer,r.byteOffset,r.byteLength);else if("string"==typeof r){const e=r.startsWith("0x")?r.slice(2):r;s=Buffer.from(e,"hex")}else s="Buffer"===r?.type&&Array.isArray(r.data)?Buffer.from(r.data):Buffer.from(r)}catch(u){throw new Error("Invalid inscription private key material - unable to convert to Buffer")}if(32!==s.length||!a.utils.isValidSecretKey(s))throw Vh.warn("\u26a0\ufe0f Local inscription key invalid length/range",{length:s.length}),new Error("Invalid inscription private key; try clearing local inscription keypair and retry");const l=Buffer.from(a.getPublicKey(s,!0)).slice(1,33),c={publicKey:l,signSchnorr:e=>{const t=e instanceof Uint8Array?e:new Uint8Array(Buffer.from(e)),n=new Uint8Array(32);n.set(t.subarray(0,32));const r=a.schnorr.sign(n,Buffer.from(s)),i=Buffer.isBuffer(r)?r:Buffer.from(r);try{const e=a.schnorr.verify(i,n,l);o&&Vh.debug("\ud83d\udd10 Local Schnorr signature verification",{verified:!!e}),e||Vh.warn("\u26a0\ufe0f Local Schnorr verification failed \u2014 signature will likely be rejected on-chain")}catch(cC){Vh.warn("\u26a0\ufe0f Local Schnorr verification check threw:",cC?.message)}return i}};"function"==typeof t.signTapleafInput?await t.signTapleafInput(n,c,rg(i,"tapLeafHash")):await t.signInput(n,c)}async function Sg(e,t,n){if(!e||!e.script||!e.opcodes)throw new Error("bitcoinLib not loaded \u2014 script.compile/decompile unavailable. Ensure loadBitcoinLibFromInscription() resolved before calling buildTaprootArtifacts.");const{xOnlyPubKey:r,privateKey:i}=await xg();if(!globalThis||globalThis.__INSCRIBE_DEBUG_TAPROOT__,!window.secp256k1)throw new Error("window.secp256k1 not found");const a=window.secp256k1;function o(){for(let e=0;e<16;e++){const e=Buffer.from(crypto.getRandomValues(new Uint8Array(32)));if(a.utils.isValidSecretKey(e))return e}throw new Error("Failed to generate internal private key")}let s=o(),l=a.getPublicKey(s,!0);if(!l)throw new Error("Failed to derive internal pubkey");let c=Buffer.from(l).slice(1,33);c.equals(r)&&(s=o(),l=a.getPublicKey(s,!0),c=Buffer.from(l).slice(1,33));const u=rg(t,"inscriptionScript"),d=e.script.decompile(u);if(!d)throw new Error("Failed to decompile inscription script");const f=e.script.compile([r,e.opcodes.OP_CHECKSIG,...d]),p={output:f,redeemVersion:192},m=e.payments.p2tr({internalPubkey:c,scriptTree:p,redeem:p,network:n});if(!m?.address)throw new Error("Failed to derive p2tr address");const h=m.witness?.[m.witness.length-1];if(!h)throw new Error("No control block");const g=lg(e.crypto,f,192);return{local:{privateKey:i,xOnlyPubKey:r},witnessScript:f,controlBlock:h,taprootPayment:m,leafVersion:192,leafHash:g,tapLeafHashHex:g.toString("hex")}}async function Eg(e,t){if(!e||!e.script||!e.opcodes)throw new Error("bitcoinLib not loaded \u2014 script.compile unavailable. Ensure loadBitcoinLibFromInscription() resolved before calling buildTaprootFeePoolArtifacts.");const{xOnlyPubKey:n,privateKey:r}=await xg();if(!window.secp256k1)throw new Error("window.secp256k1 not found");const i=window.secp256k1;function a(){for(let e=0;e<16;e++){const e=Buffer.from(crypto.getRandomValues(new Uint8Array(32)));if(i.utils.isValidSecretKey(e))return e}throw new Error("Failed to generate internal private key")}let o=a(),s=i.getPublicKey(o,!0);if(!s)throw new Error("Failed to derive internal pubkey");let l=Buffer.from(s).slice(1,33);l.equals(n)&&(o=a(),s=i.getPublicKey(o,!0),l=Buffer.from(s).slice(1,33));const c=e.script.compile([n,e.opcodes.OP_CHECKSIG]),u={output:c,redeemVersion:192},d=e.payments.p2tr({internalPubkey:l,scriptTree:u,redeem:u,network:t});if(!d?.address)throw new Error("Failed to derive fee-pool p2tr address");const f=d.witness?.[d.witness.length-1];if(!f)throw new Error("No control block for fee-pool");const p=lg(e.crypto,c,192);return{local:{privateKey:r,xOnlyPubKey:n},witnessScript:c,controlBlock:f,taprootPayment:d,leafVersion:192,leafHash:p,tapLeafHashHex:p.toString("hex")}}async function Ig(e,t,n){if(!e||!e.script||!e.opcodes)throw new Error("bitcoinLib not loaded \u2014 script.compile/decompile unavailable. Ensure loadBitcoinLibFromInscription() resolved before calling buildSharedTaprootArtifacts.");if(!Array.isArray(t)||0===t.length)throw new Error("buildSharedTaprootArtifacts: inscriptionScripts array required");const{xOnlyPubKey:r,privateKey:i}=await xg();if(!window.secp256k1)throw new Error("window.secp256k1 not found");const a=window.secp256k1;function o(){for(let e=0;e<16;e++){const e=Buffer.from(crypto.getRandomValues(new Uint8Array(32)));if(a.utils.isValidSecretKey(e))return e}throw new Error("Failed to generate internal private key")}let s=o(),l=a.getPublicKey(s,!0),c=Buffer.from(l).slice(1,33);c.equals(r)&&(s=o(),l=a.getPublicKey(s,!0),c=Buffer.from(l).slice(1,33));const u=[];t.forEach((t,n)=>{const r=rg(t,`sharedOutput.inscriptionScript[${n}]`),i=e.script.decompile(r);if(!i)throw new Error(`Failed to decompile inscription script at index ${n}`);u.push(...i)});const d=e.script.compile([r,e.opcodes.OP_CHECKSIG,...u]),f={output:d,redeemVersion:192},p=e.payments.p2tr({internalPubkey:c,scriptTree:f,redeem:f,network:n});if(!p?.address)throw new Error("Failed to derive shared-output p2tr address");const m=p.witness?.[p.witness.length-1];if(!m)throw new Error("No control block for shared-output");const h=lg(e.crypto,d,192);return{local:{privateKey:i,xOnlyPubKey:r},witnessScript:d,controlBlock:m,taprootPayment:p,leafVersion:192,leafHash:h,tapLeafHashHex:h.toString("hex"),compositeCount:t.length}}function kg(e,t){const n=t.tapKeySig||t.partialSig&&t.partialSig[0]?.signature;if(!n)throw new Error("Missing key-path signature");return{finalScriptWitness:sg([n])}}function Ag(e,t){if(!t.partialSig||0===t.partialSig.length)throw new Error("Missing partial signature for P2WPKH input");const{pubkey:n,signature:r}=t.partialSig[0];if(!n||!r)throw new Error("Missing pubkey or signature in partialSig");const i={finalScriptWitness:sg([r,n])};if(t.redeemScript){const e=t.redeemScript.length;i.finalScriptSig=Buffer.concat([Buffer.from([e]),t.redeemScript])}return i}function Ng(e,t){const n=t.tapLeafScript&&t.tapLeafScript[0];if(!n)throw new Error("Missing tapLeafScript");const r=[];if(t.tapScriptSig&&t.tapScriptSig.length>0)for(const a of t.tapScriptSig)r.push(a.signature);if(0===r.length)throw new Error("Missing tapscript signature");const i=Array.isArray(t.extraWitnessStack)?t.extraWitnessStack.filter(e=>Buffer.isBuffer(e)):[];return{finalScriptWitness:sg([...r,...i,n.script,n.controlBlock])}}function Tg(e){return e<253?1:e<=65535?3:e<=4294967295?5:9}function _g(e,t,n=!0,r=0,i={}){const{isReveal:a=!1,parentCount:o=0,targetCount:s=0,inscriptionCount:l=1,reinscription:c=!1,parentSigIncludesSighash:u=!0,inscriptionSigIncludesSighash:d=!1,controlBlockLen:f=33,parentInputType:p="p2wpkh",inputTypes:m=null,outputType:h="p2tr",outputTypes:g=null}=i;let y=10,b=0;n&&(y+=2);for(let x=0;x<e;x++){let e=0;const t=!a&&Array.isArray(m)?m[x]:null;if("p2sh-p2wpkh"===t&&(e=23),y+=41+e,n){let e=0,n=0;if(a&&x<o)"p2tr"===p?(e=1,n+=65):(e=2,n+=1+(u?72:71),n+=34);else if(a&&x>=o&&x<o+s)e=1,n+=65;else if(a&&x>=o+s){e=3,n+=1+(d?65:64);const t=r+34;n+=Tg(t)+t,n+=1+f}else"p2tr"===(!a&&Array.isArray(m)&&t?t:p)?(e=1,n+=65):(e=2,n+=73,n+=34);b+=Tg(e),b+=n}}if(Array.isArray(g)&&g.length>0)for(let x=0;x<t;x++)y+="p2wpkh"===(g[x]||h)?31:43;else y+=t*("p2tr"===h?43:31);const w=4*y+b;return Math.ceil(w/4)}function Pg(e,t,n){const r=_g(e,t,!0,0,{isReveal:!1}),i=Math.ceil(r*n);return{fee:i,vsize:r,achievedFeeRate:i/r,requestedFeeRate:n}}function Bg(e,t,n={}){const r=function(e,t={}){const{parentCount:n=0,includeFeePoolInput:r=!1,parentInputType:i="p2wpkh",parentSigIncludesSighash:a=!0,inscriptionSigIncludesSighash:o=!1,controlBlockLen:s=33}=t,l=Array.isArray(e)?e:[],c=l.length,u=n+c+(r?1:0),d=n+c;let f=12,p=0;for(let h=0;h<u;h++){if(f+=41,h<n){let e=0,t=0;"p2tr"===i?(e=1,t+=65):(e=2,t+=1+(a?72:71),t+=34),p+=Tg(e),p+=t;continue}const e=3;let t=0;t+=1+(o?65:64);const r=(h<n+c?Math.max(0,Math.floor(l[h-n]||0)):0)+34;t+=Tg(r)+r,t+=1+s,p+=Tg(e),p+=t}f+=43*d;const m=4*f+p;return Math.ceil(m/4)}(e,n),i=Math.ceil(r*t);return{fee:i,vsize:r,achievedFeeRate:i/r,requestedFeeRate:t}}function Cg(e,t,n=0,r={}){const{commitFeeRate:i=null,postage:a=546,isReinscription:o=!1,parentInputType:s="p2wpkh",parentSigIncludesSighash:l=!0,inscriptionSigIncludesSighash:c=!1,controlBlockLen:u=33,hasMetadata:d=!1,metadataSize:f=0,hasProperties:p=!1,propertiesSize:m=0,hasPointer:h=!1,hasContentEncoding:g=!1,customTagCount:y=0,scriptSizeExact:b=null}=r,w=i||t,x=Pg(2,2,w);let v=0;b||(h&&(v+=10),g&&(v+=20),d&&(v+=10+8*Math.ceil(f/520)),p&&(v+=10+8*Math.ceil(m/520)),v+=12*y);const S=b?Math.max(0,Math.floor(b)):100+e+f+m+v,E=function(e,t,n={}){const{parentCount:r=0,isReinscription:i=!1,targetCount:a=0,parentInputType:o="p2wpkh",parentSigIncludesSighash:s=!0,inscriptionSigIncludesSighash:l=!1,controlBlockLen:c=33}=n,u=_g(r+a+1,r+1,!0,e,{isReveal:!0,parentCount:r,targetCount:a,reinscription:i,parentSigIncludesSighash:s,inscriptionSigIncludesSighash:l,controlBlockLen:c,parentInputType:o}),d=Math.ceil(u*t);return{fee:d,vsize:u,achievedFeeRate:d/u,requestedFeeRate:t}}(S,t,{parentCount:n,isReinscription:o,targetCount:0,parentInputType:s,parentSigIncludesSighash:l,inscriptionSigIncludesSighash:c,controlBlockLen:u}),I=o?0:a;let k=E.fee+I,A=0;!o&&k<330&&(A=330-k,k=330);const N=x.fee/x.vsize,T=E.fee/E.vsize,_=x.fee+k;return{calculateCommitFee:(e,t)=>Pg(e,t,w),commitFee:x.fee,commitSize:x.vsize,commitFeeRate:w,commitActualFeeRate:N,revealFee:E.fee,revealSize:E.vsize,revealFeeRate:t,revealActualFeeRate:T,postage:I,revealFunding:k,dustAdjustment:A,totalRequired:_,fundingRequired:_,isReinscription:o,parentCount:n,contentSize:e,scriptSize:S,advancedFieldsOverhead:b?0:v,usesSeparateCommitRate:!!i,usesCustomPostage:546!==a}}function Og(e){const t=new Set,n=[];return(e||[]).forEach(e=>{(Array.isArray(e.parentUtxos)?e.parentUtxos:e.parentUtxo?[e.parentUtxo]:[]).forEach(e=>{const r=`${e.txid}:${e.vout}`;t.has(r)||(t.add(r),n.push(e))})}),n}function Lg(e,t,n=50,r=38e4){return e>=n||t>=r}const Fg={platform:{address:"bc1pqu9t32xuc3kdl2lxnfvgf5tkgmssee450lhepw60yfzv2sga7f0q6jkejr",amountSats:1500,description:"Nexus OCW Platform Fee"},developer:{enabled:!1,address:null,amountSats:0,description:"Developer API Fee",mode:"transaction"},custom:[]};function Rg(e){if(!e)return void(Fg.developer.enabled=!1);if(!e.address||"string"!=typeof e.address)throw new Error("Developer fee requires valid Bitcoin address");if("number"!=typeof e.amountSats||e.amountSats<0)throw new Error("Developer fee amount must be non-negative number");const t=((e,t)=>{if(!0===t)return"per-item";const n=String(e||"").trim().toLowerCase();if(!n)return"transaction";if("transaction"===n||"tx"===n)return"transaction";if("per-item"===n||"per_item"===n||"peritem"===n||"item"===n)return"per-item";throw new Error('Developer fee mode must be "transaction" or "per-item"')})(e.mode,e.perItem);Fg.developer={enabled:e.amountSats>0,address:e.address,amountSats:e.amountSats,description:e.description||"Developer API Fee",mode:t}}function Ug(e=1,t=null){const n=[],r=function(e){const t=Number(e);return Number.isFinite(t)?Math.max(1,Math.min(2e3,Math.floor(t))):1}(Array.isArray(t)?t.length:e);if(Fg.platform.address&&Fg.platform.amountSats>0&&n.push({address:Fg.platform.address,value:Fg.platform.amountSats,purpose:"platform-fee",description:Fg.platform.description}),Fg.developer.enabled&&Fg.developer.amountSats>0&&Fg.developer.address)if("per-item"===(Fg.developer.mode||"transaction"))for(let i=0;i<r;i++){const e=Array.isArray(t)?t?.[i]?.developerFeeOverride:null;if(e&&"object"==typeof e&&!1===e.enabled)continue;const r=e&&"string"==typeof e.address&&e.address.trim()?e.address.trim():Fg.developer.address,a=e&&void 0!==e.amountSats&&null!==e.amountSats?Number(e.amountSats):Fg.developer.amountSats;!Number.isFinite(a)||a<=0||n.push({address:r,value:a,purpose:"developer-fee",description:e&&(e.description||e.label)||Fg.developer.description})}else n.push({address:Fg.developer.address,value:Fg.developer.amountSats,purpose:"developer-fee",description:Fg.developer.description});return Fg.custom.forEach((e,t)=>{n.push({address:e.address,value:e.amountSats,purpose:`custom-fee-${t}`,description:e.description})}),n}function Mg(e=1,t=null){return Ug(e,t).reduce((e,t)=>e+t.value,0)}function $g(e,t,n="Custom Fee"){if(!e||"string"!=typeof e)throw new Error("Custom fee requires valid Bitcoin address");if("number"!=typeof t||t<=0)throw new Error("Custom fee amount must be positive number");Fg.custom.push({address:e,amountSats:t,description:n})}function Hg(){Fg.custom=[]}const Dg=Object.freeze(Object.defineProperty({__proto__:null,FEE_CONFIG:Fg,addCustomFee:$g,clearCustomFees:Hg,getActiveFeeOutputsForBatch:Ug,getTotalFeeAmountForBatch:Mg,setDeveloperFee:Rg},Symbol.toStringTag,{value:"Module"}));function zg(e){if(!e||"object"!=typeof e)return e;const t={...e};if(Array.isArray(t.toSignInputs)&&(t.toSignInputs=t.toSignInputs.map(e=>{if(!e||"object"!=typeof e)return e;const t={...e},n=t.sighashType;return"number"==typeof n&&(Array.isArray(t.sighashTypes)?t.sighashTypes.includes(n)||(t.sighashTypes=[...t.sighashTypes,n]):t.sighashTypes=[n]),t}),!Array.isArray(t.sighashTypes))){const e=[];for(const n of t.toSignInputs)if(n&&"object"==typeof n){const t=n.sighashType;"number"!=typeof t||e.includes(t)||e.push(t);const r=n.sighashTypes;if(Array.isArray(r))for(const n of r)"number"!=typeof n||e.includes(n)||e.push(n)}e.length&&(t.sighashTypes=e)}return t}async function Wg(e,t,n){if(!e||"function"!=typeof e.signPsbts)return null;try{const r=Array.isArray(n)?n.map(zg):zg(n);return await e.signPsbts(t,r)}catch(uC){return uC?.message||String(uC),function(){try{return"undefined"!=typeof globalThis&&!0===globalThis.NEXUS_WALLET_DEBUG}catch{return!1}}()&&"undefined"!=typeof console&&console.warn,null}}async function Vg(e,t,n){if(!e||"function"!=typeof e.signPsbt)return null;const r=[];for(let i=0;i<t.length;i++){const a=Array.isArray(n)?n[i]||{}:n||{};r.push(await e.signPsbt(t[i],zg(a)))}return r}async function jg(e,t,n){if(!Array.isArray(t)||0===t.length)throw new Error("signPsbtsWithFallback: psbts must be a non-empty array");const r=function(e){try{return e?.walletType?.toLowerCase?.()||e?.name?.toLowerCase?.()||e?.providerName?.toLowerCase?.()||e?.id?.toLowerCase?.()||e?.constructor?.name?.toLowerCase?.()||""}catch{return""}}(e),i=r.includes("leather")||r.includes("phantom"),a=1===t.length;let o=i||a?null:await Wg(e,t,n);if(o||(o=await Vg(e,t,n)),!o&&e&&e.walletInstance){const r=e.walletInstance;o=i||a?null:await Wg(r,t,n),o||(o=await Vg(r,t,n))}if(!o)throw new Error("No compatible wallet signing method found (signPsbts or signPsbt)");if("string"==typeof o&&(o=[o]),!Array.isArray(o))throw new Error("Wallet signing returned unexpected type (expected string[])");return o}const qg=Object.freeze(Object.defineProperty({__proto__:null,signPsbtsWithFallback:jg},Symbol.toStringTag,{value:"Module"}));function Kg(e){if(!e||"object"!=typeof e)return e;const t={...e};if(Array.isArray(t.toSignInputs)&&(t.toSignInputs=t.toSignInputs.map(e=>{if(!e||"object"!=typeof e)return e;const t={...e},n=t.sighashType;return"number"==typeof n&&(Array.isArray(t.sighashTypes)?t.sighashTypes.includes(n)||(t.sighashTypes=[...t.sighashTypes,n]):t.sighashTypes=[n]),t}),!Array.isArray(t.sighashTypes))){const e=[];for(const n of t.toSignInputs)if(n&&"object"==typeof n){const t=n.sighashType;"number"!=typeof t||e.includes(t)||e.push(t);const r=n.sighashTypes;if(Array.isArray(r))for(const n of r)"number"!=typeof n||e.includes(n)||e.push(n)}e.length&&(t.sighashTypes=e)}return t}async function Xg(e,t,n={},r=!1){if(!e||"function"!=typeof e.signPsbt)throw new Error("Wallet must have signPsbt method");const i=e.name&&["MagicEden"].includes(e.name);if(r&&i){Vh.info(`\ud83d\ude80 Using native broadcast for ${e.name}`);try{const r=await e.signPsbt(t,Kg({...n,broadcast:!0}));if(r&&r.broadcasted&&r.txid)return Vh.info(`\u2705 ${e.name} broadcasted transaction:`,r.txid),{txid:r.txid,broadcasted:!0,method:"native"};if("string"==typeof r&&64===r.length)return Vh.info(`\u2705 ${e.name} broadcasted transaction:`,r),{txid:r,broadcasted:!0,method:"native"};throw Vh.warn(`\u26a0\ufe0f Expected txid from ${e.name} broadcast, got:`,r),new Error("Unexpected broadcast response format")}catch(Kh){Vh.warn(`Native broadcast failed for ${e.name}:`,Kh.message)}}Vh.info(r?"\ud83d\udd04 Using fallback sign+broadcast":"\ud83d\udd0f Signing without broadcast");try{const i=await e.signPsbt(t,Kg(n));if(!r)return{signedPsbt:i,broadcasted:!1,method:"sign-only"};let s=null;const l=e=>{if(!e)return null;if("string"==typeof e)return e.trim()||null;if("object"==typeof e){const t=e.txid||e.txId||e.result||e.data;if("string"==typeof t)return t.trim()||null}return null};if("function"==typeof e.pushPsbt&&!1!==e.features?.pushPsbt)try{const t=Buffer.from(i,"hex").toString("base64");if(s=l(await e.pushPsbt(t)),s)return Vh.info("\u2705 Broadcasted via pushPsbt:",s),{txid:s,signedPsbt:i,broadcasted:!0,method:"pushPsbt"}}catch(cC){Vh.warn("pushPsbt failed:",cC.message)}if("function"==typeof e.pushTx&&!1!==e.features?.pushTx)try{const t=(await gg()).Psbt.fromHex(i);if(!0===n?.autoFinalized){Vh.info("\ud83d\udd27 Finalizing PSBT before broadcast (autoFinalized=true)...");try{t.finalizeAllInputs(),Vh.info("\u2705 All inputs finalized successfully")}catch(a){Vh.warn("\u26a0\ufe0f Could not finalize all inputs, trying individual finalization:",a.message);let e=0;for(let n=0;n<t.data.inputs.length;n++)try{t.data.inputs[n].finalScriptWitness||t.data.inputs[n].finalScriptSig||(t.finalizeInput(n),e++)}catch(cC){Vh.warn(`\u26a0\ufe0f Could not finalize input ${n}:`,cC.message)}Vh.info(`\u2705 Finalized ${e} of ${t.data.inputs.length} inputs`)}}Vh.info("\ud83d\udd27 Extracting transaction from PSBT...");const r=t.extractTransaction().toHex();Vh.info(`\u2705 Transaction extracted (${r.length/2} bytes)`);const o="function"==typeof e?.getState&&e.getState()?.walletType||"";if(s=l(((o||e?.walletType||e?.name||"").toLowerCase?.()||"").includes("unisat")?await e.pushTx({rawtx:r}):await e.pushTx(r)),s)return Vh.info("\u2705 Broadcasted via pushTx:",s),{txid:s,signedPsbt:i,broadcasted:!0,method:"pushTx"}}catch(cC){Vh.error("\u274c pushTx failed:",cC.message,cC)}try{const t=(await gg()).Psbt.fromHex(i);if(!0===n?.autoFinalized)try{t.finalizeAllInputs()}catch(o){}const r=t.extractTransaction().toHex(),a=String(n?.network||e?.getState?.()?.network||"mainnet").toLowerCase(),s=String(n?.label||"tx"),l=await Gg(e,r,a,s);if(l)return Vh.info("\u2705 Broadcasted via broadcastTransaction fallback:",l),{txid:l,signedPsbt:i,broadcasted:!0,method:"broadcastTransaction"}}catch(cC){Vh.warn("broadcastTransaction fallback failed:",cC?.message||cC)}return Vh.warn("\u26a0\ufe0f Broadcast requested but all methods failed"),{signedPsbt:i,broadcasted:!1,method:"fallback-failed"}}catch(Kh){throw Vh.error("Signing failed:",Kh.message),Kh}}async function Gg(e,t,n,r){let i,a;if("string"==typeof t)i=t;else{if(!t||"object"!=typeof t)throw new Error("broadcastTransaction payload must be string or {txHex, psbtBase64}");i=t.txHex,a=t.psbtBase64}try{const e="string"==typeof i&&i.toLowerCase().startsWith("70736274ff"),t="string"==typeof i&&i.startsWith("cHNidP");if(!a&&t&&(a=i,i=void 0),a&&!i){const e=(await gg()).Psbt.fromBase64(a);i=e.extractTransaction().toHex()}else if(e){const e=(await gg()).Psbt.fromHex(i);i=e.extractTransaction().toHex()}}catch(d){}"string"==typeof i&&(i=i.trim());const o="function"==typeof e?.getState&&e.getState()?.walletType||"",s=(o||e?.walletType||e?.name||"").toLowerCase?.()||"",l=["leather","phantom"].includes(s),c=mh(),u=async()=>{if(!i||"function"!=typeof fetch)return null;try{const t=nh("testnet"===n?"/testnet/api/tx":"regtest"===n?"/signet/api/tx":"/api/tx"),r=performance.now(),a=await fetch(t,{method:"POST",headers:{"Content-Type":"text/plain"},body:i});if((performance.now()-r).toFixed(2),a.ok)return(await a.text()).trim();let o="";try{o=await a.text()}catch(e){}return null}catch(t){return null}};if(c&&("oodl-sale-reveal"===r||"oodl-buy"===r)){const e=await u();if(e)return e}if(!l&&i&&"function"==typeof e.pushTx&&!1!==e.features?.pushTx)try{const t=performance.now(),n=String(i);let r;if(s.includes("unisat"))try{r=await e.pushTx({rawtx:n})}catch(f){r=await e.pushTx(n)}else r=await e.pushTx(n);if((performance.now()-t).toFixed(2),"string"==typeof r)return r}catch(cC){}if(!l&&a&&"function"==typeof e.pushPsbt&&!1!==e.features?.pushPsbt)try{const t=performance.now(),n=await e.pushPsbt(a);if((performance.now()-t).toFixed(2),"string"==typeof n)return n}catch(cC){}if(c){const e=await u();if(e)return e}if(i&&"function"==typeof fetch&&window.NexusBitcoinProxy&&window.NexusBitcoinProxy.isEnabled())try{try{const e=window.NexusBitcoinProxy.getUrl();e&&"function"==typeof e.then&&await e}catch(cC){}const e=performance.now(),t=await window.NexusBitcoinProxy.broadcastTx(i);return(performance.now()-e).toFixed(2),t}catch(p){}if(!c){const e=await u();if(e)return e}return null}const Yg=Object.freeze(Object.defineProperty({__proto__:null,broadcastTransaction:Gg,signAndBroadcastPsbt:Xg},Symbol.toStringTag,{value:"Module"})),Jg=new Map;async function Qg(e,t){const n=`${e}:${t}`,r=Jg.get(n);if(r&&Date.now()-r.timestamp<3e4)return r.unspent;try{const r=await fetch(`https://mempool.space/api/tx/${e}/outspend/${t}`);if(!r.ok)return!0;const i=!(await r.json()).spent;return Jg.set(n,{unspent:i,timestamp:Date.now()}),i}catch(Kh){return!0}}const Zg=e=>{return 8+((t=e)<253?1:t<=65535?3:t<=4294967295?5:9)+e;var t};function ey({bitcoinLib:e,net:t,revealPsbt:n,outputs:r,items:i,commitTxHashLE:a}){const o=(i||[]).filter(e=>e&&e.nxsParcelManifestSelfHint);if(0===o.length)return null;if(o.length>1)throw new Error("Multiple nxsParcelManifestSelfHint items in one reveal segment is not supported");const s=o[0],l=s.nxsParcelManifestSelfHint||{},c=String(l.indexingAddress||"").trim(),u=Math.ceil(Number(l.feeSats||0)),d=Number(l.bitmapNumber),f=!1!==l.all;if(!c)throw new Error("nxsParcelManifestSelfHint: indexingAddress is required");if(!Number.isFinite(u)||u<=0)throw new Error("nxsParcelManifestSelfHint: feeSats must be > 0");if(!Number.isFinite(d)||d<0)throw new Error("nxsParcelManifestSelfHint: bitmapNumber must be >= 0");const p="number"==typeof s.commitVoutIndex?s.commitVoutIndex:i.indexOf(s),m=function({revealPsbt:e,commitTxHashLE:t,commitVoutIndex:n}){const r=e?.data?.globalMap?.unsignedTx?.tx;if(!r||!Array.isArray(r.ins))return-1;const i=[t,(a=t,Buffer.isBuffer(a)&&32===a.length?Buffer.from(a).reverse():null)].filter(Boolean);var a;return r.ins.findIndex(e=>!(!e||e.index!==n)&&!!Buffer.isBuffer(e.hash)&&i.some(t=>Buffer.isBuffer(t)&&e.hash.equals(t)))}({revealPsbt:n,commitTxHashLE:a,commitVoutIndex:p});if(-1===m)throw new Error(`nxsParcelManifestSelfHint: could not locate reveal input spending commit vout ${p}`);n.addOutput({address:c,value:u}),r.push({address:c,value:u,purpose:"nxs-parcel-manifest-fee",itemIndex:s.__index});const h=function(e,{bitmapNumber:t,manifestoInputIndex:n,all:r=!0}={}){const i=function({bitmapNumber:e,manifestoInputIndex:t,all:n=!0}={}){const r=Number(e);if(!Number.isFinite(r)||r<0)throw new Error("encodeParcelManifestSelfHintPayload: bitmapNumber must be >= 0");const i=Number(t);if(!Number.isFinite(i)||i<0)throw new Error("encodeParcelManifestSelfHintPayload: manifestoInputIndex must be >= 0");const a=255&(n?1:0),o=new Uint8Array(15);o.set((new TextEncoder).encode("NXSPM"),0),o[5]=2,o[6]=a;const s=new DataView(o.buffer);return s.setUint32(7,Math.floor(r),!0),s.setUint32(11,Math.floor(i),!0),o}({bitmapNumber:t,manifestoInputIndex:n,all:r});return e.script.compile([e.opcodes.OP_RETURN,Buffer.from(i)])}(e,{bitmapNumber:d,manifestoInputIndex:m,all:f});return n.addOutput({script:h,value:0}),r.push({script:h,value:0,purpose:"nxs-parcel-manifest-hint",itemIndex:s.__index}),{indexingAddress:c,feeSats:u,bitmapNumber:d,manifestoInputIndex:m,all:f}}function ty(e,t="psbt"){const n=e?.data?.globalMap?.unsignedTx?.tx;if(!n||"function"!=typeof n.getId)throw new Error(`${t}: missing unsignedTx for txid check`);return n.getId()}function ny({expectedUnsignedTxid:e,psbt:t,label:n}){const r=ty(t,n);if(String(r)!==String(e)){const t=new Error(`${n}: unsigned txid changed (expected ${e}, got ${r}). Refusing to sign/broadcast.`);throw t.code="PSBT_UNSIGNED_TXID_MISMATCH",t}}function ry({bitcoinLib:e,network:t,commitTxHashLE:n,items:r}){const i=new e.Psbt({network:t}),a=[],o=[];return r.forEach((e,t)=>{const r={hash:n,index:"number"==typeof e.commitVoutIndex?e.commitVoutIndex:t,sequence:4294967293,witnessUtxo:{script:e.taprootPayment.output,value:Math.ceil(e.revealFundingValue)},tapLeafScript:[{controlBlock:e.controlBlock,leafVersion:e.leafVersion,script:e.witnessScript}]};i.addInput(r),a.push({index:t,address:e.taprootPayment.address,disableTweakSigner:!0,tapLeafHash:e.leafHash.toString("hex")});const s=Math.ceil(e.postage??546);i.addOutput({address:e.recipientAddress,value:s}),o.push({address:e.recipientAddress,value:s,purpose:"inscription-output",itemIndex:e.__index})}),{psbt:i,base64:i.toBase64(),inputsToSign:a,outputs:o}}function iy({bitcoinLib:e,network:t,commitTxHashLE:n,items:r,ordinalsPublicKey:i,fees:a,wallet:o,globalReinscriptionTargets:s,reinscriptionFeePool:l}){const c=new e.Psbt({network:t}),u=[],d=[],f=o&&"function"==typeof o.getState&&o.getState()||{},p=String(f.walletType||o?.walletType||o?.name||"").toLowerCase(),m=String(f.ordinalsAddress||o?.ordinalsAddress||"").trim(),h=String(f.paymentAddress||o?.paymentAddress||"").trim();e.Transaction,e.Transaction;const{parentSighash:g}=function(e,t){const n=e.Transaction?.SIGHASH_SINGLE??3,r=e.Transaction?.SIGHASH_ANYONECANPAY??128,i=e.Transaction?.SIGHASH_ALL??1,a=("function"==typeof t?.getState&&t.getState()?.walletType||t?.walletType||t?.name||"").toLowerCase(),o="leather"===a||"hiro"===a,s="unisat"===a||"unisat wallet"===a;let l;return o?(l=i,Vh.debug("\ud83d\udd27 Leather wallet detected: Using SIGHASH_ALL (0x01) for parent/reinscription inputs")):s?(l=n,Vh.debug("\ud83d\udd27 UniSat wallet detected: Using SIGHASH_SINGLE (no ANYONECANPAY) for parent/reinscription inputs")):(l=n|r,Vh.debug("\ud83d\udd27 Standard wallet: Using SIGHASH_SINGLE|ANYONECANPAY (0x83) for parent/reinscription inputs")),{parentSighash:l,isLeatherWallet:o}}(e,o),y=new Set,b=[],w=Og(r),x=new Set(s||[]);(r||[]).filter(e=>e.reinscriptionUtxo&&void 0!==e.reinscriptionUtxo.txid).forEach(e=>x.add(`${e.reinscriptionUtxo.txid}:${e.reinscriptionUtxo.vout}`));const v=r.some(e=>e.reinscriptionUtxo),S=r.some(e=>!e.reinscriptionUtxo&&w.length>0),E=r.some(e=>e.reinscriptionUtxo&&(e.parentUtxos?.length>0||e.parentUtxo));if(E||v&&S?(r.forEach(e=>{if(!e.reinscriptionUtxo)return;const t=c.inputCount,i=Math.ceil(e.reinscriptionUtxo.value||0),a={hash:rg(n,"commitTxHashLE"),index:"number"==typeof e.commitVoutIndex?e.commitVoutIndex:r.indexOf(e),sequence:4294967293,witnessUtxo:{script:rg(e.taprootPayment.output,"taprootPayment.output"),value:i},tapLeafScript:[{controlBlock:rg(e.controlBlock,"controlBlock"),leafVersion:e.leafVersion,script:rg(e.witnessScript,"witnessScript")}]};c.addInput(a),u.push({index:t,address:e.taprootPayment.address,disableTweakSigner:!0,tapLeafHash:e.leafHash.toString("hex")})}),w.forEach(n=>{const r=`${n.txid}:${n.vout}`;if(y.has(r))return;if(x.has(r))return;y.add(r);const a=String(n.address||"").trim();let o;if(n.script||n.scriptHex){const e=n.scriptHex||(Buffer.isBuffer(n.script)?n.script.toString("hex"):n.script);o=rg(Buffer.from(e,"hex"),"parent witnessUtxo.script")}else o=rg(ug(e,a,t),"parent witnessUtxo.script");const s=a.startsWith("bc1p")||a.startsWith("tb1p"),l={hash:rg(Buffer.from(n.txid,"hex").reverse(),"parent input hash"),index:n.vout,sequence:4294967293,witnessUtxo:{script:o,value:n.value}};if("string"==typeof l.hash)throw new Error(`Parent input hash must be Buffer, got string: ${l.hash.substring(0,16)}...`);if("number"!=typeof l.index||l.index<0)throw new Error(`Parent input index must be non-negative number, got: ${l.index}`);if(s&&i){const e=64===i.length?i:i.slice(2);l.tapInternalKey=Buffer.from(e,"hex")}const d=c.inputCount;c.addInput(l);const f=p.includes("xverse")&&m?m:a||m||h;u.push({index:d,address:f,sighashType:g}),b.push(n)}),r.forEach(e=>{if(e.reinscriptionUtxo)return;const t=c.inputCount,i=Math.ceil(e.revealFundingValue),a={hash:rg(n,"commitTxHashLE"),index:"number"==typeof e.commitVoutIndex?e.commitVoutIndex:r.indexOf(e),sequence:4294967293,witnessUtxo:{script:rg(e.taprootPayment.output,"taprootPayment.output"),value:i},tapLeafScript:[{controlBlock:rg(e.controlBlock,"controlBlock"),leafVersion:e.leafVersion,script:rg(e.witnessScript,"witnessScript")}]};c.addInput(a),u.push({index:t,address:e.taprootPayment.address,disableTweakSigner:!0,tapLeafHash:e.leafHash.toString("hex")})})):(w.forEach(n=>{const r=`${n.txid}:${n.vout}`;if(y.has(r))return;if(x.has(r))return void Vh.warn(`\u26a0\ufe0f Skipping parent input ${r} because it is also a reinscription target spent in COMMIT`);y.add(r);const a=String(n.address||"").trim();let o;if(n.script||n.scriptHex){const e=n.scriptHex||(Buffer.isBuffer(n.script)?n.script.toString("hex"):n.script);o=rg(Buffer.from(e,"hex"),"parent witnessUtxo.script")}else o=rg(ug(e,a,t),"parent witnessUtxo.script");const s=a.startsWith("bc1p")||a.startsWith("tb1p"),l={hash:rg(Buffer.from(n.txid,"hex").reverse(),"parent input hash"),index:n.vout,sequence:4294967293,witnessUtxo:{script:o,value:n.value}};if("string"==typeof l.hash)throw new Error(`Parent input hash must be Buffer, got string: ${l.hash.substring(0,16)}...`);if("number"!=typeof l.index||l.index<0)throw new Error(`Parent input index must be non-negative number, got: ${l.index}`);if(s&&i){const e=64===i.length?i:i.slice(2);l.tapInternalKey=Buffer.from(e,"hex")}const d=c.inputCount;c.addInput(l);const f=p.includes("xverse")&&m?m:a||m||h;u.push({index:d,address:f,sighashType:g}),b.push(n)}),r.forEach((e,t)=>{const r=c.inputCount,i=e.reinscriptionUtxo?Math.ceil(e.reinscriptionUtxo.value||0):Math.ceil(e.revealFundingValue),a={hash:rg(n,"commitTxHashLE"),index:"number"==typeof e.commitVoutIndex?e.commitVoutIndex:t,sequence:4294967293,witnessUtxo:{script:rg(e.taprootPayment.output,"taprootPayment.output"),value:i},tapLeafScript:[{controlBlock:rg(e.controlBlock,"controlBlock"),leafVersion:e.leafVersion,script:rg(e.witnessScript,"witnessScript")}]};c.addInput(a),u.push({index:r,address:e.taprootPayment.address,disableTweakSigner:!0,tapLeafHash:e.leafHash.toString("hex")})})),l&&r.some(e=>!!e.reinscriptionUtxo)&&"number"==typeof l.commitVoutIndex&&Math.ceil(l.value||0)>0){const e=c.inputCount;c.addInput({hash:rg(n,"commitTxHashLE"),index:l.commitVoutIndex,sequence:4294967293,witnessUtxo:{script:rg(l.taprootPayment.output,"feePool.taprootPayment.output"),value:Math.ceil(l.value||0)},tapLeafScript:[{controlBlock:rg(l.controlBlock,"feePool.controlBlock"),leafVersion:l.leafVersion,script:rg(l.witnessScript,"feePool.witnessScript")}]}),u.push({index:e,address:l.taprootPayment.address,disableTweakSigner:!0,tapLeafHash:l.leafHash.toString("hex")})}E||v&&S?(r.forEach(e=>{if(!e.reinscriptionUtxo)return;const t=Math.ceil(e.reinscriptionUtxo.value||0);if(t<=0)throw new Error("Reinscription target missing valid value");const n=e.recipientAddress||e.reinscriptionUtxo.address;c.addOutput({address:n,value:t}),d.push({address:n,value:t,purpose:"reinscription-output",itemIndex:e.__index})}),b.length>0&&b.forEach(e=>{c.addOutput({address:e.address,value:e.value}),d.push({address:e.address,value:e.value,purpose:"parent-return"})}),ey({bitcoinLib:e,net:t,revealPsbt:c,outputs:d,items:r,commitTxHashLE:n}),r.forEach(e=>{if(e.reinscriptionUtxo)return;const t=Math.ceil(e.postage??a?.postage??546);c.addOutput({address:e.recipientAddress,value:t}),d.push({address:e.recipientAddress,value:t,purpose:"inscription-output",itemIndex:e.__index})})):(b.length>0&&b.forEach(e=>{c.addOutput({address:e.address,value:e.value}),d.push({address:e.address,value:e.value,purpose:"parent-return"})}),ey({bitcoinLib:e,net:t,revealPsbt:c,outputs:d,items:r,commitTxHashLE:n}),r.forEach(e=>{if(!e.reinscriptionUtxo)return;const t=Math.ceil(e.reinscriptionUtxo.value||0);if(t<=0)throw new Error("Reinscription target missing valid value");const n=e.recipientAddress||e.reinscriptionUtxo.address;c.addOutput({address:n,value:t}),d.push({address:n,value:t,purpose:"reinscription-output",itemIndex:e.__index})}),r.forEach(e=>{if(e.reinscriptionUtxo)return;const t=Math.ceil(e.postage??a?.postage??546);c.addOutput({address:e.recipientAddress,value:t}),d.push({address:e.recipientAddress,value:t,purpose:"inscription-output",itemIndex:e.__index})}));const I=E||v&&S;return{psbt:c,base64:c.toBase64(),inputsToSign:u,outputs:d,parentInputCount:b.length,isMixedBatch:I}}function ay(e){const t=new AbortController,n=setTimeout(()=>t.abort(),e);return{signal:t.signal,cancel:()=>clearTimeout(n)}}function oy(e){const t="number"==typeof e?e:Number(e);return Number.isFinite(t)?t:null}async function sy(e,{timeoutMs:t=12e3}={}){const{signal:n,cancel:r}=function(e){const t=new AbortController,n=setTimeout(()=>t.abort(),e);return{signal:t.signal,cancel:()=>clearTimeout(n)}}(t);try{const t=await fetch(e,{signal:n});if(!t.ok){const e=await t.text().catch(()=>"");throw new Error(`HTTP ${t.status} ${t.statusText}${e?`: ${e}`:""}`)}return await t.json()}finally{r()}}function ly(e="mainnet"){const t=String(e||"mainnet").toLowerCase();return"testnet"===t?"testnet":"signet"===t||"regtest"===t?"signet":"mainnet"}function cy(e){return"testnet"===e?"/testnet/api":"signet"===e?"/signet/api":"/api"}async function uy(e,t="mainnet"){const n=`${"testnet"===ly(t)?"https://blockstream.info/testnet":"https://blockstream.info"}/api/address/${e}/utxo`;return function(e,t){return Array.isArray(e)?e.map(e=>({txid:e.txid,vout:e.vout,value:"number"==typeof e.value?e.value:Number(e.value)||0,address:t,status:e.status||null})):[]}(await sy(n,{timeoutMs:12e3}),e)}async function dy(e,t="mainnet"){if("mainnet"!==t)throw new Error("blockchain.info only supports mainnet in this fallback");const n=`https://blockchain.info/unspent?active=${encodeURIComponent(e)}&limit=1000`,r=await sy(n,{timeoutMs:15e3});return(Array.isArray(r?.unspent_outputs)?r.unspent_outputs:[]).map(t=>({txid:t.tx_hash_big_endian,vout:t.tx_output_n,value:"number"==typeof t.value?t.value:Number(t.value)||0,address:e,status:{confirmed:!0,block_height:void t.confirmations}}))}async function fy(e,t="mainnet"){if("mainnet"!==t)throw new Error("blockchair fallback only wired for mainnet");const n=`https://api.blockchair.com/bitcoin/dashboards/address/${encodeURIComponent(e)}?limit=0`,r=await sy(n,{timeoutMs:15e3}),i=r?.data?.[e]?.utxo;if(!Array.isArray(i))throw new Error("Blockchair: unexpected response");return i.map(t=>({txid:t.transaction_hash,vout:t.index,value:"number"==typeof t.value?t.value:Number(t.value)||0,address:e,status:{confirmed:!0,block_height:t.block_id??null}}))}async function py(e,t="mainnet"){let n;new Map([[uy,"blockstream.info (esplora)"],[fy,"blockchair.com"],[dy,"blockchain.info"]]);for(const r of[uy,fy,dy])try{return await r(e,t)}catch(cC){n=cC}throw n||new Error("Failed to fetch UTXOs (direct)")}async function my(e="mainnet"){const t=ly(e),n=nh(`${cy(t)}/v1/fees/recommended`);try{const e=await sy(n,{timeoutMs:1e4});return{fast:Number(e.fastestFee)||25,medium:Number(e.halfHourFee)||15,slow:Number(e.hourFee)||10,minimumFee:Number(e.minimumFee)||1,economyFee:Number(e.economyFee)||void 0,isDefault:!1,provider:"mempool.space"}}catch(cC){try{const e=await async function({timeoutMs:e=8e3}={}){const t=th("/r/blockheight"),n=await async function(e,{timeoutMs:t=8e3}={}){const{signal:n,cancel:r}=ay(t);try{const t=await fetch(e,{signal:n,cache:"no-store"}),r=await t.text().catch(()=>"");if(!t.ok)throw new Error(`HTTP ${t.status}${r?`: ${r}`:""}`);return r}finally{r()}}(t,{timeoutMs:e}),r=Number(String(n).trim());if(!Number.isFinite(r)||r<=0)throw new Error("Unexpected /r/blockheight response");const i=th(`/r/blockinfo/${r}`),a=await async function(e,{timeoutMs:t=8e3}={}){const{signal:n,cancel:r}=ay(t);try{const t=await fetch(e,{signal:n,cache:"no-store"});if(!t.ok){const e=await t.text().catch(()=>"");throw new Error(`HTTP ${t.status}${e?`: ${e}`:""}`)}return await t.json()}finally{r()}}(i,{timeoutMs:e}),o=oy(a?.min_fee_rate)??oy(a?.minimum_fee_rate)??1,s=Array.isArray(a?.feerate_percentiles)?a.feerate_percentiles.map(oy):[],l=s[0]??null,c=s[2]??null,u=s[4]??null,d=oy(a?.average_fee_rate)??null,f=function({slow:e,medium:t,fast:n,minimumFee:r}){const i=oy(r)??1,a=Math.max(i,oy(e)??i),o=Math.max(a,oy(t)??a);return{slow:a,medium:o,fast:Math.max(o,oy(n)??o),minimumFee:i}}({slow:l??c??d??o,medium:c??d??o,fast:u??c??d??o,minimumFee:o});return{...f,economyFee:f.slow,isDefault:!1,provider:"ordinals /r/blockinfo",blockHeight:r,raw:{feerate_percentiles:a?.feerate_percentiles,average_fee_rate:a?.average_fee_rate,min_fee_rate:a?.min_fee_rate}}}({timeoutMs:8e3});return{fast:Number(e.fast)||25,medium:Number(e.medium)||15,slow:Number(e.slow)||10,minimumFee:Number(e.minimumFee)||1,economyFee:Number(e.economyFee)||void 0,isDefault:!1,provider:e.provider||"ordinals /r/blockinfo"}}catch(r){}const n=("testnet"===e?"https://blockstream.info/testnet":"https://blockstream.info")+"/api/fee-estimates",i=await sy(n,{timeoutMs:1e4});return{fast:Number(i[1])||Number(i[2])||25,medium:Number(i[3])||Number(i[4])||15,slow:Number(i[6])||Number(i[10])||10,minimumFee:1,isDefault:!1,provider:"blockstream.info"}}}async function hy(e,t="mainnet"){const n=Array.isArray(e)?e:[e],r=ly(t),i=await Promise.all(n.map(async e=>({addr:e,utxos:await py(e,r)}))),a=await Promise.all(i.map(async({addr:e,utxos:t})=>{try{const n=await async function(e,t="mainnet"){const n=ly(t),r=nh(`${cy(n)}/address/${e}/txs/mempool`),i=await sy(r,{timeoutMs:12e3});return Array.isArray(i)?i:[]}(e,r),i=function({confirmedUtxos:e,mempoolTxs:t,address:n}){const r=new Map;for(const o of e)o&&o.txid&&"number"==typeof o.vout&&r.set(`${o.txid}:${o.vout}`,o);const i=new Set,a=[];for(const o of t||[]){const e=o?.txid,t=Array.isArray(o?.vin)?o.vin:[],s=Array.isArray(o?.vout)?o.vout:[];for(const n of t){const e=n?.txid||n?.prevout?.txid,t="number"==typeof n?.vout?n.vout:n?.prevout?.vout;if(!e||"number"!=typeof t)continue;const a=`${e}:${t}`;r.has(a)&&(i.add(a),r.delete(a))}if(e)for(let r=0;r<s.length;r++){const t=s[r];if((t?.scriptpubkey_address||t?.scriptPubKey?.address||t?.address)!==n)continue;const i="number"==typeof t?.value?t.value:Number(t?.value)||0;a.push({txid:e,vout:"number"==typeof t?.n?t.n:r,value:i,address:n,status:{confirmed:!1}})}}return{confirmedAdjusted:Array.from(r.values()),mempoolUtxos:a,spentOutpoints:i}}({confirmedUtxos:t,mempoolTxs:n,address:e});return{addr:e,utxos:[...i.confirmedAdjusted,...i.mempoolUtxos],overlayApplied:!0,overlaySpent:i.spentOutpoints.size,overlayCreated:i.mempoolUtxos.length}}catch{return{addr:e,utxos:t,overlayApplied:!1,overlaySpent:0,overlayCreated:0}}})),o=a.flatMap(e=>e.utxos),s={};for(const c of o)c&&c.txid&&"number"==typeof c.vout&&(s[`${c.txid}:${c.vout}`]=c.address);const l=await my(t);return{utxos:o,addresses:n,addressCount:n.length,addressUtxoMap:s,fees:l,providers:{utxos:"blockstream.info (confirmed) + mempool.space (mempool overlay) + fallbacks (direct)",fees:`${l.provider||"mempool.space"} (direct)`},overlay:a.map(e=>({address:e.addr,applied:e.overlayApplied,spentRemoved:e.overlaySpent,unconfirmedAdded:e.overlayCreated})),cached:!1,fetchedAt:(new Date).toISOString(),source:"direct"}}const gy=Object.freeze(Object.defineProperty({__proto__:null,fetchCompleteWalletDataDirect:hy,fetchFeeRatesDirect:my,fetchUtxosDirect:py},Symbol.toStringTag,{value:"Module"})),yy=3e5;let by="COMPLETE-v1";const wy=(()=>{try{return window.sessionStorage}catch{return null}})(),xy=new Map;function vy(e){return`${by}:${e}`}function Sy(e){return function(e){const t=vy(e);if(xy.has(t)){const e=xy.get(t);if(e._cacheTimestamp&&Date.now()-e._cacheTimestamp>yy){if(xy.delete(t),wy)try{wy.removeItem(t)}catch{}return}return e}if(wy){const e=wy.getItem(t);if(e)try{const n=JSON.parse(e);return n._cacheTimestamp&&Date.now()-n._cacheTimestamp>yy?void wy.removeItem(t):(xy.set(t,n),n)}catch{}}}(`complete:${e}`)}function Ey(e,t){!function(e,t){const n=vy(e),r={...t,_cacheTimestamp:Date.now()};if(xy.set(n,r),wy)try{wy.setItem(n,JSON.stringify(r))}catch{}}(`complete:${e}`,t)}async function Iy(e,t={}){const{forceRefresh:r=!1,progressCallback:i,network:a}=t,o=Array.isArray(e)?e:[e],s=o.sort().join(",");if(!r){const e=Sy(s);if(e)return i&&i({status:"cached",message:`Loaded from cache: ${e.utxos?.length||0} UTXOs`}),{...e,cached:!0}}i&&i({status:"fetching",message:"Fetching wallet data..."});const l=a||"undefined"!=typeof window&&window.__NEXUS_NETWORK__||"mainnet";if(function(){if("undefined"==typeof window)return{sandboxed:!1,storageAccess:!1,origin:null,frameSandboxAttr:null};ph();let e=null;try{e=window.location?.origin??null}catch{e=null}let t=null;try{const e=window.frameElement;t=e&&e.getAttribute?e.getAttribute("sandbox"):null}catch{t="unreadable"}}(),mh())try{i&&i({status:"fetching",message:`Fetching UTXOs from ${o.length} address(es) via public APIs...`});const e=await hy(o,l);return Ey(s,e),{...e,cached:!1}}catch(c){}if(!window.NexusBitcoinProxy?.isEnabled())throw new Error("Unable to fetch wallet data: direct public API unavailable and Bitcoin Proxy not available.");try{i&&i({status:"fetching",message:`Fetching UTXOs from ${o.length} address(es) and fee rates...`});const e=await window.NexusBitcoinProxy.getUtxosWithFees(o),t="93c4e4e66b508a36a4ed390cc674997e9e1b96d5a17785ca8081f09a8dbb3134",r=e.utxos?.filter(e=>e.txid===t)||[];r.length>0&&r.forEach(e=>{});const{filterPendingUtxos:a,getPendingUtxoCount:l}=await n(async()=>{const{filterPendingUtxos:e,getPendingUtxoCount:t}=await Promise.resolve().then(()=>wB);return{filterPendingUtxos:e,getPendingUtxoCount:t}},__VITE_PRELOAD__);let c=e.utxos,u=0;for(const n of o){const e=c.length;c=a(c,n),u+=e-c.length}const d={utxos:c,addresses:e.addresses||o,addressCount:e.addressCount||o.length,addressUtxoMap:e.addressUtxoMap||{},fees:e.fees,providers:e.providers,cached:!1,fetchedAt:(new Date).toISOString(),pendingUtxosFiltered:u};return Ey(s,d),i&&i({status:"success",message:`\u2705 Loaded ${d.utxos?.length||0} UTXOs from ${o.length} address(es)`}),d}catch(Kh){const{isPopupBlocked:t,showPopupBlockedNotificationMinimal:r}=await n(async()=>{const{isPopupBlocked:e,showPopupBlockedNotificationMinimal:t}=await Promise.resolve().then(()=>Ny);return{isPopupBlocked:e,showPopupBlockedNotificationMinimal:t}},__VITE_PRELOAD__);throw t(Kh)?(r("Please allow popups to fetch UTXOs (or switch to manual entry)."),i&&i({status:"error",message:"\ud83d\udeab Popup blocked \u2014 allow popups or paste UTXOs manually."})):i&&i({status:"error",message:`Error: ${Kh.message}`}),Kh}}const ky=Object.freeze(Object.defineProperty({__proto__:null,bumpCompleteDataCache:function(e=""){by=`COMPLETE-v1:${Date.now()}${e?":"+e:""}`},clearCachedCompleteData:function(e){!function(e){const t=vy(e);if(xy.delete(t),wy)try{wy.removeItem(t)}catch{}}(`complete:${e}`)},fetchCompleteWalletData:Iy,getCachedCompleteData:Sy,setCachedCompleteData:Ey},Symbol.toStringTag,{value:"Module"}));function Ay(e={}){const{includeLocalServerTip:t=!0,customMessage:n}=e,r=document.createElement("div");r.style.cssText="\n    position: fixed;\n    top: 20px;\n    right: 20px;\n    max-width: 400px;\n    background: #ff4757;\n    color: white;\n    padding: 20px;\n    border-radius: 8px;\n    box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n    z-index: 10000;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    font-size: 14px;\n    line-height: 1.5;\n  ";const i=t?'<div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.3); font-size: 12px;">\n      <strong>Alternative:</strong> Run a local server instead of file://\n    </div>':"",a=n?`<div style="margin: 8px 0 0 0; font-size: 13px;">${n}</div>`:"";return r.innerHTML=`\n    <div style="display: flex; align-items: center; margin-bottom: 12px;">\n      <span style="font-size: 24px; margin-right: 10px;">\ud83d\udeab</span>\n      <strong style="font-size: 16px;">Popup Blocked</strong>\n    </div>\n    <div style="margin-bottom: 12px;">${n||"Please allow popups to use Bitcoin Proxy features:"}</div>\n    <ol style="margin: 0 0 12px 20px; padding: 0;">\n      <li>Click the popup blocked icon (\ud83d\udeab) in your address bar</li>\n      <li>Select "Always allow popups"</li>\n      <li>Refresh and try again</li>\n    </ol>\n    ${i}\n    ${a}\n    <button id="closePopupNotification" style="\n      margin-top: 12px;\n      background: white;\n      color: #ff4757;\n      border: none;\n      padding: 8px 16px;\n      border-radius: 4px;\n      cursor: pointer;\n      font-weight: 600;\n      width: 100%;\n    ">\n      Got it\n    </button>\n  `,r.querySelector("#closePopupNotification").onclick=()=>r.remove(),setTimeout(()=>r.remove(),3e4),r}const Ny=Object.freeze(Object.defineProperty({__proto__:null,createPopupBlockedUI:Ay,isPopupBlocked:function(e){if(!e)return!1;const t=e.message||String(e);return t.includes("Popup blocked")||t.includes("popup blocked")},showPopupBlockedNotificationMinimal:function(e){const t=document.getElementById("nexus-popup-blocked-notification");t&&t.remove();const n=Ay({includeLocalServerTip:!1,customMessage:e});return n.id="nexus-popup-blocked-notification",document.body.appendChild(n),n}},Symbol.toStringTag,{value:"Module"})),Ty=21e4,_y=new Set([330,546,1e3,1e4]),Py=new Map;let By=function(){const e="NX-UTXO-v1",t="undefined"!=typeof window&&window.NexusBitcoinProxy?.endpointVersion||"";return t?`${e}:${t}`:e}();const Cy=(()=>{try{return"undefined"==typeof window?null:window.sessionStorage}catch{return null}})();function Oy(e){return`${By}:${e}`}function Ly(e){const t=Oy(e);if(Py.has(t))return Py.get(t);if(Cy){const e=Cy.getItem(t);if(e)try{const n=JSON.parse(e);return Py.set(t,n),n}catch{}}}function Fy(e,t){const n=Oy(e);if(Py.set(n,t),Cy)try{Cy.setItem(n,JSON.stringify(t))}catch{}}function Ry(e=""){By=`NX-UTXO-v1:${Date.now()}${e?":"+e:""}`}function Uy(e){return Ly(`utxo:result:${e}`)}function My(e,t){Fy(`utxo:result:${e}`,t)}async function $y(){return async function(e){return new Promise(t=>setTimeout(t,e))}(40+80*Math.random())}async function Hy(e,t={},n=5e3){const r=new AbortController,i=setTimeout(()=>r.abort(),n);try{return await fetch(e,{...t,signal:r.signal})}finally{clearTimeout(i)}}async function Dy(e){const t=`ord:tx:${e}`,n=Ly(t);if(void 0!==n)return n;const{ok:r,status:i,text:a}=await async function(e){let t=0;for(;;)try{const t=await Hy(e);if(!t.ok)return{ok:!1,status:t.status,text:null};const n=await t.text();return{ok:!0,status:t.status,text:n}}catch(cC){if(t>=2)return{ok:!1,status:0,text:null};t++,await $y()}}(th(`/r/tx/${e}`)),o=r?{ok:r,status:i,hex:a}:{ok:r,status:i,hex:null};return Fy(t,o),o}function zy(e){const{height:t,offsetInBlock:n}=(e=>{let t=e;for(let n=0;n<64;n++){const e=n*Ty,r=Math.floor(5e9/Math.pow(2,n));if(r<=0)break;const i=Ty*r;if(t<i)return{height:e+Math.floor(t/r),offsetInBlock:t%r,subsidy:r};t-=i}return{height:0,offsetInBlock:0,subsidy:0}})(e),r=Math.floor(t/126e4),i=t%Ty,a=t%2016,o=`${r}\xb0${i}\u2032${a}\u2033${n}\u2034`;return 0===t&&0===n?{rarity:"mythic",degree:o}:0===n?t%126e4==0&&r>0?{rarity:"legendary",degree:o}:0===i?{rarity:"epic",degree:o}:0===a?{rarity:"rare",degree:o}:{rarity:"uncommon",degree:o}:{rarity:"common",degree:o}}function Wy(e,t=!1){if(!e||0===e.length)return{hasRareSats:!1,rarities:[],allSats:[]};const n=e=>{let t=e;for(let n=0;n<64;n++){const e=n*Ty,r=Math.floor(5e9/Math.pow(2,n));if(r<=0)break;const i=Ty*r;if(t<i)return{height:e+Math.floor(t/r),offsetInBlock:t%r,subsidy:r};t-=i}return{height:0,offsetInBlock:0,subsidy:0}},r=(e,t,r=8)=>{const i=[];if(!Number.isFinite(e)||!Number.isFinite(t)||t<=e)return i;let a=e;for(let o=0;o<r;o++){const e=n(a);if(!e.subsidy)return i;let r=a+(e.subsidy-e.offsetInBlock);if(0===e.offsetInBlock&&(r=a+e.subsidy),r>=t)break;i.push(r),a=r}return i},i=[],a=[];let o=!1;for(const[s,l]of e)if(t)for(let e=s;e<l;e++){const t=zy(e);a.push({sat:e,...t}),"common"!==t.rarity&&(o=!0,i.push({sat:e,...t}))}else{const e=zy(s),t=zy(l-1);if(i.push({sat:s,...e}),i.push({sat:l-1,...t}),"common"!==e.rarity||"common"!==t.rarity)o=!0;else{const e=r(s,l);if(e.length){o=!0;for(const t of e){const e=zy(t);i.push({sat:t,...e})}}}}return{hasRareSats:o,rarities:i,allSats:a}}function Vy(e){if(!e||"string"!=typeof e)return{hasWitnessData:!1,hasOpReturn:!1,possibleAlkanes:!1,possibleProtoRunes:!1,hasEnvelope:!1,hasGenericData:!1,inscriptions:[]};const t="0001"===e.substring(8,12),n=e.match(/6a[0-9a-f]{2,}/g)||[],r=n.length>0,i=n.some(e=>e.length>20),a=e.includes("6a5d"),o=/0063.*?68/.test(e)||e.includes("6f7264"),s=r&&!o&&!a&&!i,l=[];if(o&&t){const t=e.match(/0063036f7264[0-9a-f]+?68/gi)||[];for(const e of t)try{const t=e.match(/036f7264(.{2,}?)00/);if(t){const n=t[1];let r="";for(let e=0;e<n.length;e+=2){const t=parseInt(n.substr(e,2),16);t>0&&(r+=String.fromCharCode(t))}l.push({contentType:r||"application/octet-stream",hasMetadata:e.includes("05")||e.includes("07"),rawEnvelope:e})}}catch(uC){}}return{hasWitnessData:t,hasOpReturn:r,possibleAlkanes:i,possibleProtoRunes:a,hasEnvelope:o,hasGenericData:s,inscriptions:l}}async function jy(e,t,r=0){const i=`${e}:${t}`,a=`check:${i}`,o=Ly(a);if(o)return o;const s=_y.has(r)||r<1e3,l={isSafe:!0,hasInscriptions:!1,hasRunes:!1,hasSatRanges:!1,hasRareSats:!1,hasAdvancedProtocols:!1,hasGenericData:!1,isSameSat:!1,inscriptionCount:0,inscriptionIds:[],details:{},error:null,notIndexed:!1,verified:!1};try{const r=await async function(e){const t=`ord:utxo:${e}`,n=Ly(t);if(void 0!==n)return n;const{ok:r,status:i,json:a}=await async function(e){let t=0;for(;;)try{const t=await Hy(e);if(!t.ok)return{ok:!1,status:t.status,json:null};const n=await t.json().catch(()=>null);return null==n?{ok:!1,status:t.status,json:null}:{ok:!0,status:t.status,json:n}}catch{if(t>=2)return{ok:!1,status:0,json:null};t++,await $y()}}(th(`/r/utxo/${e}`)),o=r?{ok:r,status:i,data:a}:{ok:r,status:i,data:null};return Fy(t,o),o}(i);if(!r.ok&&404===r.status){if(l.notIndexed=!0,!s)return l.verified=!0,l.isSafe=!0,Fy(a,l),l;const t=await Dy(e);if(!t.ok||!t.hex)return l.error="Cannot verify (no TX hex available)",l.isSafe=!1,Fy(a,l),l;const n=Vy(t.hex);return l.details.protocols=n,n.inscriptions&&n.inscriptions.length>0&&(l.details.inscriptionData=n.inscriptions,l.hasInscriptions=!0),n.hasEnvelope||n.possibleProtoRunes?(l.hasAdvancedProtocols=!0,l.isSafe=!1,Fy(a,l),l):n.possibleAlkanes||n.hasGenericData?(l.hasGenericData=!0,l.isSafe=!0,l.verified=!0,Fy(a,l),l):(l.isSafe=!0,l.verified=!0,Fy(a,l),l)}if(!r.ok)throw new Error(`Ord API error ${r.status}`);const o=r.data||{},{validateOrdinalsUtxoData:c}=await n(async()=>{const{validateOrdinalsUtxoData:e}=await Promise.resolve().then(()=>vB);return{validateOrdinalsUtxoData:e}},__VITE_PRELOAD__),u=c(o,{txid:e,vout:t});u.warnings.length;const d=u.isValid?u.correctedData:o;if(l.details.utxoData=d,l.details.validationWarnings=u.warnings,l.hasInscriptions=!!d.inscriptions?.length,l.hasRunes=!(!d.runes||!Object.keys(d.runes).length),l.hasSatRanges=!!d.sat_ranges?.length,d.inscriptions?.length>1?(l.isSameSat=!0,l.inscriptionCount=d.inscriptions.length,l.inscriptionIds=d.inscriptions):1===d.inscriptions?.length&&(l.inscriptionCount=1,l.inscriptionIds=d.inscriptions),l.hasInscriptions||l.hasRunes)return l.isSafe=!1,Fy(a,l),l;if(l.hasSatRanges){const e=Wy(d.sat_ranges);if(l.hasRareSats=e.hasRareSats,l.details.rarityAnalysis=e,e.hasRareSats)return l.isSafe=!1,Fy(a,l),l}if(s){const t=await Dy(e);if(!t.ok||!t.hex)return l.isSafe=!0,l.verified=!0,Fy(a,l),l;const n=Vy(t.hex);if(l.details.protocols=n,n.inscriptions&&n.inscriptions.length>0&&(l.details.inscriptionData=n.inscriptions,l.hasInscriptions=!0),n.hasEnvelope||n.possibleProtoRunes)return l.hasAdvancedProtocols=!0,l.isSafe=!1,Fy(a,l),l;if(n.possibleAlkanes)return l.hasGenericData=!0,l.isSafe=!0,l.verified=!0,Fy(a,l),l;if(n.hasGenericData)return l.hasGenericData=!0,l.isSafe=!0,l.verified=!0,Fy(a,l),l}return l.isSafe=!0,l.verified=!0,Fy(a,l),l}catch(cC){return l.error=cC?.message||"unknown error",l.isSafe=!1,Fy(a,l),l}}async function qy(e,t){const n=[],r=[];let i=0;const a=e.slice(),o=Array(Math.min(20,Math.max(1,e.length))).fill(0).map(async function(){for(;a.length>0;){const o=a.shift();if(!o)break;if(o.value<330){r.push({...o,reason:"Dust (< 330 sats)",dangerous:!1}),i++,t&&t({current:i,total:e.length,percentage:Math.round(i/e.length*100)});continue}if(await $y(),o.inscriptions?.length||o.runes&&Object.keys(o.runes).length||o.sat_ranges?.length){const a=!!o.sat_ranges?.length&&Wy(o.sat_ranges).hasRareSats;if(o.inscriptions?.length||o.runes&&Object.keys(o.runes).length||a){const e=o.inscriptions?.length>1,t=a?"Has rare sats":e?`Contains ${o.inscriptions.length} inscriptions (same-sat)`:"Contains assets";r.push({...o,reason:t,dangerous:!0,isSameSat:e,inscriptionCount:o.inscriptions?.length||0,inscriptionIds:o.inscriptions||[]})}else n.push({...o,verified:!0,checkedAt:Date.now(),safetyReason:"Proxy-indexed clean"});i++,t&&t({current:i,total:e.length,percentage:Math.round(i/e.length*100)});continue}const s=await jy(o.txid,o.vout,o.value);if(s.isSafe){const e=s.hasGenericData?"Generic data only":s.notIndexed?"Not indexed (clean)":"Verified clean";n.push({...o,verified:!0,checkedAt:Date.now(),safetyReason:e})}else{const e=s.hasInscriptions&&s.isSameSat?`Contains ${s.inscriptionCount} inscriptions (same-sat)`:s.hasInscriptions?"Has inscriptions":s.hasRunes?"Has runes":s.hasRareSats?"Has rare sats":s.hasAdvancedProtocols?"Has advanced protocols":s.error||"Contains assets";r.push({...o,reason:e,dangerous:!0,assetCheck:s,isSameSat:s.isSameSat||!1,inscriptionCount:s.inscriptionCount||0,inscriptionIds:s.inscriptionIds||[]})}i++,t&&t({current:i,total:e.length,percentage:Math.round(i/e.length*100)})}});await Promise.all(o);const s=n.reduce((e,t)=>e+t.value,0),l=r.reduce((e,t)=>e+t.value,0),c={};return n.forEach(e=>{const t=e.address||"unknown";c[t]||(c[t]=[]),c[t].push(e)}),{spendable:n,unsafe:r,spendableByAddress:c,totalSpendable:s,totalUnsafe:l,summary:{total:e.length,spendableCount:n.length,unsafeCount:r.length,spendablePercentage:e.length?Math.round(n.length/e.length*100):0,addressCount:Object.keys(c).length}}}async function Ky(e,t=1e3,n={}){const{progressCallback:r,manualUtxos:i,cacheNamespaceTag:a,forceRefresh:o=!1}=n;if(a&&Ry(a),!o&&!i){const t=Uy(e);if(t)return t}let s=[],l="unknown";if(!(i&&Array.isArray(i)&&i.length>0))throw new Error("Direct UTXO fetching via getSpendableUtxos() is deprecated.\n\nUse the new flow:\n1. fetchCompleteWalletData([addresses]) \u2192 Gets raw UTXOs + fees\n2. filterSpendableUtxos(utxos) \u2192 Filters for safety\n\nFor manual input, provide options.manualUtxos parameter.");s=i,l="manual_input";const c=await qy(s,r),u=c.spendable.filter(e=>e.value>=t),d=c.spendable.filter(e=>e.value<t),f={spendable:u,unsafe:[...c.unsafe,...d.map(e=>({...e,reason:`Below minimum value (${e.value} < ${t} sats)`,dangerous:!1}))],totalSpendable:u.reduce((e,t)=>e+t.value,0),totalUnsafe:c.unsafe.reduce((e,t)=>e+t.value,0),summary:{total:s.length,spendableCount:u.length,unsafeCount:c.unsafe.length+d.length,spendablePercentage:s.length>0?Math.round(u.length/s.length*100):0},source:"manual_input"};return My(e,f),f}function Xy(e){let t=[];const n=e.match(/\[[\s\S]*?\]/g);if(n&&n.length>0){for(const e of n)try{const n=JSON.parse(e);Array.isArray(n)&&(t=[...t,...n])}catch(r){}if(0===t.length)throw new Error("No valid UTXO arrays found in pasted content")}else{const n=JSON.parse(e);if(!Array.isArray(n))throw new Error("Input must be a JSON array (or multiple arrays)");t=n}return t.filter(e=>e.txid&&"number"==typeof e.vout&&"number"==typeof e.value)}function Gy(e){return nh(`/api/address/${e}/utxo`)}const Yy=Object.freeze(Object.defineProperty({__proto__:null,analyzeSatRanges:Wy,analyzeTransaction:Vy,bumpSessionCacheNamespace:Ry,calculateSatRarity:zy,checkUtxoForAssets:jy,filterSpendableUtxos:qy,getCachedUtxoResult:Uy,getMempoolUtxoUrl:Gy,getSpendableUtxos:Ky,parseUtxosFromMempool:Xy,setCachedUtxoResult:My},Symbol.toStringTag,{value:"Module"})),Jy="https://nexus-bitcoin-proxy.getord.workers.dev",Qy={WORKER_URL:Jy,ENDPOINTS:{HEALTH:"/health",UTXO:"/utxo",ADDRESS_TXS:"/address-txs",ADDRESS_TXS_MEMPOOL:"/address-txs-mempool",TX:"/tx",TX_HEX:"/tx-hex",TX_STATUS:"/tx-status",BLOCK:"/block",BLOCK_TXS:"/block-txs",BLOCK_HEIGHT:"/block-height",PUSH:"/push",FEE_ESTIMATES:"/fee-estimates"},TIMEOUT:3e4,ENABLED:!0,_initialized:!1,_configSource:"fallback",_fallbackUrls:[Jy]};async function Zy(){if(Qy._initialized)return Qy.WORKER_URL;if("undefined"!=typeof window&&window.__NEXUS_WEB_BUILD__)return Qy.ENABLED=!1,Qy._initialized=!0,Qy._configSource="web-build-direct",null;try{const e=new AbortController,t=setTimeout(()=>e.abort(),5e3),n=await fetch("/r/sat/479489914957748/at/-1/content",{signal:e.signal});if(clearTimeout(t),!n.ok)throw new Error(`HTTP ${n.status}: ${n.statusText}`);const r=(await n.text()).trim();let i=[],a=null;if(r.startsWith("{")||r.startsWith("["))try{const e=JSON.parse(r);e.urls&&Array.isArray(e.urls)?(i=e.urls,a=e.timeout||null):Array.isArray(e)?i=e:e.url&&(i=[e.url],a=e.timeout||null)}catch(cC){}if(0===i.length&&(i=[r]),i=i.map(e=>String(e).trim()).filter(e=>e.startsWith("http://")||e.startsWith("https://")),0===i.length)throw new Error("No valid URLs found in config");return a&&"number"==typeof a&&(Qy.TIMEOUT=a),Qy.WORKER_URL=i[0],Qy._fallbackUrls=i,Qy._configSource="sat",Qy._initialized=!0,i.length,i[0]}catch(Kh){return Qy.WORKER_URL=Jy,Qy._fallbackUrls=[Jy],Qy._configSource="fallback",Qy._initialized=!0,Jy}}function eb(){return Qy._fallbackUrls||[Qy.WORKER_URL]}function tb(e){const t=String(e||"").trim().toLowerCase();return!t||"mainnet"!==t&&"testnet"!==t&&"signet"!==t&&"regtest"!==t?"":`?network=${encodeURIComponent(t)}`}function nb(e){Qy.WORKER_URL=e}function rb(){return Qy.WORKER_URL}async function ib(e=null){const t=tb(e);if(!Qy.ENABLED){const t="testnet"===e?"/testnet/api":"signet"===e||"regtest"===e?"/signet/api":"/api",n=await fetch(nh(`${t}/blocks/tip/height`));if(!n.ok)throw new Error(`Failed to fetch block height: ${n.statusText}`);const r=await n.text();return parseInt(r.trim(),10)}const n=`${Qy.WORKER_URL}${Qy.ENDPOINTS.BLOCK_HEIGHT}${t}`,r=new AbortController,i=setTimeout(()=>r.abort(),Qy.TIMEOUT);try{const e=await fetch(n,{signal:r.signal});if(clearTimeout(i),!e.ok){const t=await e.text().catch(()=>"");throw new Error(`Proxy returned ${e.status}: ${t||e.statusText}`)}const t=await e.text();return parseInt(t.trim(),10)}catch(Kh){if(clearTimeout(i),"AbortError"===Kh.name)throw new Error("Block height fetch timeout - please try again");throw Kh}}const ab=Object.freeze(Object.defineProperty({__proto__:null,BITCOIN_PROXY_CONFIG:Qy,broadcastTransactionViaProxy:async function(e){if(!Qy.ENABLED){const t=await fetch(nh("/api/tx"),{method:"POST",headers:{"Content-Type":"text/plain"},body:e});if(!t.ok)throw new Error(`Broadcast failed: ${await t.text()}`);return t.text()}const t=`${Qy.WORKER_URL}${Qy.ENDPOINTS.PUSH}`,n=new AbortController,r=setTimeout(()=>n.abort(),Qy.TIMEOUT);try{const i=await fetch(t,{method:"POST",headers:{"Content-Type":"text/plain"},body:e,signal:n.signal});clearTimeout(r);const a=await i.json();if(!i.ok||!a.success)throw new Error(a.error||`Broadcast failed: ${i.statusText}`);return a.txid}catch(Kh){if(clearTimeout(r),"AbortError"===Kh.name)throw new Error("Broadcast timeout - transaction may still confirm");throw Kh}},checkProxyHealth:async function(){const e=`${Qy.WORKER_URL}${Qy.ENDPOINTS.HEALTH}`;try{const t=await fetch(e);if(!t.ok)throw new Error(`Health check failed: ${t.status}`);return await t.json()}catch(Kh){throw Kh}},fetchAddressMempoolTxsViaProxy:async function(e,t=null){const n=String(e||"").trim();if(!n)throw new Error("fetchAddressMempoolTxsViaProxy: address is required");const r=tb(t);if(!Qy.ENABLED){const e="testnet"===t?"/testnet/api":"signet"===t||"regtest"===t?"/signet/api":"/api",r=await fetch(nh(`${e}/address/${n}/txs/mempool`));if(!r.ok)throw new Error(`Failed to fetch address mempool txs: ${r.statusText}`);const i=await r.json();return Array.isArray(i)?i:[]}const i=`${Qy.WORKER_URL}${Qy.ENDPOINTS.ADDRESS_TXS_MEMPOOL}/${encodeURIComponent(n)}${r}`,a=new AbortController,o=setTimeout(()=>a.abort(),Qy.TIMEOUT);try{const e=await fetch(i,{signal:a.signal});if(clearTimeout(o),!e.ok){const t=await e.text().catch(()=>"");throw new Error(`Proxy returned ${e.status}: ${t||e.statusText}`)}const t=await e.json();return Array.isArray(t)?t:[]}catch(Kh){if(clearTimeout(o),"AbortError"===Kh.name)throw new Error("Address mempool tx fetch timeout - please try again");throw Kh}},fetchAddressTxsViaProxy:async function(e){const t=String(e||"").trim();if(!t)throw new Error("fetchAddressTxsViaProxy: address is required");if(!Qy.ENABLED){const e=await fetch(nh(`/api/address/${t}/txs`));if(!e.ok)throw new Error(`Failed to fetch address txs: ${e.statusText}`);const n=await e.json();return Array.isArray(n)?n:[]}const n=`${Qy.WORKER_URL}${Qy.ENDPOINTS.ADDRESS_TXS}/${encodeURIComponent(t)}`,r=new AbortController,i=setTimeout(()=>r.abort(),Qy.TIMEOUT);try{const e=await fetch(n,{signal:r.signal});if(clearTimeout(i),!e.ok){const t=await e.text().catch(()=>"");throw new Error(`Proxy returned ${e.status}: ${t||e.statusText}`)}const t=await e.json();return Array.isArray(t)?t:[]}catch(Kh){if(clearTimeout(i),"AbortError"===Kh.name)throw new Error("Address tx fetch timeout - please try again");throw Kh}},fetchBlockHeightViaProxy:ib,fetchBlockTxsViaProxy:async function(e,t=null){const n=String(e||"").trim();if(!n)throw new Error("fetchBlockTxsViaProxy: blockHash is required");if(!/^[0-9a-fA-F]{64}$/.test(n))throw new Error("fetchBlockTxsViaProxy: invalid hash format");const r=tb(t);if(!Qy.ENABLED){const e="testnet"===t?"/testnet/api":"signet"===t||"regtest"===t?"/signet/api":"/api",r=await fetch(nh(`${e}/block/${n}/txs`));if(!r.ok)throw new Error(`Failed to fetch block txs: ${r.statusText}`);const i=await r.json();return Array.isArray(i)?i:[]}const i=`${Qy.WORKER_URL}${Qy.ENDPOINTS.BLOCK_TXS}/${encodeURIComponent(n)}${r}`,a=new AbortController,o=setTimeout(()=>a.abort(),Qy.TIMEOUT);try{const e=await fetch(i,{signal:a.signal});if(clearTimeout(o),!e.ok){const t=await e.text().catch(()=>"");throw new Error(`Proxy returned ${e.status}: ${t||e.statusText}`)}const t=await e.json();return Array.isArray(t)?t:[]}catch(Kh){if(clearTimeout(o),"AbortError"===Kh.name)throw new Error("Block txs fetch timeout - please try again");throw Kh}},fetchBlockViaProxy:async function(e,t=null){const n=String(e||"").trim();if(!n)throw new Error("fetchBlockViaProxy: hash or height is required");const r=tb(t);if(!Qy.ENABLED){const e="testnet"===t?"/testnet/api":"signet"===t||"regtest"===t?"/signet/api":"/api",r=await fetch(nh(`${e}/block/${n}`));if(!r.ok)throw new Error(`Failed to fetch block: ${r.statusText}`);return await r.json()}const i=`${Qy.WORKER_URL}${Qy.ENDPOINTS.BLOCK}/${encodeURIComponent(n)}${r}`,a=new AbortController,o=setTimeout(()=>a.abort(),Qy.TIMEOUT);try{const e=await fetch(i,{signal:a.signal});if(clearTimeout(o),!e.ok){const t=await e.text().catch(()=>"");throw new Error(`Proxy returned ${e.status}: ${t||e.statusText}`)}return await e.json()}catch(Kh){if(clearTimeout(o),"AbortError"===Kh.name)throw new Error("Block fetch timeout - please try again");throw Kh}},fetchTxHexViaProxy:async function(e,t=null){const n=String(e||"").trim();if(!/^[0-9a-fA-F]{64}$/.test(n))throw new Error("fetchTxHexViaProxy: txid must be 64 hex chars");const r=tb(t);if(!Qy.ENABLED){const e="testnet"===t?"/testnet/api":"signet"===t||"regtest"===t?"/signet/api":"/api",r=await fetch(nh(`${e}/tx/${n}/hex`));if(!r.ok)throw new Error(`Failed to fetch tx hex: ${await r.text().catch(()=>r.statusText)}`);return String(await r.text()).trim()}const i=`${Qy.WORKER_URL}${Qy.ENDPOINTS.TX_HEX}/${encodeURIComponent(n)}${r}`,a=new AbortController,o=setTimeout(()=>a.abort(),Qy.TIMEOUT);try{const e=await fetch(i,{signal:a.signal});if(clearTimeout(o),!e.ok){const t=await e.text().catch(()=>"");throw new Error(`Proxy returned ${e.status}: ${t||e.statusText}`)}return String(await e.text()).trim()}catch(Kh){if(clearTimeout(o),"AbortError"===Kh.name)throw new Error("Tx hex fetch timeout - please try again");throw Kh}},fetchTxStatusViaProxy:async function(e,t=null){const n=String(e||"").trim();if(!/^[0-9a-fA-F]{64}$/.test(n))throw new Error("fetchTxStatusViaProxy: txid must be 64 hex chars");const r=tb(t);if(!Qy.ENABLED){const e="testnet"===t?"/testnet/api":"signet"===t||"regtest"===t?"/signet/api":"/api",r=await fetch(nh(`${e}/tx/${n}/status`));if(!r.ok)throw new Error(`Failed to fetch tx status: ${await r.text().catch(()=>r.statusText)}`);return r.json()}const i=`${Qy.WORKER_URL}${Qy.ENDPOINTS.TX_STATUS}/${encodeURIComponent(n)}${r}`,a=new AbortController,o=setTimeout(()=>a.abort(),Qy.TIMEOUT);try{const e=await fetch(i,{signal:a.signal});if(clearTimeout(o),!e.ok){const t=await e.text().catch(()=>"");throw new Error(`Proxy returned ${e.status}: ${t||e.statusText}`)}return await e.json()}catch(Kh){if(clearTimeout(o),"AbortError"===Kh.name)throw new Error("Tx status fetch timeout - please try again");throw Kh}},fetchTxViaProxy:async function(e,t=null){const n=String(e||"").trim();if(!n)throw new Error("fetchTxViaProxy: txid is required");if(!/^[0-9a-fA-F]{64}$/.test(n))throw new Error("fetchTxViaProxy: invalid txid format");const r=tb(t);if(!Qy.ENABLED){const e="testnet"===t?"/testnet/api":"signet"===t||"regtest"===t?"/signet/api":"/api",r=await fetch(nh(`${e}/tx/${n}`));if(!r.ok)throw new Error(`Failed to fetch tx: ${r.statusText}`);return await r.json()}const i=`${Qy.WORKER_URL}${Qy.ENDPOINTS.TX}/${encodeURIComponent(n)}${r}`,a=new AbortController,o=setTimeout(()=>a.abort(),Qy.TIMEOUT);try{const e=await fetch(i,{signal:a.signal});if(clearTimeout(o),!e.ok){const t=await e.text().catch(()=>"");throw new Error(`Proxy returned ${e.status}: ${t||e.statusText}`)}return await e.json()}catch(Kh){if(clearTimeout(o),"AbortError"===Kh.name)throw new Error("Transaction fetch timeout - please try again");throw Kh}},fetchUtxosViaProxy:async function(e){if(!Qy.ENABLED){const t=await fetch(nh(`/api/address/${e}/utxo`));if(!t.ok)throw new Error(`Failed to fetch UTXOs: ${t.statusText}`);return t.json()}const t=`${Qy.WORKER_URL}${Qy.ENDPOINTS.UTXO}/${e}`,n=new AbortController,r=setTimeout(()=>n.abort(),Qy.TIMEOUT);try{const e=await fetch(t,{signal:n.signal});if(clearTimeout(r),!e.ok)throw new Error(`Proxy returned ${e.status}: ${e.statusText}`);return await e.json()}catch(Kh){if(clearTimeout(r),"AbortError"===Kh.name)throw new Error("UTXO fetch timeout - please try again");throw Kh}},fetchWithProxyFallback:async function(e){const t=eb();let n=null;for(let r=0;r<t.length;r++){const i=t[r];try{const t=await e(i);if(t.ok)return t;n=new Error(`HTTP ${t.status}: ${t.statusText}`)}catch(Kh){n=Kh,t.length}}throw n||new Error("All proxy URLs failed")},getFeeEstimatesViaProxy:async function(){if(!Qy.ENABLED){const e=await fetch(nh("/api/v1/fees/recommended"));if(!e.ok)throw new Error(`Failed to fetch fees: ${e.statusText}`);const t=await e.json();return{fast:t.fastestFee,medium:t.halfHourFee,slow:t.hourFee}}const e=`${Qy.WORKER_URL}${Qy.ENDPOINTS.FEE_ESTIMATES}`,t=new AbortController,n=setTimeout(()=>t.abort(),Qy.TIMEOUT);try{const r=await fetch(e,{signal:t.signal});if(clearTimeout(n),!r.ok)throw new Error(`Proxy returned ${r.status}: ${r.statusText}`);return await r.json()}catch(Kh){if(clearTimeout(n),"AbortError"===Kh.name)throw new Error("Fee fetch timeout - please try again");throw Kh}},getProxyUrl:rb,getProxyUrls:eb,initBitcoinProxy:Zy,setProxyUrl:nb},Symbol.toStringTag,{value:"Module"}));function ob(e,t){if(!e||0===e.length)return null;const n=e=>{if("number"==typeof e.contentSize&&e.contentSize>0)return e.contentSize;if("string"==typeof e.content)try{return new Blob([e.content]).size}catch{return e.content.length}if(e.content&&"object"==typeof e.content){if(e.content.byteLength)return e.content.byteLength;if(e.content.length)return e.content.length}return 0};if(1===e.length){const r=e[0],i=n(r),a=!!r.reinscriptionTargetId||!!r.reinscriptionUtxo,o=Cg(i,t,r.parentIds?.length||0,{postage:a?0:r.postage||546,isReinscription:a,hasMetadata:!!r.metadata,hasMetaprotocol:!!r.metaprotocol,hasPointer:!!r.pointer,hasDelegate:!!r.delegateId}),s=(()=>{try{return Mg(1,[r])}catch{return 0}})();return{...o,itemCount:1,feeOutputsTotal:s,totalRequired:(o?.totalRequired??0)+s}}const r=e.filter(e=>!!e.reinscriptionTargetId||!!e.reinscriptionUtxo),i=e.filter(e=>!(e.reinscriptionTargetId||e.reinscriptionUtxo)).reduce((e,t)=>e+(t.postage||546),0),a=new Set;let o=!1;e.forEach(e=>{Array.isArray(e?.parentUtxos)&&e.parentUtxos.length>0&&(o=!0,e.parentUtxos.forEach(e=>{e&&e.txid&&"number"==typeof e.vout&&a.add(`${e.txid}:${e.vout}`)})),e?.parentUtxo&&e.parentUtxo.txid&&"number"==typeof e.parentUtxo.vout&&(o=!0,a.add(`${e.parentUtxo.txid}:${e.parentUtxo.vout}`))}),o||e.forEach(e=>(e.parentIds||[]).forEach(e=>a.add(e)));const s=a.size,l=new Set(r.map(e=>e?.reinscriptionUtxo).filter(e=>e&&e.txid&&"number"==typeof e.vout).map(e=>`${e.txid}:${e.vout}`)).size||r.length,c=(l>0?l:0)+1,u=(()=>{try{return Ug(e.length,e).length}catch{return 0}})(),d=(()=>{try{return Mg(e.length,e)}catch{return 0}})(),f=10+68*c+43*(e.length+u+(r.length>0?1:0)+1),p=Math.ceil(f*t),m=Bg(e.map(e=>"number"==typeof e.scriptSizeBytes&&e.scriptSizeBytes>0?Math.floor(e.scriptSizeBytes):"string"==typeof e.inscriptionScript&&e.inscriptionScript.length>0?Math.floor(e.inscriptionScript.length/2):Math.floor(n(e)+100)).map(e=>Math.max(0,e)),t,{parentCount:s,includeFeePoolInput:r.length>0,parentInputType:"p2wpkh"}),h=m.vsize,g=m.fee;return{commitFee:p,revealFee:g,postage:i,feeOutputsTotal:d,feeOutputsCount:u,itemCount:e.length,totalRequired:p+g+i+d,commitSize:f,revealSize:h,parentCount:s}}function sb(e,t="value"){if(e instanceof Uint8Array)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(e&&e.buffer instanceof ArrayBuffer&&"number"==typeof e.byteLength)return new Uint8Array(e.buffer,e.byteOffset||0,e.byteLength);throw new Error(`${t} is not a byte array`)}let lb=null;async function cb(){if("undefined"==typeof window)throw new Error("loadBrotliOC: browser environment required");return window.BrotliOC&&"function"==typeof window.BrotliOC.compress?window.BrotliOC:(lb||(lb=(async()=>{await import("brotli-oc");const e=window.BrotliOC;if(!e||"function"!=typeof e.compress)throw new Error("BrotliOC did not load correctly (missing BrotliOC.compress)");return e})()),lb)}async function ub(e,t=void 0){const n=await cb(),r=sb(e,"input");return sb(await n.compress(r,t||{}),"compressed")}const db=Object.freeze(Object.defineProperty({__proto__:null,brotliCompressBytes:ub,brotliDecompressBytes:async function(e,t=void 0){const n=await cb();if("function"!=typeof n.decompress)throw new Error("BrotliOC is missing decompress(); cannot decode compressed payload");const r=sb(e,"compressed");return sb(await n.decompress(r,t||{}),"decompressed")},loadBrotliOC:cb},Symbol.toStringTag,{value:"Module"}));function fb(e){try{return(new TextEncoder).encode(e)}catch{return Uint8Array.from(Buffer.from(String(e),"utf8"))}}function pb(e){try{return new TextDecoder("utf-8",{fatal:!1}).decode(e)}catch{return Buffer.from(e).toString("utf8")}}function mb(e,t,n){const r=t+n;return r>e.length?null:{value:e.slice(t,r),size:n}}function hb(e,t){return t+4>e.length?null:{value:(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0,size:4}}function gb(e,t){if(t>=e.length)return null;const n=e[t];if(n<253)return{value:BigInt(n),size:1};if(253===n){if(t+2>=e.length)return null;const n=e[t+1]|e[t+2]<<8;return{value:BigInt(n>>>0),size:3}}if(254===n){const n=hb(e,t+1);return n?{value:BigInt(n.value),size:1+n.size}:null}const r=function(e,t){if(t+8>e.length)return null;let n=0n;for(let r=7;r>=0;r--)n=n<<8n|BigInt(e[t+r]);return{value:n,size:8}}(e,t+1);return r?{value:r.value,size:1+r.size}:null}function yb(e){let t=e;if("number"==typeof t&&(t=BigInt(Math.floor(t))),"string"==typeof t&&(t=BigInt(t)),"bigint"!=typeof t)throw new Error("encodeCompactSizeU64: n must be bigint|number|string");if(t<0n)throw new Error("encodeCompactSizeU64: n must be >= 0");if(t>(1n<<64n)-1n)throw new Error("encodeCompactSizeU64: n exceeds uint64");if(t<0xfdn)return Uint8Array.of(Number(t));if(t<=0xffffn){const e=Number(t);return Uint8Array.of(253,255&e,e>>8&255)}if(t<=0xffffffffn){const e=Number(t);return Uint8Array.of(254,255&e,e>>8&255,e>>16&255,e>>24&255)}const n=new Uint8Array(9);n[0]=255;let r=t;for(let i=0;i<8;i++)n[1+i]=Number(0xffn&r),r>>=8n;return n}function bb(e,t){if(e.length<t.length)return!1;for(let n=0;n<t.length;n++)if(e[n]!==t[n])return!1;return!0}function wb(e){if(!e||!(e instanceof Uint8Array)||e.length<4)return null;const t=fb("OODL"),n=fb("oodinals-sale-v1");if(bb(e,t)){let n=t.length;if(n>=e.length)return null;const r=e[n];if(n+=1,1===r){if(n>=e.length)return null;const t=e[n];n+=1;const r=mb(e,n,t);if(!r)return null;if(n+=r.size,n>=e.length)return null;const i=e[n];n+=1;const a=mb(e,n,i);if(!a)return null;n+=a.size;const o=function(e,t){if(t+8>e.length)return null;let n=0n;for(let r=0;r<8;r++)n=n<<8n|BigInt(e[t+r]);return{value:n,size:8}}(e,n);if(!o)return null;if(n+=o.size,n>=e.length)return null;const s=e[n];if(n+=1,0!==s&&1!==s)return null;let l=null;if(1===s){const t=mb(e,n,32);if(!t)return null;l=Buffer.from(t.value).toString("hex"),n+=t.size}if(n!==e.length)return null;const c=pb(r.value).trim(),u=pb(a.value).trim();let d;return d=o.value<=BigInt(Number.MAX_SAFE_INTEGER)?Number(o.value):o.value.toString(),c&&u?{protocol:"oodinals-sale-v1",version:1,parentInscriptionId:c,sellerAddress:u,priceSats:d,psbtHashHex:l}:null}if(2===r){if(n+2>e.length)return null;const t=e[n];n+=1;const r=e[n];if(n+=1,!Number.isFinite(t)||t<1)return null;if(1!==r)return null;const i=mb(e,n,32);if(!i)return null;n+=i.size;const a=function(e,t){return t+4>e.length?null:{value:(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0,size:4}}(e,n);if(!a)return null;n+=a.size;const o=mb(e,n,32);if(!o)return null;n+=o.size;const s=gb(e,n);if(!s)return null;n+=s.size;const l=gb(e,n);if(!l)return null;if(n+=l.size,n>=e.length)return null;const c=e[n];if(n+=1,0!==c&&1!==c)return null;let u=null,d=null;if(1===c){const t=gb(e,n);if(!t)return null;n+=t.size;const r=mb(e,n,32);if(!r)return null;n+=r.size,u=t.value<=BigInt(Number.MAX_SAFE_INTEGER)?Number(t.value):t.value.toString(),d=Buffer.from(r.value).toString("hex")}if(n>=e.length)return null;const f=e[n];if(n+=1,0!==f&&1!==f)return null;let p=null;if(1===f){const t=mb(e,n,32);if(!t)return null;p=Buffer.from(t.value).toString("hex"),n+=t.size}let m=null;if(n<e.length){const t=e[n];if(n+=1,1&t){const t=hb(e,n);if(!t)return null;m=t.value,n+=t.size}if(2&t){const t=hb(e,n);if(!t)return null;n+=t.size}}const h=`${Buffer.from(i.value).toString("hex")}i${String(a.value)}`,g=s.value<=BigInt(Number.MAX_SAFE_INTEGER)?Number(s.value):s.value.toString(),y=l.value<=BigInt(Number.MAX_SAFE_INTEGER)?Number(l.value):l.value.toString();return{protocol:"oodinals-sale-v1",version:2,openStoreVersion:t,outputOrderVersion:r,parentInscriptionId:h,sellerScriptHashHex:Buffer.from(o.value).toString("hex"),priceSats:g,postageSats:y,platformFeeSats:u,platformFeeScriptHashHex:d,psbtHashHex:p,minBlockHeight:m}}return null}if(bb(e,n)){let t=n.length;0===e[t]&&(t+=1);const r=(e,t)=>{if(t>=e.length)return null;const n=e[t];return n<253?{value:n,size:1}:253===n?t+2>=e.length?null:{value:e[t+1]|e[t+2]<<8,size:3}:254===n?t+4>=e.length?null:{value:(e[t+1]|e[t+2]<<8|e[t+3]<<16|e[t+4]<<24)>>>0,size:5}:null},i=(e,t)=>{if(t+8>e.length)return null;let n=0n;for(let r=7;r>=0;r--)n=n<<8n|BigInt(e[t+r]);return{value:n,size:8}},a=r(e,t);if(!a)return null;t+=a.size;const o=mb(e,t,a.value);if(!o)return null;t+=o.size;const s=r(e,t);if(!s)return null;t+=s.size;const l=mb(e,t,s.value);if(!l)return null;t+=l.size;const c=i(e,t);if(!c)return null;t+=c.size;let u=null;if(t+32<=e.length){const n=mb(e,t,32);n&&(u=Buffer.from(n.value).toString("hex"))}const d=pb(o.value).trim(),f=pb(l.value).trim();let p;return p=c.value<=BigInt(Number.MAX_SAFE_INTEGER)?Number(c.value):c.value.toString(),d&&f?{protocol:"oodinals-sale-v1",version:1,parentInscriptionId:d,sellerAddress:f,priceSats:p,psbtHashHex:u}:null}return null}async function xb(e,t=null){const n=t||await gg(),r=!(!e||2!==e.version&&"number"!=typeof e.openStoreVersion),i=r?function({parentInscriptionId:e,sellerScriptHashHex:t,priceSats:n,postageSats:r,platformFeeSats:i=null,platformFeeScriptHashHex:a=null,psbtHashHex:o=null,openStoreVersion:s=1,minBlockHeight:l=null}){const c=fb("OODL"),u=Number(s);if(!Number.isFinite(u)||u<1||u>255||!Number.isInteger(u))throw new Error("encodeOpenStoreSaleMarkerV2: openStoreVersion must be an integer in [1,255]");const d=function(e){const t=String(e||"").trim().match(/^([0-9a-fA-F]{64})i(\d+)$/);if(!t)return null;const n=t[1].toLowerCase(),r=Number(t[2]);return!Number.isFinite(r)||r<0?null:{txid:n,index:r}}(e);if(!d)throw new Error("encodeOpenStoreSaleMarkerV2: invalid parentInscriptionId (expected <txid>i<index>)");const f=function(e){const t=Number(e);if(!Number.isFinite(t)||t<0||t>4294967295)return null;const n=new Uint8Array(4);return n[0]=t>>>24&255,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n}(d.index);if(!f)throw new Error("encodeOpenStoreSaleMarkerV2: invalid inscription index");if("string"!=typeof t||!/^[0-9a-fA-F]{64}$/.test(t))throw new Error("encodeOpenStoreSaleMarkerV2: sellerScriptHashHex must be 32-byte hex");const p=yb(n),m=yb(r),h=null!=i,g="string"==typeof a&&/^[0-9a-fA-F]{64}$/.test(a);if(h&&!g)throw new Error("encodeOpenStoreSaleMarkerV2: platformFeeScriptHashHex required when platformFeeSats is set");const y=h?yb(i):null,b="string"==typeof o&&/^[0-9a-fA-F]{64}$/.test(o),w=null==l?null:Number(l),x=Number.isFinite(w)&&w>=0&&w<=4294967295&&Number.isInteger(w);if(null!=l&&!x)throw new Error("encodeOpenStoreSaleMarkerV2: minBlockHeight must be a uint32 when provided");let v=0;x&&(v|=1);const S=0!==v;if(u>=2){const e="string"==typeof o?o.toLowerCase():"";if(!b||e==="0".repeat(64))throw new Error("encodeOpenStoreSaleMarkerV2: Open Store v2+ requires a non-zero psbtHashHex commitment")}const E=75+p.length+m.length+1+(h?y.length+32:0)+1+(b?32:0)+(S?1+(x?4:0):0),I=new Uint8Array(E);let k=0;return I.set(c,k),k+=4,I[k]=2,k+=1,I[k]=u,k+=1,I[k]=1,k+=1,I.set(Uint8Array.from(Buffer.from(d.txid,"hex")),k),k+=32,I.set(f,k),k+=4,I.set(Uint8Array.from(Buffer.from(t,"hex")),k),k+=32,I.set(p,k),k+=p.length,I.set(m,k),k+=m.length,I[k]=h?1:0,k+=1,h&&(I.set(y,k),k+=y.length,I.set(Uint8Array.from(Buffer.from(a,"hex")),k),k+=32),I[k]=b?1:0,k+=1,b&&(I.set(Uint8Array.from(Buffer.from(o,"hex")),k),k+=32),S&&(I[k]=v,k+=1,x&&(function(e,t,n){const r=Number(n);if(!Number.isFinite(r)||r<0||r>4294967295||!Number.isInteger(r))throw new Error("writeU32LE: value must be a uint32");e[t]=255&r,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24&255}(I,k,w),k+=4)),I}(e):function({parentInscriptionId:e,sellerAddress:t,priceSats:n,psbtHashHex:r=null}){const i=fb("OODL"),a=fb(String(e||"")),o=fb(String(t||""));if(a.length>255||o.length>255)throw new Error("encodeOodinalsSaleMarker: string fields too long (max 255 bytes)");const s="string"==typeof r&&/^[0-9a-fA-F]{64}$/.test(r),l=6+a.length+1+o.length+8+1+(s?32:0),c=new Uint8Array(l);let u=0;c.set(i,u),u+=4,c[u]=1,u+=1,c[u]=a.length,u+=1,c.set(a,u),u+=a.length,c[u]=o.length,u+=1,c.set(o,u),u+=o.length;let d=n;if("number"==typeof d&&(d=BigInt(Math.floor(d))),"string"==typeof d&&(d=BigInt(d)),"bigint"!=typeof d)throw new Error("encodeOodinalsSaleMarker: priceSats must be bigint|number|string");if(d<0n)throw new Error("encodeOodinalsSaleMarker: priceSats must be >= 0");if(d>(1n<<64n)-1n)throw new Error("encodeOodinalsSaleMarker: priceSats exceeds uint64");for(let f=7;f>=0;f--)c[u+f]=Number(0xffn&d),d>>=8n;if(u+=8,c[u]=s?1:0,u+=1,s){const e=Uint8Array.from(Buffer.from(r,"hex"));c.set(e,u),u+=32}return c}(e);if(r&&e?.parentInscriptionId){const t=wb(Uint8Array.from(i));if(!t||2!==Number(t.version||0))throw new Error("buildSaleMarkerOpReturnScript: Open Store marker v2 did not decode after encode");if(String(t.parentInscriptionId||"").toLowerCase()!==String(e.parentInscriptionId).toLowerCase())throw new Error("buildSaleMarkerOpReturnScript: parentInscriptionId did not round-trip encode/decode. This likely indicates a txid endianness mismatch in marker v2 producer.")}return n.script.compile([n.opcodes.OP_RETURN,Buffer.from(i)])}Uint8Array.from([78,88,83,66,77]);const vb=Uint8Array.from([78,88,83,80,76]);async function Sb({parcelNumber:e,bitmapNumber:t}={},n=null){const r=n||await gg(),i=function(e,t){const n=Number(e),r=Number(t);if(!Number.isFinite(n)||n<0||!Number.isInteger(n))throw new Error("encodeNexusParcelHintV1: parcelNumber must be a non-negative integer");if(!Number.isFinite(r)||r<0||!Number.isInteger(r))throw new Error("encodeNexusParcelHintV1: bitmapNumber must be a non-negative integer");if(n>4294967295)throw new Error("encodeNexusParcelHintV1: parcelNumber must fit in uint32");if(r>4294967295)throw new Error("encodeNexusParcelHintV1: bitmapNumber must fit in uint32");const i=new Uint8Array(vb.length+1+4+4);i.set(vb,0),i[vb.length]=1;const a=vb.length+1;return i[a+0]=n>>>0&255,i[a+1]=n>>>8&255,i[a+2]=n>>>16&255,i[a+3]=n>>>24&255,i[a+4]=r>>>0&255,i[a+5]=r>>>8&255,i[a+6]=r>>>16&255,i[a+7]=r>>>24&255,i}(e,t);return r.script.compile([r.opcodes.OP_RETURN,Buffer.from(i)])}function Eb(e){const t=e instanceof Uint8Array?e:Buffer.isBuffer(e)?new Uint8Array(e):null;if(!t||t.length<11)return null;if("NXSPM"!==(new TextDecoder).decode(t.slice(0,5)))return null;const n=t[5];if(1!==n&&2!==n)return null;const r=!!(1&(t[6]||0)),i=new DataView(t.buffer,t.byteOffset,t.byteLength),a=i.getUint32(7,!0);return 1===n?t.length<47?null:{version:n,all:r,bitmapNumber:a,manifestoInscriptionId:`${Buffer.from(t.slice(11,43)).toString("hex")}i${i.getUint32(43,!0)}`}:t.length<15?null:{version:n,all:r,bitmapNumber:a,manifestoInputIndex:i.getUint32(11,!0)}}async function Ib(e){await new Promise(t=>setTimeout(t,e))}function kb(e,t){if(!e)return null;const n=e?.fullUtxo||e?.utxo||e?.raw||e?.full||e,r=n.txid||n.txId||n.hash,i=n.vout??n.index??n.n,a=n.value??n.satoshis??n.amount,o=n.address||n.addr||t||null,s=n.scriptPubKey||n.scriptHex||n.script||null,l=n.satpoint||n.satPoint||null;let c=n.offset??n.satOffset??n.sat_offset;if(null==c&&l){const e=String(l).split(":");if(e.length>=3){const t=Number(e[2]);Number.isFinite(t)&&t>=0&&(c=t)}}return r&&null!=i&&Number.isFinite(Number(i))&&null!=a&&Number.isFinite(Number(a))?{txid:String(r),vout:Number(i),value:Number(a),address:o,scriptPubKey:s,satpoint:l,offset:c}:null}function Ab(e){const t=new Map;return(e||[]).forEach(e=>{if(!e?.txid||void 0===e.vout||null===e.vout)return;const n=`${String(e.txid)}:${Number(e.vout)}`,r=t.get(n);if(!r)return void t.set(n,e);const i=Number(r.value||0);Number(e.value||0)>i&&t.set(n,e)}),Array.from(t.values())}function Nb(e,t){const n=Number(e);return!Number.isFinite(n)||n<=0?1500:Math.max(250,Math.ceil(n*t))}function Tb(e){try{if("undefined"!=typeof window&&!0===window.__OODL_ALLOW_520__)return 520}catch{}const t=String(e||"").toLowerCase();return"mainnet"===t||"testnet"===t?80:520}const _b=Buffer.from("OODL","utf8"),Pb=Buffer.from("OODT","utf8");function Bb(e){const t=Buffer.isBuffer(e)?e:Buffer.from(e||[]);if(t.length<7)return null;if(!Yb(t.subarray(0,4),Pb))return null;if(1!==t[4])return null;const n=7+t.readUInt16LE(5);if(n>t.length)return null;const r={};let i=7;for(;i+3<=n;){const e=t[i],a=t.readUInt16LE(i+1);if(i+=3,i+a>n)break;const o=t.subarray(i,i+a);i+=a;try{if(1===e&&8===o.length){let e=0n;for(let t=7;t>=0;t-=1)e=e<<8n|BigInt(o[t]);r.priceSats=e}else 2===e?r.collectionKey=o.toString("utf8"):3===e&&4===o.length?r.bitmapNumber=o.readUInt32LE(0):4===e&&4===o.length?r.parcelNumber=o.readUInt32LE(0):5===e&&4===o.length&&(r.minBlockHeight=o.readUInt32LE(0))}catch{}}return{meta:r,bytesConsumed:n}}function Cb(e,t=0){const n=Buffer.isBuffer(e)?e:Buffer.from(e||[]),r=function(e,t=0){const n=Buffer.isBuffer(e)?e:Buffer.from(e||[]),r=Math.max(0,Math.floor(Number(t||0)));if(n.length<4||r>=n.length)return-1;for(let i=r;i+4<=n.length;i+=1)if(n[i]===Pb[0]&&n[i+1]===Pb[1]&&n[i+2]===Pb[2]&&n[i+3]===Pb[3])return i;return-1}(n,t);return r<0?null:Bb(n.subarray(r))}function Ob(e){const t=Buffer.isBuffer(e)?e:Buffer.from(e||[]);if(t.length<9)return null;if(!Yb(t.subarray(0,4),_b))return null;const n=t[4];if(1===n){const e=t.readUInt32LE(5),r=9,i=r+e;return i>t.length?null:{version:n,flags:0,rawLen:e,payload:t.subarray(r,i)}}if(2===n){if(t.length<14)return null;const e=t[5]||0,r=t.readUInt32LE(6),i=14,a=i+t.readUInt32LE(10);return a>t.length?null:{version:n,flags:e,rawLen:r,payload:t.subarray(i,a)}}return null}async function Lb(e,{requirePsbtMagic:t=!0}={}){const r=Buffer.isBuffer(e)?e:Buffer.from(e||[]),i=Bb(r),a=i?.bytesConsumed||0;let o=Ob(r.subarray(a));if(!o){const e=function(e,t=0){const n=Buffer.isBuffer(e)?e:Buffer.from(e||[]),r=Math.max(0,Math.floor(Number(t||0)));if(n.length<4||r>=n.length)return-1;for(let i=r;i+4<=n.length;i+=1)if(n[i]===_b[0]&&n[i+1]===_b[1]&&n[i+2]===_b[2]&&n[i+3]===_b[3])return i;return-1}(r,a);e>=0&&(o=Ob(r.subarray(e)))}if(!o)return t&&!Ub(r)?null:r;if(1===o.version){const e=o.payload;return t&&!Ub(e)?null:e}if(2===o.version){if(!(1&o.flags)){const e=o.payload;return t&&!Ub(e)?null:e}const e=await async function(e){const t=Buffer.isBuffer(e)?e:Buffer.from(e||[]);try{if("undefined"!=typeof window){const{brotliDecompressBytes:e}=await n(async()=>{const{brotliDecompressBytes:e}=await Promise.resolve().then(()=>db);return{brotliDecompressBytes:e}},__VITE_PRELOAD__),r=await e(Uint8Array.from(t));return Buffer.from(r)}}catch{}try{const e=await n(()=>Promise.resolve().then(()=>IB),__VITE_PRELOAD__);return Buffer.from(e.brotliDecompressSync(t))}catch(cC){throw new Error(`brotliDecompressBytesUniversal: brotli unavailable (${cC?.message||cC})`)}}(o.payload);return Number.isFinite(Number(o.rawLen))&&o.rawLen>0&&e.length!==o.rawLen||t&&!Ub(e)?null:e}return null}async function Fb(e,{marker:t=null,compress:r=!1}={}){const i=await async function(e,{compress:t=!1}={}){const r=Buffer.isBuffer(e)?e:Buffer.from(e||[]),i=(()=>{const e=r.length>>>0,t=Buffer.alloc(9);return _b.copy(t,0),t[4]=1,t.writeUInt32LE(e,5),Buffer.concat([t,r])})();if(!t)return i;try{const e=await async function(e){const t=Buffer.isBuffer(e)?e:Buffer.from(e||[]);try{if("undefined"!=typeof window){const{brotliCompressBytes:e}=await n(async()=>{const{brotliCompressBytes:e}=await Promise.resolve().then(()=>db);return{brotliCompressBytes:e}},__VITE_PRELOAD__),r=await e(Uint8Array.from(t));return Buffer.from(r)}}catch{}try{const e=await n(()=>Promise.resolve().then(()=>IB),__VITE_PRELOAD__);return Buffer.from(e.brotliCompressSync(t))}catch(cC){throw new Error(`brotliCompressBytesUniversal: brotli unavailable (${cC?.message||cC})`)}}(r),t=e.length>>>0,a=r.length>>>0,o=1,s=Buffer.alloc(14);_b.copy(s,0),s[4]=2,s[5]=o,s.writeUInt32LE(a,6),s.writeUInt32LE(t,10);const l=Buffer.concat([s,e]);return l.length<i.length?l:i}catch{return i}}(e,{compress:r}),a=function(e){const t=e&&"object"==typeof e?e:{},n=[];{const e=function(e){let t;try{t="bigint"==typeof e?e:"number"==typeof e?BigInt(Math.floor(e)):"string"==typeof e?BigInt(String(e).trim()):null}catch{t=null}if(null===t||t<0n||t>0xffffffffffffffffn)return null;const n=Buffer.alloc(8);let r=t;for(let i=0;i<8;i+=1)n[i]=Number(0xffn&r),r>>=8n;return n}(t?.priceSats);e&&n.push({t:1,v:e})}{const e=String(t?.collectionKey||"").trim();e&&n.push({t:2,v:Buffer.from(e,"utf8")})}{const e=Number(t?.bitmapNumber);if(Number.isFinite(e)&&e>=0&&e<=4294967295){const t=Buffer.alloc(4);t.writeUInt32LE(Math.floor(e)>>>0,0),n.push({t:3,v:t})}}{const e=Number(t?.parcelNumber);if(Number.isFinite(e)&&e>=0&&e<=4294967295){const t=Buffer.alloc(4);t.writeUInt32LE(Math.floor(e)>>>0,0),n.push({t:4,v:t})}}{const e=Number(t?.minBlockHeight);if(Number.isFinite(e)&&e>=0&&e<=4294967295&&Number.isInteger(e)){const t=Buffer.alloc(4);t.writeUInt32LE(e>>>0,0),n.push({t:5,v:t})}}if(0===n.length)return Buffer.alloc(0);const r=Buffer.concat(n.map(({t:e,v:t})=>{const n=Buffer.isBuffer(t)?t:Buffer.from(t||[]),r=Math.min(65535,Math.max(0,n.length>>>0)),i=Buffer.alloc(3);return i[0]=e>>>0&255,i.writeUInt16LE(r,1),Buffer.concat([i,n.subarray(0,r)])})),i=Math.min(65535,r.length>>>0),a=Buffer.alloc(7);return Pb.copy(a,0),a[4]=1,a.writeUInt16LE(i,5),Buffer.concat([a,r.subarray(0,i)])}(t);return a&&0!==a.length?Buffer.concat([a,i]):i}function Rb(e,t){const n=Buffer.isBuffer(t)?t:Buffer.from(t||[]),r=e?.script?.decompile?e.script.decompile(n):null;if(!Array.isArray(r)||r.length<2)return null;const i=e?.opcodes?.OP_DROP,a=e?.opcodes?.OP_CHECKSIG;if(void 0===i||void 0===a)return null;let o=0;for(;o<r.length&&r[o]===i;)o+=1;if(o<=0)return null;if(r.length!==o+2)return null;const s=r[o],l=r[o+1];return Buffer.isBuffer(s)&&32===s.length?l!==a?null:o:null}function Ub(e){const t=Buffer.isBuffer(e)?e:Buffer.from(e||[]);return!(t.length<5)&&t.subarray(0,5).equals(Buffer.from("70736274ff","hex"))}async function Mb(e,t,n={}){const{inputIndex:r=null,expectedWitnessScriptHex:i=null,expectedControlBlockHex:a=null,requirePsbtMagic:o=!0}=n||{};if(!e)throw new Error("extractSellerPsbtFromRevealTxWithBitcoinLib: bitcoinLib is required");if(!t||"string"!=typeof t)throw new Error("extractSellerPsbtFromRevealTxWithBitcoinLib: txHex string is required");const s=e.Transaction.fromHex(t),l=Array.isArray(s?.ins)?s.ins:[];if(0===l.length)throw new Error("extractSellerPsbtFromRevealTxWithBitcoinLib: tx has no inputs");const c=i?Buffer.from(i,"hex"):null,u=a?Buffer.from(a,"hex"):null,d=async t=>{if(!Array.isArray(t)||t.length<4)return null;const n=t[t.length-2],r=t[t.length-1];if(!Buffer.isBuffer(n)||0===n.length)return null;if(i=r,!Buffer.isBuffer(i)||i.length<33||(i.length-33)%32!=0)return null;var i;if(c&&!Yb(n,c))return null;if(u&&!Yb(r,u))return null;const a=Rb(e,n);if(!a)return null;const s=1+a+2;if(t.length!==s)return null;const l=e=>Buffer.isBuffer(e)?e:Buffer.from(e||[]),d=t.slice(1,1+a).map(l),f=Buffer.concat(d.filter(e=>(e?.length||0)>0)),p=await Lb(f,{requirePsbtMagic:o});if(p)return{payload:p,maxChunks:a,layout:"legacy"};const m=t.slice(0,a).map(l),h=Buffer.concat(m.filter(e=>(e?.length||0)>0)),g=await Lb(h,{requirePsbtMagic:o});return g?{payload:g,maxChunks:a,layout:"chunks-first"}:null};if("number"==typeof r&&r>=0){const e=l[r]?.witness||null,t=await d(e);if(!t)throw new Error(`extractSellerPsbtFromRevealTxWithBitcoinLib: input ${r} did not match data-carrier witness pattern`);return t.payload}for(let f=0;f<l.length;f++){const e=l[f]?.witness||null,t=await d(e);if(t)return t.payload}throw new Error("extractSellerPsbtFromRevealTxWithBitcoinLib: no input matched expected data-carrier witness layout")}async function $b(e,t,n={}){const{inputIndex:r=null,expectedWitnessScriptHex:i=null,expectedControlBlockHex:a=null}=n||{};if(!e)throw new Error("extractOodlListingMetadataFromRevealTxWithBitcoinLib: bitcoinLib is required");if(!t||"string"!=typeof t)throw new Error("extractOodlListingMetadataFromRevealTxWithBitcoinLib: txHex string is required");const o=e.Transaction.fromHex(t),s=Array.isArray(o?.ins)?o.ins:[];if(0===s.length)throw new Error("extractOodlListingMetadataFromRevealTxWithBitcoinLib: tx has no inputs");const l=i?Buffer.from(i,"hex"):null,c=a?Buffer.from(a,"hex"):null,u=e=>Buffer.isBuffer(e)?e:Buffer.from(e||[]),d=t=>{if(!Array.isArray(t)||t.length<4)return null;const n=t[t.length-2],r=t[t.length-1];if(!Buffer.isBuffer(n)||0===n.length)return null;if(i=r,!Buffer.isBuffer(i)||i.length<33||(i.length-33)%32!=0)return null;var i;if(l&&!Yb(n,l))return null;if(c&&!Yb(r,c))return null;try{const r=Rb(e,n);if(r){const e=1+r+2;if(t.length===e){const e=t.slice(1,1+r).map(u),n=Buffer.concat(e.filter(e=>(e?.length||0)>0)),i=Cb(n,0);if(i)return i.meta;const a=t.slice(0,r).map(u),o=Buffer.concat(a.filter(e=>(e?.length||0)>0)),s=Cb(o,0);if(s)return s.meta}}}catch{}const a=t.slice(0,Math.max(0,t.length-2)).map(u),o=Buffer.concat(a.filter(e=>(e?.length||0)>0)),s=Cb(o,0);return s?s.meta:null};if("number"==typeof r&&r>=0)return d(s[r]?.witness||null);for(let f=0;f<s.length;f+=1){const e=d(s[f]?.witness||null);if(e)return e}return null}function Hb(e){const t="undefined"!=typeof window&&window.__NEXUS_NETWORK__||"mainnet";return"testnet"===String(t).toLowerCase()||"signet"===String(t).toLowerCase()||"regtest"===String(t).toLowerCase()?e.networks.testnet:e.networks.bitcoin}function Db(){const e="undefined"!=typeof window&&window.__NEXUS_NETWORK__||"mainnet",t=String(e).toLowerCase();return"testnet"===t||"signet"===t||"regtest"===t?"testnet":"mainnet"}function zb(e,t,n,r){if(n?.scriptPubKey&&"string"==typeof n.scriptPubKey&&/^[0-9a-fA-F]+$/.test(n.scriptPubKey))return Buffer.from(n.scriptPubKey,"hex");const i=n?.address||r;if(!i)throw new Error("Missing address for input script");return e.address.toOutputScript(i,t)}function Wb(e){const t=Number(e);return Number.isFinite(t)?Math.max(0,Math.floor(t)):null}function Vb(e){if(!e)return null;if("function"==typeof e.toBuffer)return e.toBuffer();if("function"==typeof e.toBase64)try{return Buffer.from(e.toBase64(),"base64")}catch{return null}return null}function jb(e){try{const t=e?.data?.globalMap;t&&(t.globalXpub&&delete t.globalXpub,Array.isArray(t.unknownKeyVals)&&(t.unknownKeyVals=[]));const n=Array.isArray(e?.data?.inputs)?e.data.inputs:[];for(const e of n)e&&(e.nonWitnessUtxo&&delete e.nonWitnessUtxo,e.bip32Derivation&&delete e.bip32Derivation,e.tapBip32Derivation&&delete e.tapBip32Derivation,e.redeemScript&&delete e.redeemScript,e.witnessScript&&delete e.witnessScript,e.tapInternalKey&&delete e.tapInternalKey,e.tapMerkleRoot&&delete e.tapMerkleRoot,e.tapLeafScript&&delete e.tapLeafScript,e.tapScriptSig&&delete e.tapScriptSig,Array.isArray(e.unknownKeyVals)&&(e.unknownKeyVals=[]),Array.isArray(e.proprietaryKeyVals)&&(e.proprietaryKeyVals=[]));const r=Array.isArray(e?.data?.outputs)?e.data.outputs:[];for(const e of r)e&&(e.bip32Derivation&&delete e.bip32Derivation,e.tapBip32Derivation&&delete e.tapBip32Derivation,Array.isArray(e.unknownKeyVals)&&(e.unknownKeyVals=[]),Array.isArray(e.proprietaryKeyVals)&&(e.proprietaryKeyVals=[]))}catch{}return e}function qb(e,t){if("bigint"!=typeof e)throw new Error(`${t}: expected bigint`);if(e<0n)throw new Error(`${t}: negative value`);if(e>BigInt(Number.MAX_SAFE_INTEGER))throw new Error(`${t}: value too large for JS number (${e.toString()})`);return Number(e)}function Kb(){try{return"undefined"!=typeof window&&!!window.__OODL_DEBUG__}catch{return!1}}function Xb(e,t){const n=(e||[]).map(e=>String(e||"")).filter(Boolean),r=new Set,i=new Set;for(const a of n)r.has(a)?i.add(a):r.add(a);if(i.size>0){const e=`${t}: duplicate inputs detected: ${Array.from(i).join(", ")}`;throw Kb(),new Error(e)}}function Gb(e){return e?.__CACHE?.__TX||e?.data?.globalMap?.unsignedTx?.tx||null}function Yb(e,t){const n=Buffer.isBuffer(e)?e:Buffer.from(e||[]),r=Buffer.isBuffer(t)?t:Buffer.from(t||[]);return n.length===r.length&&n.equals(r)}function Jb(e){try{const t=Gb(e);if(!t)return null;if("function"==typeof t.getId)return t.getId();if("function"==typeof t.getHash){const e=t.getHash();if(e&&32===Buffer.from(e).length)return Buffer.from(e).reverse().toString("hex")}return null}catch{return null}}function Qb(e,t,n){const r=e.Psbt.fromHex(t,{network:n});try{r.finalizeAllInputs()}catch(a){for(let e=0;e<r.data.inputs.length;e++)try{r.data.inputs[e].finalScriptWitness||r.data.inputs[e].finalScriptSig||r.finalizeInput(e)}catch(cC){}}const i=r.extractTransaction();return{txHex:i.toHex(),txid:i.getId()}}async function Zb(e,t,n,r={}){const i=await Xg(e,t,{autoFinalized:!1,toSignInputs:n,...r},!1);return i?.signedPsbt||null}async function ew({parentUtxo:e,fundingUtxo:t,fundingUtxos:n,listingScriptAddress:r,markerValueSats:i,dummyScript:a,dummyValueSats:o,dummyCount:s=0,sellerChangeAddress:l,feeRateSatPerVb:c,paymentPublicKey:u=null,bitcoinLib:d=null,oodlFeeAddress:f=null,oodlFeeSats:p=null}){const m=d||await gg(),h=Hb(m),g=kb(e,l);if(!g)throw new Error("buildListingCommitTx: invalid parentUtxo");const y=[];t&&y.push(t),Array.isArray(n)&&y.push(...n);const b=`${g.txid}:${g.vout}`,w=Ab(y.map(e=>kb(e,l)).filter(Boolean).filter(e=>`${e.txid}:${e.vout}`!==b));if(0===w.length)throw new Error("buildListingCommitTx: invalid fundingUtxo");if(!r||"string"!=typeof r)throw new Error("buildListingCommitTx: listingScriptAddress is required");const x=Wb(g.value);if(!x||x<=0)throw new Error("buildListingCommitTx: parentUtxo.value must be > 0");const v=Wb(i);if(!v||v<=0)throw new Error("buildListingCommitTx: markerValueSats must be > 0");const S=546,E=null==g?.offset?void 0:Number(g.offset);if(!Number.isFinite(E)||E<0||E>=x)throw new Error("buildListingCommitTx: parentUtxo.offset is required and must be within [0, value-1] to safely align the inscription for sale");const I=E,k=I>0&&I<S,A=Math.max(0,Math.floor(Number(s||0))),N=A>0?Wb(o):0;if(A>0){if(!a||!Buffer.isBuffer(a)||0===a.length)throw new Error("buildListingCommitTx: dummyScript (Buffer) is required when dummyCount > 0");if(!N||N<=0)throw new Error("buildListingCommitTx: dummyValueSats must be > 0 when dummyCount > 0")}const T=e=>"string"==typeof e&&e.startsWith("bc1p")?"p2tr":"p2wpkh",_=e=>"p2tr"===T(e?.address)?58:68,P=e=>"p2tr"===T(e)?43:31,B=(e,{hasPrefix:t,prefixAddress:n=null,hasRemainder:r,hasChange:i,dummyCount:a})=>{const o=_(g),s=(e||[]).reduce((e,t)=>e+_(t),0);let c=0;return t&&(c+=P(n||g.address||l)),c+=P(g.address||l),c+=43,a&&Number(a)>0&&(c+=43*Math.max(0,Math.floor(Number(a||0)))),z>0&&(c+=43),i&&(c+=P(l)),10+o+s+c+6},C=x-I;if(C<S)throw new Error(`buildListingCommitTx: aligned inscription output would be dust. parentValue=${x} offset=${I} alignedValue=${C} dust=546`);const O=w.slice().sort((e,t)=>(t.value||0)-(e.value||0)),L=k?Math.max(1,S-I):0,F=k&&O.find(e=>Wb(e?.value)>=L)||null;if(k&&!F)throw new Error(`buildListingCommitTx: inscription offset is too small to create a standard prefix output without OP_RETURN. Need a funding UTXO with >= ${L} sats to pad the prefix. Consolidate/split payment UTXOs and try again.`);const R=[];let U=0,M=0,$=!1,H=0,D=0;const z=p?Wb(p):0,W=new Set,V=(e,{countsTowardCosts:t})=>{const n=Wb(e?.value);if(!n||n<=0)return!1;const r=`${e.txid}:${e.vout}`;return!W.has(r)&&(W.add(r),R.push({...e,value:n}),U+=n,t&&(M+=n),!0)};F&&V(F,{countsTowardCosts:!1});const j=k?l:g.address||l;for(const fe of O){if(F&&`${fe.txid}:${fe.vout}`==`${F.txid}:${F.vout}`)continue;if(!V(fe,{countsTowardCosts:!0}))continue;const e=E>0,t=!1,n=A>0?N*A:0,r=Nb(c,B(R,{hasPrefix:e,prefixAddress:j,hasRemainder:t,hasChange:!1,dummyCount:A})),i=v+n+z+r;if(!(M<i)){if(M-i>S&&l){const r=Nb(c,B(R,{hasPrefix:e,prefixAddress:j,hasRemainder:t,hasChange:!0,dummyCount:A})),i=M-v-n-z-r;if(i>S){$=!0,H=i,D=r;break}}$=!1,H=0,D=r;break}}if(0===R.length)throw new Error("buildListingCommitTx: no usable funding UTXOs (all invalid/zero)");if(k&&R.length<2)throw new Error("buildListingCommitTx: need at least one additional funding UTXO (besides the padding UTXO) to fund listing outputs/fees. Select more payment UTXOs or consolidate and try again.");if(M<=v){const e=O[0],t=e?`${e.txid}:${e.vout}`:"unknown";throw new Error(`buildListingCommitTx: funding UTXO(s) are insufficient to fund marker output (fundingTotal=${M} sats, markerValue=${v} sats, largestFundingOutpoint=${t})`)}if($&&(!l||"string"!=typeof l))throw new Error("buildListingCommitTx: sellerChangeAddress is required when change output is needed");const q=zb(m,h,g,l),K=m.address.toOutputScript(r,h),X=$?m.address.toOutputScript(l,h):null,G=new m.Psbt({network:h}),Y=F?`${F.txid}:${F.vout}`:null,J=Y?R.filter(e=>`${e.txid}:${e.vout}`!==Y):R;Xb([...Y?[Y]:[],`${g.txid}:${g.vout}`,...J.map(e=>`${e.txid}:${e.vout}`)],"buildListingCommitTx");const Q=[],Z=e=>{const t=e?.address||l;let n,r={};if(u&&(t.startsWith("3")||t.startsWith("2"))){const e=Buffer.from(u,"hex"),t=m.payments.p2wpkh({pubkey:e,network:h});n=m.payments.p2sh({redeem:t,network:h}).output,r.redeemScript=t.output,Kb()}else n=zb(m,h,e,l);const i=Array.isArray(G?.data?.inputs)?G.data.inputs.length:0;G.addInput({hash:e.txid,index:e.vout,witnessUtxo:{script:n,value:Wb(e.value)},sequence:4294967293,...r}),Q.push({txid:e.txid,vout:e.vout,value:Wb(e.value),address:e.address||l,inputIndex:i})};if(Y){const e=R.find(e=>`${e.txid}:${e.vout}`===Y);if(!e)throw new Error("buildListingCommitTx: internal error: padder missing from selected funding");Z(e)}const ee=Array.isArray(G?.data?.inputs)?G.data.inputs.length:0;G.addInput({hash:g.txid,index:g.vout,witnessUtxo:{script:q,value:x},sequence:4294967293}),J.forEach(Z);const te=I,ne=x-te;let re,ie=0;if(te>0){const e=Y?Wb(F?.value):0,t=te+(k?e:0),n=k?m.address.toOutputScript(l,h):q;G.addOutput({script:n,value:t}),ie++}re=ie,G.addOutput({script:q,value:ne}),ie++;const ae=ie;G.addOutput({script:K,value:v}),ie++;const oe=[];if(A>0)for(let fe=0;fe<A;fe++)oe.push(ie),G.addOutput({script:a,value:N}),ie++;const se=oe[0];if(z>0&&f){const e=m.address.toOutputScript(f,h);G.addOutput({script:e,value:z}),ie++}let le;$&&(le=ie,G.addOutput({script:X,value:H}),ie++);const ce=Y?Wb(F?.value):0,ue=U-ce-v-(A>0?N*A:0)-z-($?H:0);if(ue<=0)throw new Error("buildListingCommitTx: computed fee <= 0 (insufficient funding)");const de=Jb(G);if(Kb()){const e=Vb(G);e&&e.length,(()=>{try{return e?m.crypto.sha256(e).toString("hex"):null}catch{return null}})()}return{psbt:G,summary:{commitPsbtBase64:G.toBase64(),unsignedCommitTxid:de,parentInputIndex:ee,parentInput:{txid:g.txid,vout:g.vout,value:x},fundingInputs:Q,parentOutputIndex:re,parentOutputValueSats:ne,listingScriptOutputIndex:ae,...A>0?{dummyOutputIndex:se}:{},dummyOutputIndexes:oe,dummyCount:A,...$?{changeOutputIndex:le}:{},feeSats:ue}}}const tw=Object.freeze(Object.defineProperty({__proto__:null,buildListingCommitTx:ew,createAndBroadcast3TxSaleListingFlow:async function({walletProvider:e,parentUtxo:t,fundingUtxo:r,fundingUtxos:i,listingScriptAddress:a,markerValueSats:o,sellerChangeAddress:s,feeRateSatPerVb:l,marker:c,bitcoinLib:u=null,broadcast:d=!0,batchSignOfferAndCommit:f=!1,batchSignCommitAndReveal:p=!1,oodlFeeAddress:m=null,oodlFeeSats:h=null,emitOpReturnMarker:g=!1,emitParcelHintOpReturn:y=!1,maxOfferBytesForFunding:b=5e3,compressEmbeddedOffer:w=!1}){if(!e)throw new Error("createAndBroadcast3TxSaleListingFlow: walletProvider is required");if(!c||"object"!=typeof c)throw new Error("createAndBroadcast3TxSaleListingFlow: marker is required");const x=u||await gg(),v=Hb(x),S=e?.getState?.()||{},E=(()=>{const e=S?.ordinalsPublicKey||null;if(!e||"string"!=typeof e)return null;const t=e.startsWith("0x")?e.slice(2):e;return/^[0-9a-fA-F]{64}$/.test(t)||/^[0-9a-fA-F]{66}$/.test(t)?t:null})(),I=(()=>{const e=S?.paymentPublicKey||S?.publicKey||null;if(!e||"string"!=typeof e)return null;const t=e.startsWith("0x")?e.slice(2):e;return/^[0-9a-fA-F]{64}$/.test(t)||/^[0-9a-fA-F]{66}$/.test(t)?t:null})(),k=E?64===E.length?Buffer.from(E,"hex"):66===E.length?Buffer.from(E.slice(2),"hex"):null:null,A=I?64===I.length?Buffer.from(I,"hex"):66===I.length?Buffer.from(I.slice(2),"hex"):null:null,N=e=>{const t="string"==typeof e?e:"";if(!t)return null;const n=S?.ordinalsAddress||S?.address||"",r=S?.paymentAddress||S?.address||"";return t&&n&&t===n?k:t&&r&&t===r?A:null},T=kb(t,s);if(!T)throw new Error("createAndBroadcast3TxSaleListingFlow: invalid parentUtxo");const _=[];r&&_.push(r),Array.isArray(i)&&_.push(...i);const P=`${T.txid}:${T.vout}`,B=Ab(_.map(e=>kb(e,s)).filter(Boolean).filter(e=>`${e.txid}:${e.vout}`!==P));if(0===B.length)throw new Error("createAndBroadcast3TxSaleListingFlow: invalid fundingUtxo");const C=B.slice().sort((e,t)=>(t.value||0)-(e.value||0))[0];if(!T.address)throw new Error("createAndBroadcast3TxSaleListingFlow: parentUtxo.address is required");C&&!C.address&&(C.address=s),!I&&B.some(e=>{const t=e?.address||s;return t&&(t.startsWith("3")||t.startsWith("2"))});let O=null,L=a&&"string"==typeof a?a:null;const F=!1!==w?14:9;if(!L){const t=Tb(Db()),n=await(async()=>{try{const t=e?.getState?.()?.ordinalsAddress||s;if(!t)throw new Error("no reveal recipient address for sizing");const n=x.address.toOutputScript(t,v),r=1,i=new x.Psbt({network:v}),a=Buffer.alloc(32,0),o=4294967294,l=4294967295,u={script:Buffer.from("0014"+"00".repeat(20),"hex"),value:1};i.addInput({hash:a,index:o,sequence:4294967293,witnessUtxo:u}),i.addInput({hash:a,index:l,sequence:4294967293,witnessUtxo:u});const d="11".repeat(32),f=(x.Transaction?.SIGHASH_SINGLE??3)|(x.Transaction?.SIGHASH_ANYONECANPAY??128);i.addInput({hash:d,index:0,witnessUtxo:{script:Buffer.from(n),value:r},sighashType:f,sequence:4294967293});try{const e="string"==typeof T.address&&(T.address.startsWith("bc1p")||T.address.startsWith("tb1p")),t=N(T.address)||k;e&&t&&i?.data?.inputs?.[2]&&(i.data.inputs[2].tapInternalKey=t)}catch{}i.addOutput({address:D,value:0}),i.addOutput({address:D,value:1}),i.addOutput({address:D,value:1});try{i?.data?.inputs?.[2]&&(i.data.inputs[2].tapKeySig=Buffer.alloc(65,1))}catch{}jb(i);const p=Vb(i);if(!p)throw new Error("failed to serialize dummy offer PSBT");const m=await Fb(p,{marker:c,compress:!1!==w});return Math.max(0,m?.length||0)}catch{const e=Math.max(0,Math.floor(Number(b??5e3)));return F+e+64}})(),r=2,i=Math.max(1,Math.min(64,Math.ceil(n/t)+r));if(O=await async function(e,t,n=64){if(!e||!e.script||!e.opcodes)throw new Error("bitcoinLib not loaded \u2014 script.compile unavailable. Ensure loadBitcoinLibFromInscription() resolved before calling buildTaprootDataCarrierArtifacts.");const r=Math.max(0,Math.floor(Number(n||0)));if(!Number.isFinite(r)||r<=0)throw new Error("buildTaprootDataCarrierArtifacts: maxChunks must be a positive integer");const{xOnlyPubKey:i,privateKey:a}=await xg();if(!window.secp256k1)throw new Error("window.secp256k1 not found");const o=window.secp256k1;function s(){for(let e=0;e<16;e++){const e=Buffer.from(crypto.getRandomValues(new Uint8Array(32)));if(o.utils.isValidSecretKey(e))return e}throw new Error("Failed to generate internal private key")}let l=s(),c=o.getPublicKey(l,!0);if(!c)throw new Error("Failed to derive internal pubkey");let u=Buffer.from(c).slice(1,33);u.equals(i)&&(l=s(),c=o.getPublicKey(l,!0),u=Buffer.from(c).slice(1,33));const d=Array.from({length:r},()=>e.opcodes.OP_DROP),f=e.script.compile([...d,i,e.opcodes.OP_CHECKSIG]),p={output:f,redeemVersion:192},m=e.payments.p2tr({internalPubkey:u,scriptTree:p,redeem:p,network:t});if(!m?.address)throw new Error("Failed to derive data-carrier p2tr address");const h=m.witness?.[m.witness.length-1];if(!h)throw new Error("No control block for data-carrier");const g=lg(e.crypto,f,192);return{local:{privateKey:a,xOnlyPubKey:i},witnessScript:f,controlBlock:h,taprootPayment:m,leafVersion:192,leafHash:g,tapLeafHashHex:g.toString("hex"),maxChunks:r}}(x,v,i),L=O?.taprootPayment?.address||null,!L)throw new Error("createAndBroadcast3TxSaleListingFlow: failed to auto-generate listing script address")}if(!O)throw new Error("createAndBroadcast3TxSaleListingFlow: listingScriptAddress must be left blank. Full on-chain PSBT embedding requires an auto-generated Taproot data-carrier output.");const R=Math.max(1,Math.floor(Number(O?.maxChunks||64))),U=null==o;let M=U?2e3:o;const $=zb(x,v,T,s),H=Wb(T.value);if(!H||H<=0)throw new Error("createAndBroadcast3TxSaleListingFlow: parentUtxo.value must be > 0");if(void 0===T.offset||null===T.offset){const e=await async function(e){const t=vh(e);if(!t)return null;try{const e=await Sh(t),n=e?.satpoint||e?.location||e?.output||null;if(!n||"string"!=typeof n)return null;const r=n.split(":");if(r.length<3)return null;const i=Number(r[2]);return!Number.isFinite(i)||i<0?null:Math.floor(i)}catch{return null}}(c?.parentInscriptionId);null!=e&&(T.offset=e,Kb())}const D=(c?.sellerAddress&&"string"==typeof c.sellerAddress?c.sellerAddress:null)||s,z=Wb(T.value),W=null==T?.offset?null:Number(T.offset);if(!z||z<=0)throw new Error("createAndBroadcast3TxSaleListingFlow: parentUtxo.value must be > 0");if(!Number.isFinite(W)||W<0||W>=z)throw new Error("createAndBroadcast3TxSaleListingFlow: parentUtxo.offset is required and must be within [0, value-1]");const V=BigInt(z-W);if(V<=0n)throw new Error("createAndBroadcast3TxSaleListingFlow: computed postage must be > 0");const j=Tb(Db());let q=c?.postageSats;if("number"==typeof q&&(q=BigInt(Math.floor(q))),"string"==typeof q&&(q=BigInt(q)),null==q)q=V;else{if("bigint"!=typeof q)throw new Error("createAndBroadcast3TxSaleListingFlow: marker.postageSats must be bigint|number|string");if(q<=0n)throw new Error("createAndBroadcast3TxSaleListingFlow: marker.postageSats must be > 0");if(q!==V)throw new Error(`createAndBroadcast3TxSaleListingFlow: marker.postageSats must equal the actual inscription UTXO value after alignment (marker=${q.toString()} computed=${V.toString()})`)}let K=c?.priceSats;if("number"==typeof K&&(K=BigInt(Math.floor(K))),"string"==typeof K&&(K=BigInt(K)),"bigint"!=typeof K)throw new Error("createAndBroadcast3TxSaleListingFlow: marker.priceSats must be bigint|number|string");if(K<=0n)throw new Error("createAndBroadcast3TxSaleListingFlow: sale price must be > 0 sats");const X=(x.Transaction?.SIGHASH_SINGLE??3)|(x.Transaction?.SIGHASH_ANYONECANPAY??128);let G=null,Y=null,J=null;const Q=Math.max(0,Math.floor(Number(b??5e3))),Z=F+Q,ee=await(async()=>{if(!g)return null;const e=x.address.toOutputScript(D,v),t=x.crypto.sha256(e).toString("hex");return xb({...c||{},version:2,openStoreVersion:1,sellerScriptHashHex:t,postageSats:q.toString(),psbtHashHex:"0".repeat(64)},x)})(),te=await(async()=>{if(!y)return null;if("parcel"!==String(c?.collectionKey||"").toLowerCase())return null;const e=Number(c?.parcelNumber),t=Number(c?.bitmapNumber);if(!Number.isFinite(e)||e<0)return null;if(!Number.isFinite(t)||t<0)return null;try{return await Sb({parcelNumber:Math.floor(e),bitmapNumber:Math.floor(t)},x)}catch{return null}})();for(let n=0;n<6;n++){const e=await ew({parentUtxo:T,fundingUtxo:C,fundingUtxos:B,listingScriptAddress:L,markerValueSats:M,dummyCount:0,sellerChangeAddress:s,feeRateSatPerVb:l,paymentPublicKey:I,bitcoinLib:x,oodlFeeAddress:null,oodlFeeSats:null});if(G=e.psbt,Y=e.summary,J=Y?.unsignedCommitTxid,!J)throw new Error("createAndBroadcast3TxSaleListingFlow: failed to compute commit txid");Y.changeOutputIndex;try{const e="string"==typeof T.address&&(T.address.startsWith("bc1p")||T.address.startsWith("tb1p")),t=N(T.address)||k;e&&t&&G?.data?.inputs?.[0]&&(G.data.inputs[0].tapInternalKey=t);for(const n of Y?.fundingInputs||[]){const e=Number(n?.inputIndex);if(!Number.isFinite(e)||e<0)continue;const t=n?.address||s,r="string"==typeof t&&(t.startsWith("bc1p")||t.startsWith("tb1p")),i=N(t)||A;r&&i&&G?.data?.inputs?.[e]&&(G.data.inputs[e].tapInternalKey=i)}}catch{}if(!U)break;const t=R*j,n=Math.min(Z,t),r=Math.max(1,Math.ceil(n/j));!O||Buffer.from(O.witnessScript).length;const i=e=>{const t=new x.Transaction;t.version=2,t.addInput(Buffer.from(J,"hex").reverse(),Y.parentOutputIndex,4294967293),t.addInput(Buffer.from(J,"hex").reverse(),Y.listingScriptOutputIndex,4294967293),t.addOutput(Buffer.from($),Wb(Y.parentOutputValueSats));const n=h?Wb(h):0;if(n>0&&m){const e=x.address.toOutputScript(m,v);t.addOutput(e,n)}if(ee&&t.addOutput(ee,0),te&&t.addOutput(te,0),e){const e=x.address.toOutputScript(s,v);t.addOutput(e,1e3)}t.ins[0].witness=[Buffer.alloc(65,0)];const i=Buffer.from(O.witnessScript),a=Buffer.from(O.controlBlock),o=Array.from({length:R},(e,t)=>t<r?Buffer.alloc(j,0):Buffer.alloc(0));t.ins[1].witness=[Buffer.alloc(65,0),...o,i,a];const l="function"==typeof t.virtualSize?t.virtualSize():"function"==typeof t.weight?Math.ceil(t.weight()/4):400;return Number(l)||400},a=546,o=25,c=Nb(l,i(!1)),u=h?Wb(h):0,d=c+u+o,f=Nb(l,i(!0))+u+a+o,p=s?Math.max(d,f):d;if(p<=Wb(M))break;M=p}let ne=null;const re=[{index:Y?.parentInputIndex??0,address:T.address},...(Y?.fundingInputs||[]).map(e=>({index:e.inputIndex,address:e.address||s}))];if(ne=await async function(e,t,n){const r=await Xg(e,t,{autoFinalized:!0,toSignInputs:n},!1);return r?.signedPsbt||null}(e,G.toHex(),re),!ne)throw new Error("createAndBroadcast3TxSaleListingFlow: wallet did not return signed commit PSBT");let ie=J;try{x.Psbt.fromHex(ne,{network:v});const e=x.Psbt.fromHex(ne,{network:v});try{e.finalizeAllInputs()}catch(Ue){for(let t=0;t<e.data.inputs.length;t++)try{e.data.inputs[t].finalScriptWitness||e.data.inputs[t].finalScriptSig||e.finalizeInput(t)}catch{}}ie=e.extractTransaction().getId(),String(ie).toLowerCase(),String(J).toLowerCase(),String(ie).toLowerCase(),String(J).toLowerCase()}catch(Me){throw new Error("createAndBroadcast3TxSaleListingFlow: failed to compute finalized commit txid")}J=ie;let ae=null,oe=null,se=null;if(d){const t=await async function(e,t,n,r){const{txHex:i,txid:a}=Qb(n,t,r);return{txid:await Gg(e,{txHex:i,psbtBase64:Buffer.from(t,"hex").toString("base64")},Db(),"oodl-listing-commit")||a,txHex:i,actualTxid:a}}(e,ne,x,v);ae=t?.txid||null,oe=t?.txHex||null,se=t?.actualTxid||t?.txid||null,String(se).toLowerCase(),String(J).toLowerCase()}else{const e=Qb(x,ne,v);oe=e?.txHex||e,se=e?.txid||null}const le=se||ae||J,ce=`${le}:${Y.parentOutputIndex}`,ue=`${le}:${Y.listingScriptOutputIndex}`,de=Wb(M);if(!de||de<=0)throw new Error("createAndBroadcast3TxSaleListingFlow: markerValueSats must be > 0");const fe=h?Wb(h):0;if(fe>0&&!m)throw new Error("createAndBroadcast3TxSaleListingFlow: oodlFeeAddress is required when oodlFeeSats > 0");const pe=e?.getState?.()?.ordinalsAddress||s,me=await(async()=>{if(!g)return null;const e=x.address.toOutputScript(D,v),t=x.crypto.sha256(e).toString("hex");return xb({...c||{},version:2,openStoreVersion:1,sellerScriptHashHex:t,postageSats:q.toString(),psbtHashHex:"0".repeat(64)},x)})(),he=await(async()=>{if(!y)return null;if("parcel"!==String(c?.collectionKey||"").toLowerCase())return null;const e=Number(c?.parcelNumber),t=Number(c?.bitmapNumber);if(!Number.isFinite(e)||e<0)return null;if(!Number.isFinite(t)||t<0)return null;try{return await Sb({parcelNumber:Math.floor(e),bitmapNumber:Math.floor(t)},x)}catch{return null}})(),ge=546,ye=e=>{const t=new x.Psbt({network:v});{const e=N(T.address);t.addInput({hash:le,index:Y.parentOutputIndex,witnessUtxo:{script:$,value:Wb(Y.parentOutputValueSats)},sequence:4294967293,...e?{tapInternalKey:Buffer.from(e)}:{}})}t.addInput({hash:le,index:Y.listingScriptOutputIndex,witnessUtxo:{script:Buffer.from(O.taprootPayment.output),value:de},sequence:4294967293,tapLeafScript:[{controlBlock:Buffer.from(O.controlBlock),leafVersion:O.leafVersion,script:Buffer.from(O.witnessScript)}]}),t.addOutput({address:pe,value:Wb(Y.parentOutputValueSats)}),fe>0&&t.addOutput({address:m,value:fe}),me&&t.addOutput({script:me,value:0}),he&&t.addOutput({script:he,value:0});const n=Wb(e);s&&Number.isFinite(n)&&n>=ge&&t.addOutput({address:s,value:Math.floor(n)});const r=Gb(t),i=r?.outs||[];if(!i[0]||Wb(i[0].value)!==Wb(Y.parentOutputValueSats))throw new Error("createAndBroadcast3TxSaleListingFlow: TX2 invariant failed (output[0] must be listing output)");if(fe>0&&(!i[1]||Wb(i[1].value)!==fe))throw new Error("createAndBroadcast3TxSaleListingFlow: TX2 invariant failed (output[1] must be indexing output)");return t},be=({changeValueSats:e,paddedOfferChunks:t})=>{const n=new x.Transaction;if(n.version=2,n.addInput(Buffer.from(le,"hex").reverse(),Y.parentOutputIndex,4294967293),n.addInput(Buffer.from(le,"hex").reverse(),Y.listingScriptOutputIndex,4294967293),n.addOutput(Buffer.from($),Wb(Y.parentOutputValueSats)),fe>0){const e=x.address.toOutputScript(m,v);n.addOutput(e,fe)}me&&n.addOutput(me,0),he&&n.addOutput(he,0);const r=Wb(e);if(s&&Number.isFinite(r)&&r>=ge){const e=x.address.toOutputScript(s,v);n.addOutput(e,Math.floor(r))}n.ins[0].witness=[Buffer.alloc(65,0)];const i=Buffer.from(O.witnessScript),a=Buffer.from(O.controlBlock);n.ins[1].witness=[Buffer.alloc(65,0),...t||[],i,a];const o="function"==typeof n.virtualSize?n.virtualSize():"function"==typeof n.weight?Math.ceil(n.weight()/4):400;return Number(o)||400},we=async t=>{const r=((e,t,n)=>{const r=new x.Psbt({network:v});if(null!=c?.minBlockHeight){const e=Number(c.minBlockHeight);if(!Number.isFinite(e)||e<0||e>4294967295||!Number.isInteger(e))throw new Error("createAndBroadcast3TxSaleListingFlow: marker.minBlockHeight must be a uint32");try{"function"==typeof r.setLocktime?r.setLocktime(e>>>0):r.__CACHE?.__TX&&(r.__CACHE.__TX.locktime=e>>>0)}catch{throw new Error("createAndBroadcast3TxSaleListingFlow: failed to set offer PSBT locktime")}}const i=Buffer.alloc(32,0),a={script:Buffer.from("0014"+"00".repeat(20),"hex"),value:1};r.addInput({hash:i,index:4294967294,sequence:4294967293,witnessUtxo:a}),r.addInput({hash:i,index:4294967295,sequence:4294967293,witnessUtxo:a});const o=Wb(n);if(!o||o<=0)throw new Error("createAndBroadcast3TxSaleListingFlow: listedUtxoValueSats must be > 0");r.addInput({hash:e,index:0,witnessUtxo:{script:Buffer.from(t),value:o},sighashType:X,sequence:4294967293});try{const e="string"==typeof T.address&&(T.address.startsWith("bc1p")||T.address.startsWith("tb1p")),t=N(T.address)||k;e&&t&&r?.data?.inputs?.[2]&&(r.data.inputs[2].tapInternalKey=t)}catch{}Xb([`${Buffer.from(i).toString("hex")}:4294967294`,`${Buffer.from(i).toString("hex")}:4294967295`,`${Buffer.isBuffer(e)?Buffer.from(e).reverse().toString("hex"):e}:0`],"createAndBroadcast3TxSaleListingFlow:offerPsbt"),r.addOutput({address:D,value:0}),r.addOutput({address:D,value:qb(q,"postageSats")});const s=BigInt(o),l=K+(s>q?s-q:0n);return r.addOutput({address:D,value:qb(l,"sellerPayout")}),r})(t,x.address.toOutputScript(pe,v),Wb(Y.parentOutputValueSats)),{assertOpenStoreSellerOfferSignedCorrectly:i}=await n(async()=>{const{assertOpenStoreSellerOfferSignedCorrectly:e}=await Promise.resolve().then(()=>BB);return{assertOpenStoreSellerOfferSignedCorrectly:e}},__VITE_PRELOAD__),a={index:2,address:T.address,...E?{publicKey:E}:{},sighashType:X,sighashTypes:[X]};let o=null;try{o=await Zb(e,r.toHex(),[a],{sighashTypes:[X]})}catch{o=null}if(!o)return{ok:!1,offerPsbt:r};const s=x.Psbt.fromHex(o,{network:v});try{i({unsignedOfferPsbt:r,signedOfferPsbt:s,sellerInputIndex:2,expectedSighashByte:X})}catch{return{ok:!1,offerPsbt:r}}try{s?.data?.inputs?.[2]&&(s.data.inputs[2].sighashType=X)}catch{}jb(s);const l=Vb(s);if(!l)throw new Error("createAndBroadcast3TxSaleListingFlow: failed to serialize signed offer PSBT");const u=await Fb(l,{marker:c,compress:!1!==w}),d=function(e,t=80){const n=Buffer.isBuffer(e)?e:Buffer.from(e),r=Math.max(1,Math.floor(Number(t||80))),i=[];for(let a=0;a<n.length;a+=r)i.push(n.subarray(a,a+r));return i}(u,j);if(d.length>R){const e=R*j;throw new Error(`Signed seller PSBT too large to embed on-chain. bytes=${u.length} capacity\u2248${e} (chunks=${d.length} maxChunks=${R} chunkSize=${j}). Reduce PSBT size (wallet metadata can bloat it) or increase the carrier maxChunks and re-list.`)}const f=Array.from({length:R},(e,t)=>d[t]||Buffer.alloc(0)),p=x.crypto.sha256(u).toString("hex");return{ok:!0,offerPsbt:r,signedOfferPsbtHex:o,signedOfferPsbt:s,framedOfferBytes:u,offerChunks:d,paddedOfferChunks:f,offerHashHex:p}};let xe=ye(0),ve=Jb(xe);if(!ve)throw new Error("createAndBroadcast3TxSaleListingFlow: failed to compute TX2 txid (phase A provisional)");let Se=await we(ve);if(!Se?.ok)return{mode:"needs-external-signer",predictedCommitTxid:le,predictedRevealTxid:ve,unsignedCommitPsbtBase64:G.toBase64(),unsignedSellerListingPsbtBase64:Se.offerPsbt.toBase64(),unsignedSellerListingPsbtHex:Se.offerPsbt.toHex(),requiredSighashType:X,message:"Wallet refused to sign seller offer PSBT (SIGHASH_SINGLE|ANYONECANPAY)."};be({changeValueSats:0,paddedOfferChunks:Se.paddedOfferChunks});const Ee=Nb(l,be({changeValueSats:ge,paddedOfferChunks:Se.paddedOfferChunks}))+5,Ie=de-fe-Ee;let ke=0;if(s&&Number.isFinite(Ie)&&Ie>=ge&&(ke=Ie),ke>0){const e=ye(ke),t=Jb(e);if(!t)throw new Error("createAndBroadcast3TxSaleListingFlow: failed to compute TX2 txid (phase A rebuilt)");if(String(t).toLowerCase()!==String(ve).toLowerCase()){if(xe=e,ve=t,Se=await we(ve),!Se?.ok)return{mode:"needs-external-signer",predictedCommitTxid:le,predictedRevealTxid:ve,unsignedCommitPsbtBase64:G.toBase64(),unsignedSellerListingPsbtBase64:Se.offerPsbt.toBase64(),unsignedSellerListingPsbtHex:Se.offerPsbt.toHex(),requiredSighashType:X,message:"Wallet refused to sign seller offer PSBT (SIGHASH_SINGLE|ANYONECANPAY)."}}else xe=e}const Ae=`${ve}:0`,Ne=Se.signedOfferPsbtHex,Te=Se.signedOfferPsbt,_e=Se.offerChunks,Pe=Se.paddedOfferChunks,Be=Se.offerHashHex,Ce=await Zb(e,xe.toHex(),[{index:0,address:T.address}]);if(!Ce)throw new Error("createAndBroadcast3TxSaleListingFlow: wallet did not return signed reveal PSBT");const Oe=x.Psbt.fromHex(Ce,{network:v});if(!Oe?.data?.inputs?.[1])throw new Error("createAndBroadcast3TxSaleListingFlow: missing TX2 carrier input[1]");Oe.data.inputs[1].extraWitnessStack=Pe,await vg(0,Oe,1,O.local.privateKey,O.leafHash),Oe.finalizeInput(1,Ng);try{Oe.data.inputs[0].finalScriptWitness||Oe.data.inputs[0].finalScriptSig||Oe.finalizeInput(0)}catch{}let Le=null;try{Le=Oe.extractTransaction().getId()}catch{Le=Jb(Oe)}if(!Le||String(Le).toLowerCase()!==String(ve).toLowerCase())throw new Error("createAndBroadcast3TxSaleListingFlow: TX2 txid changed after witness injection (should be impossible)");try{const e=Oe.extractTransaction(),t="function"==typeof e?.virtualSize?e.virtualSize():"function"==typeof e?.weight?Math.ceil(e.weight()/4):null;(e?.outs||[]).reduce((e,t)=>e+Number(t?.value||0),0),Number(Oe?.data?.inputs?.[0]?.witnessUtxo?.value||0),Number(Oe?.data?.inputs?.[1]?.witnessUtxo?.value||0),Number.isFinite(t)}catch{}!function({btc:e,revealPsbt:t,listingArtifacts:n,paddedOfferChunks:r,offerHashHex:i,psbtCarrierMaxChunks:a,carrierInputIndex:o=0}){const s=t.extractTransaction(),l=Number.isFinite(Number(o))?Number(o):0,c=s?.ins?.[l]?.witness||null;if(!Array.isArray(c)||0===c.length)throw new Error(`reveal: missing witness on input ${l} (expected tapscript-path spend)`);const u=Buffer.from(n.witnessScript),d=Buffer.from(n.controlBlock),f=1+a+2;if(c.length!==f)throw new Error(`reveal: unexpected witness item count (got=${c.length} expected=${f})`);const p=c[c.length-2],m=c[c.length-1];if(!Yb(p,u))throw new Error("reveal: witness script mismatch (payload not anchored to expected tapscript)");if(!Yb(m,d))throw new Error("reveal: control block mismatch");for(let y=0;y<a;y++){const e=c[1+y],t=r[y]||Buffer.alloc(0);if(!Yb(e,t))throw new Error(`reveal: witness chunk ${y} mismatch (len=${e?.length??0} expectedLen=${t.length})`)}const h=Buffer.concat((r||[]).filter(e=>(e?.length||0)>0)),g=e.crypto.sha256(h).toString("hex");if(String(g).toLowerCase()!==String(i).toLowerCase())throw new Error(`reveal: embedded offer hash mismatch (embedded=${g} expected=${i})`);s.getId(),c.length,h.length}({btc:x,revealPsbt:Oe,listingArtifacts:O,paddedOfferChunks:Pe,offerHashHex:Be,psbtCarrierMaxChunks:R,carrierInputIndex:1}),Kb();const Fe=Oe.extractTransaction().toHex();d&&await async function(e,t,{timeoutMs:n=2e4,pollMs:r=1500}={}){if(!mh())return!1;if("function"!=typeof fetch)return!1;if(!/^[0-9a-fA-F]{64}$/.test(String(e||"").trim()))return!1;const i=String(e).trim(),a=Date.now(),o=nh("testnet"===t?`/testnet/api/tx/${i}`:"regtest"===t?`/signet/api/tx/${i}`:`/api/tx/${i}`);for(;Date.now()-a<n;){try{if((await fetch(o,{method:"GET"})).ok)return!0}catch(s){}await Ib(r)}return!1}(le,Db(),{timeoutMs:2e4,pollMs:1500});const Re=d?await async function(e,t,n){const r="function"==typeof e?.getState&&e.getState()?.walletType||"",i=((r||e?.walletType||e?.name||"").toLowerCase?.()||"").includes("unisat");if("function"==typeof e?.pushTx&&!1!==e?.features?.pushTx){const n=String(t||"").trim();let r=null;const a=i?6:3,o=i?1500:800;for(let t=0;t<a;t+=1)try{const t=i?await e.pushTx({rawtx:n}):await e.pushTx(n);if("string"==typeof t&&64===t.length)return t}catch(cC){r=cC,await Ib(o)}Kb()}return await Gg(e,t,n,"oodl-sale-reveal")}(e,Fe,Db()):Oe.extractTransaction().getId();return{mode:"3tx-complete",commitTxid:le,commitTxHex:oe,predictedCommitTxid:J,parentOutpointAfterCommit:ce,listingFundingOutpoint:ue,listedOutpoint:Ae,sellerListingPsbtBase64:Te.toBase64(),sellerListingPsbtHashHex:Be,signedSellerListingPsbtHex:Ne,markerTxid:Re||null,markerTxHex:Fe,revealTxid:Re||null,revealTxHex:Fe,revealTxidLocal:d?null:Re,markerValueSats:de,listingScriptAddress:L,listingScriptAutoGenerated:!!O,sellerPsbtEmbeddedOnChain:!0,sellerPsbtWitnessChunks:_e.length,sellerPsbtWitnessChunkSize:j,broadcasted:!!d}},extractOodlListingMetadataFromRevealTxWithBitcoinLib:$b,extractSellerPsbtFromRevealTxWithBitcoinLib:Mb},Symbol.toStringTag,{value:"Module"}));function nw(e){const t=Number(e);return Number.isFinite(t)?Math.max(0,Math.floor(t)):null}function rw(e,t){try{if("bigint"==typeof e)return e;if("number"==typeof e){if(!Number.isFinite(e))throw new Error("not finite");return BigInt(Math.floor(e))}if("string"==typeof e){const t=String(e).trim();if(!t)throw new Error("empty");return BigInt(t)}throw new Error("unsupported type")}catch(cC){throw new Error(`${t}: invalid bigint (${cC?.message||cC})`)}}function iw(e){if("string"!=typeof e)return!1;const t=e.trim();return t.length>0&&t.length%2==0&&/^[0-9a-fA-F]+$/.test(t)}function aw(e){const t="undefined"!=typeof window&&window.__NEXUS_NETWORK__||"mainnet";return"testnet"===String(t).toLowerCase()||"signet"===String(t).toLowerCase()||"regtest"===String(t).toLowerCase()?e.networks.testnet:e.networks.bitcoin}function ow(){const e="undefined"!=typeof window&&window.__NEXUS_NETWORK__||"mainnet",t=String(e).toLowerCase();return"testnet"===t||"signet"===t||"regtest"===t?"testnet":"mainnet"}function sw(e){return e?String(e).split(":")[0].trim():e}function lw(e){const t=e?.output||e?.location||e?.satpoint;if(!t||"string"!=typeof t)return null;const n=t.split(":");if(n.length<2)return null;const r=String(n[0]||"").trim(),i=Number(n[1]);return/^[0-9a-f]{64}$/i.test(r)?!Number.isFinite(i)||i<0?null:{txid:r.toLowerCase(),vout:Math.floor(i)}:null}async function cw(e){const t=sw(e);if(!t)throw new Error("fetchOrdinalsInscriptionDetails: inscriptionId is required");const n=th(`/r/inscription/${t}`),r=await fetch(n);if(!r.ok)throw new Error(`Failed to fetch /r/inscription/${t} (status ${r.status})`);return await r.json()}function uw(e){const t=sw(e);if(!t)return null;const n=/^([0-9a-f]{64})i(\d+)$/i.exec(t);return n?{revealTxid:String(n[1]).toLowerCase(),inscriptionIndex:Number(n[2]),inscriptionId:t}:null}async function dw(e){const t=String(e||"").trim();if(!/^[0-9a-fA-F]{64}$/.test(t))throw new Error("fetchRawTxHexByTxid: txid must be 64 hex chars");const n=async e=>{const t=String(e?.headers?.get?.("content-type")||"").toLowerCase(),n=String(await e.text()||"").trim();if(iw(n))return n;if(t.includes("application/json")||n.startsWith("{")||n.startsWith("["))try{const e=JSON.parse(n),t=[e?.hex,e?.txHex,e?.rawtx,e?.rawTx,e?.data?.hex,e?.result?.hex].filter(e=>"string"==typeof e);for(const n of t){const e=String(n).trim();if(iw(e))return e}}catch{}const r=n.slice(0,200).toLowerCase();if(r.includes("<!doctype")||r.includes("<html")||r.includes("<head")||r.includes("<body"))return null;const i=n.match(/\b[0-9a-fA-F]{200,}\b/);return i&&iw(i[0])?i[0]:null},r=th(`/r/tx/${t}`),i=await fetch(r);if(i.ok){const e=await n(i);if(e)return e}try{const e="undefined"!=typeof window&&window.location&&window.location.hostname?String(window.location.hostname):"";if("ordinals.com"!==e&&!e.endsWith(".ordinals.com")){const e=await fetch(`https://ordinals.com/r/tx/${t}`);if(!e.ok)throw new Error(`fetchRawTxHexByTxid: failed (${e.status})`);const r=await n(e);if(r)return r}}catch{}throw new Error("fetchRawTxHexByTxid: response did not look like raw tx hex. This usually means your host is not proxying /r/tx to ordinals.com (it returned HTML/JSON).")}function fw(e){const t=Buffer.isBuffer(e)?e:Buffer.from(e||[]);return 34===t.length&&81===t[0]&&32===t[1]?"p2tr":22===t.length&&0===t[0]&&20===t[1]?"p2wpkh":34===t.length&&0===t[0]&&32===t[1]?"p2wsh":23===t.length&&169===t[0]&&20===t[1]&&135===t[22]?"p2sh":"unknown"}function pw(e){const t=String(e||"").toLowerCase();return t.startsWith("bc1p")||t.startsWith("tb1p")?"p2tr":"p2wpkh"}function mw(e){return"p2tr"===fw(e)?"p2tr":"p2wpkh"}function hw(e,t,n,r){const i=String(t||"").toLowerCase(),a=String(r||"").trim(),o=n?.getState?.()?.paymentPublicKey||null,s=a.startsWith("3")||a.startsWith("2");if(!("p2sh-p2wpkh"===i||s&&o))return{};try{const t=aw(e),n=Buffer.from(String(o),"hex"),r=e.payments.p2wpkh({pubkey:n,network:t});return r?.output?{redeemScript:r.output}:{}}catch{return{}}}function gw(e,t){const n=e.Transaction.fromHex(String(t||"").trim());for(let r=0;r<n.outs.length;r++){const t=n.outs[r],i=e.script.decompile(t.script)||[];if(i.length<2)continue;if(i[0]!==e.opcodes.OP_RETURN)continue;const a=i[1];if(!a||"number"==typeof a)continue;const o=wb(Uint8Array.from(a));if(o&&2===o.version&&!(Number(o.openStoreVersion||0)<1)&&1===Number(o.outputOrderVersion||0))return o}return null}function yw(e){if(!e)return null;const t=e?.locktime;if("number"==typeof t&&Number.isFinite(t))return t>>>0;const n=e?.__CACHE?.__TX;if(n&&"number"==typeof n.locktime&&Number.isFinite(n.locktime))return n.locktime>>>0;const r=e?.data?.globalMap?.unsignedTx;return r&&"number"==typeof r.locktime&&Number.isFinite(r.locktime)?r.locktime>>>0:null}async function bw(e){const t=e?.minBlockHeight,n=null!=t;if(!n)return null;const r=await ib(ow());if(!Number.isFinite(r))throw new Error("createAndBroadcastBuyFromRevealTx: failed to fetch current block height");if(n){const e=Number(t);if(!Number.isFinite(e)||e<0||!Number.isInteger(e))throw new Error("createAndBroadcastBuyFromRevealTx: invalid marker.minBlockHeight");if(r<e)throw new Error("createAndBroadcastBuyFromRevealTx: OODL_LISTING_NOT_YET_VALID")}return r}async function ww(e){if(null==e)return null;const t=Number(e);if(!Number.isFinite(t)||t<0||!Number.isInteger(t))throw new Error("createAndBroadcastBuyFromRevealTx: invalid minBlockHeight");const n=await ib(ow());if(!Number.isFinite(n))throw new Error("createAndBroadcastBuyFromRevealTx: failed to fetch current block height");if(n<t)throw new Error("createAndBroadcastBuyFromRevealTx: OODL_LISTING_NOT_YET_VALID");return n}function xw(e,t,{script:n,value:r}){const i=n?Buffer.from(n).toString("hex"):null,a=nw(r);"function"==typeof e.updateOutput&&e.updateOutput(t,{script:n,value:r});const o=e?.txOutputs?.[t]||null,s=o?.script?Buffer.from(o.script).toString("hex"):null,l=nw(o?.value);if(!(i&&s!==i||null!==a&&l!==a))return;const c=e?.__CACHE?.__TX;if(!c?.outs?.[t])throw new Error(`createAndBroadcastBuyFromRevealTx: cannot update output[${t}] on this bitcoinjs-lib version`);c.outs[t].script=Buffer.from(n),c.outs[t].value=Number(r);const u=e?.txOutputs?.[t]||c?.outs?.[t]||null,d=u?.script?Buffer.from(u.script).toString("hex"):null,f=nw(u?.value);if(i&&d!==i||null!==a&&f!==a)throw new Error(`createAndBroadcastBuyFromRevealTx: output[${t}] did not update as expected`)}function vw(e,t,n,r){const i=String(n||"").trim().toLowerCase();if(!/^[0-9a-f]{64}$/.test(i))throw new Error("forceReplaceInputOutpoint: txid must be 64 hex");const a=Number(r);if(!Number.isFinite(a)||a<0)throw new Error("forceReplaceInputOutpoint: vout must be >=0");const o=Buffer.from(i,"hex").reverse(),s=e?.__CACHE?.__TX||e?.data?.globalMap?.unsignedTx?.tx||null;if(!s?.ins?.[t])throw new Error(`forceReplaceInputOutpoint: missing unsigned tx input[${t}]`);s.ins[t].hash=o,s.ins[t].index=a,Array.isArray(e?.txInputs)&&e.txInputs[t]&&(e.txInputs[t].hash=o,e.txInputs[t].index=a)}function Sw(e){if(!e)return null;try{return Buffer.from(e).toString("hex")}catch{return null}}function Ew(e,t){try{const n=e?.txInputs?.[t];if(!n)return null;const r=n?.hash?Buffer.from(n.hash).reverse().toString("hex"):null,i="number"==typeof n?.index?n.index:"number"==typeof n?.vout?n.vout:null;return r&&null!==i?`${r.toLowerCase()}:${Math.floor(Number(i))}`:null}catch{return null}}function Iw(e){const t=[];for(let r=0;r<(e?.inputCount||0);r+=1)t.push(Ew(e,r));const n=(e?.txOutputs||[]).map(e=>({value:Number(e?.value??NaN),scriptHex:Sw(e?.script)}));return{inputCount:Number(e?.inputCount||0),outputCount:Number(e?.txOutputs?.length||0),prevouts:t,outputs:n}}function kw(e,t,n,r){const i=e?.txInputs?.[t]||null;if(!i)throw new Error(`${r}: Open Store offer missing input[${t}]`);const a=i?.hash?Buffer.from(i.hash):null,o=!(!a||32!==a.length||!a.equals(Buffer.alloc(32,0))),s="number"==typeof i?.index?i.index:null;if(!o||s!==n)throw new Error(`${r}: Open Store offer input[${t}] is not a placeholder sentinel`)}function Aw(e,{marker:t=null,context:n}){const r=n||"Open Store offer";if(3!==Number(e?.inputCount||0))throw new Error(`${r}: Open Store offer must have exactly 3 inputs`);const i=Number(e?.txOutputs?.length||0);if(t){const n=t?.platformFeeSats,a=(null==n?0n:rw(n,"marker.platformFeeSats"))>0n,o=a?4:3;if(i!==o)throw new Error(`${r}: Open Store offer output count mismatch (expected ${o}, got ${i})`);if(!a&&e?.txOutputs?.[3])throw new Error(`${r}: Open Store offer unexpectedly includes output[3] (platform fee)`)}else if(3!==i&&4!==i)throw new Error(`${r}: Open Store offer must have exactly 3 or 4 outputs`);kw(e,0,4294967294,r),kw(e,1,4294967295,r)}function Nw(e,{sellerInputIndex:t=2,inscriptionOutputIndex:n=1,sellerPayoutOutputIndex:r=2,platformFeeOutputIndex:i=3}={}){const a=Ew(e,t),o=Iw(e),s=e?.txOutputs?.[n]||null,l=e?.txOutputs?.[r]||null,c=e?.txOutputs?.[0]||null,u=e?.txOutputs?.[i]||null;return{inputCount:o.inputCount,outputCount:o.outputCount,prevouts:o.prevouts,outputs:o.outputs,sellerPrevout:a,buyerChangeOut:c?{idx:0,value:Number(c?.value??NaN),scriptHex:Sw(c?.script)}:null,inscriptionOut:{idx:n,value:Number(s?.value??NaN),scriptHex:Sw(s?.script)},sellerPayoutOut:{idx:r,value:Number(l?.value??NaN),scriptHex:Sw(l?.script)},platformFeeOut:u?{idx:i,value:Number(u?.value??NaN),scriptHex:Sw(u?.script)}:null}}function Tw(e,t,{sellerInputIndex:n=2,inscriptionOutputIndex:r=1,sellerPayoutOutputIndex:i=2,platformFeeOutputIndex:a=3}={}){!function(e,t){if(!e||!t)throw new Error("OODL_BUY_WALLET_MUTATED_UNKNOWN");if(Number(e?.inputCount||0)!==Number(t?.inputCount||0))throw new Error("OODL_BUY_WALLET_MUTATED_INPUT_COUNT");if(Number(e?.outputCount||0)!==Number(t?.txOutputs?.length||0))throw new Error("OODL_BUY_WALLET_MUTATED_OUTPUT_COUNT");const n=Iw(t),r=Array.isArray(e?.prevouts)?e.prevouts:[],i=Array.isArray(n?.prevouts)?n.prevouts:[];if(r.length!==i.length)throw new Error("OODL_BUY_WALLET_MUTATED_INPUTS");for(let s=0;s<r.length;s+=1)if(!r[s]||!i[s]||r[s]!==i[s])throw new Error("OODL_BUY_WALLET_MUTATED_INPUTS");const a=Array.isArray(e?.outputs)?e.outputs:[],o=Array.isArray(n?.outputs)?n.outputs:[];if(a.length!==o.length)throw new Error("OODL_BUY_WALLET_MUTATED_OUTPUTS");for(let s=0;s<a.length;s+=1){const e=a[s]||{},t=o[s]||{};if(!Number.isFinite(Number(e?.value))||!Number.isFinite(Number(t?.value))||Number(e.value)!==Number(t.value))throw new Error("OODL_BUY_WALLET_MUTATED_OUTPUTS");if(!e?.scriptHex||!t?.scriptHex||e.scriptHex!==t.scriptHex)throw new Error("OODL_BUY_WALLET_MUTATED_OUTPUTS")}}(e,t);const o=Ew(t,n);if(!e?.sellerPrevout||!o||e.sellerPrevout!==o)throw new Error("OODL_BUY_WALLET_MUTATED_SELLER_INPUT_OUTPOINT");const s=t?.txOutputs?.[r]||null,l=t?.txOutputs?.[i]||null,c=t?.txOutputs?.[0]||null,u=t?.txOutputs?.[a]||null,d=Sw(s?.script),f=Sw(l?.script),p=Sw(c?.script),m=Sw(u?.script);if(e?.buyerChangeOut){if(!e.buyerChangeOut.scriptHex||!p||e.buyerChangeOut.scriptHex!==p)throw new Error("OODL_BUY_WALLET_MUTATED_BUYER_CHANGE_OUTPUT_SCRIPT");if(!Number.isFinite(e.buyerChangeOut.value)||!Number.isFinite(Number(c?.value))||e.buyerChangeOut.value!==Number(c.value))throw new Error("OODL_BUY_WALLET_MUTATED_BUYER_CHANGE_OUTPUT_VALUE")}if(!e?.inscriptionOut?.scriptHex||!d||e.inscriptionOut.scriptHex!==d)throw new Error("OODL_BUY_WALLET_MUTATED_INSCRIPTION_OUTPUT_SCRIPT");if(!Number.isFinite(e?.inscriptionOut?.value)||!Number.isFinite(Number(s?.value))||e.inscriptionOut.value!==Number(s.value))throw new Error("OODL_BUY_WALLET_MUTATED_INSCRIPTION_OUTPUT_VALUE");if(!e?.sellerPayoutOut?.scriptHex||!f||e.sellerPayoutOut.scriptHex!==f)throw new Error("OODL_BUY_WALLET_MUTATED_SELLER_PAYOUT_SCRIPT");if(!Number.isFinite(e?.sellerPayoutOut?.value)||!Number.isFinite(Number(l?.value))||e.sellerPayoutOut.value!==Number(l.value))throw new Error("OODL_BUY_WALLET_MUTATED_SELLER_PAYOUT_VALUE");if(e?.platformFeeOut){if(!u)throw new Error("OODL_BUY_WALLET_MUTATED_PLATFORM_FEE_MISSING");if(!e.platformFeeOut.scriptHex||!m||e.platformFeeOut.scriptHex!==m)throw new Error("OODL_BUY_WALLET_MUTATED_PLATFORM_FEE_SCRIPT");if(!Number.isFinite(e.platformFeeOut.value)||!Number.isFinite(Number(u?.value))||e.platformFeeOut.value!==Number(u.value))throw new Error("OODL_BUY_WALLET_MUTATED_PLATFORM_FEE_VALUE")}}function _w(e,t){const n=function(e,t){if(!e)return null;const n=e?.fullUtxo||e?.utxo||e?.raw||e?.full||e,r=n.txid||n.txId||n.hash,i=n.vout??n.index??n.n,a=n.value??n.satoshis??n.amount,o=n.address||n.addr||t||null,s=n.scriptPubKey||n.scriptHex||n.script||null;return r&&null!=i&&Number.isFinite(Number(i))&&null!=a&&Number.isFinite(Number(a))?{txid:String(r),vout:Number(i),value:Number(a),address:o,scriptPubKey:s}:null}(e,t);return n&&n.address?n:null}async function Pw({walletProvider:e,revealTxid:t,buyerPaymentUtxos:n=null,buyerChangeAddress:r=null,buyerReceiveAddress:i=null,expectedPostageSats:a=null,expectedInscriptionInputOffset:o=null,feeRateSatPerVb:s=10,broadcast:l=!0}){if(!e)throw new Error("createAndBroadcastBuyFromRevealTx: walletProvider is required");const c=String(t||"").trim();if(!/^[0-9a-fA-F]{64}$/.test(c))throw new Error("createAndBroadcastBuyFromRevealTx: revealTxid must be 64 hex chars");const u=await gg(),d=aw(u),f=e?.getState?.()||{},p=(e=>{if(!Array.isArray(e)||0===e.length)return{payment:null,ordinals:null,all:[]};if("object"==typeof e[0]&&null!==e[0])return{payment:e.find(e=>"payment"===String(e?.purpose||"").toLowerCase())?.address||null,ordinals:e.find(e=>"ordinals"===String(e?.purpose||"").toLowerCase())?.address||null,all:e.map(e=>e?.address).filter(e=>"string"==typeof e)};const t=e.filter(e=>"string"==typeof e);return{payment:t[0]||null,ordinals:t[0]||null,all:t}})(await(async()=>{try{if("function"==typeof e?.getAccounts){const t=await e.getAccounts();return Array.isArray(t)?t:null}if("function"==typeof e?.requestAccounts){const t=await e.requestAccounts();return Array.isArray(t)?t:null}}catch{}return null})()),m=r||p?.payment||f?.paymentAddress||f?.address||f?.ordinalsAddress;if(!m)throw new Error("createAndBroadcastBuyFromRevealTx: buyerChangeAddress is required");const h=await dw(c);let g,y=null;try{y=await $b(u,h)}catch{y=null}try{g=await Mb(u,h,{requirePsbtMagic:!0})}catch(cC){throw new Error("createAndBroadcastBuyFromRevealTx: reveal tx does not contain an embedded seller offer PSBT (OODL frame). This does not look like an OODL listing reveal tx.")}const b=gw(u,h),w=y&&Number.isFinite(Number(y?.minBlockHeight))?Number(y.minBlockHeight):null;let x,v=null;null!=b?.minBlockHeight?v=await bw(b):null!=w&&(v=await ww(w));try{x="function"==typeof u.Psbt.fromBuffer?u.Psbt.fromBuffer(g,{network:d}):u.Psbt.fromBase64(g.toString("base64"),{network:d})}catch(cC){throw new Error(`createAndBroadcastBuyFromRevealTx: failed to parse embedded seller PSBT (${cC?.message||cC})`)}if(null===v){const e=function(e){const t=Number(e);if(!Number.isFinite(t)||t<0)return null;const n=Math.floor(t)>>>0;return n>=5e8?null:n}(yw(x));null!==e&&(v=await ww(e))}if(x.inputCount<1)throw new Error("createAndBroadcastBuyFromRevealTx: seller PSBT had no inputs");if(!x.txOutputs||x.txOutputs.length<1)throw new Error("createAndBroadcastBuyFromRevealTx: seller PSBT had no outputs");Aw(x,{marker:b||null,context:"createAndBroadcastBuyFromRevealTx"});{const e=null!=b?.minBlockHeight?Number(b.minBlockHeight):null!=w?Number(w):null;if(null!==e){const t=yw(x);if(null===t)throw new Error("createAndBroadcastBuyFromRevealTx: OODL_LISTING_LOCKTIME_UNAVAILABLE");if(t>>>0!=e>>>0)throw new Error("createAndBroadcastBuyFromRevealTx: OODL_LISTING_LOCKTIME_MISMATCH");if(null!==v&&Number.isFinite(v)&&v<e)throw new Error("createAndBroadcastBuyFromRevealTx: OODL_LISTING_NOT_YET_VALID")}}try{const e=u.Transaction.fromHex(h).getId(),t=x?.txInputs?.[2],n=t?.hash?Buffer.from(t.hash).reverse().toString("hex"):null,r="number"==typeof t?.index?t.index:null;if(n&&e&&n.toLowerCase()!==e.toLowerCase())throw new Error(`createAndBroadcastBuyFromRevealTx: listing is inconsistent (offer does not spend reveal txid). offerPrevTxid=${n} revealTxid=${e}.`);if(null!==r&&0!==r)throw new Error(`createAndBroadcastBuyFromRevealTx: listing is inconsistent (offer does not spend reveal vout=0). offerPrevVout=${r}`)}catch(cC){throw new Error(String(cC?.message||cC))}{const e=x?.data?.inputs?.[2]||{},t=e?.sighashType,n="number"==typeof t&&131==(255&t),r=e?.tapKeySig,i=(e=>{if(!e)return!1;const t=Buffer.isBuffer(e)?e:Buffer.from(e);return t.length>=65&&131===t[t.length-1]})(r);if(!n&&!i)throw new Error("createAndBroadcastBuyFromRevealTx: Open Store offer missing 0x83 seller signature on input[2]")}if(!x.txOutputs[2])throw new Error("createAndBroadcastBuyFromRevealTx: seller payout output[2] missing");if(b){const e=Number(b?.openStoreVersion||0),t=Number.isFinite(e)&&e>=2,n=String(b?.psbtHashHex||"").toLowerCase(),r=/^[0-9a-f]{64}$/.test(n),i=n==="0".repeat(64);if(t&&(!r||i))throw new Error("createAndBroadcastBuyFromRevealTx: OODL_LISTING_PSBT_HASH_MISSING");if(r&&!i){const e=function(e){if(!e)return null;if("function"==typeof e.toBuffer)return e.toBuffer();if("function"==typeof e.toBase64)try{return Buffer.from(e.toBase64(),"base64")}catch{return null}return null}(x);if(!e)throw new Error("createAndBroadcastBuyFromRevealTx: failed to serialize offer PSBT for hashing");if(n!==u.crypto.sha256(e).toString("hex").toLowerCase())throw new Error("createAndBroadcastBuyFromRevealTx: OODL_LISTING_PSBT_HASH_MISMATCH")}}if(!x?.txOutputs?.[1])throw new Error("createAndBroadcastBuyFromRevealTx: offer missing output[1] (inscription output)");const S=rw(nw(x.txOutputs[1]?.value)||0,"offer.output[1].value");if(S<=0n)throw new Error("createAndBroadcastBuyFromRevealTx: offer output[1] postage must be > 0");const E=null!=a?rw(a,"expectedPostageSats"):null;if(null!==E&&E<=0n)throw new Error("createAndBroadcastBuyFromRevealTx: expectedPostageSats must be > 0 when provided");if(null!==E&&S!==E)throw new Error(`createAndBroadcastBuyFromRevealTx: offer output[1] postage does not match inscription UTXO postage. offerPostageSats=${S.toString()} expectedPostageSats=${E.toString()}`);if(null!=b?.postageSats){const e=rw(b.postageSats,"marker.postageSats");if(e<=0n)throw new Error("createAndBroadcastBuyFromRevealTx: marker.postageSats must be > 0");if(e!==S)throw new Error("createAndBroadcastBuyFromRevealTx: offer output[1] value does not match marker postage");if(null!==E&&e!==E)throw new Error("createAndBroadcastBuyFromRevealTx: marker postage does not match inscription UTXO postage")}const I=null!==E?E:S;let k=0n;if(null!=b?.platformFeeSats){if(k=rw(b.platformFeeSats,"marker.platformFeeSats"),k<0n)throw new Error("createAndBroadcastBuyFromRevealTx: marker.platformFeeSats must be >= 0");if(!x?.txOutputs?.[3])throw new Error("createAndBroadcastBuyFromRevealTx: marker commits to platform fee but offer missing output[3]");if(rw(nw(x.txOutputs[3].value)||0,"offer.output[3].value")!==k)throw new Error("createAndBroadcastBuyFromRevealTx: offer output[3] value does not match marker platform fee");const e=u.crypto.sha256(Buffer.from(x.txOutputs[3].script)).toString("hex").toLowerCase(),t=String(b?.platformFeeScriptHashHex||"").toLowerCase();if(t&&t!==e)throw new Error("createAndBroadcastBuyFromRevealTx: platformFeeScriptHash commitment mismatch")}else x?.txOutputs?.[3]&&(k=rw(nw(x.txOutputs[3].value)||0,"offer.output[3].value"),k<0n&&(k=0n));if(b){const e=x?.txOutputs?.[2]?.script;if(!e)throw new Error("createAndBroadcastBuyFromRevealTx: offer missing seller payout script at output[2]");const t=u.crypto.sha256(Buffer.from(e)).toString("hex").toLowerCase(),n=String(b?.sellerScriptHashHex||"").toLowerCase();if(n&&n!==t)throw new Error("createAndBroadcastBuyFromRevealTx: sellerScriptHash commitment mismatch")}const A=rw(nw(x.txOutputs?.[2]?.value)||0,"offer.output[2].value")+k,N=y&&null!=y?.priceSats?rw(y.priceSats,"meta.priceSats"):null;if(b&&null!==N&&rw(b?.priceSats,"marker.priceSats")!==N)throw new Error("createAndBroadcastBuyFromRevealTx: OODL_LISTING_PRICE_MISMATCH");const T=b?rw(b?.priceSats,"marker.priceSats"):null!==N?N:A;if(!b&&null!==N&&N!==A)throw new Error("createAndBroadcastBuyFromRevealTx: OODL_LISTING_PRICE_MISMATCH");if(T<=0n)throw new Error("createAndBroadcastBuyFromRevealTx: priceSats must be > 0");const _=x?.txOutputs?.[2]?.script,P=_?Buffer.from(_).toString("hex"):null,B=e=>Buffer.from(u.address.toOutputScript(String(e),d)).toString("hex");let C=null;try{const e=[i,p?.ordinals,p?.payment,...Array.isArray(p?.all)?p.all:[],f?.ordinalsAddress,f?.address,f?.paymentAddress,m].map(e=>e?String(e).trim():null).filter(Boolean);for(const t of e){if(!P){C=t;break}if(B(t)!==P){C=t;break}}if(!C)throw new Error("Could not choose a buyer receive address that differs from the seller inscription script. You are likely still connected to the seller wallet/account, or the app has not refreshed addresses after switching accounts. ")}catch(cC){throw new Error(`createAndBroadcastBuyFromRevealTx: invalid buyer receive/change address (${cC?.message||cC})`)}const O=(e,t)=>{const n=e?.data?.inputs?.[t]||null;return!(!n||!n.finalScriptWitness&&!n.finalScriptSig)},L=(e,t,n)=>{void 0!==e[n]&&null!==e[n]||void 0!==t[n]&&null!==t[n]&&(e[n]=t[n])},F=x?.data?.inputs?.[2]||{},R=nw(x.txOutputs[2]?.value);if(!R)throw new Error("createAndBroadcastBuyFromRevealTx: seller PSBT output[2] had invalid value");const U=nw(x?.data?.inputs?.[2]?.witnessUtxo?.value);if(!U||U<=0)throw new Error("createAndBroadcastBuyFromRevealTx: seller input[2] missing witnessUtxo.value");{const e=T+(BigInt(U)>I?BigInt(U)-I:0n);if(BigInt(R)!==e)throw new Error("createAndBroadcastBuyFromRevealTx: seller payout output[2] does not match marker price + reclaim")}{const e=u.address.toOutputScript(C,d),t=u.address.toOutputScript(m,d);xw(x,1,{script:e,value:Number(I)}),xw(x,0,{script:t,value:nw(x.txOutputs?.[0]?.value)||0})}try{if(P){const e=x?.txOutputs?.[1],t=e?.script?Buffer.from(e.script).toString("hex"):null;if(t&&t===P){const e=e=>"string"==typeof e&&e.length>16?`${e.slice(0,16)}\u2026${e.slice(-8)}`:e;let n=null,r=null;try{n=B(C)}catch{}try{r=B(m)}catch{}throw new Error(`Output[1] (inscription receive) is still the seller inscription script after overwrite. Refusing to proceed to avoid returning the inscription to the seller. Details: receiveAddr=${String(C)} changeAddr=${String(m)} sellerScript=${e(P)} out1Script=${e(t)} receiveScript=${e(n)} changeScript=${e(r)}`)}}}catch(cC){throw new Error(`createAndBroadcastBuyFromRevealTx: ${cC?.message||cC}`)}const M=Array.isArray(n)?n:f?.utxos||f?.paymentUtxos||null,$=(Array.isArray(M)?M:[]).map(e=>_w(e,m)).filter(Boolean);if(0===$.length)throw new Error("createAndBroadcastBuyFromRevealTx: buyerPaymentUtxos is required (fetch UTXOs first)");const H=$.slice().sort((e,t)=>t.value-e.value),D=[],z=[];let W=0;const V=f?.paymentPublicKey||null,j=546,q=e=>{const t=String(e||"").trim();let n,r={},i="p2wpkh";if(V&&(t.startsWith("3")||t.startsWith("2"))){const e=Buffer.from(V,"hex"),t=u.payments.p2wpkh({pubkey:e,network:d});n=u.payments.p2sh({redeem:t,network:d}).output,r.redeemScript=t.output,i="p2sh-p2wpkh"}else n=u.address.toOutputScript(t,d),i=t.startsWith("bc1p")||t.startsWith("tb1p")?"p2tr":"p2wpkh";return{witnessScriptPubKey:n,extraFields:r,inputType:i}},K=e=>{const t=String(e.address||"").trim(),{witnessScriptPubKey:n,extraFields:r,inputType:i}=q(t),a=x.inputCount;x.addInput({hash:Buffer.from(e.txid,"hex").reverse(),index:e.vout,sequence:4294967293,witnessUtxo:{script:n,value:e.value},...r}),D.push({index:a,address:t}),z.push(i),W+=e.value},X=(e,t)=>{const n=String(t.address||"").trim(),{witnessScriptPubKey:r,extraFields:i,inputType:a}=q(n);vw(x,e,t.txid,t.vout);const o=x?.data?.inputs?.[e];if(!o)throw new Error(`createAndBroadcastBuyFromRevealTx: missing psbt.data.inputs[${e}] to replace`);o.witnessUtxo={script:r,value:t.value},i.redeemScript&&(o.redeemScript=i.redeemScript),D.push({index:e,address:n}),z.push(a),W+=t.value},G=H.slice(),Y=e=>{const t=G[e];return G.splice(e,1),t},J=(()=>{if(G.length<2)return null;const e=G.slice().sort((e,t)=>e.value-t.value);for(let n=0;n<e.length;n++)for(let t=n+1;t<e.length;t++)if(e[n].value+e[t].value>=j)return[e[n],e[t]];const t=G.slice().sort((e,t)=>t.value-e.value);return[t[0],t[1]]})();if(!J)throw new Error("createAndBroadcastBuyFromRevealTx: need at least 2 buyer UTXOs to fill Open Store dummy input slots");const Q=Y(G.findIndex(e=>e.txid===J[0].txid&&e.vout===J[0].vout)),Z=Y(G.findIndex(e=>e.txid===J[1].txid&&e.vout===J[1].vout));X(0,Q),X(1,Z);const ee=BigInt(Q.value+Z.value);{const e=u.address.toOutputScript(m,d);xw(x,0,{script:e,value:Number(ee)})}const te=BigInt(U)>=I?0n:I-BigInt(U),ne=BigInt(R),re=ne+k+te,ie=x?.data?.inputs?.[2]?.witnessUtxo?.script,ae=fw(ie),oe=[z[0]||"p2wpkh",z[1]||"p2wpkh","p2wpkh"===ae?"p2wpkh":"p2tr"],se=(x?.txOutputs||[]).map(e=>mw(e?.script)),le=Number(s||10);let ce=0n;for(const Ae of G){K(Ae),ce+=BigInt(Ae.value);const e=x.inputCount,t=_g(e,x.txOutputs.length,!0,0,{isReveal:!1,inputTypes:[...oe,...z.slice(2)].slice(0,e),outputTypes:se});if(ce>=re+BigInt(Math.ceil(le*t)))break}const ue=x.inputCount,de=x.txOutputs.length,fe=[...oe,...z.slice(2)].slice(0,ue),pe=_g(ue,de,!0,0,{isReveal:!1,inputTypes:fe,outputTypes:se}),me=BigInt(Math.ceil(le*pe)),he=ce-(re+me);let ge=me,ye=he;if(he>=BigInt(j)){const e=_g(ue,de+1,!0,0,{isReveal:!1,inputTypes:fe,outputTypes:[...se,pw(m)]}),t=BigInt(Math.ceil(le*e)),n=ce-(re+t);n>=BigInt(j)&&(ge=t,ye=n)}if(ce<re+ge){const e=re+ge,t=e-ce;throw new Error(`createAndBroadcastBuyFromRevealTx: insufficient buyer funds. Need >= ${e.toString()} sats (price+reclaim=${ne.toString()}, platformFee=${k.toString()}, postageTopUp=${te.toString()}, estFee=${ge.toString()}). Have ${ce.toString()} sats. Short ${t.toString()} sats. Note: split-funding can increase UTXO count for Open Store, but it cannot create sats; fund your payment address and retry.`)}if(ye>=BigInt(j)&&x.addOutput({address:m,value:Number(ye)}),null!=o){const e=Number(o);if(!Number.isFinite(e)||e<0)throw new Error("createAndBroadcastBuyFromRevealTx: expectedInscriptionInputOffset must be >= 0 when provided");const t=[];for(let a=0;a<x.inputCount;a+=1){const e=x?.data?.inputs?.[a]?.witnessUtxo?.value;if(!Number.isFinite(Number(e))||Number(e)<0)throw new Error("createAndBroadcastBuyFromRevealTx: cannot verify satpoint routing (missing witnessUtxo.value)");t.push(BigInt(Math.floor(Number(e))))}const n=(x?.txOutputs||[]).map(e=>BigInt(Math.floor(Number(e?.value||0)))),r=t[2]||0n;if(BigInt(e)>=r)throw new Error("createAndBroadcastBuyFromRevealTx: inscription offset is out of bounds for seller input value");const i=function({inputValues:e,outputValues:t,targetInputIndex:n,targetInputOffset:r}){if(!Array.isArray(e)||!Array.isArray(t))return null;const i=Number(n),a=Number(r);if(!Number.isFinite(i)||i<0)return null;if(!Number.isFinite(a)||a<0)return null;let o=0n;for(let s=0;s<i;s+=1){const t=e[s];if("bigint"!=typeof t||t<0n)return null;o+=t}o+=BigInt(a);for(let s=0;s<t.length;s+=1){const e=t[s];if("bigint"!=typeof e||e<0n)return null;if(o<e)return{outIndex:s,outOffset:o};o-=e}return null}({inputValues:t,outputValues:n,targetInputIndex:2,targetInputOffset:e});if(!i)throw new Error("createAndBroadcastBuyFromRevealTx: could not verify inscription sat routing");if(1!==i.outIndex)throw new Error("createAndBroadcastBuyFromRevealTx: INSCRIPTION_SATPOINT_ROUTING_MISMATCH");if(i.outOffset<0n||i.outOffset>=I)throw new Error("createAndBroadcastBuyFromRevealTx: INSCRIPTION_SATPOINT_ROUTING_OUT_OF_POSTAGE")}try{O(x,2)||x.finalizeInput(2)}catch(cC){throw new Error(`createAndBroadcastBuyFromRevealTx: non-buyer input(s) could not be finalized locally. Embedded seller offer PSBT may be missing required Taproot data. Underlying error: ${cC?.message||cC}`)}const be=x.toHex(),we=Nw(x,{sellerInputIndex:2,inscriptionOutputIndex:1,sellerPayoutOutputIndex:2,platformFeeOutputIndex:3}),xe=await Xg(e,be,{autoFinalized:!1,toSignInputs:D},!1),ve=xe?.signedPsbt||null;if(!ve)throw new Error("createAndBroadcastBuyFromRevealTx: wallet did not return signed buyer PSBT");const Se=u.Psbt.fromHex(ve,{network:d});try{Tw(we,Se,{sellerInputIndex:2,inscriptionOutputIndex:1,sellerPayoutOutputIndex:2,platformFeeOutputIndex:3})}catch(cC){throw new Error(`createAndBroadcastBuyFromRevealTx: ${cC?.message||cC}`)}try{const e=u.Psbt.fromHex(be,{network:d}),t=e?.data?.inputs?.[2]||{},n=Se?.data?.inputs?.[2]||{};L(n,t,"finalScriptWitness"),L(n,t,"finalScriptSig"),L(n,t,"tapKeySig"),L(n,t,"tapScriptSig"),L(n,t,"tapLeafScript"),L(n,t,"tapInternalKey"),L(n,t,"tapMerkleRoot"),L(n,t,"tapBip32Derivation"),L(n,F,"finalScriptWitness"),L(n,F,"finalScriptSig"),L(n,F,"tapKeySig"),L(n,F,"tapScriptSig"),L(n,F,"tapLeafScript"),L(n,F,"tapInternalKey"),L(n,F,"tapMerkleRoot"),L(n,F,"tapBip32Derivation")}catch{}const Ee=[2,...D.map(e=>e.index)];for(const Ae of Ee)if(!O(Se,Ae))try{Se.finalizeInput(Ae)}catch(cC){if(2===Ae)throw new Error(`createAndBroadcastBuyFromRevealTx: cannot finalize seller taproot input #2. No usable Taproot signature present after wallet signing. Underlying error: ${cC?.message||cC}`);throw cC}for(let Ae=0;Ae<Se.inputCount;Ae+=1)if(!O(Se,Ae))throw new Error(`createAndBroadcastBuyFromRevealTx: input #${Ae} is not finalized after signing`);const Ie=Se.extractTransaction().toHex(),ke=l?await Gg(e,{txHex:Ie,psbtBase64:Buffer.from(ve,"hex").toString("base64")},ow(),"oodl-buy"):Se.extractTransaction().getId();return{mode:"buy-complete",revealTxid:c,inferredPriceSats:T.toString(),postageSats:I.toString(),sellerInputValueSats:String(U),buyerPostageTopUpSats:te.toString(),sellerPayoutOutputSats:R,buyerInputsSats:W,feeSats:ge.toString(),changeSats:ye>=BigInt(j)?ye.toString():"0",buyTxid:ke||null,buyTxHex:Ie,signedBuyerPsbtHex:ve}}function Bw({btc:e,network:t,walletProvider:n,offerPsbt:r,buyerChangeAddress:i,postageSats:a,platformFeeSats:o,feeRateSatPerVb:s}){if(!r)throw new Error("estimateMinSatsForOpenStoreBuy: offerPsbt is required");const l=String(i||"").trim();if(!l)throw new Error("estimateMinSatsForOpenStoreBuy: buyerChangeAddress is required");const c=nw(r.txOutputs?.[2]?.value);if(!c||c<=0)throw new Error("estimateMinSatsForOpenStoreBuy: offer missing/invalid seller payout output[2]");const u=nw(r?.data?.inputs?.[2]?.witnessUtxo?.value);if(!u||u<=0)throw new Error("estimateMinSatsForOpenStoreBuy: offer missing seller input[2] witnessUtxo.value");const d=rw(a,"postageSats"),f=rw(o||0n,"platformFeeSats"),p=BigInt(u)>=d?0n:d-BigInt(u),m=BigInt(c),h=m+f+p,g=n?.getState?.()?.paymentPublicKey||null,y=r?.data?.inputs?.[2]?.witnessUtxo?.script,b=fw(y),w=(e=>{const t=String(e||"").trim();return g&&(t.startsWith("3")||t.startsWith("2"))?"p2sh-p2wpkh":pw(t)})(l)||"p2wpkh",x=[w,w,"p2wpkh"===b?"p2wpkh":"p2tr",w],v=[...(r?.txOutputs||[]).map(e=>mw(e?.script)),pw(l)],S=Number(s||10),E=_g(4,(r?.txOutputs?.length||0)+1,!0,0,{isReveal:!1,inputTypes:x,outputTypes:v}),I=BigInt(Math.ceil(S*E));return{fixedNeedNoFee:h,feeEstimateSats:I,needTotalSats:h+I,breakdown:{sellerLockedOutSats:m,platformFeeSats:f,postageTopUpSats:p,postageSats:d,sellerInputValueSats:BigInt(u)}}}async function Cw({walletProvider:e,revealTxid:t,buyerChangeAddress:n,expectedPostageSats:r=null,feeRateSatPerVb:i=10}){if(!e)throw new Error("estimateBuyNeedFromRevealTx: walletProvider is required");const a=String(t||"").trim();if(!/^[0-9a-fA-F]{64}$/.test(a))throw new Error("estimateBuyNeedFromRevealTx: revealTxid must be 64 hex chars");const o=String(n||"").trim();if(!o)throw new Error("estimateBuyNeedFromRevealTx: buyerChangeAddress is required");const s=await gg(),l=aw(s),c=await dw(a);let u,d=null;try{d=await $b(s,c)}catch{d=null}try{u=await Mb(s,c,{requirePsbtMagic:!0})}catch{throw new Error("estimateBuyNeedFromRevealTx: reveal tx does not contain an embedded seller offer PSBT (OODL frame)")}const f=gw(s,c),p=d&&Number.isFinite(Number(d?.minBlockHeight))?Number(d.minBlockHeight):null;let m;null!=f?.minBlockHeight?await bw(f):null!=p&&await ww(p);try{m="function"==typeof s.Psbt.fromBuffer?s.Psbt.fromBuffer(u,{network:l}):s.Psbt.fromBase64(u.toString("base64"),{network:l})}catch(cC){throw new Error(`estimateBuyNeedFromRevealTx: failed to parse embedded seller PSBT (${cC?.message||cC})`)}Aw(m,{marker:f||null,context:"estimateBuyNeedFromRevealTx"});{const e=null!=f?.minBlockHeight?Number(f.minBlockHeight):null!=p?Number(p):null;if(null!==e){const t=yw(m);if(null===t)throw new Error("estimateBuyNeedFromRevealTx: OODL_LISTING_LOCKTIME_UNAVAILABLE");if(t>>>0!=e>>>0)throw new Error("estimateBuyNeedFromRevealTx: OODL_LISTING_LOCKTIME_MISMATCH")}}const h=rw(nw(m?.txOutputs?.[1]?.value)||0,"offer.output[1].value");if(h<=0n)throw new Error("estimateBuyNeedFromRevealTx: offer output[1] postage must be > 0");const g=null!=r?rw(r,"expectedPostageSats"):h;let y=0n;return null!=f?.platformFeeSats?y=rw(f.platformFeeSats,"marker.platformFeeSats"):m?.txOutputs?.[3]&&(y=rw(nw(m.txOutputs[3].value)||0,"offer.output[3].value"),y<0n&&(y=0n)),Bw({btc:s,network:l,walletProvider:e,offerPsbt:m,buyerChangeAddress:o,postageSats:g,platformFeeSats:y,feeRateSatPerVb:i})}const Ow=Object.freeze(Object.defineProperty({__proto__:null,createAndBroadcastBuyFromInscriptionId:async function({walletProvider:e,inscriptionId:t,buyerPaymentUtxos:n=null,buyerChangeAddress:r=null,buyerReceiveAddress:i=null,feeRateSatPerVb:a=10,broadcast:o=!0}){if(!e)throw new Error("createAndBroadcastBuyFromInscriptionId: walletProvider is required");const s=uw(t);if(!s?.inscriptionId)throw new Error("createAndBroadcastBuyFromInscriptionId: inscriptionId must look like <txid>i<index>");let l=null,c=null,u=null;try{l=await cw(s.inscriptionId),c=lw(l),u=function(e){const t=e?.output||e?.location||e?.satpoint;if(!t||"string"!=typeof t)return null;const n=t.split(":");if(n.length<3)return null;const r=Number(n[2]);return!Number.isFinite(r)||r<0?null:Math.floor(r)}(l)}catch{}let d=null;{const e=nw(l?.value);null!=e&&e>0&&(d=e)}if(null==d&&c?.txid)try{const e=await gg(),t=await dw(c.txid),n=e.Transaction.fromHex(t),r=n?.outs?.[c.vout],i=nw(r?.value);null!=i&&i>0&&(d=i)}catch{}if(null==d||d<=0)throw new Error("createAndBroadcastBuyFromInscriptionId: could not determine inscription postage from ordinals latest output; refusing to default");const f=[c?.txid,s.revealTxid].map(e=>e?String(e).toLowerCase().trim():null).filter(Boolean)[0];if(!f)throw new Error("createAndBroadcastBuyFromInscriptionId: failed to resolve a txid to buy from");return{...await Pw({walletProvider:e,revealTxid:f,buyerPaymentUtxos:n,buyerChangeAddress:r,buyerReceiveAddress:i,expectedPostageSats:d,expectedInscriptionInputOffset:null!=u?u:null,feeRateSatPerVb:a,broadcast:o}),discovery:{inscriptionId:s.inscriptionId,inscriptionIndex:s.inscriptionIndex,revealTxid:f,method:c?.txid?"ordinals-latest-output":"inscription-id-txid",latestOutpoint:c?`${c.txid}:${c.vout}`:null,latestOffset:null!=u?String(u):null,expectedPostageSats:String(d)}}},createAndBroadcastBuyFromRevealTx:Pw,createAndBroadcastBuyFromSellerOfferPsbt:async function({walletProvider:e,sellerOfferPsbt:t,buyerPaymentUtxos:n=null,buyerChangeAddress:r=null,buyerReceiveAddress:i=null,feeRateSatPerVb:a=10,broadcast:o=!0}){if(!e)throw new Error("createAndBroadcastBuyFromSellerOfferPsbt: walletProvider is required");const s=String(t||"").trim();if(!s)throw new Error("createAndBroadcastBuyFromSellerOfferPsbt: sellerOfferPsbt is required");const l=await gg(),c=aw(l),u=e?.getState?.()||{},d=(e=>{if(!Array.isArray(e)||0===e.length)return{payment:null,ordinals:null,all:[]};if("object"==typeof e[0]&&null!==e[0])return{payment:e.find(e=>"payment"===String(e?.purpose||"").toLowerCase())?.address||null,ordinals:e.find(e=>"ordinals"===String(e?.purpose||"").toLowerCase())?.address||null,all:e.map(e=>e?.address).filter(e=>"string"==typeof e)};const t=e.filter(e=>"string"==typeof e);return{payment:t[0]||null,ordinals:t[0]||null,all:t}})(await(async()=>{try{if("function"==typeof e?.getAccounts){const t=await e.getAccounts();return Array.isArray(t)?t:null}if("function"==typeof e?.requestAccounts){const t=await e.requestAccounts();return Array.isArray(t)?t:null}}catch{}return null})()),f=r||d?.payment||u?.paymentAddress||u?.address||u?.ordinalsAddress;if(!f)throw new Error("createAndBroadcastBuyFromSellerOfferPsbt: buyerChangeAddress is required");let p;try{p=iw(s)?l.Psbt.fromHex(s,{network:c}):l.Psbt.fromBase64(s,{network:c})}catch(cC){throw new Error(`createAndBroadcastBuyFromSellerOfferPsbt: failed to parse seller offer PSBT (${cC?.message||cC})`)}if(p.inputCount<1)throw new Error("createAndBroadcastBuyFromSellerOfferPsbt: seller PSBT had no inputs");if(!p.txOutputs||p.txOutputs.length<1)throw new Error("createAndBroadcastBuyFromSellerOfferPsbt: seller PSBT had no outputs");Aw(p,{marker:null,context:"createAndBroadcastBuyFromSellerOfferPsbt"});{const e=p?.data?.inputs?.[2]||{},t=e?.sighashType,n="number"==typeof t&&131==(255&t),r=e?.tapKeySig,i=(e=>{if(!e)return!1;const t=Buffer.isBuffer(e)?e:Buffer.from(e);return t.length>=65&&131===t[t.length-1]})(r);if(!n&&!i)throw new Error("createAndBroadcastBuyFromSellerOfferPsbt: offer missing 0x83 seller signature on input[2]")}if(!p.txOutputs[2])throw new Error("createAndBroadcastBuyFromSellerOfferPsbt: seller payout output[2] missing");const m=(()=>{const e=nw(p?.txOutputs?.[1]?.value);if(null==e||e<=0)throw new Error("createAndBroadcastBuyFromSellerOfferPsbt: offer missing output[1] postage value");return BigInt(e)})(),h=(()=>{const e=nw(p?.txOutputs?.[3]?.value);return BigInt(null!=e&&e>0?e:0)})(),g=nw(p.txOutputs[2]?.value);if(!g)throw new Error("createAndBroadcastBuyFromSellerOfferPsbt: seller PSBT output[2] had invalid value");const y=nw(p?.data?.inputs?.[2]?.witnessUtxo?.value);if(!y||y<=0)throw new Error("createAndBroadcastBuyFromSellerOfferPsbt: seller input[2] missing witnessUtxo.value");const b=BigInt(y)>m?BigInt(y)-m:0n,w=BigInt(g)-b;if(w<=0n)throw new Error("createAndBroadcastBuyFromSellerOfferPsbt: could not infer a valid price from seller offer PSBT");const x=w,v=(e,t)=>{const n=e?.data?.inputs?.[t]||null;return!(!n||!n.finalScriptWitness&&!n.finalScriptSig)},S=(e,t,n)=>{void 0!==e[n]&&null!==e[n]||void 0!==t[n]&&null!==t[n]&&(e[n]=t[n])},E=p?.data?.inputs?.[2]||{},I=p?.txOutputs?.[2]?.script,k=I?Buffer.from(I).toString("hex"):null,A=e=>Buffer.from(l.address.toOutputScript(String(e),c)).toString("hex");let N=null;try{const e=[i,d?.ordinals,d?.payment,...Array.isArray(d?.all)?d.all:[],u?.ordinalsAddress,u?.address,u?.paymentAddress,f].map(e=>e?String(e).trim():null).filter(Boolean);for(const t of e){if(!k){N=t;break}if(A(t)!==k){N=t;break}}if(!N)throw new Error("Could not choose a buyer receive address that differs from the seller inscription script. You are likely still connected to the seller wallet/account, or the app has not refreshed addresses after switching accounts.")}catch(cC){throw new Error(`createAndBroadcastBuyFromSellerOfferPsbt: invalid buyer receive/change address (${cC?.message||cC})`)}{const e=l.address.toOutputScript(N,c),t=l.address.toOutputScript(f,c);xw(p,1,{script:e,value:Number(m)}),xw(p,0,{script:t,value:nw(p.txOutputs?.[0]?.value)||0})}try{if(k){const e=p?.txOutputs?.[1],t=e?.script?Buffer.from(e.script).toString("hex"):null;if(t&&t===k){const e=e=>"string"==typeof e&&e.length>16?`${e.slice(0,16)}\u2026${e.slice(-8)}`:e;let n=null,r=null;try{n=A(N)}catch{}try{r=A(f)}catch{}throw new Error(`Output[1] (inscription receive) is still the seller inscription script after overwrite. Refusing to proceed to avoid returning the inscription to the seller. Details: receiveAddr=${String(N)} changeAddr=${String(f)} sellerScript=${e(k)} out1Script=${e(t)} receiveScript=${e(n)} changeScript=${e(r)}`)}}}catch(cC){throw new Error(`createAndBroadcastBuyFromSellerOfferPsbt: ${cC?.message||cC}`)}const T=Array.isArray(n)?n:u?.utxos||u?.paymentUtxos||null,_=(Array.isArray(T)?T:[]).map(e=>_w(e,f)).filter(Boolean);if(0===_.length)throw new Error("createAndBroadcastBuyFromSellerOfferPsbt: buyerPaymentUtxos is required (fetch UTXOs first)");const P=_.slice().sort((e,t)=>t.value-e.value),B=[],C=[];let O=0;const L=u?.paymentPublicKey||null,F=546,R=e=>{const t=String(e||"").trim();let n,r={},i="p2wpkh";if(L&&(t.startsWith("3")||t.startsWith("2"))){const e=Buffer.from(L,"hex"),t=l.payments.p2wpkh({pubkey:e,network:c});n=l.payments.p2sh({redeem:t,network:c}).output,r.redeemScript=t.output,i="p2sh-p2wpkh"}else n=l.address.toOutputScript(t,c),i=t.startsWith("bc1p")||t.startsWith("tb1p")?"p2tr":"p2wpkh";return{witnessScriptPubKey:n,extraFields:r,inputType:i}},U=e=>{const t=String(e.address||"").trim(),{witnessScriptPubKey:n,extraFields:r,inputType:i}=R(t),a=p.inputCount;p.addInput({hash:Buffer.from(e.txid,"hex").reverse(),index:e.vout,sequence:4294967293,witnessUtxo:{script:n,value:e.value},...r}),B.push({index:a,address:t}),C.push(i),O+=e.value},M=(e,t)=>{const n=String(t.address||"").trim(),{witnessScriptPubKey:r,extraFields:i,inputType:a}=R(n);vw(p,e,t.txid,t.vout);const o=p?.data?.inputs?.[e];if(!o)throw new Error(`createAndBroadcastBuyFromSellerOfferPsbt: missing psbt.data.inputs[${e}] to replace`);o.witnessUtxo={script:r,value:t.value},i.redeemScript&&(o.redeemScript=i.redeemScript),B.push({index:e,address:n}),C.push(a),O+=t.value},$=P.slice(),H=e=>{const t=$[e];return $.splice(e,1),t},D=(()=>{if($.length<2)return null;const e=$.slice().sort((e,t)=>e.value-t.value);for(let n=0;n<e.length;n++)for(let t=n+1;t<e.length;t++)if(e[n].value+e[t].value>=F)return[e[n],e[t]];const t=$.slice().sort((e,t)=>t.value-e.value);return[t[0],t[1]]})();if(!D)throw new Error("createAndBroadcastBuyFromSellerOfferPsbt: need at least 2 buyer UTXOs to fill Open Store dummy input slots");const z=H($.findIndex(e=>e.txid===D[0].txid&&e.vout===D[0].vout)),W=H($.findIndex(e=>e.txid===D[1].txid&&e.vout===D[1].vout));M(0,z),M(1,W);const V=BigInt(z.value+W.value);{const e=l.address.toOutputScript(f,c);xw(p,0,{script:e,value:Number(V)})}const j=BigInt(y)>=m?0n:m-BigInt(y),q=BigInt(g),K=q+h+j,X=p?.data?.inputs?.[2]?.witnessUtxo?.script,G=fw(X),Y=[C[0]||"p2wpkh",C[1]||"p2wpkh","p2wpkh"===G?"p2wpkh":"p2tr"],J=(p?.txOutputs||[]).map(e=>mw(e?.script)),Q=Number(a||10);let Z=0n;for(const ge of $){U(ge),Z+=BigInt(ge.value);const e=p.inputCount,t=_g(e,p.txOutputs.length,!0,0,{isReveal:!1,inputTypes:[...Y,...C.slice(2)].slice(0,e),outputTypes:J});if(Z>=K+BigInt(Math.ceil(Q*t)))break}const ee=p.inputCount,te=p.txOutputs.length,ne=[...Y,...C.slice(2)].slice(0,ee),re=_g(ee,te,!0,0,{isReveal:!1,inputTypes:ne,outputTypes:J}),ie=BigInt(Math.ceil(Q*re)),ae=Z-(K+ie);let oe=ie,se=ae;if(ae>=BigInt(F)){const e=_g(ee,te+1,!0,0,{isReveal:!1,inputTypes:ne,outputTypes:[...J,pw(f)]}),t=BigInt(Math.ceil(Q*e)),n=Z-(K+t);n>=BigInt(F)&&(oe=t,se=n)}if(Z<K+oe){const e=K+oe,t=e-Z;throw new Error(`createAndBroadcastBuyFromSellerOfferPsbt: insufficient buyer funds. Need >= ${e.toString()} sats (price+reclaim=${q.toString()}, platformFee=${h.toString()}, postageTopUp=${j.toString()}, estFee=${oe.toString()}). Have ${Z.toString()} sats. Short ${t.toString()} sats. Note: split-funding can increase UTXO count for Open Store, but it cannot create sats; fund your payment address and retry.`)}se>=BigInt(F)&&p.addOutput({address:f,value:Number(se)});try{v(p,2)||p.finalizeInput(2)}catch(cC){throw new Error(`createAndBroadcastBuyFromSellerOfferPsbt: non-buyer input(s) could not be finalized locally. Seller offer PSBT may be missing required Taproot data. Underlying error: ${cC?.message||cC}`)}const le=p.toHex(),ce=Nw(p,{sellerInputIndex:2,inscriptionOutputIndex:1,sellerPayoutOutputIndex:2,platformFeeOutputIndex:3}),ue=await Xg(e,le,{autoFinalized:!1,toSignInputs:B},!1),de=ue?.signedPsbt||null;if(!de)throw new Error("createAndBroadcastBuyFromSellerOfferPsbt: wallet did not return signed buyer PSBT");const fe=l.Psbt.fromHex(de,{network:c});try{Tw(ce,fe,{sellerInputIndex:2,inscriptionOutputIndex:1,sellerPayoutOutputIndex:2,platformFeeOutputIndex:3})}catch(cC){throw new Error(`createAndBroadcastBuyFromSellerOfferPsbt: ${cC?.message||cC}`)}try{const e=l.Psbt.fromHex(le,{network:c}),t=e?.data?.inputs?.[2]||{},n=fe?.data?.inputs?.[2]||{};S(n,t,"finalScriptWitness"),S(n,t,"finalScriptSig"),S(n,t,"tapKeySig"),S(n,t,"tapScriptSig"),S(n,t,"tapLeafScript"),S(n,t,"tapInternalKey"),S(n,t,"tapMerkleRoot"),S(n,t,"tapBip32Derivation"),S(n,E,"finalScriptWitness"),S(n,E,"finalScriptSig"),S(n,E,"tapKeySig"),S(n,E,"tapScriptSig"),S(n,E,"tapLeafScript"),S(n,E,"tapInternalKey"),S(n,E,"tapMerkleRoot"),S(n,E,"tapBip32Derivation")}catch{}const pe=[2,...B.map(e=>e.index)];for(const ge of pe)if(!v(fe,ge))try{fe.finalizeInput(ge)}catch(cC){if(2===ge)throw new Error(`createAndBroadcastBuyFromSellerOfferPsbt: cannot finalize seller taproot input #2. No usable Taproot signature present after wallet signing. Underlying error: ${cC?.message||cC}`);throw cC}for(let ge=0;ge<fe.inputCount;ge+=1)if(!v(fe,ge))throw new Error(`createAndBroadcastBuyFromSellerOfferPsbt: input #${ge} is not finalized after signing`);const me=fe.extractTransaction().toHex(),he=o?await Gg(e,{txHex:me,psbtBase64:Buffer.from(de,"hex").toString("base64")},ow(),"oodl-buy-manual"):fe.extractTransaction().getId();return{mode:"buy-complete",source:"seller-offer-psbt",inferredPriceSats:x.toString(),postageSats:m.toString(),platformFeeSats:h.toString(),sellerInputValueSats:String(y),buyerPostageTopUpSats:j.toString(),sellerPayoutOutputSats:g,buyerInputsSats:O,feeSats:oe.toString(),changeSats:se>=BigInt(F)?se.toString():"0",buyTxid:he||null,buyTxHex:me,signedBuyerPsbtHex:de}},createBuyerFundedPsbtForSellerCountersign:async function({walletProvider:e,sellerOfferPsbt:t,buyerPaymentUtxos:n=null,buyerChangeAddress:r=null,buyerReceiveAddress:i=null,feeRateSatPerVb:a=10}){if(!e)throw new Error("createBuyerFundedPsbtForSellerCountersign: walletProvider is required");const o=String(t||"").trim();if(!o)throw new Error("createBuyerFundedPsbtForSellerCountersign: sellerOfferPsbt is required");const s=await gg(),l=aw(s),c=e?.getState?.()||{},u=(e=>{if(!Array.isArray(e)||0===e.length)return{payment:null,ordinals:null,all:[]};if("object"==typeof e[0]&&null!==e[0])return{payment:e.find(e=>"payment"===String(e?.purpose||"").toLowerCase())?.address||null,ordinals:e.find(e=>"ordinals"===String(e?.purpose||"").toLowerCase())?.address||null,all:e.map(e=>e?.address).filter(e=>"string"==typeof e)};const t=e.filter(e=>"string"==typeof e);return{payment:t[0]||null,ordinals:t[0]||null,all:t}})(await(async()=>{try{if("function"==typeof e?.getAccounts){const t=await e.getAccounts();return Array.isArray(t)?t:null}if("function"==typeof e?.requestAccounts){const t=await e.requestAccounts();return Array.isArray(t)?t:null}}catch{}return null})()),d=r||u?.payment||c?.paymentAddress||c?.address||c?.ordinalsAddress;if(!d)throw new Error("createBuyerFundedPsbtForSellerCountersign: buyerChangeAddress is required");let f;try{f=iw(o)?s.Psbt.fromHex(o,{network:l}):s.Psbt.fromBase64(o,{network:l})}catch(cC){throw new Error(`createBuyerFundedPsbtForSellerCountersign: failed to parse seller offer PSBT (${cC?.message||cC})`)}if(f.inputCount<1)throw new Error("createBuyerFundedPsbtForSellerCountersign: seller PSBT had no inputs");if(!f.txOutputs||f.txOutputs.length<1)throw new Error("createBuyerFundedPsbtForSellerCountersign: seller PSBT had no outputs");if(Aw(f,{marker:null,context:"createBuyerFundedPsbtForSellerCountersign"}),!f.txOutputs[2])throw new Error("createBuyerFundedPsbtForSellerCountersign: seller payout output[2] missing");const p=(()=>{const e=nw(f?.txOutputs?.[1]?.value);if(null==e||e<=0)throw new Error("createBuyerFundedPsbtForSellerCountersign: offer missing output[1] postage value");return BigInt(e)})(),m=(()=>{const e=nw(f?.txOutputs?.[3]?.value);return BigInt(null!=e&&e>0?e:0)})(),h=nw(f.txOutputs[2]?.value);if(!h)throw new Error("createBuyerFundedPsbtForSellerCountersign: seller PSBT output[2] had invalid value");const g=nw(f?.data?.inputs?.[2]?.witnessUtxo?.value);if(!g||g<=0)throw new Error("createBuyerFundedPsbtForSellerCountersign: seller input[2] missing witnessUtxo.value");const y=BigInt(g)>p?BigInt(g)-p:0n,b=BigInt(h)-y;if(b<=0n)throw new Error("createBuyerFundedPsbtForSellerCountersign: could not infer a valid price from seller offer PSBT");const w=b,x=(e,t,n)=>{void 0!==e[n]&&null!==e[n]||void 0!==t[n]&&null!==t[n]&&(e[n]=t[n])},v=f?.data?.inputs?.[2]||{},S=f?.txOutputs?.[2]?.script,E=S?Buffer.from(S).toString("hex"):null,I=e=>Buffer.from(s.address.toOutputScript(String(e),l)).toString("hex");let k=null;try{const e=[i,u?.ordinals,u?.payment,...Array.isArray(u?.all)?u.all:[],c?.ordinalsAddress,c?.address,c?.paymentAddress,d].map(e=>e?String(e).trim():null).filter(Boolean);for(const t of e){if(!E){k=t;break}if(I(t)!==E){k=t;break}}if(!k)throw new Error("Could not choose a buyer receive address that differs from the seller inscription script. You are likely still connected to the seller wallet/account, or the app has not refreshed addresses after switching accounts.")}catch(cC){throw new Error(`createBuyerFundedPsbtForSellerCountersign: invalid buyer receive/change address (${cC?.message||cC})`)}{const e=s.address.toOutputScript(k,l),t=s.address.toOutputScript(d,l);xw(f,1,{script:e,value:Number(p)}),xw(f,0,{script:t,value:nw(f.txOutputs?.[0]?.value)||0})}try{if(E){const e=f?.txOutputs?.[1],t=e?.script?Buffer.from(e.script).toString("hex"):null;if(t&&t===E)throw new Error("Output[1] (inscription receive) is still the seller inscription script after overwrite.")}}catch(cC){throw new Error(`createBuyerFundedPsbtForSellerCountersign: ${cC?.message||cC}`)}const A=Array.isArray(n)?n:c?.utxos||c?.paymentUtxos||null,N=(Array.isArray(A)?A:[]).map(e=>_w(e,d)).filter(Boolean);if(0===N.length)throw new Error("createBuyerFundedPsbtForSellerCountersign: buyerPaymentUtxos is required (fetch UTXOs first)");const T=N.slice().sort((e,t)=>t.value-e.value),_=[],P=[];let B=0;const C=t=>{const n=String(t||"").trim();return e?.getState?.()?.paymentPublicKey&&(n.startsWith("3")||n.startsWith("2"))?"p2sh-p2wpkh":pw(n)},O=(t,n)=>{const r=String(n.address||d),i=s.address.toOutputScript(r,l),a=C(r);vw(f,t,n.txid,n.vout);const o=f?.data?.inputs?.[t];if(!o)throw new Error(`createBuyerFundedPsbtForSellerCountersign: missing psbt.data.inputs[${t}] to replace`);o.witnessUtxo={script:i,value:n.value};const c=hw(s,a,e,r);c.redeemScript&&(o.redeemScript=c.redeemScript),_.push({index:t,address:r}),P.push(a),B+=n.value},L=t=>{const n=String(t.address||d),r=s.address.toOutputScript(n,l),i=C(n),a=hw(s,i,e,n);f.addInput({hash:Buffer.from(String(t.txid).trim(),"hex").reverse(),index:t.vout,witnessUtxo:{script:r,value:t.value},sequence:4294967293,...a.redeemScript?{redeemScript:a.redeemScript}:{}}),_.push({index:f.inputCount-1,address:n}),P.push(i),B+=t.value},F=T.slice(),R=e=>{const t=F[e];return F.splice(e,1),t},U=(()=>{if(F.length<2)return null;const e=F.slice().sort((e,t)=>e.value-t.value);for(let n=0;n<e.length;n++)for(let t=n+1;t<e.length;t++)if(e[n].value+e[t].value>=P2TR_DUST)return[e[n],e[t]];const t=F.slice().sort((e,t)=>t.value-e.value);return[t[0],t[1]]})();if(!U)throw new Error("createBuyerFundedPsbtForSellerCountersign: need at least 2 buyer UTXOs to fill Open Store dummy input slots");const M=R(F.findIndex(e=>e.txid===U[0].txid&&e.vout===U[0].vout)),$=R(F.findIndex(e=>e.txid===U[1].txid&&e.vout===U[1].vout));O(0,M),O(1,$);const H=BigInt(M.value+$.value);{const e=s.address.toOutputScript(d,l);xw(f,0,{script:e,value:Number(H)})}const D=BigInt(g)>=p?0n:p-BigInt(g),z=BigInt(h),W=z+m+D,V=f?.data?.inputs?.[2]?.witnessUtxo?.script,j=fw(V),q=[P[0]||"p2wpkh",P[1]||"p2wpkh","p2wpkh"===j?"p2wpkh":"p2tr"],K=(f?.txOutputs||[]).map(e=>mw(e?.script)),X=Number(a||10);let G=0n;for(const ce of F){L(ce),G+=BigInt(ce.value);const e=f.inputCount,t=_g(e,f.txOutputs.length,!0,0,{isReveal:!1,inputTypes:[...q,...P.slice(2)].slice(0,e),outputTypes:K});if(G>=W+BigInt(Math.ceil(X*t)))break}const Y=f.inputCount,J=f.txOutputs.length,Q=[...q,...P.slice(2)].slice(0,Y),Z=_g(Y,J,!0,0,{isReveal:!1,inputTypes:Q,outputTypes:K}),ee=BigInt(Math.ceil(X*Z)),te=G-(W+ee);let ne=ee,re=te;if(te>=BigInt(P2TR_DUST)){const e=_g(Y,J+1,!0,0,{isReveal:!1,inputTypes:Q,outputTypes:[...K,pw(d)]}),t=BigInt(Math.ceil(X*e)),n=G-(W+t);n>=BigInt(P2TR_DUST)&&(ne=t,re=n)}if(G<W+ne){const e=W+ne,t=e-G;throw new Error(`createBuyerFundedPsbtForSellerCountersign: insufficient buyer funds. Need >= ${e.toString()} sats (price+reclaim=${z.toString()}, platformFee=${m.toString()}, postageTopUp=${D.toString()}, estFee=${ne.toString()}). Have ${G.toString()} sats. Short ${t.toString()} sats. Note: split-funding can increase UTXO count for Open Store, but it cannot create sats; fund your payment address and retry.`)}re>=BigInt(P2TR_DUST)&&f.addOutput({address:d,value:Number(re)});const ie=f.toHex(),ae=Nw(f,{sellerInputIndex:2,inscriptionOutputIndex:1,sellerPayoutOutputIndex:2,platformFeeOutputIndex:3}),oe=await Xg(e,ie,{autoFinalized:!1,toSignInputs:_},!1),se=oe?.signedPsbt||null;if(!se)throw new Error("createBuyerFundedPsbtForSellerCountersign: wallet did not return signed buyer PSBT");const le=s.Psbt.fromHex(se,{network:l});try{Tw(ae,le,{sellerInputIndex:2,inscriptionOutputIndex:1,sellerPayoutOutputIndex:2,platformFeeOutputIndex:3})}catch(cC){throw new Error(`createBuyerFundedPsbtForSellerCountersign: ${cC?.message||cC}`)}try{const e=s.Psbt.fromHex(ie,{network:l}),t=e?.data?.inputs?.[2]||{},n=le?.data?.inputs?.[2]||{};x(n,t,"tapInternalKey"),x(n,t,"tapMerkleRoot"),x(n,t,"tapBip32Derivation"),x(n,t,"witnessUtxo"),x(n,t,"nonWitnessUtxo"),x(n,v,"tapInternalKey"),x(n,v,"tapMerkleRoot"),x(n,v,"tapBip32Derivation"),x(n,v,"witnessUtxo"),x(n,v,"nonWitnessUtxo")}catch{}return{mode:"buyer-funded-psbt",source:"seller-offer-psbt",sellerInputIndex:2,sellerPayoutOutputIndex:2,inferredPriceSats:w.toString(),postageSats:p.toString(),platformFeeSats:m.toString(),sellerInputValueSats:String(g),buyerPostageTopUpSats:D.toString(),buyerInputsSats:B,feeSats:ne.toString(),changeSats:re>=BigInt(P2TR_DUST)?re.toString():"0",signedBuyerPsbtHex:se,signedBuyerPsbtBase64:Buffer.from(se,"hex").toString("base64")}},estimateBuyNeedFromInscriptionId:async function({walletProvider:e,inscriptionId:t,buyerChangeAddress:n,feeRateSatPerVb:r=10}){if(!e)throw new Error("estimateBuyNeedFromInscriptionId: walletProvider is required");const i=uw(t);if(!i?.inscriptionId)throw new Error("estimateBuyNeedFromInscriptionId: inscriptionId must look like <txid>i<index>");let a=null,o=null;try{a=await cw(i.inscriptionId),o=lw(a)}catch{}let s=null;{const e=nw(a?.value);null!=e&&e>0&&(s=e)}if(null==s&&o?.txid)try{const e=await gg(),t=await dw(o.txid),n=e.Transaction.fromHex(t),r=n?.outs?.[o.vout],i=nw(r?.value);null!=i&&i>0&&(s=i)}catch{}if(null==s||s<=0)throw new Error("estimateBuyNeedFromInscriptionId: could not determine inscription postage");const l=String(o?.txid||i.revealTxid||"").toLowerCase().trim();if(!l)throw new Error("estimateBuyNeedFromInscriptionId: failed to resolve a txid");return await Cw({walletProvider:e,revealTxid:l,buyerChangeAddress:n,expectedPostageSats:s,feeRateSatPerVb:r})},estimateBuyNeedFromRevealTx:Cw,estimateBuyNeedFromSellerOfferPsbt:async function({walletProvider:e,sellerOfferPsbt:t,buyerChangeAddress:n,feeRateSatPerVb:r=10}){if(!e)throw new Error("estimateBuyNeedFromSellerOfferPsbt: walletProvider is required");const i=String(t||"").trim();if(!i)throw new Error("estimateBuyNeedFromSellerOfferPsbt: sellerOfferPsbt is required");const a=String(n||"").trim();if(!a)throw new Error("estimateBuyNeedFromSellerOfferPsbt: buyerChangeAddress is required");const o=await gg(),s=aw(o);let l;try{l=o.Psbt.fromBase64(i,{network:s})}catch{l=o.Psbt.fromHex(i,{network:s})}Aw(l,{marker:null,context:"estimateBuyNeedFromSellerOfferPsbt"});const c=rw(nw(l?.txOutputs?.[1]?.value)||0,"offer.output[1].value");if(c<=0n)throw new Error("estimateBuyNeedFromSellerOfferPsbt: offer output[1] postage must be > 0");let u=0n;return l?.txOutputs?.[3]&&(u=rw(nw(l.txOutputs[3].value)||0,"offer.output[3].value"),u<0n&&(u=0n)),Bw({btc:o,network:s,walletProvider:e,offerPsbt:l,buyerChangeAddress:a,postageSats:c,platformFeeSats:u,feeRateSatPerVb:r})},getSellerOfferPsbtBase64FromRevealTxid:async function(e){const t=String(e||"").trim().toLowerCase();if(!/^[0-9a-f]{64}$/.test(t))throw new Error("getSellerOfferPsbtBase64FromRevealTxid: revealTxid must be 64 hex");const n=await gg(),r=await dw(t),i=await Mb(n,r,{requirePsbtMagic:!0});if(!i||0===i.length)throw new Error("No embedded seller offer PSBT found in reveal tx");return Buffer.from(i).toString("base64")}},Symbol.toStringTag,{value:"Module"})),Lw="nexus_fee_rates";function Fw(){sessionStorage.removeItem(Lw),sessionStorage.removeItem("nexus_utxo_cache"),Object.keys(sessionStorage).filter(e=>e.startsWith("nexus_complete_")).forEach(e=>sessionStorage.removeItem(e)),Object.keys(sessionStorage).filter(e=>e.startsWith("nexus_inscriptions_")).forEach(e=>sessionStorage.removeItem(e)),Object.keys(localStorage).filter(e=>e.startsWith("nexus_proxy_")).forEach(e=>localStorage.removeItem(e)),Object.keys(sessionStorage).filter(e=>e.startsWith("nexus_ordinals_")).forEach(e=>sessionStorage.removeItem(e))}function Rw({walletAddress:e,walletType:t,isConnected:n,onConnect:r,onDisconnect:i,connectDisabled:a=!1,showLiveTestWarning:o=!1,activeSection:s="inscribe",oodlSection:l="marketplace",onSectionChange:c,utxoCount:u=0}){const[d,f]=rt.useState(!1),p=rt.useRef(null),m=rt.useRef(null);rt.useEffect(()=>{if(!d)return;const e=e=>{m.current&&!m.current.contains(e.target)&&p.current&&!p.current.contains(e.target)&&f(!1)},t=e=>{"Escape"===e.key&&f(!1)};return document.addEventListener("pointerdown",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("pointerdown",e),document.removeEventListener("keydown",t)}},[d]);const h=e=>e?`${e.slice(0,6)}...${e.slice(-4)}`:"",g=async()=>{i&&await i()},y=async()=>{i&&await i(),r&&r()},b="utxos"===s,w="inscribe"===s,x="oodl"===s&&"marketplace"===l,v="oodl"===s&&("hub"===l||"oodl"===l||"offer"===l),S=[{key:"utxos",label:"UTXOs"+(Number.isFinite(u)?` (${u})`:""),active:b,section:"utxos"},{key:"inscribe",label:"Inscribe",active:w,section:"inscribe"},{key:"marketplace",label:"Marketplace",active:x,section:"marketplace"},{key:"hub",label:"List & Trade",active:v,section:"hub"}],E="shrink-0 px-2.5 sm:px-3 py-1.5 text-xs sm:text-sm font-semibold rounded-lg border whitespace-nowrap transition-colors";return it.createElement("div",{className:"relative z-[99999]"},it.createElement("div",{className:"flex items-center gap-1.5 sm:gap-3 px-2 sm:px-6 py-2.5 sm:py-4 border-b border-neutral-800/60 bg-gradient-to-b from-neutral-900/80 to-neutral-900/50 backdrop-blur-md overflow-hidden"},it.createElement("div",{className:"flex items-center gap-1.5 sm:gap-2 shrink-0"},it.createElement("h1",{className:"text-lg sm:text-xl font-bold bg-gradient-to-r from-purple-300 via-purple-400 to-purple-500 bg-clip-text text-transparent drop-shadow-lg whitespace-nowrap"},"Oodinals"),it.createElement("span",{className:"hidden sm:inline-flex text-[11px] font-semibold uppercase tracking-wide text-neutral-200 bg-neutral-800/40 px-2 py-1 rounded-md border border-neutral-700/40"},"Alpha")),"function"==typeof c?it.createElement("div",{className:"hidden sm:flex items-center gap-1.5 sm:gap-2"},S.map(e=>{return it.createElement("button",{key:e.key,onClick:()=>c(e.section),className:(t=e.active,t?`${E} bg-purple-500/20 text-purple-300 border-purple-500/40`:`${E} bg-neutral-800/40 text-neutral-300 border-neutral-700/40 hover:bg-neutral-700/50`),"aria-label":`${e.label} section`,"aria-current":e.active?"page":void 0,title:e.label},e.label);var t})):null,it.createElement("div",{className:"flex-1 min-w-0"}),it.createElement("div",{className:"flex items-center gap-2 shrink-0"},n?it.createElement(it.Fragment,null,t&&it.createElement("div",{className:"hidden sm:flex items-center gap-2 text-xs text-neutral-300 font-semibold bg-neutral-800/40 px-3 py-1.5 rounded-lg border border-neutral-700/40"},t),e&&it.createElement("div",{className:"hidden sm:flex items-center gap-2 text-xs text-neutral-400 font-mono bg-neutral-800/40 px-2.5 sm:px-3 py-1.5 rounded-lg border border-neutral-700/40 hover:border-neutral-600/60 transition-colors max-w-[120px] sm:max-w-[160px]"},it.createElement("span",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse shrink-0"}),it.createElement("span",{className:"truncate"},h(e))),it.createElement("button",{onClick:y,className:"hidden sm:inline-flex px-2.5 sm:px-3 py-1.5 text-xs sm:text-sm font-medium rounded-lg bg-purple-500/10 hover:bg-purple-500/20 border border-purple-500/40 hover:border-purple-500/60 text-purple-300 hover:text-purple-200 transition-colors whitespace-nowrap","aria-label":"Switch Wallet",title:"Switch to a different wallet"},"Switch"),it.createElement("button",{onClick:g,className:"hidden sm:inline-flex px-2.5 sm:px-3 py-1.5 text-xs sm:text-sm font-medium rounded-lg bg-red-500/10 hover:bg-red-500/20 border border-red-500/40 hover:border-red-500/60 text-red-300 hover:text-red-200 transition-colors whitespace-nowrap","aria-label":"Disconnect Wallet",title:"Disconnect wallet"},"Disconnect"),it.createElement("div",{className:"sm:hidden flex items-center gap-1 text-[10px] text-neutral-400 font-mono bg-neutral-800/40 px-1.5 py-1 rounded-md border border-neutral-700/40"},it.createElement("span",{className:"w-1.5 h-1.5 rounded-full bg-green-500 shrink-0"}),it.createElement("span",{className:"truncate max-w-[60px]"},h(e)))):it.createElement("button",{onClick:()=>{a||r&&r()},disabled:a,className:a?"px-5 py-2 text-sm font-semibold rounded-lg bg-neutral-800 text-neutral-400 cursor-not-allowed":"px-5 py-2 text-sm font-semibold rounded-lg bg-purple-600 hover:bg-purple-500 text-white transition-colors","aria-label":"Connect Wallet"},"Connect Wallet")),"function"==typeof c?it.createElement("div",{className:"sm:hidden"},it.createElement("button",{ref:m,onClick:()=>f(e=>!e),className:"p-2.5 rounded-lg bg-neutral-800/60 border border-neutral-700/40 text-neutral-300 hover:bg-neutral-700/50 transition-colors touch-manipulation","aria-label":d?"Close navigation menu":"Open navigation menu","aria-expanded":d,"aria-controls":"mobile-nav-menu"},it.createElement("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2},d?it.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"}):it.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"}))),d&&xt.createPortal(it.createElement("div",{ref:p},it.createElement("div",{className:"fixed inset-0 bg-black/40 sm:hidden",style:{zIndex:2147483646},"aria-hidden":"true",onClick:()=>f(!1)}),it.createElement("div",{id:"mobile-nav-menu",role:"menu",className:"fixed right-2 top-14 w-52 bg-neutral-900 border border-neutral-700/60 rounded-xl shadow-2xl overflow-hidden animate-in fade-in slide-in-from-top-2 duration-150",style:{zIndex:2147483647}},S.map(e=>it.createElement("button",{key:e.key,role:"menuitem",onClick:()=>{c(e.section),f(!1)},"aria-current":e.active?"page":void 0,className:e.active?"w-full text-left px-4 py-3.5 text-sm font-semibold bg-purple-500/15 text-purple-300 border-l-2 border-purple-400 touch-manipulation":"w-full text-left px-4 py-3.5 text-sm font-medium text-neutral-300 hover:bg-neutral-800/60 border-l-2 border-transparent transition-colors touch-manipulation"},e.label)),n&&it.createElement("div",{className:"border-t border-neutral-700/40"},it.createElement("button",{role:"menuitem",onClick:()=>{y(),f(!1)},className:"w-full text-left px-4 py-3.5 text-sm font-medium text-purple-300 hover:bg-neutral-800/60 transition-colors touch-manipulation"},"Switch Wallet"),it.createElement("button",{role:"menuitem",onClick:()=>{g(),f(!1)},className:"w-full text-left px-4 py-3.5 text-sm font-medium text-red-300 hover:bg-neutral-800/60 transition-colors touch-manipulation"},"Disconnect")))),document.body)):null),o&&it.createElement("div",{className:"px-3 sm:px-6 pt-2 pb-0"},it.createElement("p",{className:"max-w-[820px] text-[11px] leading-snug text-amber-200/90"},"Experimental live test \u2014 use at your own risk. Ensure inputs/outputs look correct in your wallet extension before signing.")))}const Uw={PAYMENT:"payment",ORDINALS:"ordinals",ANY:"any"};function Mw(e){return!!e&&!!(e.address||e.paymentAddress||e.ordinalsAddress)}function $w(e){if(!Mw(e))throw new Error("Invalid wallet state: no address available");return e.paymentAddress||e.address}function Hw(e){if(!Mw(e))throw new Error("Invalid wallet state: no address available");return e.ordinalsAddress||e.address}function Dw(e){if(!Mw(e))throw new Error("Invalid wallet state: no address available");const t=[];return e.address&&t.push(e.address),e.ordinalsAddress&&t.push(e.ordinalsAddress),e.paymentAddress&&t.push(e.paymentAddress),[...new Set(t)]}const zw=Object.freeze(Object.defineProperty({__proto__:null,AddressType:Uw,getAddressForOperation:function(e,t){if(!Mw(e))throw new Error("Invalid wallet state: no address available");switch(t){case Uw.PAYMENT:return $w(e);case Uw.ORDINALS:return Hw(e);case Uw.ANY:return e.address||e.ordinalsAddress||e.paymentAddress;default:throw new Error(`Unknown address type: ${t}`)}},getAllAddresses:Dw,getOrdinalsAddress:Hw,getPaymentAddress:$w,isValidWalletState:Mw},Symbol.toStringTag,{value:"Module"}));function Ww({walletAddress:e,onAutoFetch:t,onManualMode:n,isLoading:r=!1}){const[i,a]=rt.useState(!1),[o,s]=rt.useState(!1);return rt.createElement("div",{className:"utxo-fetch-control",style:{display:"flex",flexDirection:"column",gap:"var(--spacing-lg)",padding:"var(--spacing-lg)"}},rt.createElement("div",{className:"inscription-card",style:{background:"linear-gradient(135deg, var(--accentPurple) 0%, var(--accentBlue) 100%)",color:"white",padding:"var(--spacing-lg)",textAlign:"center"}},rt.createElement("h2",{style:{margin:0,marginBottom:"var(--spacing-sm)",fontSize:"var(--fontSize-xl)",fontWeight:"var(--fontWeight-bold)"}},"\ud83d\udcb0 Select Payment UTXOs")),rt.createElement("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(240px, 1fr))",gap:"var(--spacing-md)"}},rt.createElement("div",{className:"inscription-card",style:{borderLeft:"4px solid var(--accentGreen)",cursor:r?"not-allowed":"pointer",opacity:r?.6:1,transition:"all 0.2s ease",position:"relative",overflow:"hidden"},onMouseEnter:e=>!r&&(e.currentTarget.style.transform="translateY(-4px)"),onMouseLeave:e=>!r&&(e.currentTarget.style.transform="translateY(0)"),onClick:r?void 0:()=>{a(!0)}},rt.createElement("div",{style:{position:"absolute",top:"10px",right:"10px",fontSize:"2rem",opacity:.2}},"\ud83d\ude80"),rt.createElement("h3",{style:{margin:0,marginBottom:"var(--spacing-sm)",fontSize:"var(--fontSize-lg)",fontWeight:"var(--fontWeight-bold)",color:"var(--accentGreen)",display:"flex",alignItems:"center",gap:"var(--spacing-sm)"}},rt.createElement("span",null,"\ud83d\ude80"),rt.createElement("span",null,"Auto-Fetch")),rt.createElement("p",{style:{margin:0,marginBottom:"var(--spacing-md)",fontSize:"var(--fontSize-sm)",color:"var(--textSecondary)",lineHeight:"1.5"}},"Automatically fetch UTXOs using our secure Bitcoin Proxy"),rt.createElement("div",{style:{padding:"var(--spacing-sm)",background:"var(--successBg)",borderRadius:"var(--radius-sm)",marginBottom:"var(--spacing-sm)"}},rt.createElement("p",{style:{margin:0,fontSize:"var(--fontSize-xs)",color:"var(--textSecondary)",fontWeight:"var(--fontWeight-semibold)"}},"\u2705 Fast and automatic",rt.createElement("br",null),"\u2705 Filters out inscriptions",rt.createElement("br",null),"\u2705 Secure CSP-compliant")),rt.createElement("button",{disabled:r,className:"btn-primary",style:{width:"100%",padding:"var(--spacing-md)",fontSize:"var(--fontSize-sm)",fontWeight:"var(--fontWeight-semibold)",pointerEvents:"none"}},"Choose Auto-Fetch")),rt.createElement("div",{className:"inscription-card",style:{borderLeft:"4px solid var(--accentAmber)",cursor:r?"not-allowed":"pointer",opacity:r?.6:1,transition:"all 0.2s ease",position:"relative",overflow:"hidden"},onMouseEnter:e=>!r&&(e.currentTarget.style.transform="translateY(-4px)"),onMouseLeave:e=>!r&&(e.currentTarget.style.transform="translateY(0)"),onClick:r?void 0:()=>{s(!0)}},rt.createElement("div",{style:{position:"absolute",top:"10px",right:"10px",fontSize:"2rem",opacity:.2}},"\ud83d\udccb"),rt.createElement("h3",{style:{margin:0,marginBottom:"var(--spacing-sm)",fontSize:"var(--fontSize-lg)",fontWeight:"var(--fontWeight-bold)",color:"var(--accentAmber)",display:"flex",alignItems:"center",gap:"var(--spacing-sm)"}},rt.createElement("span",null,"\ud83d\udccb"),rt.createElement("span",null,"Manual Paste")),rt.createElement("p",{style:{margin:0,marginBottom:"var(--spacing-md)",fontSize:"var(--fontSize-sm)",color:"var(--textSecondary)",lineHeight:"1.5"}},"Manually paste UTXOs from mempool.space"),rt.createElement("div",{style:{padding:"var(--spacing-sm)",background:"var(--warningBg)",borderRadius:"var(--radius-sm)",marginBottom:"var(--spacing-sm)"}},rt.createElement("p",{style:{margin:0,fontSize:"var(--fontSize-xs)",color:"var(--textSecondary)",fontWeight:"var(--fontWeight-semibold)"}},"\u2705 Full control",rt.createElement("br",null),"\u2705 Works if popups blocked",rt.createElement("br",null),"\u26a0\ufe0f Requires manual steps")),rt.createElement("button",{disabled:r,className:"btn-secondary",style:{width:"100%",padding:"var(--spacing-md)",fontSize:"var(--fontSize-sm)",fontWeight:"var(--fontWeight-semibold)",pointerEvents:"none"}},"Choose Manual"))),i&&rt.createElement("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4,padding:"var(--spacing-lg)",animation:"fadeIn 0.2s ease"},onClick:()=>a(!1)},rt.createElement("div",{className:"inscription-card",style:{maxWidth:"500px",width:"100%",background:"var(--bgPrimary)",border:"2px solid var(--accentGreen)",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.5)",animation:"scaleIn 0.2s ease"},onClick:e=>e.stopPropagation()},rt.createElement("div",{style:{padding:"var(--spacing-lg)",borderBottom:"1px solid var(--borderMedium)"}},rt.createElement("h3",{style:{margin:0,marginBottom:"var(--spacing-sm)",fontSize:"var(--fontSize-lg)",fontWeight:"var(--fontWeight-bold)",color:"var(--accentGreen)",display:"flex",alignItems:"center",gap:"var(--spacing-sm)"}},rt.createElement("span",{style:{fontSize:"1.5rem"}},"\ud83e\ude9f"),rt.createElement("span",null,"Popup Window Required"))),rt.createElement("div",{style:{padding:"var(--spacing-lg)"}},rt.createElement("p",{style:{margin:0,marginBottom:"var(--spacing-md)",fontSize:"var(--fontSize-base)",color:"var(--textPrimary)",lineHeight:"1.6"}},"When you click ",rt.createElement("strong",null,'"Fetch UTXOs"'),", a popup window will open to securely fetch your UTXOs."),rt.createElement("div",{style:{background:"var(--successBg)",padding:"var(--spacing-md)",borderRadius:"var(--radius-md)",marginBottom:"var(--spacing-md)",border:"1px solid var(--accentGreen)"}},rt.createElement("p",{style:{margin:0,fontSize:"var(--fontSize-sm)",color:"var(--textSecondary)",fontWeight:"var(--fontWeight-semibold)",lineHeight:"1.6"}},rt.createElement("strong",{style:{color:"var(--accentGreen)"}},"What will happen:"),rt.createElement("br",null),"1\ufe0f\u20e3 A small popup window will open",rt.createElement("br",null),"2\ufe0f\u20e3 It will fetch your UTXOs via our Bitcoin Proxy",rt.createElement("br",null),"3\ufe0f\u20e3 The window will close automatically",rt.createElement("br",null),"4\ufe0f\u20e3 Your UTXOs will be filtered and displayed")),rt.createElement("div",{style:{background:"var(--warningBg)",padding:"var(--spacing-md)",borderRadius:"var(--radius-md)",marginBottom:"var(--spacing-lg)",border:"1px solid var(--accentAmber)"}},rt.createElement("p",{style:{margin:0,fontSize:"var(--fontSize-sm)",color:"var(--textSecondary)",lineHeight:"1.6"}},"\u26a0\ufe0f ",rt.createElement("strong",null,"Allow popups for this site")," if your browser blocks them")),rt.createElement("div",{style:{display:"flex",gap:"var(--spacing-md)"}},rt.createElement("button",{onClick:()=>a(!1),className:"btn-secondary",style:{flex:1,padding:"var(--spacing-md)"}},"Cancel"),rt.createElement("button",{onClick:()=>{a(!1),t&&t()},className:"btn-primary",style:{flex:2,padding:"var(--spacing-md)",fontWeight:"var(--fontWeight-bold)"}},"\ud83d\ude80 Fetch UTXOs"))))),o&&rt.createElement("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4,padding:"var(--spacing-lg)",animation:"fadeIn 0.2s ease"},onClick:()=>s(!1)},rt.createElement("div",{className:"inscription-card",style:{maxWidth:"600px",width:"100%",background:"var(--bgPrimary)",border:"2px solid var(--accentAmber)",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.5)",animation:"scaleIn 0.2s ease"},onClick:e=>e.stopPropagation()},rt.createElement("div",{style:{padding:"var(--spacing-lg)",borderBottom:"1px solid var(--borderMedium)"}},rt.createElement("h3",{style:{margin:0,marginBottom:"var(--spacing-sm)",fontSize:"var(--fontSize-lg)",fontWeight:"var(--fontWeight-bold)",color:"var(--accentAmber)",display:"flex",alignItems:"center",gap:"var(--spacing-sm)"}},rt.createElement("span",{style:{fontSize:"1.5rem"}},"\ud83d\udccb"),rt.createElement("span",null,"Manual UTXO Input"))),rt.createElement("div",{style:{padding:"var(--spacing-lg)"}},rt.createElement("p",{style:{margin:0,marginBottom:"var(--spacing-md)",fontSize:"var(--fontSize-base)",color:"var(--textPrimary)",lineHeight:"1.6"}},"You'll be able to paste UTXOs directly from mempool.space."),rt.createElement("div",{style:{background:"var(--bgSecondary)",padding:"var(--spacing-md)",borderRadius:"var(--radius-md)",marginBottom:"var(--spacing-md)",border:"1px solid var(--borderMedium)"}},rt.createElement("p",{style:{margin:0,marginBottom:"var(--spacing-sm)",fontSize:"var(--fontSize-sm)",color:"var(--textPrimary)",fontWeight:"var(--fontWeight-semibold)"}},"\ud83d\udcdd Steps you'll follow:"),rt.createElement("ol",{style:{margin:0,paddingLeft:"1.5rem",fontSize:"var(--fontSize-sm)",color:"var(--textSecondary)",lineHeight:"1.8"}},rt.createElement("li",null,"Visit mempool.space UTXO API for your address"),rt.createElement("li",null,"Copy the entire JSON array response"),rt.createElement("li",null,"Paste it into the text area"),rt.createElement("li",null,'Click "Parse & Filter UTXOs"'),rt.createElement("li",null,"Wait for verification (filters out inscriptions)"),rt.createElement("li",null,"Select spendable UTXOs"))),rt.createElement("div",{style:{background:"var(--successBg)",padding:"var(--spacing-md)",borderRadius:"var(--radius-md)",marginBottom:"var(--spacing-lg)",border:"1px solid var(--accentGreen)"}},rt.createElement("p",{style:{margin:0,fontSize:"var(--fontSize-sm)",color:"var(--textSecondary)",lineHeight:"1.6"}},"\u2705 ",rt.createElement("strong",null,"Benefits:")," Works without popups, full control over which UTXOs to use")),rt.createElement("div",{style:{display:"flex",gap:"var(--spacing-md)"}},rt.createElement("button",{onClick:()=>s(!1),className:"btn-secondary",style:{flex:1,padding:"var(--spacing-md)"}},"Cancel"),rt.createElement("button",{onClick:()=>{s(!1),n&&n()},className:"btn-primary",style:{flex:2,padding:"var(--spacing-md)",fontWeight:"var(--fontWeight-bold)"}},"\ud83d\udccb Continue to Manual Input"))))),rt.createElement("style",{jsx:!0},"\n        @keyframes fadeIn {\n          from { opacity: 0; }\n          to { opacity: 1; }\n        }\n        \n        @keyframes scaleIn {\n          from { \n            opacity: 0;\n            transform: scale(0.9);\n          }\n          to { \n            opacity: 1;\n            transform: scale(1);\n          }\n        }\n      "))}let Vw=null,jw=!1,qw=null,Kw=[];function Xw(e){if("function"!=typeof e)throw new Error("Callback must be a function");return Kw.push(e),()=>{const t=Kw.indexOf(e);t>-1&&Kw.splice(t,1)}}async function Gw(){const e=await async function(){try{const e=th("/r/blockheight"),t=await fetch(e);if(!t.ok)return null;const n=await t.text(),r=parseInt(n.trim());return isNaN(r)?null:r}catch(Kh){return null}}();if(null!==e)if(null!==Vw){if(e>Vw){const t=Vw;Vw=e;for(const n of Kw)try{n(e,t)}catch(Kh){}}else if(e<Vw){Vw=e;for(const t of Kw)try{t(e,Vw,!0)}catch(Kh){}}}else Vw=e}function Yw(e=!0){jw||(jw=!0,e&&Gw(),qw=setInterval(Gw,6e4))}function Jw(){jw&&(jw=!1,qw&&(clearInterval(qw),qw=null))}const Qw=Object.freeze(Object.defineProperty({__proto__:null,onBlockChange:Xw,startBlockHeightMonitor:Yw,stopBlockHeightMonitor:Jw},Symbol.toStringTag,{value:"Module"}));function Zw({walletState:e=null,selectedUtxos:t=[],onUtxosChange:r,onUtxoSelect:i,onFeesLoaded:a,onFilteredUtxosLoaded:o,onScanStateChange:s,rescanRequestId:l=0,requiredAmount:c=0}){const[u,d]=rt.useState(null),[f,p]=rt.useState(!1),[m,h]=rt.useState(null),[g,y]=rt.useState(null),[b,w]=rt.useState(""),[x,v]=rt.useState(!1),[S,E]=rt.useState(!0),[I,k]=rt.useState(null),[A,N]=rt.useState(new Set),T=rt.useRef(l),_=it.useMemo(()=>{if(!e||!e.isConnected)return null;try{return $w(e)}catch(uC){return null}},[e]),P=e=>{d(e),e&&o&&o(e)};rt.useEffect(()=>{const t=Number(l),n=Number(T.current);if(Number.isFinite(t)&&t!==n&&(T.current=t,e?.isConnected&&_)){try{s?.({status:"loading",phase:"utxos",message:"Rescanning wallet UTXOs\u2026",ts:Date.now(),forceRefresh:!0})}catch(r){}F(!0).catch(e=>{try{s?.({status:"error",phase:"utxos",message:e?.message||String(e),ts:Date.now()})}catch(r){}})}},[l,e?.isConnected,_]);const[B,C]=rt.useState(null);rt.useEffect(()=>{if(!e||!e.isConnected)return void(B&&(d(null),k(null),E(!0),v(!1),w(""),h(null),C(null),N(new Set)));const t=_;B&&t!==B&&(d(null),k("auto"),E(!1),v(!1),w(""),h(null),N(new Set),F(!0).catch(t=>{try{const t=Dw(e),n=Uy(t.sort().join(","));n&&(t.length>1?t.length:t[0].substring(0,20),P(n),r&&n.spendable&&n.spendable.length>0&&r(n.spendable))}catch(cC){}})),t&&t!==B&&C(t)},[e,_]);const[O,L]=it.useState(!1);rt.useEffect(()=>{e&&e.isConnected?_&&(O||(k("auto"),E(!1),F(!0).then(e=>{e&&L(!0)}).catch(e=>{}))):L(!1)},[e?.isConnected,_,O]),rt.useEffect(()=>{if(!e||!e.isConnected)return;if(u)return;if(B)return;const t=Dw(e),n=Uy(t.sort().join(","));n&&(t.length>1?t.length:t[0].substring(0,20),P(n),k("auto"),E(!1),r&&n.spendable&&n.spendable.length>0&&r(n.spendable))},[e]),rt.useEffect(()=>{if(!e?.isConnected||!_)return void Jw();const t=Xw(async(e,t)=>{await F(!0)});return Yw(),()=>{t(),Jw()}},[e?.isConnected,_]);const F=async(t=!1)=>{if(!e)return h("No wallet connected"),!1;p(!0),h(null),y(null);try{s?.({status:"loading",phase:"utxos",message:t?"Fetching fresh wallet data\u2026":"Fetching wallet data\u2026",ts:Date.now(),forceRefresh:!!t})}catch(o){}let i=!1;try{const{getAddressForOperation:l,AddressType:c}=await n(async()=>{const{getAddressForOperation:e,AddressType:t}=await Promise.resolve().then(()=>zw);return{getAddressForOperation:e,AddressType:t}},__VITE_PRELOAD__),u=l(e,c.PAYMENT),d=e?.ordinalsAddress;if(!u)throw new Error("No payment address available");const f=[...new Set([u,d].filter(Boolean))];if(t){const{clearAllCachesForWallet:e}=await n(async()=>{const{clearAllCachesForWallet:e}=await Promise.resolve().then(()=>CB);return{clearAllCachesForWallet:e}},__VITE_PRELOAD__);await e(f)}const p=await Iy(f,{forceRefresh:t,progressCallback:e=>{}});p.utxos.length>0&&p.utxos[0];const m=p.utxos.filter(e=>{const t=`${e.txid}:${e.vout}`;return(p.addressUtxoMap?.[t]||e.address)===u}),g=d&&d!==u?p.utxos.filter(e=>{const t=`${e.txid}:${e.vout}`;return(p.addressUtxoMap?.[t]||e.address)===d}):[];if(m.length>0&&m[0],g.length>0&&g[0],g.length,a&&p.fees){const e={...p.fees,timestamp:Date.now()};a(e)}const b=await qy(m,e=>{y(e);try{s?.({status:"loading",phase:"filter",message:e?.message||e?.status||"Filtering UTXOs\u2026",progress:e,ts:Date.now()})}catch(o){}});if(g.length>0&&d){const{getCachedInscriptions:e}=await n(async()=>{const{getCachedInscriptions:e}=await Promise.resolve().then(()=>VB);return{getCachedInscriptions:e}},__VITE_PRELOAD__),t=e(d);if(t&&t.length>0);else{const e=(await qy(g,null)).unsafe||[],{extractInscriptionsFromUtxos:t}=await n(async()=>{const{extractInscriptionsFromUtxos:e}=await Promise.resolve().then(()=>UB);return{extractInscriptionsFromUtxos:e}},__VITE_PRELOAD__),r=await t(e);if(r.length>0){const{setCachedInscriptions:e}=await n(async()=>{const{setCachedInscriptions:e}=await Promise.resolve().then(()=>VB);return{setCachedInscriptions:e}},__VITE_PRELOAD__);e(d,r)}}}const{setCachedUtxoResult:w}=await n(async()=>{const{setCachedUtxoResult:e}=await Promise.resolve().then(()=>Yy);return{setCachedUtxoResult:e}},__VITE_PRELOAD__);w(f.sort().join(","),b),P(b),y(null),i=!0,0===b.spendable.length?h("No spendable UTXOs found (all contain inscriptions/runes)"):r&&r(b.spendable);try{s?.({status:"utxos-ready",phase:"utxos",message:"Wallet UTXOs loaded. Verifying wallet assets\u2026",ts:Date.now(),spendableCount:b?.spendable?.length||0,unsafeCount:b?.unsafe?.length||0})}catch(o){}}catch(uC){h(`Failed to fetch: ${uC.message}`),d(null);try{s?.({status:"error",phase:"utxos",message:uC?.message||String(uC),ts:Date.now()})}catch(o){}}finally{p(!1),y(null)}return i},R=u?.spendable||[],U=u?.unsafe||[],M=[...R,...U.filter(e=>A.has(`${e.txid}:${e.vout}`))],$=U.filter(e=>!A.has(`${e.txid}:${e.vout}`)),H=M.reduce((e,t)=>e+t.value,0),D=t.reduce((e,t)=>e+t.value,0),z=D>=c,W=e=>e.toLocaleString(),V=_?Gy(_):"";return e&&e.isConnected?it.createElement("div",{className:"utxo-manager",style:{display:"flex",flexDirection:"column",height:"100%",minHeight:0,overflow:"hidden"}},it.createElement("div",{style:{flexShrink:0,padding:"var(--spacing-sm) var(--spacing-md)",borderBottom:"1px solid var(--borderMedium)",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"var(--spacing-sm)"}},it.createElement("div",{style:{display:"flex",alignItems:"center",gap:"var(--spacing-sm)",flex:1,minWidth:0}},it.createElement("h4",{style:{margin:0,fontSize:"var(--fontSize-sm)",fontWeight:"var(--fontWeight-semibold)",color:"var(--textPrimary)",whiteSpace:"nowrap"}},"\ud83d\udcb0 Select Payment UTXOs"),_&&it.createElement("div",{style:{display:"flex",alignItems:"center",gap:"var(--spacing-xs)",padding:"2px 8px",background:"var(--bgTertiary)",borderRadius:"var(--borderRadius-sm)",border:"1px solid var(--borderMedium)",fontSize:"10px",fontFamily:"var(--fontFamily-mono)",color:"var(--accentCyan)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"300px"}},it.createElement("span",{style:{color:"var(--textMuted)"}},"\ud83d\udccd"),it.createElement("span",{title:_},_.substring(0,12),"...",_.substring(_.length-8)))),it.createElement("button",{className:"btn-icon",onClick:e=>{const t=e.shiftKey||e.ctrlKey||e.metaKey;u?t?F(!0):(async()=>{if(_){p(!0),h(null),y(null);try{const e=await Ky(_,1e3,{progressCallback:e=>{y(e)}});P(e),y(null),0===e.spendable.length?h("\u274c No spendable UTXOs found in your payment address!"):r&&r(e.spendable)}catch(uC){uC.message.includes("Bitcoin Proxy")?(h(`\u26a0\ufe0f ${uC.message}\n\nPlease use manual paste method below.`),v(!0)):h(`Failed to fetch UTXOs: ${uC.message}`),d(null)}finally{p(!1),y(null)}}else h("\u274c No payment address available")})():(E(!0),k(null))},disabled:f||!_,style:{fontSize:"var(--fontSize-base)",flexShrink:0},title:u?"Refresh UTXOs (Shift+Click to clear cache)":"Show Fetch Options"},f?"\u23f3":"\ud83d\udd04")),it.createElement("div",{style:{flex:1,minHeight:0,overflowY:"auto",padding:"var(--spacing-md)"}},S&&!u&&_&&it.createElement(Ww,{walletAddress:_,onAutoFetch:async()=>{E(!1),k("auto");try{await F()}catch(uC){}},onManualMode:()=>{E(!1),k("manual"),v(!0)},isLoading:f}),(!S||u)&&it.createElement("div",{style:{marginBottom:"var(--spacing-md)"}},it.createElement("button",{className:"btn-secondary",onClick:()=>v(!x),style:{width:"100%",fontSize:"var(--fontSize-xs)",padding:"var(--spacing-sm)"}},x?"\u25bc":"\u25b6"," Paste UTXOs from Mempool.space"),x&&it.createElement("div",{className:"fade-in",style:{marginTop:"var(--spacing-sm)"}},it.createElement("div",{style:{marginBottom:"var(--spacing-md)",padding:"var(--spacing-sm)",background:"var(--bgSecondary)",borderRadius:"var(--radius-md)",border:"1px solid var(--borderMedium)"}},it.createElement("p",{style:{margin:0,marginBottom:"var(--spacing-sm)",fontSize:"var(--fontSize-xs)",color:"var(--textSecondary)",fontWeight:"var(--fontWeight-semibold)"}},"\ud83d\udccb Fetch UTXOs from BOTH addresses:"),_&&it.createElement("div",{style:{marginBottom:"var(--spacing-xs)"}},it.createElement("div",{style:{fontSize:"9px",color:"var(--textSecondary)",marginBottom:"2px",fontWeight:"var(--fontWeight-semibold)"}},"\ud83d\udcb0 Payment Address:"),it.createElement("div",{style:{display:"flex",gap:"var(--spacing-xs)",alignItems:"stretch"}},it.createElement("div",{style:{flex:1,fontSize:"10px",color:"var(--accentCyan)",padding:"var(--spacing-xs)",background:"var(--bgTertiary)",borderRadius:"var(--radius-sm)",border:"1px solid var(--borderLight)",wordBreak:"break-all",fontFamily:"var(--fontFamily-mono)"}},"mempool.space/api/address/",_,"/utxo"),it.createElement("button",{className:"btn-secondary",onClick:()=>{navigator.clipboard.writeText(V(`/api/address/${_}/utxo`))},style:{fontSize:"10px",padding:"0 var(--spacing-sm)",whiteSpace:"nowrap"},title:"Copy URL to clipboard"},"\ud83d\udccb Copy"))),e?.ordinalsAddress&&e.ordinalsAddress!==_&&it.createElement("div",{style:{marginBottom:"var(--spacing-xs)"}},it.createElement("div",{style:{fontSize:"9px",color:"var(--textSecondary)",marginBottom:"2px",fontWeight:"var(--fontWeight-semibold)"}},"\ud83c\udfa8 Ordinals Address:"),it.createElement("div",{style:{display:"flex",gap:"var(--spacing-xs)",alignItems:"stretch"}},it.createElement("div",{style:{flex:1,fontSize:"10px",color:"var(--accentPurple)",padding:"var(--spacing-xs)",background:"var(--bgTertiary)",borderRadius:"var(--radius-sm)",border:"1px solid var(--borderLight)",wordBreak:"break-all",fontFamily:"var(--fontFamily-mono)"}},"mempool.space/api/address/",e.ordinalsAddress,"/utxo"),it.createElement("button",{className:"btn-secondary",onClick:()=>{navigator.clipboard.writeText(V(`/api/address/${e.ordinalsAddress}/utxo`))},style:{fontSize:"10px",padding:"0 var(--spacing-sm)",whiteSpace:"nowrap"},title:"Copy URL to clipboard"},"\ud83d\udccb Copy"))),it.createElement("div",{style:{marginTop:"var(--spacing-sm)",padding:"var(--spacing-xs)",background:"var(--warningBg)",borderRadius:"var(--radius-sm)",border:"1px solid var(--accentAmber)"}},it.createElement("p",{style:{margin:0,fontSize:"9px",color:"var(--textSecondary)",lineHeight:"1.4"}},"\ud83d\udca1 Copy JSON from both URLs and paste together (will auto-merge)"))),it.createElement("textarea",{className:"form-input form-textarea",value:b,onChange:e=>w(e.target.value),placeholder:"Paste JSON arrays from mempool.space (can paste multiple arrays - will merge automatically)",style:{minHeight:"150px",maxHeight:"300px",fontFamily:"var(--fontFamily-mono)",fontSize:"10px",resize:"vertical"}}),it.createElement("button",{className:"btn-primary-purple",onClick:async()=>{if(b.trim()){p(!0),h(null),y(null);try{const e=Xy(b),t=await Ky(_,1e3,{manualUtxos:e,progressCallback:e=>{y(e)}});P(t),y(null),0===t.spendable.length?h("\u274c No spendable UTXOs found! All UTXOs contain assets or are dust."):r&&r(t.spendable)}catch(uC){h(`Failed to parse UTXOs: ${uC.message}`),d(null)}finally{p(!1),y(null)}}else h("Please paste UTXOs from mempool.space")},disabled:f||!b.trim(),style:{marginTop:"var(--spacing-sm)",width:"100%",fontSize:"var(--fontSize-xs)",padding:"var(--spacing-sm)"}},f?"\u23f3 Filtering...":"\ud83d\udd0d Parse & Filter UTXOs"))),g&&it.createElement("div",{className:"validation-info",style:{marginBottom:"var(--spacing-md)"}},it.createElement("span",null,"\u23f3"),it.createElement("div",{style:{flex:1}},it.createElement("strong",{style:{fontSize:"var(--fontSize-xs)"}},"Checking ordinals.com... ",g.current,"/",g.total," UTXOs"),it.createElement("div",{style:{width:"100%",height:"4px",background:"var(--borderMedium)",borderRadius:"2px",marginTop:"var(--spacing-xs)",overflow:"hidden"}},it.createElement("div",{style:{width:`${g.percentage}%`,height:"100%",background:"var(--gradientPurplePink)",transition:"width 0.3s ease"}})))),m&&it.createElement("div",{className:"validation-error",style:{marginBottom:"var(--spacing-md)"}},it.createElement("span",null,"\u274c"),it.createElement("span",{style:{fontSize:"var(--fontSize-xs)"}},m)),u&&it.createElement("div",{style:{display:"grid",gridTemplateColumns:t.length>0?"repeat(2, 1fr)":"1fr",gap:"var(--spacing-sm)",marginBottom:"var(--spacing-md)"}},it.createElement("div",{style:{padding:"var(--spacing-sm)",background:"var(--bgSecondary)",borderRadius:"var(--radius-md)",border:"1px solid var(--borderMedium)"}},it.createElement("div",{style:{fontSize:"10px",color:"var(--textMuted)",marginBottom:"var(--spacing-xs)",textTransform:"uppercase"}},"Available"),it.createElement("div",{style:{fontSize:"var(--fontSize-base)",fontWeight:"var(--fontWeight-bold)",color:"var(--accentCyan)",fontFamily:"var(--fontFamily-mono)"}},W(H)," sats"),it.createElement("div",{style:{fontSize:"10px",color:"var(--textMuted)",marginTop:"var(--spacing-xs)"}},M.length," spendable")),t.length>0&&it.createElement("div",{style:{padding:"var(--spacing-sm)",background:"var(--bgSecondary)",borderRadius:"var(--radius-md)",border:"1px solid "+(z?"var(--accentGreen)":"var(--accentRed)")}},it.createElement("div",{style:{fontSize:"10px",color:"var(--textMuted)",marginBottom:"var(--spacing-xs)",textTransform:"uppercase"}},"Selected"),it.createElement("div",{style:{fontSize:"var(--fontSize-base)",fontWeight:"var(--fontWeight-bold)",color:z?"var(--accentGreen)":"var(--accentRed)",fontFamily:"var(--fontFamily-mono)"}},W(D)," sats"),it.createElement("div",{style:{fontSize:"10px",color:"var(--textMuted)",marginTop:"var(--spacing-xs)"}},t.length," selected",c>0&&` / ${W(c)} needed`))),M.length>0&&it.createElement("div",{style:{marginBottom:"var(--spacing-md)"}},it.createElement("h5",{style:{margin:0,marginBottom:"var(--spacing-sm)",fontSize:"var(--fontSize-xs)",fontWeight:"var(--fontWeight-semibold)",color:"var(--accentGreen)",textTransform:"uppercase",letterSpacing:"0.5px"}},"\u2705 Spendable UTXOs (",M.length,")"),it.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"var(--spacing-xs)"}},M.map((e,n)=>{const r=t.some(t=>t.txid===e.txid&&t.vout===e.vout);return it.createElement("div",{key:`${e.txid}:${e.vout}`,onClick:()=>i&&i(e),style:{padding:"var(--spacing-sm)",background:r?"rgba(139, 92, 246, 0.1)":"var(--bgSecondary)",border:"1px solid "+(r?"var(--accentPurple)":"var(--borderMedium)"),borderRadius:"var(--radius-sm)",cursor:"pointer",transition:"var(--transition-fast)"}},it.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"var(--spacing-xs)"}},it.createElement("span",{style:{fontSize:"11px",fontWeight:"var(--fontWeight-semibold)",color:"var(--textSecondary)"}},r?"\u2611\ufe0f":"\u2b1c"," UTXO #",n+1),it.createElement("span",{style:{fontSize:"var(--fontSize-sm)",fontWeight:"var(--fontWeight-bold)",color:"var(--accentPurple)",fontFamily:"var(--fontFamily-mono)"}},W(e.value)," sats")),it.createElement("div",{style:{fontSize:"10px",color:"var(--textMuted)",fontFamily:"var(--fontFamily-mono)",wordBreak:"break-all"}},e.txid.substring(0,12),"...",e.txid.substring(52),":",e.vout))}))),($.length>0||U.length>0)&&it.createElement("details",{style:{marginBottom:"var(--spacing-md)"}},it.createElement("summary",{style:{fontSize:"var(--fontSize-xs)",fontWeight:"var(--fontWeight-semibold)",color:"var(--accentRed)",textTransform:"uppercase",cursor:"pointer",padding:"var(--spacing-sm)",background:"rgba(239, 68, 68, 0.05)",borderRadius:"var(--radius-sm)",border:"1px solid rgba(239, 68, 68, 0.2)"}},"\u26a0\ufe0f Unsafe UTXOs (",U.length,") - Contains Assets",A.size>0&&it.createElement("span",{style:{marginLeft:"8px",color:"var(--accentGreen)"}},"(",A.size," marked spendable)")),it.createElement("div",{style:{marginTop:"var(--spacing-sm)",fontSize:"10px",color:"var(--textMuted)"}},U.map((e,t)=>{const n=`${e.txid}:${e.vout}`,r=A.has(n);return it.createElement("div",{key:t,style:{padding:"var(--spacing-xs)",background:r?"rgba(34, 197, 94, 0.05)":"rgba(239, 68, 68, 0.05)",marginBottom:"var(--spacing-xs)",borderRadius:"var(--radius-sm)",border:"1px solid "+(r?"rgba(34, 197, 94, 0.2)":"rgba(239, 68, 68, 0.2)"),display:"flex",flexDirection:"column",gap:"4px"}},it.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},it.createElement("div",{style:{flex:1}},it.createElement("div",{style:{fontFamily:"var(--fontFamily-mono)",fontSize:"10px",color:"var(--textSecondary)"}},e.txid.substring(0,16),"...:",e.vout),it.createElement("div",{style:{color:r?"var(--accentGreen)":"var(--accentRed)",fontSize:"9px",marginTop:"2px"}},r?"\u2705 Marked as spendable by user":`\u26a0\ufe0f ${e.reason||"Contains assets"}`),it.createElement("div",{style:{color:"var(--textMuted)",fontSize:"9px",marginTop:"2px"}},W(e.value)," sats")),it.createElement("button",{onClick:t=>{t.stopPropagation(),(e=>{const t=`${e.txid}:${e.vout}`;N(e=>{const n=new Set(e);return n.has(t)?n.delete(t):n.add(t),n})})(e)},style:{padding:"4px 8px",fontSize:"9px",fontWeight:"var(--fontWeight-semibold)",color:r?"var(--accentRed)":"var(--accentGreen)",background:r?"rgba(239, 68, 68, 0.1)":"rgba(34, 197, 94, 0.1)",border:"1px solid "+(r?"var(--accentRed)":"var(--accentGreen)"),borderRadius:"var(--radius-sm)",cursor:"pointer",transition:"var(--transition-fast)",whiteSpace:"nowrap"},onMouseEnter:e=>{e.target.style.background=r?"rgba(239, 68, 68, 0.2)":"rgba(34, 197, 94, 0.2)"},onMouseLeave:e=>{e.target.style.background=r?"rgba(239, 68, 68, 0.1)":"rgba(34, 197, 94, 0.1)"}},r?"\u274c Unmark":"\u2705 Mark Safe")))}))),it.createElement("div",{className:"validation-info",style:{marginTop:"var(--spacing-md)",fontSize:"10px"}},it.createElement("span",null,"\u2139\ufe0f"),it.createElement("div",null,"UTXOs are checked against ",it.createElement("strong",null,"ordinals.com")," to filter out inscriptions, runes, and rare sats. Click UTXOs above to select/deselect.",A.size>0&&it.createElement("div",{style:{marginTop:"var(--spacing-xs)",color:"var(--accentOrange)",fontWeight:"var(--fontWeight-semibold)"}},"\u26a0\ufe0f ",A.size," UTXO",A.size>1?"s":""," manually marked as spendable. Use with caution - you may lose assets if ordinals.com detection is correct."))))):it.createElement("div",{className:"utxo-manager",style:{display:"flex",flexDirection:"column",height:"100%",minHeight:0,overflow:"hidden",alignItems:"center",justifyContent:"center",padding:"var(--spacing-lg)"}},it.createElement("div",{style:{textAlign:"center",color:"var(--textMuted)",fontSize:"var(--fontSize-sm)"}},it.createElement("div",{style:{fontSize:"2rem",marginBottom:"var(--spacing-sm)"}},"\ud83d\udd0c"),it.createElement("div",null,"Connect your wallet to select UTXOs")))}function ex({content:e="",contentType:t="",contentSize:n=0,fileName:r="",selectedParents:i=[],reinscriptionTarget:a=null,repeatCount:o=1,onRepeatCountChange:s,delegateId:l="",metaprotocol:c="",metadata:u="",properties:d="",customTags:f=null,pointer:p="",contentEncoding:m="",compressBeforeInscribe:h=!1,onCompressBeforeInscribeChange:g,recipientAddress:y="",batchItems:b=[],onAddToBatch:w,onRemoveFromBatch:x,onEditBatchItem:v,inscriptionMode:S="standard"}){const E=b.length>0,I=!!a,k=I?1:parseInt(o,10)||1,A=()=>{const e=[];return 1===i.length&&e.push("\ud83d\udc68\u200d\ud83d\udc67 Parent-Child"),i.length>1&&e.push(`\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d\udc66 Multi-Parent (${i.length})`),a&&e.push("\u267b\ufe0f Reinscription"),l&&e.push("\ud83d\udd17 Delegate"),c&&e.push(`\ud83d\udce1 ${c}`),u&&e.push("\ud83d\udcca Metadata"),d&&e.push("\ud83c\udfa8 Properties"),m&&e.push("\ud83d\udddc\ufe0f Encoding"),h&&!m&&e.push("\ud83e\uddf1 Brotli"),p&&e.push("\ud83c\udfaf Pointer"),e};return it.createElement("div",{className:"flex flex-col h-full"},it.createElement("div",{className:"mb-4 pb-3 border-b border-neutral-700/50"},it.createElement("h3",{className:"text-lg font-semibold text-neutral-100"},E?"\ud83d\udce6 Batch Review":"\ud83d\udccb Inscription Review"),it.createElement("p",{className:"text-xs text-neutral-400 mt-1"},E?`${b.length} item${1!==b.length?"s":""} in batch`:"Preview your inscription before creating")),it.createElement("div",{className:"flex-1 overflow-y-auto pr-2 space-y-3"},E?it.createElement(it.Fragment,null,b.map((e,t)=>it.createElement("div",{key:e.id||t,className:"bg-neutral-800/40 border border-neutral-700/50 rounded-lg p-3 hover:border-neutral-600/50 transition-colors"},it.createElement("div",{className:"flex items-start justify-between mb-2"},it.createElement("div",{className:"flex items-center gap-2"},it.createElement("span",{className:"text-neutral-400 font-mono text-xs"},"#",t+1),it.createElement("span",{className:"text-sm font-semibold text-neutral-200"},e.contentType?.split(";")[0]||"Unknown type")),it.createElement("div",{className:"flex items-center gap-1"},v&&it.createElement("button",{onClick:()=>v(t),className:"px-2 py-0.5 text-blue-400 hover:text-blue-300 hover:bg-blue-500/10 rounded text-xs transition-colors"},"\u270f\ufe0f"),it.createElement("button",{onClick:()=>x(t),className:"px-2 py-0.5 text-red-400 hover:text-red-300 hover:bg-red-500/10 rounded text-xs transition-colors"},"\u2715"))),e.features&&e.features.length>0&&it.createElement("div",{className:"flex flex-wrap gap-1 mb-2"},e.features.map((e,t)=>it.createElement("span",{key:t,className:"text-xs px-1.5 py-0.5 bg-purple-500/20 text-purple-300 rounded border border-purple-500/30"},e))),it.createElement("div",{className:"mt-2"},it.createElement("label",{className:`flex items-center gap-2 text-xs ${(e.contentEncoding||"").trim()?"text-neutral-500":"text-neutral-300"} select-none`},it.createElement("input",{type:"checkbox",checked:!!e.compressBeforeInscribe,disabled:!!(e.contentEncoding||"").trim()||"function"!=typeof v,onChange:e=>v?.(t,{compressBeforeInscribe:!!e.target.checked}),className:"accent-purple-500"}),"Compress before inscribing (Brotli)"),it.createElement("div",{className:"text-[10px] text-neutral-500 mt-1"},"Writes `contentEncoding: br` on-chain. Disabled if this item already has an encoding.")),it.createElement("div",{className:"mt-2 text-xs text-neutral-400 mb-2"},it.createElement("p",{className:"font-mono truncate text-xs"},(e=>{const t=e.fileName||"",n=e.content;if("string"==typeof n){const e=n.substring(0,100)+(n.length>100?"...":"");return t?`${t} \u2014 ${e}`:e}const r="number"==typeof e.contentSize?e.contentSize:n&&(n.byteLength||n.length)||0,i=e.contentEncoding||"binary";return t?`${t} \u2014 [${i}] ${r.toLocaleString()} bytes`:`[${i}] ${r.toLocaleString()} bytes`})(e)),e.fileName&&it.createElement("p",{className:"mt-1 text-xs text-neutral-500 font-mono truncate",title:e.fileName},"\ud83d\udcce ",e.fileName),(()=>{const t=e.content,n="number"==typeof e.contentSize?e.contentSize:t&&(t.byteLength||t.length)||0;return it.createElement("p",{className:"mt-1 text-xs"},n.toLocaleString()," bytes")})()),it.createElement("div",{className:"mt-2 pt-2 border-t border-neutral-700/30 space-y-2"},it.createElement("div",null,it.createElement("label",{className:"text-xs text-neutral-400 block mb-1"},"\ud83d\udccd Destination Address (optional)"),it.createElement("input",{type:"text",placeholder:"Leave empty for wallet address",value:e.recipientAddress||e.destinationAddress||"",onChange:e=>v&&v(t,{recipientAddress:e.target.value,destinationAddress:e.target.value}),className:"w-full px-2 py-1 bg-neutral-900/50 border border-neutral-700/50 rounded text-xs font-mono text-neutral-300",style:{fontSize:"10px"}})),it.createElement("div",null,it.createElement("label",{className:"text-xs text-neutral-400 block mb-1"},"\ud83d\udc8e Postage (sats, min 546)"),it.createElement("input",{type:"number",placeholder:"546",min:"546",value:e.postage||546,onChange:e=>v&&v(t,{postage:parseInt(e.target.value,10)||546}),className:"w-full px-2 py-1 bg-neutral-900/50 border border-neutral-700/50 rounded text-xs font-mono text-neutral-300",style:{fontSize:"10px",width:"120px"}}))))),it.createElement("div",{className:"bg-green-500/10 border border-green-500/30 rounded-lg p-3"},it.createElement("p",{className:"text-xs text-green-300"},it.createElement("strong",null,"\u2705 Batch Ready:")," ",b.length," inscription",1!==b.length?"s":""," queued. Simple items will be grouped for efficiency."))):it.createElement(it.Fragment,null,it.createElement("div",{className:"bg-neutral-800/40 border border-neutral-700/50 rounded-lg p-4"},it.createElement("div",{className:"flex items-start justify-between mb-3"},it.createElement("div",{className:"flex-1 min-w-0"},it.createElement("div",{className:"flex items-center gap-2 mb-1"},it.createElement("span",{className:"text-sm font-semibold text-neutral-200"},t.split(";")[0]||"No content type"),n>0&&it.createElement("span",{className:"text-xs text-neutral-400"},"(",n.toLocaleString()," bytes)")),r&&it.createElement("div",{className:"text-xs text-neutral-400 font-mono truncate",title:r},"\ud83d\udcce ",r),it.createElement("div",{className:"mt-3 flex items-center gap-2"},it.createElement("div",{className:"text-xs text-neutral-400"},"Repeat"),it.createElement("input",{type:"number",min:"1",max:"200",value:k,disabled:I,onChange:e=>(e=>{if(!s)return;const t=Math.max(1,Math.min(200,parseInt(e,10)||1));s(t)})(e.target.value),className:"w-20 px-2 py-1 bg-neutral-900/50 border border-neutral-700/50 rounded text-xs font-mono text-neutral-200 disabled:opacity-60",title:I?"Repeat is disabled for reinscriptions":"Create the same inscription multiple times in the same transaction"}),I&&it.createElement("div",{className:"text-[10px] text-neutral-500"},"(reinscriptions can\u2019t repeat)")),it.createElement("div",{className:"mt-3"},it.createElement("label",{className:`flex items-center gap-2 text-xs ${m?"text-neutral-500":"text-neutral-300"} select-none`},it.createElement("input",{type:"checkbox",checked:!!h,disabled:!!m||"function"!=typeof g,onChange:e=>g?.(!!e.target.checked),className:"accent-purple-500"}),"Compress before inscribing (Brotli)"),it.createElement("div",{className:"text-[10px] text-neutral-500 mt-1"},"Writes `contentEncoding: br` on-chain. Disabled if you already set an encoding.")),A().length>0&&it.createElement("div",{className:"flex flex-wrap gap-1.5 mt-2"},A().map((e,t)=>it.createElement("span",{key:t,className:"text-xs px-2 py-0.5 bg-purple-500/20 text-purple-300 rounded-full border border-purple-500/30"},e))))),e&&it.createElement("div",{className:"mt-3 pt-3 border-t border-neutral-700/30"},it.createElement("p",{className:"text-xs text-neutral-400 mb-2"},"Content Preview:"),it.createElement("div",{className:"bg-neutral-900/50 rounded p-3 font-mono text-xs text-neutral-300 max-h-48 overflow-y-auto whitespace-pre-wrap break-words"},"string"==typeof e?it.createElement(it.Fragment,null,e.substring(0,500),e.length>500&&it.createElement("span",{className:"text-neutral-500"},"... (truncated)")):it.createElement(it.Fragment,null,[m||"binary",(n||e.byteLength||e.length||0).toLocaleString()].join(" ")," bytes"))),!e&&it.createElement("div",{className:"text-center py-8 text-neutral-500"},it.createElement("p",{className:"text-sm"},"No content added yet"))),!E&&e&&w&&it.createElement("button",{onClick:()=>w({content:e,contentType:t,contentSize:n,selectedParents:i,reinscriptionTarget:a,repeatCount:k,delegateId:l,metaprotocol:c,metadata:u,properties:d,pointer:p,contentEncoding:m,compressBeforeInscribe:!!h,recipientAddress:y,features:A()}),className:"w-full py-3 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white rounded-lg font-semibold text-sm transition-all duration-300 hover:scale-[1.02] active:scale-[0.98] shadow-lg hover:shadow-blue-500/50 mt-3"},"\u2795 Add to Batch"),!E&&it.createElement("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-3 mt-3"},it.createElement("p",{className:"text-xs text-blue-300"},it.createElement("strong",null,"\ud83d\udca1 Tip:"),' Click "Add to Batch" button above to queue multiple inscriptions. They\'ll be processed together for lower fees!')))))}const tx=new Map,nx=new Map,rx=new Map,ix=new Map;function ax(e){if(!e)return null;const t=tx.get(e);return t&&Date.now()-t.timestamp<36e5?t:null}function ox(e,t,n){try{const t=tx.get(e),n=t?.data;if("string"==typeof n&&n.startsWith("blob:")){const t=ix.get(n);t&&(t.delete(e),0===t.size&&ix.delete(n))}}catch{}tx.set(e,{contentType:t,data:n,timestamp:Date.now()});try{if("string"==typeof n&&n.startsWith("blob:")){const t=ix.get(n)||new Set;t.add(e),ix.set(n,t)}}catch{}}function sx(e){try{if("string"!=typeof e||!e.startsWith("blob:"))return;const t=(rx.get(e)||0)-1;if(t<=0){rx.delete(e);try{const t=ix.get(e);if(t&&t.size>0)for(const n of t){const t=tx.get(n);t?.data===e&&tx.delete(n)}ix.delete(e)}catch{}try{URL.revokeObjectURL(e)}catch{}}else rx.set(e,t)}catch{}}async function lx({inscriptionId:e,contentUrl:t,fallbackContentType:n="",forceRefresh:r=!1}){if(!e||!t)return null;if(!r){const t=ax(e);if(t)return t}const i=nx.get(e);if(i)return i;const a=(async()=>{const i=n||"";if(String(i).toLowerCase().startsWith("text/html"))return ox(e,i,t),ax(e);const a=await async function(e){try{const t=await fetch(e,{method:"HEAD"});return t.ok?String(t.headers.get("content-type")||""):""}catch{return""}}(t),o=String(a||"").toLowerCase();if(o.startsWith("text/html")||o.startsWith("image/"))return ox(e,o||i,t),ax(e);if(o&&!r)return ox(e,o||i,t),ax(e);const s=await fetch(t);if(!s.ok)throw new Error(`HTTP ${s.status}`);const l=String(s.headers.get("content-type")||""),c=l.toLowerCase();if(c.startsWith("text/html"))return ox(e,c||i,t),ax(e);const u=await s.arrayBuffer(),d=function(e){try{const t=new Uint8Array(e||[]);if(t.length>=8){if(137===t[0]&&80===t[1]&&78===t[2]&&71===t[3]&&13===t[4]&&10===t[5]&&26===t[6]&&10===t[7])return"image/png";if(71===t[0]&&73===t[1]&&70===t[2]&&56===t[3])return"image/gif";if(255===t[0]&&216===t[1]&&255===t[2])return"image/jpeg";if(82===t[0]&&73===t[1]&&70===t[2]&&70===t[3]&&87===t[8]&&69===t[9]&&66===t[10]&&80===t[11])return"image/webp"}if(t.length>=12&&102===t[4]&&116===t[5]&&121===t[6]&&112===t[7]){const e=String.fromCharCode(t[8],t[9],t[10],t[11]);if("avif"===e||"avis"===e)return"image/avif";if("heic"===e||"heix"===e||"hevc"===e||"hevx"===e)return"image/heic"}if(t.length>=16)try{const e=new TextDecoder("utf-8",{fatal:!1}).decode(t.slice(0,2048)),n=String(e||"").replace(/^\uFEFF/,"").trimStart().toLowerCase();if(n.startsWith("<svg")||n.startsWith("<?xml")&&n.includes("<svg")||n.includes("<svg"))return"image/svg+xml"}catch{}}catch{}return""}(u),f=function({headerCt:e="",sniffedCt:t="",fallbackCt:n=""}){const r=String(e||"").toLowerCase(),i=String(t||"").toLowerCase(),a=String(n||"").toLowerCase();return r.startsWith("text/html")?r:i.startsWith("image/")?i:r.startsWith("image/")?r:a.startsWith("image/")?a:r||i||a||""}({headerCt:l,sniffedCt:d,fallbackCt:i}),p=String(f||"").toLowerCase();if(!p.startsWith("image/")&&!p.startsWith("text/html"))return ox(e,f||l||i,t),ax(e);const m=new Blob([u],{type:f||void 0}),h=URL.createObjectURL(m);return ox(e,f||i,h),ax(e)})();nx.set(e,a);try{return await a}finally{nx.delete(e)}}const cx=tx;function ux({inscription:e,width:t,height:n,size:r}){const i=e?.id||e?.inscriptionId||e?.inscription_id||"",a=e?.contentType||e?.content_type||"",o=e?.number||e?.inscriptionNumber||e?.inscription_number,[s,l]=rt.useState(!1),[c,u]=rt.useState(null),[d,f]=rt.useState(!1),p=it.useRef(null),m=r?`${r}px`:t||"100%",h=r?`${r}px`:n||"120px",g=String(a||"").toLowerCase(),y=String(c?.contentType||"").toLowerCase(),b=g.startsWith("image/")||y.startsWith("image/"),w=g.startsWith("text/html")||y.startsWith("text/html"),x=i?th(`/content/${i}`):null,v=y||g,S=v.includes("octet-stream")||v.includes("binary/octet-stream"),E=!w&&(b||S||!v);return rt.useEffect(()=>{f(!1)},[i]),rt.useEffect(()=>{if(!i)return;const e=ax(i);let t=!1,n=!1;if(e){u(e),l(!0);try{const t=String(e?.contentType||"").toLowerCase(),r=e?.data;"string"!=typeof r||r.startsWith("blob:")||t&&"unknown"!==t||(n=!0)}catch{}try{const n=String(e?.contentType||"").toLowerCase(),r=e?.data;"string"!=typeof r||!r.startsWith("blob:")||n.startsWith("image/")||n.startsWith("text/html")||(t=!0)}catch{}if(!t&&!n)return}if(!x)return;let r=!1;return(async()=>{const e=await lx({inscriptionId:i,contentUrl:x,fallbackContentType:a,forceRefresh:!!t});!r&&e&&(u(e),l(!0))})().catch(e=>{l(!0)}),()=>{r=!0}},[i,x,a]),rt.useEffect(()=>{const e=c?.data,t=p.current;return t&&t!==e&&sx(t),"string"==typeof e&&e.startsWith("blob:")?(function(e){try{if("string"!=typeof e||!e.startsWith("blob:"))return;const t=(rx.get(e)||0)+1;rx.set(e,t)}catch{}}(e),p.current=e):p.current=null,()=>{const e=p.current;e&&sx(e),p.current=null}},[c?.data]),it.createElement("div",{style:{width:m,height:h,borderRadius:"6px",overflow:"hidden",background:"#1a1a1a",position:"relative",border:"1px solid rgba(255, 255, 255, 0.1)"}},i?E&&!d?it.createElement("img",{src:c?.data||x,alt:`#${o||i.slice(0,8)}`,style:{width:"100%",height:"100%",objectFit:"contain",objectPosition:"center"},loading:"lazy",onLoad:()=>l(!0),onError:()=>{f(!0)}}):it.createElement("iframe",{src:x,title:`#${o||i.slice(0,8)}`,style:{width:"100%",height:"100%",border:"none",background:"white",display:"block"},sandbox:"allow-scripts allow-same-origin",onLoad:()=>l(!0)}):it.createElement("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"11px",color:"#888"}},e?"Loading inscription data...":"No inscription selected"))}const dx=Object.freeze(Object.defineProperty({__proto__:null,contentCache:cx,default:ux,prefetchInscriptionContent:async function(e,t=""){if(!e)return!1;if(ax(e))return!0;const n=th(`/content/${e}`);if(String(t||"").toLowerCase().startsWith("text/html"))return ox(e,t,n),!0;try{return!!(await lx({inscriptionId:e,contentUrl:n,fallbackContentType:t,forceRefresh:!1}))}catch(uC){return!1}}},Symbol.toStringTag,{value:"Module"}));class fx{constructor(e=[]){this.width=0,this.height=0,this.rowOffset=0,this.rows=[],this.slots=[];let t=0;for(const n of e)t+=n*n;this.length=Math.ceil(Math.sqrt(t));for(const n of e)this.place(n)}getSize(){return{width:this.width,height:this.height}}getRow(e){return e.y-this.rowOffset<this.rows.length?this.rows[e.y-this.rowOffset]:null}getSlot(e){const t=this.getRow(e);return null!==t&&t.map.has(e.x)&&t.map.get(e.x)||null}addRow(){const e={y:this.rows.length+this.rowOffset,slots:[],map:new Map,max:0};return this.rows.push(e),e}addSlot(e){if(e.size<=0)return null;const t=this.getSlot(e.position);if(null!==t)return t.size=Math.max(t.size,e.size),t;{const t=this.getRow(e.position);if(null===t)return null;const n=t.slots.findIndex(t=>t.position.x>e.position.x);return-1===n?t.slots.push(e):t.slots.splice(n,0,e),t.map.set(e.position.x,e),e}}removeSlot(e){const t=this.getRow(e.position);if(null!==t){t.map.delete(e.position.x);const n=t.slots.findIndex(t=>t.position.x===e.position.x);-1!==n&&t.slots.splice(n,1)}}fillSlot(e,t){const n={left:e.position.x,right:e.position.x+t,bottom:e.position.y,top:e.position.y+t};this.removeSlot(e);for(let r=e.position.y;r<n.top;r++){const i=this.getRow({x:e.position.x,y:r});if(null!==i){const a=[];let o=0;for(const t of i.slots)if(!(t.position.x+t.size<n.left||t.position.x>=n.right)){a.push(t);const n=Math.max(0,t.position.x+t.size-(e.position.x+e.size));o=Math.max(o,n)}n.right<this.length&&!i.map.has(n.right)&&this.addSlot({position:{x:n.right,y:r},size:e.size-t+o});for(let t=0;t<a.length;t++)a[t].size=e.position.x-a[t].position.x,0===a[t].size&&this.removeSlot(a[t])}else this.addRow(),e.position.x>0&&this.addSlot({position:{x:0,y:r},size:e.position.x}),n.right<this.length&&this.addSlot({position:{x:n.right,y:r},size:this.length-n.right})}for(let r=Math.max(0,e.position.y-t);r<e.position.y;r++){const n=this.getRow({x:e.position.x,y:r});if(null!=n)for(let r=0;r<n.slots.length;r++){const i=n.slots[r];if(i.position.x<e.position.x+t&&i.position.x+i.size>e.position.x&&i.position.y+i.size>=e.position.y){const t=i.size;i.size=e.position.y-i.position.y;const n={x:i.position.x+i.size,y:i.position.y,width:t-i.size,height:i.size};for(;n.width>0&&n.height>0;)n.width<=n.height?(this.addSlot({position:{x:n.x,y:n.y},size:n.width}),n.y+=n.width,n.height-=n.width):(this.addSlot({position:{x:n.x,y:n.y},size:n.height}),n.x+=n.height,n.width-=n.height)}}}return{position:e.position,size:t}}place(e){let t=!1,n=null;for(const r of this.rows){for(const i of r.slots)if(i.size>=e){t=!0,n=this.fillSlot(i,e);break}if(t)break}if(!t){const t=this.addRow(),r=this.addSlot({position:{x:0,y:t.y},size:this.length});if(!r)throw new Error("Failed to create initial slot");n=this.fillSlot(r,e)}if(!n)throw new Error("Failed to place square");return n.position.x+n.size>this.width&&(this.width=n.position.x+n.size),n.position.y+n.size>this.height&&(this.height=n.position.y+n.size),this.slots.push(n),n}fillEmptySpaces(e=!0){const t=[],n=Array.from({length:this.height},()=>Array(this.width).fill(!1));for(const r of this.slots)for(let e=0;e<r.size;e++)for(let t=0;t<r.size;t++)n[r.position.y+e][r.position.x+t]=!0;if(e){const e=(e,t,r)=>{if(e+r>this.width||t+r>this.height)return!1;for(let i=0;i<r;i++)for(let a=0;a<r;a++)if(n[t+i][e+a])return!1;return!0};for(let r=Math.min(this.width,this.height);r>1;r--)for(let i=0;i<=this.height-r;i++)for(let a=0;a<=this.width-r;a++)if(e(a,i,r)){t.push({position:{x:a,y:i},size:r});for(let e=0;e<r;e++)for(let t=0;t<r;t++)n[i+e][a+t]=!0}}for(let r=0;r<this.height;r++)for(let e=0;e<this.width;e++)n[r][e]||(t.push({position:{x:e,y:r},size:1}),n[r][e]=!0);return t}}const px="kv";let mx=null;function hx(){return mx||("undefined"==typeof indexedDB?(mx=Promise.resolve(null),mx):(mx=new Promise(e=>{const t=indexedDB.open("nexus-inscriber",1);t.onupgradeneeded=()=>{const e=t.result;e.objectStoreNames.contains(px)||e.createObjectStore(px,{keyPath:"k"})},t.onsuccess=()=>e(t.result),t.onerror=()=>e(null)}),mx))}function gx(e){return new Promise(t=>{e.oncomplete=()=>t(!0),e.onerror=()=>t(!1),e.onabort=()=>t(!1)})}async function yx(e,t){const n=String(e||"");if(!n)return!1;const r=await hx();if(!r)return!1;try{const e=r.transaction(px,"readwrite");return e.objectStore(px).put({k:n,v:t,t:Date.now()}),await gx(e)}catch{return!1}}async function bx(e){const t=String(e||"");if(!t)return 0;const n=await hx();if(!n)return 0;try{const e=n.transaction(px,"readwrite"),r=e.objectStore(px);let i=0;return await new Promise(e=>{try{const n=r.openCursor();n.onsuccess=()=>{const r=n.result;if(!r)return e(!0);const a=String(r?.key||r?.value?.k||"");if(a&&a.startsWith(t))try{r.delete(),i++}catch{}r.continue()},n.onerror=()=>e(!1)}catch{e(!1)}}),await gx(e),i}catch{return 0}}async function wx(e,{maxAgeMs:t=null}={}){const n=await async function(e){const t=String(e||"");if(!t)return null;const n=await hx();return n?await new Promise(e=>{try{const r=n.transaction(px,"readonly").objectStore(px).get(t);r.onsuccess=()=>e(r.result||null),r.onerror=()=>e(null)}catch{e(null)}}):null}(e);if(!n||"object"!=typeof n)return null;if(null!=t){const e=Date.now()-(n.t||0);if(!Number.isFinite(e)||e>t)return null}return n.v??null}const xx="55551557695dd82a2bda5ec3497684ec7cbb2cc1752ff5101accff1648666c3ai0",vx=`bitmon:index:${xx}`;let Sx=null,Ex=null;function Ix(e,t,n,r){const i=e.indexOf(t);if(-1===i)return null;const a=e.indexOf("=",i);if(-1===a)return null;const o=e.indexOf(n,a);if(-1===o)return null;let s=0,l=null,c=!1;for(let u=o;u<e.length;u++){const t=e[u];if(l){if(c){c=!1;continue}if("\\"===t){c=!0;continue}t===l&&(l=null)}else if('"'!==t&&"'"!==t){if(t===n&&s++,t===r&&(s--,0===s))return e.slice(o,u+1)}else l=t}return null}function kx(e,t){if(!e)return null;try{return JSON.parse(e)}catch{}if(!/^[\s0-9",:'\-\.\{\}\[\]\(\)]+$/.test(e))return null;try{return(0,eval)("object"===t?`(${e})`:e)}catch{return null}}async function Ax({forceRefresh:e=!1}={}){if(!e&&Sx?.patternArray&&Sx?.patternObject)return Sx;if(Ex)return await Ex;Ex=(async()=>{if(!e){const e=await wx(vx,{maxAgeMs:7776e6});if(e&&Array.isArray(e.patternArray)&&e.patternObject)return Sx=e,Sx}const t=await async function(){const e=th(`/content/${xx}`),t=await gh(e);if(!t?.ok)throw new Error(`Failed to fetch Bitmon index: ${t?.status}`);const n=await t.text(),r=Ix(n,"patternArray","[","]"),i=Ix(n,"patternObject","{","}"),a=kx(r,"array"),o=kx(i,"object");if(!Array.isArray(a)||!o||"object"!=typeof o)throw new Error("Bitmon index parse failed");return{loadedAt:Date.now(),patternArray:a,patternObject:o}}();return Sx=t,await yx(vx,t),Sx})();try{return await Ex}finally{Ex=null}}const Nx=new Map,Tx=new Map,_x=e=>`bitmap:layout:${e}`;function Px({blockNumber:e,bitmonPattern:t=null,highlightParcels:n=[],highlightColor:r="#00e5ff",selectedParcels:i=[],selectedColor:a="#22c55e",existingParcels:o=new Set,size:s="auto",measureKey:l,className:c,onParcelClick:u,onParcelMouseDown:d,onParcelMouseEnter:f}){const p=Tx.get(e),[m,h]=rt.useState(p?.slots||[]),[g,y]=rt.useState(p?{width:p.width,height:p.height}:null),[b,w]=rt.useState(p?.txCount||0),[x,v]=rt.useState(p?.amounts||[]),[S,E]=rt.useState(!p),[I,k]=rt.useState(null),A=rt.useRef(null),[N,T]=rt.useState(null),_=rt.useMemo(()=>{const e=new Set,t=Math.max(0,b-1);for(const r of n)"number"==typeof r&&r>=0&&r<=t&&e.add(r);return e},[n,b]),P=rt.useMemo(()=>{const e=new Set,t=Math.max(0,b-1);for(const n of i)"number"==typeof n&&n>=0&&n<=t&&e.add(n);return e},[i,b]);rt.useEffect(()=>{let n=!0;return async function(){k(null);const r=Tx.get(e);if(r){if(!n)return;return h(r.slots),y({width:r.width,height:r.height}),w(r.txCount),v(r.amounts||[]),void E(!1)}E(!0);try{try{const t=await wx(_x(e));if(t&&Array.isArray(t.slots)&&Number.isFinite(t.width)&&Number.isFinite(t.height)&&Number.isFinite(t.txCount)){if(Tx.set(e,t),!n)return;return h(t.slots),y({width:t.width,height:t.height}),w(t.txCount),v(Array.isArray(t.amounts)?t.amounts:[]),void E(!1)}}catch{}const r=t?function(e){const t=String(e||"").trim();if(!t)return null;const n=[];for(let r=0;r<t.length;r++){const e=Number(t[r]);if(!Number.isFinite(e)||e<=0)return null;n.push(e)}return n}(t):null;if(Array.isArray(r)&&r.length>0){const t=new fx(r),i={slots:t.slots,width:t.width,height:t.height,txCount:r.length,amounts:void 0};if(Tx.set(e,i),!n)return;return h(i.slots),y({width:i.width,height:i.height}),w(i.txCount),void v([])}let i=Nx.get(e);i||(i=await async function(e){if(void 0!==window.btcapi)return await window.btcapi.getBlockWithTxs(e);{const n=await gh((t=`/rawblock/${e}?cors=true`,eh(t,"https://blockchain.info")));if(!n.ok)throw new Error(`Failed to fetch block ${e}`);return n.json()}var t}(e),Nx.set(e,i));const a=Array.isArray(i?.tx)?i.tx:[],o=a.map(e=>e.out.reduce((e,t)=>e+(t?.value||0),0)),s=o.map(e=>(e=>{const t=e/1e8;return 0===t||t<=.01?1:t<=.1?2:t<=1?3:t<=10?4:t<=100?5:t<=1e3?6:t<=1e4?7:t<=1e5?8:9})(e)),l=new fx(s),c={slots:l.slots,width:l.width,height:l.height,txCount:a.length,amounts:o};Tx.set(e,c);try{await yx(_x(e),c)}catch{}if(!n)return;h(c.slots),y({width:c.width,height:c.height}),w(c.txCount),v(c.amounts||[])}catch(cC){if(!n)return;k(cC?.message||"Failed to render bitmap")}finally{n&&E(!1)}}(),()=>{n=!1}},[e,t]),rt.useEffect(()=>{if("auto"!==s)return;const e=A.current;if(!e)return;const t=new ResizeObserver(e=>{for(const t of e){const e=Math.floor(t.contentRect.width),n=Math.floor(t.contentRect.height);e>0&&n>0&&T({width:e,height:n})}});t.observe(e);const n=e.getBoundingClientRect();T({width:Math.floor(n.width),height:Math.floor(n.height)});const r=requestAnimationFrame(()=>{if(A.current){const e=A.current.getBoundingClientRect();T({width:Math.floor(e.width),height:Math.floor(e.height)})}});return()=>{t.disconnect(),cancelAnimationFrame(r)}},[s,l]);const B="number"==typeof s?s:N?Math.max(1,Math.min(N.width,N.height)):1;if(S)return it.createElement("div",{ref:A,className:c,style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"}},it.createElement("div",{style:{width:B,height:B,display:"grid",placeItems:"center"}},"Loading\u2026"));if(I)return it.createElement("div",{ref:A,className:c,style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"}},it.createElement("div",{style:{width:B,height:B,color:"tomato",display:"grid",placeItems:"center"}},"Error: ",I));if(!g)return it.createElement("div",{ref:A,className:c,style:{width:"100%",height:"100%"}});const C=Math.min(B/g.width,B/g.height),O=Math.floor(g.width*C),L=Math.floor(g.height*C),F=Math.floor((B-O)/2),R=Math.floor((B-L)/2);return it.createElement("div",{ref:A,className:c,style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",minWidth:0,minHeight:0,overflow:"hidden"}},it.createElement("div",{style:{width:B,height:B,maxWidth:"100%",maxHeight:"100%",position:"relative",background:"black",borderRadius:0,overflow:"hidden"}},m.map((e,t)=>{const n=_.size>0,i=_.has(t),s=P.has(t),l=o.has(t),c=a,p=l?"#E24A4A":s?c:i?r:n?"#2f2f2f":"#f79a27",m=e.size*C,h=Math.min(2,Math.max(0,m-1)),g=h/2,y=F+e.position.x*C+g,b=R+e.position.y*C+g,w=Math.max(.25,m-h),v=Math.max(.25,m-h),S=x&&null!=x[t]?x[t]:void 0,E=l?`Parcel ${t} \u2014 Already Inscribed \u26a0\ufe0f`:null!=S?`Parcel ${t} \u2014 ${I=S,`${(I/1e8).toLocaleString(void 0,{maximumFractionDigits:8})} BTC`}`:`Parcel ${t}`;var I;return it.createElement("div",{key:t,title:E,style:{position:"absolute",left:`${y}px`,top:`${b}px`,width:`${w}px`,height:`${v}px`,backgroundColor:p,cursor:l?"not-allowed":u?"pointer":"default",transition:"background-color 120ms ease-out",opacity:l?.7:1,border:l?"1px solid rgba(226, 74, 74, 0.5)":s?`1px solid ${c}`:"none"},onMouseDown:e=>!l&&d&&d(t,e),onClick:e=>!l&&u&&u(t,e),onMouseEnter:e=>{l||(f&&f(t),e.currentTarget.style.backgroundColor=i?"#00d0eb":n?"#3a3a3a":"#ff9f3d")},onMouseLeave:e=>{l||(e.currentTarget.style.backgroundColor=p)}})})))}const Bx=100000000n;function Cx(e){if(null==e)return"";let t;if("bigint"==typeof e)t=e;else if("number"==typeof e){if(!Number.isFinite(e))return"";t=BigInt(Math.trunc(e))}else{const n=String(e).trim();if(!n)return"";t=BigInt(n)}if(0n===t)return"0";const n=t/Bx,r=t%Bx;if(0n===r)return n.toString();const i=r.toString().padStart(8,"0").replace(/0+$/,"");return`${n.toString()}.${i}`}const Ox=Object.freeze(Object.defineProperty({__proto__:null,parseUserPriceToSats:function(e){const t=String(e||"").trim().replace(/,/g,"");if(!t)throw new Error("Enter a sale price.");if(/^[0-9]+$/.test(t)){const e=BigInt(t);if(e<=0n)throw new Error("Enter a sale price > 0.");if(e>BigInt(Number.MAX_SAFE_INTEGER))throw new Error("Sale price too large.");return Number(e)}if(/^[0-9]*\.[0-9]+$/.test(t)){const[e,n]=t.split("."),r=e?BigInt(e):0n,i=String(n||"");if(i.length>8)throw new Error("BTC amount supports up to 8 decimal places.");const a=(i+"00000000").slice(0,8);if(!/^[0-9]{8}$/.test(a))throw new Error("Invalid BTC amount.");const o=BigInt(a),s=r*Bx+o;if(s<=0n)throw new Error("Enter a sale price > 0.");if(s>BigInt(Number.MAX_SAFE_INTEGER))throw new Error("Sale price too large.");return Number(s)}throw new Error("Enter a valid price in sats (e.g. 30000) or BTC (e.g. 0.0003).")},satsToBtcString:Cx},Symbol.toStringTag,{value:"Module"})),Lx="h-8 w-8 min-h-[32px] shrink-0 grid place-items-center rounded-lg text-[11px] font-semibold transition focus:outline-none focus:ring-2 focus:ring-sky-500/30 touch-manipulation",Fx=Lx+" bg-neutral-950/50 ring-1 ring-neutral-800/70 text-neutral-200 hover:ring-sky-500/25 hover:text-sky-100",Rx=Lx+" bg-neutral-950/30 ring-1 ring-neutral-900/60 text-neutral-500 cursor-not-allowed",Ux="h-8 min-h-[32px] flex-1 grid place-items-center rounded-lg bg-purple-600/30 ring-1 ring-purple-500/50 text-purple-50 font-semibold text-[11px] transition hover:bg-purple-600/40 hover:ring-purple-400/60 active:bg-purple-600/50 focus:outline-none focus:ring-2 focus:ring-purple-400/30 touch-manipulation";function Mx({title:e,onClick:t,statusBadge:n,media:r,metaLeft:i,metaRight:a,label:o,footerLeft:s,footerRight:l,actions:c}){return it.createElement("div",{onClick:t,className:"group relative flex flex-col rounded-2xl bg-gradient-to-b from-neutral-900/60 to-neutral-950/80 text-neutral-200 shadow-[0_0_0_1px_rgba(59,130,246,0.10),0_0_18px_rgba(59,130,246,0.06)] transition hover:-translate-y-0.5 hover:shadow-xl overflow-hidden cursor-pointer focus-within:ring-2 focus-within:ring-sky-500/30 focus-within:ring-offset-0",title:e},n,it.createElement("div",{className:"p-2 sm:p-3"},it.createElement("div",{className:"relative aspect-square w-full rounded-xl overflow-hidden bg-black ring-1 ring-neutral-800/70"},it.createElement("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/0 via-black/0 to-black/45 opacity-80 group-hover:opacity-100 transition"}),it.createElement("div",{className:"pointer-events-none absolute inset-0 opacity-0 group-hover:opacity-100 group-focus-within:opacity-100 transition"},it.createElement("div",{className:"absolute inset-0 bg-black/10"}),it.createElement("div",{className:"absolute bottom-2 left-2 text-[10px] font-semibold px-2 py-1 rounded-full bg-black/55 backdrop-blur ring-1 ring-white/10"},"Open preview")),r)),it.createElement("div",{className:"px-2 sm:px-3 pb-2 sm:pb-3 flex flex-col gap-1.5 sm:gap-2"},(i||a)&&it.createElement("div",{className:"flex items-baseline justify-between gap-3"},i&&it.createElement("div",{className:"text-[10px] font-mono text-neutral-500 truncate"},i),a),o&&it.createElement("div",{className:"text-[12px] font-semibold text-neutral-200 truncate"},o),(s||l)&&it.createElement("div",{className:"flex items-center justify-between gap-2"},s&&it.createElement("div",{className:"text-[10px] text-neutral-400"},s),l),c&&it.createElement("div",{className:"flex items-center gap-2"},c)))}function $x({price:e,hasPrice:t}){return it.createElement("div",{className:t?"text-[12px] font-semibold tabular-nums text-amber-200 truncate":"text-[12px] font-semibold tabular-nums text-neutral-300 truncate"},e)}function Hx({canShowQr:e,onShowQr:t,onSelect:n,ctaLabel:r="View",ctaVariant:i="primary"}){return it.createElement(it.Fragment,null,it.createElement("button",{type:"button",disabled:!e,onClick:n=>{n.stopPropagation(),e&&t?.(n)},className:e?Fx:Rx,title:e?"Show listing offer PSBT as QR":"PSBT not available yet","aria-label":"Show QR"},"QR"),it.createElement("button",{type:"button",onClick:e=>{e.stopPropagation(),n?.(e)},className:"primary"===i?Ux:"h-8 min-h-[32px] flex-1 grid place-items-center rounded-lg bg-neutral-950/50 ring-1 ring-neutral-800/70 text-neutral-200 font-semibold text-[11px] transition hover:ring-sky-500/25 active:bg-neutral-900/60 focus:outline-none focus:ring-2 focus:ring-sky-500/30 touch-manipulation",title:"View listing"},r," \u2192"))}function Dx({bitmapNumber:e,bitmonPattern:t,highlightParcels:n,highlightColor:r}){const i=Number.isFinite(Number(e));return it.createElement("div",{className:"w-full h-full p-1"},it.createElement("div",{className:"w-full h-full rounded-lg bg-black overflow-hidden border border-neutral-800/70"},i?it.createElement(Px,{blockNumber:Number(e),bitmonPattern:t,highlightParcels:Array.isArray(n)?n:[],highlightColor:r||void 0,size:"auto",className:"w-full h-full"}):it.createElement("div",{className:"w-full h-full flex items-center justify-center text-neutral-500 text-xs"},"bitmap")))}function zx({listing:e,onSelect:t,onShowQr:n,formatPrice:r}){const i=Number(e?.collection?.bitmapNumber),a=e?.price,o=Number.isFinite(i)?`${i}.bitmap`:"bitmap",s=e?.collection?.bitmon?.pattern||null,l=!!String(e?.sellerOfferPsbt||"").trim()||!!String(e?.revealTxid||"").trim(),c=Number(a),u=Number.isFinite(c)&&c>0,d=(r?r(a):"")||"Price TBD";return it.createElement(Mx,{title:o,onClick:t,media:it.createElement(Dx,{bitmapNumber:i,bitmonPattern:s}),metaRight:it.createElement($x,{price:d,hasPrice:u}),label:o,actions:it.createElement(Hx,{canShowQr:l,onShowQr:n,onSelect:t})})}function Wx({bitmapNumber:e,parcelsForSaleCount:t=0,highlightParcels:n=[],onOpen:r}){const i=Number.isFinite(Number(e))?`${Number(e)}.bitmap`:"bitmap",a=(()=>{const e=Number(t);return!Number.isFinite(e)||e<0?0:Math.trunc(e)})();return it.createElement(Mx,{title:i,onClick:()=>r?.(),media:it.createElement(Dx,{bitmapNumber:e,highlightParcels:n,highlightColor:"rgb(34 197 94)"}),metaRight:it.createElement($x,{price:`${a} listed`,hasPrice:a>0}),label:i,actions:it.createElement("button",{type:"button",onClick:e=>{e.stopPropagation(),r?.()},className:Ux,title:"View parcels"},"View \u2192")})}function Vx({listing:e,onSelect:t,onShowQr:n}){const r=e.inscription||{},i=e.inscriptionId||r.id||"",a=r.number||r.inscriptionNumber||"",o=e.price,s=!!String(e?.sellerOfferPsbt||"").trim(),l=!!e.revealTxid||s,c=s||!!String(e?.revealTxid||"").trim(),u=Number(o),d=Number.isFinite(u)&&u>0,f=d?`${Cx(Math.trunc(u))} BTC`:"Price TBD",p=a?`#${a}`:`#${i.slice(0,8)}\u2026`;return it.createElement(Mx,{onClick:t,statusBadge:l||s?null:it.createElement("div",{className:"absolute top-2 left-2 sm:top-1 sm:left-1 z-10 px-2 sm:px-1.5 py-0.5 text-[10px] sm:text-[9px] font-semibold bg-yellow-500/20 text-yellow-300 border border-yellow-500/40 rounded"},"Pending Reveal"),media:it.createElement(ux,{inscription:r,width:"100%",height:"100%"}),metaRight:it.createElement($x,{price:f,hasPrice:d}),label:p,actions:it.createElement(Hx,{canShowQr:c,onShowQr:n,onSelect:t,ctaVariant:l?"primary":"secondary"})})}const jx={fundingAddress:"bc1pckp60lxtas9vr94esqyku6wr670udm8q9k5y5x7vjv7szfh03vpqsh8282",listingFee:600,minListingFee:550,feeDescription:"OODL Indexing Fee",enabled:!0},qx={bitmap:{address:"bc1px29j0hxajxp69tmzy8vstd2fmqphxkrrt74rt098ap2cha4vgplqwfhv7d",feeSats:600,minFeeSats:600,description:"Bitmap Provenance Fee"},parcel:{address:"bc1pstcg0w3w5tqh9dlcw98lxfl9s8xmglj0dkxl5y8nf20xcwawmujsw63ah0",feeSats:600,minFeeSats:600,description:"Parcel Provenance Fee"},parcel_manifest:{address:"bc1puxgqpadwdfdx8wah5y8e990e96847uhmaummcqrnarl0tpc9u0zq64trt6",feeSats:600,minFeeSats:600,description:"Parcel Manifest Registration Fee"}};let Kx=[];const Xx=330;function Gx(e){Kx=Array.isArray(e)?e.map(e=>({key:e?.key?String(e.key):null,address:e?.indexingAddress?String(e.indexingAddress):null,feeSats:(()=>{const t=Number(e?.feeSats);return Number.isFinite(t)?Math.max(Xx,Math.floor(t)):Xx})(),minFeeSats:(()=>{const t=Number(e?.minFeeSats);if(Number.isFinite(t))return Math.max(Xx,Math.floor(t));const n=Number(e?.feeSats);return Number.isFinite(n)?Math.max(Xx,Math.floor(n)):Xx})(),description:e?.description?String(e.description):void 0,name:e?.name?String(e.name):void 0,imageInscriptionId:e?.imageInscriptionId?String(e.imageInscriptionId):void 0,sourceInscriptionId:e?.sourceInscriptionId?String(e.sourceInscriptionId):void 0})).filter(e=>!!e.key&&!!e.address):[]}function Yx(){return Array.isArray(Kx)?Kx.slice():[]}function Jx(){return jx.enabled?{address:jx.fundingAddress,value:jx.listingFee,description:jx.feeDescription}:null}function Qx(e){if(!jx.enabled)return null;if(!e)return null;const t=function(e){const t=String(e||"").trim();return t&&Yx().find(e=>e?.key===t)||null}(e);if(t?.address){const e=Number.isFinite(t.feeSats)?t.feeSats:jx.listingFee,n=Number.isFinite(t.minFeeSats)?t.minFeeSats:e,r=Math.max(Number(e),Number(n)),i=Math.max(Xx,Math.floor(Number(r)));return{address:t.address,value:i,description:t.description||t.name||"Collection Provenance Fee"}}const n=qx?.[e];return n?.address?{address:n.address,value:Math.max(Xx,Math.floor(Number(Math.max(Number(n.feeSats??0),Number(n.minFeeSats??0))))),description:n.description||"Collection Provenance Fee"}:null}function Zx(){const e=[];jx?.fundingAddress&&e.push(jx.fundingAddress);for(const t of Yx())t?.address&&e.push(t.address);for(const t of Object.keys(qx||{})){const n=qx?.[t]?.address;n&&e.push(n)}return Array.from(new Set(e))}function ev(e,t){const n=Number(t),r=function(e,t){const n=String(e||"").trim(),r=Number(t);if(!n||!Number.isFinite(r))return null;const i=Yx();for(const a of i){const e=Number.isFinite(a?.minFeeSats)?a.minFeeSats:Number.isFinite(a?.feeSats)?a.feeSats:Xx,t=Math.max(Xx,Math.floor(Number(e)));if(n===a.address&&r>=t)return a.key}return null}(e,n);if(r)return r;for(const i of Object.keys(qx||{})){const t=qx?.[i];if(!t?.address)continue;const r=Number(t.minFeeSats??1);if(e===t.address&&Number.isFinite(n)&&n>=r)return i}return null}function tv(e,t){const n=Number(t);return!!Number.isFinite(n)&&(e===jx.fundingAddress&&n>=Number(jx.minListingFee||0)||!!ev(e,n))}const nv=Object.freeze(Object.defineProperty({__proto__:null,DEFAULT_OODL_COLLECTIONS_REGISTRY_INSCRIPTION_ID:"a06144a8c57304e78dde41c0ba90cc6178893df42b7a7ab9b1529c8668dbd079i0",OODL_COLLECTION_FEES:qx,OODL_CONFIG:jx,getDynamicOODLCollections:Yx,getOODLCollectionFeeOutput:Qx,getOODLCollectionKeyFromFee:ev,getOODLFeeOutput:Jx,getOODLIndexingAddresses:Zx,isValidOODLFee:tv,setDynamicOODLCollections:Gx},Symbol.toStringTag,{value:"Module"})),rv=216e5,iv=e=>`bitmap:verify:${String(e||"").trim()}`,av=new Map,ov=new Map,sv=Array(10).fill(null),lv=[th("/content/01bba6c58af39d7f199aa2bceeaaba1ba91b23d2663bc4ef079a4b5e442dbf74i0"),th("/content/bb01dfa977a5cd0ee6e900f1d1f896b5ec4b1e3c7b18f09c952f25af6591809fi0"),th("/content/bb02e94f3062facf6aa2e47eeed348d017fd31c97614170dddb58fc59da304efi0"),th("/content/bb037ec98e6700e8415f95d1f5ca1fe1ba23a3f0c5cb7284d877e9ac418d0d32i0"),th("/content/bb9438f4345f223c6f4f92adf6db12a82c45d1724019ecd7b6af4fcc3f5786cei0"),th("/content/bb0542d4606a9e7eb4f31051e91f7696040db06ca1383dff98505618c34d7df7i0"),th("/content/bb06a4dffba42b6b513ddee452b40a67688562be4a1345127e4d57269e6b2ab6i0"),th("/content/bb076934c1c22007b315dd1dc0f8c4a2f9d52f348320cfbadc7c0bd99eaa5e18i0"),th("/content/bb986a1208380ec7db8df55a01c88c73a581069a51b5a2eb2734b41ba10b65c2i0"),th("/content/b907b51a239e3a37f29f8222fb274f828c6ebf7b93ce501a55b7171daaa75758i0")],cv={92871:1,92970:1,123132:1,365518:1,700181:1,826151:1,827151:1,828151:1,828239:1,828661:1,829151:1,830151:1,832104:2,832249:2,832252:2,832385:4,833067:1,833101:3,833105:4,833109:4,833121:8,834030:2,834036:2,834051:17,834073:4,836151:1,837115:2,837120:2,837151:1,837183:3,837188:2,838058:5,838068:2,838076:2,838096:1,838151:1,838821:1,839151:1,839377:1,839378:2,839382:2,839397:1,840151:1,841151:1,842151:1,845151:1};let uv={};function dv(e){let t;try{t=JSON.parse(e)}catch{t=void 0}if("string"==typeof t)try{t=JSON.parse(t)}catch{}return t}async function fv(e){if("number"!=typeof e||!Number.isFinite(e))return null;if(e<0||e>906999)return null;const t=e>=84e4&&e<907e3?9:Math.floor(e/1e5);await async function(e){if(sv[e])return;if(9===e){const t=await gh(lv[e]);if(!t?.ok)throw new Error(`Failed to fetch OCI page ${e}: ${t?.status}`);const n=await t.json();uv=n.satIndexMap||{};const r=[];return(n.deltaEncodedSats||[]).forEach((e,t)=>{0===t?r.push(parseInt(e)):r.push(parseInt(r[t-1])+parseInt(e))}),void(sv[e]=r)}const t=await gh(lv[e]);if(!t?.ok)throw new Error(`Failed to fetch OCI page ${e}: ${t?.status}`);let n,r=await t.text();if(2===e||3===e?(n=dv("["+r+"]"),n=[n.slice(0,99999),n.slice(1e5,199999)]):(n=dv(r),n||(n=dv(r.replaceAll("\\n  ",""))),n||(n=dv(r.replaceAll("\n  ",""))),n||(n=dv(r.replaceAll("  ","")))),!Array.isArray(n)||!Array.isArray(n[0])||!Array.isArray(n[1]))return void(sv[e]=null);const i=[];n[0].forEach((e,t)=>{0===t?i.push(parseInt(e)):i.push(parseInt(i[t-1])+parseInt(e))});const a=Array(1e5).fill(0);n[1].forEach((e,t)=>{a[e]=i[t]}),sv[e]=a}(t);const n=sv[t];return n?e>=84e4?n[e-84e4]:n[e%1e5]:null}function pv(e){return e>=84e4?uv[e]||0:cv[e]||0}async function mv(e){const t=ov.get(e);if(t&&Date.now()-t.checkedAt<rv)return t.inscriptionId;const n=await fv(e);if(!n)return ov.set(e,{checkedAt:Date.now(),inscriptionId:null}),null;const r=pv(e);try{const t=await gh(th(`/r/sat/${n}/at/${r}`));if(!t?.ok)throw new Error(`Failed sat lookup: ${t?.status}`);const i=await t.json(),a=i?.id?String(i.id):null;return ov.set(e,{checkedAt:Date.now(),inscriptionId:a}),a}catch{return ov.set(e,{checkedAt:Date.now(),inscriptionId:null}),null}}async function hv(e){if(!e)return null;try{const t=await wx(iv(e),{maxAgeMs:15552e6});if(t&&"bitmap"===t.type&&!0===t.verified&&Number.isFinite(Number(t.bitmapNumber)))return t.key||(t.key="bitmap"),av.set(String(e),{checkedAt:Date.now(),result:t}),t}catch{}const t=av.get(e);if(t&&Date.now()-t.checkedAt<rv)return t.result;try{const t=await gh(th(`/content/${e}`));if(!t?.ok)throw new Error(`Failed to fetch content: ${t?.status}`);const n=await t.text(),r=String(n||"").trim().match(/^(\d+)\.bitmap/);if(!r)return av.set(e,{checkedAt:Date.now(),result:null}),null;const i=Number.parseInt(r[1],10);if(!Number.isFinite(i))return av.set(e,{checkedAt:Date.now(),result:null}),null;const a=await mv(i);if(!a||a!==e)return av.set(e,{checkedAt:Date.now(),result:null}),null;const o={type:"bitmap",key:"bitmap",bitmapNumber:i,verified:!0};av.set(e,{checkedAt:Date.now(),result:o});try{await yx(iv(e),o)}catch{}return o}catch{return av.set(e,{checkedAt:Date.now(),result:null}),null}}const gv=Object.freeze(Object.defineProperty({__proto__:null,clearBitmapCollectionCache:function(){av.clear(),ov.clear();for(let e=0;e<sv.length;e++)sv[e]=null;uv={}},detectAndVerifyBitmapByInscriptionId:hv,getBitmapSat:fv,getBitmapSatIndex:pv,getOciBitmapInscriptionId:mv},Symbol.toStringTag,{value:"Module"})),yv=e=>`parcel:verify:${String(e||"").trim()}`,bv=new Map;async function wv(e,t){const n=await async function(e,t){const n=await async function(e){const t=String(e||"").trim();if(!t)return null;const n=[];try{let e=0;for(;;){const r=0===e?`/r/parents/${t}`:`/r/parents/${t}/${e}`,i=await gh(th(r));if(!i?.ok)return null;const a=await i.json(),o=Array.isArray(a?.ids)?a.ids:null;if(!o||0===o.length)break;if(n.push(...o.map(e=>String(e))),!a.more)break;if(e++,e>50)break}return n}catch{return null}}(e);if(!Array.isArray(n))return null;const r=String(t||"").trim();return!!r&&n.some(e=>String(e).trim()===r)}(e,t);return"boolean"==typeof n?n:await async function(e,t){const n=String(e||"").trim(),r=String(t||"").trim();if(!n||!r)return!1;try{let e=0;for(;;){const t=0===e?`/r/children/${r}`:`/r/children/${r}/${e}`,i=await gh(th(t));if(!i?.ok)return!1;const a=await i.json();if((Array.isArray(a?.ids)?a.ids:[]).some(e=>String(e).trim()===n))return!0;if(!a.more)break;if(e++,e>50)break}return!1}catch{return!1}}(e,t)}async function xv(e,t){const n=Number(e);if(!Number.isFinite(n)||n<0)return null;const r=Number(t);if(!Number.isFinite(r))return null;try{const e=await gh(th(`/r/sat/${Math.floor(n)}/at/${r}`));if(!e?.ok)return null;const t=await e.json();return(t?.id?String(t.id).trim():null)||null}catch{return null}}async function vv(e){if(!e)return null;try{const t=await wx(yv(e),{maxAgeMs:15552e6});if(t&&"parcel"===t.type&&!0===t.verified&&Number.isFinite(Number(t.parcelNumber))&&Number.isFinite(Number(t.bitmapNumber)))return t.key||(t.key="parcel"),bv.set(String(e),{checkedAt:Date.now(),result:t}),t}catch{}const t=bv.get(e);if(t&&Date.now()-t.checkedAt<216e5)return t.result;try{const t=await gh(th(`/content/${e}`));if(!t?.ok)throw new Error(`Failed to fetch content: ${t?.status}`);const n=function(e){const t=String(e||"").trim().match(/^(\d+)\.(\d+)\.bitmap$/i);if(!t)return null;const n=Number.parseInt(t[1],10),r=Number.parseInt(t[2],10);return!Number.isFinite(n)||n<0||n>4294967295||!Number.isFinite(r)||r<0||r>906999?null:{parcelNumber:Math.floor(n),bitmapNumber:Math.floor(r)}}(await t.text());if(!n)return bv.set(e,{checkedAt:Date.now(),result:null}),null;const{parcelNumber:r,bitmapNumber:i}=n,a=await fv(i),o=new Set,s=await mv(i);if(s&&o.add(String(s)),Number.isFinite(Number(a))){const e=await xv(a,0);e&&o.add(String(e));const t=await xv(a,-1);t&&o.add(String(t))}if(0===o.size)return bv.set(e,{checkedAt:Date.now(),result:null}),null;let l=null;for(const u of o)if(await wv(e,u)){l=u;break}if(!l)return bv.set(e,{checkedAt:Date.now(),result:null}),null;if(0!==i){const t=await async function(e){const t=Number(e);if(!Number.isFinite(t)||t<0)return null;try{const e=await gh(th(`/r/blockinfo/${Math.floor(t)}`));if(!e?.ok)return null;const n=await e.json(),r=Number(n?.transaction_count);return!Number.isFinite(r)||r<0?null:Math.floor(r)}catch{return null}}(i);if(Number.isFinite(t)&&r>=t)return bv.set(e,{checkedAt:Date.now(),result:null}),null}const c={type:"parcel",key:"parcel",verified:!0,parcelNumber:r,bitmapNumber:i,bitmapInscriptionId:String(l)};bv.set(e,{checkedAt:Date.now(),result:c});try{await yx(yv(e),c)}catch{}return c}catch{return bv.set(e,{checkedAt:Date.now(),result:null}),null}}const Sv=Object.freeze(Object.defineProperty({__proto__:null,detectAndVerifyParcelByInscriptionId:vv},Symbol.toStringTag,{value:"Module"})),Ev="a06144a8c57304e78dde41c0ba90cc6178893df42b7a7ab9b1529c8668dbd079i0",Iv="nexus_collections_registry_inscription_id";let kv={registryId:null,fetchedAt:0,collections:[]};const Av=new Map,Nv=new Map,Tv=6e5;function _v(e){return(null==e?"":String(e)).trim()}function Pv(e){const t=_v(e).toLowerCase();return t?t.replace(/\s+/g,"-").replace(/[^a-z0-9_-]/g,"").replace(/-+/g,"-").replace(/^[-_]+|[-_]+$/g,""):""}function Bv(e){if("string"==typeof e){const t=_v(e).match(/^([a-f0-9]{64})i(\d+)(?:-(\d+))?$/i);if(!t)return null;const n=_v(t[1]).toLowerCase(),r=Ov(t[2],null),i=Ov(t[3]??t[2],null);return/^[a-f0-9]{64}$/i.test(n)&&Number.isFinite(r)&&Number.isFinite(i)?r<0||i<0||i<r?null:{baseTxid:n,from:r,to:i}:null}if(Array.isArray(e)){const t=[];for(const n of e){const e=Bv(n);e&&t.push(e)}return t.length>0?t:null}const t=e&&"object"==typeof e?e:null;if(!t)return null;const n=_v(t.type);if(n&&"sequential_inscription_range"!==n)return null;let r=_v(t.base_txid||t.baseTxid),i=Ov(t.from_i??t.from??t.start??t.min,null),a=Ov(t.to_i??t.to??t.end??t.max,null);const o=_v(t.notation);if((!r||null===i||null===a)&&o){const e=o.match(/^([a-f0-9]{64})i(\d+)(?:-(\d+))?$/i);e&&(r=_v(e[1]),i=Ov(e[2],null),a=Ov(e[3]??e[2],null))}return/^[a-f0-9]{64}$/i.test(r)&&Number.isFinite(i)&&Number.isFinite(a)?i<0||a<0||a<i?null:{baseTxid:r.toLowerCase(),from:i,to:a}:null}function Cv(e,t){if(Array.isArray(t)){for(const n of t)if(Cv(e,n))return!0;return!1}const n=t&&"object"==typeof t?t:null;if(!n)return!1;const r=function(e){const t=_v(e).match(/^([a-f0-9]{64})i(\d+)$/i);if(!t)return null;const n=_v(t[1]).toLowerCase(),r=Number.parseInt(t[2],10);return!Number.isFinite(r)||r<0?null:{txid:n,i:r}}(e);if(!r)return!1;if(r.txid!==String(n.baseTxid||"").toLowerCase())return!1;const i=Number(n.from),a=Number(n.to);return!(!Number.isFinite(i)||!Number.isFinite(a))&&r.i>=i&&r.i<=a}function Ov(e,t=null){const n=Number(e);return Number.isFinite(n)?Math.floor(n):t}function Lv(e,t){for(const n of t){const t=e?.[n],r=_v(t);if(r)return r}return""}function Fv(e,t=null){if(null==e)return t;const n=Number(e);if(!Number.isFinite(n))return t;if(n<0)return t;const r=n>0&&n<1?Math.round(1e8*n):Math.round(n);return!Number.isFinite(r)||r<0||r>Number.MAX_SAFE_INTEGER?t:r}function Rv(e,t,n=null){for(const r of t){const t=Fv(e?.[r],null);if(Number.isFinite(t))return t}return n}function Uv(e,t,n){const r=e?.[t];return r&&"object"==typeof r?Lv(r,n):""}function Mv(e){if(!e)return null;if("string"==typeof e){const t=_v(e);return t?{inscriptionId:t}:null}if("object"!=typeof e)return null;const t=Lv(e,["inscriptionId","id","inscription_id","inscription"]);return t?{inscriptionId:t,title:Lv(e,["title","name","label"])||void 0,description:Lv(e,["description","desc"])||void 0,type:Lv(e,["type","kind"])||void 0,required:!0===e?.required}:null}function $v(e){if(!e||"object"!=typeof e)return null;const t=Pv(Lv(e,["key","id","slug","name"]));if(!t)return null;const n=Lv(e,["label","title","name"])||t,r=Lv(e,["type","kind"])||"boolean",i=Lv(e,["sourcePath","path","field"]),a=e?.default,o=(()=>{const t=Array.isArray(e?.options)?e.options:null;if(!t)return;const n=t.map(e=>{if(e&&"object"==typeof e){const t=e?.value,n=Lv(e,["label","title","name"])||(void 0!==t?String(t):"");return void 0===t?null:{value:t,label:n}}return null==e?null:{value:e,label:String(e)}}).filter(Boolean);return n.length>0?n:void 0})();return{key:t,label:n,type:r,sourcePath:i||void 0,default:a,options:o}}function Hv(e,t){const n=_v(t);if(!n)return;const r=n.split(".").filter(Boolean);let i=e;for(const a of r){if(null==i)return;i=i?.[a]}return i}function Dv(){try{const e=_v(localStorage.getItem(Iv));if(e)return e}catch(e){}return Ev}async function zv(e){const t=await fetch(e);if(!t.ok)throw new Error(`HTTP ${t.status}`);return await t.json()}function Wv(e){const t=Number(e);return Number.isFinite(t)?t<0?null:Math.floor(t):null}async function Vv(e){const t=Wv(e);if(null===t)return"";try{const e=th(`/r/sat/${t}/at/-1`);return function(e){if(!e)return"";if("string"==typeof e)return _v(e);if(Array.isArray(e)){const t=e[0];if("string"==typeof t)return _v(t);if(t&&"object"==typeof t)return _v(t.id||t.inscription||t.inscription_id)}if("object"==typeof e){const t=_v(e.id||e.inscription||e.inscription_id);if(t)return t;if(Array.isArray(e.ids)&&e.ids.length>0)return _v(e.ids[0])}return""}(await zv(e))}catch{return""}}async function jv(e){const t=_v(e);if(!t)return"";const n=Av.get(t);if(n&&Date.now()-n.fetchedAt<6e5)return n.text;if(!mh())return"";const r=th(`/content/${t}`),i=await fetch(r);if(!i.ok)return"";const a=await i.text(),o=a.length>25e4?a.slice(0,25e4):a;return Av.set(t,{fetchedAt:Date.now(),text:o}),o}function qv(e,t){const n=t&&"object"==typeof t?t:{};let r=n;const i="OODL-COLLECTION"===_v(n?.p)&&n?.registry_entry&&"object"==typeof n.registry_entry?n:null;if(i){r={...i.registry_entry||{}};const e=_v(i?.meta?.title),t=_v(i?.meta?.description);!e||_v(r.title)||_v(r.name)||(r.title=e),t&&!_v(r.description)&&(r.description=t);const n=_v(i?.meta?.image?.id);!n||_v(r.imageInscriptionId)||_v(r.imageId)||_v(r.image)||(r.imageInscriptionId=n)}const a=Pv(Lv(r,["key","collectionKey","id","slug","name"])||e),o=Lv(r,["name","title","label"])||a,s=Lv(r,["description","desc","about"])||"",l=Lv(r,["indexingAddress","marketplaceFeeAddress","provenanceAddress","feeAddress","address"])||Uv(r,"addresses",["indexing","index","provenance","fee","listing","marketplace"])||Uv(r,"address",["indexing","index","provenance","fee","listing","marketplace"]),c=Rv(r,["feeSats","listingFeeSats","fee","listingFee"],null)??Rv(r?.fee&&"object"==typeof r.fee?r.fee:null,["sats","value","feeSats","listingFeeSats"],null),u=Rv(r,["minFeeSats","minListingFeeSats","minFee","minListingFee"],null)??Rv(r?.fee&&"object"==typeof r.fee?r.fee:null,["minSats","min","minFeeSats","minListingFeeSats"],null),d=r?.catalogImage??r?.catalog_image??r?.catalog,f="string"==typeof d?_v(d):d&&"object"==typeof d?Lv(d,["inscriptionId","id","inscription_id"]):"",p=Lv(r,["imageInscriptionId","image","imageId","iconInscriptionId","catalogImageInscriptionId"])||f,m=(()=>{const e=r?.addresses;if(!e||"object"!=typeof e)return;const t={};for(const[n,r]of Object.entries(e)){const e=_v(n),i=_v(r);e&&i&&(t[e]=i)}return Object.keys(t).length>0?t:void 0})(),h=void 0!==r?.rules?r.rules:void 0!==r?.ruels?r.ruels:void 0,g=r?.indexLinks??r?.indexes??r?.index_links??void 0,y=(()=>{const e=(Array.isArray(r?.scripts)?r.scripts:null)||(Array.isArray(r?.scriptInscriptionIds)?r.scriptInscriptionIds:null)||(Array.isArray(r?.scriptIds)?r.scriptIds:null);if(!e)return;const t=e.map(Mv).filter(Boolean);return t.length>0?t:void 0})(),b=(()=>{const e=(Array.isArray(r?.filters)?r.filters:null)||(Array.isArray(r?.filterBy)?r.filterBy:null)||(Array.isArray(r?.filtersBy)?r.filtersBy:null);if(!e)return;const t=e.map($v).filter(Boolean);return t.length>0?t:void 0})(),w=function(e,t,n=null){for(const r of t){const t=Ov(e?.[r],null);if(Number.isFinite(t))return t}return n}(r,["sort","order","priority"],null),x=(()=>{const e=r?.match&&"object"==typeof r.match?r.match:null,t={},n=Bv(i?.indexing?.children?.include??r?.indexing?.children?.include??r?.include);if(n&&(t.inscriptionIdRange=n),!e&&0===Object.keys(t).length)return null;if(e){const n=Array.isArray(e.inscriptionIds)?e.inscriptionIds:Array.isArray(e.inscription_ids)?e.inscription_ids:null;if(n&&n.length>0){const e=n.map(e=>_v(e)).filter(Boolean);e.length>0&&(t.inscriptionIds=e)}!0===e.bitmapOci&&(t.bitmapOci=!0);const r=_v(e.contentRegex);r&&(t.contentRegex=r);const i=_v(e.contentTypeStartsWith);i&&(t.contentTypeStartsWith=i);const a=Array.isArray(e.jsonPathEquals)?e.jsonPathEquals:null;a&&a.length>0&&(t.jsonPathEquals=a.map(e=>({path:_v(e?.path),equals:e?.equals})).filter(e=>e.path));const o=_v(e.galleryInscriptionId||e.gallery_inscription_id||e.galleryId||e.gallery_id);o&&/^[a-f0-9]{64}i\d+$/i.test(o)&&(t.galleryInscriptionId=o)}return Object.keys(t).length>0?t:null})();return a&&l?{key:a,name:o,description:s,indexingAddress:l,feeSats:Number.isFinite(c)?c:void 0,minFeeSats:Number.isFinite(u)?u:void 0,imageInscriptionId:p||void 0,catalogImage:d||void 0,addresses:m,rules:h,indexLinks:g,scripts:y,filters:b,match:x,sort:Number.isFinite(w)?w:void 0,sourceInscriptionId:e,manifest:i||void 0,raw:r}:null}async function Kv({forceRefresh:e=!1}={}){const t=Dv();if(!e&&kv.registryId===t&&Date.now()-kv.fetchedAt<3e5&&Array.isArray(kv.collections)&&kv.collections.length>0)return{...kv};if(!mh())return{registryId:t,fetchedAt:Date.now(),collections:[]};let n=[];try{n=await async function(e){const t=_v(e);if(!t)return[];try{const e=[];let n=0;for(;;){const r=th(0===n?`/r/children/${t}/inscriptions`:`/r/children/${t}/inscriptions/${n}`),i=await zv(r),a=Array.isArray(i?.children)?i.children:null;if(!a||0===a.length)break;if(e.push(...a),!i.more)break;if(n++,n>50)break}if(e.length>0)return e}catch{}const n=await async function(e){const t=[];let n=0;for(;;){const r=th(0===n?`/r/children/${e}`:`/r/children/${e}/${n}`),i=await zv(r);if(!i?.ids||!Array.isArray(i.ids)||0===i.ids.length)break;if(t.push(...i.ids),!i.more)break;if(n++,n>50)break}return t}(t);return n.map(e=>({id:e}))}(t)}catch(uC){return{registryId:t,fetchedAt:Date.now(),collections:[]}}const r=[];await Promise.all(n.map(async e=>{try{const n=_v(e?.id),i=Wv(e?.sat);let a="";if(null!==i&&(a=await Vv(i)),!a&&n){const e=await async function(e){const t=_v(e);if(!t)return null;try{const e=th(`/r/inscription/${t}`),n=await zv(e);return Wv(n?.sat)}catch{return null}}(n);null!==e&&(a=await Vv(e))}a||(a=n);const o=_v(await jv(a));if(!o)return;let s;try{s=JSON.parse(o)}catch(t){return}const l=qv(a,s);l&&(l.sourceChildInscriptionId=n||void 0,l.sourceSat=null!==i?i:void 0,l.resolvedLatestInscriptionId=a||void 0,r.push(l))}catch(t){}}));const i=new Map;for(const o of r)o?.key&&(i.has(o.key)||i.set(o.key,o));const a=Array.from(i.values()).sort((e,t)=>{const n=Number.isFinite(e.sort)?e.sort:1e4,r=Number.isFinite(t.sort)?t.sort:1e4;return n!==r?n-r:String(e.name||e.key).localeCompare(String(t.name||t.key))});return kv={registryId:t,fetchedAt:Date.now(),collections:a},{...kv}}const Xv=Object.freeze(Object.defineProperty({__proto__:null,DEFAULT_COLLECTIONS_REGISTRY_INSCRIPTION_ID:Ev,getCollectionsRegistryInscriptionId:Dv,loadCollectionsRegistry:Kv,matchCollectionForInscription:async function(e,t){const r=_v(e);if(!r)return null;const i=Array.isArray(t)?t:[];if(0===i.length)return null;let a=null;const o=i.some(e=>{const t=e?.match;return!!(t?.contentRegex||t?.jsonPathEquals&&t.jsonPathEquals.length>0)})?await jv(r):"";let s=null;if(i.some(e=>e?.match?.jsonPathEquals&&e.match.jsonPathEquals.length>0)&&o)try{s=JSON.parse(o)}catch(c){s=null}let l=null;for(const u of i){const e=u?.match;if(e){if(Array.isArray(e.inscriptionIds)&&e.inscriptionIds.length>0&&e.inscriptionIds.includes(r))return u.key;if(e.inscriptionIdRange&&Cv(r,e.inscriptionIdRange))return u.key;if(e.galleryInscriptionId)try{const t=_v(e.galleryInscriptionId),i=Nv.get(t);let a=null;if(i&&Date.now()-i.fetchedAt<Tv?a=i.ids:(l||(l=await n(()=>Promise.resolve().then(()=>ZB),__VITE_PRELOAD__)),a=await l.getGalleryInscriptionIds(t),Nv.set(t,{fetchedAt:Date.now(),ids:a})),Array.isArray(a)&&a.includes(r))return u.key}catch(c){}if(!0===e.bitmapOci)try{a||(a=await n(()=>Promise.resolve().then(()=>gv),__VITE_PRELOAD__));const e=await a.detectAndVerifyBitmapByInscriptionId(r);if("bitmap"===e?.type&&e?.verified)return u.key}catch(c){}if(e.contentRegex&&o)try{if(new RegExp(e.contentRegex).test(o))return u.key}catch(c){}if(e.jsonPathEquals&&e.jsonPathEquals.length>0&&s&&e.jsonPathEquals.every(e=>Hv(s,e.path)===e.equals))return u.key}}return null},resolveGalleryIds:async function(e){const t=_v(e?.match?.galleryInscriptionId);if(!t)return[];const r=Nv.get(t);if(r&&Date.now()-r.fetchedAt<Tv)return r.ids||[];try{const{getGalleryInscriptionIds:e}=await n(async()=>{const{getGalleryInscriptionIds:e}=await Promise.resolve().then(()=>ZB);return{getGalleryInscriptionIds:e}},__VITE_PRELOAD__),r=await e(t);return Nv.set(t,{fetchedAt:Date.now(),ids:r}),r}catch(cC){return[]}},setCollectionsRegistryInscriptionIdOverride:function(e){const t=_v(e);try{t?localStorage.setItem(Iv,t):localStorage.removeItem(Iv)}catch(n){}}},Symbol.toStringTag,{value:"Module"})),Gv=new Map;function Yv(e){const t=e?.output||e?.satpoint||e?.location;if(!t||"string"!=typeof t)return null;const n=t.split(":");if(n.length<2)return null;const r=n[0],i=n[1];if(!/^[0-9a-f]{64}$/i.test(r))return null;const a=Number(i);return!Number.isFinite(a)||a<0?null:`${String(r).toLowerCase()}:${Math.floor(a)}`}async function Jv(e){try{const t=th(`/r/inscription/${e}`),n=await fetch(t);if(!n.ok)return null;const r=await n.json();return{id:e,inscriptionId:e,number:r.number,contentType:r.content_type,timestamp:r.timestamp,...r}}catch(Kh){return null}}async function Qv(e=!1){const t="object"==typeof e&&null!==e?e:{forceRefresh:!!e},n=!!t.forceRefresh,r=t.address?[String(t.address).trim()].filter(Boolean):Array.isArray(t.addresses)&&t.addresses.length>0?t.addresses.map(e=>String(e).trim()).filter(Boolean):Zx(),i=function(e){const t=String(e||"").trim();return t?(Gv.has(t)||Gv.set(t,{listingsCache:new Map,lastFetchTime:0}),Gv.get(t)):null}(1===r.length?`addr:${r[0]}`:`multi:${r.slice().sort().join("|")}`);if(!i)return[];try{const e=await Kv({forceRefresh:!1}),t=Array.isArray(e?.collections)?e.collections:[];t.length>0&&Gx(t)}catch{}if(!n&&Date.now()-i.lastFetchTime<6e4&&i.listingsCache.size>0)return Array.from(i.listingsCache.values()).slice().sort((e,t)=>{const n=Number(e?.listedAt||0),r=Number(t?.listedAt||0);return r!==n?r-n:String(t?.commitTxid||t?.inscriptionId||"").localeCompare(String(e?.commitTxid||e?.inscriptionId||""))});const a=await async function(e){try{const t=Array.isArray(e)?e:[];if(0===t.length)return[];const n=await Promise.all(t.map(async e=>{try{const t=nh(`/api/address/${e}/txs`),n=await fetch(t);if(!n.ok)return[];const r=await n.json();return Array.isArray(r)?r:[]}catch{return[]}})),r=n.flat(),i=new Map;for(const e of r)e?.txid&&i.set(e.txid,e);return Array.from(i.values())}catch(Kh){return[]}}(r);if(!Array.isArray(a))return Array.from(i.listingsCache.values());for(const o of a){const e=(()=>{const e=Array.isArray(o?.vout)?o.vout:[];for(const t of e){const e=t.scriptpubkey_address||t.scriptPubKey?.address,n=t.value,r=e?ev(String(e),n):null;if(r)return{output:t,key:r}}return null})(),t=(()=>(Array.isArray(o?.vout)?o.vout:[]).find(e=>tv(e.scriptpubkey_address||e.scriptPubKey?.address,e.value))||null)(),n=e?"collection":t?"legacy":null;if(!n)continue;"collection"===n&&e.output;const r=String(o?.txid||"").trim().toLowerCase();if(!/^[0-9a-f]{64}$/.test(r))continue;const a=`${r}:0`,s=await Zv(a);if(!s)continue;const l=await Jv(s);if(!l)continue;let c=null;try{if(c=Yv(l),c||(c=await Eh(s)),c&&String(c).toLowerCase()!==a){i.listingsCache.delete(s);continue}}catch{c=null}let u=null,d=!1;if("collection"===n){const t=String(e.key||"").trim().toLowerCase();if("parcel"===t){try{u=await vv(s)}catch{u=null}if("parcel"!==String(u?.key||"").toLowerCase())continue}else if("bitmap"===t)try{const t=await hv(s);u="bitmap"===String(t?.key||"").toLowerCase()?t:{key:e.key}}catch{u={key:e.key}}else u={key:e.key}}else{try{u=await hv(s)}catch{u=null}"bitmap"!==String(u?.key||"").toLowerCase()&&(u=null,d=!0)}String(u?.key||"").toLowerCase(),String(u?.key||"").toLowerCase();const f=r,p=(Number.NaN,{inscriptionId:s,inscription:l,commitTxid:Array.isArray(o?.vin)&&o.vin[0]?.txid?String(o.vin[0].txid).toLowerCase():r,revealTxid:f,price:null,listedAt:o.status?.block_time?1e3*o.status.block_time:Date.now(),status:"active",collection:u,uncategorized:!!d,inscriptionOutpoint:c||null,bitmapNumberHint:null,parcelNumberHint:null}),m=i.listingsCache.get(p.inscriptionId);if(m){const e=Number(m?.listedAt||0);if(Number(p?.listedAt||0)>=e){const e=Number(m?.price);Number.isFinite(e)&&e>0&&null===p.price&&(p.price=m.price,m.priceAsOf&&(p.priceAsOf=m.priceAsOf)),null!==m.bitmapNumberHint&&null===p.bitmapNumberHint&&(p.bitmapNumberHint=m.bitmapNumberHint),null!==m.parcelNumberHint&&null===p.parcelNumberHint&&(p.parcelNumberHint=m.parcelNumberHint),void 0!==m.minBlockHeight&&void 0===p.minBlockHeight&&(p.minBlockHeight=m.minBlockHeight),i.listingsCache.set(p.inscriptionId,p)}}else i.listingsCache.set(p.inscriptionId,p)}return i.lastFetchTime=Date.now(),Array.from(i.listingsCache.values()).slice().sort((e,t)=>{const n=Number(e?.listedAt||0),r=Number(t?.listedAt||0);return r!==n?r-n:String(t?.commitTxid||t?.inscriptionId||"").localeCompare(String(e?.commitTxid||e?.inscriptionId||""))})}async function Zv(e){try{const t=th(`/r/utxo/${e}`),n=await fetch(t);if(!n.ok)return null;const r=await n.json();return r.inscriptions&&Array.isArray(r.inscriptions)&&0!==r.inscriptions.length?r.inscriptions[0]:null}catch(Kh){return null}}function eS(){const e=[];for(const n of Gv.values())e.push(...Array.from(n.listingsCache.values()));const t=new Map;for(const n of e)n?.inscriptionId&&t.set(n.inscriptionId,n);return Array.from(t.values())}const tS=Object.freeze(Object.defineProperty({__proto__:null,clearListingsCache:function(){Gv.clear()},getCachedListings:eS,indexOODLListings:Qv},Symbol.toStringTag,{value:"Module"}));function nS({selectedParentsCount:e,disabled:t,collectionKey:n,minBlockHeight:r=null,onCreateBulkListingTx:i,bulkSellerStatus:a,bulkSellerError:o,bulkBundleJson:s}){if(!(Number(e||0)>1))return null;const l=String(s||"");return it.createElement("div",{className:"mt-3 flex flex-col gap-2"},it.createElement("button",{onClick:()=>i?.({collectionKey:String(n||"").trim()||null,minBlockHeight:void 0===r?null:r}),disabled:!!t,className:t?"w-full px-4 py-2 text-sm font-semibold rounded-lg bg-neutral-800 text-neutral-500 cursor-not-allowed":"w-full px-4 py-2 text-sm font-semibold rounded-lg bg-neutral-800/60 hover:bg-neutral-700/60 text-neutral-200 transition-colors","aria-label":"Create bulk sale listing transactions",title:"Create one listing per selected inscription"},"Create Bulk Listings (",e,")"),a?it.createElement("div",{className:"text-xs text-green-300 bg-green-500/10 border border-green-500/30 rounded-lg px-3 py-2"},a):null,o?it.createElement("div",{className:"text-xs text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2"},o):null,l?it.createElement("div",{className:"bg-neutral-950/60 border border-neutral-800/60 rounded-lg p-3"},it.createElement("div",{className:"flex items-center justify-between gap-2 mb-2"},it.createElement("div",{className:"text-xs font-semibold text-neutral-300"},"Bundle JSON"),it.createElement("button",{onClick:()=>navigator.clipboard.writeText(l),className:"px-3 py-1 bg-neutral-800 hover:bg-neutral-700 rounded text-xs text-white transition-colors",title:"Copy bundle JSON to clipboard"},"Copy")),it.createElement("textarea",{readOnly:!0,value:l,className:"w-full h-40 px-3 py-2 text-xs bg-neutral-950 border border-neutral-800/60 rounded text-neutral-200 outline-none font-mono"}),it.createElement("div",{className:"mt-2 text-[11px] text-neutral-500"},"Optional: compress externally (e.g. Brotli) before inscribing.")):null)}function rS(e){return(null==e?"":String(e)).trim()}function iS(e){const t=rS(e).toLowerCase();return t?t.replace(/\s+/g,"-").replace(/[^a-z0-9_-]/g,"").replace(/-+/g,"-").replace(/^[-_]+|[-_]+$/g,""):""}function aS(e){const t=rS(e);if(!t)return"";const n=t.match(/^([0-9a-fA-F]{64})i(\d+)$/);return n?`${n[1].toLowerCase()}i${String(Number(n[2]))}`:""}function oS(e){const t=String(e||"");if(!t.trim())return[];const n=t.split(/[\s,;]+/g).map(e=>aS(e)).filter(Boolean),r=[],i=new Set;for(const a of n)i.has(a)||(i.add(a),r.push(a));return r}async function sS(e,{timeoutMs:t=12e3}={}){const n="undefined"!=typeof AbortController?new AbortController:null,r=n?setTimeout(()=>n.abort(),t):null;try{const t=await fetch(e,n?{signal:n.signal}:void 0);if(!t.ok){const e=await t.text().catch(()=>"");throw new Error(`HTTP ${t.status} ${t.statusText}${e?`: ${e}`:""}`)}return await t.json()}finally{r&&clearTimeout(r)}}function lS({selectedParentsCount:e=0,selectedInscriptionIds:t=[],walletInscriptions:r=[],walletAssetScanState:i=null,onRequestWalletRescan:a,existingCollectionKeys:o=[],authoritySlots:s=[],authorityStatus:l="",authorityError:c="",selectedAuthoritySlotId:u="",feeRate:d=null,onFeeRateChange:f,onAuthoritySlotChange:p,onLaunchCollection:m,onLaunchParcelManifest:h}){const[g,y]=it.useState(""),[b,w]=it.useState(!1),[x,v]=it.useState(""),[S,E]=it.useState(!1),[I,k]=it.useState(""),[A,N]=it.useState(""),[T,_]=it.useState(""),[P,B]=it.useState("330"),[C,O]=it.useState(!1),[L,F]=it.useState(""),[R,U]=it.useState(""),[M,$]=it.useState(!1),[H,D]=it.useState({}),[z,W]=it.useState({}),[V,j]=it.useState({}),[q,K]=it.useState("parent-child"),[X,G]=it.useState(!1),[Y,J]=it.useState(""),[Q,Z]=it.useState(!1),[ee,te]=it.useState(!1),[ne,re]=it.useState(!1),ie=it.useRef(null),[ae,oe]=it.useState(""),[se,le]=it.useState(""),[ce,ue]=it.useState(""),[de,fe]=it.useState([]),[pe,me]=it.useState(""),[he,ge]=it.useState([]),[ye,be]=it.useState(""),[we,xe]=it.useState("");it.useEffect(()=>{if("parent-child"!==q)return;const e=(Array.isArray(t)?t:[]).map(e=>aS(e)).filter(Boolean)[0]||"";e!==aS(ae)&&(oe(e),fe([]),le(""),ue(""))},[q,t]);const[ve,Se]=it.useState(""),[Ee,Ie]=it.useState({}),[ke,Ae]=it.useState({}),[Ne,Te]=it.useState(""),[_e,Pe]=it.useState(""),[Be,Ce]=it.useState(null);it.useEffect(()=>{let e=!0;const t=async()=>{try{const{fetchBlockHeightViaProxy:t}=await n(async()=>{const{fetchBlockHeightViaProxy:e}=await Promise.resolve().then(()=>ab);return{fetchBlockHeightViaProxy:e}},__VITE_PRELOAD__),r="undefined"!=typeof window&&window.__NEXUS_NETWORK__||"mainnet",i=await t(r);if(!e)return;Number.isFinite(Number(i))&&Number(i)>=0&&Ce(Math.floor(Number(i)))}catch{}};t();const r=setInterval(t,6e4);return()=>{e=!1,clearInterval(r)}},[]);const[Oe,Le]=it.useState(""),[Fe,Re]=it.useState(""),[Ue,Me]=it.useState(""),[$e,He]=it.useState(""),[De,ze]=it.useState([]),[We,Ve]=it.useState({}),je=it.useRef(null),qe=it.useRef(""),Ke=Array.isArray(s)&&s.length>0,Xe=Array.isArray(t)?t:[],Ge=Array.isArray(r)?r:[],Ye=it.useMemo(()=>(i&&"object"==typeof i?String(i.status||"").trim().toLowerCase():"")||(Ge.length>0?"unverified":"idle"),[i,Ge.length]),Je=it.useMemo(()=>(i&&"object"==typeof i?String(i.message||"").trim():"")||("ready"===Ye?`Wallet assets ready (${Ge.length} inscription(s))`:"unverified"===Ye?`Wallet inscriptions present (${Ge.length}), but ownership scan not verified yet.`:"loading"===Ye?"Checking wallet\u2026":"extracting"===Ye?"Extracting inscriptions\u2026":"error"===Ye?"Wallet scan failed.":"Wallet assets not verified yet."),[i,Ye,Ge.length]),Qe=it.useMemo(()=>i&&"object"==typeof i?String(i.error||"").trim():"",[i]),Ze=it.useMemo(()=>{const e=[];for(const t of Ge){const n=aS(t?.id||t?.inscriptionId||t?.inscription_id);if(!n)continue;const r=String(t?.contentType||t?.content_type||"").trim().toLowerCase();if(!r.startsWith("image/"))continue;const i=t?.number??t?.inscriptionNumber??t?.inscription_number;e.push({id:n,contentType:r,number:Number.isFinite(Number(i))?Number(i):null})}return e.sort((e,t)=>{const n=e.number,r=t.number;return Number.isFinite(n)&&Number.isFinite(r)&&n!==r?n-r:Number.isFinite(n)&&!Number.isFinite(r)?-1:!Number.isFinite(n)&&Number.isFinite(r)?1:String(e.id).localeCompare(String(t.id))}),e},[Ge]),et=it.useMemo(()=>aS(A),[A]),tt=it.useMemo(()=>{const e=(()=>{const e=Number(String(Fe||"").trim());return Number.isFinite(e)&&e>=0?Math.floor(e):null})();if(null!==e)return e;const t=Array.isArray(De)?De:[];if(0===t.length)return null;let n=null;for(const r of t){const e=Number(We?.[r]?.bitmapNumber);if(!Number.isFinite(e)||e<0)continue;const t=Math.floor(e);if(null===n)n=t;else if(n!==t)return null}return n},[Fe,De,We]);it.useEffect(()=>{if("parcels"!==q)return;const e=tt,t=Number.isFinite(Number(e))?`${Math.floor(Number(e))}.bitmap`:"",n=qx?.parcel_manifest||null,r=n?.address?String(n.address).trim():"bc1puxgqpadwdfdx8wah5y8e990e96847uhmaummcqrnarl0tpc9u0zq64trt6",i=(()=>{const e=Number(n?.feeSats??n?.minFeeSats);return!Number.isFinite(e)||e<=0?"600":String(Math.max(600,Math.floor(e)))})();x!==t&&(v(t),E(!0));const a=Number.isFinite(Number(e))?String(Math.floor(Number(e))):"";g!==a&&(y(a),w(!0)),T!==r&&_(r),P!==i&&B(i)},[q,tt,g,x,T,P]),it.useEffect(()=>{"parcels"===q&&O(e=>!0!==e||e)},[q]),it.useEffect(()=>{if("parcels"!==q)return;if(!mh())return;const e=(Array.isArray(Xe)?Xe:[]).map(e=>aS(e)).filter(Boolean).slice(-3).reverse();if(0===e.length)return;const t=e[0];if(t&&qe.current===t)return;t&&(qe.current=t);let n=!1;return(async()=>{for(const t of e){if(n)return;try{const e=await hv(t),n="bitmap"===String(e?.key||"").toLowerCase()&&!0===e?.verified,r=Number(e?.bitmapNumber);if(!n||!Number.isFinite(r)||r<0)continue;const i=Math.floor(r);if(aS(Oe)===t&&String(Fe||"").trim()===String(i))return;return Le(t),void Re(String(i))}catch{}}})(),()=>{n=!0}},[q,Xe,Oe,Fe]);const nt=it.useMemo(()=>{const e=[],t=new Set;for(const n of Ge){const r=aS(n?.id||n?.inscriptionId||n?.inscription_id);r&&!t.has(r)&&(t.add(r),e.push({id:r,number:n?.number??n?.inscriptionNumber??n?.inscription_number??null}))}return e},[Ge]),rt=it.useMemo(()=>{const e=new Set;for(const{id:t}of nt)t&&e.add(String(t));for(const t of Ge){const n=t?.sameSatIds;if(Array.isArray(n)&&0!==n.length)for(const t of n){const n=aS(t);n&&e.add(n)}}return e},[nt,Ge]),at=it.useCallback(e=>{const t=aS(e);return t?rt.has(t)?"owned":"ready"===Ye?"not-owned":"error"===Ye?"error":"loading"===Ye||"extracting"===Ye?"checking":"unknown":"unknown"},[rt,Ye]);it.useEffect(()=>{if("in-wallet"!==q)return;const e=Array.isArray(Xe)?Xe.map(e=>aS(e)).filter(Boolean):[];0!==e.length&&Ie(t=>{const n={...t||{}};let r=!1;for(const i of e)!0!==n[i]&&(n[i]=!0,r=!0);return r?n:t})},[q,Xe]);const ot=it.useCallback(e=>{const t=Array.isArray(e)?e:[];0!==t.length&&Ae(e=>{const n={...e||{}};let r=!1;for(const i of t)i&&void 0===n[i]&&(n[i]=!0,r=!0);return r?n:e})},[]),st=it.useMemo(()=>{if("legacy"===q)return oS(ve);if("parcels"===q)return Array.isArray(De)?De:[];if("gallery"===q)return Array.isArray(he)?he:[];if("in-wallet"===q){const e=[],t=new Set;for(const{id:n}of nt)n&&!t.has(n)&&!0===Ee?.[n]&&(t.add(n),e.push(n));for(const n of Xe.map(e=>aS(e)).filter(Boolean))t.has(n)||(t.add(n),e.push(n));return e}return Array.isArray(de)?de:[]},[q,ve,De,he,de,nt,Ee,Xe]),lt=it.useCallback(async({filterBitmapOverride:e=null}={})=>{if(He(""),Me(""),!mh())return ze([]),Ve({}),void He("Cannot scan parcels in a sandboxed environment. Use a reverse proxy that serves /r/* and /content/* on the current origin.");const t=nt.map(e=>e.id).filter(Boolean);if(0===t.length)return ze([]),Ve({}),void Me("No wallet inscriptions loaded yet. Fetch UTXOs first.");const n=(()=>{const t=Number(e);if(Number.isFinite(t)&&t>=0)return Math.floor(t);const n=Number(String(Fe||"").trim());return Number.isFinite(n)&&n>=0?Math.floor(n):null})();try{Me("Scanning wallet for valid parcels\u2026");const e=6,r=[],i={};let a=0;for(let o=0;o<t.length;o+=e){const s=t.slice(o,o+e),l=await Promise.all(s.map(async e=>{try{return await vv(e)}catch{return null}}));for(let e=0;e<s.length;e++){const t=s[e],o=l[e];a++;const c=Number(o?.bitmapNumber),u=Number(o?.parcelNumber);"parcel"===String(o?.key||"").toLowerCase()&&!0===o?.verified&&Number.isFinite(c)&&Number.isFinite(u)&&(null!==n&&Math.floor(c)!==n||(r.push(t),i[t]={parcelNumber:Math.floor(u),bitmapNumber:Math.floor(c)}))}Me(`Scanning wallet for valid parcels\u2026 (${a}/${t.length})`)}r.sort((e,t)=>{const n=i[e],r=i[t],a=Number(n?.bitmapNumber),o=Number(r?.bitmapNumber);if(Number.isFinite(a)&&Number.isFinite(o)&&a!==o)return a-o;const s=Number(n?.parcelNumber),l=Number(r?.parcelNumber);return Number.isFinite(s)&&Number.isFinite(l)&&s!==l?s-l:String(e).localeCompare(String(t))}),ze(r),Ve(i),ot(r),Me(r.length>0?`Found ${r.length} valid parcel inscription(s).`:"No valid parcels found in wallet.")}catch(cC){ze([]),Ve({}),He(cC?.message||String(cC)),Me("")}},[Fe,ot,nt]);it.useEffect(()=>{"parcels"===q&&null!==tt&&je.current!==tt&&(je.current=tt,lt({filterBitmapOverride:tt}))},[q,tt,lt]),it.useEffect(()=>{ot(st)},[st,ot]);const ct=it.useMemo(()=>(Array.isArray(st)?st:[]).filter(e=>!1!==ke?.[e]),[st,ke]);it.useEffect(()=>{C&&Array.isArray(ct)&&0!==ct.length&&j(e=>{const t={...e||{}};let n=!1;for(const r of ct)r&&"owned"===at(r)&&void 0===t[r]&&(t[r]=!0,n=!0);return n?t:e})},[C,ct,at]),it.useEffect(()=>{C&&j(e=>{const t={...e||{}};let n=!1;for(const r of Object.keys(t))r&&!0===t[r]&&(!1!==ke?.[r]?"owned"!==at(r)&&(t[r]=!1,n=!0):(t[r]=!1,n=!0));return n?t:e})},[C,ke,at]);const ut=it.useMemo(()=>C?(Array.isArray(ct)?ct:[]).filter(e=>"owned"===at(e)&&!1!==V?.[e]):[],[C,ct,V,at]),dt=it.useMemo(()=>{const e=Array.isArray(ut)?ut:[],t=e=>{const t=String(e??"").trim();if(!t)return null;const n=Number(t);if(!Number.isFinite(n))return null;const r=Math.floor(n);return r<=0?null:r},n=t(L);let r=0,i=0;for(const a of e){const e=M?t(H?.[a]):null,o=null!==e?e:n;null!==o?r+=o:i++}return{count:e.length,missingPriceCount:i,totalSats:r,hasDefaultPrice:null!==n}},[ut,M,H,L]),ft=Math.max(0,(st?.length||0)-(ct?.length||0));return it.useEffect(()=>{if(b)return;const e=function(e,t){const n=iS(e);if(!n)return"";const r=new Set((Array.isArray(t)?t:[]).map(e=>iS(e)).filter(Boolean));if(!r.has(n))return n;for(let i=2;i<1e4;i++){const e=`${n}-${i}`;if(!r.has(e))return e}return`${n}-${Date.now()}`}(x,o);e||rS(x)?e&&e!==g&&y(e):g&&y("")},[x,o,b]),it.useEffect(()=>{M&&Array.isArray(ct)&&0!==ct.length&&D(e=>{const t={...e||{}},n=String(L||"").trim();let r=!1;for(const i of ct)i&&(void 0!==t[i]&&null!==t[i]&&""!==String(t[i]).trim()||(t[i]=n,r=!0));return r?t:e})},[M,ct,L]),it.createElement("div",{className:"p-4 space-y-3"},it.createElement("div",{className:"text-sm opacity-80"},"parcels"===q?"Publish a Bitmap Parcels manifesto (bitmap as parent; no authority slot).":"Create an on-chain collection manifest (`p: OODL-COLLECTION`) and publish it by reinscribing an authority slot."),it.createElement("div",{className:"text-sm border border-neutral-800/60 rounded-lg p-3 bg-neutral-950/20"},it.createElement("div",{className:"text-xs font-semibold text-neutral-200 mb-1"},"Collection mode"),it.createElement("div",{className:"text-[11px] text-neutral-500 mb-2"},"Parent-Child (Growing): select a parent, fetch all children. In-wallet: choose from your wallet. Legacy: paste inscription IDs. Gallery: use a Gallery inscription's items as members. Bitmap Parcels: scan your wallet and keep only valid parcels."),it.createElement("select",{className:"w-full px-3 py-2 text-sm bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-purple-500/60",value:q,onChange:e=>K(String(e.target.value||"parent-child"))},it.createElement("option",{value:"parent-child"},"Parent-Child (Growing)"),it.createElement("option",{value:"in-wallet"},"In-wallet"),it.createElement("option",{value:"legacy"},"Legacy (paste IDs)"),it.createElement("option",{value:"gallery"},"Gallery (inscription)"),it.createElement("option",{value:"parcels"},"Bitmap Parcels")),"parent-child"===q&&it.createElement("div",{className:"mt-3"},it.createElement("div",{className:"text-xs font-semibold text-neutral-200"},"Parent inscription"),it.createElement("div",{className:"text-[11px] text-neutral-500 mb-2"},"Use the ",it.createElement("span",{className:"text-purple-300 font-semibold"},"\ud83d\uddbc\ufe0f Inscriptions")," panel to select a parent, then fetch its children."),rS(ae)?it.createElement("div",{className:"flex items-center gap-2 px-3 py-2 text-sm bg-neutral-950/60 border border-purple-500/40 rounded-lg text-neutral-200 font-mono"},it.createElement("span",{className:"text-green-400 shrink-0"},"\u2705"),it.createElement("span",{className:"truncate min-w-0"},ae)):it.createElement("div",{className:"flex items-center gap-2 px-3 py-2 text-sm bg-neutral-950/40 border border-neutral-800/60 rounded-lg text-neutral-500"},it.createElement("span",{className:"shrink-0 hidden sm:inline"},"\ud83d\udc49"),it.createElement("span",{className:"shrink-0 sm:hidden"},"\ud83d\udc47"),it.createElement("span",null,"No parent selected \u2014 pick one in the Inscriptions panel")),it.createElement("div",{className:"mt-2 flex gap-2"},it.createElement("button",{className:"px-3 py-2 text-xs font-semibold rounded-lg bg-neutral-800 hover:bg-neutral-700 text-neutral-100 disabled:opacity-40 disabled:cursor-not-allowed",onClick:async()=>{ue(""),le("");try{le("Fetching children\u2026");const e=await async function(e){const t=aS(e);if(!t)throw new Error("Invalid parent inscription id. Expected <txid>i<index>.");if(!mh())throw new Error("Cannot fetch children in a sandboxed environment. Use a reverse proxy that serves /r/children/* on the current origin.");const n=[],r=new Set,i=e=>{const t=aS(e);t&&(r.has(t)||(r.add(t),n.push(t)))};try{let e=0;for(;;){const n=0===e?`/r/children/${t}/inscriptions`:`/r/children/${t}/inscriptions/${e}`,r=await sS(th(n)),a=Array.isArray(r?.children)?r.children:null;if(!a||0===a.length)break;for(const e of a)i(e?.id||e);if(!r.more)break;if(e++,e>50)break}if(n.length>0)return n}catch{}let a=0;for(;;){const e=0===a?`/r/children/${t}`:`/r/children/${t}/${a}`,n=await sS(th(e)),r=Array.isArray(n?.ids)?n.ids:[];if(!r||0===r.length)break;for(const t of r)i(t);if(!n.more)break;if(a++,a>50)break}return n}(ae);fe(e),ot(e),le(`Loaded ${e.length} child inscription(s).`)}catch(cC){ue(cC?.message||String(cC)),le(""),fe([])}},disabled:!rS(ae)},"Fetch children"),it.createElement("button",{className:"px-3 py-2 text-xs font-semibold rounded-lg bg-neutral-900 hover:bg-neutral-800 text-neutral-200",onClick:()=>{fe([]),le(""),ue("")}},"Clear")),se||ce?it.createElement("div",{className:"mt-2 text-[11px]"},se?it.createElement("div",{className:"text-green-300 bg-green-500/10 border border-green-500/30 rounded-lg px-3 py-2"},se):null,ce?it.createElement("div",{className:"text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2"},ce):null):null),"in-wallet"===q&&it.createElement("div",{className:"mt-3"},it.createElement("div",{className:"text-xs font-semibold text-neutral-200"},"Select inscriptions from wallet"),it.createElement("div",{className:"text-[11px] text-neutral-500 mb-2"},"Check the inscriptions you want to include in this collection."),0===nt.length?it.createElement("div",{className:"text-[11px] text-neutral-500"},"No wallet inscriptions loaded yet. Connect wallet and fetch inscriptions."):it.createElement("div",{className:"border border-neutral-800/60 rounded-lg bg-neutral-950/20 overflow-hidden"},it.createElement("div",{className:"px-3 py-2 border-b border-neutral-800/60 flex items-center justify-between"},it.createElement("div",{className:"text-[11px] text-neutral-400"},"Wallet inscriptions"),it.createElement("div",{className:"flex gap-2"},it.createElement("button",{className:"px-2 py-1 text-[11px] rounded bg-neutral-800 hover:bg-neutral-700 text-neutral-100",onClick:()=>{const e={};for(const{id:t}of nt)e[t]=!0;Ie(e)}},"Select all"),it.createElement("button",{className:"px-2 py-1 text-[11px] rounded bg-neutral-900 hover:bg-neutral-800 text-neutral-200",onClick:()=>Ie({})},"Clear"))),it.createElement("div",{className:"max-h-56 overflow-auto"},it.createElement("table",{className:"w-full text-[11px]"},it.createElement("thead",null,it.createElement("tr",{className:"text-neutral-400"},it.createElement("th",{className:"text-left font-semibold px-3 py-2"},"Include"),it.createElement("th",{className:"text-left font-semibold px-3 py-2"},"Inscription"))),it.createElement("tbody",null,nt.map(({id:e,number:t})=>it.createElement("tr",{key:e,className:"border-t border-neutral-800/60"},it.createElement("td",{className:"px-3 py-2"},it.createElement("input",{type:"checkbox",checked:!0===Ee?.[e],onChange:t=>{const n=!!t.target.checked;Ie(t=>({...t||{},[e]:n}))},className:"accent-purple-500"})),it.createElement("td",{className:"px-3 py-2 font-mono text-neutral-200 break-all"},null!=t?it.createElement("span",{className:"text-neutral-400"},"#",t," "):null,e)))))))),"legacy"===q&&it.createElement("div",{className:"mt-3"},it.createElement("div",{className:"text-xs font-semibold text-neutral-200"},"Legacy: paste inscription IDs"),it.createElement("div",{className:"text-[11px] text-neutral-500 mb-2"},"One per line (or separated by whitespace/commas)."),it.createElement("textarea",{className:"w-full px-3 py-2 text-sm bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-purple-500/60 font-mono",value:ve,onChange:e=>Se(e.target.value),placeholder:"txid...i0\\ntxid...i1",rows:5}),it.createElement("div",{className:"text-[11px] text-neutral-500 mt-1"},"Parsed: ",oS(ve).length)),"gallery"===q&&it.createElement("div",{className:"mt-3"},it.createElement("div",{className:"text-xs font-semibold text-neutral-200"},"Gallery inscription"),it.createElement("div",{className:"text-[11px] text-neutral-500 mb-2"},"Paste the inscription ID of a Gallery inscription (one that uses ordinals Tag 17 properties to list items). The gallery's items will become the collection's members."),it.createElement("div",{className:"flex gap-2"},it.createElement("input",{className:"flex-1 px-3 py-2 text-sm bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-purple-500/60 font-mono",value:pe,onChange:e=>me(e.target.value),placeholder:"<txid>i0 or txid"}),it.createElement("button",{className:"px-3 py-2 text-xs font-semibold rounded-lg bg-neutral-800 hover:bg-neutral-700 text-neutral-100 disabled:opacity-40 disabled:cursor-not-allowed shrink-0",onClick:async()=>{const e=String(pe||"").trim();if(e){xe(""),be("Resolving gallery items\u2026"),ge([]);try{const{getGalleryInscriptionIds:t}=await n(async()=>{const{getGalleryInscriptionIds:e}=await Promise.resolve().then(()=>ZB);return{getGalleryInscriptionIds:e}},__VITE_PRELOAD__),r=await t(e);ge(r),be(r.length>0?`Resolved ${r.length} item(s) from gallery.`:"No gallery items found in this inscription.")}catch(cC){xe(cC?.message||String(cC)),be("")}}},disabled:!String(pe||"").trim()},"Resolve")),ye&&it.createElement("div",{className:"text-[11px] text-neutral-400 mt-1"},ye),we&&it.createElement("div",{className:"text-[11px] text-red-400 mt-1"},we),he.length>0&&it.createElement("div",{className:"mt-2 border border-neutral-800/60 rounded-lg bg-neutral-950/20 overflow-hidden"},it.createElement("div",{className:"px-3 py-2 border-b border-neutral-800/60 text-[11px] text-neutral-400"},he.length," gallery item(s)"),it.createElement("div",{className:"max-h-40 overflow-auto"},he.map((e,t)=>it.createElement("div",{key:e,className:"px-3 py-1.5 text-[11px] font-mono text-neutral-300 border-t border-neutral-800/30 first:border-t-0 break-all"},e))))),"parcels"===q&&it.createElement("div",{className:"mt-3"},it.createElement("div",{className:"text-xs font-semibold text-neutral-200"},"Bitmap Parcels"),it.createElement("div",{className:"text-[11px] text-neutral-500 mb-2"},"Select a bitmap from the inscriptions panel (right side) to auto-fill the bitmap number, then scan your wallet for valid parcels."),it.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3"},it.createElement("label",{className:"block"},it.createElement("div",{className:"text-xs opacity-70"},"Bitmap number"),it.createElement("input",{className:"w-full px-3 py-2 text-sm bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-purple-500/60",value:Fe,onChange:e=>Re(e.target.value),placeholder:"e.g. 177700",inputMode:"numeric"})),it.createElement("div",{className:"flex items-end gap-2"},it.createElement("button",{className:"px-3 py-2 text-xs font-semibold rounded-lg bg-neutral-800 hover:bg-neutral-700 text-neutral-100",onClick:()=>lt({filterBitmapOverride:tt}),disabled:null===tt},"Scan wallet"),it.createElement("button",{className:"px-3 py-2 text-xs font-semibold rounded-lg bg-neutral-900 hover:bg-neutral-800 text-neutral-200",onClick:()=>{ze([]),Ve({}),Me(""),He("")}},"Clear"))),aS(Oe)?it.createElement("div",{className:"mt-2 text-[11px] text-neutral-500"},"Selected bitmap (from inscriptions panel): ",it.createElement("span",{className:"font-mono text-neutral-300 break-all"},aS(Oe))):it.createElement("div",{className:"mt-2 text-[11px] text-neutral-500"},"Tip: select your bitmap inscription in the right-hand panel to auto-fill the bitmap number and auth."),null===tt?it.createElement("div",{className:"mt-2 text-[11px] text-neutral-500"},"Enter a bitmap number (or select a bitmap on the right) to start scanning."):null,Ue||$e?it.createElement("div",{className:"mt-2 text-[11px]"},Ue?it.createElement("div",{className:"text-green-300 bg-green-500/10 border border-green-500/30 rounded-lg px-3 py-2"},Ue):null,$e?it.createElement("div",{className:"text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2"},$e):null):null)),it.createElement("div",{className:"text-sm"},it.createElement("div",{className:"opacity-80"},"Collection items"),it.createElement("div",null,"Choose how to source items, then optionally exclude individual inscriptions."),it.createElement("div",{className:"opacity-70"},"Included: ",it.createElement("b",null,ct.length),ft>0?` (excluded ${ft})`:"")),st.length>0?it.createElement("div",{className:"text-sm border border-neutral-800/60 rounded-lg p-3 bg-neutral-950/20"},it.createElement("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 sm:gap-3"},it.createElement("div",null,it.createElement("div",{className:"text-xs font-semibold text-neutral-200"},"Included / excluded"),it.createElement("div",{className:"text-[11px] text-neutral-500"},'Toggle "Include" for manifest membership. If you embed offers, toggle "For sale" for owned items.'),it.createElement("div",{className:"mt-1 flex flex-col sm:flex-row sm:items-center gap-2 text-[11px]"},it.createElement("div",{className:"ready"===Ye?"text-green-300":"error"===Ye?"text-red-300":"text-yellow-300/90"},"ready"===Ye?"\u2705 Ready":"error"===Ye?"\u274c Error":"loading"===Ye||"extracting"===Ye?"\u23f3 Checking":"\u26a0\ufe0f Unverified"),it.createElement("div",{className:"text-neutral-500"},Je),Qe?it.createElement("div",{className:"text-red-300"},"(",Qe,")"):null)),it.createElement("div",{className:"flex items-center gap-3 shrink-0"},it.createElement("label",{className:"flex items-center gap-2 text-xs text-neutral-200 select-none cursor-pointer"},it.createElement("input",{type:"checkbox",checked:C,onChange:e=>O(!!e.target.checked),className:"accent-purple-500"}),"Include offers"),it.createElement("button",{type:"button",className:"px-2 py-1 text-[11px] rounded bg-neutral-900 hover:bg-neutral-800 text-neutral-200 disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>a?.(),disabled:"function"!=typeof a,title:"Refresh wallet UTXOs + inscriptions so ownership is verified"},"Rescan wallet"),it.createElement("div",{className:"flex gap-2"},it.createElement("button",{className:"px-2 py-1 text-[11px] rounded bg-neutral-800 hover:bg-neutral-700 text-neutral-100",onClick:()=>{const e={...ke||{}};for(const t of st)e[t]=!0;Ae(e)}},"Include all"),it.createElement("button",{className:"px-2 py-1 text-[11px] rounded bg-neutral-800 hover:bg-neutral-700 text-neutral-100",onClick:()=>{const e={...ke||{}};for(const t of st)t&&(e[t]=rt.has(t));Ae(e)},title:"Include only inscriptions currently detected in your wallet"},"Include owned"),it.createElement("button",{className:"px-2 py-1 text-[11px] rounded bg-neutral-900 hover:bg-neutral-800 text-neutral-200",onClick:()=>{const e={...ke||{}};for(const t of st)e[t]=!1;Ae(e)}},"Exclude all")))),it.createElement("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-3 gap-2"},it.createElement("label",{className:"block md:col-span-1"},it.createElement("div",{className:"text-[11px] text-neutral-500"},"Search"),it.createElement("input",{className:"w-full px-2 py-1 text-[11px] bg-neutral-950/60 border border-neutral-800/60 rounded text-neutral-200 outline-none focus:border-purple-500/60 font-mono",value:Y,onChange:e=>J(e.target.value),placeholder:"filter by txid\u2026"})),it.createElement("div",{className:"md:col-span-2 flex flex-wrap items-end gap-3"},it.createElement("label",{className:"flex items-center gap-2 text-[11px] text-neutral-300 select-none cursor-pointer"},it.createElement("input",{type:"checkbox",checked:ne,onChange:e=>re(!!e.target.checked),className:"accent-purple-500"}),"Included only"),it.createElement("label",{className:"flex items-center gap-2 text-[11px] text-neutral-300 select-none cursor-pointer"},it.createElement("input",{type:"checkbox",checked:Q,onChange:e=>Z(!!e.target.checked),className:"accent-purple-500"}),"Owned only"),it.createElement("label",{className:"flex items-center gap-2 text-[11px] text-neutral-300 select-none cursor-pointer"},it.createElement("input",{type:"checkbox",checked:ee,onChange:e=>te(!!e.target.checked),className:"accent-purple-500",disabled:!C}),"For sale only"),C?it.createElement("button",{type:"button",className:"px-2 py-1 text-[11px] rounded bg-neutral-800 hover:bg-neutral-700 text-neutral-100",onClick:()=>{j(e=>{const t={...e||{}};for(const n of st)n&&!1!==ke?.[n]&&"owned"===at(n)&&(t[n]=!0);return t})},title:"Mark all included + owned items as for sale"},"For sale: all owned"):null,C?it.createElement("button",{type:"button",className:"px-2 py-1 text-[11px] rounded bg-neutral-900 hover:bg-neutral-800 text-neutral-200",onClick:()=>j({})},"Clear for sale"):null)),C?it.createElement("div",{className:"mt-2 text-[11px] text-neutral-500"},"Offers to sign: ",it.createElement("span",{className:"text-neutral-300 font-semibold"},ut.length)," (owned + included + for sale)"):null,it.createElement("div",{className:"mt-2 max-h-64 overflow-auto border border-neutral-800/60 rounded-lg"},it.createElement("table",{className:"w-full text-[11px]"},it.createElement("thead",null,it.createElement("tr",{className:"text-neutral-400"},it.createElement("th",{className:"text-left font-semibold px-3 py-2"},"Include"),it.createElement("th",{className:"text-left font-semibold px-3 py-2"},"For sale"),it.createElement("th",{className:"text-left font-semibold px-3 py-2"},"Owned"),"parcels"===q?it.createElement(it.Fragment,null,it.createElement("th",{className:"text-left font-semibold px-3 py-2"},"Bitmap"),it.createElement("th",{className:"text-left font-semibold px-3 py-2"},"Parcel")):null,it.createElement("th",{className:"text-left font-semibold px-3 py-2"},"Inscription ID"),it.createElement("th",{className:"text-left font-semibold px-3 py-2"},"Actions"))),it.createElement("tbody",null,st.filter(e=>{if(!e)return!1;const t=String(Y||"").trim().toLowerCase();return!(t&&!String(e).toLowerCase().includes(t)||ne&&!1===ke?.[e]||Q&&"owned"!==at(e)||ee&&(!C||!1===V?.[e]||"owned"!==at(e)))}).map(e=>{const t=at(e),n="owned"===t?{text:"yes",cls:"text-green-300 bg-green-500/10 border border-green-500/30"}:"not-owned"===t?{text:"no",cls:"text-neutral-400 bg-neutral-900/30 border border-neutral-800/60"}:"checking"===t?{text:"checking",cls:"text-blue-300 bg-blue-500/10 border border-blue-500/30"}:"error"===t?{text:"error",cls:"text-red-300 bg-red-500/10 border border-red-500/30"}:{text:"unknown",cls:"text-yellow-300/90 bg-yellow-500/10 border border-yellow-500/30"},r=C?!1===ke?.[e]?"Item is excluded.":"checking"===t||"unknown"===t?"Ownership not verified yet \u2014 rescan wallet.":"error"===t?"Wallet scan error \u2014 rescan wallet.":"owned"!==t?"Not in connected wallet.":"":"Enable \u201cInclude offers\u201d first.";return it.createElement("tr",{key:e,className:"border-t border-neutral-800/60"},it.createElement("td",{className:"px-3 py-2"},it.createElement("input",{type:"checkbox",checked:!1!==ke?.[e],onChange:t=>{const n=!!t.target.checked;Ae(t=>({...t||{},[e]:n}))},className:"accent-purple-500"})),it.createElement("td",{className:"px-3 py-2"},it.createElement("input",{type:"checkbox",checked:!1!==V?.[e],onChange:t=>{const n=!!t.target.checked;n&&"owned"!==at(e)?Te(r||"Cannot mark for sale unless owned."):j(t=>({...t||{},[e]:n}))},disabled:!!r,className:"accent-purple-500",title:r||void 0})),it.createElement("td",{className:"px-3 py-2"},it.createElement("span",{className:`inline-flex items-center px-2 py-0.5 rounded border ${n.cls}`},n.text)),"parcels"===q?it.createElement(it.Fragment,null,it.createElement("td",{className:"px-3 py-2 text-neutral-400 font-mono"},Number.isFinite(Number(We?.[e]?.bitmapNumber))?String(We[e].bitmapNumber):""),it.createElement("td",{className:"px-3 py-2 text-neutral-400 font-mono"},Number.isFinite(Number(We?.[e]?.parcelNumber))?String(We[e].parcelNumber):"")):null,it.createElement("td",{className:"px-3 py-2 font-mono text-neutral-200 break-all"},e),it.createElement("td",{className:"px-3 py-2"},it.createElement("div",{className:"flex items-center gap-2"},it.createElement("button",{type:"button",className:"px-2 py-1 text-[11px] rounded bg-neutral-800 hover:bg-neutral-700 text-neutral-100",onClick:()=>{try{const t=th(`/content/${e}`);window.open(t,"_blank","noopener,noreferrer")}catch(t){}}},"Preview"),it.createElement("button",{type:"button",className:"px-2 py-1 text-[11px] rounded bg-neutral-900 hover:bg-neutral-800 text-neutral-200",onClick:async()=>{try{const t=String(e||"");navigator?.clipboard?.writeText&&await navigator.clipboard.writeText(t),Pe("Copied inscription id."),ie.current&&clearTimeout(ie.current),ie.current=setTimeout(()=>Pe(""),1500)}catch(cC){Te(cC?.message||"Failed to copy.")}}},"Copy"))))})))),C&&it.createElement("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-2 gap-3"},it.createElement("div",{className:"md:col-span-2 flex flex-col sm:flex-row sm:items-center justify-between gap-2 sm:gap-3"},it.createElement("div",null,it.createElement("div",{className:"text-xs font-semibold text-neutral-200"},"Pricing"),it.createElement("div",{className:"text-[11px] text-neutral-500"},"Choose one price for all items, or set a price + locktime per inscription.")),it.createElement("div",{className:"flex items-center gap-2 shrink-0"},it.createElement("button",{type:"button",className:M?"px-2 py-1 text-[11px] rounded bg-neutral-900 hover:bg-neutral-800 text-neutral-200":"px-2 py-1 text-[11px] rounded bg-purple-600 hover:bg-purple-500 text-white",onClick:()=>$(!1)},"Single price"),it.createElement("button",{type:"button",className:M?"px-2 py-1 text-[11px] rounded bg-purple-600 hover:bg-purple-500 text-white":"px-2 py-1 text-[11px] rounded bg-neutral-900 hover:bg-neutral-800 text-neutral-200",onClick:()=>$(!0)},"Per inscription"))),it.createElement("div",{className:"md:col-span-2 flex items-start gap-2"},it.createElement("input",{id:"allowUnverifiedOfferSigning",type:"checkbox",className:"accent-purple-500 mt-0.5",checked:X,onChange:e=>G(!!e.target.checked)}),it.createElement("label",{htmlFor:"allowUnverifiedOfferSigning",className:"text-[11px] text-neutral-500 select-none cursor-pointer"},"Allow signing even if ownership is ",it.createElement("span",{className:"text-neutral-300 font-semibold"},"Unknown/Checking")," (not recommended)")),it.createElement("div",{className:"md:col-span-2 border border-neutral-800/60 rounded-lg bg-neutral-950/20 px-3 py-2"},it.createElement("div",{className:"text-xs font-semibold text-neutral-200"},"Offer summary"),it.createElement("div",{className:"mt-1 text-[11px] text-neutral-500"},"Offers to sign: ",it.createElement("span",{className:"text-neutral-200 font-semibold"},dt.count),dt.missingPriceCount>0?it.createElement("span",{className:"text-yellow-300/90"}," \xb7 missing prices: ",dt.missingPriceCount):null),it.createElement("div",{className:"text-[11px] text-neutral-500"},"Total sats (priced offers): ",it.createElement("span",{className:"text-neutral-200 font-semibold"},dt.totalSats)),"ready"===Ye||X?null:it.createElement("div",{className:"mt-1 text-[11px] text-yellow-300/90"},"Ownership not verified \u2014 rescan wallet before signing.")),M?it.createElement("div",{className:"md:col-span-2 border border-neutral-800/60 rounded-lg bg-neutral-950/20 overflow-hidden"},it.createElement("div",{className:"px-3 py-2 border-b border-neutral-800/60 text-xs font-semibold text-neutral-200"},"Prices (selected inscriptions)"),it.createElement("div",{className:"px-3 py-2 border-b border-neutral-800/60"},it.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2"},it.createElement("label",{className:"block"},it.createElement("div",{className:"text-[11px] text-neutral-500"},"Default price (sats)"),it.createElement("input",{className:"w-full px-2 py-1 text-[11px] bg-neutral-950/60 border border-neutral-800/60 rounded text-neutral-200 outline-none focus:border-purple-500/60",value:L,onChange:e=>F(e.target.value),placeholder:"100000",inputMode:"decimal"})),it.createElement("label",{className:"block"},it.createElement("div",{className:"text-[11px] text-neutral-500"},"Default not valid before block (optional)"),it.createElement("div",{className:"flex items-center gap-2"},it.createElement("input",{className:"flex-1 w-full px-2 py-1 text-[11px] bg-neutral-950/60 border border-neutral-800/60 rounded text-neutral-200 outline-none focus:border-purple-500/60",type:"number",min:0,step:1,value:R,onChange:e=>U(e.target.value),onBlur:()=>{const e=String(R??"").trim();if(!e)return;const t=Number(e),n=Number.isFinite(t)&&t>=0?Math.floor(t):null;null!==n&&null!==Be&&n<=Be&&U("")},placeholder:null!==Be?String(Be+6):"e.g. 850000"}),(()=>{const e=String(R??"").trim();if(!e)return null!==Be?it.createElement("div",{className:"text-[11px] text-neutral-600 whitespace-nowrap"},"Tip: ",Be):null;const t=Number(e),n=Number.isFinite(t)&&t>=0?Math.floor(t):null;if(null===n)return null;if(null===Be)return null;const r=n-Be;return r<=0?it.createElement("div",{className:"text-[11px] text-yellow-300/80 whitespace-nowrap"},"Now"):it.createElement("div",{className:"text-[11px] text-neutral-500 whitespace-nowrap"},"+",r)})()))),it.createElement("div",{className:"text-[11px] text-neutral-500 mt-1"},"Per-inscription fields override the defaults. Leave blank to use the default."),it.createElement("div",{className:"mt-2 flex flex-wrap items-center gap-2"},it.createElement("button",{type:"button",className:"px-2 py-1 text-[11px] rounded bg-neutral-800 hover:bg-neutral-700 text-neutral-100",onClick:()=>{const e=Array.isArray(ut)?ut:[];if(0===e.length)return;const t=String(L||"").trim(),n=String(R||"").trim();D(n=>{const r={...n||{}};for(const i of e)i&&(String(r[i]??"").trim()||(r[i]=t));return r}),W(t=>{const r={...t||{}};for(const i of e)i&&(String(r[i]??"").trim()||(r[i]=n));return r})},title:"Fill missing per-inscription fields for for-sale items"},"Fill missing (for sale)"),it.createElement("button",{type:"button",className:"px-2 py-1 text-[11px] rounded bg-neutral-900 hover:bg-neutral-800 text-neutral-200",onClick:()=>{const e=Array.isArray(ut)?ut:[];0!==e.length&&(D(t=>{const n={...t||{}};for(const r of e)r&&delete n[r];return n}),W(t=>{const n={...t||{}};for(const r of e)r&&delete n[r];return n}))},title:"Clear per-inscription overrides for for-sale items (defaults will apply)"},"Clear overrides (for sale)"))),0===ct.length?it.createElement("div",{className:"px-3 py-3 text-[11px] text-neutral-500"},"Select inscriptions first to set per-item prices."):it.createElement("div",{className:"max-h-64 overflow-auto"},it.createElement("table",{className:"w-full text-[11px]"},it.createElement("thead",null,it.createElement("tr",{className:"text-neutral-400"},it.createElement("th",{className:"text-left font-semibold px-3 py-2"},"Include"),it.createElement("th",{className:"text-left font-semibold px-3 py-2"},"Inscription ID"),it.createElement("th",{className:"text-left font-semibold px-3 py-2"},"Price (sats)"),it.createElement("th",{className:"text-left font-semibold px-3 py-2"},"Not before (block)"))),it.createElement("tbody",null,st.map(e=>it.createElement("tr",{key:e,className:"border-t border-neutral-800/60"},it.createElement("td",{className:"px-3 py-2"},it.createElement("input",{type:"checkbox",checked:!1!==ke?.[e],onChange:t=>{const n=!!t.target.checked;Ae(t=>({...t||{},[e]:n}))},className:"accent-purple-500"})),it.createElement("td",{className:"px-3 py-2 font-mono text-neutral-200 break-all"},e),it.createElement("td",{className:"px-3 py-2"},it.createElement("input",{className:"w-full px-2 py-1 text-[11px] bg-neutral-950/60 border border-neutral-800/60 rounded text-neutral-200 outline-none focus:border-purple-500/60",value:H?.[e]??"",onChange:t=>{const n=t.target.value;D(t=>({...t||{},[e]:n}))},placeholder:L?String(L):"100000",inputMode:"decimal",disabled:!1===ke?.[e]})),it.createElement("td",{className:"px-3 py-2"},it.createElement("input",{className:"w-full px-2 py-1 text-[11px] bg-neutral-950/60 border border-neutral-800/60 rounded text-neutral-200 outline-none focus:border-purple-500/60",type:"number",min:0,step:1,value:z?.[e]??"",onChange:t=>{const n=t.target.value;W(t=>({...t||{},[e]:n}))},onBlur:()=>{const t=String(z?.[e]??"").trim();if(!t)return;const n=Number(t),r=Number.isFinite(n)&&n>=0?Math.floor(n):null;null!==r&&null!==Be&&r<=Be&&W(t=>({...t||{},[e]:""}))},placeholder:R?String(R):null!==Be?String(Be+6):"",disabled:!1===ke?.[e]}))))))),it.createElement("div",{className:"px-3 py-2 border-t border-neutral-800/60 text-[11px] text-neutral-500"},"This will ask your wallet to sign ",Number(ut.length||0)," offer PSBT(s).")):it.createElement(it.Fragment,null,it.createElement("label",{className:"block"},it.createElement("div",{className:"text-xs opacity-70"},"Sale price sats (applies to all selected items)"),it.createElement("input",{className:"w-full px-3 py-2 text-sm bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-purple-500/60",value:L,onChange:e=>F(e.target.value),placeholder:"100000"}),it.createElement("div",{className:"text-[11px] text-neutral-500 mt-1"},"This will ask your wallet to sign ",Number(ut.length||0)," offer PSBT(s).")),it.createElement("label",{className:"block"},it.createElement("div",{className:"text-xs opacity-70"},"Not valid before block (optional)"),it.createElement("div",{className:"flex items-center gap-2"},it.createElement("input",{className:"flex-1 w-full px-3 py-2 text-sm bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-purple-500/60",type:"number",min:0,step:1,value:R,onChange:e=>U(e.target.value),onBlur:()=>{const e=String(R??"").trim();if(!e)return;const t=Number(e),n=Number.isFinite(t)&&t>=0?Math.floor(t):null;null!==n&&null!==Be&&n<=Be&&U("")},placeholder:"e.g. 850000"}),(()=>{const e=String(R??"").trim();if(!e)return null!==Be?it.createElement("div",{className:"text-[11px] text-neutral-600 whitespace-nowrap"},"Tip: ",Be):null;const t=Number(e),n=Number.isFinite(t)&&t>=0?Math.floor(t):null;if(null===n)return null;if(null===Be)return null;const r=n-Be;return r<=0?it.createElement("div",{className:"text-[11px] text-yellow-300/80 whitespace-nowrap"},"Purchasable now"):it.createElement("div",{className:"text-[11px] text-neutral-500 whitespace-nowrap"},"Purchasable in ",r," block(s)")})()),it.createElement("div",{className:"text-[11px] text-neutral-500 mt-1"},"Sets offer PSBT locktime before signing."))),it.createElement("div",{className:"text-[11px] text-neutral-500"},"Note: wallets that can\u2019t sign 0x83 offers will fail here. In that case you can still list via the normal 3-tx listing flow."),it.createElement("div",{className:"text-[11px] text-neutral-500 md:col-span-2"},"Offer generation uses the \u201cFor sale\u201d toggles above and will automatically skip items not currently in your connected wallet."))):null,it.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3"},it.createElement("label",{className:"block"},it.createElement("div",{className:"text-xs opacity-70"},"Key (slug)"),it.createElement("input",{className:"w-full px-3 py-2 text-sm bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-purple-500/60",value:g,onChange:e=>{const t=e.target.value;y(t),w(!!rS(t))},disabled:"parcels"===q,placeholder:"my-collection"})),it.createElement("label",{className:"block"},it.createElement("div",{className:"text-xs opacity-70"},"Title"),it.createElement("input",{className:"w-full px-3 py-2 text-sm bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-purple-500/60",value:x,onChange:e=>{v(e.target.value),E(!0)},disabled:"parcels"===q,placeholder:"My Collection"})),it.createElement("label",{className:"block md:col-span-2"},it.createElement("div",{className:"text-xs opacity-70"},"Description (optional)"),it.createElement("input",{className:"w-full px-3 py-2 text-sm bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-purple-500/60",value:I,onChange:e=>k(e.target.value),placeholder:"Short description"})),"parcels"!==q?it.createElement("div",{className:"md:col-span-2"},it.createElement("div",{className:"text-xs opacity-70"},"Collection image (optional)"),it.createElement("div",{className:"text-[11px] text-neutral-500 mb-2"},"This does ",it.createElement("span",{className:"text-neutral-300 font-semibold"},"not")," inscribe an image. It only references an existing image inscription ID (",it.createElement("span",{className:"font-mono"},"<txid>i<index>"),") to use as the collection thumbnail. The image does not need to be in your wallet."),it.createElement("input",{className:"w-full px-3 py-2 text-sm bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-purple-500/60 font-mono",value:A,onChange:e=>N(e.target.value),placeholder:"Paste existing image inscription id (e.g. 0123abcd...i0)"}),Ze.length>0?it.createElement("div",{className:"mt-2 flex flex-col sm:flex-row gap-2 sm:items-center"},it.createElement("div",{className:"text-[11px] text-neutral-500 shrink-0"},"Pick from wallet images:"),it.createElement("select",{className:"w-full sm:w-auto px-3 py-2 text-sm bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-purple-500/60 font-mono",value:et||"",onChange:e=>N(String(e.target.value||""))},it.createElement("option",{value:""},"(none)"),Ze.map(e=>it.createElement("option",{key:e.id,value:e.id},null!==e.number&&void 0!==e.number?`#${e.number} `:"",e.id))),it.createElement("button",{type:"button",className:"px-3 py-2 text-xs font-semibold rounded-lg bg-neutral-900 hover:bg-neutral-800 text-neutral-200",onClick:()=>N("")},"Clear")):null,et?it.createElement("div",{className:"mt-3 border border-neutral-800/60 rounded-lg bg-neutral-950/20 p-2"},it.createElement("div",{className:"text-[11px] text-neutral-500 mb-2"},"Preview"),it.createElement("img",{src:th(`/content/${et}`),alt:"Catalog thumbnail",className:"max-h-40 w-auto rounded-md border border-neutral-800/60",loading:"lazy"})):null):null,"parcels"!==q?it.createElement(it.Fragment,null,it.createElement("label",{className:"block md:col-span-2"},it.createElement("div",{className:"text-xs opacity-70"},"Indexing address"),it.createElement("input",{className:"w-full px-3 py-2 text-sm bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-purple-500/60 font-mono",value:T,onChange:e=>_(e.target.value),placeholder:"bc1p..."})),it.createElement("label",{className:"block"},it.createElement("div",{className:"text-xs opacity-70"},"Indexing fee sats (min 330)"),it.createElement("input",{className:"w-full px-3 py-2 text-sm bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-purple-500/60",type:"number",min:330,step:1,value:P,onChange:e=>B(e.target.value),placeholder:"330"}))):null,"parcels"!==q?it.createElement("label",{className:"block"},it.createElement("div",{className:"text-xs opacity-70"},"Authority slot (owned child)"),it.createElement("select",{className:"w-full px-3 py-2 text-sm bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-purple-500/60 font-mono",value:u,onChange:e=>p?.(e.target.value),disabled:!Ke},Ke?s.map(e=>it.createElement("option",{key:e,value:e},e)):it.createElement("option",{value:""},"(none found)"))):null),(l||c)&&it.createElement("div",{className:"text-sm"},l&&it.createElement("div",{className:"text-xs text-green-300 bg-green-500/10 border border-green-500/30 rounded-lg px-3 py-2"},l),c&&it.createElement("div",{className:"text-xs text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2"},c)),it.createElement("div",{className:"text-sm border border-neutral-800/60 rounded-lg p-3 bg-neutral-950/20"},it.createElement("div",{className:"text-xs font-semibold text-neutral-200 mb-1"},"Fee rate (manifest inscription)"),it.createElement("div",{className:"text-[11px] text-neutral-500 mb-2"},"Used when inscribing the collection manifest."),it.createElement("input",{className:"w-full px-3 py-2 text-sm bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-purple-500/60",value:null==d?"":String(d),onChange:e=>f?.(e.target.value),placeholder:"e.g. 5",inputMode:"decimal"})),"parcels"!==q?it.createElement("div",{className:"flex gap-2"},it.createElement("button",{className:Ke?"w-full sm:w-auto px-4 py-3 sm:py-2 text-sm font-semibold rounded-lg bg-purple-600 hover:bg-purple-500 text-white transition-colors":"w-full sm:w-auto px-4 py-3 sm:py-2 text-sm font-semibold rounded-lg bg-neutral-800 text-neutral-500 cursor-not-allowed",onClick:async()=>{Te(""),Pe("");try{if(!ct||0===ct.length)throw new Error("Select at least one inscription to include in the collection.");if(C&&!X){if("ready"!==Ye)throw new Error("Wallet ownership is not verified yet. Click \u201cRescan wallet\u201d and wait for Ready before generating offers (or explicitly allow unverified signing).");if(Qe)throw new Error(`Wallet scan error: ${Qe}`)}Pe("Launching collection\u2026");const e=e=>{const t=String(e??"").trim();if(!t)return null;const n=Number(t);if(!Number.isFinite(n))throw new Error("Block height must be a number.");const r=Math.floor(n);if(r<0)throw new Error("Block height must be >= 0.");return r},t=(()=>{if(!C)return;if(!M)return;const e={};for(const t of ut){const n=z?.[t];if(null==n)continue;const r=String(n).trim();r&&(e[t]=r)}return Object.keys(e).length>0?e:void 0})(),n=C?t?null:e(R):null;await(m?.({key:g,title:x,description:I,indexingAddress:T,feeSats:P,catalogImageInscriptionId:et||void 0,selectedItemIdsOverride:ct,offerItemIdsOverride:ut,galleryInscriptionId:"gallery"===q?String(pe||"").trim():void 0,includeSaleOffers:C,salePriceSats:L,salePriceByInscriptionId:M?H:void 0,minBlockHeightByInscriptionId:t,minBlockHeight:n,onProgress:e=>{const t=String(e||"").trim();t&&Pe(t)}})),Pe("Launch flow started. Follow wallet prompts to publish.")}catch(cC){Te(cC?.message||String(cC)),Pe("")}},disabled:!Ke},"Launch Collection")):null,"parcels"===q?it.createElement("div",{className:"mt-4 border-t border-neutral-800/60 pt-4"},it.createElement("div",{className:"text-sm opacity-80"},"Bitmap Parcels manifesto: inscribes a manifesto with the bitmap as parent, and pays the parcel-manifest indexing fee + NXSPM hint inside the reveal."),it.createElement("div",{className:"mt-3 flex flex-col sm:flex-row items-stretch sm:items-center gap-2"},it.createElement("button",{className:"w-full sm:w-auto px-4 py-3 sm:py-2 text-sm font-semibold rounded-lg bg-green-600 hover:bg-green-700 text-white transition-colors",onClick:async()=>{Te(""),Pe("");try{if("function"!=typeof h)throw new Error("Parcel manifesto flow is not available in this build.");if(!ct||0===ct.length)throw new Error("Select at least one inscription to include in the manifesto.");if(C&&!X){if("ready"!==Ye)throw new Error("Wallet ownership is not verified yet. Click \u201cRescan wallet\u201d and wait for Ready before generating offers (or explicitly allow unverified signing).");if(Qe)throw new Error(`Wallet scan error: ${Qe}`)}const e=aS(Oe);if(!e)throw new Error("Enter a valid bitmap inscription id (<txid>i<index>).");const t=Number(Fe);if(!Number.isFinite(t)||t<0)throw new Error("Enter a valid bitmap number (>= 0).");const n={};if(C){const e=String(L||"").trim();for(const t of ut){const r=M?H?.[t]:e;if(null==r)continue;const i=String(r).trim();i&&(n[t]=i)}}const r=e=>{const t=String(e??"").trim();if(!t)return null;const n=Number(t);if(!Number.isFinite(n))throw new Error("Block height must be a number.");const r=Math.floor(n);if(r<0)throw new Error("Block height must be >= 0.");return r},i=(()=>{if(!C)return;if(!M)return;const e={};for(const t of ut){const n=z?.[t];if(null==n)continue;const r=String(n).trim();r&&(e[t]=r)}return Object.keys(e).length>0?e:void 0})(),a=C?i?null:r(R):null;Pe("Publishing Bitmap Parcels manifesto\u2026"),await h({bitmapInscriptionId:e,bitmapNumber:Math.floor(t),itemIds:ct,includeSaleOffers:C,salePriceByInscriptionId:n,minBlockHeightByInscriptionId:i,minBlockHeight:a,onProgress:e=>{const t=String(e||"").trim();t&&Pe(t)}}),Pe("Parcel manifesto publish flow started. Follow wallet prompts.")}catch(cC){Te(cC?.message||String(cC)),Pe("")}},disabled:"function"!=typeof h||!aS(Oe)||null===tt},"Publish Bitmap Parcels Manifesto"),it.createElement("div",{className:"text-[11px] text-neutral-500"},"Select a bitmap on the right first."))):null,(_e||Ne)&&it.createElement("div",{className:"text-sm"},_e&&it.createElement("div",{className:"text-xs text-green-300 bg-green-500/10 border border-green-500/30 rounded-lg px-3 py-2"},_e),Ne&&it.createElement("div",{className:"text-xs text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2"},Ne)))}function cS({value:e,label:t,onClear:n}){const r=rt.useRef(null),i=rt.useRef(null),a=null===e,o=rt.useMemo(()=>a?"":String(e||"").trim(),[e,a]),s=a||!!o;if(rt.useEffect(()=>{if(!s)return;let e=!1;return(async()=>{try{const t=await function({timeoutMs:e=5e3}={}){const t=Date.now();return new Promise((n,r)=>{const i=()=>"undefined"!=typeof window&&window.QrCreator&&"function"==typeof window.QrCreator.render?n(window.QrCreator):Date.now()-t>e?r(new Error("QrCreator not loaded")):void setTimeout(i,50);i()})}({timeoutMs:7e3});if(e)return;const n=r.current;if(!n)return;if(a||!o)return n&&(n.innerHTML=""),void(i.current=null);let s=i.current;s||(n.innerHTML="",s=document.createElement("canvas"),i.current=s,n.appendChild(s)),t.render({text:o,size:200,ecLevel:"M",radius:0,quiet:2},s)}catch(cC){if(e)return;const n=r.current;n&&(n.innerHTML=""),i.current=null}})(),()=>{e=!0}},[o,s,a]),!s)return null;const l=it.createElement("div",{className:"fixed bottom-4 right-4 z-[99999]"},it.createElement("div",{className:"bg-neutral-900/95 border border-neutral-700/60 rounded-xl p-3 shadow-lg w-[280px]"},it.createElement("div",{className:"flex flex-col items-center gap-2"},it.createElement("div",{className:"bg-white rounded-lg p-2"},it.createElement("div",{className:"min-h-[200px] min-w-[200px] flex items-center justify-center"},a?it.createElement("div",{className:"text-xs text-neutral-700 font-semibold"},"Loading\u2026"):it.createElement("div",{ref:r}))),it.createElement("div",{className:"w-full"},it.createElement("div",{className:"text-[11px] text-neutral-300 font-semibold"},t||"PSBT"),it.createElement("div",{className:"text-[10px] text-neutral-500 break-all"},a?"Fetching PSBT from reveal tx\u2026":it.createElement(it.Fragment,null,o.slice(0,42),o.length>42?"\u2026":"")))),it.createElement("div",{className:"mt-2 flex gap-2"},it.createElement("button",{onClick:e=>{e.stopPropagation();try{!a&&o&&navigator.clipboard.writeText(o)}catch(t){}},disabled:a||!o,className:a||!o?"flex-1 px-3 py-1.5 text-xs font-semibold rounded-lg bg-neutral-800/40 text-neutral-500 cursor-not-allowed":"flex-1 px-3 py-1.5 text-xs font-semibold rounded-lg bg-neutral-800 hover:bg-neutral-700 text-white transition-colors",title:"Copy PSBT"},"Copy"),it.createElement("button",{onClick:e=>{e.stopPropagation(),n?.()},className:"px-3 py-1.5 text-xs font-semibold rounded-lg bg-neutral-800 hover:bg-neutral-700 text-white transition-colors",title:"Close"},"Close"))));return"undefined"==typeof document?l:wt.createPortal(l,document.body)}const uS="text-[10px] font-semibold uppercase tracking-wide text-neutral-500",dS="text-sky-400 hover:text-sky-300 transition-colors underline underline-offset-2",fS="px-3 sm:px-4 py-2.5 sm:py-3 border-b border-neutral-800/50 last:border-b-0";function pS({label:e,children:t,mono:n=!1}){return t?it.createElement("div",{className:"flex flex-col gap-1"},it.createElement("span",{className:uS},e),it.createElement("span",{className:n?"text-xs font-mono text-neutral-300 break-all":"text-sm text-neutral-200"},t)):null}function mS({value:e,label:t="Copy"}){const[n,r]=rt.useState(!1);return it.createElement("button",{type:"button",onClick:async()=>{try{await navigator.clipboard.writeText(e),r(!0),setTimeout(()=>r(!1),1500)}catch{}},className:"ml-2 px-1.5 py-0.5 text-[9px] font-semibold rounded bg-neutral-800/60 text-neutral-400 hover:text-neutral-200 border border-neutral-700/50 hover:border-neutral-600/60 transition-colors",title:t},n?"\u2713":"\u2398")}function hS({inscriptionId:e,label:t}){if(!e)return null;const n=`${e.slice(0,8)}\u2026${e.slice(-6)}`,r=th(`/inscription/${e}`);return it.createElement("a",{href:r,target:"_blank",rel:"noopener noreferrer",className:dS,title:e},t||n)}function gS({address:e}){if(!e)return null;const t=e.length>20?`${e.slice(0,10)}\u2026${e.slice(-8)}`:e,n=`https://mempool.space/address/${e}`;return it.createElement("span",{className:"inline-flex items-center gap-1 flex-wrap"},it.createElement("a",{href:n,target:"_blank",rel:"noopener noreferrer",className:`${dS} font-mono text-xs`,title:e},t),it.createElement(mS,{value:e,label:"Copy address"}))}function yS({scripts:e}){return e&&Array.isArray(e)&&0!==e.length?it.createElement("div",{className:"flex flex-col gap-1.5"},e.map((e,t)=>{const n="string"==typeof e?e:e?.inscriptionId||e?.id||"",r="object"==typeof e&&(e?.name||e?.label)||"";return n?it.createElement("div",{key:t,className:"flex items-center gap-2 text-xs flex-wrap"},it.createElement(hS,{inscriptionId:n,label:r||void 0}),r&&it.createElement("span",{className:"text-neutral-500"},"(",r,")")):null})):null}function bS({filters:e}){return e&&Array.isArray(e)&&0!==e.length?it.createElement("div",{className:"flex flex-wrap gap-1.5"},e.map((e,t)=>{const n=e?.label||e?.key||`Filter ${t+1}`,r=e?.type||"unknown";return it.createElement("span",{key:t,className:"inline-flex items-center px-2 py-0.5 text-[10px] font-semibold rounded-full bg-neutral-800/60 text-neutral-300 border border-neutral-700/50",title:`Type: ${r}, Path: ${e?.sourcePath||"N/A"}`},n)})):null}function wS({match:e}){if(!e||"object"!=typeof e)return null;const t=[];if(e.bitmapOci&&t.push({label:"Bitmap OCI",value:"Matches bitmap OCI inscriptions"}),e.contentRegex&&t.push({label:"Content Regex",value:e.contentRegex,mono:!0}),e.contentTypeStartsWith&&t.push({label:"Content Type",value:`Starts with: ${e.contentTypeStartsWith}`}),e.inscriptionIdRange){const n=e.inscriptionIdRange,r=Array.isArray(n)?n.map(e=>`${e.baseTxid?.slice(0,8)}\u2026i${e.from}-${e.to}`).join(", "):`${n.baseTxid?.slice(0,8)}\u2026i${n.from}-${n.to}`;t.push({label:"Inscription Range",value:r,mono:!0})}if(e.inscriptionIds&&e.inscriptionIds.length>0&&t.push({label:"Specific IDs",value:`${e.inscriptionIds.length} inscriptions`}),e.galleryInscriptionId&&t.push({label:"Gallery Inscription",value:e.galleryInscriptionId,mono:!0}),e.jsonPathEquals&&e.jsonPathEquals.length>0){const n=e.jsonPathEquals.map(e=>`${e.path} = ${JSON.stringify(e.equals)}`).join("; ");t.push({label:"JSON Path Match",value:n,mono:!0})}return 0===t.length?null:it.createElement("div",{className:"flex flex-col gap-2"},t.map((e,t)=>it.createElement("div",{key:t,className:"flex flex-col gap-0.5"},it.createElement("span",{className:"text-[9px] font-semibold uppercase text-neutral-600"},e.label),it.createElement("span",{className:e.mono?"text-[11px] font-mono text-neutral-400 break-all":"text-xs text-neutral-300"},e.value))))}function xS({addresses:e}){if(!e||"object"!=typeof e)return null;const t=Object.entries(e).filter(([e,t])=>e&&t);return 0===t.length?null:it.createElement("div",{className:"flex flex-col gap-2"},t.map(([e,t])=>it.createElement("div",{key:e,className:"flex flex-col gap-0.5"},it.createElement("span",{className:"text-[9px] font-semibold uppercase text-neutral-600"},e),it.createElement(gS,{address:t}))))}function vS({collection:e,isOpen:t,onClose:n}){const r=rt.useRef(null);if(rt.useEffect(()=>{if(!t)return;const e=e=>{"Escape"===e.key&&n?.()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[t,n]),rt.useEffect(()=>{if(!t)return;const e=e=>{r.current&&!r.current.contains(e.target)&&n?.()},i=setTimeout(()=>{document.addEventListener("mousedown",e)},100);return()=>{clearTimeout(i),document.removeEventListener("mousedown",e)}},[t,n]),!t||!e)return null;const{key:i,name:a,description:o,indexingAddress:s,feeSats:l,minFeeSats:c,imageInscriptionId:u,catalogImage:d,addresses:f,scripts:p,filters:m,match:h,sourceInscriptionId:g,manifest:y}=e,b=y?.meta||{},w=y?.indexing||{},x=Number.isFinite(l)||Number.isFinite(c),v=p&&p.length>0,S=m&&m.length>0,E=h&&Object.keys(h).length>0,I=f&&Object.keys(f).length>0,k="string"==typeof d?d:d&&"object"==typeof d&&(d.inscriptionId||d.id)||"",A=d?.contentType||d?.content_type||"";return it.createElement(it.Fragment,null,it.createElement("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[9500]",onClick:n}),it.createElement("div",{className:"fixed inset-0 z-[9500] flex items-end sm:items-center justify-center p-0 sm:p-4 pointer-events-none"},it.createElement("div",{ref:r,className:"rounded-2xl bg-gradient-to-b from-neutral-900 to-neutral-950 text-neutral-200 shadow-2xl border border-neutral-700/50 overflow-hidden w-full max-w-lg max-h-[85vh] max-h-[85dvh] overflow-y-auto pointer-events-auto animate-in fade-in zoom-in-95 duration-200 rounded-t-2xl sm:rounded-2xl"},it.createElement("div",{className:"flex items-start gap-3 sm:gap-4 p-3 sm:p-4 border-b border-neutral-800/50 sticky top-0 bg-neutral-900/95 backdrop-blur-sm z-10"},(u||k)&&it.createElement("div",{className:"w-14 h-14 sm:w-16 sm:h-16 shrink-0 rounded-xl overflow-hidden bg-black border border-neutral-800/70"},it.createElement("img",{src:th(`/content/${u||k}`),alt:a||i,className:"w-full h-full object-cover",onError:e=>{e.target.style.display="none"}})),it.createElement("div",{className:"flex-1 min-w-0"},it.createElement("h3",{className:"text-base sm:text-lg font-semibold text-neutral-100 truncate"},a||i),i!==a&&it.createElement("div",{className:"text-[10px] sm:text-xs text-neutral-500 font-mono truncate"},i),o&&it.createElement("p",{className:"text-xs sm:text-sm text-neutral-400 mt-1 line-clamp-2"},o)),it.createElement("button",{type:"button",onClick:n,className:"shrink-0 w-8 h-8 grid place-items-center rounded-lg bg-neutral-800/60 text-neutral-400 hover:text-neutral-200 hover:bg-neutral-700/60 border border-neutral-700/50 transition-colors touch-manipulation",title:"Close"},"\u2715")),it.createElement("div",{className:fS},it.createElement("div",{className:"grid grid-cols-1 gap-3"},it.createElement(pS,{label:"Indexing Address"},it.createElement(gS,{address:s})),x&&it.createElement(pS,{label:"Listing Fee"},it.createElement("span",{className:"flex items-center gap-2 flex-wrap"},Number.isFinite(l)&&it.createElement("span",{className:"text-amber-200 font-semibold"},Cx(l)," BTC"),Number.isFinite(c)&&c!==l&&it.createElement("span",{className:"text-neutral-500 text-xs"},"(min: ",Cx(c)," BTC)"))),g&&it.createElement(pS,{label:"Manifest Inscription"},it.createElement(hS,{inscriptionId:g})),k&&k!==u&&it.createElement(pS,{label:"Catalog Image"},it.createElement("span",{className:"flex items-center gap-2 flex-wrap"},it.createElement(hS,{inscriptionId:k}),A&&it.createElement("span",{className:"text-neutral-500 text-[10px]"},"(",A,")"))))),I&&it.createElement("div",{className:fS},it.createElement("span",{className:uS},"Additional Addresses"),it.createElement("div",{className:"mt-2"},it.createElement(xS,{addresses:f}))),v&&it.createElement("div",{className:fS},it.createElement("span",{className:uS},"Scripts"),it.createElement("div",{className:"mt-2"},it.createElement(yS,{scripts:p}))),S&&it.createElement("div",{className:fS},it.createElement("span",{className:uS},"Filters"),it.createElement("div",{className:"mt-2"},it.createElement(bS,{filters:m}))),E&&it.createElement("div",{className:fS},it.createElement("span",{className:uS},"Membership Rules"),it.createElement("div",{className:"mt-2"},it.createElement(wS,{match:h}))),b.author&&it.createElement("div",{className:fS},it.createElement(pS,{label:"Author"},b.author)),w.parentInscriptionId&&it.createElement("div",{className:fS},it.createElement(pS,{label:"Parent Inscription"},it.createElement(hS,{inscriptionId:w.parentInscriptionId}))))))}function SS({collection:e,listingsCount:t=0,floorPriceSats:n=null,isLoading:r=!1,isSubscribed:i=!1,onBack:a,onRefresh:o,onShowDetails:s,onToggleSubscribe:l,onClearCache:c,isClearingCache:u=!1}){const[d,f]=rt.useState(!1),[p,m]=rt.useState(!1),h=rt.useRef(null);rt.useEffect(()=>{if(!p)return;const e=e=>{h.current&&!h.current.contains(e.target)&&m(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[p]),rt.useEffect(()=>{if(!p)return;const e=e=>{"Escape"===e.key&&m(!1)};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[p]);const g=e?.name||e?.title||e?.key||"Collection",y=e?.description||"",b=e?.imageInscriptionId||e?.catalogImage?.inscriptionId||e?.catalogImage||"",w=Number.isFinite(n)&&n>0;return it.createElement("div",{className:"relative"},it.createElement("div",{className:"bg-neutral-900/95 backdrop-blur-sm border border-neutral-800/60 rounded-xl overflow-visible"},it.createElement("div",{className:"flex items-center gap-0.5 sm:gap-1 px-1 sm:px-3"},it.createElement("button",{onClick:a,className:"min-h-[36px] sm:min-h-[44px] px-1 sm:px-1.5 flex items-center text-neutral-400 hover:text-neutral-100 active:text-neutral-100 transition-colors touch-manipulation select-none shrink-0",title:"Back to collections"},it.createElement("svg",{className:"w-3.5 h-3.5 sm:w-4 sm:h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2},it.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"}))),it.createElement("button",{type:"button",onClick:()=>f(e=>!e),className:"flex-1 min-w-0 min-h-[36px] sm:min-h-[44px] flex items-center gap-1.5 sm:gap-3 touch-manipulation select-none group"},b&&it.createElement("div",{className:"w-5 h-5 sm:w-7 sm:h-7 shrink-0 rounded sm:rounded-md overflow-hidden bg-neutral-800 ring-1 ring-neutral-700/40"},it.createElement("img",{src:th(`/content/${b}`),alt:"",className:"w-full h-full object-cover",loading:"lazy",onError:e=>{e.target.style.display="none"}})),it.createElement("span",{className:"text-xs sm:text-sm font-semibold text-neutral-100 truncate group-hover:text-white transition-colors"},g),it.createElement("div",{className:"hidden sm:flex items-center gap-1.5 shrink-0"},it.createElement("span",{className:"px-2 py-0.5 text-[11px] font-semibold tabular-nums rounded-md bg-neutral-800/60 text-neutral-300 ring-1 ring-neutral-700/40"},t," listed"),w&&it.createElement("span",{className:"px-2 py-0.5 text-[11px] font-semibold tabular-nums rounded-md bg-neutral-800/60 text-amber-300/90 ring-1 ring-amber-500/15"},"\u230a ",Cx(n))),i&&it.createElement("span",{className:"w-2 h-2 rounded-full bg-purple-400 shrink-0 shadow-[0_0_6px_rgba(168,85,247,0.4)]",title:"Subscribed"}),it.createElement("svg",{className:"w-3 h-3 sm:w-3.5 sm:h-3.5 shrink-0 text-neutral-500 transition-transform duration-200 "+(d?"rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2},it.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"}))),it.createElement("div",{className:"flex items-center shrink-0"},it.createElement("button",{onClick:o,disabled:r,className:"w-8 h-8 sm:w-9 sm:h-9 min-h-[36px] min-w-[36px] sm:min-h-[44px] sm:min-w-[44px] grid place-items-center rounded-lg text-neutral-500 hover:text-neutral-200 active:text-neutral-200 transition-colors disabled:opacity-40 disabled:cursor-not-allowed touch-manipulation",title:"Refresh listings"},it.createElement("svg",{className:"w-3 h-3 sm:w-3.5 sm:h-3.5 "+(r?"animate-spin":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2},it.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"}))),it.createElement("div",{className:"relative",ref:h},it.createElement("button",{onClick:()=>m(!p),className:"w-8 h-8 sm:w-9 sm:h-9 min-h-[36px] min-w-[36px] sm:min-h-[44px] sm:min-w-[44px] grid place-items-center rounded-lg text-neutral-500 hover:text-neutral-200 active:text-neutral-200 transition-colors touch-manipulation",title:"More options"},it.createElement("svg",{className:"w-3 h-3 sm:w-3.5 sm:h-3.5",fill:"currentColor",viewBox:"0 0 20 20"},it.createElement("path",{d:"M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"}))),p&&it.createElement(it.Fragment,null,it.createElement("div",{className:"fixed inset-0 z-[9000]",onClick:()=>m(!1)}),it.createElement("div",{className:"absolute right-0 top-full mt-1 w-52 bg-neutral-900 border border-neutral-700/60 rounded-xl shadow-2xl overflow-hidden z-[9001]"},it.createElement("button",{onClick:()=>{l?.(),m(!1)},className:"w-full min-h-[44px] px-3 sm:px-4 py-2.5 text-left text-sm text-neutral-200 hover:bg-neutral-800/60 active:bg-neutral-800/80 transition-colors flex items-center gap-3 touch-manipulation"},i?it.createElement("svg",{className:"w-4 h-4 shrink-0 text-purple-400",fill:"currentColor",viewBox:"0 0 20 20"},it.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})):it.createElement("svg",{className:"w-4 h-4 shrink-0 text-neutral-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2},it.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})),it.createElement("span",null,i?"Subscribed":"Subscribe")),it.createElement("button",{onClick:()=>{s?.(),m(!1)},className:"w-full min-h-[44px] px-3 sm:px-4 py-2.5 text-left text-sm text-neutral-200 hover:bg-neutral-800/60 active:bg-neutral-800/80 transition-colors flex items-center gap-3 touch-manipulation"},it.createElement("svg",{className:"w-4 h-4 shrink-0 text-neutral-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2},it.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})),it.createElement("span",null,"Collection Details")),it.createElement("div",{className:"border-t border-neutral-800/60"}),it.createElement("button",{onClick:()=>{c?.(),m(!1)},disabled:u,className:"w-full min-h-[44px] px-3 sm:px-4 py-2.5 text-left text-sm text-neutral-400 hover:text-red-300 hover:bg-neutral-800/60 active:bg-neutral-800/80 transition-colors flex items-center gap-3 disabled:opacity-50 touch-manipulation"},it.createElement("svg",{className:"w-4 h-4 shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2},it.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})),it.createElement("span",null,u?"Clearing\u2026":"Clear Cache"))))))),d&&it.createElement("div",{className:"border-t border-neutral-800/40 px-2 sm:px-4 py-2 sm:py-4"},it.createElement("div",{className:"flex items-start gap-2 sm:gap-3"},b&&it.createElement("div",{className:"w-10 h-10 sm:w-16 sm:h-16 shrink-0 rounded-md sm:rounded-lg overflow-hidden bg-neutral-800 ring-1 ring-neutral-700/40"},it.createElement("img",{src:th(`/content/${b}`),alt:"",className:"w-full h-full object-cover",loading:"lazy",onError:e=>{e.target.style.display="none"}})),it.createElement("div",{className:"flex-1 min-w-0"},y&&it.createElement("p",{className:"text-[11px] sm:text-sm text-neutral-400 leading-snug sm:leading-relaxed line-clamp-2 sm:line-clamp-3"},y),it.createElement("div",{className:"mt-1.5 sm:mt-2 flex items-center gap-2 sm:gap-3"},it.createElement("div",{className:"flex items-center gap-1"},it.createElement("span",{className:"text-xs sm:text-sm font-bold text-neutral-100 tabular-nums"},t),it.createElement("span",{className:"text-[9px] sm:text-[10px] text-neutral-500 uppercase tracking-wider"},"listed")),w&&it.createElement(it.Fragment,null,it.createElement("span",{className:"text-neutral-700"},"\xb7"),it.createElement("div",{className:"flex items-center gap-1"},it.createElement("span",{className:"text-xs sm:text-sm font-bold text-amber-300 tabular-nums"},Cx(n)),it.createElement("span",{className:"text-[9px] sm:text-[10px] text-neutral-500 uppercase tracking-wider"},"floor"))),i&&it.createElement(it.Fragment,null,it.createElement("span",{className:"text-neutral-700"},"\xb7"),it.createElement("span",{className:"text-[9px] sm:text-[10px] text-purple-400 font-medium uppercase tracking-wider"},"Subscribed"))))))))}const ES="98a7813f3ada2888e447ea91df8a0178803096b1b3575e0699469fe9bc65cc69i0";function IS({selectedInscription:e,selectedParentsCount:t=0,selectedParentIds:r=[],priceSats:i,onPriceSatsChange:a,listingScriptAddress:o,onListingScriptAddressChange:s,markerValueSats:l,onMarkerValueSatsChange:c,dryRun:u=!1,onDryRunChange:d,onCreateListingTx:f,onCreateBulkListingTx:p,createDisabled:m=!1,sellerStatus:h,sellerError:g,bulkSellerStatus:y,bulkSellerError:b,bulkBundleJson:w,saleMinBlockHeight:x="",onSaleMinBlockHeightChange:v,collectionAuthoritySlots:S=[],collectionAuthorityStatus:E="",collectionAuthorityError:I="",collectionAuthoritySlotId:k="",onCollectionAuthoritySlotIdChange:A,onLaunchCollection:N,onLaunchParcelManifest:T,revealTxid:_,onRevealTxidChange:P,onBuy:B,buyDisabled:C=!1,fundingNeeded:O=!1,onCreateFundingTx:L,fundingDisabled:F=!1,fundingStatus:R,fundingError:U,buyStatus:M,buyError:$,previewInscription:H=null,manualSellerPsbt:D="",manualSellerStatus:z="",manualSellerError:W="",onCreateManualSellerOfferPsbt:V,manualBuyStatus:j="",manualBuyError:q="",onBuyFromSellerOfferPsbt:K,manualBuyerFundedPsbt:X="",manualBuyerFundedStatus:G="",manualBuyerFundedError:Y="",onCreateBuyerFundedPsbtForSeller:J,manualSellerCountersignStatus:Q="",manualSellerCountersignError:Z="",onCountersignAndBroadcastFromBuyerFundedPsbt:ee,feeRate:te,onFeeRateChange:ne,walletInscriptions:re=[],walletAssetScanState:ie=null,onRequestWalletRescan:ae,onOodlLayoutChange:oe,oodlSection:se,onOodlSectionChange:le}){const[ce,ue]=rt.useState("marketplace"),de=se||ce,fe=le||ue,[pe,me]=rt.useState("sell"),[he,ge]=rt.useState(""),[ye,be]=rt.useState(!1),[we,xe]=rt.useState(!1),[ve,Se]=rt.useState(!1),[Ee,Ie]=rt.useState(""),[ke,Ae]=rt.useState([]),[Ne,Te]=rt.useState(!1),[_e,Pe]=rt.useState(null),[Be,Ce]=rt.useState("home"),[Oe,Le]=rt.useState([]),[Fe,Re]=rt.useState(null),[Ue,Me]=rt.useState({}),[$e,He]=rt.useState({}),[De,ze]=rt.useState(""),[We,Ve]=rt.useState("name"),[je,qe]=rt.useState(!1),[Ke,Xe]=rt.useState(null),[Ge,Ye]=rt.useState(!1),[Je,Qe]=rt.useState(null),[Ze,et]=rt.useState(null),[tt,nt]=rt.useState(null),[at,ot]=rt.useState(""),[st,lt]=rt.useState(null),[ct,ut]=rt.useState(!1),[dt,ft]=rt.useState(null),[pt,mt]=rt.useState("");rt.useEffect(()=>{let e=!0;const t=async()=>{try{mt("");const{fetchBlockHeightViaProxy:t}=await n(async()=>{const{fetchBlockHeightViaProxy:e}=await Promise.resolve().then(()=>ab);return{fetchBlockHeightViaProxy:e}},__VITE_PRELOAD__),r="undefined"!=typeof window&&window.__NEXUS_NETWORK__||"mainnet",i=await t(r);if(!e)return;Number.isFinite(Number(i))&&Number(i)>=0&&ft(Math.floor(Number(i)))}catch(cC){if(!e)return;mt(cC?.message||String(cC))}};if("marketplace"!==de&&("sell"===pe||"collection"===pe)){t();const n=setInterval(t,6e4);return()=>{e=!1,clearInterval(n)}}return t(),()=>{e=!1}},[de,pe]);const ht=it.useRef(null),gt=it.useRef(null),[yt,bt]=rt.useState(null),[wt,xt]=rt.useState(null),[vt,St]=rt.useState(null);rt.useEffect(()=>{xt(null),St(null)},[yt]);const[Et,It]=rt.useState(null),[kt,At]=rt.useState(""),[Nt,Tt]=rt.useState(""),[_t,Pt]=rt.useState({status:"idle",message:""}),[Bt,Ct]=rt.useState(""),[Ot,Lt]=rt.useState(""),Ft=it.useCallback(e=>{const t=String(e??"").trim();if(!t)return null;const n=Number(t);if(!Number.isFinite(n))return null;const r=Math.floor(n);return r<0?null:r},[]),Rt=String(kt||"").trim()||null,Ut=it.useMemo(()=>Rt&&(Array.isArray(Oe)?Oe:[]).find(e=>String(e?.key||"").trim()===Rt)||null,[Oe,Rt]),Mt=jx?.enabled?Qx(Rt&&"uncategorized"!==Rt?Rt:null)||Jx():null,$t=jx?.enabled&&Rt&&"uncategorized"!==Rt?Qx(Rt):null;!jx?.enabled||Rt&&"uncategorized"!==Rt&&Qx(Rt);const Ht=it.useRef({inflight:new Map,done:new Map}),Dt=it.useRef({inflight:new Map,done:new Map}),zt=Number.POSITIVE_INFINITY,Wt="oodl:subscribed-collections",Vt=e=>`oodl:listings:${String(e||"home")}`,jt=(e,t)=>`oodl:listing-meta:${String(e||"mainnet")}:${String(t||"")}`,qt=e=>{const t=String(e||"home").trim()||"home",n="home"===t||"__home"===t;return{page:t,idbPageKey:n?"home":t,cacheKey:n?"__home":t,isCatchAll:n}},[Kt,Xt]=rt.useState([]),Gt=it.useMemo(()=>new Set(Kt),[Kt]),[Yt,Jt]=rt.useState(!1);rt.useEffect(()=>{let e=!0;return(async()=>{try{const t=await wx(Wt,{maxAgeMs:Number.POSITIVE_INFINITY});if(!e)return;const n=Array.isArray(t)?t.map(e=>String(e||"").trim()).filter(Boolean):[],r=Array.from(new Set(n.map(e=>e.toLowerCase())));Xt(r)}catch{if(!e)return;Xt([])}})(),()=>{e=!1}},[]),rt.useEffect(()=>{let e=!0;const t=e=>{const t=String(e||"").trim().toLowerCase();if(!t)return null;const n=(Array.isArray(Oe)?Oe:[]).find(e=>String(e?.key||"").trim().toLowerCase()===t)||null;return String(n?.key||t).trim()||null};return(async()=>{try{if("marketplace"!==de)return;const n=Array.isArray(Kt)?Kt:[];if(0===n.length)return;const r={},i=Math.min(n.length,12);for(let e=0;e<i;e++){const i=n[e],a=t(i);if(!a)continue;const{idbPageKey:o,cacheKey:s}=qt(a);if(!(Array.isArray(Ue?.[s])&&Ue[s].length>0))try{const e=await wx(Vt(o),{maxAgeMs:Number.POSITIVE_INFINITY});Array.isArray(e)&&e.length>0&&(r[s]=e)}catch{}}if(!e)return;if(Object.keys(r).length>0){Me(e=>({...e||{},...r}));const e=String(Be||"").trim(),{cacheKey:t}=qt(e),n=r[t];if(Array.isArray(n)&&n.length>0){const t=String(e||"").trim().toLowerCase();Gt.has(t)&&0===(Array.isArray(ke)?ke:[]).length&&Ae(n)}}}catch{}})(),()=>{e=!1}},[de,Kt,Oe,Be]);const Qt=it.useCallback(e=>{const t=String(e||"").trim().toLowerCase();t&&Xt(e=>{if(e.includes(t))return e;const n=[...e,t];try{yx(Wt,n)}catch{}return n})},[]),Zt=it.useCallback(e=>{const t=String(e||"").trim().toLowerCase();t&&Xt(e=>{if(!e.includes(t))return e;const n=e.filter(e=>e!==t);try{yx(Wt,n)}catch{}return n})},[]),en=e=>{const t=String(e||"").trim().toLowerCase();return Gt.has(t)?zt:12e4},tn=e=>"bitmap"===String(e||"").trim().toLowerCase(),nn=e=>{const t=String(e||"").trim().toLowerCase();return"parcel"===t||"parcels"===t},rn=it.useMemo(()=>{const e=Array.isArray(Oe)?Oe:[],t=[{key:"uncategorized",name:"Uncategorized",description:"No collection / no category",catalogImage:{inscriptionId:ES,contentType:"image/avif"}}];e.some(e=>tn(e?.key))||t.push({key:"bitmap",name:"Bitmaps",description:"Verified bitmap inscriptions",match:{bitmapOci:!0}}),e.some(e=>nn(e?.key))||t.push({key:"parcel",name:"Bitmap Parcels",description:"Parcel inscriptions ({parcel}.{bitmap}.bitmap)"});const n=[...e,...t],r=new Map;for(const i of n){const e=String(i?.key||"").trim();e&&(r.has(e)||r.set(e,i))}return Array.from(r.values()).sort((e,t)=>String(e?.name||e?.key).localeCompare(String(t?.name||t?.key)))},[Oe]),an=it.useMemo(()=>{const e=String(Nt||"").trim().toLowerCase(),t=Array.isArray(rn)?rn:[];return e?t.filter(t=>{const n=String(t?.name||"").toLowerCase(),r=String(t?.key||"").toLowerCase(),i=String(t?.description||"").toLowerCase();return n.includes(e)||r.includes(e)||i.includes(e)}):t},[rn,Nt]),on=e?.id||e?.inscriptionId||e?.inscription_id||"",sn=e?.number||e?.inscriptionNumber||e?.inscription_number,ln="offer"===de,cn="oodl"===de,un="marketplace"===de,dn="hub"===de,fn=it.useRef(0),pn=it.useMemo(()=>{const e=Number(tt?.bitmapNumber);return Number.isFinite(e)?Math.floor(e):null},[tt]),mn=tt?.bitmon?.pattern||null,hn=it.useMemo(()=>{const e=String(tt?.type||"").trim().toLowerCase();return"bitmap"===String(tt?.key||"").trim().toLowerCase()||"bitmap"===e&&!0===tt?.verified||"bitmap"===e&&null!==pn},[tt,pn]),gn=it.useMemo(()=>{const e=String(tt?.type||"").trim().toLowerCase(),t=String(tt?.key||"").trim().toLowerCase(),n="parcel"===t||"parcels"===t||"parcel"===e,r=Number(tt?.bitmapNumber),i=Number(tt?.parcelNumber);return{isParcel:n,bitmapNumber:Number.isFinite(r)?Math.trunc(r):null,parcelNumber:Number.isFinite(i)?Math.trunc(i):null}},[tt]),[yn,bn]=rt.useState({status:"idle",result:null,error:null});rt.useEffect(()=>{let e=!0;return(async()=>{if(!gn.isParcel)return void(e&&bn({status:"idle",result:null,error:null}));const t=(Ze?.id||Ze?.inscriptionId||Ze?.inscription_id||at||_||"").toString().trim();if(t){e&&bn({status:"validating",result:null,error:null});try{const{detectAndVerifyParcelByInscriptionId:r}=await n(async()=>{const{detectAndVerifyParcelByInscriptionId:e}=await Promise.resolve().then(()=>Sv);return{detectAndVerifyParcelByInscriptionId:e}},__VITE_PRELOAD__),i=await r(String(t));if(!e)return;if(!i||"parcel"!==i.type||!i.verified)return void bn({status:"invalid",result:i||null,error:"Not a verified parcel inscription."});const a=Number(i?.bitmapNumber),o=Number(i?.parcelNumber);if(null!==gn.bitmapNumber&&Number.isFinite(a)&&Math.trunc(a)!==gn.bitmapNumber)return void bn({status:"invalid",result:i,error:`Bitmap mismatch (expected ${gn.bitmapNumber}, verified ${Math.trunc(a)}).`});if(null!==gn.parcelNumber&&Number.isFinite(o)&&Math.trunc(o)!==gn.parcelNumber)return void bn({status:"invalid",result:i,error:`Parcel mismatch (expected ${gn.parcelNumber}, verified ${Math.trunc(o)}).`});bn({status:"valid",result:i,error:null})}catch(uC){if(!e)return;bn({status:"invalid",result:null,error:String(uC?.message||uC||"Parcel verification failed")})}}else e&&bn({status:"invalid",result:null,error:"Missing inscription id."})})(),()=>{e=!1}},[gn.isParcel,gn.bitmapNumber,gn.parcelNumber,Ze,at,_]);const wn=it.useRef(de);it.useEffect(()=>{if("marketplace"===de&&"marketplace"!==wn.current){const e=gt.current;if(e){gt.current=null;const t=String(e?.marketplacePage||"home"),n=e?.selectedMarketplaceCollection||null,r=null==e?.parcelMarketplaceBitmapNumber?null:e.parcelMarketplaceBitmapNumber;Xe(n),Ce(t),bt(r),Ae([]),(async()=>{try{const{idbPageKey:e,cacheKey:r}=qt(t);if("home"===t){const e=Ue?.[r];return void(Array.isArray(e)&&e.length>0?Ae(e):await Sn({forceRefresh:!1,page:"home"}))}const i=Ue?.[r];if(Array.isArray(i)&&i.length>0)return Ae(i),void Sn({forceRefresh:!0,page:t,collection:n}).catch(()=>{});try{const i=await wx(Vt(e),{maxAgeMs:en(t)});if(Array.isArray(i)&&i.length>0)return Ae(i),Me(e=>({...e||{},[r]:i})),void Sn({forceRefresh:!0,page:t,collection:n}).catch(()=>{})}catch{}await Sn({forceRefresh:!1,page:t,collection:n})}catch{}})()}else Xe(null),Ce("home"),bt(null)}wn.current=de},[de]),rt.useEffect(()=>{let e=!0;return(async()=>{const t=on;if(t)try{const{detectAndVerifyBitmapByInscriptionId:r}=await n(async()=>{const{detectAndVerifyBitmapByInscriptionId:e}=await Promise.resolve().then(()=>gv);return{detectAndVerifyBitmapByInscriptionId:e}},__VITE_PRELOAD__),i=await r(t);if("bitmap"===i?.type&&i?.verified)return void(e&&It(i));const{detectAndVerifyParcelByInscriptionId:a}=await n(async()=>{const{detectAndVerifyParcelByInscriptionId:e}=await Promise.resolve().then(()=>Sv);return{detectAndVerifyParcelByInscriptionId:e}},__VITE_PRELOAD__),o=await a(t);if("parcel"===o?.type&&o?.verified)return void(e&&It(o));e&&It(null)}catch{e&&It(null)}else e&&It(null)})(),()=>{e=!1}},[on]),rt.useEffect(()=>{let e=!0;return(async()=>{const t=String(on||"").trim(),r=String(kt||"").trim();if(t&&r)if("uncategorized"!==r){e&&Pt({status:"validating",message:"Validating collection membership\u2026"});try{if(tn(r)){if("bitmap"!==Et?.type||!Et?.verified)throw new Error("This inscription is not OCI-verified as a bitmap.");return void(e&&Pt({status:"valid",message:"Verified bitmap."}))}if(nn(r)){if("parcel"!==Et?.type||!Et?.verified){const{detectAndVerifyParcelByInscriptionId:e}=await n(async()=>{const{detectAndVerifyParcelByInscriptionId:e}=await Promise.resolve().then(()=>Sv);return{detectAndVerifyParcelByInscriptionId:e}},__VITE_PRELOAD__),r=await e(t);if("parcel"!==r?.type||!r?.verified)throw new Error('This inscription is not parcel-verified (expected "{parcel}.{bitmap}.bitmap" under the correct bitmap parent).')}return void(e&&Pt({status:"valid",message:"Verified parcel."}))}const i=rn.find(e=>String(e?.key||"").trim()===r)||null;if(!i)throw new Error("Selected collection not found. Refresh collections and try again.");const{matchCollectionForInscription:a}=await n(async()=>{const{matchCollectionForInscription:e}=await Promise.resolve().then(()=>Xv);return{matchCollectionForInscription:e}},__VITE_PRELOAD__);if(await a(t,[i])!==r)throw new Error("This inscription is not indexed / does not match the selected collection rules.");e&&Pt({status:"valid",message:"Verified in selected collection."})}catch(cC){if(!e)return;Pt({status:"invalid",message:cC?.message||String(cC)})}}else e&&Pt({status:"valid",message:"No collection selected."});else e&&Pt({status:"idle",message:""})})(),()=>{e=!1}},[on,kt,rn,Et]);const xn=(()=>{if(!ln||"sell"!==pe)return!1;const e=String(z||"").toLowerCase();return e.includes("refused")||e.includes("external signer")||e.includes("unsafe")})(),vn=!(!ln||"buy"!==pe)&&ve&&!!String(q||"").trim();async function Sn({forceRefresh:e=!1,page:t=null,collection:r=null}={}){const i=++fn.current;Te(!0),Pe(null);const a=Array.isArray(ke)?ke:[];if(e)try{Dt.current?.done?.clear?.()}catch{}try{const o=t||Be,s=tn(o),l=nn(o),c="__home"===String(o||"")||"home"===String(o||"");let u=null;const d=r||(o&&"home"!==o&&String(Ke?.key||"")===String(o)?Ke:null)||o&&"home"!==o&&"__home"!==o&&Oe.find(e=>e?.key===o)||null;if(u=c?jx?.fundingAddress||null:d?.indexingAddress||null,!u&&s&&(u=qx?.bitmap?.address||null),!u&&l&&(u=qx?.parcel?.address||null),!(u||c||s||l))throw new Error(`Missing indexing address for collection "${String(o)}"`);const f=(e,t,n)=>{const r=Number(t),i=Number.isFinite(r)&&r>0?Math.trunc(r):25e3;return Promise.race([Promise.resolve(e),new Promise((e,t)=>{setTimeout(()=>t(new Error(`${n||"Operation"} timed out`)),i)})])},p=await f(Qv({address:u||void 0,forceRefresh:e}),25e3,"Marketplace indexing"),m=async e=>{const t=Array.isArray(e)?e:[];if(0===t.length)return[];try{const{loadBitcoinLibFromInscription:e}=await n(async()=>{const{loadBitcoinLibFromInscription:e}=await Promise.resolve().then(()=>yg);return{loadBitcoinLibFromInscription:e}},__VITE_PRELOAD__),{getPsbtInputOutpoint:r}=await n(async()=>{const{getPsbtInputOutpoint:e}=await Promise.resolve().then(()=>BB);return{getPsbtInputOutpoint:e}},__VITE_PRELOAD__),{getInscriptionOutpoint:i}=await n(async()=>{const{getInscriptionOutpoint:e}=await Promise.resolve().then(()=>kh);return{getInscriptionOutpoint:e}},__VITE_PRELOAD__),a=await e(),o=e=>{const t=String(e||"").trim();if(!t)return null;try{return a.Psbt.fromBase64(t)}catch{return a.Psbt.fromHex(t)}},s=async e=>{const t=String(e?.inscriptionId||"").trim(),n=String(e?.sellerOfferPsbt||"").trim();if(!t||!n)return null;const a=o(n);if(!a)return e;const s=r(a,2);if(!s)return e;let l=null;try{l=await i(t)}catch{l=null}return l&&s.toLowerCase()!==String(l).toLowerCase()?null:{...e||{},inscriptionOutpoint:l||e?.inscriptionOutpoint||null,offerOutpoint:s}},l=[],c=6;for(let n=0;n<t.length;n+=c){const e=t.slice(n,n+c),r=await Promise.all(e.map(s));l.push(...r.filter(Boolean))}return l}catch{return t}},h=(e,t)=>{const n=Array.isArray(e)?e:[],r=Array.isArray(t)?t:[];if(0===r.length)return n;const i=new Map;for(const a of n){const e=String(a?.inscriptionId||"").trim();e&&i.set(e,a)}for(const a of r){const e=String(a?.inscriptionId||"").trim();e&&(i.has(e)||i.set(e,a))}return Array.from(i.values())},g=async()=>{try{if(!nn(o)||"home"===o)return[];const{discoverParcelManifestRegistrations:e}=await n(async()=>{const{discoverParcelManifestRegistrations:e}=await Promise.resolve().then(()=>aC);return{discoverParcelManifestRegistrations:e}},__VITE_PRELOAD__),{detectAndVerifyParcelByInscriptionId:t}=await n(async()=>{const{detectAndVerifyParcelByInscriptionId:e}=await Promise.resolve().then(()=>Sv);return{detectAndVerifyParcelByInscriptionId:e}},__VITE_PRELOAD__),r=await e({limit:120});if(!Array.isArray(r)||0===r.length)return[];const i=new Map;for(const n of r){const e=Number(n?.bitmapNumber),t=String(n?.manifestoInscriptionId||"").trim().toLowerCase();if(!Number.isFinite(e)||e<0)continue;if(!/^[0-9a-f]{64}i\d+$/.test(t))continue;const r=i.get(Math.trunc(e));r?Number(n?.blockTimeMs||0)>Number(r?.blockTimeMs||0)&&i.set(Math.trunc(e),n):i.set(Math.trunc(e),n)}const a=async(e,{accept:t}={})=>{const r=(Array.isArray(e)?e:[e]).map(e=>String(e||"").trim()).filter(e=>/^[0-9a-f]{64}i\d+$/i.test(e));if(0===r.length)return null;const i="function"==typeof t?t:null;for(const a of r){let e=null;try{const t=th(`/content/${a}`),n=await fetch(t);if(!n.ok)continue;e=new Uint8Array(await n.arrayBuffer())}catch{e=null}if(!e)continue;const t=e=>{if(!e)return null;let t="";try{t=new TextDecoder("utf-8",{fatal:!1}).decode(e)}catch{try{t=Buffer.from(e).toString("utf8")}catch{t=""}}const n=String(t||"").trim();if(!n)return null;try{return JSON.parse(n)}catch{return null}};let r=t(e);if(!r)try{const{brotliDecompressBytes:i}=await n(async()=>{const{brotliDecompressBytes:e}=await Promise.resolve().then(()=>db);return{brotliDecompressBytes:e}},__VITE_PRELOAD__);r=t(await i(e))}catch{}if("string"==typeof r)try{r=JSON.parse(String(r))}catch{}const o=r&&"object"==typeof r?{...r,__inscriptionId:a}:null;if(o&&(!i||i(o)))return o}return null},s=Array.from(i.values()),l=[],c=3;for(let n=0;n<s.length;n+=c){const e=s.slice(n,n+c),r=await Promise.all(e.map(async e=>{const t=String(e?.manifestoInscriptionId||"").trim(),n=String(e?.txid||"").trim().toLowerCase(),r=(()=>{const e=[];t&&e.push(t),/^[0-9a-f]{64}$/.test(n)&&(e.push(`${n}i0`),e.push(`${n}i1`),e.push(`${n}i2`));const r=new Set;return e.filter(e=>{const t=String(e).toLowerCase();return!r.has(t)&&(r.add(t),!0)})})();return{r:e,manifest:await a(r,{accept:e=>{const t=String(e?.p||"").trim();return"Bitmap Parcel"===t||"NXS-PARCEL-MANIFEST"===t||"NXS Parcel Manifest"===t}})}}));for(const{r:n,manifest:i}of r){if(!i)continue;const e=String(i?.p||"").trim();if("Bitmap Parcel"!==e&&"NXS-PARCEL-MANIFEST"!==e&&"NXS Parcel Manifest"!==e)continue;const r=(()=>{const e=Number(i?.bitmap);if(Number.isFinite(e)&&e>=0)return Math.trunc(e);const t=Number(n?.bitmapNumber);return Number.isFinite(t)&&t>=0?Math.trunc(t):null})();if(null===r)continue;const a=Array.isArray(i?.open_store?.offers)?i.open_store.offers:[];if(0===a.length)continue;const o=(()=>{const e=Number(i?.open_store?.minBlockHeight??i?.open_store?.min_block_height);return Number.isFinite(e)&&e>=0?Math.trunc(e):null})(),s=(()=>{const e=Array.isArray(i?.items)?i.items:[];if(0===e.length)return null;const t=new Map;for(const n of e){const e=String(n?.inscription_id||n?.inscriptionId||"").trim().toLowerCase();e&&t.set(e,n)}return t})();for(const i of a){const e=String(i?.inscriptionId||i?.inscription_id||i?.id||"").trim(),a=String(i?.sellerOfferPsbt||i?.seller_offer_psbt||i?.psbt||"").trim(),c=Number(i?.priceSats??i?.price_sats??i?.price);if(!e||!a)continue;if(!Number.isFinite(c)||c<=0)continue;if(s){const t=s.get(String(e).toLowerCase());if(t&&!1===t.for_sale)continue}let u=null;try{u=await t(e)}catch{u=null}const d=Number(u?.parcelNumber),f=Number(u?.bitmapNumber);!Number.isFinite(d)||d<0||Number.isFinite(f)&&Math.trunc(f)===r&&l.push({inscriptionId:e,inscription:{id:e,inscriptionId:e},revealTxid:null,price:Math.trunc(c),...null!==o?{minBlockHeight:o}:{},listedAt:Number.isFinite(Number(n?.blockTimeMs))?Number(n.blockTimeMs):Date.now(),status:"active",sellerOfferPsbt:a,source:"parcel-manifest",collection:{key:"parcel",bitmapNumber:r,parcelNumber:Math.trunc(d),manifestInscriptionId:String(n?.manifestoInscriptionId||"").trim()||void 0}})}}}return l}catch{return[]}},y=!c&&d?(e=>{const t=e?.manifest&&"object"==typeof e.manifest?e.manifest:null,n=Array.isArray(t?.open_store?.offers)?t.open_store.offers:[];if(!n||0===n.length)return[];const r=(()=>{const e=Number(t?.open_store?.minBlockHeight??t?.open_store?.min_block_height);return Number.isFinite(e)&&e>=0?Math.trunc(e):null})();return n.map(t=>{const n=String(t?.inscriptionId||t?.inscription_id||t?.id||"").trim(),i=String(t?.sellerOfferPsbt||t?.seller_offer_psbt||t?.psbt||"").trim(),a=Number(t&&(t.priceSats??t.price_sats??t.price));return n&&i?!Number.isFinite(a)||a<=0?null:{inscriptionId:n,inscription:{id:n,inscriptionId:n},revealTxid:null,price:a,...null!==r?{minBlockHeight:r}:{},listedAt:Date.now(),status:"active",sellerOfferPsbt:i,source:"collection-manifest",collection:e||null}:null}).filter(Boolean)})(d):[],b=await m(y),w=await g(),x=await m(w),v=h(h(p,b),x),S=s?(Array.isArray(v)?v:[]).map(e=>{const t=e?.collection&&"object"==typeof e.collection?e.collection:{};return"bitmap"===String(t?.key||"").trim().toLowerCase()?e:{...e,collection:{...t,key:"bitmap"}}}):v,E=(()=>{const e=Array.isArray(S)?S:[];return s?e.filter(e=>"bitmap"===String(e?.collection?.key||"").trim().toLowerCase()):l?e.filter(e=>"parcel"===String(e?.collection?.key||"").trim().toLowerCase()):e})(),I=Array.isArray(E)?E:[],k=e&&a.length>0&&0===I.length,A=(()=>{if(k)return a;if(0===a.length)return I;const e=new Map;for(const t of a){const n=String(t?.inscriptionId||"").trim(),r=Number(t?.price);n&&Number.isFinite(r)&&r>0&&e.set(n,t)}return 0===e.size?I:I.map(t=>{const n=String(t?.inscriptionId||"").trim();if(!n)return t;const r=Number(t?.price);if(Number.isFinite(r)&&r>0)return t;const i=e.get(n);if(!i)return t;const a={...t};return a.price=i.price,i.priceAsOf&&(a.priceAsOf=i.priceAsOf),void 0!==i.minBlockHeight&&void 0===a.minBlockHeight&&(a.minBlockHeight=i.minBlockHeight),null!==i.bitmapNumberHint&&null===a.bitmapNumberHint&&(a.bitmapNumberHint=i.bitmapNumberHint),null!==i.parcelNumberHint&&null===a.parcelNumberHint&&(a.parcelNumberHint=i.parcelNumberHint),a})})();i===fn.current&&(k&&Pe("Refresh returned 0 listings; keeping last known results (check connectivity and try again)."),Ae(A));try{const{idbPageKey:e}=qt(o);await yx(Vt(e),A)}catch{}const{cacheKey:N}=qt(o);i===fn.current&&Me(e=>({...e||{},[N]:A}))}catch(Kh){i===fn.current&&Pe(Kh.message||"Failed to load marketplace")}finally{i===fn.current&&Te(!1)}}rt.useEffect(()=>{if("function"!=typeof oe)return;const e=!un&&!dn&&("sell"===pe||cn&&"collection"===pe);oe({showAdvancedOptions:e,limitParentSelection:!(!e||cn&&"collection"===pe),parentsLabel:e?"Inscriptions":"Parents"})},[oe,un,dn,cn,pe]),rt.useEffect(()=>{nn(Ke?.key||Be)||null===yt||bt(null)},[Be,Ke?.key]),rt.useEffect(()=>{Se(!1)},[ln,he,pe]),rt.useEffect(()=>{xe(!1)},[he]),rt.useEffect(()=>{!String(_||"").trim()&&String(at||"").trim()&&ot("")},[_,at]),rt.useEffect(()=>{let e=!0;return(async()=>{let t=!1;try{const n=await wx("oodl:collections:dynamic",{maxAgeMs:864e5});e&&Array.isArray(n)&&n.length>0&&(t=!0,Le(n),Gx(n))}catch{}try{const t=await Kv({forceRefresh:!1});if(!e)return;const n=Array.isArray(t?.collections)?t.collections:[];Le(n),Gx(n),Array.isArray(n)&&n.length>0&&yx("oodl:collections:dynamic",n).catch(()=>{})}catch(uC){if(!e)return;t||Le([]),Re(uC?.message||String(uC))}const n=eS();if(e&&Array.isArray(n)&&n.length>0)Ae(n);else try{const t=await wx(Vt("home"),{maxAgeMs:en("home")});e&&Array.isArray(t)&&t.length>0&&Ae(t)}catch{}await Sn({forceRefresh:!1,page:"home"})})(),()=>{e=!1}},[]),rt.useEffect(()=>{let e=!1;const t=tn(Ke?.key||Be);if(!t)return;Ax({forceRefresh:!1}).catch(()=>{});const n=Array.isArray(ke)?ke:[];if(0===n.length)return;const r=n.map(e=>({inscriptionId:e?.inscriptionId,collection:e?.collection})).filter(e=>{const t=String(e.inscriptionId||"").trim();if(!t)return!1;const n=Number(e?.collection?.bitmapNumber);return!Number.isFinite(n)&&!Ht.current.done.has(t)}).map(e=>String(e.inscriptionId).trim());if(0===r.length)return;const i=async e=>{const t=String(e||"").trim();if(!t)return null;const n=Ht.current.done.get(t);if(n)return n;const r=Ht.current.inflight.get(t);if(r)return await r;const i=(async()=>{try{const e=await hv(t);if(e&&Number.isFinite(Number(e?.bitmapNumber))){const t=await async function(e){const t=Number(e);if(!Number.isFinite(t)||t<0)return{isBitmon:!1,pattern:null,key:null};try{const e=await Ax({forceRefresh:!1}),n=e?.patternArray,r=e?.patternObject;if(!Array.isArray(n)||!r)return{isBitmon:!1,pattern:null,key:null};const i=n[t];if(null==i)return{isBitmon:!1,pattern:null,key:null};if(!i)return{isBitmon:!1,pattern:null,key:String(i)};const a=r[i]||r[String(i)]||null;return a&&"string"==typeof a?{isBitmon:!0,pattern:a,key:String(i)}:{isBitmon:!1,pattern:null,key:String(i)}}catch{return{isBitmon:!1,pattern:null,key:null}}}(e.bitmapNumber);return{...e,bitmon:t}}return e||null}catch{return null}})();Ht.current.inflight.set(t,i);const a=await i;return Ht.current.inflight.delete(t),a&&Ht.current.done.set(t,a),a};return(async()=>{let n=0;const a=Array.from({length:Math.min(8,r.length)}).map(async()=>{for(;!e;){const a=n++;if(a>=r.length)return;const o=r[a],s=await i(o);!e&&s&&(Ae(e=>{const n=Array.isArray(e)?e:[];let r=!1;const i=n.map(e=>{if(!e||e.inscriptionId!==o)return e;const t=Number(e?.collection?.bitmapNumber);return Number.isFinite(t)?e:(r=!0,{...e,collection:{...s,key:"bitmap"}})});if(r&&t){const e=String(Be||"");if(e)try{yx(Vt(e),i)}catch{}}return r?i:e}),Me(e=>{const t=e||{},n=String(Be),r=Array.isArray(t?.[n])?t[n]:null;if(!r)return e;let i=!1;const a=r.map(e=>{if(!e||e.inscriptionId!==o)return e;const t=Number(e?.collection?.bitmapNumber);return Number.isFinite(t)?e:(i=!0,{...e,collection:{...s,key:"bitmap"}})});return i?{...t,[n]:a}:e}))}});await Promise.all(a)})(),()=>{e=!0}},[Be,Ke?.key,ke]);const En=()=>it.createElement("div",{className:"flex items-center gap-2"},it.createElement("div",{className:"text-xs sm:text-[11px] text-neutral-500"},"Fee rate"),it.createElement("input",{type:"number",min:0,step:.1,value:null==te?"":te,onChange:e=>ne?.(e.target.value),disabled:"function"!=typeof ne,className:"w-28 sm:w-24 px-2.5 sm:px-2 py-2 sm:py-1 text-sm sm:text-xs bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-sky-500/60 focus:ring-1 focus:ring-sky-500/20 font-mono disabled:opacity-60 disabled:cursor-not-allowed",placeholder:"sat/vB",title:"Network fee rate (sat/vB)"}),it.createElement("div",{className:"text-xs sm:text-[11px] text-neutral-500"},"sat/vB")),In=e=>{const t=Number(e);return!Number.isFinite(t)||t<=0?"Price TBD":`${Cx(Math.trunc(t))} BTC`},kn=e=>{const t=String(e?.revealTxid||"").trim().toLowerCase();if(!/^[0-9a-f]{64}$/.test(t))return!1;const n=(e=>{const t=e?.output||e?.satpoint||e?.location;if(!t||"string"!=typeof t)return null;const n=t.split(":");if(n.length<2)return null;const r=n[0],i=n[1];if(!/^[0-9a-f]{64}$/i.test(r))return null;const a=Number(i);return!Number.isFinite(a)||a<0?null:`${String(r).toLowerCase()}:${Math.floor(a)}`})(e?.inscription);if(!n)return!1;const r=String(n).split(":")[0];return!(!r||r===t)},An=it.useMemo(()=>{const e=(Array.isArray(Oe)?Oe:[]).filter(e=>!!String(e?.indexingAddress||"").trim()),t=e.some(e=>"bitmap"===String(e?.key||"").trim().toLowerCase()),n=e.some(e=>"parcel"===String(e?.key||"").trim().toLowerCase()),r=[...t?[]:[{key:"bitmap",name:"Bitmaps",description:"OCI-verified bitmaps + Bitmon patterns",indexingAddress:qx?.bitmap?.address||null,imageInscriptionId:null}],...n?[]:[{key:"parcel",name:"Bitmap Parcels",description:"Parcel listings by provenance address",indexingAddress:qx?.parcel?.address||null,imageInscriptionId:null}]].filter(e=>!!e.indexingAddress),i={key:"__home",name:"Uncategorized",description:"Listings not in a collection",indexingAddress:jx?.fundingAddress||null,catalogImage:{inscriptionId:ES,contentType:"image/avif"},imageInscriptionId:ES},a=new Map;for(const l of[i,...r,...e]){const e=l?.key?String(l.key):"";e&&(a.has(e)||a.set(e,l))}const o=i,s=Array.from(a.values()).filter(e=>"__home"!==String(e?.key||""));return s.sort((e,t)=>String(e?.name||e?.key||"").localeCompare(String(t?.name||t?.key||""))),[o,...s]},[Oe]),Nn=e=>{const t=String(e||"").trim();if(!t)return"";const n=t.replace(/\s+/g,"");if(!n)return"";const r=n.match(/cHNidP[0-9A-Za-z+/=]+/);if(r&&r[0]&&r[0].length>=16)return r[0];const i=n.match(/70736274ff[0-9a-fA-F]+/);return i&&i[0]&&i[0].length>=16?i[0]:n},Tn=it.useMemo(()=>{const e=String(De||"").trim().toLowerCase(),t=String(We||"name"),n=!!je,r=t=>{if(!e)return!0;const n=String(t?.name||"").toLowerCase(),r=String(t?.key||"").toLowerCase(),i=String(t?.description||"").toLowerCase();return n.includes(e)||r.includes(e)||i.includes(e)},i=e=>{const t=String(e?.key||"").trim(),n="parcel"===t.toLowerCase()?"Bitmap Parcels":String(e?.name||e?.key||"").trim(),r=e?.description?String(e.description):"",i="__home"===t,a=(e=>{const t=String(e||"").trim();if(!t)return{known:!1,count:null,floorSats:null};if(!Object.prototype.hasOwnProperty.call(Ue||{},t))return{known:!1,count:null,floorSats:null};const n=(Array.isArray(Ue?.[t])?Ue[t]:[]).filter(e=>!kn(e));let r=null;for(const i of n){const e=Number(i?.price);!Number.isFinite(e)||e<=0||(null===r||e<r)&&(r=e)}return{known:!0,count:n.length,floorSats:r}})(t),o=a.known?`${a.count} listed`+(null!==a.floorSats?` \u2022 Floor ${Cx(a.floorSats)} BTC`:""):"",{thumbId:s,contentType:l}=(e=>{const t=e?.catalogImage;return{thumbId:"string"==typeof t?String(t).trim():t&&"object"==typeof t?String(t?.inscriptionId||t?.id||t?.inscription_id||"").trim():String(e?.imageInscriptionId||"").trim(),contentType:t&&"object"==typeof t?String(t?.contentType||t?.content_type||"").trim().toLowerCase():String(e?.manifest?.registry_entry?.catalogImage?.contentType||"").trim().toLowerCase()}})(e);return{key:t,title:n,description:r,isCatchAll:i,statsLine:o,thumbId:s,thumbContentType:l,fallbackImageInscriptionId:String(e?.imageInscriptionId||"").trim(),raw:e,__stats:a}},a=[];for(const s of Array.isArray(An)?An:[]){const e=i(s);r(e)&&(n&&e.__stats?.known&&0===e.__stats?.count||a.push(e))}const o=(e,t)=>String(e?.title||e?.key||"").localeCompare(String(t?.title||t?.key||""));return"listingsDesc"===t?a.sort((e,t)=>{const n=e?.__stats?.known?Number(e?.__stats?.count||0):-1,r=t?.__stats?.known?Number(t?.__stats?.count||0):-1;return r!==n?r-n:o(e,t)}):"floorAsc"===t?a.sort((e,t)=>{const n=e?.__stats?.known&&null!==e?.__stats?.floorSats?Number(e.__stats.floorSats):Number.POSITIVE_INFINITY,r=t?.__stats?.known&&null!==t?.__stats?.floorSats?Number(t.__stats.floorSats):Number.POSITIVE_INFINITY;return n!==r?n-r:o(e,t)}):a.sort(o),a},[An,De,We,je,Ue]),_n=it.useCallback(async({forceRefresh:e=!1}={})=>{const t=(Array.isArray(An)?An:[]).filter(t=>{const n=String(t?.key||"").trim();return!(!n||"__home"===n||!String(t?.indexingAddress||"").trim()||!e&&Object.prototype.hasOwnProperty.call(Ue||{},n))}).map(e=>({key:String(e.key),address:String(e.indexingAddress)}));if(0===t.length)return;let n=!1,r=0;const i=async t=>{try{const r=await Qv({address:t.address||void 0,forceRefresh:e});if(n)return;Me(e=>({...e||{},[t.key]:Array.isArray(r)?r:[]}))}catch{}},a=Array.from({length:Math.min(2,t.length)}).map(async()=>{for(;!n;){const e=r++;if(e>=t.length)return;await i(t[e])}});return await Promise.all(a),()=>{n=!0}},[An,Ue]);rt.useEffect(()=>{un&&"home"===Be&&("name"!==We||je)&&_n({forceRefresh:!1})},[un,Be,We,je,_n]);const Pn=(e,t)=>{const n=String(t||"").trim();if(!n)return;const r=n.split(".").filter(Boolean);let i=e;for(const a of r){if(null==i)return;i=i?.[a]}return i},Bn=(e=>{const t="home"!==Be?((e,t)=>{const n=Array.isArray(e)?e:[],r=Array.isArray(t?.filters)?t.filters:[],i=r.length>0?r:"bitmap"===String(t?.key||Be)?[{key:"oci",label:"OCI",type:"boolean",sourcePath:"collection.verified",default:!1},{key:"bitmon",label:"Bitmon",type:"boolean",sourcePath:"collection.bitmon.isBitmon",default:!1}]:[];if(0===i.length)return n;const a=String(t?.key||Be||"").trim(),o=$e&&a&&$e[a]?$e[a]:{},s=i.map(e=>{const t=String(e?.key||"").trim();if(!t)return null;const n=o&&Object.prototype.hasOwnProperty.call(o,t)?o[t]:e?.default;return{...e,_value:n}}).filter(Boolean);return n.filter(e=>{for(const t of s){const n=String(t?.type||"").trim(),r=t?._value,i=t?.sourcePath;if(!i)continue;const a=Pn(e,i);if("boolean"!==n){if("rangeMin"===n){const e=Number(r);if(!Number.isFinite(e))continue;const t=Number(a);if(!Number.isFinite(t))return!1;if(t<e)return!1;continue}if("rangeMax"===n){const e=Number(r);if(!Number.isFinite(e))continue;const t=Number(a);if(!Number.isFinite(t))return!1;if(t>e)return!1;continue}if("enum"!==n);else{if(null==r||""===String(r))continue;if(a!==r)return!1}}else if(!0===r&&!a)return!1}return!0})})(e,Ke):Array.isArray(e)?e:[];return(Array.isArray(t)?t:[]).filter(e=>!kn(e)).slice().sort((e,t)=>{const n=Number(e?.listedAt||0);return Number(t?.listedAt||0)-n})})(ke);rt.useEffect(()=>{let e=!1;if("marketplace"!==de)return()=>{e=!0};const{idbPageKey:t,cacheKey:r}=qt(Be),i=e=>e&&"object"==typeof e&&Object.prototype.hasOwnProperty.call(e,"meta")?{meta:e.meta,ts:Number(e.ts||0)}:{meta:e,ts:0},a=(Array.isArray(ke)?ke:[]).filter(e=>{const t=String(e?.revealTxid||"").trim().toLowerCase();if(!/^[0-9a-f]{64}$/.test(t))return!1;const n=Number(e?.price);if(Number.isFinite(n)&&n>0)return!1;if(Dt.current.done.has(t)){const{meta:e,ts:n}=i(Dt.current.done.get(t));if(null!=e)return!1;if(n&&Date.now()-n<9e4)return!1}return!0}).slice(0,80).map(e=>String(e.revealTxid).trim().toLowerCase());if(0===a.length)return()=>{e=!0};const o=async e=>{const t=String(e||"").trim().toLowerCase();if(!/^[0-9a-f]{64}$/.test(t))return null;const r=Dt.current.done.get(t);if(void 0!==r){const{meta:e,ts:t}=i(r);if(null!=e)return e;if(t&&Date.now()-t<9e4)return null}const a=Dt.current.inflight.get(t);if(a)return await a;const o="undefined"!=typeof window&&window.__NEXUS_NETWORK__?String(window.__NEXUS_NETWORK__).toLowerCase():"mainnet";try{const e=await wx(jt(o,t),{maxAgeMs:864e5});if(e&&"object"==typeof e){const n=Date.now();return Dt.current.done.set(t,{meta:e,ts:n}),e}}catch{}const s=(async()=>{try{const{ensureBufferPolyfill:e}=await n(async()=>{const{ensureBufferPolyfill:e}=await Promise.resolve().then(()=>ag);return{ensureBufferPolyfill:e}},__VITE_PRELOAD__);await e();const{loadBitcoinLibFromInscription:r}=await n(async()=>{const{loadBitcoinLibFromInscription:e}=await Promise.resolve().then(()=>yg);return{loadBitcoinLibFromInscription:e}},__VITE_PRELOAD__),i=await r(),{fetchTxHexViaProxy:a}=await n(async()=>{const{fetchTxHexViaProxy:e}=await Promise.resolve().then(()=>ab);return{fetchTxHexViaProxy:e}},__VITE_PRELOAD__),s=await a(t,o),l=!!(s&&"string"==typeof s&&s.length>100);try{const{extractOodlListingMetadataFromRevealTxWithBitcoinLib:e}=await n(async()=>{const{extractOodlListingMetadataFromRevealTxWithBitcoinLib:e}=await Promise.resolve().then(()=>tw);return{extractOodlListingMetadataFromRevealTxWithBitcoinLib:e}},__VITE_PRELOAD__),t=await e(i,s);if(t&&"object"==typeof t)return{...t,__ts:Date.now()}}catch{}return{__meta:null,__gotTxHex:l}}catch{return{__meta:null,__gotTxHex:!1}}})();Dt.current.inflight.set(t,s);const l=await s;Dt.current.inflight.delete(t);const c=l&&"object"==typeof l&&"__meta"in l?l.__meta:l,u=l&&"object"==typeof l&&!0===l.__gotTxHex,d=Date.now();if(null!=c){Dt.current.done.set(t,{meta:c,ts:d});try{yx(jt(o,t),c)}catch{}}else u&&Dt.current.done.set(t,{meta:null,ts:d});return c},s=e=>{if(null==e)return null;try{const t="bigint"==typeof e?e:BigInt(String(e));if(t<=0n)return null;const n=Number(t);return!Number.isFinite(n)||n<=0||t>BigInt(Number.MAX_SAFE_INTEGER)?null:Math.trunc(n)}catch{const t=Number(e);return!Number.isFinite(t)||t<=0?null:Math.trunc(t)}};return(async()=>{let n=0;const i=Array.from({length:Math.min(4,a.length)}).map(async()=>{for(;!e;){const i=n++;if(i>=a.length)return;const l=a[i],c=await o(l);if(e||!c)continue;const u=s(c?.priceSats),d=(()=>{const e=Number(c?.minBlockHeight);return Number.isFinite(e)&&e>=0?Math.trunc(e):null})(),f=(()=>{const e=Number(c?.bitmapNumber);return Number.isFinite(e)&&e>=0?Math.trunc(e):null})(),p=(()=>{const e=Number(c?.parcelNumber);return Number.isFinite(e)&&e>=0?Math.trunc(e):null})();if(!u&&null===d&&null===f&&null===p)continue;const m=e=>{if(String(e?.revealTxid||"").trim().toLowerCase()!==l)return e;const t=Number(e?.price),n={...e||{}};if(!(Number.isFinite(t)&&t>0)&&u){n.price=u;const e=Number(c?.__ts||c?.ts||c?.decodedAt||0);Number.isFinite(e)&&e>0?n.priceAsOf=Math.trunc(e):n.priceAsOf=Date.now()}return void 0===n.minBlockHeight&&null!==d&&(n.minBlockHeight=d),null===n.bitmapNumberHint&&null!==f&&(n.bitmapNumberHint=f),null===n.parcelNumberHint&&null!==p&&(n.parcelNumberHint=p),n};Ae(e=>{const n=Array.isArray(e)?e:[];let i=!1;const a=n.map(e=>{const t=m(e);return t!==e&&(i=!0),t});if(i){try{yx(Vt(t),a)}catch{}Me(e=>{const t=e||{},n=Array.isArray(t?.[r])?t[r]:null;if(!n)return e;let i=!1;const a=n.map(e=>{const t=m(e);return t!==e&&(i=!0),t});return i?{...t,[r]:a}:e})}return i?a:e})}});await Promise.all(i)})(),()=>{e=!0}},[de,Be,ke]);const Cn=async()=>{Xe(null),Ye(!1),Ce("home"),bt(null),Ae([]);const e=Ue?.[qt("home").cacheKey];Array.isArray(e)&&e.length>0?Ae(e):await Sn({forceRefresh:!1,page:"home"})},On=(()=>{const e=[];if(un&&(e.push({label:"Marketplace",action:()=>Cn()}),"home"!==Be)){const t=Ke?.title||Ke?.key||Be;null!==yt?(e.push({label:t,action:()=>bt(null)}),e.push({label:`${yt}.bitmap`,action:null})):e.push({label:t,action:null})}return e})(),Ln=(()=>{const e=ht.current;if(!e||"marketplace"!==e.from)return[];const t=String(e?.marketplacePage||"home"),n=e?.selectedMarketplaceCollection||null,r=n?.title||n?.name||n?.key||("home"!==t?t:"Marketplace"),i=[];return i.push({label:"Home",action:()=>{gt.current={marketplacePage:"home",selectedMarketplaceCollection:null,parcelMarketplaceBitmapNumber:null},fe("marketplace")}}),"home"!==t&&i.push({label:String(r),action:()=>{gt.current={marketplacePage:t,selectedMarketplaceCollection:n,parcelMarketplaceBitmapNumber:e?.parcelMarketplaceBitmapNumber??null},fe("marketplace")}}),i.push({label:"Buy",action:null}),i})();return it.createElement("div",{className:"flex flex-col gap-4 flex-1 min-h-0"},un&&"home"===Be?it.createElement("div",{role:"search",className:"sticky top-0 z-[100] rounded-2xl border border-white/[0.06] bg-gradient-to-b from-neutral-900/95 to-neutral-900/80 backdrop-blur-xl shadow-[0_8px_30px_rgba(0,0,0,0.35)] ring-1 ring-white/[0.04]"},it.createElement("div",{className:"p-3 sm:p-4"},it.createElement("div",{className:"relative group/search"},it.createElement("label",{className:"sr-only",htmlFor:"marketplace-collection-search"},"Search collections"),it.createElement("svg",{className:"pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-neutral-500 group-focus-within/search:text-purple-400 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2},it.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})),it.createElement("input",{id:"marketplace-collection-search",type:"search",enterKeyHint:"search",value:De,onChange:e=>ze(e.target.value),className:"w-full h-11 pl-10 pr-9 text-sm rounded-xl bg-neutral-950/50 border border-white/[0.06] text-neutral-100 placeholder:text-neutral-500 outline-none focus:border-purple-500/40 focus:ring-2 focus:ring-purple-500/20 transition touch-manipulation",placeholder:"Search collections\u2026",spellCheck:!1,autoComplete:"off"}),De&&it.createElement("button",{type:"button",onClick:()=>ze(""),className:"absolute right-2.5 top-1/2 -translate-y-1/2 w-5 h-5 grid place-items-center rounded-full text-neutral-500 hover:text-neutral-200 hover:bg-neutral-800/60 transition-colors touch-manipulation",title:"Clear search"},it.createElement("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5},it.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})))),it.createElement("div",{className:"mt-3 flex flex-wrap items-center gap-2 sm:gap-2.5"},it.createElement("div",{className:"relative"},it.createElement("svg",{className:"pointer-events-none absolute left-2.5 top-1/2 -translate-y-1/2 w-3 h-3 text-neutral-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2},it.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12"})),it.createElement("select",{value:We,onChange:e=>Ve(e.target.value),className:"h-9 pl-7 pr-3 text-xs rounded-xl bg-neutral-950/50 border border-white/[0.06] text-neutral-300 outline-none focus:border-purple-500/40 focus:ring-2 focus:ring-purple-500/20 transition appearance-none touch-manipulation cursor-pointer",title:"Sort collections"},it.createElement("option",{value:"name"},"A \u2192 Z"),it.createElement("option",{value:"listingsDesc"},"Most listed"),it.createElement("option",{value:"floorAsc"},"Lowest floor"))),it.createElement("button",{type:"button",onClick:()=>qe(!je),className:"h-9 px-3 text-xs rounded-xl border transition-all active:scale-[0.97] touch-manipulation select-none flex items-center gap-1.5 "+(je?"bg-purple-500/15 border-purple-500/25 text-purple-300 shadow-[inset_0_1px_0_rgba(168,85,247,0.1)]":"bg-neutral-950/40 border-white/[0.06] text-neutral-400 hover:text-neutral-200 hover:border-white/10")},je?it.createElement("svg",{className:"w-3 h-3 shrink-0",fill:"currentColor",viewBox:"0 0 20 20"},it.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})):it.createElement("svg",{className:"w-3 h-3 shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2},it.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L6.5 6.5m3.378 3.378L6.5 6.5m0 0L3 3m3.5 3.5l10 10M17.5 17.5L21 21"})),it.createElement("span",null,je?"Active only":"Hide empty")),it.createElement("div",{className:"flex-1"}),it.createElement("span",{className:"px-2.5 py-1 text-[11px] font-medium tabular-nums rounded-full bg-white/[0.04] text-neutral-400 ring-1 ring-white/[0.06] shrink-0"},Tn.length," ",1===Tn.length?"collection":"collections")))):null,un&&"home"!==Be&&null!==yt||cn||ln?it.createElement("div",{className:"sticky top-0 z-[100] bg-neutral-900/95 backdrop-blur-sm border border-neutral-800/60 rounded-xl px-3 sm:px-6 py-2.5 sm:py-3"},it.createElement("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0"},un&&"home"!==Be&&null!==yt&&On.length>1?it.createElement("nav",{className:"flex items-center gap-1 min-w-0 text-xs sm:text-sm overflow-hidden","aria-label":"Breadcrumb"},On.map((e,t)=>it.createElement(it.Fragment,{key:t},t>0&&it.createElement("span",{className:"text-neutral-600 shrink-0"},"/"),e.action?it.createElement("button",{onClick:e.action,className:"min-h-[44px] flex items-center text-neutral-400 hover:text-purple-300 active:text-purple-300 transition-colors truncate shrink-0 touch-manipulation",title:e.label},e.label):it.createElement("span",{className:"text-neutral-200 font-semibold truncate min-w-0",title:e.label},e.label)))):null,!un&&(cn||ln)&&"buy"===pe&&Ln.length>1?it.createElement("nav",{className:"flex items-center gap-1 min-w-0 text-xs sm:text-sm overflow-hidden","aria-label":"Breadcrumb"},Ln.map((e,t)=>it.createElement(it.Fragment,{key:t},t>0&&it.createElement("span",{className:"text-neutral-600 shrink-0"},"/"),e.action?it.createElement("button",{onClick:e.action,className:"min-h-[44px] flex items-center text-neutral-400 hover:text-purple-300 active:text-purple-300 transition-colors truncate shrink-0 touch-manipulation",title:e.label},e.label):it.createElement("span",{className:"text-neutral-200 font-semibold truncate min-w-0",title:e.label},e.label)))):null,cn||ln?it.createElement("button",{onClick:()=>{const e=ht.current;if("buy"===pe&&e&&"marketplace"===e.from)return gt.current={marketplacePage:String(e?.marketplacePage||"home"),selectedMarketplaceCollection:e?.selectedMarketplaceCollection||null,parcelMarketplaceBitmapNumber:e?.parcelMarketplaceBitmapNumber??null},void fe("marketplace");fe("hub")},className:"min-h-[44px] flex items-center text-xs sm:text-sm text-neutral-400 hover:text-purple-300 active:text-purple-300 transition-colors shrink-0 touch-manipulation select-none"},"\u2190 Back"):null,it.createElement("div",{className:"flex-1 min-w-0"}))):null,it.createElement("div",{className:"px-2 sm:px-4 pb-4"},dn&&it.createElement("div",{className:"flex flex-col gap-6 sm:gap-8 max-w-3xl mx-auto"},it.createElement("section",null,it.createElement("div",{className:"mb-3 px-1"},it.createElement("h3",{className:"text-[11px] font-semibold uppercase tracking-widest text-neutral-500"},"Collections")),it.createElement("button",{onClick:()=>{fe("oodl"),me("collection")},className:"group w-full text-left rounded-2xl bg-neutral-900/60 border border-neutral-800/60 hover:border-purple-500/30 transition-all duration-200 overflow-hidden focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-purple-500/40"},it.createElement("div",{className:"flex items-center gap-4 p-5 sm:p-6"},it.createElement("div",{className:"h-12 w-12 rounded-2xl grid place-items-center bg-gradient-to-br from-purple-500/15 to-purple-600/5 border border-purple-500/20 shrink-0"},it.createElement("svg",{className:"w-6 h-6 text-purple-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5},it.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 6.878V6a2.25 2.25 0 0 1 2.25-2.25h7.5A2.25 2.25 0 0 1 18 6v.878m-12 0c.235-.083.487-.128.75-.128h10.5c.263 0 .515.045.75.128m-12 0A2.25 2.25 0 0 0 4.5 9v.878m13.5-3A2.25 2.25 0 0 1 19.5 9v.878m-15 0A2.242 2.242 0 0 0 3 11.25v1.5c0 .621.504 1.125 1.125 1.125h15.75c.621 0 1.125-.504 1.125-1.125v-1.5A2.242 2.242 0 0 0 19.5 9.878m-15 0h15"}))),it.createElement("div",{className:"min-w-0 flex-1"},it.createElement("div",{className:"text-[15px] font-semibold text-neutral-100 group-hover:text-purple-200 transition-colors"},"List Collection"),it.createElement("p",{className:"text-[13px] text-neutral-400 mt-0.5 leading-relaxed"},"Publish a collection manifest on-chain \u2014 parent-child, wallet, gallery, or parcels.")),it.createElement("svg",{className:"w-5 h-5 text-neutral-600 group-hover:text-purple-400 transition-colors shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2},it.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"}))))),it.createElement("section",null,it.createElement("div",{className:"mb-3 px-1"},it.createElement("h3",{className:"text-[11px] font-semibold uppercase tracking-widest text-neutral-500"},"Sell & Buy")),it.createElement("div",{className:"rounded-2xl bg-neutral-900/60 border border-neutral-800/60 overflow-hidden divide-y divide-neutral-800/40"},it.createElement("button",{onClick:()=>{fe("oodl"),me("sell")},className:"group w-full text-left flex items-center gap-4 p-5 sm:p-6 hover:bg-neutral-800/30 transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-purple-500/40 focus-visible:ring-inset","aria-label":"Sell an inscription"},it.createElement("div",{className:"h-12 w-12 rounded-2xl grid place-items-center bg-gradient-to-br from-fuchsia-500/15 to-pink-500/5 border border-fuchsia-500/20 shrink-0"},it.createElement("svg",{className:"w-6 h-6 text-fuchsia-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5},it.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.568 3H5.25A2.25 2.25 0 0 0 3 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 0 0 5.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 0 0 9.568 3Z"}),it.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 6h.008v.008H6V6Z"}))),it.createElement("div",{className:"min-w-0 flex-1"},it.createElement("div",{className:"text-[15px] font-semibold text-neutral-100 group-hover:text-fuchsia-200 transition-colors"},"Sell"),it.createElement("p",{className:"text-[13px] text-neutral-400 mt-0.5 leading-relaxed"},"Create a marketplace listing for an inscription you own.")),it.createElement("svg",{className:"w-5 h-5 text-neutral-600 group-hover:text-fuchsia-400 transition-colors shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2},it.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"}))),it.createElement("button",{onClick:()=>{ht.current=null,fe("oodl"),me("buy")},className:"group w-full text-left flex items-center gap-4 p-5 sm:p-6 hover:bg-neutral-800/30 transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500/40 focus-visible:ring-inset","aria-label":"Buy an inscription"},it.createElement("div",{className:"h-12 w-12 rounded-2xl grid place-items-center bg-gradient-to-br from-sky-500/15 to-cyan-500/5 border border-sky-500/20 shrink-0"},it.createElement("svg",{className:"w-6 h-6 text-sky-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5},it.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 0 0-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 0 0-16.536-1.84M7.5 14.25 5.106 5.272M6 20.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Zm12.75 0a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z"}))),it.createElement("div",{className:"min-w-0 flex-1"},it.createElement("div",{className:"text-[15px] font-semibold text-neutral-100 group-hover:text-sky-200 transition-colors"},"Buy"),it.createElement("p",{className:"text-[13px] text-neutral-400 mt-0.5 leading-relaxed"},"Purchase a listed inscription by entering its reveal txid or inscription id.")),it.createElement("svg",{className:"w-5 h-5 text-neutral-600 group-hover:text-sky-400 transition-colors shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2},it.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"}))))),it.createElement("section",null,it.createElement("div",{className:"mb-3 px-1"},it.createElement("h3",{className:"text-[11px] font-semibold uppercase tracking-widest text-neutral-500"},"Direct Offers")),it.createElement("div",{className:"rounded-2xl bg-neutral-900/60 border border-neutral-800/60 overflow-hidden divide-y divide-neutral-800/40"},it.createElement("button",{onClick:()=>{fe("offer"),me("sell")},className:"group w-full text-left flex items-center gap-4 p-5 sm:p-6 hover:bg-neutral-800/30 transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-500/40 focus-visible:ring-inset","aria-label":"Create a seller offer"},it.createElement("div",{className:"h-12 w-12 rounded-2xl grid place-items-center bg-gradient-to-br from-amber-500/15 to-orange-500/5 border border-amber-500/20 shrink-0"},it.createElement("svg",{className:"w-6 h-6 text-amber-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5},it.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))),it.createElement("div",{className:"min-w-0 flex-1"},it.createElement("div",{className:"text-[15px] font-semibold text-neutral-100 group-hover:text-amber-200 transition-colors"},"Create Offer"),it.createElement("p",{className:"text-[13px] text-neutral-400 mt-0.5 leading-relaxed"},"Generate a seller offer PSBT to share directly with a buyer.")),it.createElement("svg",{className:"w-5 h-5 text-neutral-600 group-hover:text-amber-400 transition-colors shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2},it.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"}))),it.createElement("button",{onClick:()=>{fe("offer"),me("buy")},className:"group w-full text-left flex items-center gap-4 p-5 sm:p-6 hover:bg-neutral-800/30 transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500/40 focus-visible:ring-inset","aria-label":"Accept a seller offer"},it.createElement("div",{className:"h-12 w-12 rounded-2xl grid place-items-center bg-gradient-to-br from-emerald-500/15 to-teal-500/5 border border-emerald-500/20 shrink-0"},it.createElement("svg",{className:"w-6 h-6 text-emerald-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5},it.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 3.75H6.912a2.25 2.25 0 0 0-2.15 1.588L2.35 13.177a2.25 2.25 0 0 0-.1.661V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18v-4.162c0-.224-.034-.447-.1-.661L19.24 5.338a2.25 2.25 0 0 0-2.15-1.588H15M2.25 13.5h3.86a2.25 2.25 0 0 1 2.012 1.244l.256.512a2.25 2.25 0 0 0 2.013 1.244h3.218a2.25 2.25 0 0 0 2.013-1.244l.256-.512a2.25 2.25 0 0 1 2.013-1.244h3.859M12 3v8.25m0 0-3-3m3 3 3-3"}))),it.createElement("div",{className:"min-w-0 flex-1"},it.createElement("div",{className:"text-[15px] font-semibold text-neutral-100 group-hover:text-emerald-200 transition-colors"},"Accept Offer"),it.createElement("p",{className:"text-[13px] text-neutral-400 mt-0.5 leading-relaxed"},"Complete a purchase from a pasted seller offer PSBT.")),it.createElement("svg",{className:"w-5 h-5 text-neutral-600 group-hover:text-emerald-400 transition-colors shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2},it.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})))))),un&&it.createElement("div",{className:"flex flex-col gap-4"},_e&&"home"!==Be&&it.createElement("div",{className:"text-xs text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2"},_e),(()=>{const e=tn(Ke?.key||Be),t="home"!==Be;if(t&&Ne&&!(Array.isArray(ke)&&ke.length>0))return it.createElement("div",{className:"flex flex-col gap-4"},!(null!==yt&&nn(Ke?.key||Be))&&it.createElement(SS,{collection:Ke,listingsCount:0,floorPriceSats:null,isLoading:!0,isSubscribed:(()=>{const e=String(Ke?.key||Be||"").trim().toLowerCase();return e&&"home"!==e&&Gt.has(e)})(),onBack:Cn,onRefresh:()=>Sn({forceRefresh:!0,page:Be,collection:Ke}),onShowDetails:()=>Ye(!0),onToggleSubscribe:()=>{const e=String(Ke?.key||Be||"").trim().toLowerCase();e&&"home"!==e&&(Gt.has(e)?Zt(e):Qt(e))}}),it.createElement("div",{className:"flex items-center justify-center py-12"},it.createElement("div",{className:"flex items-center gap-3 text-neutral-400 text-sm"},it.createElement("svg",{className:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24"},it.createElement("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),it.createElement("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})),"Loading listings\u2026")));const r=e=>{ht.current={from:"marketplace",marketplacePage:Be,selectedMarketplaceCollection:Ke,parcelMarketplaceBitmapNumber:yt};const t=(()=>{const t=Number(e?.price);return!Number.isFinite(t)||t<=0?null:Math.trunc(t)})(),n=String(e?.sellerOfferPsbt||"").trim(),r=String(e?.inscriptionId||"").trim();if(n)return Qe(t),et(e?.inscription||null),nt(e?.collection||null),ot(""),ge(n),be(!0),fe("offer"),void me("buy");const i=r||e?.revealTxid;P&&i&&P(i),ot(i?String(i):""),Qe(t),et(e?.inscription||null),nt(e?.collection||null),fe("oodl"),me("buy")},i=async(e,t)=>{t?.stopPropagation?.();try{const t=String(e?.sellerOfferPsbt||"").trim();if(t)return Lt("Listing offer PSBT"),void Ct(t);const r=String(e?.revealTxid||"").trim();if(!/^[0-9a-f]{64}$/i.test(r))throw new Error("Listing has no reveal txid / offer PSBT yet");Lt("Loading listing PSBT\u2026"),Ct(null);const i=await n(()=>Promise.resolve().then(()=>Ow),__VITE_PRELOAD__),a=await i.getSellerOfferPsbtBase64FromRevealTxid(r);Lt(`Listing offer PSBT (${r.slice(0,10)}\u2026)`),Ct(a)}catch(uC){String(uC?.message||uC||"Failed to extract listing PSBT"),Lt("Failed to load listing PSBT"),Ct("")}};return it.createElement("div",{className:"flex flex-col gap-4"},t?it.createElement(it.Fragment,null,!(null!==yt&&nn(Ke?.key||Be))&&it.createElement(SS,{collection:Ke,listingsCount:Bn.length,floorPriceSats:(()=>{const e=Bn.map(e=>Number(e?.price)).filter(e=>Number.isFinite(e)&&e>0);return e.length>0?Math.min(...e):null})(),isLoading:Ne,isSubscribed:(()=>{const e=String(Ke?.key||Be||"").trim().toLowerCase();return e&&"home"!==e&&Gt.has(e)})(),onBack:Cn,onRefresh:()=>Sn({forceRefresh:!0,page:Be,collection:Ke}),onShowDetails:()=>Ye(!0),onToggleSubscribe:()=>{const e=String(Ke?.key||Be||"").trim().toLowerCase();e&&"home"!==e&&(Gt.has(e)?Zt(e):Qt(e))},onClearCache:async()=>{if(!Yt&&("undefined"==typeof window||"function"!=typeof window.confirm||window.confirm("Clear local marketplace cache? This removes cached listings + decoded prices on this site (IndexedDB)."))){Jt(!0);try{try{await bx("oodl:listings:")}catch{}try{await bx("oodl:listing-meta:")}catch{}try{Dt.current?.done?.clear?.(),Dt.current?.inflight?.clear?.()}catch{}Me({}),await Sn({forceRefresh:!0,page:Be,collection:Ke})}finally{Jt(!1)}}},isClearingCache:Yt}),(()=>{if(null!==yt&&nn(Ke?.key||Be))return null;const e=(()=>{const e=Ke,n=Array.isArray(e?.filters)?e.filters:[];if(tn(e?.key||Be)||nn(e?.key||Be))return null;const r=n.length>0?n:tn(e?.key||Be)?[{key:"oci",label:"OCI",type:"boolean",sourcePath:"collection.verified",default:!1},{key:"bitmon",label:"Bitmon",type:"boolean",sourcePath:"collection.bitmon.isBitmon",default:!1}]:[];if(!t||!e?.key||0===r.length)return null;const i=String(e.key),a=$e&&$e[i]?$e[i]:{},o=(e,t)=>{He(n=>{const r={...n||{}};return r[i]={...r[i]||{},[e]:t},r})};return it.createElement("div",{className:"flex items-center gap-x-3 min-w-0 overflow-x-auto"},it.createElement("div",{className:"text-[10px] font-semibold uppercase tracking-wider text-neutral-400 whitespace-nowrap shrink-0 px-2 py-1 rounded-md bg-neutral-950/30 border border-neutral-800/60"},"Filters"),it.createElement("div",{className:"flex items-center gap-x-3 min-w-max"},r.slice(0,4).map(e=>{const t=String(e?.key||"").trim();if(!t)return null;const n=String(e?.label||t),r=String(e?.type||"boolean"),i=Object.prototype.hasOwnProperty.call(a,t)?a[t]:e?.default;if("boolean"===r)return it.createElement("label",{key:t,className:"flex items-center gap-1.5 text-[11px] text-neutral-300 select-none whitespace-nowrap shrink-0"},it.createElement("input",{type:"checkbox",checked:!0===i,onChange:e=>o(t,!!e.target.checked),className:"accent-purple-500"}),it.createElement("span",{className:"whitespace-nowrap"},n));if("rangeMin"===r||"rangeMax"===r)return it.createElement("label",{key:t,className:"flex items-center gap-1.5 text-[11px] text-neutral-300 select-none whitespace-nowrap shrink-0"},it.createElement("span",{className:"whitespace-nowrap"},n),it.createElement("input",{type:"number",value:null==i?"":i,onChange:e=>{const n=e.target.value;o(t,""===n?null:Number(n))},className:"w-24 px-2 py-1 text-xs bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-sky-500/60 focus:ring-1 focus:ring-sky-500/20 font-mono"}));if("enum"===r){const r=Array.isArray(e?.options)?e.options:[];return it.createElement("label",{key:t,className:"flex items-center gap-1.5 text-[11px] text-neutral-300 select-none whitespace-nowrap shrink-0"},it.createElement("span",{className:"whitespace-nowrap"},n),it.createElement("select",{value:null==i?"":String(i),onChange:e=>o(t,e.target.value),className:"px-2 py-1 text-xs bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-sky-500/60 focus:ring-1 focus:ring-sky-500/20"},it.createElement("option",{value:""},"All"),r.map((e,t)=>it.createElement("option",{key:t,value:String(e?.value)},String(e?.label||e?.value)))))}return null})))})();return e?it.createElement("div",{className:"bg-neutral-900/40 border border-neutral-800/60 rounded-xl px-3 py-2"},e):null})(),(()=>{const t=Bn;if(!Array.isArray(t)||0===t.length)return it.createElement("div",{className:"text-xs text-neutral-500"},"No listings found.");const n="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2";if(e)return it.createElement("div",{className:n},t.map(e=>it.createElement(zx,{key:e.inscriptionId,listing:e,onSelect:()=>r(e),onShowQr:t=>i(e,t),formatPrice:In})));if(nn(Ke?.key||Be)){const e=e=>{const t=e?.collection||null;if("parcel"!==String(t?.key||"").trim().toLowerCase())return null;const n=(()=>{const e=Number(t?.bitmapNumber);return Number.isFinite(e)?Math.trunc(e):null})(),r=(()=>{const e=Number(t?.parcelNumber);return Number.isFinite(e)?Math.trunc(e):null})(),i=(()=>{const t=Number(e?.price);return!Number.isFinite(t)||t<=0?null:Math.trunc(t)})();return Number.isFinite(n)&&null!==n&&Number.isFinite(r)&&null!==r?{bitmapNumber:n,parcelNumber:r,price:i,listing:e}:null},n=t.map(e).filter(Boolean);if(0===n.length){const e=Array.isArray(t)?t.length:0;return Ne?it.createElement("div",{className:"text-xs text-neutral-400"},"Loading parcel listings\u2026"):0===e?it.createElement("div",{className:"text-xs text-neutral-500"},"No parcels found."):it.createElement("div",{className:"text-xs text-neutral-500"},"No parcel listings found.")}const i=new Map;for(const t of n){const e=t.bitmapNumber,n=i.get(e)||[];n.push(t),i.set(e,n)}const a=Array.from(i.keys()).sort((e,t)=>e-t),o=e=>{const t=(i.get(e)||[]).slice().sort((e,t)=>{const n=e.parcelNumber,r=t.parcelNumber;return n!==r?n-r:(null===e.price?Number.POSITIVE_INFINITY:e.price)-(null===t.price?Number.POSITIVE_INFINITY:t.price)}),n=new Map;for(const i of t){const e=i.parcelNumber;if(!Number.isFinite(e)||e<0)continue;const t=n.get(e),r=null===i.price?Number.POSITIVE_INFINITY:i.price,a=t?null===t.price?Number.POSITIVE_INFINITY:t.price:Number.POSITIVE_INFINITY;(!t||r<a)&&n.set(e,i)}const r=Array.from(n.keys()).sort((e,t)=>e-t);return{bitmapNumber:e,items:t,cheapestByParcel:n,highlight:r}};if(null!==yt){const e=Number(yt);if(!Number.isFinite(e)||!i.has(Math.trunc(e)))return it.createElement("div",{className:"flex flex-col gap-3"},it.createElement("div",{className:"text-xs text-neutral-500"},"Selected bitmap not found in current listings."));const t=o(Math.trunc(e)),n=t.bitmapNumber,a=t.items,s=t.cheapestByParcel,l=t.highlight,c=vt,u=(()=>{if(c){const e=c?.collection||null,t=Number(e?.parcelNumber);if(Number.isFinite(t))return Math.trunc(t)}const e=Number(wt);return Number.isFinite(e)?Math.trunc(e):null})();return it.createElement("div",{className:"flex flex-col gap-2"},it.createElement("div",{className:"flex flex-wrap items-center justify-between gap-x-3 gap-y-2"},it.createElement("div",{className:"flex items-center gap-2"},it.createElement("button",{type:"button",onClick:()=>bt(null),className:"px-3 py-1.5 text-xs font-semibold rounded-lg bg-neutral-950/30 text-neutral-200 border border-neutral-800/60 hover:border-sky-500/25",title:"Back to bitmap list"},"Back"),it.createElement("div",{className:"text-xs text-neutral-400 whitespace-nowrap"},it.createElement("span",{className:"font-semibold text-neutral-200"},n,".bitmap")," \u2022 ",l.length," parcels listed")),it.createElement("div",{className:"flex items-center gap-2"},it.createElement("div",{className:"text-[11px] text-neutral-500 whitespace-nowrap"},"Click a ",it.createElement("span",{className:"text-neutral-200"},"green")," parcel to select."),it.createElement("button",{type:"button",disabled:!c,onClick:()=>c&&r(c),className:"px-3 py-1.5 text-xs font-semibold rounded-lg border transition "+(c?"bg-green-500/20 border-green-500/40 text-green-200 hover:bg-green-500/25":"bg-neutral-950/20 border-neutral-800/60 text-neutral-500 cursor-not-allowed"),title:c?"Continue to checkout":"Select a parcel first"},"Continue"))),it.createElement("div",{className:"bg-neutral-900/40 border border-neutral-800/60 rounded-xl p-3"},it.createElement("div",{className:"grid grid-cols-1 md:grid-cols-[minmax(260px,520px)_1fr] gap-3 items-start",style:{"--parcel-bitmap-size":"max(220px, min(520px, calc(100svh - 340px)))"}},it.createElement("div",{className:"w-full flex justify-center"},it.createElement("div",{className:"bg-black",style:{width:"min(100%, var(--parcel-bitmap-size))",maxWidth:"var(--parcel-bitmap-size)",aspectRatio:"1 / 1"}},it.createElement("div",{className:"w-full h-full p-1"},it.createElement("div",{className:"w-full h-full rounded bg-black overflow-hidden"},it.createElement(Px,{blockNumber:n,highlightParcels:l,highlightColor:"rgb(34 197 94)",selectedParcels:null===u?[]:[u],selectedColor:"rgb(34 211 238)",size:"auto",className:"w-full h-full",onParcelClick:e=>{const t=s.get(e);t?.listing&&(xt(e),St(t.listing))}}))))),it.createElement("div",{className:"flex flex-col gap-2 min-h-0 w-full max-w-[560px] mx-auto",style:{maxHeight:"var(--parcel-bitmap-size)"}},c?it.createElement("div",{className:"bg-neutral-950/40 border border-neutral-800/60 rounded-xl p-3"},it.createElement("div",{className:"flex items-start justify-between gap-3"},it.createElement("div",{className:"min-w-0"},it.createElement("div",{className:"text-[11px] font-semibold text-neutral-200"},"Selected parcel"),it.createElement("div",{className:"mt-1 text-[11px] text-neutral-400"},it.createElement("span",{className:"font-mono text-sm sm:text-base font-semibold text-cyan-200 break-all"},null===u?"\u2014":`${u}.${n}.bitmap`)),it.createElement("div",{className:"mt-1 text-[11px] text-neutral-400"},"Expected text: ",it.createElement("span",{className:"font-mono text-neutral-200"},null===u?"\u2014":`${u}.${n}.bitmap`)),it.createElement("div",{className:"mt-1 text-[11px] text-neutral-500 font-mono break-all"},String(c?.inscriptionId||"").trim()?`insc ${String(c.inscriptionId).trim()}`:"insc \u2014")),it.createElement("div",{className:"shrink-0 text-right"},it.createElement("div",{className:"text-[10px] uppercase tracking-wider text-neutral-500"},"Price"),it.createElement("div",{className:"text-lg sm:text-xl font-extrabold tracking-tight text-amber-300 drop-shadow-[0_0_10px_rgba(251,191,36,0.18)]"},(()=>{const e=Number(c?.price);return!Number.isFinite(e)||e<=0?"Price TBD":In(Math.trunc(e))})()))),it.createElement("div",{className:"mt-2 flex items-center gap-2"},it.createElement("button",{type:"button",onClick:()=>r(c),className:"px-3 py-1.5 text-xs font-semibold rounded-lg bg-green-500/20 border border-green-500/40 text-green-200 hover:bg-green-500/25"},"Continue to checkout"),it.createElement("button",{type:"button",onClick:()=>{xt(null),St(null)},className:"px-3 py-1.5 text-xs font-semibold rounded-lg bg-neutral-950/20 border border-neutral-800/60 text-neutral-200 hover:border-sky-500/25"},"Clear"))):null,it.createElement("div",{className:"text-xs font-semibold text-neutral-200"},"For sale"),it.createElement("div",{className:"flex-1 min-h-0 overflow-auto border border-neutral-800/60 rounded-lg"},a.map(e=>it.createElement("button",{key:`${n}:${e.parcelNumber}:${e.listing?.inscriptionId||""}`,onClick:()=>{xt(e.parcelNumber),St(e.listing)},className:"w-full flex items-center justify-between gap-3 px-3 py-2 text-left text-xs transition-colors "+(null!==u&&e.parcelNumber===u?"bg-cyan-500/10 border-l-2 border-cyan-400/80":"hover:bg-neutral-800/40"),title:null!==u&&e.parcelNumber===u?"Selected":"Select this parcel listing"},it.createElement("div",{className:"flex items-center gap-2 min-w-0"},it.createElement("span",{className:"inline-flex items-center justify-center w-2.5 h-2.5 rounded-full "+(null!==u&&e.parcelNumber===u?"bg-cyan-400 shadow-[0_0_12px_rgba(34,211,238,0.45)]":"bg-green-500/80")}),it.createElement("div",{className:"min-w-0"},it.createElement("div",{className:"font-mono text-neutral-200 truncate"},`${e.parcelNumber}.${n}.bitmap`),it.createElement("div",{className:"text-[11px] text-neutral-500 truncate"},String(e.listing?.inscriptionId||"").trim()?`insc ${String(e.listing.inscriptionId).trim()}`:"insc \u2014"))),it.createElement("div",{className:"shrink-0 flex items-center gap-2"},it.createElement("span",{className:"px-2.5 py-1 rounded-md text-xs font-bold bg-neutral-950/40 border border-neutral-800/60 text-amber-200"},null===e.price?"Price TBD":In(e.price)),it.createElement("span",{className:"text-neutral-500"},"\u2192")))))))))}return it.createElement("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-2"},a.map(e=>{const t=o(e);return it.createElement(Wx,{key:String(e),bitmapNumber:e,parcelsForSaleCount:t.highlight.length,highlightParcels:t.highlight,onOpen:()=>bt(e)})}))}return it.createElement("div",{className:n},t.map(e=>it.createElement(Vx,{key:e.inscriptionId,listing:e,onSelect:()=>r(e),onShowQr:t=>i(e,t)})))})()):it.createElement(it.Fragment,null,it.createElement("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3"},(Tn||[]).map(e=>it.createElement(kS,{key:e.key,collectionKey:e.key,title:e.title,description:e.description,statsLine:e.statsLine,thumbId:e.thumbId,thumbContentType:e.thumbContentType,fallbackImageInscriptionId:e.fallbackImageInscriptionId,isCatchAll:!!e.isCatchAll,onOpen:()=>(async e=>{if(!e?.key)return;Xe(e),Ye(!1),Ce(String(e.key)),bt(null),Ae([]);const t=String(e.key),{idbPageKey:n,cacheKey:r}=qt(t),i=t.toLowerCase(),a=tn(t)||nn(t)||Gt.has(i),o=Ue?.[r];if(Array.isArray(o)&&o.length>0)return Ae(o),void Sn({forceRefresh:!0,page:String(e.key),collection:e}).catch(()=>{});try{const i=await wx(Vt(n),{maxAgeMs:en(t)});if(Array.isArray(i)&&i.length>0)return Ae(i),Me(e=>({...e||{},[r]:i})),void Sn({forceRefresh:!0,page:String(e.key),collection:e}).catch(()=>{})}catch{}await Sn({forceRefresh:a,page:String(e.key),collection:e})})(e.raw)})))))})()),(cn||ln)&&"buy"===pe&&it.createElement("div",{className:"w-full flex-1 min-h-0 flex flex-col"},it.createElement("div",{className:"mx-auto w-full max-w-[1200px] grid grid-cols-1 md:grid-cols-[minmax(0,520px)_minmax(0,600px)] gap-3 sm:gap-4 items-start"},it.createElement("div",{className:"w-full min-w-0"},it.createElement("div",{className:"group relative flex flex-col rounded-2xl p-3 sm:p-4 bg-gradient-to-b from-neutral-900/60 to-neutral-950/80 border border-neutral-800/60 shadow-[0_0_0_1px_rgba(59,130,246,0.15),0_0_30px_rgba(59,130,246,0.10)] hover:translate-y-[-1px] hover:shadow-xl transition"},it.createElement("div",{className:"relative w-full aspect-square rounded-xl overflow-hidden border border-neutral-800/70 bg-black"},it.createElement("div",{className:"absolute top-2 left-2 z-10 flex flex-wrap gap-1"},hn&&null!==pn?it.createElement("span",{className:"text-[11px] px-2 py-1 rounded-md bg-neutral-950/60 border border-neutral-800/60 text-neutral-200"},"Bitmap ",it.createElement("span",{className:"font-mono"},pn,".bitmap")):null,(()=>{const e=Ze||H,t=e?.number??e?.inscriptionNumber??e?.inscription_number;return null==t?null:it.createElement("span",{className:"text-[11px] px-2 py-1 rounded-md bg-neutral-950/60 border border-neutral-800/60 text-neutral-200"},"#",it.createElement("span",{className:"font-mono"},String(t)))})(),tt?.key?it.createElement("span",{className:"text-[11px] px-2 py-1 rounded-md bg-neutral-950/60 border border-neutral-800/60 text-neutral-300"},String(tt?.name||tt?.title||tt?.key)):null),it.createElement("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/0 via-black/0 to-black/35"}),gn.isParcel&&(null!==gn.bitmapNumber||Number.isFinite(Number(yn?.result?.bitmapNumber))&&null!=yn?.result?.bitmapNumber)?it.createElement(it.Fragment,null,it.createElement(Px,{blockNumber:null!==gn.bitmapNumber?gn.bitmapNumber:Math.trunc(Number(yn?.result?.bitmapNumber)),highlightParcels:null!==gn.parcelNumber?[gn.parcelNumber]:Number.isFinite(Number(yn?.result?.parcelNumber))?[Math.trunc(Number(yn?.result?.parcelNumber))]:[],highlightColor:"rgb(34 197 94)",size:"auto",className:"w-full h-full"}),it.createElement("div",{className:"absolute bottom-2 right-2 w-28 h-20 sm:w-32 sm:h-24 rounded-lg overflow-hidden border border-neutral-800/70 bg-neutral-950/70"},it.createElement(ux,{inscription:Ze||H,width:"100%",height:"100%"}))):hn&&null!==pn?it.createElement(Px,{blockNumber:pn,bitmonPattern:mn,size:"auto",className:"w-full h-full"}):it.createElement(ux,{inscription:Ze||H,width:"100%",height:"100%"})),it.createElement("div",{className:"mt-3 flex items-start justify-between gap-3"},it.createElement("div",{className:"min-w-0"},it.createElement("div",{className:"text-xs font-semibold text-neutral-200 truncate"},"Asset"),it.createElement("div",{className:"text-[11px] text-neutral-500 font-mono break-all"},String((Ze||H)?.id||(Ze||H)?.inscriptionId||at||_||"").trim()||"(no inscription id)")),Je?it.createElement("div",{className:"shrink-0 text-right"},it.createElement("div",{className:"text-[11px] text-neutral-500"},"Price"),it.createElement("div",{className:"text-sm font-extrabold tracking-tight text-amber-300 drop-shadow-[0_0_10px_rgba(251,191,36,0.15)]"},Cx(Je)," BTC")):null))),it.createElement("div",{className:"w-full min-w-0 flex flex-col"},it.createElement("div",{className:"w-full max-w-[600px] mx-auto md:mx-0 rounded-2xl bg-neutral-900/40 border border-neutral-800/60 p-3 sm:p-4 flex-1 flex flex-col"},it.createElement("div",{className:"flex flex-col gap-4 flex-1"},ln?it.createElement(it.Fragment,null,gn.isParcel?it.createElement("div",{className:"bg-neutral-900/40 border border-neutral-800/60 rounded-xl p-3"},it.createElement("div",{className:"text-xs font-semibold text-neutral-200 mb-2"},"Parcel details"),it.createElement("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-2 text-[11px]"},it.createElement("div",{className:"text-neutral-400"},"Bitmap",it.createElement("div",{className:"text-neutral-200 font-mono"},null!==(null!==gn.bitmapNumber?gn.bitmapNumber:Number.isFinite(Number(yn?.result?.bitmapNumber))?Math.trunc(Number(yn?.result?.bitmapNumber)):null)?`${null!==gn.bitmapNumber?gn.bitmapNumber:Math.trunc(Number(yn?.result?.bitmapNumber))}.bitmap`:"\u2014")),it.createElement("div",{className:"text-neutral-400"},"Parcel",it.createElement("div",{className:"text-neutral-200 font-mono"},null!==(null!==gn.parcelNumber?gn.parcelNumber:Number.isFinite(Number(yn?.result?.parcelNumber))?Math.trunc(Number(yn?.result?.parcelNumber)):null)?`#${null!==gn.parcelNumber?gn.parcelNumber:Math.trunc(Number(yn?.result?.parcelNumber))}`:"\u2014")),it.createElement("div",{className:"text-neutral-400 sm:col-span-2"},"Inscription id",it.createElement("div",{className:"text-neutral-200 font-mono break-all"},String(Ze?.id||Ze?.inscriptionId||at||_||"").trim()||"\u2014")),it.createElement("div",{className:"text-neutral-400 sm:col-span-2"},"Expected text content",it.createElement("div",{className:"text-neutral-200 font-mono break-all"},(()=>{const e=null!==gn.bitmapNumber?gn.bitmapNumber:Number.isFinite(Number(yn?.result?.bitmapNumber))?Math.trunc(Number(yn?.result?.bitmapNumber)):null,t=null!==gn.parcelNumber?gn.parcelNumber:Number.isFinite(Number(yn?.result?.parcelNumber))?Math.trunc(Number(yn?.result?.parcelNumber)):null;return null===e||null===t?"\u2014":`${t}.${e}.bitmap`})())),it.createElement("div",{className:"sm:col-span-2"},"validating"===yn.status?it.createElement("div",{className:"text-[11px] text-neutral-400"},"Validating parcel\u2026"):"valid"===yn.status?it.createElement("div",{className:"text-[11px] text-green-300 bg-green-500/10 border border-green-500/30 rounded-lg px-3 py-2"},"Verified parcel inscription (bitmap + parcel match)."):"invalid"===yn.status&&yn.error?it.createElement("div",{className:"text-[11px] text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2"},yn.error):null))):null,it.createElement("div",{className:"flex flex-col gap-2"},it.createElement("label",{className:"text-xs font-semibold text-neutral-300"},"Seller offer"),ye&&String(he||"").trim()?it.createElement("div",{className:"bg-neutral-950/40 border border-neutral-800/60 rounded-xl p-3"},it.createElement("div",{className:"flex items-start justify-between gap-3"},it.createElement("div",{className:"min-w-0"},it.createElement("div",{className:"text-[11px] text-neutral-400"},"PSBT is prefilled from this listing."),it.createElement("div",{className:"text-[11px] text-neutral-500 font-mono break-all"},(()=>{const e=String(he||"").trim();return e?`${/^[0-9a-fA-F]+$/.test(e)&&e.length%2==0?"hex":"base64"} \u2022 ${e.length} chars \u2022 ${e.slice(0,14)}\u2026${e.slice(-10)}`:"\u2014"})())),it.createElement("div",{className:"shrink-0 flex items-center gap-2"},it.createElement("button",{type:"button",onClick:()=>xe(e=>!e),className:"px-3 py-1.5 text-xs font-semibold rounded-lg bg-neutral-800/60 text-neutral-200 border border-neutral-700/60 hover:bg-neutral-700/60",title:"Toggle viewing the full PSBT"},we?"Hide PSBT":"View PSBT"),it.createElement("button",{type:"button",onClick:()=>{be(!1),xe(!0)},className:"px-3 py-1.5 text-xs font-semibold rounded-lg bg-neutral-950/40 text-neutral-200 border border-neutral-800/60 hover:border-sky-500/25",title:"Switch to editable PSBT input"},"Edit"))),we?it.createElement("textarea",{value:he,readOnly:ye,onChange:e=>{be(!1),ge(e.target.value)},className:"mt-2 w-full px-2.5 py-1.5 text-xs bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-sky-500/60 focus:ring-1 focus:ring-sky-500/20 font-mono",spellCheck:!1,rows:5}):null):it.createElement("textarea",{value:he,onChange:e=>{be(!1),ge(e.target.value)},className:"w-full px-2.5 py-1.5 text-xs bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-sky-500/60 focus:ring-1 focus:ring-sky-500/20 font-mono",placeholder:"Paste seller PSBT here",spellCheck:!1,rows:5}),it.createElement("div",{className:"flex gap-2"},it.createElement("button",{onClick:()=>{const e=Nn(he);e&&(Ct(e),Lt("Seller offer PSBT (pasted)"))},disabled:!Nn(he),className:Nn(he)?"px-3 py-2 text-xs font-semibold rounded-lg bg-neutral-800 hover:bg-neutral-700 text-white transition-colors":"px-3 py-2 text-xs font-semibold rounded-lg bg-neutral-800 text-neutral-500 cursor-not-allowed",title:"Show pasted seller PSBT as QR code"},"Show QR")),it.createElement("div",{className:"text-[11px] text-neutral-500"},"This completes an off-chain sale: seller sends you a signed offer PSBT; you paste it here and your wallet signs the buyer funding inputs.")),it.createElement("div",{className:"flex flex-col gap-2"},it.createElement(En,null),it.createElement("button",{onClick:()=>{Se(!0),K?.(Nn(he))},disabled:!K||!Nn(he),className:K&&Nn(he)?"w-full px-4 py-3 text-sm font-semibold rounded-lg bg-emerald-500 hover:bg-emerald-400 text-neutral-950 transition-colors shadow-[0_0_0_1px_rgba(16,185,129,0.35),0_10px_30px_rgba(16,185,129,0.15)] active:translate-y-[1px]":"w-full px-4 py-3 text-sm font-semibold rounded-lg bg-neutral-800 text-neutral-500 cursor-not-allowed","aria-label":"Buy from seller offer PSBT",title:"Buy using a pasted seller offer PSBT"},"Buy From PSBT"),j?it.createElement("div",{className:"text-xs text-green-300 bg-green-500/10 border border-green-500/30 rounded-lg px-3 py-2"},j):null),vn?it.createElement("div",{className:"bg-neutral-900/40 border border-neutral-800/60 rounded-lg p-3"},it.createElement("div",{className:"text-xs font-semibold text-neutral-200 mb-1"},"Two-step (supports more wallets)"),it.createElement("div",{className:"text-[11px] text-neutral-500 mb-2"},"Main buy failed. If the seller wallet can\u2019t sign 0x83 offers, generate a buyer-funded PSBT here and send it back to the seller to countersign + broadcast."),it.createElement("button",{onClick:()=>J?.(Nn(he)),disabled:!J||!Nn(he),className:J&&Nn(he)?"w-full px-4 py-2 text-sm font-semibold rounded-lg bg-neutral-800 hover:bg-neutral-700 text-white transition-colors":"w-full px-4 py-2 text-sm font-semibold rounded-lg bg-neutral-800 text-neutral-500 cursor-not-allowed","aria-label":"Create buyer-funded PSBT",title:"Build a buyer-funded PSBT for the seller to countersign"},"Create Buyer-Funded PSBT"),G?it.createElement("div",{className:"mt-2 text-xs text-green-300 bg-green-500/10 border border-green-500/30 rounded-lg px-3 py-2"},G):null,Y?it.createElement("div",{className:"mt-2 text-xs text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2"},Y):null,it.createElement("div",{className:"mt-2 flex flex-col gap-2"},it.createElement("label",{className:"text-xs font-semibold text-neutral-300"},"Buyer-funded PSBT (send to seller)"),it.createElement("textarea",{value:X||"",readOnly:!0,className:"w-full px-2.5 py-1.5 text-xs bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-purple-500/60 font-mono",placeholder:"(will appear here after creation)",spellCheck:!1,rows:5}),it.createElement("div",{className:"flex gap-2"},it.createElement("button",{onClick:()=>{const e=String(X||"").trim();if(e)try{navigator.clipboard.writeText(e)}catch(t){}},disabled:!String(X||"").trim(),className:String(X||"").trim()?"flex-1 px-3 py-2 text-xs font-semibold rounded-lg bg-neutral-800 hover:bg-neutral-700 text-white transition-colors":"flex-1 px-3 py-2 text-xs font-semibold rounded-lg bg-neutral-800 text-neutral-500 cursor-not-allowed",title:"Copy buyer-funded PSBT"},"Copy"),it.createElement("button",{onClick:()=>{const e=String(X||"").trim();e&&(Ct(e),Lt("Buyer-funded PSBT"))},disabled:!String(X||"").trim(),className:String(X||"").trim()?"px-3 py-2 text-xs font-semibold rounded-lg bg-neutral-800 hover:bg-neutral-700 text-white transition-colors":"px-3 py-2 text-xs font-semibold rounded-lg bg-neutral-800 text-neutral-500 cursor-not-allowed",title:"Show buyer-funded PSBT as QR code"},"Show QR")))):null,q?it.createElement("div",{className:"text-xs text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2"},q):null):it.createElement(it.Fragment,null,it.createElement("div",{className:"flex items-start justify-between gap-3"},it.createElement("div",{className:"min-w-0"},it.createElement("div",{className:"text-xs font-semibold text-neutral-200"},"Checkout"),it.createElement("div",{className:"text-[11px] text-neutral-500"},"Your wallet will prompt you to approve & broadcast.")),it.createElement("div",{className:"shrink-0 text-right"},it.createElement("div",{className:"text-[11px] text-neutral-500"},"Price"),it.createElement("div",{className:"text-3xl font-extrabold tracking-tight text-amber-300 drop-shadow-[0_0_10px_rgba(251,191,36,0.15)]"},Je?`${Cx(Je)} BTC`:"\u2014"))),gn.isParcel?it.createElement("div",{className:"bg-neutral-900/40 border border-neutral-800/60 rounded-xl p-3"},it.createElement("div",{className:"text-xs font-semibold text-neutral-200 mb-2"},"Parcel details"),it.createElement("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-2 text-[11px]"},it.createElement("div",{className:"text-neutral-400"},"Bitmap",it.createElement("div",{className:"text-neutral-200 font-mono"},null!==(null!==gn.bitmapNumber?gn.bitmapNumber:Number.isFinite(Number(yn?.result?.bitmapNumber))?Math.trunc(Number(yn?.result?.bitmapNumber)):null)?`${null!==gn.bitmapNumber?gn.bitmapNumber:Math.trunc(Number(yn?.result?.bitmapNumber))}.bitmap`:"\u2014")),it.createElement("div",{className:"text-neutral-400"},"Parcel",it.createElement("div",{className:"text-neutral-200 font-mono"},null!==(null!==gn.parcelNumber?gn.parcelNumber:Number.isFinite(Number(yn?.result?.parcelNumber))?Math.trunc(Number(yn?.result?.parcelNumber)):null)?`#${null!==gn.parcelNumber?gn.parcelNumber:Math.trunc(Number(yn?.result?.parcelNumber))}`:"\u2014")),it.createElement("div",{className:"text-neutral-400 sm:col-span-2"},"Expected text content",it.createElement("div",{className:"text-neutral-200 font-mono break-all"},(()=>{const e=null!==gn.bitmapNumber?gn.bitmapNumber:Number.isFinite(Number(yn?.result?.bitmapNumber))?Math.trunc(Number(yn?.result?.bitmapNumber)):null,t=null!==gn.parcelNumber?gn.parcelNumber:Number.isFinite(Number(yn?.result?.parcelNumber))?Math.trunc(Number(yn?.result?.parcelNumber)):null;return null===e||null===t?"\u2014":`${t}.${e}.bitmap`})())),it.createElement("div",{className:"sm:col-span-2"},"validating"===yn.status?it.createElement("div",{className:"text-[11px] text-neutral-400"},"Validating parcel\u2026"):"valid"===yn.status?it.createElement("div",{className:"text-[11px] text-green-300 bg-green-500/10 border border-green-500/30 rounded-lg px-3 py-2"},"Verified parcel inscription (bitmap + parcel match)."):"invalid"===yn.status&&yn.error?it.createElement("div",{className:"text-[11px] text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2"},yn.error):null))):null,it.createElement("div",{className:"flex flex-col gap-2"},it.createElement("label",{className:"text-[11px] font-semibold uppercase tracking-wide text-neutral-500"},"Inscription ID / Reveal txid"),it.createElement("input",{type:"text",value:_||"",readOnly:!!String(at||"").trim(),onChange:e=>{String(at||"").trim()||P?.(e.target.value)},className:"w-full px-3 py-2.5 text-sm bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-sky-500/60 focus:ring-1 focus:ring-sky-500/20 font-mono",placeholder:"Paste inscription ID (<txid>i<index>) or reveal txid",spellCheck:!1,autoCapitalize:"none",autoCorrect:"off"}),String(at||"").trim()?it.createElement("div",{className:"text-[11px] text-neutral-500"},"Prefilled from the selected listing (inscription id, locked)."):null,it.createElement("div",{className:"text-[11px] text-neutral-500"},"Keep fee inputs boring and precise.")),Je&&it.createElement("div",{className:"bg-neutral-900/40 border border-neutral-800/60 rounded-xl p-3"},it.createElement("div",{className:"text-xs font-semibold text-neutral-200 mb-1"},"Estimated total"),it.createElement("div",{className:"flex flex-col gap-1.5 text-xs"},it.createElement("div",{className:"flex justify-between items-center"},it.createElement("span",{className:"text-neutral-400"},"Listing Price:"),it.createElement("span",{className:"font-mono text-neutral-200"},Cx(Je)," BTC")),it.createElement("div",{className:"flex justify-between items-center"},it.createElement("span",{className:"text-neutral-400"},"Est. Network Fees:"),it.createElement("span",{className:"font-mono text-neutral-300"},"~0.00001-0.00002 BTC")),it.createElement("div",{className:"border-t border-neutral-800/60 my-1"}),it.createElement("div",{className:"flex justify-between items-center font-semibold"},it.createElement("span",{className:"text-neutral-200"},"Total Approx:"),it.createElement("span",{className:"font-mono text-amber-300"},Cx(Je+1500)," BTC")),it.createElement("div",{className:"text-[10px] text-neutral-500 mt-1"},"Final fees depend on transaction size and network conditions"))),it.createElement("div",{className:"flex flex-col gap-2"},it.createElement(En,null),it.createElement("button",{onClick:async()=>{if(lt(null),"bitmap"===tt?.type&&tt?.verified||"bitmap"===tt?.key){const e=Ze?.id||Ze?.inscriptionId||Ze?.inscription_id||null;if(!e)return void lt("Cannot validate bitmap: missing inscription id. Try refreshing the listing.");try{ut(!0);const t=await hv(String(e));if(!t||"bitmap"!==t.type||!t.verified)return void lt("This listing is not OCI-verified as a bitmap. Refusing to buy.");const n=Number(tt?.bitmapNumber);if(Number.isFinite(n)&&t.bitmapNumber!==n)return void lt(`Bitmap number mismatch (claimed ${n}, OCI says ${t.bitmapNumber}). Refusing to buy.`)}finally{ut(!1)}}if("parcel"===String(tt?.type||"").toLowerCase()&&tt?.verified||"parcel"===String(tt?.key||"").toLowerCase()){const e=Ze?.id||Ze?.inscriptionId||Ze?.inscription_id||null;if(!e)return void lt("Cannot validate parcel: missing inscription id. Try refreshing the listing.");try{ut(!0);const{detectAndVerifyParcelByInscriptionId:t}=await n(async()=>{const{detectAndVerifyParcelByInscriptionId:e}=await Promise.resolve().then(()=>Sv);return{detectAndVerifyParcelByInscriptionId:e}},__VITE_PRELOAD__),r=await t(String(e));if(!r||"parcel"!==r.type||!r.verified)return void lt("This listing is not parcel-verified. Refusing to buy.");const i=Number(tt?.parcelNumber),a=Number(tt?.bitmapNumber);if(Number.isFinite(i)&&r.parcelNumber!==i)return void lt(`Parcel number mismatch (claimed ${i}, content+rules say ${r.parcelNumber}). Refusing to buy.`);if(Number.isFinite(a)&&r.bitmapNumber!==a)return void lt(`Bitmap number mismatch (claimed ${a}, content+rules say ${r.bitmapNumber}). Refusing to buy.`)}finally{ut(!1)}}await(B?.())},disabled:C||ct,className:C?"w-full px-4 py-3 text-sm font-semibold rounded-lg bg-neutral-800 text-neutral-500 cursor-not-allowed":"w-full px-4 py-3 text-sm font-semibold rounded-lg bg-emerald-500 hover:bg-emerald-400 text-neutral-950 transition-colors shadow-[0_0_0_1px_rgba(16,185,129,0.35),0_10px_30px_rgba(16,185,129,0.15)] active:translate-y-[1px]","aria-label":"Buy from reveal txid",title:O?"Buy may require splitting payment UTXOs (see button below).":"Buy the listed asset"},ct?"Validating...":"Buy "+(O?"(Needs Funding)":"")),st?it.createElement("div",{className:"text-xs text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2"},st):null,M?it.createElement("div",{className:"text-xs text-green-300 bg-green-500/10 border border-green-500/30 rounded-lg px-3 py-2"},M):null),$?it.createElement("div",{className:"text-xs text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2"},$):null,"function"==typeof L&&O?it.createElement("div",{className:"flex flex-col gap-2"},it.createElement("div",{className:"text-[11px] text-neutral-400"},"Your wallet needs additional spendable UTXOs to complete this buy."),it.createElement("button",{onClick:L,disabled:F,className:F?"w-full px-3 py-1.5 text-xs font-semibold rounded-lg bg-neutral-800 text-neutral-500 cursor-not-allowed":"w-full px-3 py-1.5 text-xs font-semibold rounded-lg bg-neutral-800 hover:bg-neutral-700 text-white transition-colors","aria-label":"Create funding split transaction",title:"Create a funding transaction that splits UTXOs for payment"},"Create Split Funding Tx"),R?it.createElement("div",{className:"text-xs text-green-300 bg-green-500/10 border border-green-500/30 rounded-lg px-3 py-2"},R):null,U?it.createElement("div",{className:"text-xs text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2"},U):null):null)))))),(cn||ln)&&"sell"===pe&&it.createElement("div",{className:"grid grid-cols-1 sm:grid-cols-[200px_1fr] gap-3 sm:gap-4 items-start"},it.createElement("div",{className:"w-full sm:w-[200px] max-w-[280px] mx-auto sm:mx-0 flex flex-col gap-2"},it.createElement("div",{className:"aspect-square"},it.createElement(ux,{inscription:e,width:"100%",height:"100%"})),jx.enabled&&Mt&&it.createElement("div",{className:"bg-neutral-900/50 border border-neutral-800/50 rounded-lg p-2.5 text-[10px] leading-relaxed text-neutral-500 space-y-1"},it.createElement("div",{className:"font-semibold text-purple-400 text-[11px] flex items-center gap-1"},"\ud83d\udc8e Indexing / provenance"),it.createElement("div",null,"Collection:"," ",it.createElement("span",{className:"font-mono font-semibold text-neutral-300"},Rt&&"uncategorized"!==Rt?Ut?.name||Rt:"uncategorized")),it.createElement("div",null,"Fee:"," ",it.createElement("span",{className:"font-mono font-semibold text-neutral-300"},Number(Mt.value||0).toLocaleString()," sats")),it.createElement("div",null,"Address:"," ",it.createElement("span",{className:"font-mono text-neutral-400 break-all"},String(Mt.address||""))),it.createElement("div",{className:"text-neutral-600"},Rt&&"uncategorized"!==Rt&&$t?"Source: collection manifesto (registry).":"Source: default OODL indexing address."),it.createElement("div",{className:"text-neutral-600 italic"},"Included in the listing commit tx so indexers can discover & categorize the listing."))),it.createElement("div",{className:"flex flex-col gap-3"},it.createElement("div",{className:"text-xs text-neutral-300"},it.createElement("div",{className:"font-semibold text-neutral-200 mb-1"},"Selected inscription"),on?it.createElement("div",null,it.createElement("div",{className:"font-mono text-[11px] text-neutral-300 break-all"},on),null!=sn&&it.createElement("div",{className:"text-[11px] text-neutral-500 mt-0.5"},"#",sn),"bitmap"===Et?.type&&Et?.verified?it.createElement("div",{className:"text-[11px] text-neutral-400 mt-1"},"Collection: ",it.createElement("span",{className:"font-semibold text-neutral-200"},"Bitmaps")," ",it.createElement("span",{className:"font-mono text-neutral-300"},Et.bitmapNumber,".bitmap")):null,"parcel"===Et?.type&&Et?.verified?it.createElement("div",{className:"text-[11px] text-neutral-400 mt-1"},"Collection: ",it.createElement("span",{className:"font-semibold text-neutral-200"},"Bitmap Parcels")," ",it.createElement("span",{className:"font-mono text-neutral-300"},Et.parcelNumber,".",Et.bitmapNumber,".bitmap")):null):it.createElement("div",{className:"text-[11px] text-neutral-500"},"Select an inscription from the Inscriptions panel, or paste an ID in the Advanced tab.")),it.createElement("div",{className:"flex flex-col gap-2"},it.createElement("label",{className:"text-xs font-semibold text-neutral-300"},"Collection (required)"),it.createElement("div",{className:"flex flex-col gap-2 bg-neutral-900/30 border border-neutral-800/60 rounded-lg p-3"},it.createElement("div",{className:"flex items-center gap-2"},it.createElement("input",{type:"text",value:Nt,onChange:e=>Tt(e.target.value),className:"flex-1 min-w-0 px-3 py-2.5 sm:py-2 text-sm bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-purple-500/60",placeholder:"Enter inscription ID or collection name\u2026"}),it.createElement("button",{type:"button",onClick:async()=>{try{if(!on)return;if(Pt({status:"validating",message:"Auto-detecting\u2026"}),"bitmap"===Et?.type&&Et?.verified)return At("bitmap"),void Tt("Bitmaps");if("parcel"===Et?.type&&Et?.verified)return At("parcel"),Tt("Bitmap Parcels"),void Pt({status:"valid",message:"Verified parcel."});const{matchCollectionForInscription:e}=await n(async()=>{const{matchCollectionForInscription:e}=await Promise.resolve().then(()=>Xv);return{matchCollectionForInscription:e}},__VITE_PRELOAD__),t=await e(on,rn);if(t){const e=rn.find(e=>String(e?.key||"").trim()===String(t).trim());return At(String(t)),void Tt(String(e?.name||t))}try{const{detectAndVerifyBitmapByInscriptionId:e}=await n(async()=>{const{detectAndVerifyBitmapByInscriptionId:e}=await Promise.resolve().then(()=>gv);return{detectAndVerifyBitmapByInscriptionId:e}},__VITE_PRELOAD__),t=await e(String(on));if("bitmap"===t?.type&&t?.verified)return At("bitmap"),Tt("Bitmaps"),void Pt({status:"valid",message:"Verified bitmap."})}catch{}try{const{detectAndVerifyParcelByInscriptionId:e}=await n(async()=>{const{detectAndVerifyParcelByInscriptionId:e}=await Promise.resolve().then(()=>Sv);return{detectAndVerifyParcelByInscriptionId:e}},__VITE_PRELOAD__),t=await e(String(on));if("parcel"===t?.type&&t?.verified)return At("parcel"),Tt("Bitmap Parcels"),void Pt({status:"valid",message:"Verified parcel."})}catch{}Pt({status:"invalid",message:"Could not auto-detect a collection for this inscription."})}catch(cC){Pt({status:"invalid",message:cC?.message||String(cC)})}},className:"px-3 py-2 text-xs font-semibold rounded-lg bg-neutral-800 hover:bg-neutral-700 text-white transition-colors",title:"Try to auto-detect the collection based on registry rules"},"Fetch collection")),it.createElement("div",{className:"flex flex-wrap gap-2"},(an||[]).slice(0,10).map(e=>{const t=String(e?.key||""),n=t&&t===String(kt||"");return it.createElement("button",{key:t,type:"button",onClick:()=>{At(t),Tt(String(e?.name||t))},className:n?"px-3 sm:px-2.5 py-2 sm:py-1.5 text-xs sm:text-[11px] font-semibold rounded-full bg-purple-500/20 border border-purple-500/40 text-purple-200":"px-3 sm:px-2.5 py-2 sm:py-1.5 text-xs sm:text-[11px] font-semibold rounded-full bg-neutral-800/70 border border-neutral-700/60 text-neutral-200 hover:bg-neutral-800",title:String(e?.description||"")},String(e?.name||t))})),it.createElement("div",{className:"text-[11px] text-neutral-500"},"Choose which registry collection to tag this listing under. Your inscription must match that collection\u2019s rules to prevent spoofing."),kt?it.createElement("div",{className:"text-[11px] text-neutral-400"},"Selected: ",it.createElement("span",{className:"font-mono text-neutral-200"},kt)):it.createElement("div",{className:"text-[11px] text-yellow-300/80"},"Select a collection to enable listing."),"validating"===_t?.status?it.createElement("div",{className:"text-xs text-neutral-300 bg-neutral-800/40 border border-neutral-700/40 rounded-lg px-3 py-2"},_t?.message||"Validating\u2026"):null,"valid"===_t?.status?it.createElement("div",{className:"text-xs text-green-300 bg-green-500/10 border border-green-500/30 rounded-lg px-3 py-2"},_t?.message||"Valid"):null,"invalid"===_t?.status?it.createElement("div",{className:"text-xs text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2"},_t?.message||"Invalid"):null),it.createElement("label",{className:"text-xs font-semibold text-neutral-300"},"Sale price (sats or BTC)"),it.createElement("input",{type:"text",inputMode:"decimal",value:i,onChange:e=>a(e.target.value),className:"w-full px-3 py-2.5 sm:py-2 text-sm bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-purple-500/60",placeholder:"30000  or  0.0003"})),it.createElement("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2"},it.createElement("div",{className:"flex flex-col gap-2"},it.createElement("label",{className:"text-xs font-semibold text-neutral-300"},"Not valid before block (optional)"),it.createElement("div",{className:"flex items-center gap-2"},it.createElement("input",{type:"number",min:0,step:1,value:x||"",onChange:e=>v?.(e.target.value),onBlur:()=>{const e=String(x??"").trim();if(!e)return;const t=Number(e),n=Number.isFinite(t)&&t>=0?Math.floor(t):null;null!==n&&null!==dt&&n<=dt&&v?.("")},className:"flex-1 w-full px-3 py-2.5 sm:py-2 text-sm bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-purple-500/60",placeholder:"e.g. 850000"}),(()=>{const e=String(x??"").trim();if(!e)return null!==dt?it.createElement("div",{className:"text-[11px] text-neutral-500 whitespace-nowrap"},"Tip: ",dt):null;const t=Number(e),n=Number.isFinite(t)&&t>=0?Math.floor(t):null;if(null===n)return null;if(null===dt)return null;const r=n-dt;return r<=0?it.createElement("div",{className:"text-[11px] text-yellow-300/80 whitespace-nowrap"},"Purchasable now"):it.createElement("div",{className:"text-[11px] text-neutral-400 whitespace-nowrap"},"Purchasable in ",r," block(s)")})()),it.createElement("div",{className:"text-[11px] text-neutral-500"},"Sets the offer/buy tx locktime and a marker constraint."),null===dt&&pt?it.createElement("div",{className:"text-[11px] text-neutral-600"},"Tip height unavailable"):null)),ln?it.createElement(it.Fragment,null,it.createElement("div",{className:"text-[11px] text-neutral-500"},"Creates a seller offer PSBT for the selected inscription that you can send to a buyer. The buyer completes the purchase by pasting it into Offer \u2192 Buy."),it.createElement("div",{className:"flex flex-col gap-2"},it.createElement(En,null),it.createElement("button",{onClick:V,disabled:m||!V,className:m||!V?"w-full px-4 py-2 text-sm font-semibold rounded-lg bg-neutral-800 text-neutral-500 cursor-not-allowed":"w-full px-4 py-2 text-sm font-semibold rounded-lg bg-purple-600 hover:bg-purple-500 text-white transition-colors","aria-label":"Create seller offer PSBT",title:"Create a seller offer PSBT to share with a buyer"},"Create Seller Offer PSBT"),z?it.createElement("div",{className:"text-xs text-green-300 bg-green-500/10 border border-green-500/30 rounded-lg px-3 py-2"},z):null),it.createElement("div",{className:"flex flex-col gap-2"},it.createElement("label",{className:"text-xs font-semibold text-neutral-300"},"Seller offer PSBT (share with buyer)"),it.createElement("textarea",{value:D||"",readOnly:!0,className:"w-full px-3 py-2 text-sm bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-purple-500/60 font-mono",placeholder:"(will appear here after creation)",rows:6}),it.createElement("div",{className:"flex gap-2"},it.createElement("button",{onClick:()=>{const e=String(D||"").trim();if(e)try{navigator.clipboard.writeText(e)}catch(t){}},disabled:!String(D||"").trim(),className:String(D||"").trim()?"flex-1 px-3 py-2 text-xs font-semibold rounded-lg bg-neutral-800 hover:bg-neutral-700 text-white transition-colors":"flex-1 px-3 py-2 text-xs font-semibold rounded-lg bg-neutral-800 text-neutral-500 cursor-not-allowed",title:"Copy seller offer PSBT"},"Copy"),it.createElement("button",{onClick:()=>{const e=String(D||"").trim();e&&(Ct(e),Lt("Seller offer PSBT"))},disabled:!String(D||"").trim(),className:String(D||"").trim()?"px-3 py-2 text-xs font-semibold rounded-lg bg-neutral-800 hover:bg-neutral-700 text-white transition-colors":"px-3 py-2 text-xs font-semibold rounded-lg bg-neutral-800 text-neutral-500 cursor-not-allowed",title:"Show seller offer PSBT as QR code"},"Show QR"))),xn?it.createElement("div",{className:"bg-neutral-900/40 border border-neutral-800/60 rounded-lg p-3"},it.createElement("div",{className:"text-xs font-semibold text-neutral-200 mb-1"},"Two-step fallback (seller countersign)"),it.createElement("div",{className:"text-[11px] text-neutral-500 mb-2"},"Main seller-offer signing failed (0x83). Ask the buyer to create a buyer-funded PSBT and paste it below to countersign + broadcast."),it.createElement("div",{className:"flex flex-col gap-2"},it.createElement("label",{className:"text-xs font-semibold text-neutral-300"},"Buyer-funded PSBT (paste from buyer)"),it.createElement("textarea",{value:Ee,onChange:e=>Ie(e.target.value),className:"w-full px-3 py-2 text-sm bg-neutral-950/60 border border-neutral-800/60 rounded-lg text-neutral-200 outline-none focus:border-purple-500/60 font-mono",placeholder:"Paste buyer-funded PSBT here",spellCheck:!1,rows:6})),it.createElement("button",{onClick:()=>ee?.(Ee),disabled:!ee||!String(Ee||"").trim(),className:ee&&String(Ee||"").trim()?"w-full px-4 py-2 text-sm font-semibold rounded-lg bg-neutral-800 hover:bg-neutral-700 text-white transition-colors":"w-full px-4 py-2 text-sm font-semibold rounded-lg bg-neutral-800 text-neutral-500 cursor-not-allowed","aria-label":"Countersign and broadcast",title:"Countersign the buyer-funded PSBT and broadcast"},"Countersign & Broadcast"),Q?it.createElement("div",{className:"mt-2 text-xs text-green-300 bg-green-500/10 border border-green-500/30 rounded-lg px-3 py-2"},Q):null,Z?it.createElement("div",{className:"mt-2 text-xs text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2"},Z):null):null,W?it.createElement("div",{className:"text-xs text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2"},W):null):it.createElement(it.Fragment,null,it.createElement("label",{className:"flex items-center gap-2 text-xs text-neutral-300 select-none"},it.createElement("input",{type:"checkbox",checked:!!u,onChange:e=>d?.(e.target.checked),className:"accent-purple-500"}),"Dry run (no broadcast)"),it.createElement("div",{className:"flex flex-col gap-2"},it.createElement(En,null),it.createElement("button",{onClick:()=>f?.({collectionKey:String(kt||"").trim()||null,minBlockHeight:Ft(x)}),disabled:m||!String(kt||"").trim()||"validating"===_t?.status||"invalid"===_t?.status,className:m?"w-full px-4 py-3 sm:py-2 text-sm font-semibold rounded-lg bg-neutral-800 text-neutral-500 cursor-not-allowed":"w-full px-4 py-3 sm:py-2 text-sm font-semibold rounded-lg bg-purple-600 hover:bg-purple-500 text-white transition-colors","aria-label":"Create sale listing transaction",title:"Broadcast a listing reveal transaction"},"Create Listing Tx"),it.createElement(nS,{selectedParentsCount:t,disabled:m||!String(kt||"").trim()||"validating"===_t?.status||"invalid"===_t?.status||"function"!=typeof p,collectionKey:String(kt||"").trim()||null,minBlockHeight:Ft(x),onCreateBulkListingTx:p,bulkSellerStatus:y,bulkSellerError:b,bulkBundleJson:w}),h?it.createElement("div",{className:"text-xs text-green-300 bg-green-500/10 border border-green-500/30 rounded-lg px-3 py-2"},h):null),g?it.createElement("div",{className:"text-xs text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2"},g):null))),!un&&cn&&"collection"===pe&&it.createElement("div",{className:"bg-neutral-900/40 border border-neutral-800/60 rounded-lg"},it.createElement(lS,{selectedParentsCount:t,selectedInscriptionIds:r,walletInscriptions:re,walletAssetScanState:ie,onRequestWalletRescan:ae,existingCollectionKeys:(Array.isArray(Oe)?Oe:[]).map(e=>String(e?.key||"").trim()).filter(Boolean),authoritySlots:S,authorityStatus:E,authorityError:I,selectedAuthoritySlotId:k,feeRate:te,onFeeRateChange:ne,onAuthoritySlotChange:A,onLaunchCollection:N,onLaunchParcelManifest:T}))),it.createElement(cS,{value:Bt,label:Ot,onClear:()=>{Ct(""),Lt("")}}),it.createElement(vS,{collection:Ke,isOpen:Ge,onClose:()=>Ye(!1)}))}const kS=it.memo(function({collectionKey:e,title:t,description:n,statsLine:r,thumbId:i,thumbContentType:a,fallbackImageInscriptionId:o,isCatchAll:s,onOpen:l}){const c=(()=>{const t=String(e||"").trim().toLowerCase();return"parcel"===t||"parcels"===t})(),u=String(a||"").trim().toLowerCase(),d="text/html"===u||u.startsWith("text/html"),f=u.startsWith("image/"),[p,m]=it.useState(()=>d?"iframe":f||!u?"img":"other"),h=String(i||"").trim(),g=String(o||"").trim(),y=it.useMemo(()=>{const e=String(r||"").trim();if(!e)return null;const t=e.split(" \u2022 Floor ");return 2===t.length?{countText:t[0],floorText:t[1]}:{countText:e,floorText:null}},[r]);return it.createElement("button",{onClick:l,className:"group text-left rounded-2xl bg-gradient-to-b from-neutral-900/60 to-neutral-950/80 border border-neutral-800/60 text-neutral-200 shadow-[0_0_0_1px_rgba(59,130,246,0.10),0_0_22px_rgba(59,130,246,0.08)] hover:translate-y-[-1px] hover:shadow-xl hover:border-sky-500/25 transition overflow-hidden",title:`View ${t||e}`},it.createElement("div",{className:"p-2"},it.createElement("div",{className:"relative aspect-square w-full rounded-xl overflow-hidden border border-neutral-800/70 bg-black"},it.createElement("div",{className:"absolute top-2 left-2 z-10"},s?it.createElement("span",{className:"text-[11px] px-2 py-1 rounded-md bg-neutral-950/60 border border-neutral-800/60 text-neutral-200"},"Uncategorized"):c?it.createElement("span",{className:"text-[11px] px-2 py-1 rounded-md bg-neutral-950/60 border border-neutral-800/60 text-neutral-200"},"Parcels"):null),it.createElement("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/0 via-black/0 to-black/35"}),c?it.createElement("div",{className:"w-full h-full flex items-center justify-center"},it.createElement("div",{className:"w-2/3 h-2/3 rounded-none border border-green-500 bg-green-500"})):h?"iframe"===p?it.createElement("iframe",{src:th(`/content/${h}`),title:"",sandbox:"allow-scripts",referrerPolicy:"no-referrer",className:"w-full h-full pointer-events-none",tabIndex:-1}):"img"===p?it.createElement("img",{src:th(`/content/${h}`),alt:"",className:"w-full h-full object-cover",loading:"lazy",onError:()=>{m("iframe")}}):it.createElement("div",{className:"w-full h-full flex items-center justify-center text-neutral-600 text-[10px] px-2 text-center"},u||"content"):g?it.createElement("img",{src:th(`/content/${g}`),alt:"",className:"w-full h-full object-cover",loading:"lazy"}):s?it.createElement("div",{className:"w-full h-full flex items-center justify-center"},it.createElement("img",{src:th(`/content/${ES}`),alt:"",className:"w-10 h-10 opacity-70",loading:"lazy"})):it.createElement("div",{className:"w-full h-full flex items-center justify-center text-neutral-600 text-xs"},String(t||"").slice(0,10)))),it.createElement("div",{className:"px-3 pb-3"},it.createElement("div",{className:"text-[13px] font-semibold truncate text-neutral-100"},t),y?it.createElement("div",{className:"mt-0.5 text-[11px] text-neutral-400 truncate"},it.createElement("span",null,y.countText),y.floorText?it.createElement(it.Fragment,null,it.createElement("span",{className:"text-neutral-600"}," ","\u2022"," "),it.createElement("span",{className:"text-amber-300 drop-shadow-[0_0_10px_rgba(251,191,36,0.10)]"},"Floor ",y.floorText)):null):null,n?it.createElement("div",{className:"mt-1 text-[11px] text-neutral-500 line-clamp-2"},n):it.createElement("div",{className:"mt-1 text-[11px] text-neutral-500 line-clamp-2"},"Open collection page")))});Array(9).fill(0),th("/content/01bba6c58af39d7f199aa2bceeaaba1ba91b23d2663bc4ef079a4b5e442dbf74i0"),th("/content/bb01dfa977a5cd0ee6e900f1d1f896b5ec4b1e3c7b18f09c952f25af6591809fi0"),th("/content/bb02e94f3062facf6aa2e47eeed348d017fd31c97614170dddb58fc59da304efi0"),th("/content/bb037ec98e6700e8415f95d1f5ca1fe1ba23a3f0c5cb7284d877e9ac418d0d32i0"),th("/content/bb9438f4345f223c6f4f92adf6db12a82c45d1724019ecd7b6af4fcc3f5786cei0"),th("/content/bb0542d4606a9e7eb4f31051e91f7696040db06ca1383dff98505618c34d7df7i0"),th("/content/bb06a4dffba42b6b513ddee452b40a67688562be4a1345127e4d57269e6b2ab6i0"),th("/content/bb076934c1c22007b315dd1dc0f8c4a2f9d52f348320cfbadc7c0bd99eaa5e18i0"),th("/content/bb986a1208380ec7db8df55a01c88c73a581069a51b5a2eb2734b41ba10b65c2i0"),th("/content/b907b51a239e3a37f29f8222fb274f828c6ebf7b93ce501a55b7171daaa75758i0");const AS=new URL(import.meta.url);async function NS(e){const t=th(`/r/inscription/${e}`);return await fetch(t).then(e=>e.json())}async function TS(e){const t=th(`/content/${e}`);return(await fetch(t).then(e=>e.text())).trim()}async function _S(e,t,n){const r=new Set;try{const i=await async function(e){const t=[];let n=0;for(;;){const r=th(0===n?`/r/children/${e}`:`/r/children/${e}/${n}`),i=await fetch(r).then(e=>e.json());if(!i.ids||0===i.ids.length)break;if(t.push(...i.ids),!i.more)break;n++}return t}(e);if(0===i.length)return r;const a={},o=i.map(async e=>{try{const r=await async function(e,t,n){const r=await TS(e),i=r.split(".");if(3!==i.length||"bitmap"!==i[2])return!1;const[a,o]=i;if(o!==t.toString())return!1;const s=parseInt(a,10);return!(isNaN(s)||s<0||void 0!==n&&s>=n)&&{id:e,content:r,parcelNumber:s}}(e,t,n);if(r){const e=r.parcelNumber,t=await NS(r.id);(!a[e]||t.height<a[e].height||t.height===a[e].height&&t.id<a[e].id)&&(a[e]={...r,height:t.height,inscriptionId:t.id})}}catch(uC){}});await Promise.all(o);for(const e in a)r.add(parseInt(e,10))}catch(uC){}return r}new URLSearchParams(AS.search).get("origin"),"undefined"!=typeof document&&document.getElementById("searchForm")&&document.getElementById("searchForm").addEventListener("submit",async function(e){e.preventDefault();const t=document.getElementById("searchInput").value;document.getElementById("loading").style.display="block";try{const e=parseInt(t,10),n=await async function(e){const t=await mv(e);if(!t)throw new Error("Failed to resolve bitmap inscription id via OCI");return t}(e);if(await NS(n),!(await TS(n)).includes(e.toString()))throw new Error("Invalid bitmap content");let r;if(0!==e)try{r=(await async function(e){const t=th(`/r/blockinfo/${e}`);return await fetch(t).then(e=>{if(!e.ok)throw new Error("Block info not available");return e.json()})}(e)).transaction_count}catch(Kh){}const i=await _S(n,e,r),a={bitmapNumber:e,inscriptionId:n,existingParcels:Array.from(i),existingParcelCount:i.size};"undefined"!=typeof document&&document.getElementById("bitmapInfoPre")&&(document.getElementById("bitmapInfoPre").textContent=JSON.stringify(a,null,2))}catch(Kh){"undefined"!=typeof document&&document.getElementById("bitmapInfoPre")&&(document.getElementById("bitmapInfoPre").textContent="Error retrieving bitmap information.")}finally{"undefined"!=typeof document&&document.getElementById("loading")&&(document.getElementById("loading").style.display="none")}});const PS=async e=>{if(!e)return null;const t=await(async e=>{try{const t=await fetch(th(`/content/${e}`));return await t.text()}catch(uC){return null}})(e.id);if(!t)return null;const n=t.match(/^(\d+)\.bitmap/);return n?parseInt(n[1],10):null};function BS({selectedParents:e=[],onContentChange:t,onContentTypeChange:n,onBatchCreate:r,disabled:i=!1}){const[a,o]=rt.useState(null),[s,l]=rt.useState(null),[c,u]=rt.useState(0),[d,f]=rt.useState(new Set),[p,m]=rt.useState(!1),[h,g]=rt.useState(null),[y,b]=rt.useState(0),[w,x]=rt.useState(!1),[v,S]=rt.useState(!1),[E,I]=rt.useState({}),[k,A]=rt.useState({}),[N,T]=rt.useState(new Set),[_,P]=rt.useState(!1),[B,C]=rt.useState(null),[O,L]=rt.useState(!1),[F,R]=rt.useState(1),[U,M]=rt.useState({x:0,y:0}),[$,H]=rt.useState(!1),[D,z]=rt.useState({x:0,y:0});rt.useEffect(()=>{if(!w)return;const e=e=>{"Escape"===e.key&&x(!1)};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[w]),rt.useEffect(()=>{(async()=>{let t=null;for(const i of e)if(null!==await PS(i)){t=i;break}if(!t)return o(null),l(null),u(0),f(new Set),void g(null);m(!0),g(null),f(new Set);try{const e=await PS(t);o(e),l(t);let i=0;if(window.btcapi&&window.btcapi.getBlockAtHeight)try{const t=await window.btcapi.getBlockAtHeight(e);i=t.tx_count||t.n_tx||0}catch(n){}if(0===i){const t=th(`/r/blockinfo/${e}`),n=await fetch(t);if(!n.ok)throw new Error(`Failed to fetch block info for block ${e}`);i=(await n.json()).transaction_count}u(i),b(e=>e+1),1===F&&0===U.x&&0===U.y&&(i>=12e3?R(3):i>=5e3&&R(2)),P(!0);try{const n=t.id||t.inscriptionId,r=await _S(n,e,i);T(r)}catch(r){}finally{P(!1)}}catch(uC){g(uC.message),o(null),l(null),u(0)}finally{m(!1)}})()},[e]);const W=rt.useCallback((e,t=!1)=>{if(!N.has(e)){if(t&&null!==B){const t=Math.min(B,e),n=Math.max(B,e);f(e=>{const r=new Set(e);for(let i=t;i<=n;i++)N.has(i)||r.add(i);return r})}else f(t=>{const n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n});C(e)}},[N,B]),V=rt.useCallback(()=>{f(e=>{const t=new Set(e);for(let n=0;n<c;n++)N.has(n)||t.add(n);return t})},[c,N]),j=rt.useCallback(()=>{f(new Set)},[]),q=rt.useCallback(()=>{f(e=>{const t=new Set;for(let n=0;n<c;n++)N.has(n)||e.has(n)||t.add(n);return t})},[c,N]),K=rt.useCallback((e,t)=>{N.has(e)||(t?.shiftKey?(W(e,!0),L(!1)):W(e,!1))},[N,W]),X=rt.useCallback((e,t)=>{N.has(e)||L(!0)},[N]),G=rt.useCallback(e=>{O&&!N.has(e)&&f(t=>{const n=new Set(t);return n.add(e),n})},[O,N]);rt.useCallback(()=>{L(!1)},[]),rt.useCallback(()=>{L(!1)},[]),rt.useEffect(()=>{const e=()=>{L(!1)};return window.addEventListener("mouseup",e),()=>window.removeEventListener("mouseup",e)},[]);const Y=rt.useCallback(()=>{R(e=>Math.min(e+.2,3))},[]),J=rt.useCallback(()=>{R(e=>Math.max(e-.2,.5))},[]),Q=rt.useCallback(()=>{R(1),M({x:0,y:0})},[]),Z=rt.useCallback(e=>{(1===e.button||0===e.button&&e.ctrlKey)&&(e.preventDefault(),H(!0),z({x:e.clientX-U.x,y:e.clientY-U.y}))},[U]),ee=rt.useCallback(e=>{$&&M({x:e.clientX-D.x,y:e.clientY-D.y})},[$,D]),te=rt.useCallback(()=>{H(!1)},[]),ne=rt.useCallback(async()=>{if(a&&s){P(!0);try{const e=s.id||s.inscriptionId,t=await _S(e,a,c);T(t),f(e=>{const n=new Set(e);return t.forEach(e=>n.delete(e)),n})}catch(uC){}finally{P(!1)}}},[a,s,c]),re=rt.useCallback(()=>{if(0===d.size||!s)return;const e=Array.from(d).filter(e=>!N.has(e)).map(e=>{const t={content:`${e}.${a}.bitmap`,contentType:"text/plain;charset=utf-8",parent:s.id||s.inscriptionId,metadata:JSON.stringify({name:`${e}.${a}`,type:"parcel",bitmap:a,parcel:e})};return E[e]&&(t.destinationAddress=E[e]),k[e]&&(t.postage=parseInt(k[e],10)),t});r&&r(e)},[d,s,a,E,k,N,r]);return rt.createElement(rt.Fragment,null,rt.createElement("div",{style:{height:"100%",display:"flex",flexDirection:"column",gap:"8px",overflow:"hidden",padding:"4px"}},!a&&rt.createElement("div",{style:{padding:"8px 12px",background:"rgba(74, 144, 226, 0.1)",border:"1px solid rgba(74, 144, 226, 0.3)",borderRadius:"6px"}},rt.createElement("div",{style:{display:"flex",alignItems:"center",gap:"8px"}},rt.createElement("span",{style:{fontSize:"18px"}},"\ud83c\udfa8"),rt.createElement("div",null,rt.createElement("h3",{style:{margin:0,fontSize:"14px",color:"var(--textPrimary)"}},"Bitmap Parcel Selector"),rt.createElement("p",{style:{margin:0,fontSize:"12px",color:"var(--textMuted)"}},"Select bitmap from ",rt.createElement("strong",null,"Parents tab"))))),!a&&!p&&rt.createElement("div",{style:{padding:"24px",textAlign:"center",background:"var(--bgSecondary)",border:"1px solid var(--borderMedium)",borderRadius:"8px"}},rt.createElement("div",{style:{fontSize:"48px",marginBottom:"12px"}},"\ud83d\udfe7"),rt.createElement("h4",{style:{margin:"0 0 8px 0",color:"var(--textPrimary)"}},"Select a Bitmap Parent"),rt.createElement("p",{style:{margin:0,fontSize:"13px",color:"var(--textMuted)"}},"Go to ",rt.createElement("strong",null,"Advanced Options \u2192 Parents"),' and select a bitmap inscription (e.g., "903096.bitmap")')),p&&rt.createElement("div",{style:{padding:"48px",textAlign:"center",background:"var(--bgSecondary)",border:"1px solid var(--borderMedium)",borderRadius:"8px"}},rt.createElement("div",{style:{width:"40px",height:"40px",border:"3px solid rgba(74, 144, 226, 0.2)",borderTop:"3px solid #4A90E2",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 12px"}}),rt.createElement("p",{style:{margin:"0 0 4px 0",fontSize:"13px",color:"var(--textPrimary)",fontWeight:600}},_?"\ud83d\udd0d Validating existing parcels...":"\ud83d\udce6 Loading bitmap data..."),rt.createElement("p",{style:{margin:0,fontSize:"11px",color:"var(--textMuted)"}},_?"Checking on-chain parcel inscriptions":"Fetching block transaction count")),!p&&_&&rt.createElement("div",{style:{padding:"8px 12px",background:"rgba(34, 211, 238, 0.1)",border:"1px solid rgba(34, 211, 238, 0.3)",borderRadius:"6px",fontSize:"11px",color:"#22d3ee",display:"flex",alignItems:"center",gap:"8px"}},rt.createElement("div",{style:{width:"12px",height:"12px",border:"2px solid rgba(34, 211, 238, 0.3)",borderTop:"2px solid #22d3ee",borderRadius:"50%",animation:"spin 0.8s linear infinite"}}),rt.createElement("span",null,"\ud83d\udd0d Validating parcels against on-chain data...")),h&&rt.createElement("div",{style:{padding:"12px",background:"rgba(226, 74, 74, 0.1)",border:"1px solid rgba(226, 74, 74, 0.3)",borderRadius:"8px",color:"#E24A4A",fontSize:"13px"}},"\u26a0\ufe0f ",h),a&&!p&&rt.createElement(rt.Fragment,null,rt.createElement("div",{style:{padding:"6px 12px",background:"var(--bgSecondary)",border:"1px solid var(--borderMedium)",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px"}},rt.createElement("div",{style:{display:"flex",gap:"12px",alignItems:"center"}},rt.createElement("img",{src:th("/content/fd169fd8f99b152105b0d2d1cb98189d5d80b100d178b84195bf19d1525c5a50i0"),alt:"Bitmap",style:{width:"20px",height:"20px"}}),rt.createElement("div",null,rt.createElement("span",{style:{fontSize:"13px",fontWeight:600,color:"var(--textPrimary)"}},a,".bitmap"),rt.createElement("span",{style:{fontSize:"11px",color:"var(--textMuted)",marginLeft:"8px"}},c," parcels"))),rt.createElement("div",{style:{display:"flex",gap:"6px",alignItems:"center",flexWrap:"wrap"}},rt.createElement("span",{style:{fontSize:"12px",fontWeight:600,color:"#4A90E2"}},d.size," selected"),N.size>0&&rt.createElement("span",{style:{fontSize:"11px",color:"#E24A4A",fontWeight:500}},"(",N.size," exist)"),rt.createElement("button",{onClick:ne,disabled:_||i,title:"Refresh parcel validation (auto-validates on load)",style:{padding:"3px 6px",background:_?"rgba(74, 144, 226, 0.2)":"rgba(34, 211, 238, 0.2)",border:"1px solid rgba(34, 211, 238, 0.4)",borderRadius:"3px",color:"var(--textPrimary)",fontSize:"10px",cursor:_?"wait":"pointer",transition:"all 0.2s",opacity:_||i?.6:1}},_?"\u23f3 Checking...":"\ud83d\udd04 Refresh"),rt.createElement("button",{onClick:V,disabled:i,title:"Select all available parcels",style:{padding:"3px 6px",background:"rgba(34, 197, 94, 0.2)",border:"1px solid rgba(34, 197, 94, 0.4)",borderRadius:"3px",color:"var(--textPrimary)",fontSize:"10px",cursor:"pointer",transition:"all 0.2s"}},"\u2713 All"),rt.createElement("button",{onClick:j,disabled:i,title:"Deselect all parcels",style:{padding:"3px 6px",background:"rgba(239, 68, 68, 0.2)",border:"1px solid rgba(239, 68, 68, 0.4)",borderRadius:"3px",color:"var(--textPrimary)",fontSize:"10px",cursor:"pointer",transition:"all 0.2s"}},"\u2717 None"),rt.createElement("button",{onClick:q,disabled:i,title:"Invert selection",style:{padding:"3px 6px",background:"rgba(168, 85, 247, 0.2)",border:"1px solid rgba(168, 85, 247, 0.4)",borderRadius:"3px",color:"var(--textPrimary)",fontSize:"10px",cursor:"pointer",transition:"all 0.2s"}},"\u21c4 Invert"),rt.createElement("button",{onClick:()=>S(!v),title:v?"Switch to Mondrian view":"Switch to list view",style:{padding:"3px 6px",background:v?"rgba(74, 144, 226, 0.3)":"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(74, 144, 226, 0.4)",borderRadius:"3px",color:"var(--textPrimary)",fontSize:"10px",cursor:"pointer",transition:"all 0.2s"}},v?"\ud83c\udfa8 Pattern":"\ud83d\udccb List"),!v&&rt.createElement("button",{onClick:()=>x(!w),title:w?"Exit fullscreen":"Fullscreen",style:{padding:"3px 6px",background:w?"rgba(74, 144, 226, 0.3)":"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(74, 144, 226, 0.4)",borderRadius:"3px",color:"var(--textPrimary)",fontSize:"10px",cursor:"pointer",transition:"all 0.2s"}},w?"\u22a1 Exit":"\u26f6 Full"))),!v&&!w&&rt.createElement("div",{style:{flex:1,minHeight:0,display:"flex",flexDirection:"column",background:"var(--bgSecondary)",border:"1px solid var(--borderMedium)",borderRadius:"6px",overflow:"hidden"}},rt.createElement("div",{style:{padding:"6px 12px",background:"rgba(0, 0, 0, 0.3)",borderBottom:"1px solid var(--borderMedium)",fontSize:"10px",color:"var(--textMuted)",display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"8px"}},rt.createElement("div",{style:{display:"flex",gap:"8px",alignItems:"center"}},rt.createElement("span",null,"\ud83d\udca1 Click and hold to select multiple \u2022 Shift+Click for range")),rt.createElement("div",{style:{display:"flex",gap:"12px",alignItems:"center",flexWrap:"wrap"}},rt.createElement("span",{style:{color:"#f79a27",fontSize:"10px"}},"\u25fc Available"),rt.createElement("span",{style:{color:"#00e5ff",fontSize:"10px"}},"\u25fc Selected"),rt.createElement("span",{style:{color:"#E24A4A",fontSize:"10px"}},"\u25fc Exists"),rt.createElement("div",{style:{display:"flex",gap:"2px",alignItems:"center",marginLeft:"8px"}},rt.createElement("button",{onClick:J,title:"Zoom out",style:{padding:"2px 4px",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"2px",color:"white",fontSize:"10px",cursor:"pointer",lineHeight:1}},"\u2212"),rt.createElement("span",{style:{fontSize:"9px",minWidth:"30px",textAlign:"center"}},Math.round(100*F),"%"),rt.createElement("button",{onClick:Y,title:"Zoom in",style:{padding:"2px 4px",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"2px",color:"white",fontSize:"10px",cursor:"pointer",lineHeight:1}},"+"),rt.createElement("button",{onClick:Q,title:"Reset zoom and pan",style:{padding:"2px 4px",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"2px",color:"white",fontSize:"9px",cursor:"pointer",lineHeight:1}},"\u27f2")))),rt.createElement("div",{style:{flex:1,minHeight:0,display:"flex",alignItems:"center",justifyContent:"center",padding:"8px",overflow:"hidden",background:"black",cursor:$?"grabbing":F>1?"grab":"default",userSelect:"none",position:"relative"},onMouseDown:Z,onMouseMove:ee,onMouseUp:te,onMouseLeave:te},rt.createElement("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",transform:`scale(${F}) translate(${U.x/F}px, ${U.y/F}px)`,transformOrigin:"center center",transition:$?"none":"transform 0.1s ease-out"}},rt.createElement(Px,{blockNumber:a,highlightParcels:Array.from(d),existingParcels:N,size:"auto",measureKey:y,className:"bitmap-renderer",onParcelMouseDown:X,onParcelClick:K,onParcelMouseEnter:G})))),v&&rt.createElement("div",{style:{flex:1,minHeight:0,background:"var(--bgSecondary)",border:"1px solid var(--borderMedium)",borderRadius:"6px",overflow:"auto",padding:"8px"}},rt.createElement("div",{style:{fontSize:"11px",fontWeight:600,color:"var(--textMuted)",marginBottom:"8px",padding:"0 4px",textTransform:"uppercase",letterSpacing:"0.5px"}},"All Parcels (0-",c-1,")"),rt.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"4px"}},Array.from({length:c},(e,t)=>{const n=N.has(t),r=d.has(t);return rt.createElement("div",{key:t,style:{display:"grid",gridTemplateColumns:"auto 130px 1fr auto",gap:"6px",alignItems:"center",padding:"4px 6px",background:n?"rgba(226, 74, 74, 0.1)":r?"rgba(0, 229, 255, 0.15)":"rgba(0, 0, 0, 0.2)",border:n?"1px solid rgba(226, 74, 74, 0.4)":r?"1px solid rgba(0, 229, 255, 0.4)":"1px solid rgba(255, 255, 255, 0.1)",borderRadius:"4px",fontSize:"11px",opacity:n?.6:1}},rt.createElement("input",{type:"checkbox",checked:r&&!n,onChange:()=>!n&&W(t),disabled:i||n,title:n?"This parcel already exists":"",style:{cursor:i||n?"not-allowed":"pointer",margin:0}}),rt.createElement("span",{style:{fontFamily:"var(--fontFamily-mono)",color:n?"#E24A4A":r?"#00e5ff":"var(--textPrimary)",fontWeight:r?600:400,fontSize:"11px",whiteSpace:"nowrap"}},t,".",a,n&&rt.createElement("span",{title:"Already exists"},"\u26a0\ufe0f")),rt.createElement("input",{type:"text",placeholder:"Address (optional)",value:E[t]||"",onChange:e=>I(n=>({...n,[t]:e.target.value})),disabled:i||!r||n,style:{padding:"3px 6px",background:"rgba(0, 0, 0, 0.3)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"3px",color:"var(--textPrimary)",fontSize:"10px",fontFamily:"var(--fontFamily-mono)",opacity:r&&!n?1:.4}}),rt.createElement("input",{type:"number",placeholder:"Postage",value:k[t]||"",onChange:e=>A(n=>({...n,[t]:e.target.value})),disabled:i||!r||n,min:"546",title:"Postage amount in sats (min 546)",style:{width:"70px",padding:"3px 6px",background:"rgba(0, 0, 0, 0.3)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"3px",color:"var(--textPrimary)",fontSize:"10px",fontFamily:"var(--fontFamily-mono)",opacity:r&&!n?1:.4}}))}))),d.size>0&&rt.createElement("div",{style:{padding:"8px 12px",background:"var(--bgSecondary)",border:"1px solid var(--borderMedium)",borderRadius:"6px",display:"flex",gap:"12px",alignItems:"center",justifyContent:"space-between"}},rt.createElement("div",{style:{flex:1,minWidth:0}},rt.createElement("div",{style:{fontSize:"11px",fontWeight:600,color:"var(--textMuted)",marginBottom:"4px",textTransform:"uppercase",letterSpacing:"0.5px"}},"Selected: ",d.size," parcel",1!==d.size?"s":""),rt.createElement("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px",maxHeight:"60px",overflow:"auto"}},Array.from(d).sort((e,t)=>e-t).map(e=>rt.createElement("span",{key:e,style:{padding:"2px 6px",background:"rgba(0, 229, 255, 0.2)",border:"1px solid rgba(0, 229, 255, 0.4)",borderRadius:"3px",fontSize:"10px",color:"#00e5ff",fontFamily:"var(--fontFamily-mono)",whiteSpace:"nowrap"}},e)))),rt.createElement("button",{onClick:re,disabled:i,style:{padding:"10px 20px",background:i?"var(--bgTertiary)":"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",border:"none",borderRadius:"6px",color:"white",fontSize:"13px",fontWeight:600,cursor:i?"not-allowed":"pointer",opacity:i?.5:1,transition:"all 0.2s",whiteSpace:"nowrap",flexShrink:0}},i?"\u23f3 Inscribing...":`Create ${d.size}`)))),!v&&w&&wt.createPortal(rt.createElement("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:9999,background:"black",display:"flex",flexDirection:"column"}},rt.createElement("div",{style:{padding:"12px 20px",background:"rgba(0, 0, 0, 0.8)",borderBottom:"1px solid rgba(255, 255, 255, 0.1)",fontSize:"11px",color:"var(--textMuted)",display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"12px"}},rt.createElement("div",{style:{display:"flex",gap:"16px",alignItems:"center"}},rt.createElement("span",null,"\ud83d\udca1 Click and hold to select multiple \u2022 Shift+Click for range \u2022 Ctrl+Drag to pan"),rt.createElement("span",{style:{color:"#f79a27",fontSize:"11px"}},"\u25fc Available"),rt.createElement("span",{style:{color:"#00e5ff",fontSize:"11px"}},"\u25fc Selected"),rt.createElement("span",{style:{color:"#E24A4A",fontSize:"11px"}},"\u25fc Exists"),rt.createElement("div",{style:{display:"flex",gap:"4px",alignItems:"center"}},rt.createElement("button",{onClick:J,title:"Zoom out",style:{padding:"4px 8px",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"3px",color:"white",fontSize:"11px",cursor:"pointer"}},"\u2212"),rt.createElement("span",{style:{fontSize:"10px",minWidth:"35px",textAlign:"center"}},Math.round(100*F),"%"),rt.createElement("button",{onClick:Y,title:"Zoom in",style:{padding:"4px 8px",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"3px",color:"white",fontSize:"11px",cursor:"pointer"}},"+"),rt.createElement("button",{onClick:Q,title:"Reset zoom and pan",style:{padding:"4px 8px",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"3px",color:"white",fontSize:"10px",cursor:"pointer"}},"\u27f2"))),rt.createElement("button",{onClick:()=>x(!1),style:{padding:"4px 12px",background:"rgba(226, 74, 74, 0.3)",border:"1px solid rgba(226, 74, 74, 0.5)",borderRadius:"4px",color:"white",fontSize:"11px",cursor:"pointer",fontWeight:500}},"\u2715 Close Fullscreen")),rt.createElement("div",{style:{flex:1,minHeight:0,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px",overflow:"hidden",cursor:$?"grabbing":F>1?"grab":"default",userSelect:"none",position:"relative"},onMouseDown:Z,onMouseMove:ee,onMouseUp:te,onMouseLeave:te},rt.createElement("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",transform:`scale(${F}) translate(${U.x/F}px, ${U.y/F}px)`,transformOrigin:"center center",transition:$?"none":"transform 0.1s ease-out"}},rt.createElement(Px,{blockNumber:a,highlightParcels:Array.from(d),existingParcels:N,size:"auto",measureKey:`fullscreen-${y}`,className:"bitmap-renderer-fullscreen",onParcelMouseDown:X,onParcelClick:K,onParcelMouseEnter:G})))),document.body))}function CS({content:e="",contentType:t="text/plain",contentSize:n,onContentChange:r,onContentTypeChange:i,onContentEncodingChange:a,compressBeforeInscribe:o=!1,onCompressBeforeInscribeChange:s,fileName:l="",onFileNameChange:c,onImportJson:u,showTemplates:d=!0,feeRate:f=5,onFeeRateChange:p,feeEstimate:m,walletAddress:h,walletState:g,walletInscriptions:y=[],selectedUtxos:b=[],onUtxosChange:w,onUtxoSelect:x,onFeesLoaded:v,onFilteredUtxosLoaded:S,utxoRescanRequestId:E=0,onUtxoScanStateChange:I,walletAssetScanState:k=null,onRequestWalletRescan:A,showUtxoTab:N=!0,selectedParents:T=[],reinscriptionTarget:_=null,delegateId:P="",metaprotocol:B="",metadata:C="",properties:O="",customTags:L=null,pointer:F="",contentEncoding:R="",recipientAddress:U="",repeatCount:M=1,onRepeatCountChange:$,batchItems:H=[],onAddToBatch:D,onRemoveFromBatch:z,onEditBatchItem:W,inscriptionMode:V="standard",inscribing:j=!1,selectedSaleInscription:q,salePriceSats:K="",onSalePriceSatsChange:X,listingScriptAddress:G="",onListingScriptAddressChange:Y,markerValueSats:J="",onMarkerValueSatsChange:Q,listingDryRun:Z=!1,onListingDryRunChange:ee,onCreateListingTx:te,onCreateBulkListingTx:ne,createListingDisabled:re=!1,sellerStatus:ie="",sellerError:ae="",bulkSellerStatus:oe="",bulkSellerError:se="",bulkBundleJson:le="",collectionAuthoritySlots:ce=[],collectionAuthorityStatus:ue="",collectionAuthorityError:de="",collectionAuthoritySlotId:fe="",onCollectionAuthoritySlotIdChange:pe,onLaunchCollection:me,onLaunchParcelManifest:he,buyRevealTxid:ge="",onBuyRevealTxidChange:ye,onBuyFromRevealTx:be,buyDisabled:we=!1,buyFundingNeeded:xe=!1,onCreateBuyFundingTx:ve,buyFundingDisabled:Se=!1,buyFundingStatus:Ee="",buyFundingError:Ie="",saleMinBlockHeight:ke,onSaleMinBlockHeightChange:Ae,buyStatus:Ne="",buyError:Te="",manualSellerPsbt:_e="",manualSellerStatus:Pe="",manualSellerError:Be="",onCreateManualSellerOfferPsbt:Ce,manualBuyStatus:Oe="",manualBuyError:Le="",onBuyFromSellerOfferPsbt:Fe,manualBuyerFundedPsbt:Re="",manualBuyerFundedStatus:Ue="",manualBuyerFundedError:Me="",onCreateBuyerFundedPsbtForSeller:$e,manualSellerCountersignStatus:He="",manualSellerCountersignError:De="",onCountersignAndBroadcastFromBuyerFundedPsbt:ze,onOodlLayoutChange:We,oodlSection:Ve,onOodlSectionChange:je,onActiveTabChange:qe,tabRequest:Ke=null}){const[Xe,Ge]=rt.useState((()=>{const e=String(Ke?.tab||"").trim();return e&&("utxos"!==e||N)?e:!N||b&&0!==b.length?"text":"utxos"})()),[Ye,Je]=rt.useState(!1),[Qe,Ze]=rt.useState(!1),[et,tt]=rt.useState(null),[nt,it]=rt.useState(!1),at=rt.useRef(Ke?.seq??-1);rt.useEffect(()=>{qe&&qe(Xe)},[Xe,qe]),rt.useEffect(()=>{if(!Ke)return;const{tab:e,seq:t}=Ke;if(null==t||t===at.current)return;at.current=t;const n=String(e||"").trim();n&&n!==Xe&&("utxos"!==n||N)&&(it("utxos"===n),Ge(n))},[Ke,Xe,N]);const ot=rt.useMemo(()=>'{\n  "version": 1,\n  "feeRate": 8,\n  "fees": {\n    "developer": {\n      "enabled": false,\n      "mode": "transaction",\n      "address": "bc1pYOUR_DEV_FEE_ADDRESS_HERE",\n      "amountSats": 1000,\n      "description": "Developer API Fee"\n    },\n    "customFees": []\n  },\n  "defaults": {\n    "contentType": "text/plain",\n    "metaprotocol": "ord",\n    "metadata": {\n      "app": "oodinals",\n      "note": "Working test JSON: Apply JSON, then Inscribe. Optional: enable fees.developer and set a real address."\n    },\n    "properties": {\n      "collection": "Test",\n      "createdBy": "JSON Import"\n    },\n    "postage": 546\n  },\n  "items": [\n    {\n      "fileName": "hello-1.txt",\n      "content": "Hello from Oodinals JSON!\\n\\nThis is item #1.",\n      "repeatCount": 1\n    },\n    {\n      "fileName": "hello-2.txt",\n      "content": "Hello again \u2014 item #2.",\n      "repeatCount": 1,\n      "customTags": {\n        "101": "per-item-tag"\n      }\n    },\n    {\n      "fileName": "bytes.bin",\n      "contentType": "application/octet-stream",\n      "contentBase64": "AAECAwQFBgcICQ=="\n    }\n  ]\n}',[]),[st,lt]=rt.useState(ot),[ct,ut]=rt.useState(""),dt=rt.useRef(Xe);rt.useEffect(()=>{dt.current=Xe},[Xe]);const ft=rt.useCallback(t=>{!nt&&!Qe&&"utxos"===dt.current&&t&&t.spendable&&t.spendable.length>0&&(e&&"string"!=typeof e&&(e instanceof ArrayBuffer||"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(e)||"[object ArrayBuffer]"===Object.prototype.toString.call(e))?Ge("upload"):(a&&R&&a(""),Ge("text")),Ze(!0));const n=t?.spendable?JSON.stringify(t.spendable.map(e=>`${e.txid}:${e.vout}`)):null;S&&n!==et&&(tt(n),S(t))},[S,et,nt,Qe,a,R,e]);rt.useEffect(()=>{g?.isConnected&&b&&0!==b.length||Qe&&Ze(!1)},[g?.isConnected,b,Qe]);const pt=[{value:"text/plain",label:"Plain Text",icon:"\ud83d\udcc4",color:"#06b6d4"},{value:"text/html",label:"HTML",icon:"\ud83c\udf10",color:"#a855f7"},{value:"text/javascript",label:"JavaScript",icon:"\u26a1",color:"#f59e0b"},{value:"application/json",label:"JSON",icon:"\ud83d\udcca",color:"#10b981"},{value:"text/markdown",label:"Markdown",icon:"\ud83d\udcdd",color:"#22c55e"},{value:"application/xml",label:"XML",icon:"\ud83e\udde9",color:"#60a5fa"},{value:"text/yaml",label:"YAML",icon:"\ud83e\uddfe",color:"#f97316"},{value:"application/typescript",label:"TypeScript",icon:"\ud83e\udde0",color:"#3b82f6"},{value:"text/css",label:"CSS",icon:"\ud83c\udfa8",color:"#ec4899"},{value:"image/svg+xml",label:"SVG",icon:"\ud83d\uddbc\ufe0f",color:"#8b5cf6"},{value:"image/png",label:"PNG Image",icon:"\ud83d\uddbc\ufe0f",color:"#06b6d4"},{value:"image/jpeg",label:"JPEG Image",icon:"\ud83d\udcf7",color:"#f59e0b"},{value:"image/webp",label:"WebP Image",icon:"\ud83c\udf9e\ufe0f",color:"#10b981"},{value:"image/avif",label:"AVIF Image",icon:"\ud83d\uddbc\ufe0f",color:"#10b981"}],mt=[{name:"Simple Text",contentType:"text/plain",content:"Hello, Bitcoin! This is my inscription."},{name:"BRC-20 Token",contentType:"application/json",content:JSON.stringify({p:"brc-20",op:"deploy",tick:"ordi",max:"21000000",lim:"1000"},null,2)},{name:"HTML Page",contentType:"text/html",content:"<!DOCTYPE html>\n<html>\n<head>\n  <title>My Inscription</title>\n  <style>\n    body { \n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      color: white;\n      font-family: Arial, sans-serif;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      height: 100vh;\n      margin: 0;\n    }\n  </style>\n</head>\n<body>\n  <h1>Hello from Bitcoin!</h1>\n</body>\n</html>"},{name:"SVG Art",contentType:"image/svg+xml",content:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">\n  <circle cx="50" cy="50" r="40" fill="#a855f7" />\n  <text x="50" y="55" text-anchor="middle" fill="white" font-size="20">\u20bf</text>\n</svg>'},{name:"Metadata JSON",contentType:"application/json",content:JSON.stringify({name:"My Inscription",description:"A unique digital artifact on Bitcoin",attributes:[{trait_type:"Rarity",value:"Legendary"},{trait_type:"Type",value:"Genesis"}]},null,2)}],ht=rt.useCallback(e=>{a&&R&&a(""),r&&r(e.target.value)},[r,a,R]),gt=rt.useCallback(async e=>{if(e)try{const t=(e.type||"").trim();c&&c(e.name||"");const n=async e=>{const t=(e.name||"").toLowerCase();if(t.endsWith(".gz"))return"gzip";if(t.endsWith(".br"))return"br";const n=e.slice(0,4),r=await n.arrayBuffer(),i=new Uint8Array(r);if(i.length>=2){if(31===i[0]&&139===i[1])return"gzip";if(120===i[0]&&(1===i[1]||94===i[1]||156===i[1]||218===i[1]))return"deflate"}return""},o=e=>{const t=(e||"").toLowerCase().replace(/\.(gz|br)$/i,""),n=t.split("/").pop()||t;return!n.includes(".")&&new Set(["nexus-core","nexus-loader","nexus-unified","oordinals-sdk"]).has(n)?"application/javascript":t.endsWith(".json")?"application/json":t.endsWith(".html")||t.endsWith(".htm")?"text/html":t.endsWith(".md")||t.endsWith(".markdown")?"text/markdown":t.endsWith(".txt")?"text/plain":t.endsWith(".xml")?"application/xml":t.endsWith(".yaml")||t.endsWith(".yml")?"text/yaml":t.endsWith(".csv")?"text/csv":t.endsWith(".js")||t.endsWith(".mjs")||t.endsWith(".cjs")||t.endsWith(".jsx")?"application/javascript":t.endsWith(".ts")||t.endsWith(".tsx")?"application/typescript":t.endsWith(".map")?"application/json":t.endsWith(".css")?"text/css":t.endsWith(".svg")?"image/svg+xml":t.endsWith(".png")?"image/png":t.endsWith(".jpg")||t.endsWith(".jpeg")?"image/jpeg":t.endsWith(".gif")?"image/gif":t.endsWith(".webp")?"image/webp":t.endsWith(".avif")?"image/avif":t.endsWith(".ico")?"image/x-icon":t.endsWith(".bmp")?"image/bmp":t.endsWith(".tif")||t.endsWith(".tiff")?"image/tiff":t.endsWith(".pdf")?"application/pdf":t.endsWith(".wasm")?"application/wasm":t.endsWith(".zip")?"application/zip":t.endsWith(".tar")?"application/x-tar":t.endsWith(".mp4")?"video/mp4":t.endsWith(".webm")?"video/webm":t.endsWith(".ogg")?"audio/ogg":t.endsWith(".mp3")?"audio/mpeg":t.endsWith(".wav")?"audio/wav":t.endsWith(".flac")?"audio/flac":t.endsWith(".gltf")?"model/gltf+json":t.endsWith(".glb")?"model/gltf-binary":t.endsWith(".epub")?"application/epub+zip":null},s=await n(e);a&&a(s);let l=null;if(!s)try{const t=new Uint8Array(await e.slice(0,32).arrayBuffer()),n=(e,t,n=0)=>t.every((t,r)=>e[n+r]===t),r=e=>Array.from(e).map(e=>e.charCodeAt(0));if(n(t,[137,80,78,71,13,10,26,10]))l="image/png";else if(n(t,[255,216,255]))l="image/jpeg";else if(n(t,r("GIF8")))l="image/gif";else if(n(t,[37,80,68,70,45]))l="application/pdf";else if(n(t,[0,97,115,109]))l="application/wasm";else if(n(t,r("RIFF")))n(t,r("WEBP"),8)?l="image/webp":n(t,r("WAVE"),8)&&(l="audio/wav");else if(n(t,r("OggS")))l="audio/ogg";else if(n(t,r("fLaC")))l="audio/flac";else if(n(t,r("ftyp"),4)){const e=e=>String.fromCharCode(t[e]||0,t[e+1]||0,t[e+2]||0,t[e+3]||0),n=e(8),r=new Set([n]);for(let i=16;i+3<t.length;i+=4)r.add(e(i));if(r.has("avif")||r.has("avis"))l="image/avif";else{const e=new Set(["isom","iso2","mp41","mp42","avc1","dash","MSNV"]);for(const t of r)if(e.has(t)){l="video/mp4";break}}}else n(t,r("glTF"))?l="model/gltf-binary":n(t,[80,75,3,4])&&(l="application/zip")}catch{}let u=t||"application/octet-stream";if(s){const t=o(e.name);t&&(u=t)}else if(l)u=l;else{const t=o(e.name);t&&(u=t)}if(a&&R&&a(""),!("application/octet-stream"!==u||t&&"application/octet-stream"!==t||l)){const t=s?"This file appears encoded (e.g. .br/.gz). If it is a JS bundle, use application/javascript.":"Common values: text/plain, application/json, text/html, application/javascript, image/png, application/wasm.",n=(window.prompt(`Unknown content type for "${e.name||"uploaded file"}".\n\n${t}\n\nEnter MIME type (or leave blank for application/octet-stream):`,"application/octet-stream")||"").trim();n&&(u=n)}if(!s&&(u.startsWith("text/")||u.includes("json")||u.includes("javascript")||u.includes("xml")||u.includes("yaml")||u.includes("typescript"))){const t=await e.text();r&&r(t),i&&i(u)}else if(!s&&u.startsWith("image/")){const t=await e.arrayBuffer();r&&r(t),i&&i(u)}else{const t=await e.arrayBuffer();r&&r(t),i&&i(u||"application/octet-stream")}}catch(Kh){alert("Error reading file: "+Kh.message)}},[r,i,a,c]),yt=rt.useCallback(e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?Je(!0):"dragleave"===e.type&&Je(!1)},[]),bt=rt.useCallback(e=>{e.preventDefault(),e.stopPropagation(),Je(!1),e.dataTransfer.files&&e.dataTransfer.files[0]&&gt(e.dataTransfer.files[0])},[gt]),wt=rt.useCallback(e=>{r&&r(e.content),i&&i(e.contentType),a&&a(""),c&&c(""),Ge("text")},[r,i,a,c]),xt=new Blob([e]).size,vt="number"==typeof n?n:xt,St=rt.useMemo(()=>!!e&&"string"!=typeof e&&(e instanceof ArrayBuffer||!("undefined"==typeof ArrayBuffer||!ArrayBuffer.isView||!ArrayBuffer.isView(e))||"[object ArrayBuffer]"===Object.prototype.toString.call(e)),[e]),Et="utxos"!==Xe&&"oodl"!==Xe;return rt.createElement("div",{className:"content-editor inscription-card",style:{height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",minWidth:0}},"oodl"!==Xe&&"utxos"!==Xe?rt.createElement("div",{className:"inscription-card-header content-editor-header",style:{padding:"4px 8px",flexShrink:0,background:"rgb(23, 23, 23)",borderBottom:"1px solid rgb(38, 38, 38)",borderRadius:"12px 12px 0 0",overflow:"hidden"}},rt.createElement("div",{className:"content-editor-header-main",style:{minWidth:0,width:"100%"}},rt.createElement("div",{className:"content-editor-tabs"},Et?rt.createElement(rt.Fragment,null,rt.createElement("button",{className:"tab-button "+("text"===Xe?"active":""),onClick:()=>{it(!1),St?Ge("upload"):(a&&R&&a(""),Ge("text"))},style:{background:"text"===Xe?"var(--bgTertiary)":"transparent",border:"none",borderBottom:"text"===Xe?"2px solid var(--accentPurple)":"2px solid transparent",padding:"6px 12px",color:"text"===Xe?"var(--textPrimary)":"var(--textMuted)",fontWeight:"var(--fontWeight-medium)",fontSize:"13px",cursor:"pointer",transition:"var(--transition-fast)"}},"\u270d\ufe0f Text"),rt.createElement("button",{className:"tab-button "+("upload"===Xe?"active":""),onClick:()=>{it(!1),Ge("upload")},style:{background:"upload"===Xe?"var(--bgTertiary)":"transparent",border:"none",borderBottom:"upload"===Xe?"2px solid var(--accentPurple)":"2px solid transparent",padding:"6px 12px",color:"upload"===Xe?"var(--textPrimary)":"var(--textMuted)",fontWeight:"var(--fontWeight-medium)",fontSize:"13px",cursor:"pointer",transition:"var(--transition-fast)"}},"\ud83d\udce4 Upload"),d?rt.createElement("button",{className:"tab-button "+("templates"===Xe?"active":""),onClick:()=>{it(!1),Ge("templates")},style:{background:"templates"===Xe?"var(--bgTertiary)":"transparent",border:"none",borderBottom:"templates"===Xe?"2px solid var(--accentPurple)":"2px solid transparent",padding:"6px 12px",color:"templates"===Xe?"var(--textPrimary)":"var(--textMuted)",fontWeight:"var(--fontWeight-medium)",fontSize:"13px",cursor:"pointer",transition:"var(--transition-fast)"}},"\ud83d\udccb Templates"):null,rt.createElement("button",{className:"tab-button "+("json"===Xe?"active":""),onClick:()=>{it(!1),Ge("json")},style:{background:"json"===Xe?"var(--bgTertiary)":"transparent",border:"none",borderBottom:"json"===Xe?"2px solid var(--accentPurple)":"2px solid transparent",padding:"6px 12px",color:"json"===Xe?"var(--textPrimary)":"var(--textMuted)",fontWeight:"var(--fontWeight-medium)",fontSize:"13px",cursor:"pointer",transition:"var(--transition-fast)"},title:"Paste a JSON spec to populate draft or batch"},"\ud83e\uddfe JSON"),rt.createElement("button",{className:"tab-button "+("bitmap"===Xe?"active":""),onClick:()=>{it(!1),Ge("bitmap")},style:{background:"bitmap"===Xe?"var(--bgTertiary)":"transparent",border:"none",borderBottom:"bitmap"===Xe?"2px solid var(--accentPurple)":"2px solid transparent",padding:"6px 12px",color:"bitmap"===Xe?"var(--textPrimary)":"var(--textMuted)",fontWeight:"var(--fontWeight-medium)",fontSize:"13px",cursor:"pointer",transition:"var(--transition-fast)"}},"\ud83d\udfe7 Bitmap/Parcels"),rt.createElement("button",{className:"tab-button "+("review"===Xe?"active":""),onClick:()=>{it(!1),Ge("review")},style:{background:"review"===Xe?"var(--bgTertiary)":"transparent",border:"none",borderBottom:"review"===Xe?"2px solid var(--accentPurple)":"2px solid transparent",padding:"6px 12px",color:"review"===Xe?"var(--textPrimary)":"var(--textMuted)",fontWeight:"var(--fontWeight-medium)",fontSize:"13px",cursor:"pointer",transition:"var(--transition-fast)"},title:"Review batch items and inscribe"},"\ud83d\udccb Review")):null))):null,rt.createElement("div",{style:{flex:1,minHeight:0,display:"flex",flexDirection:"column",overflow:"hidden"}},rt.createElement("div",{style:{flex:1,minHeight:0,padding:"8px",overflow:"hidden"}},rt.createElement("div",{style:{height:"100%",overflow:"hidden"}},N&&rt.createElement("div",{style:{display:"utxos"===Xe?"block":"none"},"aria-hidden":"utxos"!==Xe},rt.createElement(Zw,{walletAddress:h,walletState:g,selectedUtxos:b,onUtxosChange:w,onUtxoSelect:x,onFeesLoaded:v,onFilteredUtxosLoaded:ft,rescanRequestId:E,onScanStateChange:I,autoFetch:!0,minUtxoValue:1e4,requiredAmount:m?.totalRequired||0})),"text"===Xe&&rt.createElement("div",{className:"fade-in",style:{height:"100%",position:"relative"}},rt.createElement("div",{style:{position:"absolute",top:"8px",right:"8px",zIndex:10}},rt.createElement("div",{style:{display:"flex",gap:"8px"}},rt.createElement("select",{className:"form-select",value:t,onChange:e=>i&&i(e.target.value),title:"Quick select common MIME types",style:{fontSize:"11px",padding:"4px 8px",background:"rgba(23, 23, 23, 0.95)",border:"1px solid rgb(64, 64, 64)",borderRadius:"6px",color:"rgb(212, 212, 212)"}},pt.map(e=>rt.createElement("option",{key:e.value,value:e.value},e.icon," ",e.label))),rt.createElement("input",{type:"text",className:"form-input",value:t,onChange:e=>i&&i(e.target.value),placeholder:"Custom MIME type (e.g. application/pdf)",title:"Enter any MIME type. This becomes tag 1 in the envelope.",style:{fontSize:"11px",padding:"4px 8px",background:"rgba(23, 23, 23, 0.95)",border:"1px solid rgb(64, 64, 64)",borderRadius:"6px",color:"rgb(212, 212, 212)",minWidth:"220px"}}))),St&&rt.createElement("div",{className:"validation-warning",style:{marginBottom:"8px"}},rt.createElement("span",null,"\u26a0\ufe0f"),rt.createElement("div",null,"Binary/encoded content is loaded. Use the Upload tab (Text editor is disabled for this content).")),rt.createElement("textarea",{className:"form-input form-textarea",value:"string"==typeof e?e:"",onChange:ht,placeholder:"Enter your inscription content here...",disabled:St,style:{minHeight:"100%",height:"100%",fontFamily:"var(--fontFamily-mono)",fontSize:"13px",lineHeight:"1.5",resize:"none",paddingTop:"40px"}})),"json"===Xe&&rt.createElement("div",{className:"fade-in",style:{height:"100%",display:"flex",flexDirection:"column",gap:"10px"}},rt.createElement("div",{style:{background:"rgba(23, 23, 23, 0.6)",border:"1px solid rgb(38, 38, 38)",borderRadius:"10px",padding:"10px"}},rt.createElement("div",{style:{fontSize:"13px",fontWeight:700,color:"var(--textPrimary)",marginBottom:"6px"}},"\ud83e\uddfe JSON Import"),rt.createElement("div",{style:{fontSize:"12px",color:"var(--textMuted)",lineHeight:1.4}},"Paste a JSON spec to build a single inscription or a batch. If the JSON contains ",rt.createElement("span",{style:{fontFamily:"monospace"}},"items"),", it will replace the current batch.")),rt.createElement("textarea",{value:st,onChange:e=>{lt(e.target.value),ct&&ut("")},placeholder:'{\n  "version": 1,\n  "feeRate": 8,\n  "item": {\n    "contentType": "text/plain",\n    "content": "Hello",\n    "parentIds": ["<txid>i0"],\n    "delegateId": "<txid>i0"\n  }\n}',style:{flex:1,width:"100%",resize:"none",padding:"10px",borderRadius:"10px",border:"1px solid rgb(64, 64, 64)",background:"rgba(10, 10, 10, 0.7)",color:"rgb(212, 212, 212)",fontFamily:"monospace",fontSize:"12px",lineHeight:1.35}}),ct&&rt.createElement("div",{style:{background:"rgba(239, 68, 68, 0.12)",border:"1px solid rgba(239, 68, 68, 0.35)",borderRadius:"10px",padding:"10px",color:"rgb(252, 165, 165)",fontSize:"12px"}},ct),rt.createElement("div",{style:{display:"flex",gap:"10px",justifyContent:"flex-end"}},rt.createElement("button",{onClick:()=>{try{if(!u)return void ut("JSON import is not available in this build.");const e=String(st||"").trim();if(!e)return void ut("Paste a JSON spec first.");u(e)}catch(cC){ut(cC?.message||String(cC))}},className:"px-4 py-2 rounded-lg bg-purple-600 hover:bg-purple-500 text-white transition-colors",style:{fontSize:"12px",fontWeight:700}},"Apply JSON"))),"upload"===Xe&&rt.createElement("div",{className:"fade-in"},rt.createElement("div",{className:"file-drop-zone "+(Ye?"active":""),onDragEnter:yt,onDragLeave:yt,onDragOver:yt,onDrop:bt,style:{border:"2px dashed "+(Ye?"var(--accentPurple)":"var(--borderMedium)"),borderRadius:"var(--radius-lg)",padding:"30px 20px",textAlign:"center",background:Ye?"var(--bgTertiary)":"var(--bgSecondary)",transition:"var(--transition-normal)",cursor:"pointer",minHeight:"180px",display:"flex",flexDirection:"column",justifyContent:"center"},onClick:()=>document.getElementById("file-input").click()},rt.createElement("div",{style:{fontSize:"36px",marginBottom:"12px"}},"\ud83d\udcc1"),rt.createElement("h4",{style:{margin:0,marginBottom:"8px",fontSize:"14px",color:"var(--textPrimary)"}},"Drop file here or click to browse"),rt.createElement("p",{style:{margin:0,color:"var(--textMuted)",fontSize:"var(--fontSize-sm)"}},"Supports text, HTML, JavaScript, JSON, images, and more"),rt.createElement("input",{id:"file-input",type:"file",onChange:e=>e.target.files[0]&&gt(e.target.files[0]),style:{display:"none"}})),!!l&&rt.createElement("div",{className:"validation-success",style:{marginTop:"var(--spacing-lg)"}},rt.createElement("span",null,"\u2705"),rt.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"6px"}},rt.createElement("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexWrap:"wrap"}},rt.createElement("span",{style:{color:"var(--textPrimary)"}},"File added:"),rt.createElement("span",{style:{fontFamily:"var(--fontFamily-mono)",color:"var(--accentPurple)",background:"var(--bgTertiary)",border:"1px solid var(--borderMedium)",borderRadius:"9999px",padding:"2px 8px",maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:l},l),rt.createElement("button",{type:"button",onClick:()=>{r&&r(""),i&&i("text/plain"),a&&a(""),c&&c("");const e=document.getElementById("file-input");e&&(e.value="")},style:{background:"transparent",border:"1px solid var(--borderMedium)",borderRadius:"9999px",padding:"2px 10px",color:"var(--textMuted)",cursor:"pointer"}},"Remove"))))),"templates"===Xe&&d&&rt.createElement("div",{className:"fade-in"},rt.createElement("div",{className:"inscription-grid"},mt.map((e,t)=>rt.createElement("div",{key:t,className:"inscription-card",onClick:()=>wt(e),style:{cursor:"pointer",padding:"var(--spacing-lg)"}},rt.createElement("div",{style:{fontSize:"32px",marginBottom:"var(--spacing-md)",textAlign:"center"}},pt.find(t=>t.value===e.contentType)?.icon||"\ud83d\udcc4"),rt.createElement("h5",{style:{margin:0,marginBottom:"var(--spacing-xs)",fontSize:"var(--fontSize-base)",fontWeight:"var(--fontWeight-semibold)",color:"var(--textPrimary)",textAlign:"center"}},e.name),rt.createElement("p",{style:{margin:0,fontSize:"var(--fontSize-xs)",color:"var(--textMuted)",textAlign:"center"}},e.contentType),rt.createElement("p",{style:{margin:0,marginTop:"var(--spacing-sm)",fontSize:"var(--fontSize-xs)",color:"var(--textMuted)",textAlign:"center",fontFamily:"var(--fontFamily-mono)"}},e.content.length," bytes"))))),"bitmap"===Xe&&rt.createElement("div",{className:"fade-in",style:{height:"100%"}},rt.createElement(BS,{selectedParents:T,onContentChange:r,onContentTypeChange:i,onBatchCreate:e=>{e.forEach(e=>{const t={content:e.content,contentType:e.contentType,contentSize:e.content.length,selectedParents:e.parent?[{id:e.parent}]:[],reinscriptionTarget:null,delegateId:"",metaprotocol:"",metadata:e.metadata||"",properties:"",contentEncoding:"",pointer:"",recipientAddress:"",features:e.parent?["\ud83d\udc68\u200d\ud83d\udc67 Parent-Child","\ufffd Bitmap Parcel"]:["\ufffd Bitmap Parcel"]};D(t)}),Ge("review")},disabled:j})),"oodl"===Xe&&rt.createElement("div",{className:"fade-in",style:{height:"100%",overflow:"auto",padding:0}},rt.createElement(IS,{onOodlLayoutChange:We,feeRate:f,onFeeRateChange:p,walletInscriptions:y,walletAssetScanState:k,onRequestWalletRescan:A,selectedInscription:q,selectedParentsCount:Array.isArray(T)?T.length:0,selectedParentIds:(Array.isArray(T)?T:[]).map(e=>e&&(e.id||e.inscriptionId||e.inscription_id)).map(e=>String(e||"").trim()).filter(Boolean),priceSats:K,onPriceSatsChange:X,listingScriptAddress:G,onListingScriptAddressChange:Y,markerValueSats:J,onMarkerValueSatsChange:Q,dryRun:Z,onDryRunChange:ee,saleMinBlockHeight:ke,onSaleMinBlockHeightChange:Ae,onCreateListingTx:te,onCreateBulkListingTx:ne,createDisabled:re,sellerStatus:ie,sellerError:ae,bulkSellerStatus:oe,bulkSellerError:se,bulkBundleJson:le,collectionAuthoritySlots:ce,collectionAuthorityStatus:ue,collectionAuthorityError:de,collectionAuthoritySlotId:fe,onCollectionAuthoritySlotIdChange:pe,onLaunchCollection:me,onLaunchParcelManifest:he,revealTxid:ge,onRevealTxidChange:ye,onBuy:be,buyDisabled:we,fundingNeeded:xe,onCreateFundingTx:ve,fundingDisabled:Se,fundingStatus:Ee,fundingError:Ie,buyStatus:Ne,buyError:Te,manualSellerPsbt:_e,manualSellerStatus:Pe,manualSellerError:Be,onCreateManualSellerOfferPsbt:Ce,manualBuyStatus:Oe,manualBuyError:Le,onBuyFromSellerOfferPsbt:Fe,manualBuyerFundedPsbt:Re,manualBuyerFundedStatus:Ue,manualBuyerFundedError:Me,onCreateBuyerFundedPsbtForSeller:$e,manualSellerCountersignStatus:He,manualSellerCountersignError:De,onCountersignAndBroadcastFromBuyerFundedPsbt:ze,oodlSection:Ve,onOodlSectionChange:je})),"review"===Xe&&rt.createElement("div",{className:"fade-in",style:{height:"100%"}},rt.createElement(ex,{content:e,contentType:t,contentSize:vt,contentEncoding:R,compressBeforeInscribe:o,onCompressBeforeInscribeChange:s,fileName:l,selectedParents:T,reinscriptionTarget:_,delegateId:P,metaprotocol:B,metadata:C,properties:O,pointer:F,recipientAddress:U,repeatCount:M,onRepeatCountChange:$,batchItems:H,onAddToBatch:D,onRemoveFromBatch:z,onEditBatchItem:W,inscriptionMode:V})))),"utxos"!==Xe&&"review"!==Xe&&"bitmap"!==Xe&&"sell"!==Xe&&"buy"!==Xe&&"json"!==Xe&&"oodl"!==Xe&&rt.createElement("div",{style:{flexShrink:0,padding:"8px",borderTop:"1px solid rgb(38, 38, 38)",background:"rgb(23, 23, 23)"}},(()=>{const e=!!_,t=e?1:parseInt(M,10)||1;return rt.createElement("div",{className:"flex items-center justify-end gap-2 mb-2"},rt.createElement("div",{className:"text-xs text-neutral-400"},"Repeat"),rt.createElement("input",{type:"number",min:"1",max:"200",value:t,disabled:e,onChange:e=>(e=>{if(!$)return;const t=Math.max(1,Math.min(200,parseInt(e,10)||1));$(t)})(e.target.value),className:"w-20 px-2 py-1 bg-neutral-900/50 border border-neutral-700/50 rounded text-xs font-mono text-neutral-200 disabled:opacity-60",title:e?"Repeat is disabled for reinscriptions":"Create the same inscription multiple times in the same batch transaction"}),e&&rt.createElement("div",{className:"text-[10px] text-neutral-500"},"(reinscriptions can\u2019t repeat)"))})(),0===H.length?rt.createElement(rt.Fragment,null,rt.createElement("div",{className:"flex items-center justify-end gap-3 mb-2"},rt.createElement("label",{className:`flex items-center gap-2 text-xs ${R?"text-neutral-500":"text-neutral-300"} select-none`},rt.createElement("input",{type:"checkbox",checked:!!o,disabled:!!R||"function"!=typeof s,onChange:e=>s?.(!!e.target.checked),className:"accent-purple-500"}),"Brotli")),rt.createElement("button",{onClick:()=>{const n=(()=>{if(null==e)return!1;if("string"==typeof e)return e.length>0;if(e instanceof ArrayBuffer)return e.byteLength>0;if("undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(e))return(e.byteLength||0)>0;if("[object ArrayBuffer]"===Object.prototype.toString.call(e))try{return(e.byteLength||0)>0}catch{return!0}return!0})(),r=(()=>{const e=String(P||"").trim(),t=String(B||"").trim(),n=String(C||"").trim(),r=String(O||"").trim(),i=Array.isArray(T)?T.length:0,a=!!_,o=!(null==F||""===String(F));return!!e||!!t||!!n||!!r||i>0||a||o})();if(!String(t||"").trim()||!n&&!r)return void alert("Please add content, or set delegate/metadata/properties/parents/reinscription.");const i=[];1===T.length&&i.push("\ud83d\udc68\u200d\ud83d\udc67 Parent-Child"),T.length>1&&i.push(`\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d\udc66 Multi-Parent (${T.length})`),_&&i.push("\u267b\ufe0f Reinscription"),P&&i.push("\ud83d\udd17 Delegate"),B&&i.push(`\ud83d\udce1 ${B}`),C&&i.push("\ud83d\udcca Metadata"),O&&i.push("\ud83c\udfa8 Properties"),R&&i.push("\ud83d\udddc\ufe0f Encoding"),o&&!R&&i.push("\ud83e\uddf1 Brotli"),F&&i.push("\ud83c\udfaf Pointer"),D({content:e,contentType:t,contentSize:vt,fileName:l,selectedParents:T,reinscriptionTarget:_,delegateId:P,metaprotocol:B,metadata:C,properties:O,contentEncoding:R,compressBeforeInscribe:!!o,pointer:F,recipientAddress:U,repeatCount:M,features:i})},disabled:(()=>{const n=!!String(t||"").trim(),r=(()=>{if(null==e)return!1;if("string"==typeof e)return e.length>0;if(e instanceof ArrayBuffer)return e.byteLength>0;if("undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(e))return(e.byteLength||0)>0;if("[object ArrayBuffer]"===Object.prototype.toString.call(e))try{return(e.byteLength||0)>0}catch{return!0}return!0})(),i=(()=>{const e=String(P||"").trim(),t=String(B||"").trim(),n=String(C||"").trim(),r=String(O||"").trim(),i=Array.isArray(T)?T.length:0,a=!!_,o=!(null==F||""===String(F));return!!e||!!t||!!n||!!r||i>0||a||o})();return!n||!r&&!i})(),className:"w-full py-3 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 disabled:from-neutral-700 disabled:to-neutral-700 disabled:cursor-not-allowed text-white rounded-lg font-semibold transition-all flex items-center justify-center gap-2",style:{opacity:(()=>{const n=!!String(t||"").trim(),r=(()=>{if(null==e)return!1;if("string"==typeof e)return e.length>0;if(e instanceof ArrayBuffer)return e.byteLength>0;if("undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(e))return(e.byteLength||0)>0;if("[object ArrayBuffer]"===Object.prototype.toString.call(e))try{return(e.byteLength||0)>0}catch{return!0}return!0})(),i=(()=>{const e=String(P||"").trim(),t=String(B||"").trim(),n=String(C||"").trim(),r=String(O||"").trim(),i=Array.isArray(T)?T.length:0,a=!!_,o=!(null==F||""===String(F));return!!e||!!t||!!n||!!r||i>0||a||o})();return n&&(r||i)?1:.5})()}},rt.createElement("span",null,"\ud83d\udce6"),rt.createElement("span",null,"Add to Batch"))):rt.createElement("div",{className:"flex items-center justify-between p-3 bg-green-500/10 border border-green-500/30 rounded-lg"},rt.createElement("div",{className:"flex items-center gap-2"},rt.createElement("span",{className:"text-green-400 text-xl"},"\u2705"),rt.createElement("div",null,rt.createElement("p",{className:"text-sm font-semibold text-green-300"},"Batch Ready: ",H.length," inscription",1!==H.length?"s":""),rt.createElement("p",{className:"text-xs text-green-400/70"},"Switch to Review tab to manage batch items"))),rt.createElement("div",{className:"flex items-center gap-3"},rt.createElement("label",{className:`flex items-center gap-2 text-xs ${R?"text-neutral-500":"text-neutral-300"} select-none`},rt.createElement("input",{type:"checkbox",checked:!!o,disabled:!!R||"function"!=typeof s,onChange:e=>s?.(!!e.target.checked),className:"accent-purple-500"}),"Brotli"),rt.createElement("button",{onClick:()=>{const n=(()=>{if(null==e)return!1;if("string"==typeof e)return e.length>0;if(e instanceof ArrayBuffer)return e.byteLength>0;if("undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(e))return(e.byteLength||0)>0;if("[object ArrayBuffer]"===Object.prototype.toString.call(e))try{return(e.byteLength||0)>0}catch{return!0}return!0})(),r=(()=>{const e=String(P||"").trim(),t=String(B||"").trim(),n=String(C||"").trim(),r=String(O||"").trim(),i=Array.isArray(T)?T.length:0,a=!!_,o=!(null==F||""===String(F));return!!e||!!t||!!n||!!r||i>0||a||o})();if(!String(t||"").trim()||!n&&!r)return void alert("Please add content, or set delegate/metadata/properties/parents/reinscription.");const i=[];1===T.length&&i.push("\ud83d\udc68\u200d\ud83d\udc67 Parent-Child"),T.length>1&&i.push(`\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d\udc66 Multi-Parent (${T.length})`),_&&i.push("\u267b\ufe0f Reinscription"),P&&i.push("\ud83d\udd17 Delegate"),B&&i.push(`\ud83d\udce1 ${B}`),C&&i.push("\ud83d\udcca Metadata"),O&&i.push("\ud83c\udfa8 Properties"),R&&i.push("\ud83d\udddc\ufe0f Encoding"),o&&!R&&i.push("\ud83e\uddf1 Brotli"),F&&i.push("\ud83c\udfaf Pointer"),D({content:e,contentType:t,contentSize:vt,fileName:l,selectedParents:T,reinscriptionTarget:_,delegateId:P,metaprotocol:B,metadata:C,properties:O,contentEncoding:R,compressBeforeInscribe:!!o,pointer:F,recipientAddress:U,repeatCount:M,features:i})},disabled:(()=>{const n=!!String(t||"").trim(),r=(()=>{if(null==e)return!1;if("string"==typeof e)return e.length>0;if(e instanceof ArrayBuffer)return e.byteLength>0;if("undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(e))return(e.byteLength||0)>0;if("[object ArrayBuffer]"===Object.prototype.toString.call(e))try{return(e.byteLength||0)>0}catch{return!0}return!0})(),i=(()=>{const e=String(P||"").trim(),t=String(B||"").trim(),n=String(C||"").trim(),r=String(O||"").trim(),i=Array.isArray(T)?T.length:0,a=!!_,o=!(null==F||""===String(F));return!!e||!!t||!!n||!!r||i>0||a||o})();return!n||!r&&!i})(),className:"px-4 py-2 bg-purple-500 hover:bg-purple-600 disabled:bg-neutral-700 disabled:cursor-not-allowed text-white rounded-lg font-semibold transition-all flex items-center gap-2",style:{opacity:(()=>{const n=!!String(t||"").trim(),r=(()=>{if(null==e)return!1;if("string"==typeof e)return e.length>0;if(e instanceof ArrayBuffer)return e.byteLength>0;if("undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(e))return(e.byteLength||0)>0;if("[object ArrayBuffer]"===Object.prototype.toString.call(e))try{return(e.byteLength||0)>0}catch{return!0}return!0})(),i=(()=>{const e=String(P||"").trim(),t=String(B||"").trim(),n=String(C||"").trim(),r=String(O||"").trim(),i=Array.isArray(T)?T.length:0,a=!!_,o=!(null==F||""===String(F));return!!e||!!t||!!n||!!r||i>0||a||o})();return n&&(r||i)?1:.5})()}},rt.createElement("span",null,"\u2795"),rt.createElement("span",null,"Add")))))))}function OS({content:e,contentType:t,onContentChange:n,onContentTypeChange:r,onContentEncodingChange:i,compressBeforeInscribe:a=!1,onCompressBeforeInscribeChange:o,fileName:s,onFileNameChange:l,onImportJson:c,contentSize:u,feeRate:d,onFeeRateChange:f,feeEstimate:p,walletAddress:m,walletState:h,selectedUtxos:g,onUtxosChange:y,onUtxoSelect:b,walletInscriptions:w,onFeesLoaded:x,onFilteredUtxosLoaded:v,utxoRescanRequestId:S=0,onUtxoScanStateChange:E,walletAssetScanState:I=null,onRequestWalletRescan:k,inscribing:A,selectedParents:N,reinscriptionTarget:T,delegateId:_,metaprotocol:P,metadata:B,properties:C,pointer:O,contentEncoding:L,recipientAddress:F,repeatCount:R,onRepeatCountChange:U,batchItems:M,onAddToBatch:$,onRemoveFromBatch:H,onEditBatchItem:D,inscriptionMode:z,selectedSaleInscription:W,salePriceSats:V,onSalePriceSatsChange:j,listingScriptAddress:q,onListingScriptAddressChange:K,markerValueSats:X,onMarkerValueSatsChange:G,listingDryRun:Y,onListingDryRunChange:J,saleMinBlockHeight:Q,onSaleMinBlockHeightChange:Z,onCreateListingTx:ee,onCreateBulkListingTx:te,createListingDisabled:ne,sellerStatus:re,sellerError:ie,bulkSellerStatus:ae,bulkSellerError:oe,bulkBundleJson:se,collectionAuthoritySlots:le,collectionAuthorityStatus:ce,collectionAuthorityError:ue,collectionAuthoritySlotId:de,onCollectionAuthoritySlotIdChange:fe,onLaunchCollection:pe,onLaunchParcelManifest:me,buyRevealTxid:he,onBuyRevealTxidChange:ge,onBuyFromRevealTx:ye,buyDisabled:be,buyFundingNeeded:we,onCreateBuyFundingTx:xe,buyFundingDisabled:ve,buyFundingStatus:Se,buyFundingError:Ee,buyStatus:Ie,buyError:ke,manualSellerPsbt:Ae,manualSellerStatus:Ne,manualSellerError:Te,onCreateManualSellerOfferPsbt:_e,manualBuyStatus:Pe,manualBuyError:Be,onBuyFromSellerOfferPsbt:Ce,manualBuyerFundedPsbt:Oe,manualBuyerFundedStatus:Le,manualBuyerFundedError:Fe,onCreateBuyerFundedPsbtForSeller:Re,manualSellerCountersignStatus:Ue,manualSellerCountersignError:Me,onCountersignAndBroadcastFromBuyerFundedPsbt:$e,tabRequest:He=null,onActiveTabChange:De,onOodlLayoutChange:ze,oodlSection:We,onOodlSectionChange:Ve}){return it.createElement("div",{className:"h-full min-h-0"},it.createElement(CS,{content:e,contentType:t,onContentChange:n,onContentTypeChange:r,onContentEncodingChange:i,compressBeforeInscribe:a,onCompressBeforeInscribeChange:o,fileName:s,onFileNameChange:l,onImportJson:c,contentSize:u,feeRate:d,onFeeRateChange:f,feeEstimate:p,walletAddress:m,walletState:h,selectedUtxos:g,onUtxosChange:y,onUtxoSelect:b,walletInscriptions:w,onFeesLoaded:x,onFilteredUtxosLoaded:v,utxoRescanRequestId:S,onUtxoScanStateChange:E,walletAssetScanState:I,onRequestWalletRescan:k,inscribing:A,selectedParents:N,reinscriptionTarget:T,delegateId:_,metaprotocol:P,metadata:B,properties:C,pointer:O,contentEncoding:L,recipientAddress:F,repeatCount:R,onRepeatCountChange:U,batchItems:M,onAddToBatch:$,onRemoveFromBatch:H,onEditBatchItem:D,inscriptionMode:z,selectedSaleInscription:W,salePriceSats:V,onSalePriceSatsChange:j,listingScriptAddress:q,onListingScriptAddressChange:K,markerValueSats:X,onMarkerValueSatsChange:G,listingDryRun:Y,onListingDryRunChange:J,saleMinBlockHeight:Q,onSaleMinBlockHeightChange:Z,onCreateListingTx:ee,onCreateBulkListingTx:te,createListingDisabled:ne,sellerStatus:re,sellerError:ie,bulkSellerStatus:ae,bulkSellerError:oe,bulkBundleJson:se,collectionAuthoritySlots:le,collectionAuthorityStatus:ce,collectionAuthorityError:ue,collectionAuthoritySlotId:de,onCollectionAuthoritySlotIdChange:fe,onLaunchCollection:pe,onLaunchParcelManifest:me,buyRevealTxid:he,onBuyRevealTxidChange:ge,onBuyFromRevealTx:ye,buyDisabled:be,buyFundingNeeded:we,onCreateBuyFundingTx:xe,buyFundingDisabled:ve,buyFundingStatus:Se,buyFundingError:Ee,buyStatus:Ie,buyError:ke,manualSellerPsbt:Ae,manualSellerStatus:Ne,manualSellerError:Te,onCreateManualSellerOfferPsbt:_e,manualBuyStatus:Pe,manualBuyError:Be,onBuyFromSellerOfferPsbt:Ce,manualBuyerFundedPsbt:Oe,manualBuyerFundedStatus:Le,manualBuyerFundedError:Fe,onCreateBuyerFundedPsbtForSeller:Re,manualSellerCountersignStatus:Ue,manualSellerCountersignError:Me,onCountersignAndBroadcastFromBuyerFundedPsbt:$e,tabRequest:He,oodlSection:We,onOodlSectionChange:Ve,onActiveTabChange:De,onOodlLayoutChange:ze}))}async function LS(e){try{const n=mh();for(const i of[`/r/inscription/${e}`,`/r/inscriptions/${e}`])try{const e=th(i),t=await fetch(e);if(t.ok)return FS(await t.json())}catch(t){}if(!n&&window.NexusBitcoinProxy&&window.NexusBitcoinProxy.isEnabled()){const t=window.NexusBitcoinProxy.getUrl(),n=window.open(`${t}?action=fetch&url=${encodeURIComponent(th(`/r/inscription/${e}`))}`,"_blank","width=1,height=1,left=-1000,top=-1000"),r=`nexus_proxy_inscription_${Date.now()}`;return new Promise((e,t)=>{const i=setTimeout(()=>{n&&n.close(),t(new Error("Timeout fetching inscription data"))},15e3),a=setInterval(()=>{const o=localStorage.getItem(r);if(o){clearInterval(a),clearTimeout(i),n&&n.close();try{const n=JSON.parse(o);localStorage.removeItem(r),n.error?t(new Error(n.error)):e(FS(n))}catch(uC){t(new Error("Failed to parse inscription data"))}}},100);localStorage.setItem(`${r}_request`,"pending")})}const r=await fetch(th(`/inscription/${e}`));if(!r.ok)throw new Error(`Failed to fetch inscription: ${r.statusText}`);return function(e){const t={},n=e.match(/inscription\/([a-f0-9]{64}i\d+)/);n&&(t.id=n[1]);const r=e.match(/Inscription (\d+)/);r&&(t.number=parseInt(r[1]));const i=e.match(/content type<\/dt>\s*<dd[^>]*>([^<]+)/i);i&&(t.content_type=i[1].trim());const a=e.match(/content length<\/dt>\s*<dd[^>]*>(\d+)/i);a&&(t.content_length=parseInt(a[1]));const o=e.match(/genesis height<\/dt>\s*<dd[^>]*>(\d+)/i);o&&(t.genesis_height=parseInt(o[1]));const s=e.match(/output<\/dt>\s*<dd[^>]*>([a-f0-9]{64}:\d+)/i);s&&(t.satpoint=s[1]);const l=e.match(/address<\/dt>\s*<dd[^>]*>([a-zA-Z0-9]+)/i);return l&&(t.address=l[1]),t}(await r.text())}catch(Kh){throw Kh}}function FS(e){return{id:e.id,number:e.number,content_type:e.content_type,content_length:e.content_length,satpoint:e.satpoint,output:e.output,address:e.address,sat:e.sat,genesis_height:e.genesis_height,genesis_fee:e.genesis_fee,height:e.height,fee:e.fee,timestamp:e.timestamp,delegate:e.delegate,charms:e.charms,output_value:e.output_value,value:e.value,...Object.keys(e).reduce((t,n)=>(["id","number","content_type","content_length","satpoint","output","address","sat","genesis_height","genesis_fee","height","fee","timestamp","delegate","charms","output_value","value"].includes(n)||(t[n]=e[n]),t),{})}}async function RS(e){if(!e||!e.id)throw new Error("Invalid inscription object");if((e.content_type||e.contentType)&&e.satpoint)return e;try{const t=await LS(e.id);return{...t,...e,sat:e.sat||t.sat}}catch(Kh){return e}}const US=Object.freeze(Object.defineProperty({__proto__:null,enrichInscriptionData:RS,enrichInscriptions:async function(e,t){if(!e||0===e.length)return[];const n=[];for(let r=0;r<e.length;r++){const i=e[r];t&&t({current:r+1,total:e.length,percentage:Math.round((r+1)/e.length*100)});try{const t=!(i.content_type||i.contentType)||!i.satpoint,a=await RS(i);n.push(a),t&&r<e.length-1&&await new Promise(e=>setTimeout(e,200))}catch(Kh){n.push(i)}}return n},fetchInscriptionDetails:LS},Symbol.toStringTag,{value:"Module"}));function MS({inscriptions:e,selectedIds:t,onSelect:n,visible:r=!0,disabledIds:i=[],emphasizeSelected:a=!0,sortByNumber:o=!0,selectedFirst:s=!0,disabledLabelLookup:l=null,enableDragSelect:c=!1}){const[u,d]=rt.useState({}),f=rt.useRef({}),p=rt.useRef(null),m=rt.useRef({}),h=rt.useRef({active:!1,mode:"add",visited:new Set,didDrag:!1});rt.useEffect(()=>{f.current=u||{}},[u]);const g=rt.useMemo(()=>Array.isArray(e)&&0!==e.length?e.map(e=>e&&(e.id||e.inscriptionId||e.inscription_id)?String(e.id||e.inscriptionId||e.inscription_id):"").filter(Boolean).join("|"):"",[e]);rt.useEffect(()=>{if(!g)return;const e=g.split("|").filter(Boolean);if(0===e.length)return;let t=!1;const n=new Set(e);return d(e=>{const t=e&&"object"==typeof e?e:{},r=Object.keys(t);if(0===r.length)return e;let i=!1;const a={};for(const o of r)n.has(o)?a[o]=t[o]:i=!0;return i?a:e}),d(t=>{let n=!1;const r={...t&&"object"==typeof t?t:{}};for(const i of e){if(r[i])continue;const e=cx.get(i);e&&(r[i]=e,n=!0)}return n?r:t}),(async()=>{const n=f.current||{},r=e.filter(e=>!n[e]&&!cx.has(e));if(0===r.length)return;const i=r.slice(0,20),a=async e=>{const n={};await Promise.all(e.map(async e=>{try{const t=await async function(e){if(cx.has(e))return cx.get(e);try{const t=await fetch(th(`/content/${e}`)),n=t.headers.get("content-type")||"",r=await t.arrayBuffer(),i=e=>{try{const t=new Uint8Array(e||[]);if(t.length>=8){if(137===t[0]&&80===t[1]&&78===t[2]&&71===t[3]&&13===t[4]&&10===t[5]&&26===t[6]&&10===t[7])return"image/png";if(71===t[0]&&73===t[1]&&70===t[2]&&56===t[3])return"image/gif";if(255===t[0]&&216===t[1]&&255===t[2])return"image/jpeg";if(82===t[0]&&73===t[1]&&70===t[2]&&70===t[3]&&87===t[8]&&69===t[9]&&66===t[10]&&80===t[11])return"image/webp"}if(t.length>=12&&102===t[4]&&116===t[5]&&121===t[6]&&112===t[7]){const e=String.fromCharCode(t[8],t[9],t[10],t[11]);if("avif"===e||"avis"===e)return"image/avif";if("heic"===e||"heix"===e||"hevc"===e||"hevx"===e)return"image/heic"}if(t.length>=16)try{const e=new TextDecoder("utf-8",{fatal:!1}).decode(t.slice(0,2048)),n=String(e||"").replace(/^\uFEFF/,"").trimStart().toLowerCase();if(n.startsWith("<svg")||n.startsWith("<?xml")&&n.includes("<svg")||n.includes("<svg"))return"image/svg+xml"}catch{}}catch{}return""},a=String(n||"").toLowerCase(),o=i(r);let s,l="text";if(a.includes("image/")||o){l="image";const e=new Blob([r],{type:o||n||void 0});s=URL.createObjectURL(e)}else if(a.includes("text/")||a.includes("json")||a.includes("javascript")){l="text";try{s=new TextDecoder("utf-8",{fatal:!1}).decode(r)}catch{s=""}}else l="iframe",s=e;const c={content:s,renderType:l,contentType:o||n};return cx.set(e,c),c}catch(uC){return{content:e,renderType:"iframe",contentType:"unknown"}}}(e);n[e]=t}catch(t){}})),t||d(e=>({...e||{},...n}))};await a(i);const o=r.slice(20);for(let e=0;e<o.length;e+=10){if(t)return;await a(o.slice(e,e+10))}})(),()=>{t=!0}},[g]);let y=[];Array.isArray(t)?y=t.filter(Boolean):t&&"string"==typeof t&&(y=t.split(",").filter(Boolean));const b=new Set(y),w=new Set(i.filter(Boolean)),x=rt.useRef(b),v=rt.useRef(w);rt.useEffect(()=>{x.current=b},[t]),rt.useEffect(()=>{v.current=w},[i]);const S=rt.useCallback(()=>{h.current.active=!1,h.current.visited=new Set,setTimeout(()=>{h.current.didDrag=!1},0)},[]);rt.useEffect(()=>{if(!c)return;const e=()=>S();return window.addEventListener("pointerup",e),window.addEventListener("pointercancel",e),()=>{window.removeEventListener("pointerup",e),window.removeEventListener("pointercancel",e)}},[c,S]),y.length;const E=e=>{const t=e.number||e.inscriptionNumber||e.inscription_number;if("number"==typeof t)return t;const n=e.id||e.inscriptionId||e.inscription_id||"",r=/i(\d+)$/.exec(n);return r?parseInt(r[1],10):Number.MAX_SAFE_INTEGER},I=o?(e||[]).slice().sort((e,t)=>{const n=e.id||e.inscriptionId||e.inscription_id||"",r=t.id||t.inscriptionId||t.inscription_id||"";if(s){const e=b.has(n);if(e!==b.has(r))return e?-1:1}const i=E(e),a=E(t);return i!==a?i-a:n.localeCompare(r)}):(e||[]).slice();return I&&0!==I.length?rt.createElement("div",{ref:p,style:{display:r?"grid":"none",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:"12px",padding:"8px",width:"100%",minWidth:0,boxSizing:"border-box"}},I.map(e=>{const t=e.id||e.inscriptionId||e.inscription_id||"",r=b.has(t),i=w.has(t),o=e.number||e.inscriptionNumber||e.inscription_number||(e.id?`${e.id.substring(0,8)}`:"?"),d=u[t];return rt.createElement("div",{key:t||Math.random(),ref:e=>{t&&(m.current[t]=e)},"data-insc-id":t,onPointerDown:r=>{if(!c)return;if(0!==r.button)return;if(!t)return;if(v.current.has(t))return;const i=x.current.has(t);h.current.active=!0,h.current.mode=i?"remove":"add",h.current.visited=new Set([t]),h.current.didDrag=!0,n(e);try{r.currentTarget.setPointerCapture?.(r.pointerId)}catch{}r.preventDefault()},onPointerEnter:()=>{if(!c)return;if(!h.current.active)return;if(!t)return;if(v.current.has(t))return;if(h.current.visited.has(t))return;h.current.visited.add(t),h.current.didDrag=!0;const r=x.current.has(t),i=h.current.mode;"add"!==i||r||n(e),"remove"===i&&r&&n(e)},onClick:()=>{if(!i&&(!c||!h.current.active&&!h.current.didDrag)&&(n(e),s))try{const e=m.current[t];e&&e.scrollIntoView&&setTimeout(()=>{e.scrollIntoView({behavior:"smooth",block:"start"})},80)}catch{}},style:{minWidth:0,maxWidth:"100%",boxSizing:"border-box",background:i?"rgba(120,120,120,0.12)":r?"rgba(168, 85, 247, 0.18)":"var(--bgSecondary)",border:"2px solid "+(i?"rgba(120,120,120,0.5)":r?"var(--accentPurple)":"var(--borderMedium)"),borderRadius:"8px",padding:a&&!i&&r?"10px":"8px",cursor:i?"not-allowed":"pointer",opacity:i?.6:1,transition:"all 0.15s ease",position:"relative"}},rt.createElement("div",{style:{width:"100%",height:"100px",borderRadius:"4px",overflow:"hidden",background:"#1a1a1a",position:"relative",marginBottom:"6px",pointerEvents:"none"}},d?"image"===d.renderType?rt.createElement("img",{src:d.content,alt:`#${o}`,style:{width:"100%",height:"100%",objectFit:"contain",objectPosition:"center"}}):"text"===d.renderType?rt.createElement("div",{style:{width:"100%",height:"100%",padding:"4px",fontSize:"8px",fontFamily:"monospace",color:"#ccc",overflow:"hidden",textOverflow:"ellipsis",lineHeight:"1.2",whiteSpace:"pre-wrap",wordBreak:"break-all"}},d.content.substring(0,500)):rt.createElement("iframe",{src:th(`/content/${d.content}`),style:{width:"100%",height:"100%",border:"none"},sandbox:"allow-scripts",loading:"lazy"}):rt.createElement("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",color:"#666",fontSize:"24px"}},"\u23f3")),rt.createElement("div",{style:{fontSize:"13px",fontWeight:600,color:"var(--accentPurple)",marginBottom:"3px"}},"#",o),rt.createElement("div",{style:{fontSize:"9px",color:"var(--textMuted)",fontFamily:"monospace",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},t?.substring(0,16),"..."),r&&!i&&rt.createElement("div",{style:{position:"absolute",top:"6px",right:"6px",background:"var(--accentPurple)",borderRadius:"50%",width:"22px",height:"22px",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"12px",fontWeight:"bold",boxShadow:"0 2px 6px rgba(0,0,0,0.3)",zIndex:10}},"\u2713"),i&&rt.createElement("div",{style:{position:"absolute",top:"6px",left:"6px",background:"var(--accentPurple)",padding:"2px 6px",borderRadius:"999px",fontSize:"10px",fontWeight:600,color:"white",letterSpacing:"0.4px",border:"1px solid rgba(251, 146, 60, 0.1)"}},l&&l[t]?l[t]:"USED IN BATCH"))})):rt.createElement("div",{style:{padding:"40px",textAlign:"center",color:"var(--textMuted)",display:r?"block":"none"}},"No inscriptions found")}function $S({delegateId:e="",metaprotocol:t="",metadata:n="",properties:r="",pointer:i="",reinscriptionTarget:a="",recipientAddress:o="",selectedParents:s=[],inscriptionMode:l="standard",onDelegateChange:c,onMetaprotocolChange:u,onMetadataChange:d,onPropertiesChange:f,onPointerChange:p,onReinscriptionTargetChange:m,onRecipientAddressChange:h,onParentSelect:g,walletInscriptions:y=[],loadingInscriptions:b=!1,ordinalsAddress:w="",existingReinscriptionTargets:x=[],existingParentIds:v=[],batchResetSignal:S=0,onResetSelections:E,limitParentSelection:I=!1,showOnlyParents:k=!1,parentsLabel:A="Parents"}){rt.useEffect(()=>{try{a&&Array.isArray(x)&&x.includes(a)&&"function"==typeof m&&m("")}catch(e){}},[a,x]),rt.useEffect(()=>{S>0&&("function"==typeof E&&E(),c&&c(""),m&&m(""),L(""),R(""),M(""),H(""))},[S]);const[N,T]=rt.useState("parents"),[_,P]=rt.useState(""),[B,C]=rt.useState("gallery"),[O,L]=rt.useState(""),[F,R]=rt.useState(""),[U,M]=rt.useState(""),[$,H]=rt.useState("");rt.useEffect(()=>{if(r)try{const e=JSON.parse(r),t=e?.[1]?.[0]||"",n=e?.[0]||[],i=Array.isArray(n)?n.join("\n"):"";L(t),R(i),H(t)}catch(cC){}else L(""),R(""),M(""),H("")},[r]);const D=e=>{if(null==e)return"";let t=String(e).trim();if(t=t.replace(/[\u200B-\u200D\uFEFF]/g,""),t=t.replace(/^["'\s]+|["'\s]+$/g,""),t=t.replace(/\s+/g,""),t=t.split("#")[0],t=t.split("?")[0],t.includes("/")){const e=t.split("/").filter(Boolean);t=e[e.length-1]||t}return t.includes(":")&&(t=t.split(":")[0]),t=t.replace(/\(i\)/gi,"i"),/^[a-f0-9]{64}$/i.test(t)&&(t+="i0"),t},z=rt.useMemo(()=>{const e=new Map;return(y||[]).forEach(t=>{const n=t?.id||t?.inscriptionId||t?.inscription_id;n&&e.set(n,t)}),e},[y]),W=e=>e?/^[a-f0-9]{64}[i\(i\)]?\d+$/i.test(e.replace(/[\(\)]/g,""))?{valid:!0,message:"\u2713 Valid"}:{valid:!1,message:"\u26a0\ufe0f Invalid format"}:{valid:!0,message:""},V=e=>{if(!e||""===e.trim())return{valid:!0,message:""};try{return JSON.parse(e),{valid:!0,message:"\u2713 Valid JSON"}}catch(Kh){return{valid:!1,message:`\u26a0\ufe0f Invalid JSON: ${Kh.message}`}}};W(e),W(a);const j=V(n),q=V(r),K=(e=>{if(!e||""===e)return{valid:!0,message:""};const t=parseInt(e,10);return isNaN(t)||t<0?{valid:!1,message:"\u26a0\ufe0f Must be a non-negative integer"}:{valid:!0,message:"\u2713 Valid pointer value"}})(i),X=rt.useMemo(()=>{if(!Array.isArray(x))return null;const e={};return x.forEach((t,n)=>{t&&(e[t]||(e[t]=`USED IN BATCH #${n+1}`))}),e},[x]),G=rt.useMemo(()=>{if(!Array.isArray(y)||0===y.length)return null;const e=new Map,t=new Map;for(const o of y){const n=o.id||o.inscriptionId||o.inscription_id;if(!n)continue;t.set(n,o);let r=null;if(o.output)r=o.output;else if(o.satpoint){const e=String(o.satpoint).split(":");e.length>=2&&(r=`${e[0]}:${e[1]}`)}else o.utxo&&o.utxo.txid&&void 0!==o.utxo.vout&&(r=`${o.utxo.txid}:${o.utxo.vout}`);r&&(e.has(r)||e.set(r,[]),e.get(r).push(o))}const n=[],r=Array.from(e.entries()).filter(([e,t])=>t.length>1);r.forEach(([e,t])=>{const r=t.slice().sort((e,t)=>{const n=void 0!==e.offset?e.offset:(()=>{const t=(e.satpoint||"").split(":");return t.length>=3?parseInt(t[2],10):-1})();return(void 0!==t.offset?t.offset:(()=>{const e=(t.satpoint||"").split(":");return e.length>=3?parseInt(e[2],10):-1})())-n}),i=new Map;r.forEach(e=>{const t=e.sat;null!=t&&(i.has(t)||i.set(t,[]),i.get(t).push(e))});const a=Array.from(i.entries()).filter(([e,t])=>t.length>1).map(([e,t])=>({type:"same-sat",sat:Number(e),inscriptions:t}));n.push({type:"utxo",key:`utxo:${e}`,utxo:e,inscriptions:r,subGroups:a.length>0?a:null})});const i=new Set;n.forEach(e=>{e.inscriptions.forEach(e=>{const t=e.id||e.inscriptionId||e.inscription_id;t&&i.add(t)})});const a=new Map;for(const o of y){const e=o.id||o.inscriptionId||o.inscription_id;if(e&&!i.has(e)&&o.sameSatIds&&Array.isArray(o.sameSatIds)&&o.sameSatIds.length>1){const e=o.sat;null!=e&&(a.has(e)||a.set(e,new Set),o.sameSatIds.forEach(t=>a.get(e).add(t)))}}for(const[o,s]of a.entries()){const e=Array.from(s);if(e.length<=1)continue;let r=e;for(const t of y)if(t.sameSatIds&&Array.isArray(t.sameSatIds)&&t.sat===o){r=[...t.sameSatIds].reverse();break}r===e&&(r=[...e].reverse());const a=r.map(e=>t.get(e)||{id:e,sat:Number(o),satpoint:null,output:null,number:void 0,contentType:null,fromSatScan:!0}).filter(e=>{const t=e.id||e.inscriptionId||e.inscription_id;return t&&!i.has(t)});a.length>1&&n.push({type:"same-sat",key:`sat:${o}`,sat:Number(o),inscriptions:a,subGroups:null})}return 0===n.length?null:{groups:n}},[y]),Y=rt.useMemo(()=>{const e=new Map;(y||[]).forEach(t=>{const n=t.id||t.inscriptionId||t.inscription_id;n&&e.set(n,t)}),G&&Array.isArray(G.groups)&&G.groups.forEach(t=>{t.inscriptions.forEach(t=>{const n=t.id||t.inscriptionId||t.inscription_id;n&&!e.has(n)&&e.set(n,t)})});const t=Array.from(e.values());if(!_.trim())return t;const n=_.toLowerCase();return t.filter(e=>{const t=(e.id||e.inscriptionId||e.inscription_id||"").toLowerCase(),r=String(e.number||e.inscriptionNumber||e.inscription_number||"");if(t.includes(n)||r.includes(n))return!0;const i=cx.get(e.id);return!(!i||"text"!==i.renderType)&&i.content.toLowerCase().includes(n)})},[_,y,G]),J=({selectedId:e,onSelect:t,title:n,description:r,disableIds:i=[],disabledLabelLookup:a=null,filterGroupedInscriptions:o=!1,allowManualEntry:s=!1,manualEntryLabel:l="Manual inscription ID",manualEntryPlaceholder:c="64-hex txid + i + index (e.g. <txid>i0)",manualEntryHint:u="You can reference an inscription you do not own."})=>{const[d,f]=rt.useState(""),[p,m]=rt.useState("");rt.useEffect(()=>{if(!s)return;const t=String(e||"").split(",")[0];m(t)},[s,e]);const h=String(p||"").trim(),g=!h||/^[0-9a-fA-F]{64}i\d+(?::.*)?$/.test(h),w=()=>{t&&t(h)},x=rt.useMemo(()=>{const e=new Map;(y||[]).forEach(t=>{const n=t.id||t.inscriptionId||t.inscription_id;n&&e.set(n,t)}),G&&Array.isArray(G.groups)&&G.groups.forEach(t=>{t.inscriptions.forEach(t=>{const n=t.id||t.inscriptionId||t.inscription_id;n&&!e.has(n)&&e.set(n,t)})});let t=Array.from(e.values());if(o&&G&&G.groups){const e=new Set;G.groups.forEach(t=>{t.inscriptions.forEach(t=>{const n=t.id||t.inscriptionId||t.inscription_id;n&&e.add(n)})}),t=t.filter(t=>{const n=t.id||t.inscriptionId||t.inscription_id;return n&&!e.has(n)})}if(!d.trim())return t;const n=d.toLowerCase();return t.filter(e=>{const t=(e.id||e.inscriptionId||e.inscription_id||"").toLowerCase(),r=String(e.number||e.inscriptionNumber||e.inscription_number||"");if(t.includes(n)||r.includes(n))return!0;const i=cx.get(e.id);return!(!i||"text"!==i.renderType)&&i.content.toLowerCase().includes(n)})},[d,y,G,o]),v=e=>{const t=e.number||e.inscriptionNumber||e.inscription_number;if("number"==typeof t)return t;const n=e.id||e.inscriptionId||e.inscription_id||"",r=/i(\d+)$/.exec(n);return r?parseInt(r[1],10):Number.MAX_SAFE_INTEGER},S=e?e.split(",").filter(Boolean):[],E=new Set(S),I=x.slice().sort((e,t)=>{const n=e.id||e.inscriptionId||e.inscription_id||"",r=t.id||t.inscriptionId||t.inscription_id||"",i=E.has(n),a=E.has(r);if(!o&&i!==a)return i?-1:1;const s=v(e),l=v(t);return s!==l?s-l:n.localeCompare(r)}),k=new Set(i);return rt.createElement("div",null,rt.createElement("label",{className:"form-label",style:{fontSize:"12px",marginBottom:"6px"}},n),s&&rt.createElement("div",{style:{marginBottom:"10px",padding:"8px",borderRadius:"6px",background:"rgba(0,0,0,0.25)",border:"1px solid rgba(34, 211, 238, 0.35)"}},rt.createElement("div",{style:{fontSize:"11px",fontWeight:600,color:"rgb(34, 211, 238)",marginBottom:"6px"}},l),rt.createElement("div",{style:{display:"flex",gap:"8px",alignItems:"center"}},rt.createElement("input",{type:"text",value:p,placeholder:c,onChange:e=>m(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),w())},style:{width:"100%",padding:"6px 8px",fontSize:"11px",background:"var(--bgSecondary)",border:"1px solid var(--borderMedium)",borderRadius:"4px",color:"var(--textPrimary)",fontFamily:"var(--fontFamily-mono)"}}),rt.createElement("button",{type:"button",onClick:w,disabled:!h,style:{padding:"6px 10px",fontSize:"11px",borderRadius:"6px",border:"1px solid rgba(34, 211, 238, 0.45)",background:h?"rgba(34, 211, 238, 0.12)":"rgba(255,255,255,0.04)",color:h?"rgb(34, 211, 238)":"var(--textMuted)",cursor:h?"pointer":"not-allowed",whiteSpace:"nowrap"}},"Use"),rt.createElement("button",{type:"button",onClick:()=>t&&t(""),disabled:!String(e||"").trim(),style:{padding:"6px 10px",fontSize:"11px",borderRadius:"6px",border:"1px solid rgba(255,255,255,0.12)",background:"rgba(255,255,255,0.04)",color:String(e||"").trim()?"var(--textPrimary)":"var(--textMuted)",cursor:String(e||"").trim()?"pointer":"not-allowed",whiteSpace:"nowrap"}},"Clear")),rt.createElement("div",{style:{marginTop:"6px",fontSize:"10px",color:g?"var(--textMuted)":"rgba(251, 113, 133, 0.95)",lineHeight:"1.35"}},g?u:"Expected format like <txid>i0 (64 hex + i + index).")),y.length>0&&rt.createElement("div",{style:{marginBottom:"8px"}},rt.createElement("input",{type:"text",placeholder:"\ud83d\udd0d Search by ID or content...",value:d,onChange:e=>f(e.target.value),style:{width:"100%",padding:"6px 8px",fontSize:"11px",background:"var(--bgSecondary)",border:"1px solid var(--borderMedium)",borderRadius:"4px",color:"var(--textPrimary)",fontFamily:"var(--fontFamily-mono)"}}),d&&rt.createElement("div",{style:{fontSize:"10px",color:"var(--textMuted)",marginTop:"4px"}},x.length," of ",y.length," inscriptions")),b?rt.createElement("div",{style:{padding:"20px",textAlign:"center",color:"var(--textMuted)",fontSize:"11px"}},"Loading inscriptions..."):0===y.length?rt.createElement("div",{style:{padding:"20px",textAlign:"center",color:"var(--textMuted)",fontSize:"11px"}},"No inscriptions found in wallet"):0===x.length?rt.createElement("div",{style:{padding:"20px",textAlign:"center",color:"var(--textMuted)",fontSize:"11px"}},'No inscriptions match "',d,'"'):rt.createElement(MS,{inscriptions:I,selectedIds:e,onSelect:e=>{const n=e.id||e.inscriptionId||e.inscription_id;k.has(n)||(E.has(n)?t(""):t(n))},visible:!0,disabledIds:i,disabledLabelLookup:a}),rt.createElement("p",{style:{margin:"8px 0 0 0",fontSize:"11px",color:"var(--textMuted)",lineHeight:"1.4"}},r))},Q=String(A||"Parents").trim()||"Parents",Z="inscriptions"===Q.toLowerCase(),ee=Z?"inscription":"parent",te=[{id:"parents",icon:"\ud83d\uddbc\ufe0f",label:Q},{id:"delegate",icon:"\ud83d\udd17",label:"Delegate"},{id:"reinscribe",icon:"\ud83d\udd04",label:"Reinscribe"},{id:"destination",icon:"\ud83d\udccd",label:"Dest"},{id:"meta",icon:"\ud83c\udff7\ufe0f",label:"Meta"},{id:"metadata",icon:"\ud83d\udce6",label:"Data"},{id:"properties",icon:"\ud83c\udfa8",label:"Props"},{id:"pointer",icon:"\ud83d\udc46",label:"Pointer"}],ne=k?te.filter(e=>"parents"===e.id):te;return rt.createElement("div",{className:"advanced-options inscription-card",style:{height:"100%",display:"flex",flexDirection:"column",overflow:"hidden"}},rt.createElement("div",{style:{display:"flex",gap:"2px",padding:"3px",borderBottom:"1px solid var(--borderMedium)",flexShrink:0,overflowX:"auto",WebkitOverflowScrolling:"touch",msOverflowStyle:"none",scrollbarWidth:"none"}},ne.map(e=>rt.createElement("button",{key:e.id,onClick:()=>T(e.id),style:{flex:"0 0 auto",minWidth:"48px",padding:"4px 4px",fontSize:"11px",background:N===e.id?"var(--bgTertiary)":"transparent",border:"none",borderBottom:N===e.id?"2px solid var(--accentPurple)":"2px solid transparent",color:N===e.id?"var(--textPrimary)":"var(--textMuted)",cursor:"pointer",transition:"all 0.2s",fontWeight:N===e.id?"600":"400",touchAction:"manipulation",WebkitTapHighlightColor:"transparent"}},rt.createElement("div",{style:{fontSize:"14px",lineHeight:"1"}},e.icon),rt.createElement("div",{style:{fontSize:"9px",lineHeight:"1.2",marginTop:"1px",whiteSpace:"nowrap"}},e.label)))),rt.createElement("div",{style:{flex:1,overflow:"auto",padding:"4px",minHeight:0,WebkitOverflowScrolling:"touch"}},"parents"===N&&rt.createElement("div",{className:"fade-in",style:{background:"rgba(168, 85, 247, 0.05)",borderRadius:"6px",padding:"6px"}},rt.createElement("h5",{style:{fontSize:"12px",fontWeight:600,margin:"0 0 4px 0",color:"var(--textPrimary)"}},"\ud83d\uddbc\ufe0f Select ",Z?"Inscription":"Parent Inscription",s.length>1?"s":""),rt.createElement("p",{style:{fontSize:"10px",color:"var(--textMuted)",marginBottom:"6px",lineHeight:"1.3"}},I&&0===s.length?`\ud83d\udca1 Click an inscription to select (1 ${ee} max)`:I&&1===s.length?`\u2705 ${ee} selected (1 ${ee} max)`:0===s.length?`\ud83d\udca1 Click an inscription to add as ${ee}`:1===s.length?Z?"\u2705 1 inscription selected":"\u2705 Parent-Child mode active":Z?`\u2705 ${s.length} inscriptions selected`:`\u2705 Multi-Parent mode active (${s.length} parents)`),Z&&!I&&Y.length>0&&rt.createElement("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginBottom:"6px"}},(()=>{const e=Y.map(e=>e.id||e.inscriptionId||e.inscription_id).filter(Boolean),t=new Set((s||[]).map(e=>e.id||e.inscriptionId||e.inscription_id).filter(Boolean)),n=e.length>0&&e.every(e=>t.has(e));return rt.createElement("button",{type:"button",onClick:()=>{n?g&&g({type:"bulk",parents:[]}):g&&g({type:"bulk",parents:Y})},style:{padding:"6px 10px",fontSize:"11px",borderRadius:"6px",border:"1px solid var(--borderMedium)",background:"var(--bgSecondary)",color:"var(--textPrimary)",cursor:"pointer"},title:n?"Clear selection":"Select all visible inscriptions"},n?"Clear all":"Select all")})()),y.length>0&&rt.createElement("div",{style:{marginBottom:"8px"}},rt.createElement("input",{type:"text",placeholder:"\ud83d\udd0d Search by ID or content...",value:_,onChange:e=>P(e.target.value),style:{width:"100%",padding:"6px 8px",fontSize:"11px",background:"var(--bgSecondary)",border:"1px solid var(--borderMedium)",borderRadius:"4px",color:"var(--textPrimary)",fontFamily:"var(--fontFamily-mono)"}}),_&&rt.createElement("div",{style:{fontSize:"10px",color:"var(--textMuted)",marginTop:"4px"}},Y.length," of ",y.length," inscriptions")),b?rt.createElement("div",{style:{padding:"12px",textAlign:"center",color:"var(--textMuted)",fontSize:"11px"}},"Loading inscriptions..."):0===y.length?rt.createElement("div",{style:{padding:"12px",textAlign:"center",color:"var(--textMuted)",fontSize:"11px"}},"No inscriptions found in wallet"):0===Y.length?rt.createElement("div",{style:{padding:"12px",textAlign:"center",color:"var(--textMuted)",fontSize:"11px"}},'No inscriptions match "',_,'"'):rt.createElement("div",null,rt.createElement(MS,{inscriptions:Y,selectedIds:(s||[]).map(e=>e&&(e.id||e.inscriptionId||e.inscription_id)).filter(Boolean),onSelect:e=>{if(I){const t=e.id||e.inscriptionId||e.inscription_id;s.some(e=>(e.id||e.inscriptionId||e.inscription_id)===t)?g&&g({type:"bulk",parents:[]}):g&&g({type:"bulk",parents:[e]})}else g&&g(e)},visible:!0,disabledIds:[],enableDragSelect:Z&&!I,selectedFirst:!(Z&&!I)}),G&&G.groups.length>0&&rt.createElement("div",{style:{marginTop:"10px",padding:"6px",background:"rgba(0,0,0,0.25)",borderRadius:"6px",border:"1px solid rgba(59, 130, 246, 0.4)"}},rt.createElement("div",{style:{fontSize:"11px",fontWeight:600,color:"rgb(59, 130, 246)",marginBottom:"4px"}},"\ud83d\udce6 Multi-Inscription Groups (tap any to use as parent)"),rt.createElement("div",{style:{fontSize:"10px",color:"var(--textMuted)",marginBottom:"6px"}},"Select any inscription ID for parent reference."),rt.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"8px"}},G.groups.map((e,t)=>{const n="utxo"===e.type,r=n?`UTXO ${e.utxo.split(":")[0].substring(0,8)}...:${e.utxo.split(":")[1]}`:`Sat ${e.key.slice(4)}`,i=n?"rgba(59, 130, 246, 0.7)":"rgba(250, 204, 21, 0.9)";return rt.createElement("div",{key:e.key||t,style:{position:"relative",padding:"10px 6px 6px 6px",borderRadius:"8px",background:"rgba(0,0,0,0.35)",border:`2px solid ${i}`,boxShadow:`0 0 0 1px ${i}`}},rt.createElement("div",{style:{position:"absolute",top:"-10px",left:"8px",padding:"2px 8px",borderRadius:"999px",fontSize:"10px",fontWeight:600,color:n?"#fff":"#111827",background:n?"linear-gradient(135deg, rgb(59, 130, 246), rgb(29, 78, 216))":"linear-gradient(135deg, #facc15, #fbbf24)",border:`1px solid ${i}`,boxShadow:"0 2px 4px rgba(0,0,0,0.4)",display:"inline-flex",alignItems:"center",gap:"4px",zIndex:5}},rt.createElement("span",null,n?"\ud83d\udce6":"\ud83e\ude99"),rt.createElement("span",null,r),rt.createElement("span",{style:{fontWeight:500,fontSize:"9px"}},"\xb7 ",e.inscriptions.length)),rt.createElement(MS,{inscriptions:e.inscriptions,selectedIds:(s||[]).map(e=>e&&(e.id||e.inscriptionId||e.inscription_id)).filter(Boolean),onSelect:e=>{if(I){const t=e.id||e.inscriptionId||e.inscription_id;s.some(e=>(e.id||e.inscriptionId||e.inscription_id)===t)?g&&g({type:"bulk",parents:[]}):g&&g({type:"bulk",parents:[e]})}else g&&g(e)},visible:!0,disabledIds:[],emphasizeSelected:!1,sortByNumber:!1}))}))))),"delegate"===N&&rt.createElement("div",{className:"fade-in",style:{background:"rgba(34, 211, 238, 0.05)",borderRadius:"6px",padding:"6px"}},rt.createElement(J,{selectedId:e,onSelect:c,title:"Select Delegate Inscription",description:"\ud83d\udca1 Reference another inscription's content (Tag 11). Body will be empty when delegating.",allowManualEntry:!0,manualEntryLabel:"Delegate ID (manual)",manualEntryPlaceholder:"Paste delegate inscription id (e.g. <txid>i0)",manualEntryHint:"Delegates do not need to be in your wallet. Paste any inscription ID."}),G&&G.groups.length>0&&rt.createElement("div",{style:{marginTop:"10px",padding:"6px",background:"rgba(0,0,0,0.25)",borderRadius:"6px",border:"1px solid rgba(59, 130, 246, 0.4)"}},rt.createElement("div",{style:{fontSize:"11px",fontWeight:600,color:"rgb(59, 130, 246)",marginBottom:"4px"}},"\ud83d\udce6 Multi-Inscription Groups (tap any to use as delegate)"),rt.createElement("div",{style:{fontSize:"10px",color:"var(--textMuted)",marginBottom:"6px"}},"Select any inscription ID for delegate reference."),rt.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"8px"}},G.groups.map((t,n)=>{const r="utxo"===t.type;t.type;const i=r?`UTXO ${t.utxo.split(":")[0].substring(0,8)}...:${t.utxo.split(":")[1]}`:`Sat ${t.key.slice(4)}`,a=r?"rgba(59, 130, 246, 0.7)":"rgba(250, 204, 21, 0.9)";return rt.createElement("div",{key:t.key||n,style:{position:"relative",padding:"10px 6px 6px 6px",borderRadius:"8px",background:"rgba(0,0,0,0.35)",border:`2px solid ${a}`,boxShadow:`0 0 0 1px ${a}`}},rt.createElement("div",{style:{position:"absolute",top:"-10px",left:"8px",padding:"2px 8px",borderRadius:"999px",fontSize:"10px",fontWeight:600,color:r?"#fff":"#111827",background:r?"linear-gradient(135deg, rgb(59, 130, 246), rgb(29, 78, 216))":"linear-gradient(135deg, #facc15, #fbbf24)",border:`1px solid ${a}`,boxShadow:"0 2px 4px rgba(0,0,0,0.4)",display:"inline-flex",alignItems:"center",gap:"4px",zIndex:5}},rt.createElement("span",null,r?"\ud83d\udce6":"\ud83e\ude99"),rt.createElement("span",null,i),rt.createElement("span",{style:{fontWeight:500,fontSize:"9px"}},"\xb7 ",t.inscriptions.length)),rt.createElement(MS,{inscriptions:t.inscriptions,selectedIds:e,onSelect:e=>{const t=e.id||e.inscriptionId||e.inscription_id;c&&c(t)},visible:!0,disabledIds:[],emphasizeSelected:!1,sortByNumber:!1}))})))),"reinscribe"===N&&rt.createElement("div",{className:"fade-in",style:{background:"rgba(251, 146, 60, 0.05)",borderRadius:"6px",padding:"6px"}},a&&(()=>{const e=a.split(",").filter(Boolean),t=e.length>1,n=e=>e.length<=20?e:`${e.substring(0,12)}...${e.substring(e.length-4)}`;return rt.createElement("div",{style:{marginBottom:"6px",padding:"5px 6px",borderRadius:"6px",background:"rgba(250, 204, 21, 0.08)",border:"1px solid rgba(250, 204, 21, 0.5)",fontSize:"10px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"6px"}},rt.createElement("div",{style:{flex:1,minWidth:0}},rt.createElement("div",{style:{fontWeight:600,color:"rgb(250, 204, 21)",fontSize:"10px",marginBottom:"2px"}},"\ud83c\udfaf Target",t?"s":""," ",t&&`(${e.length})`),rt.createElement("div",{style:{fontFamily:"var(--fontFamily-mono)",fontSize:"9px",color:"var(--textMuted)",maxHeight:t?"50px":"auto",overflow:"auto",wordBreak:"break-all",lineHeight:"1.3"},title:t?e.join("\n"):a},t?rt.createElement("div",null,e.map((e,t)=>rt.createElement("div",{key:t},n(e)))):n(a))),rt.createElement("button",{type:"button",onClick:()=>{try{const t=document.querySelector(`[data-insc-id="${e[0]}"]`);t&&t.scrollIntoView&&t.scrollIntoView({behavior:"smooth",block:"center"})}catch(t){}},style:{fontSize:"9px",padding:"3px 6px",borderRadius:"999px",border:"1px solid rgba(250, 204, 21, 0.7)",background:"rgba(250, 204, 21, 0.12)",color:"rgb(250, 204, 21)",cursor:"pointer",flexShrink:0,whiteSpace:"nowrap"}},"Jump"))})(),rt.createElement(J,{selectedId:a,onSelect:e=>{x.includes(e)||m&&m(e)},title:"Select Inscription to Update",description:"\ud83d\udca1 Reinscribe over an existing inscription. Select the target inscription to update its content. Inscriptions sharing the same sat/UTXO are highlighted below as groups.",disableIds:[...x],disabledLabelLookup:X,filterGroupedInscriptions:!0}),G&&G.groups.length>0&&rt.createElement("div",{style:{marginTop:"10px",padding:"6px",background:"rgba(0,0,0,0.25)",borderRadius:"6px",border:"1px solid rgba(59, 130, 246, 0.4)"}},rt.createElement("div",{style:{fontSize:"11px",fontWeight:600,color:"rgb(59, 130, 246)",marginBottom:"4px"}},"\ud83d\udce6 Multi-Inscription Groups"),rt.createElement("div",{style:{fontSize:"10px",color:"var(--textMuted)",marginBottom:"6px"}},rt.createElement("strong",null,"Blue boxes:")," Multiple inscriptions on same UTXO.",rt.createElement("strong",null," Gold boxes:")," Same-sat chains (inside UTXO or standalone).",rt.createElement("br",null),rt.createElement("strong",null,"\u26a0\ufe0f Click individual inscription tiles")," to select exact sat/offset for reinscription."),rt.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"10px"}},G.groups.map((e,t)=>{const n="utxo"===e.type,r="same-sat"===e.type,i=e.inscriptions.map(e=>e.id||e.inscriptionId||e.inscription_id).filter(Boolean),o=a||"",s=i.includes(o);if(n){const n=e.utxo.split(":"),r=`${n[0].substring(0,8)}...:${n[1]}`;return rt.createElement("div",{key:e.key||t,style:{position:"relative",padding:"12px 8px 8px 8px",borderRadius:"8px",background:s?"rgba(59, 130, 246, 0.15)":"rgba(59, 130, 246, 0.08)",border:s?"3px solid rgb(59, 130, 246)":"2px solid rgba(59, 130, 246, 0.7)",boxShadow:s?"0 0 0 1px rgb(59, 130, 246), 0 0 20px rgba(59, 130, 246, 0.3)":"0 0 0 1px rgba(59, 130, 246, 0.5)",transition:"all 0.2s ease",cursor:"pointer"},onClick:e=>{(e.target===e.currentTarget||e.target.closest(".utxo-badge"))&&s&&m&&m("")}},rt.createElement("div",{className:"utxo-badge",style:{position:"absolute",top:"-10px",left:"8px",padding:"2px 8px",borderRadius:"999px",fontSize:"10px",fontWeight:600,color:"#fff",background:s?"linear-gradient(135deg, rgb(59, 130, 246), rgb(37, 99, 235))":"linear-gradient(135deg, rgb(59, 130, 246), rgb(29, 78, 216))",border:"1px solid rgba(59, 130, 246, 0.9)",boxShadow:"0 2px 4px rgba(0,0,0,0.4)",display:"inline-flex",alignItems:"center",gap:"4px",zIndex:5,cursor:"pointer"}},s&&rt.createElement("span",null,"\u2713"),rt.createElement("span",null,"\ud83d\udce6"),rt.createElement("span",{title:e.utxo},r),rt.createElement("span",{style:{fontWeight:500,fontSize:"9px"}},"\xb7 ",e.inscriptions.length)),s&&rt.createElement("div",{style:{position:"absolute",inset:0,overflow:"hidden",borderRadius:"inherit",zIndex:4,pointerEvents:"none"}},rt.createElement("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"80px",color:"rgb(59, 130, 246)",textShadow:"0 0 20px rgba(59, 130, 246, 0.8), 0 0 40px rgba(59, 130, 246, 0.4)",opacity:.9}},"\u2713")),e.subGroups&&e.subGroups.length>0?rt.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"8px"}},e.subGroups.map((e,n)=>{const r=e.inscriptions.map(e=>e.id||e.inscriptionId||e.inscription_id).filter(Boolean),i=r.includes(o);return rt.createElement("div",{key:`sub-${t}-${n}`,style:{position:"relative",padding:"8px 6px 6px 6px",borderRadius:"6px",background:i?"rgba(250, 204, 21, 0.15)":"rgba(250, 204, 21, 0.08)",border:i?"3px solid rgb(250, 204, 21)":"2px solid rgba(250, 204, 21, 0.7)",boxShadow:i?"0 0 0 1px rgb(250, 204, 21), 0 0 15px rgba(250, 204, 21, 0.3)":"0 0 0 1px rgba(161, 98, 7, 0.5)",cursor:"pointer",transition:"all 0.2s ease"},onClick:e=>{(e.target===e.currentTarget||e.target.closest(".samesat-badge"))&&(e.stopPropagation(),i&&m&&m(""))}},rt.createElement("div",{className:"samesat-badge",style:{position:"absolute",top:"-8px",left:"6px",padding:"1px 6px",borderRadius:"999px",fontSize:"9px",fontWeight:600,color:"#111827",background:i?"linear-gradient(135deg, #fbbf24, #facc15)":"linear-gradient(135deg, #facc15, #fbbf24)",border:"1px solid rgba(161, 98, 7, 0.9)",boxShadow:"0 1px 2px rgba(0,0,0,0.3)",display:"inline-flex",alignItems:"center",gap:"3px",zIndex:6,cursor:"pointer"}},i&&rt.createElement("span",null,"\u2713"),rt.createElement("span",null,"\ud83e\ude99"),rt.createElement("span",null,"Sat ",e.sat),rt.createElement("span",{style:{fontWeight:500,fontSize:"8px"}},"\xb7 ",e.inscriptions.length)),i&&rt.createElement("div",{style:{position:"absolute",inset:0,overflow:"hidden",borderRadius:"inherit",zIndex:4,pointerEvents:"none"}},rt.createElement("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"60px",color:"rgb(250, 204, 21)",textShadow:"0 0 15px rgba(250, 204, 21, 0.8), 0 0 30px rgba(250, 204, 21, 0.4)",opacity:.9}},"\u2713")),rt.createElement(MS,{inscriptions:e.inscriptions,selectedIds:i?r:[],onSelect:e=>{const t=e.id||e.inscriptionId||e.inscription_id;x.includes(t)||m&&m(t)},visible:!0,disabledIds:x,emphasizeSelected:!1,sortByNumber:!1}))}),(()=>{const t=new Set;e.subGroups.forEach(e=>{e.inscriptions.forEach(e=>{const n=e.id||e.inscriptionId||e.inscription_id;n&&t.add(n)})});const n=e.inscriptions.filter(e=>{const n=e.id||e.inscriptionId||e.inscription_id;return n&&!t.has(n)});if(0===n.length)return null;const r=n.map(e=>e.id||e.inscriptionId||e.inscription_id).filter(Boolean),i=r.includes(o);return rt.createElement("div",{style:{marginTop:"4px"}},rt.createElement("div",{style:{fontSize:"9px",color:"var(--textMuted)",marginBottom:"4px"}},"Other inscriptions on this UTXO:"),rt.createElement(MS,{inscriptions:n,selectedIds:i?[o]:[],onSelect:e=>{const t=e.id||e.inscriptionId||e.inscription_id;x.includes(t)||m&&m(t)},visible:!0,disabledIds:x,emphasizeSelected:!1,sortByNumber:!0}))})()):rt.createElement(MS,{inscriptions:e.inscriptions,selectedIds:s?i:[],onSelect:e=>{const t=e.id||e.inscriptionId||e.inscription_id;x.includes(t)||m&&m(t)},visible:!0,disabledIds:x,emphasizeSelected:!1,sortByNumber:!0}))}if(r){const n=e.key.slice(4),r=e.inscriptions.map(e=>e.id||e.inscriptionId||e.inscription_id).filter(Boolean),i=r.includes(o);return rt.createElement("div",{key:e.key||t,style:{position:"relative",padding:"10px 6px 6px 6px",borderRadius:"8px",background:i?"rgba(250, 204, 21, 0.15)":"rgba(250, 204, 21, 0.08)",border:i?"3px solid rgb(250, 204, 21)":"2px solid rgba(250, 204, 21, 0.9)",boxShadow:i?"0 0 0 1px rgb(250, 204, 21), 0 0 15px rgba(250, 204, 21, 0.3)":"0 0 0 1px rgba(161, 98, 7, 0.5)",transition:"all 0.2s ease",cursor:"pointer"},onClick:e=>{(e.target===e.currentTarget||e.target.closest(".standalone-samesat-badge"))&&i&&m&&m("")}},rt.createElement("div",{className:"standalone-samesat-badge",style:{position:"absolute",top:"-10px",left:"8px",padding:"2px 8px",borderRadius:"999px",fontSize:"10px",fontWeight:600,color:"#111827",background:i?"linear-gradient(135deg, #fbbf24, #facc15)":"linear-gradient(135deg, #facc15, #fbbf24)",border:"1px solid rgba(161, 98, 7, 0.9)",boxShadow:"0 2px 4px rgba(0,0,0,0.4)",display:"inline-flex",alignItems:"center",gap:"4px",zIndex:5,cursor:"pointer"}},i&&rt.createElement("span",null,"\u2713"),rt.createElement("span",null,"\ud83e\ude99"),rt.createElement("span",null,"Sat ",n),rt.createElement("span",{style:{fontWeight:500,fontSize:"9px"}},"\xb7 ",e.inscriptions.length)),i&&rt.createElement("div",{style:{position:"absolute",inset:0,overflow:"hidden",borderRadius:"inherit",zIndex:4,pointerEvents:"none"}},rt.createElement("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"70px",color:"rgb(250, 204, 21)",textShadow:"0 0 15px rgba(250, 204, 21, 0.8), 0 0 30px rgba(250, 204, 21, 0.4)",opacity:.9}},"\u2713")),rt.createElement("div",{style:{fontSize:"9px",color:"var(--textMuted)",marginBottom:"4px",marginTop:"4px"}},"Same-sat chain across multiple UTXOs"),rt.createElement(MS,{inscriptions:e.inscriptions,selectedIds:i?r:[],onSelect:e=>{const t=e.id||e.inscriptionId||e.inscription_id;x.includes(t)||m&&m(t)},visible:!0,disabledIds:x,emphasizeSelected:!1,sortByNumber:!1}))}return null}))),a&&(()=>{const e=y.find(e=>(e.id||e.inscriptionId||e.inscription_id)===a);if(!e)return null;let t,n,r="unknown";if(e.utxo&&void 0!==e.utxo.txid&&void 0!==e.utxo.vout&&(t=e.utxo.txid,n=e.utxo.vout,r="utxo"),(!t||void 0===n)&&e.satpoint){const i=String(e.satpoint).split(":");i.length>=2&&(t=t||i[0],n=n??parseInt(i[1]),r="utxo"===r?"utxo+satpoint":"satpoint")}const i=(()=>{const t=String(e.satpoint||"").split(":");return t.length>=3?`:${t[2]}`:""})(),o=e=>!e||e.length<=16?e:`${e.substring(0,8)}...${e.substring(e.length-8)}`;return rt.createElement("div",{style:{marginTop:"6px",padding:"5px 6px",background:"rgba(251, 146, 60, 0.08)",border:"1px solid rgba(251, 146, 60, 0.3)",borderRadius:"4px",fontSize:"9px",color:"var(--textPrimary)"}},rt.createElement("div",{style:{fontFamily:"var(--fontFamily-mono)",wordBreak:"break-all",lineHeight:"1.3"},title:`Full ID: ${a}`},rt.createElement("strong",null,"Target:")," ",o(a)),rt.createElement("div",{style:{fontFamily:"var(--fontFamily-mono)",marginTop:"2px",color:"var(--textMuted)",wordBreak:"break-all",lineHeight:"1.3"},title:`Full outpoint: ${t}:${String(n)}${i}`},rt.createElement("strong",null,"Outpoint:")," ",o(t),":",String(n),i," ",rt.createElement("span",{style:{opacity:.8,fontSize:"8px"}},"[",r,"]")))})(),a&&x.includes(a)&&rt.createElement("div",{style:{marginTop:"6px",padding:"6px",background:"rgba(120,120,120,0.15)",border:"1px solid rgba(120,120,120,0.4)",borderRadius:"4px",fontSize:"11px",color:"var(--textMuted)"}},"This target has already been used in the current batch.")),"destination"===N&&rt.createElement("div",{className:"fade-in",style:{background:"rgba(34, 197, 94, 0.05)",borderRadius:"6px",padding:"6px"}},rt.createElement("label",{className:"form-label",style:{fontSize:"12px",marginBottom:"4px"}},"\ud83d\udccd Destination Address (Optional)"),rt.createElement("input",{type:"text",className:"form-input",value:o,onChange:e=>h&&h(e.target.value),placeholder:w?`Leave empty for your ordinals address (${w.substring(0,10)}...)`:"Leave empty to use your ordinals address",style:{fontSize:"11px",padding:"6px",fontFamily:"var(--fontFamily-mono)"}}),o&&o!==w&&rt.createElement("div",{style:{marginTop:"6px",padding:"6px",background:"rgba(251, 146, 60, 0.1)",border:"1px solid rgba(251, 146, 60, 0.3)",borderRadius:"4px",fontSize:"11px",color:"var(--accentAmber)"}},"\u26a0\ufe0f ",rt.createElement("strong",null,"Warning:")," You are sending to a custom address. Make sure you control this address!"),!o&&w&&rt.createElement("div",{style:{marginTop:"6px",padding:"6px",background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)",borderRadius:"4px",fontSize:"11px",color:"var(--accentGreen)"}},"\u2713 Will send to your ordinals address: ",rt.createElement("span",{style:{fontFamily:"var(--fontFamily-mono)"}},w.substring(0,20),"...")),rt.createElement("div",{style:{marginTop:"12px",padding:"10px",background:"var(--bgSecondary)",borderRadius:"6px",fontSize:"11px",color:"var(--textMuted)",lineHeight:"1.5"}},rt.createElement("div",{style:{fontWeight:600,color:"var(--textSecondary)",marginBottom:"6px"}},"\ud83d\udca1 What is this?"),rt.createElement("ul",{style:{margin:0,paddingLeft:"20px"}},rt.createElement("li",null,"Where the ",rt.createElement("strong",null,"newly created inscription")," will be sent"),rt.createElement("li",null,"Change and funding still come from your payment address"),rt.createElement("li",null,"Leave empty to send to your ordinals address (recommended)"),rt.createElement("li",null,"Use custom address to gift inscriptions or send to cold storage")))),"meta"===N&&rt.createElement("div",{className:"fade-in"},rt.createElement("label",{className:"form-label",style:{fontSize:"12px",marginBottom:"4px"}},"Metaprotocol (Tag 7)"),rt.createElement("input",{type:"text",className:"form-input",value:t,onChange:e=>u&&u(e.target.value),placeholder:"e.g., cbrc-20",style:{fontSize:"12px",padding:"6px"}}),rt.createElement("p",{style:{margin:"4px 0 0 0",fontSize:"11px",color:"var(--textMuted)",lineHeight:"1.4"}},"\ud83d\udca1 Specify protocol for interpretation (e.g., brc-20, sns, ordinal-collections)")),"metadata"===N&&rt.createElement("div",{className:"fade-in"},rt.createElement("label",{className:"form-label",style:{fontSize:"12px",marginBottom:"4px"}},"Metadata JSON (Tag 5)"),rt.createElement("textarea",{className:"form-input form-textarea",value:n,onChange:e=>d&&d(e.target.value),placeholder:'{"key": "value"}',style:{fontSize:"11px",padding:"6px",minHeight:"120px",fontFamily:"var(--fontFamily-mono)",borderColor:n&&!j.valid?"var(--accentAmber)":void 0}}),n&&rt.createElement("div",{style:{marginTop:"4px",fontSize:"11px",color:j.valid?"var(--accentCyan)":"var(--accentAmber)"}},j.message),rt.createElement("p",{style:{margin:"4px 0 0 0",fontSize:"11px",color:"var(--textMuted)",lineHeight:"1.4"}},"\ud83d\udca1 Arbitrary JSON metadata (CBOR-encoded automatically)")),"properties"===N&&rt.createElement("div",{className:"fade-in"},rt.createElement("div",{style:{marginBottom:"8px",padding:"8px",background:"rgba(139, 92, 246, 0.1)",border:"1px solid rgba(139, 92, 246, 0.3)",borderRadius:"6px",fontSize:"11px",lineHeight:"1.5",color:"var(--textPrimary)"}},rt.createElement("div",{style:{fontWeight:600,marginBottom:"4px",color:"rgb(168, 85, 247)"}},"\ud83d\udcd6 What are Properties?"),rt.createElement("div",{style:{color:"var(--textMuted)"}},rt.createElement("strong",null,"Properties")," are structured, protocol-defined metadata with strict schema rules. Unlike ",rt.createElement("strong",null,"Metadata")," (Tag 5, free-form), properties must follow ordinals spec."),rt.createElement("div",{style:{marginTop:"6px",paddingLeft:"8px",borderLeft:"2px solid rgba(139, 92, 246, 0.3)"}},rt.createElement("div",null,rt.createElement("strong",null,"\ud83d\uddbc\ufe0f Gallery:")," Showcase other inscriptions (key 0 = items array)"),rt.createElement("div",null,rt.createElement("strong",null,"\ud83c\udff7\ufe0f Attributes:"),' Add title to your inscription (key 1 \u2192 key 0 = "title")'))),rt.createElement("div",{style:{marginBottom:"12px"}},rt.createElement("label",{className:"form-label",style:{fontSize:"12px",marginBottom:"8px",display:"block"}},"Choose Type"),rt.createElement("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"6px"}},rt.createElement("button",{type:"button",onClick:()=>C("gallery"),style:{padding:"10px 8px",fontSize:"11px",background:"gallery"===B?"linear-gradient(135deg, rgb(139, 92, 246), rgb(168, 85, 247))":"rgb(38, 38, 38)",border:"1px solid rgb(55, 55, 55)",borderRadius:"8px",color:"white",cursor:"pointer",fontWeight:"gallery"===B?600:400,transition:"all 0.2s"}},"\ud83d\uddbc\ufe0f Gallery"),rt.createElement("button",{type:"button",onClick:()=>C("attributes"),style:{padding:"10px 8px",fontSize:"11px",background:"attributes"===B?"linear-gradient(135deg, rgb(59, 130, 246), rgb(37, 99, 235))":"rgb(38, 38, 38)",border:"1px solid rgb(55, 55, 55)",borderRadius:"8px",color:"white",cursor:"pointer",fontWeight:"attributes"===B?600:400,transition:"all 0.2s"}},"\ud83c\udff7\ufe0f Attributes"),rt.createElement("button",{type:"button",onClick:()=>C("advanced"),style:{padding:"10px 8px",fontSize:"11px",background:"advanced"===B?"linear-gradient(135deg, rgb(34, 197, 94), rgb(22, 163, 74))":"rgb(38, 38, 38)",border:"1px solid rgb(55, 55, 55)",borderRadius:"8px",color:"white",cursor:"pointer",fontWeight:"advanced"===B?600:400,transition:"all 0.2s"}},"\ud83d\udcbb JSON"))),"gallery"===B&&rt.createElement("div",null,rt.createElement("div",{style:{marginBottom:"12px",padding:"8px",background:"rgba(139, 92, 246, 0.05)",borderLeft:"3px solid rgb(139, 92, 246)",borderRadius:"4px",fontSize:"10px",color:"var(--textMuted)"}},rt.createElement("strong",null,"Gallery:")," Create a permissionless collection showcasing other inscriptions. Items appear on ordinals.com. Anyone can make galleries - no provenance required."),rt.createElement("label",{className:"form-label",style:{fontSize:"12px",marginBottom:"6px"}},"Gallery Title ",rt.createElement("span",{style:{color:"var(--textMuted)",fontWeight:400}},"(required)")),rt.createElement("input",{type:"text",className:"form-input "+(O&&""!==O.trim()?"":"xverse-input-invalid"),value:O,onChange:e=>{const t=e.target.value;L(t);const n=(F||"").split(/[\n,]+/).map(e=>D(e)).filter(Boolean),r={};(U||"").split("\n").forEach(e=>{const t=e.trim().match(/^([^=]+)=(.+)$/);if(t){const e=t[1].trim();let n=t[2].trim();"true"===n?n=!0:"false"===n?n=!1:"null"===n?n=null:/^-?\d+$/.test(n)&&(n=parseInt(n)),r[e]=n}});const i={0:n,1:{0:t,...Object.keys(r).length>0?{1:r}:{}}},a=JSON.stringify(i,null,2);f&&f(a)},onBlur:e=>{const t=F.split(/[\n,]+/).map(e=>D(e)).filter(Boolean),n={};(U||"").split("\n").forEach(e=>{const t=e.trim().match(/^([^=]+)=(.+)$/);if(t){const e=t[1].trim();let r=t[2].trim();"true"===r?r=!0:"false"===r?r=!1:"null"===r?r=null:/^-?\d+$/.test(r)&&(r=parseInt(r)),n[e]=r}});const r={0:t,1:{0:e.target.value,...Object.keys(n).length>0?{1:n}:{}}};f&&f(JSON.stringify(r,null,2))},onKeyDown:e=>{"Enter"===e.key&&e.target.blur()},placeholder:"My Bitcoin Art Collection",style:{fontSize:"12px",padding:"8px",marginBottom:"12px"}}),rt.createElement("label",{className:"form-label",style:{fontSize:"12px",marginBottom:"6px"}},"Traits ",rt.createElement("span",{style:{color:"var(--textMuted)",fontWeight:400}},"(optional, key=value format)")),rt.createElement("textarea",{className:"form-input form-textarea",value:U,onChange:e=>{const t=e.target.value;M(t);const n=(F||"").split(/[\n,]+/).map(e=>D(e)).filter(Boolean),r={};t.split("\n").forEach(e=>{const t=e.trim().match(/^([^=]+)=(.+)$/);if(t){const e=t[1].trim();let n=t[2].trim();"true"===n?n=!0:"false"===n?n=!1:"null"===n?n=null:/^-?\d+$/.test(n)&&(n=parseInt(n)),r[e]=n}});const i={0:n,1:{0:O,...Object.keys(r).length>0?{1:r}:{}}};f&&f(JSON.stringify(i,null,2))},placeholder:"artist = Satoshi\nyear = 2024\nverified = true",style:{fontSize:"11px",padding:"8px",minHeight:"60px",marginBottom:"12px",fontFamily:"var(--fontFamily-mono)"}}),rt.createElement("p",{style:{margin:"6px 0 12px 0",fontSize:"10px",color:"var(--textMuted)",lineHeight:"1.4"}},"\ud83d\udca1 Traits support: strings, integers (42), booleans (true/false), null. Switch to \ud83d\udcbb JSON mode for per-item attributes."),rt.createElement("label",{className:"form-label",style:{fontSize:"12px",marginBottom:"6px"}},"Inscription IDs to Include ",rt.createElement("span",{style:{color:"var(--textMuted)",fontWeight:400}},"(one per line or comma-separated)")),rt.createElement("textarea",{className:"form-input form-textarea",value:F,onChange:e=>{const t=e.target.value;R(t);const n={0:t.split(/[\n,]+/).map(e=>D(e)).filter(Boolean),1:{0:O}};f&&f(JSON.stringify(n,null,2))},onBlur:e=>{const t={0:e.target.value.split(/[\n,]+/).map(e=>D(e)).filter(Boolean),1:{0:O}};f&&f(JSON.stringify(t,null,2))},placeholder:"abc123...def456...xyz789i0\nor comma: abc123, def456, xyz789i0",style:{fontSize:"11px",padding:"8px",minHeight:"100px",fontFamily:"var(--fontFamily-mono)"}}),(()=>{const e=(F||"").split(/[\n,]+/).map(e=>D(e)).filter(Boolean);return 0===e.length?null:rt.createElement("div",{style:{marginTop:"10px",padding:"8px",border:"1px solid var(--borderMedium)",borderRadius:"8px",background:"rgba(0, 0, 0, 0.15)"}},rt.createElement("div",{style:{fontSize:"11px",fontWeight:600,color:"var(--textPrimary)",marginBottom:"6px"}},"Gallery Items (preview)"),rt.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"4px"}},e.slice(0,12).map(e=>{const t=(e=>/^[a-f0-9]{64}i\d+$/i.test(String(e||"").trim()))(e),n=z.get(e),r=n?.sat||n?.sat_number||n?.satNumber,i=n?.utxo?.value,a=[t?"\u2713":"\u26a0\ufe0f",e,null!=r?`sat ${r}`:null,null!=i?`${i} sats`:null].filter(Boolean).join(" \xb7 ");return rt.createElement("div",{key:e,style:{fontSize:"10px",color:t?"var(--textSecondary)":"var(--accentAmber)",fontFamily:"var(--fontFamily-mono)",wordBreak:"break-all"}},a)}),e.length>12&&rt.createElement("div",{style:{fontSize:"10px",color:"var(--textMuted)"}},"\u2026and ",e.length-12," more")))})(),rt.createElement("p",{style:{margin:"6px 0 0 0",fontSize:"10px",color:"var(--textMuted)",lineHeight:"1.4"}},"\ud83d\udca1 Paste full inscription IDs from ordinals.com (format: txidiindex). Updates when you click out.")),"attributes"===B&&rt.createElement("div",null,rt.createElement("div",{style:{marginBottom:"12px",padding:"8px",background:"rgba(59, 130, 246, 0.05)",borderLeft:"3px solid rgb(59, 130, 246)",borderRadius:"4px",fontSize:"10px",color:"var(--textMuted)"}},rt.createElement("strong",null,"Attributes:")," Add structured metadata like a title. These follow strict ordinals protocol (Tag 17) and appear on ordinals.com. Use ",rt.createElement("strong",null,"Metadata")," tab for free-form data."),rt.createElement("label",{className:"form-label",style:{fontSize:"12px",marginBottom:"6px"}},"Title ",rt.createElement("span",{style:{color:"var(--textMuted)",fontWeight:400}},"(displayed on ordinals.com)")),rt.createElement("input",{type:"text",className:"form-input",value:$,onChange:e=>H(e.target.value),onBlur:e=>{const t={1:{0:e.target.value}};f&&f(JSON.stringify(t,null,2))},onKeyDown:e=>{"Enter"===e.key&&e.target.blur()},placeholder:"Genesis Inscription",style:{fontSize:"12px",padding:"8px"}}),rt.createElement("p",{style:{margin:"6px 0 0 0",fontSize:"10px",color:"var(--textMuted)",lineHeight:"1.4"}},"\ud83d\udca1 Adds protocol-compliant title. For custom fields, use the ",rt.createElement("strong",null,"Data")," (Metadata) tab instead.")),"advanced"===B&&rt.createElement("div",null,rt.createElement("div",{style:{marginBottom:"12px",padding:"8px",background:"rgba(34, 197, 94, 0.05)",borderLeft:"3px solid rgb(34, 197, 94)",borderRadius:"4px",fontSize:"10px",color:"var(--textMuted)"}},rt.createElement("strong",null,"Advanced:")," Manually write properties JSON. Must follow strict ordinals schema with numeric keys: ",rt.createElement("code",{style:{background:"rgba(0,0,0,0.3)",padding:"1px 4px",borderRadius:"2px"}},"0")," for items array,",rt.createElement("code",{style:{background:"rgba(0,0,0,0.3)",padding:"1px 4px",borderRadius:"2px"}}," 1")," for attributes."),rt.createElement("label",{className:"form-label",style:{fontSize:"12px",marginBottom:"6px"}},"Properties JSON ",rt.createElement("span",{style:{color:"var(--textMuted)",fontWeight:400}},"(ordinals schema - Tag 17)")),rt.createElement("textarea",{className:"form-input form-textarea",value:r,onChange:e=>f&&f(e.target.value),placeholder:'{\\n  "0": ["inscriptionId1", "inscriptionId2"],\\n  "1": { "0": "Gallery Title" }\\n}',style:{fontSize:"11px",padding:"8px",minHeight:"140px",fontFamily:"var(--fontFamily-mono)",borderColor:r&&!q.valid?"var(--accentAmber)":void 0}}),r&&rt.createElement("div",{style:{marginTop:"4px",fontSize:"11px",color:q.valid?"var(--accentCyan)":"var(--accentAmber)"}},q.message),rt.createElement("div",{style:{marginTop:"12px",padding:"10px",background:"rgba(6, 182, 212, 0.05)",border:"1px solid rgba(6, 182, 212, 0.2)",borderRadius:"8px",fontSize:"10px",lineHeight:"1.5",color:"var(--textMuted)"}},rt.createElement("div",{style:{fontWeight:600,color:"var(--accentCyan)",marginBottom:"4px"}},"\ud83d\udccb Schema Reference"),rt.createElement("div",{style:{fontFamily:"var(--fontFamily-mono)",fontSize:"9px",background:"rgba(0,0,0,0.3)",padding:"6px",borderRadius:"4px"}},'{ "0": [items], "1": { "0": "title" } }'),rt.createElement("div",{style:{marginTop:"6px"}},rt.createElement("strong",null,'Key "0":')," Array of inscription IDs (gallery items)",rt.createElement("br",null),rt.createElement("strong",null,'Key "1":')," Attributes object \u2192 ",rt.createElement("strong",null,'Key "0":')," Title text"))),rt.createElement("button",{type:"button",onClick:()=>{f&&f(""),L(""),R(""),M(""),H("")},style:{marginTop:"12px",width:"100%",padding:"8px",fontSize:"11px",background:"rgb(38, 38, 38)",border:"1px solid rgb(55, 55, 55)",borderRadius:"8px",color:"var(--textMuted)",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:e=>{e.target.style.background="rgb(220, 38, 38)",e.target.style.color="white"},onMouseLeave:e=>{e.target.style.background="rgb(38, 38, 38)",e.target.style.color="var(--textMuted)"}},"\ud83d\uddd1\ufe0f Clear Properties")),"pointer"===N&&rt.createElement("div",{className:"fade-in"},rt.createElement("label",{className:"form-label",style:{fontSize:"12px",marginBottom:"6px"}},"Pointer"),rt.createElement("input",{type:"text",className:"form-input",value:i,onChange:e=>p&&p(e.target.value),placeholder:"0",style:{fontSize:"12px",padding:"8px",borderColor:i&&!K.valid?"var(--accentAmber)":void 0}}),i&&rt.createElement("div",{style:{marginTop:"4px",fontSize:"11px",color:K.valid?"var(--accentCyan)":"var(--accentAmber)"}},K.message),rt.createElement("p",{style:{margin:"8px 0 0 0",fontSize:"11px",color:"var(--textMuted)",lineHeight:"1.4"}},"\ud83d\udca1 A pointer selects which sat position (0-based) the inscription should attach to. Leave blank unless you know you need it. For reinscriptions, this is typically auto-set to match the original sat."))))}const HS=.2,DS=[{label:"Low",value:5,icon:"\ud83d\udc22"},{label:"Balanced",value:15,icon:"\u26a1"},{label:"Priority",value:35,icon:"\ud83d\ude80"}],zS=e=>"number"==typeof e&&!Number.isNaN(e),WS=e=>zS(e)?e.toLocaleString():"\u2014",VS=({label:e,helper:t,value:n,accent:r=!1})=>rt.createElement("div",{className:"flex items-baseline justify-between gap-2 rounded-sm border border-neutral-800/70 bg-neutral-900/40 px-1.5 py-1"},rt.createElement("div",{className:"min-w-0 flex-1"},rt.createElement("p",{className:"text-[10px] uppercase tracking-wide text-neutral-500 truncate"},e),t&&rt.createElement("p",{className:"text-[10px] text-neutral-500 truncate"},t)),rt.createElement("p",{className:"text-xs font-semibold whitespace-nowrap shrink-0 "+(r?"text-fuchsia-200":"text-neutral-100")},WS(n),rt.createElement("span",{className:"ml-1 text-[10px] font-normal text-neutral-500"},"sats")));function jS({feeRate:e=null,onFeeRateChange:t,feeEstimate:n,contentSize:r=0,feeRates:i=null,feeItemCount:a=1,onSubmit:o,isSubmitting:s=!1,isDisabled:l=!1}){const[c,u]=rt.useState(()=>{try{const e=localStorage.getItem("nexus.localBtcRate");if(!e)return"";const t=Number(e);return Number.isFinite(t)&&t>0?String(t):""}catch{return""}}),d=rt.useMemo(()=>{const e=Number(c);return Number.isFinite(e)&&e>0?e:null},[c]),f=rt.useMemo(()=>i&&i.slow&&i.medium&&i.fast?[{label:"Low",value:i.slow,icon:"\ud83d\udc22",apiLabel:"~1 hour"},{label:"Balanced",value:i.medium,icon:"\u26a1",apiLabel:"~30 min"},{label:"Priority",value:i.fast,icon:"\ud83d\ude80",apiLabel:"~10 min"}]:DS,[i]),p=zS(n?.commitFee)?n.commitFee:null,m=zS(n?.revealFee)?n.revealFee:null,h=zS(n?.commitSize)?n.commitSize:void 0,g=zS(n?.revealSize)?n.revealSize:void 0,y=zS(n?.postage)?n.postage:zS(n?.inscriptionPostage)?n.inscriptionPostage:null,b=zS(n?.dustAdjustment)?n.dustAdjustment:0,w=zS(p)||zS(m),x=w?(p??0)+(m??0):null,v=(m??0)+(y??0),S=zS(n?.revealFunding)?n.revealFunding:w||zS(y)?v:null,E=rt.useMemo(()=>{if(zS(n?.itemCount))return Math.max(1,Math.floor(n.itemCount));const e=Number(a);return Number.isFinite(e)&&e>0?Math.floor(e):1},[n?.itemCount,a]),I=rt.useMemo(()=>{try{return Ug(E)}catch{return[]}},[E]),k=rt.useMemo(()=>{try{return Mg(E)}catch{return 0}},[E]),A=rt.useMemo(()=>{const e=new Map;for(const t of I){const n=`${t.purpose}:${t.address}:${t.description}`,r=e.get(n);r?(r.value+=t.value,r.count+=1):e.set(n,{...t,count:1})}return Array.from(e.values())},[I]),N=zS(n?.totalRequired)?n.totalRequired:zS(S)||zS(p)?(p??0)+(S??0)+k:null,T=zS($=N)?($/1e8).toFixed(8):null,_=rt.useMemo(()=>zS(N)&&d?N/1e8*d:null,[N,d]),P=zS(n?.parentCount)?n.parentCount:0,B=y,C=r?`${r.toLocaleString()} bytes \u2022 ${(r/1024).toFixed(2)} KB`:"Add content to calculate fees",O=e=>{if(!t)return;if(null==e||""===String(e).trim())return void t(null);const n=Number(e);Number.isFinite(n)&&t(Math.max(HS,Math.min(250,n)))},L=Boolean(n),F=i&&!i.isDefault,R=i?.isDefault||!i,U=F,M=rt.useMemo(()=>zS(e)?e:null,[e]);var $;return rt.createElement("aside",{className:"flex h-full flex-col rounded-xl border border-neutral-800/60 bg-neutral-950/80 backdrop-blur overflow-hidden"},rt.createElement("header",{className:"flex items-start justify-between border-b border-neutral-800/70 px-2 py-1.5 shrink-0"},rt.createElement("div",{className:"min-w-0"},rt.createElement("div",{className:"flex items-center gap-2"},rt.createElement("p",{className:"text-sm font-semibold text-neutral-100"},"Fee estimator"),F?rt.createElement("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-green-500/10 text-green-400 border border-green-500/30"},"Live"):R?rt.createElement("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-yellow-500/10 text-yellow-400 border border-yellow-500/30"},"Manual"):null),rt.createElement("p",{className:"text-[11px] text-neutral-500"},C),P>0&&rt.createElement("p",{className:"text-[10px] text-neutral-500"},"Parents selected: ",P),R&&rt.createElement("p",{className:"text-[10px] text-yellow-400 mt-1"},"\u26a0\ufe0f Enter your own fee rate - No confirmed rates available"),rt.createElement("p",{className:"text-[10px] text-neutral-500 mt-1"},"\ud83d\udca1 Minimum fee rate enforced: ",HS," sat/vB"))),rt.createElement("div",{className:"px-2 py-1.5"},rt.createElement("label",{className:"text-[11px] font-semibold uppercase tracking-wide text-neutral-500"},U?"Adjust fee rate":"Enter fee rate (sat/vB)"),rt.createElement("input",{type:"number",min:HS,max:250,step:"0.1",value:e??"",onChange:e=>O(e.target.value),className:"mt-1.5 w-full rounded-md bg-neutral-900 border border-neutral-800 px-2 py-1 text-sm font-semibold text-neutral-200 focus:border-fuchsia-500 focus:outline-none focus:ring-1 focus:ring-fuchsia-500",placeholder:null===e?"Waiting for API or enter manually (min 0.2)":"Enter sat/vB"}),U&&rt.createElement(rt.Fragment,null,rt.createElement("input",{type:"range",min:HS,max:250,step:"0.1",value:M??HS,onChange:e=>O(e.target.value),className:"mt-1.5 h-1.5 w-full cursor-pointer appearance-none rounded-full bg-neutral-800 accent-fuchsia-500"}),rt.createElement("div",{className:"mt-1.5 flex flex-wrap gap-1.5 sm:gap-2"},f.map(e=>{const t=zS(M)&&Math.abs(M-e.value)<1e-9;return rt.createElement("button",{key:e.label,type:"button",onClick:()=>O(e.value),className:"flex flex-1 min-w-[80px] flex-col items-center justify-center rounded-md border px-1.5 sm:px-2 py-1 sm:py-1.5 text-xs font-medium transition-colors touch-manipulation "+(t?"border-fuchsia-400/70 bg-fuchsia-500/10 text-fuchsia-100":"border-neutral-800/60 bg-neutral-900/60 text-neutral-300 hover:border-neutral-700 hover:bg-neutral-800")},rt.createElement("span",null,e.label),rt.createElement("span",{className:"text-[11px] text-neutral-400"},e.value," sat/vB"),e.apiLabel&&rt.createElement("span",{className:"text-[10px] text-neutral-500"},e.apiLabel))})))),rt.createElement("div",{className:"flex-1 overflow-y-auto px-2 pb-1"},L?rt.createElement("div",{className:"space-y-1.5"},rt.createElement(VS,{label:"Commit transaction",helper:h?`${h} vB`:void 0,value:p}),rt.createElement(VS,{label:"Reveal transaction",helper:g?`${g} vB`:void 0,value:m}),"number"==typeof B&&B>0&&rt.createElement(VS,{label:"Postage",value:B}),rt.createElement(VS,{label:"Network fees",value:x,accent:!0}),rt.createElement(VS,{label:"Reveal funding",value:S}),A.map((e,t)=>rt.createElement(VS,{key:`${e.purpose}-${t}`,label:e.count>1?`${e.description} (x${e.count})`:e.description,helper:"platform-fee"===e.purpose?"Platform":"developer-fee"===e.purpose?"Developer":"Custom",value:e.value})),b>0&&rt.createElement("div",{className:"rounded-md border border-amber-400/40 bg-amber-500/10 px-2 py-1 text-[10px] text-amber-200"},"Added ",WS(b)," sats to satisfy Taproot dust limits.")):rt.createElement("div",{className:"flex h-full flex-col items-center justify-center rounded-lg border border-dashed border-neutral-800/60 bg-neutral-900/40 px-3 py-4 text-center text-sm text-neutral-400"},rt.createElement("p",{className:"text-lg"},"\ud83e\ude84"),rt.createElement("p",null,"Add inscription content to generate an exact fee breakdown."),rt.createElement("p",{className:"mt-1 text-xs text-neutral-500"},"Adjust the fee rate now and we'll apply it once content is ready."))),L&&rt.createElement("div",{className:"border-t border-neutral-800/70 px-2 py-1.5"},rt.createElement("div",{className:"rounded-md border border-fuchsia-500/40 bg-fuchsia-500/10 px-2 py-1.5"},rt.createElement("p",{className:"text-xs uppercase tracking-wide text-fuchsia-200"},"Total required"),rt.createElement("div",{className:"mt-1 flex flex-wrap items-baseline justify-between gap-1"},rt.createElement("span",{className:"text-base sm:text-lg font-semibold text-fuchsia-100"},WS(N),rt.createElement("span",{className:"ml-1 text-xs sm:text-sm font-medium text-fuchsia-200"},"sats")),T&&rt.createElement("span",{className:"text-[11px] text-fuchsia-200"},"\u2248 ",T," BTC")),rt.createElement("div",{className:"mt-2"},rt.createElement("label",{className:"text-[11px] font-semibold uppercase tracking-wide text-neutral-500"},"Local rate (1 BTC =)"),rt.createElement("input",{type:"number",min:0,step:"0.01",value:c,onChange:e=>(e=>{const t=String(e??"").trim();u(t);try{const e=Number(t);Number.isFinite(e)&&e>0?localStorage.setItem("nexus.localBtcRate",String(e)):localStorage.removeItem("nexus.localBtcRate")}catch{}})(e.target.value),className:"mt-1.5 w-full rounded-md bg-neutral-900 border border-neutral-800 px-2 py-1 text-sm font-semibold text-neutral-200 focus:border-fuchsia-500 focus:outline-none focus:ring-1 focus:ring-fuchsia-500",placeholder:"Enter your local BTC price"}),null!==_&&rt.createElement("p",{className:"mt-2 text-[11px] text-fuchsia-200"},"\u2248 ",new Intl.NumberFormat(void 0,{maximumFractionDigits:2}).format(_)," local")))),rt.createElement("div",{className:"border-t border-neutral-800/70 px-2 py-1.5"},rt.createElement("button",{onClick:o,disabled:l||s,className:`\n            w-full px-3 py-2.5 sm:py-1.5 rounded-md font-semibold text-sm transition-all duration-200 touch-manipulation\n            ${l||s?"bg-neutral-800/50 text-neutral-500 cursor-not-allowed border border-neutral-700/30":"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white shadow-lg shadow-purple-500/30 hover:shadow-purple-500/50"}\n          `},s?"\u23f3 Inscribing...":"\u2728 Create Inscription")))}function qS({type:e="info",message:t,onClose:n,autoDismiss:r=!0}){rt.useEffect(()=>{if(r&&n){const e=setTimeout(n,5e3);return()=>clearTimeout(e)}},[r,n]);const i={error:{bg:"bg-red-500/90",border:"border-red-400/30",icon:"\u274c"},success:{bg:"bg-green-500/90",border:"border-green-400/30",icon:"\u2705"},info:{bg:"bg-blue-500/90",border:"border-blue-400/30",icon:"\u2139\ufe0f"}},a=i[e]||i.info;return rt.createElement("div",{className:"fixed top-16 sm:top-20 left-2 right-2 sm:left-5 sm:right-5 z-[9800] animate-slide-down",style:{paddingBottom:"env(safe-area-inset-bottom, 0px)"}},rt.createElement("div",{className:`\n        ${a.bg} ${a.border}\n        backdrop-blur-md border rounded-xl p-3 sm:p-4 shadow-2xl\n        flex items-start gap-2 sm:gap-3\n        max-w-lg mx-auto\n      `},rt.createElement("span",{className:"text-base sm:text-lg flex-shrink-0"},a.icon),rt.createElement("div",{className:"flex-1 text-white text-xs sm:text-sm font-medium leading-relaxed min-w-0 break-words"},t),n&&rt.createElement("button",{onClick:n,className:"flex-shrink-0 text-white/70 hover:text-white transition-colors p-1 touch-manipulation","aria-label":"Dismiss"},"\u2715")))}function KS({result:e,onClose:t}){if(!e)return null;const n=Array.isArray(e.revealTxIds)?e.revealTxIds:e.revealTxId?[e.revealTxId]:[],r=n.length>1,i=n[0]||"",a=e.inscriptionId||(i?`${i}i0`:"");return it.createElement("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-end sm:items-center justify-center z-[9500] p-0 sm:p-4"},it.createElement("div",{className:"bg-gray-800 rounded-t-2xl sm:rounded-lg max-w-2xl w-full mx-0 sm:mx-4 max-h-[90dvh] max-h-[90vh] flex flex-col",style:{paddingBottom:"env(safe-area-inset-bottom, 0px)"}},it.createElement("div",{className:"p-4 sm:p-6 pb-0 overflow-y-auto flex-1 min-h-0"},it.createElement("div",{className:"flex items-center justify-between mb-4 gap-2"},it.createElement("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0"},it.createElement("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-green-600 rounded-full flex items-center justify-center shrink-0"},it.createElement("svg",{className:"w-5 h-5 sm:w-6 sm:h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},it.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"}))),it.createElement("div",{className:"min-w-0"},it.createElement("h2",{className:"text-base sm:text-xl font-bold text-white truncate"},r?"Batch Inscription Created!":"Inscription Created!"),it.createElement("p",{className:"text-xs sm:text-sm text-gray-400"},r?`${n.length} inscriptions successfully broadcast`:"Your inscription has been successfully broadcast"))),it.createElement("button",{onClick:t,className:"text-gray-400 hover:text-white transition-colors"},it.createElement("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},it.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})))),it.createElement("div",{className:"mb-4 p-4 bg-gray-700 rounded-lg"},it.createElement("div",{className:"flex items-center justify-between mb-2"},it.createElement("h3",{className:"text-sm font-semibold text-orange-400 flex items-center gap-2"},it.createElement("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},it.createElement("path",{d:"M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"}),it.createElement("path",{fillRule:"evenodd",d:"M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z",clipRule:"evenodd"})),"Commit Transaction"),it.createElement("span",{className:"text-xs text-gray-400 bg-gray-600 px-2 py-1 rounded"},"Step 1/2")),it.createElement("div",{className:"flex items-center gap-2 mb-2"},it.createElement("code",{className:"text-xs text-gray-300 bg-gray-800 px-2 py-1 rounded flex-1 overflow-x-auto break-all"},e.commitTxId),it.createElement("button",{onClick:()=>navigator.clipboard.writeText(e.commitTxId),className:"px-3 py-1 bg-gray-600 hover:bg-gray-500 rounded text-xs text-white transition-colors"},"Copy")),it.createElement("a",{href:nh(`/tx/${e.commitTxId}`),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-sm text-blue-400 hover:text-blue-300 transition-colors"},"View on Mempool.space",it.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},it.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})))),r?it.createElement("div",{className:"space-y-3"},it.createElement("h3",{className:"text-sm font-semibold text-green-400 flex items-center gap-2"},it.createElement("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},it.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})),"Reveal Transactions (",n.length,")"),it.createElement("div",{className:"max-h-64 overflow-y-auto space-y-2"},n.map((e,t)=>it.createElement("div",{key:e,className:"p-3 bg-gray-700 rounded-lg"},it.createElement("div",{className:"flex items-center justify-between mb-2"},it.createElement("span",{className:"text-xs text-gray-400"},"Reveal #",t+1),it.createElement("span",{className:"text-xs text-green-400 bg-green-900 bg-opacity-30 px-2 py-1 rounded"},"Step 2/2")),it.createElement("div",{className:"flex items-center gap-2 mb-2"},it.createElement("code",{className:"text-xs text-gray-300 bg-gray-800 px-2 py-1 rounded flex-1 overflow-x-auto break-all"},e),it.createElement("button",{onClick:()=>navigator.clipboard.writeText(e),className:"px-2 py-1 bg-gray-600 hover:bg-gray-500 rounded text-xs text-white transition-colors"},"Copy")),it.createElement("a",{href:nh(`/tx/${e}`),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-sm text-blue-400 hover:text-blue-300 transition-colors"},"View on Mempool.space",it.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},it.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"}))))))):it.createElement("div",{className:"p-4 bg-gray-700 rounded-lg"},it.createElement("div",{className:"flex items-center justify-between mb-2"},it.createElement("h3",{className:"text-sm font-semibold text-green-400 flex items-center gap-2"},it.createElement("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},it.createElement("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})),"Reveal Transaction (Inscription)"),it.createElement("span",{className:"text-xs text-green-400 bg-green-900 bg-opacity-30 px-2 py-1 rounded"},"Step 2/2")),it.createElement("div",{className:"flex items-center gap-2 mb-2"},it.createElement("code",{className:"text-xs text-gray-300 bg-gray-800 px-2 py-1 rounded flex-1 overflow-x-auto break-all"},i),it.createElement("button",{onClick:()=>navigator.clipboard.writeText(i),className:"px-3 py-1 bg-gray-600 hover:bg-gray-500 rounded text-xs text-white transition-colors"},"Copy")),it.createElement("div",{className:"flex flex-wrap gap-2 sm:gap-3"},it.createElement("a",{href:nh(`/tx/${i}`),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-sm text-blue-400 hover:text-blue-300 transition-colors"},"View Transaction",it.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},it.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"}))),a&&it.createElement("a",{href:th(`/inscription/${a}`),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-sm text-purple-400 hover:text-purple-300 transition-colors"},"View Inscription",it.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},it.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"}))))),it.createElement("div",{className:"mt-4 p-4 bg-blue-900 bg-opacity-30 border border-blue-700 rounded-lg"},it.createElement("div",{className:"flex items-start gap-3"},it.createElement("svg",{className:"w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},it.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})),it.createElement("div",{className:"text-sm text-blue-200 space-y-2"},it.createElement("p",null,it.createElement("strong",{className:"text-blue-100"},"Your inscription is being processed")),it.createElement("ul",{className:"list-disc list-inside space-y-1 text-xs text-blue-300"},it.createElement("li",null,"Transactions are now in the mempool waiting for confirmation"),it.createElement("li",null,it.createElement("strong",null,"Used UTXOs are temporarily locked")," - they won't appear in the UTXO selector until confirmed"),it.createElement("li",null,"Your inscription will appear on ordinals.com after the reveal transaction confirms"),it.createElement("li",null,"You can close this modal and create another inscription with remaining UTXOs")))))),it.createElement("div",{className:"p-4 sm:px-6 sm:pb-6 pt-3 border-t border-gray-700 flex flex-col sm:flex-row gap-2 sm:gap-3 shrink-0"},it.createElement("button",{onClick:t,className:"flex-1 px-4 py-3 sm:py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg font-medium transition-colors text-sm sm:text-base"},"Create Another Inscription"),it.createElement("a",{href:nh(`/tx/${i}`),target:"_blank",rel:"noopener noreferrer",className:"px-4 py-3 sm:py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg font-medium transition-colors flex items-center justify-center gap-2 text-sm sm:text-base"},"Track in Mempool",it.createElement("svg",{className:"w-4 h-4 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},it.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"}))))))}function XS({label:e,txid:t,showExplorer:n=!0}){return t?it.createElement("div",{className:"p-4 bg-gray-700 rounded-lg"},it.createElement("div",{className:"flex items-center justify-between mb-2"},it.createElement("h3",{className:"text-sm font-semibold text-green-400"},e)),it.createElement("div",{className:"flex items-center gap-2 mb-2"},it.createElement("code",{className:"text-xs text-gray-300 bg-gray-800 px-2 py-1 rounded flex-1 overflow-x-auto break-all"},t),it.createElement("button",{onClick:()=>navigator.clipboard.writeText(t),className:"px-3 py-1 bg-gray-600 hover:bg-gray-500 rounded text-xs text-white transition-colors"},"Copy")),n?it.createElement("a",{href:nh(`/tx/${t}`),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-sm text-blue-400 hover:text-blue-300 transition-colors"},"View on Mempool.space",it.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},it.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"}))):null):null}function GS({kind:e,result:t,onClose:n}){if(!t)return null;const r=!1!==t?.broadcasted,i="listing"===e,a="funding"===e,o=i?r?"Listing Broadcast!":"Listing Preview (Not Broadcast)":a?r?"Funding Transaction Broadcast!":"Funding Transaction Preview (Not Broadcast)":r?"Purchase Broadcast!":"Purchase Preview (Not Broadcast)",s=i?[t?.parentOutpointAfterCommit?`outpoint=${String(t.parentOutpointAfterCommit).slice(0,16)}\u2026`:null,t?.sellerListingPsbtHashHex?`offerHash=${String(t.sellerListingPsbtHashHex).slice(0,12)}\u2026`:null].filter(Boolean).join("  "):a?"Payment UTXOs split for Open Store buy":[t?.inferredPriceSats?`price\u2248${t.inferredPriceSats} sats`:null,t?.feeSats?`fee\u2248${t.feeSats} sats`:null].filter(Boolean).join("  "),l=i?[{label:"Listing Commit Transaction",txid:t?.commitTxid},{label:"Listing Reveal Transaction",txid:t?.revealTxid||t?.markerTxid}]:a?[{label:"Funding Transaction",txid:t?.fundingTxid}]:[{label:"Buy Transaction",txid:t?.buyTxid}],c=l.find(e=>e.txid)?.txid||null;return it.createElement("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-end sm:items-center justify-center z-[9500] p-0 sm:p-4"},it.createElement("div",{className:"bg-gray-800 rounded-t-2xl sm:rounded-lg max-w-2xl w-full mx-0 sm:mx-4 max-h-[90dvh] max-h-[90vh] flex flex-col",style:{paddingBottom:"env(safe-area-inset-bottom, 0px)"}},it.createElement("div",{className:"p-4 sm:p-6 pb-0 overflow-y-auto flex-1 min-h-0"},it.createElement("div",{className:"flex items-center justify-between mb-4 gap-2"},it.createElement("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0"},it.createElement("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-green-600 rounded-full flex items-center justify-center shrink-0"},it.createElement("svg",{className:"w-5 h-5 sm:w-6 sm:h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},it.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"}))),it.createElement("div",{className:"min-w-0"},it.createElement("h2",{className:"text-base sm:text-xl font-bold text-white truncate"},o),it.createElement("p",{className:"text-xs sm:text-sm text-gray-400 truncate"},s||"Your transaction has been successfully broadcast"))),it.createElement("button",{onClick:n,className:"text-gray-400 hover:text-white transition-colors shrink-0"},it.createElement("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},it.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})))),it.createElement("div",{className:"space-y-3"},l.map(e=>it.createElement(XS,{key:`${e.label}:${e.txid||"none"}`,label:e.label,txid:e.txid,showExplorer:r}))),it.createElement("div",{className:"mt-4 p-4 bg-blue-900 bg-opacity-30 border border-blue-700 rounded-lg"},it.createElement("div",{className:"flex items-start gap-3"},it.createElement("svg",{className:"w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},it.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})),it.createElement("div",{className:"text-sm text-blue-200 space-y-2"},it.createElement("p",null,it.createElement("strong",{className:"text-blue-100"},r?"Broadcast complete":"Preview complete")),it.createElement("ul",{className:"list-disc list-inside space-y-1 text-xs text-blue-300"},r?it.createElement(it.Fragment,null,it.createElement("li",null,"Transactions may take a moment to appear on explorers"),it.createElement("li",null,"Used UTXOs may be temporarily locked until confirmation")):it.createElement(it.Fragment,null,it.createElement("li",null,"No transactions were broadcast"),it.createElement("li",null,"Txids shown are computed from the finalized PSBTs"))))))),it.createElement("div",{className:"p-4 sm:px-6 sm:pb-6 pt-3 border-t border-gray-700 flex flex-col sm:flex-row gap-2 sm:gap-3 shrink-0"},it.createElement("button",{onClick:n,className:"flex-1 px-4 py-3 sm:py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg font-medium transition-colors text-sm sm:text-base"},"Close"),r&&c?it.createElement("a",{href:nh(`/tx/${c}`),target:"_blank",rel:"noopener noreferrer",className:"px-4 py-3 sm:py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg font-medium transition-colors flex items-center justify-center gap-2 text-sm sm:text-base"},"Track in Mempool",it.createElement("svg",{className:"w-4 h-4 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},it.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"}))):null)))}const YS=[{id:"editor",icon:"\u270f\ufe0f",label:"Editor",shortLabel:"Edit"},{id:"options",icon:"\u2699\ufe0f",label:"Options",shortLabel:"Opts"},{id:"fees",icon:"\ud83d\udcb0",label:"Fees",shortLabel:"Fees"}];function JS({activePanel:e="editor",onPanelChange:t,visiblePanels:n=["editor","options","fees"],swipeContainerRef:r}){const i=()=>{if("undefined"==typeof window)return!1;if(window.matchMedia("(min-width: 1024px)").matches)return!1;const e="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent:"",t=/Android|iPhone|iPad|iPod/i.test(e),n=window.matchMedia("(pointer: coarse)").matches,r=window.matchMedia("(hover: none)").matches,i="undefined"!=typeof navigator&&"number"==typeof navigator.maxTouchPoints&&navigator.maxTouchPoints>0;return t||n&&(r||i)},a=rt.useRef({startX:0,startY:0,startTime:0}),[o,s]=rt.useState(!0),[l,c]=rt.useState(()=>i()),u=YS.filter(e=>n.includes(e.id)),d=u.findIndex(t=>t.id===e),f=u.length<=1||!l,p=rt.useCallback(e=>{t&&t(e),s(!1)},[t]),m=rt.useCallback(()=>{const t=u.findIndex(t=>t.id===e);t<u.length-1&&p(u[t+1].id)},[e,u,p]),h=rt.useCallback(()=>{const t=u.findIndex(t=>t.id===e);t>0&&p(u[t-1].id)},[e,u,p]);return rt.useEffect(()=>{if(f)return;const e=r?.current;if(!e)return;const t=e=>{const t=e.touches[0];a.current={startX:t.clientX,startY:t.clientY,startTime:Date.now()}},n=e=>{const t=e.changedTouches[0],n=t.clientX-a.current.startX,r=Math.abs(t.clientY-a.current.startY),i=Date.now()-a.current.startTime;Math.abs(n)>=50&&r<80&&i<500&&(n<0?m():h())};return e.addEventListener("touchstart",t,{passive:!0}),e.addEventListener("touchend",n,{passive:!0}),()=>{e.removeEventListener("touchstart",t),e.removeEventListener("touchend",n)}},[r,m,h,f]),rt.useEffect(()=>{if("undefined"==typeof window)return;const e=window.matchMedia("(min-width: 1024px)"),t=window.matchMedia("(pointer: coarse)"),n=window.matchMedia("(hover: none)"),r=()=>c(i());return r(),e.addEventListener?.("change",r),t.addEventListener?.("change",r),n.addEventListener?.("change",r),window.addEventListener("resize",r),()=>{e.removeEventListener?.("change",r),t.removeEventListener?.("change",r),n.removeEventListener?.("change",r),window.removeEventListener("resize",r)}},[]),f?null:it.createElement("nav",{className:"lg:hidden shrink-0 z-[100] flex flex-col border-t border-neutral-800/70 bg-neutral-950/95 backdrop-blur-md",role:"tablist","aria-label":"Panel navigation"},it.createElement("div",{className:"flex justify-center gap-1.5 pt-1.5"},u.map((e,t)=>it.createElement("span",{key:e.id,className:"w-1.5 h-1.5 rounded-full transition-colors "+(t===d?"bg-purple-400":"bg-neutral-700")}))),it.createElement("div",{className:"flex items-stretch"},u.map(t=>{const n=t.id===e;return it.createElement("button",{key:t.id,role:"tab","aria-selected":n,"aria-label":`${t.label} panel`,onClick:()=>p(t.id),className:`\n                flex-1 flex flex-col items-center justify-center gap-0.5 py-2 text-xs font-medium\n                transition-colors touch-manipulation relative\n                ${n?"text-purple-300":"text-neutral-500 active:text-neutral-300"}\n              `},n&&it.createElement("span",{className:"absolute top-0 inset-x-3 h-0.5 rounded-full bg-purple-500"}),it.createElement("span",{className:"text-base leading-none"},t.icon),it.createElement("span",null,t.label))})),o&&it.createElement("p",{className:"text-[10px] text-neutral-600 text-center pb-1 select-none animate-pulse"},"\u2190 swipe to switch \u2192"))}function QS(e){return(null==e?"":String(e)).trim()}function ZS(e){const t=QS(e).toLowerCase();return t?t.replace(/\s+/g,"-").replace(/[^a-z0-9_-]/g,"").replace(/-+/g,"-").replace(/^[-_]+|[-_]+$/g,""):""}function eE(e){const t=QS(e).toLowerCase();return t&&/^[0-9a-f]{64}i\d+$/.test(t)?t:""}async function tE(e){const t=await fetch(e);if(!t.ok)throw new Error(`HTTP ${t.status}`);return await t.json()}function nE(e){return(null==e?"":String(e)).trim()}const rE={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};function iE({walletState:e,onConnect:t,onDisconnect:r,onInscriptionCreated:i}){const a=!0===(void 0!==import.meta&&rE&&!0),o=.2,[s,l]=rt.useState("standard"),[c,u]=rt.useState([]),[d,f]=rt.useState(!1),[p,m]=rt.useState([]),[h,g]=rt.useState(null),[y,b]=rt.useState(null),[w,x]=rt.useState({status:"idle",phase:"",message:"",error:"",ts:null,lastSuccessAt:null,spendableCount:null,unsafeCount:null,inscriptionCount:null}),[v,S]=rt.useState(0),E=it.useCallback(()=>{x(e=>({...e||{},status:"loading",phase:"utxos",message:"Rescanning wallet\u2026",error:"",ts:Date.now()})),S(e=>e+1)},[]),I=it.useCallback(e=>{e&&"object"==typeof e&&x(t=>{const n=t&&"object"==typeof t?t:{},r={...n,...e},i=String(n.status||"").trim().toLowerCase(),a=String(e.status||"").trim().toLowerCase();return("extracting"===i&&("utxos-ready"===a||"ready"===a)||"ready"===i&&"utxos-ready"===a)&&(r.status=n.status,n.phase&&(r.phase=n.phase),n.message&&(r.message=n.message)),null==r.inscriptionCount&&null!=n.inscriptionCount&&(r.inscriptionCount=n.inscriptionCount),null==r.lastSuccessAt&&null!=n.lastSuccessAt&&(r.lastSuccessAt=n.lastSuccessAt),"string"!=typeof r.status&&(r.status=n.status||"idle"),"number"!=typeof r.ts&&(r.ts=Date.now()),r})},[]),[k,A]=rt.useState("text/plain"),[N,T]=rt.useState(""),[_,P]=rt.useState(0),[B,C]=rt.useState(""),[O,L]=rt.useState(""),[F,R]=rt.useState(""),[U,M]=rt.useState(""),[$,H]=rt.useState(""),[D,z]=rt.useState(null),[W,V]=rt.useState(""),[j,q]=rt.useState(""),[K,X]=rt.useState(!1),[G,Y]=rt.useState(null),J=it.useRef(null),[Q,Z]=rt.useState(""),ee=it.useRef(null),[te,ne]=rt.useState(1),[re,ie]=rt.useState(null),[ae,oe]=rt.useState(null),[se,le]=rt.useState({status:"not-loaded"}),[ce,ue]=rt.useState([]),[de,fe]=rt.useState(null),[pe,me]=rt.useState(!1),[he,ge]=rt.useState(null),[ye,be]=rt.useState(null),[we,xe]=rt.useState(null),[ve,Se]=rt.useState("oodl"),[Ee,Ie]=rt.useState("marketplace"),[ke,Ae]=rt.useState(!1),[Ne,Te]=rt.useState(!0),[_e,Pe]=rt.useState("Parents"),Be=it.useRef(0),Ce=e=>({tab:e,seq:++Be.current}),[Oe,Le]=rt.useState(()=>Ce("oodl")),Fe=it.useCallback(e=>{Le(Ce(e))},[]),[Re,Ue]=rt.useState("text"),[Me,$e]=rt.useState("editor"),He=rt.useRef(null);rt.useEffect(()=>{$e("editor")},[ve]);const[De,ze]=rt.useState(0),We=()=>ze(e=>e+1),Ve=()=>ze(e=>Math.max(0,e-1)),je=rt.useRef({key:null,started:!1}),qe=async()=>{try{if(!e?.isConnected)return;const r=`${e?.walletType||""}|${e?.ordinalsAddress||""}|${e?.paymentAddress||""}|${e?.address||""}`;if(je.current.started&&je.current.key===r)return;je.current={key:r,started:!0};const[{indexOODLListings:i},{prefetchInscriptionContent:a}]=await Promise.all([n(()=>Promise.resolve().then(()=>tS),__VITE_PRELOAD__),n(()=>Promise.resolve().then(()=>dx),__VITE_PRELOAD__)]);let o=null;try{const{OODL_CONFIG:e}=await n(async()=>{const{OODL_CONFIG:e}=await Promise.resolve().then(()=>nv);return{OODL_CONFIG:e}},__VITE_PRELOAD__);o=e?.fundingAddress||null}catch(t){o=null}const s=await i({address:o||void 0,forceRefresh:!1});if(!Array.isArray(s)||0===s.length)return;const l=Math.min(12,s.length);await Promise.allSettled(s.slice(0,l).map(e=>a(e?.inscriptionId||e?.id,e?.contentType||e?.content_type||"")))}catch(uC){}},[Ke,Xe]=rt.useState(""),[Ge,Ye]=rt.useState(""),[Je,Qe]=rt.useState(""),[Ze,et]=rt.useState(!1),[tt,nt]=rt.useState(""),[at,ot]=rt.useState(""),[st,lt]=rt.useState(""),[ct,ut]=rt.useState(""),[dt,ft]=rt.useState(""),[pt,mt]=rt.useState(""),[ht,gt]=rt.useState(null),yt=function({walletState:e,feeRate:t,selectedParents:r,selectedUtxos:i,cachedFilteredUtxos:a,salePriceSats:o,listingScriptAddress:s,listingMarkerValueSats:l,listingDryRun:c,saleMinBlockHeight:u,beginTxBusy:d,endTxBusy:f}){const[p,m]=rt.useState(""),[h,g]=rt.useState(""),[y,b]=rt.useState(null),w=()=>{const e=Array.isArray(r)?r:[];return e.length>0?e[e.length-1]:null};return{sellerStatus:p,sellerError:h,listingSuccessResult:y,setListingSuccessResult:b,onCreateListingTx:async(r={})=>{g(""),m(""),d?.();try{if(!e?.isConnected)throw new Error("Wallet not connected");const d=w(),f=d?.id||d?.inscriptionId||d?.inscription_id;if(!f)throw new Error("Select an inscription first");const p=d?.utxo;if(!p?.txid||void 0===p?.vout)throw new Error("Selected inscription is missing UTXO data. Refresh inscriptions/UTXOs and try again.");const h={...p,address:p?.address||p?.addr||e?.ordinalsAddress||null};if(!h?.address)throw new Error("Parent UTXO missing address. Ensure the inscription UTXO has an address field or wallet ordinalsAddress is available.");const{parseUserPriceToSats:g}=await n(async()=>{const{parseUserPriceToSats:e}=await Promise.resolve().then(()=>Ox);return{parseUserPriceToSats:e}},__VITE_PRELOAD__),y=g(o),x=String(s||"").trim()||null,v=e=>{if(null==e||""===e)return null;const t=Number(e);if(!Number.isFinite(t))return null;const n=Math.floor(t);return n<0?null:n},S=v(r?.minBlockHeight??u);if(null!==S){const{fetchBlockHeightViaProxy:e}=await n(async()=>{const{fetchBlockHeightViaProxy:e}=await Promise.resolve().then(()=>ab);return{fetchBlockHeightViaProxy:e}},__VITE_PRELOAD__),t="undefined"!=typeof window&&window.__NEXUS_NETWORK__||"mainnet";let r;try{r=await e(t)}catch{r=null}const i=Number(r);if(!Number.isFinite(i))throw new Error('Unable to fetch chain tip height to validate "Not valid before block". Clear the field or try again.');const a=Math.floor(i);if(S<=a)throw new Error(`Not valid before block must be > tip height (${a}). Clear it to list immediately.`)}const E=String(l||"").trim();let I=null;if(E){if(!/^[0-9]+$/.test(E))throw new Error("Enter a valid listing script funding amount (integer sats)");const e=Number.parseInt(E,10);if(!Number.isFinite(e)||e<=0)throw new Error("Listing script funding must be > 0 sats");I=e}const k=a?Array.isArray(a)?a:a.spendable||[]:[],A=e?.provider||window.NexusWalletConnect;if(!A)throw new Error("Wallet provider not available");const N=e?.paymentAddress||e?.address;if(!N)throw new Error("Wallet payment address not available");const T=e=>{if(!e)return null;const t=e?.fullUtxo||e?.utxo||e?.raw||e?.full||e,n=t.txid||t.txId||t.hash,r=t.vout??t.index??t.n,i=t.value??t.satoshis??t.amount,a=t.address||t.addr||N;if(!n||null==r)return null;const o=Number(i);return!Number.isFinite(o)||o<=0?null:{...e,txid:String(n),vout:Number(r),value:o,address:a}},_=`${h.txid}:${h.vout}`,P=Array.isArray(i)?i:[],B=[...Array.isArray(k)?k:[],...P].map(T).filter(Boolean).filter(e=>`${e.txid}:${e.vout}`!==_),C=new Map;B.forEach(e=>C.set(`${e.txid}:${e.vout}`,e));const O=Array.from(C.values()).sort((e,t)=>(t.value||0)-(e.value||0));if(!Array.isArray(O)||0===O.length)throw new Error("No spendable funding UTXOs loaded. Click \u201cFetch UTXOs\u201d first.");const L=O[0]||null;if(!L)throw new Error("No funding UTXO available");const{createAndBroadcast3TxSaleListingFlow:F}=await n(async()=>{const{createAndBroadcast3TxSaleListingFlow:e}=await Promise.resolve().then(()=>tw);return{createAndBroadcast3TxSaleListingFlow:e}},__VITE_PRELOAD__),{getOODLFeeOutput:R,getOODLCollectionFeeOutput:U}=await n(async()=>{const{getOODLFeeOutput:e,getOODLCollectionFeeOutput:t}=await Promise.resolve().then(()=>nv);return{getOODLFeeOutput:e,getOODLCollectionFeeOutput:t}},__VITE_PRELOAD__),M=String(r?.collectionKey||"").trim()||null;let $=null,H=null,D=null,z=null,W=[];try{const[{loadCollectionsRegistry:e,matchCollectionForInscription:t},{setDynamicOODLCollections:r}]=await Promise.all([n(()=>Promise.resolve().then(()=>Xv),__VITE_PRELOAD__),n(()=>Promise.resolve().then(()=>nv),__VITE_PRELOAD__)]),i=await e({forceRefresh:!1});if(W=Array.isArray(i?.collections)?i.collections:[],r(W),M)if("uncategorized"===M)$=null;else if("bitmap"===String(M).toLowerCase()){const{detectAndVerifyBitmapByInscriptionId:e}=await n(async()=>{const{detectAndVerifyBitmapByInscriptionId:e}=await Promise.resolve().then(()=>gv);return{detectAndVerifyBitmapByInscriptionId:e}},__VITE_PRELOAD__),t=await e(f);if("bitmap"!==t?.type||!t?.verified)throw new Error("Selected collection is bitmap, but this inscription is not OCI-verified as a bitmap.");$="bitmap",H=Number.isFinite(Number(t?.bitmapNumber))?Math.floor(Number(t.bitmapNumber)):null}else if("parcel"===String(M).toLowerCase()){const{detectAndVerifyParcelByInscriptionId:e}=await n(async()=>{const{detectAndVerifyParcelByInscriptionId:e}=await Promise.resolve().then(()=>Sv);return{detectAndVerifyParcelByInscriptionId:e}},__VITE_PRELOAD__),t=await e(f);if("parcel"!==t?.type||!t?.verified)throw new Error('Selected collection is parcel, but this inscription does not look like a parcel inscription (expected "{parcel}.{bitmap}.bitmap").');$="parcel",z=t,D=Number.isFinite(Number(t?.parcelNumber))?Math.floor(Number(t.parcelNumber)):null,H=Number.isFinite(Number(t?.bitmapNumber))?Math.floor(Number(t.bitmapNumber)):null}else{const e=W.find(e=>String(e?.key||"").trim()===M)||null;if(!e)throw new Error("Selected collection not found in registry.");if(await t(f,[e])!==M)throw new Error("This inscription is not indexed / does not match the selected collection rules.");$=M}else $=await t(f,W)}catch(cC){if(M)throw cC;$=null}if(!$)try{const{detectAndVerifyBitmapByInscriptionId:e}=await n(async()=>{const{detectAndVerifyBitmapByInscriptionId:e}=await Promise.resolve().then(()=>gv);return{detectAndVerifyBitmapByInscriptionId:e}},__VITE_PRELOAD__),t=await e(f);"bitmap"===t?.type&&t?.verified&&($="bitmap",H=Number.isFinite(Number(t?.bitmapNumber))?Math.floor(Number(t.bitmapNumber)):null)}catch{$=null}if(!$)try{const{detectAndVerifyParcelByInscriptionId:e}=await n(async()=>{const{detectAndVerifyParcelByInscriptionId:e}=await Promise.resolve().then(()=>Sv);return{detectAndVerifyParcelByInscriptionId:e}},__VITE_PRELOAD__),t=await e(f);"parcel"===t?.type&&t?.verified&&($="parcel",z=t,D=Number.isFinite(Number(t?.parcelNumber))?Math.floor(Number(t.parcelNumber)):null,H=Number.isFinite(Number(t?.bitmapNumber))?Math.floor(Number(t.bitmapNumber)):null)}catch{$=null}const V=U($)||R(),j={parentInscriptionId:f,collectionKey:$,sellerAddress:N,priceSats:BigInt(y),...null!==S?{minBlockHeight:S}:{},...Number.isFinite(Number(D))?{parcelNumber:Math.floor(Number(D))}:{},...Number.isFinite(Number(H))?{bitmapNumber:Math.floor(Number(H))}:{}};m(c?"Dry run: building+signing offer + commit + reveal (no broadcast)...":"Precomputing commit txid \u2192 signing seller offer PSBT (popup #1) \u2192 then commit+reveal...");const q=await F({walletProvider:A,parentUtxo:h,fundingUtxo:L,fundingUtxos:O,listingScriptAddress:x,markerValueSats:I,sellerChangeAddress:N,feeRateSatPerVb:t,marker:j,emitOpReturnMarker:!1,emitParcelHintOpReturn:!1,broadcast:!c,oodlFeeAddress:V?.address||null,oodlFeeSats:V?.value||null});if("3tx-complete"===q?.mode&&q?.commitTxid&&b({commitTxid:q.commitTxid,revealTxid:q.revealTxid||q.markerTxid||null,parentOutpointAfterCommit:q.parentOutpointAfterCommit||null,sellerListingPsbtHashHex:q.sellerListingPsbtHashHex||null,broadcasted:!!q.broadcasted}),"needs-external-signer"===q?.mode){const e=String(q.commitTxid||"").slice(0,12);return void m(`Commit broadcasted (txid=${e}\u2026). Wallet refused to sign seller offer PSBT (ANYONECANPAY).`)}const K=String(q.commitTxid||"").slice(0,12),X=String(q.revealTxid||q.markerTxid||"").slice(0,12),G=String(q.sellerListingPsbtHashHex||"").slice(0,12);m(q?.broadcasted?`Listed. commit=${K}\u2026 reveal=${X}\u2026 offerHash=${G}\u2026 outpoint=${q.parentOutpointAfterCommit}`:`Dry run complete (NOT broadcast). commit=${K}\u2026 reveal=${X}\u2026 offerHash=${G}\u2026 outpoint=${q.parentOutpointAfterCommit}`)}catch(cC){m(""),g(cC?.message||String(cC))}finally{f?.()}},getSelectedSaleInscription:w}}({walletState:e,feeRate:re,selectedParents:p,selectedUtxos:ce,cachedFilteredUtxos:y,salePriceSats:Ke,listingScriptAddress:Ge,listingMarkerValueSats:Je,listingDryRun:Ze,saleMinBlockHeight:tt,beginTxBusy:We,endTxBusy:Ve}),bt=yt?.getSelectedSaleInscription||(()=>null),wt=yt?.onCreateListingTx,xt=yt?.sellerStatus||"",vt=yt?.sellerError||"",St=yt?.listingSuccessResult||null,Et=yt?.setListingSuccessResult||(()=>{}),It=function({walletState:e,feeRate:t,selectedSaleInscription:r,salePriceSats:i,saleMinBlockHeight:a,selectedUtxos:o,cachedFilteredUtxos:s}){const[l,c]=rt.useState(""),[u,d]=rt.useState(""),[f,p]=rt.useState(""),[m,h]=rt.useState(""),[g,y]=rt.useState(""),[b,w]=rt.useState(""),[x,v]=rt.useState(""),[S,E]=rt.useState(""),[I,k]=rt.useState(""),[A,N]=rt.useState(""),T=rt.useCallback(()=>s?Array.isArray(s)?s:s.spendable||[]:[],[s]),_=rt.useCallback(t=>{const n=T(),r=[...Array.isArray(n)?n:[],...Array.isArray(o)?o:[]];if(!Array.isArray(r)||0===r.length)return[];const i=r.map(n=>{if(!n)return null;const r=n?.fullUtxo||n?.utxo||n?.raw||n?.full||n,i=r.txid||r.txId||r.hash,a=r.vout??r.index??r.n,o=r.value??r.satoshis??r.amount,s=r.address||r.addr||t;if(!i||null==a)return null;const l=Number(o);if(!Number.isFinite(l)||l<=0)return null;const c=e?.ordinalsAddress||null,u=e?.paymentAddress||null;if(c&&u&&c!==u){const e=String(s||"").trim();if(e&&e===String(c).trim())return null}return{txid:String(i),vout:Number(a),value:l,address:s}}).filter(Boolean),a=new Map;return i.forEach(e=>a.set(`${e.txid}:${e.vout}`,e)),Array.from(a.values())},[T,o,e?.ordinalsAddress,e?.paymentAddress]),P=rt.useCallback(async()=>{p(""),d(""),c("");try{if(!e?.isConnected)throw new Error("Wallet not connected");const o=r;if(!(o?.id||o?.inscriptionId||o?.inscription_id))throw new Error("Select an inscription first");const s=o?.utxo;if(!s?.txid||void 0===s?.vout)throw new Error("Selected inscription is missing UTXO data. Refresh inscriptions/UTXOs and try again.");const l={...s,address:s?.address||s?.addr||e?.ordinalsAddress||null};if(!l?.address)throw new Error("Parent UTXO missing address. Ensure wallet ordinalsAddress is available.");const{parseUserPriceToSats:u}=await n(async()=>{const{parseUserPriceToSats:e}=await Promise.resolve().then(()=>Ox);return{parseUserPriceToSats:e}},__VITE_PRELOAD__),f=u(i),p=Number(t||0);if(!Number.isFinite(p)||p<=0)throw new Error("Set a fee rate first (sat/vB) before creating a seller offer PSBT.");const m=(()=>{const e=String(a??"").trim();if(!e)return null;const t=Number(e);if(!Number.isFinite(t)||t<0)throw new Error("Min block height must be a non-negative integer.");return Math.floor(t)})();if(null!==m){const{fetchBlockHeightViaProxy:e}=await n(async()=>{const{fetchBlockHeightViaProxy:e}=await Promise.resolve().then(()=>ab);return{fetchBlockHeightViaProxy:e}},__VITE_PRELOAD__),t="undefined"!=typeof window&&window.__NEXUS_NETWORK__||"mainnet";let r;try{r=await e(t)}catch{r=null}const i=Number(r);if(!Number.isFinite(i))throw new Error('Unable to fetch chain tip height to validate "Not valid before block". Clear the field or try again.');const a=Math.floor(i);if(m<=a)throw new Error(`Not valid before block must be > tip height (${a}). Clear it to create an immediately-valid offer.`)}const h=e?.provider||window.NexusWalletConnect;if(!h)throw new Error("Wallet provider not available");const g=e?.paymentAddress||e?.address||e?.ordinalsAddress;if(!g)throw new Error("Wallet payout address not available");d("Building Open Store offer PSBT (no broadcast)\u2026");const{loadBitcoinLibFromInscription:y}=await n(async()=>{const{loadBitcoinLibFromInscription:e}=await Promise.resolve().then(()=>yg);return{loadBitcoinLibFromInscription:e}},__VITE_PRELOAD__),{signAndBroadcastPsbt:b}=await n(async()=>{const{signAndBroadcastPsbt:e}=await Promise.resolve().then(()=>Yg);return{signAndBroadcastPsbt:e}},__VITE_PRELOAD__),w=await y(),x="undefined"!=typeof window&&window.__NEXUS_NETWORK__||"mainnet",v=String(x).toLowerCase(),S="testnet"===v||"signet"===v||"regtest"===v?w.networks.testnet:w.networks.bitcoin,E=Number(l?.value);if(!Number.isFinite(E)||E<=0)throw new Error("Selected inscription UTXO is missing value. Refresh UTXOs/inscriptions and try again.");const I=546,k=(w.Transaction?.SIGHASH_SINGLE??3)|(w.Transaction?.SIGHASH_ANYONECANPAY??128),A=new w.Psbt({network:S});if(null!==m)try{A.setLocktime(m)}catch{throw new Error("Failed to set PSBT locktime for min block height.")}const N=Buffer.alloc(32,0),T={script:Buffer.from("0014"+"00".repeat(20),"hex"),value:1};A.addInput({hash:N,index:4294967294,sequence:4294967293,witnessUtxo:T}),A.addInput({hash:N,index:4294967295,sequence:4294967293,witnessUtxo:T});const _=w.address.toOutputScript(l.address,S);A.addInput({hash:l.txid,index:l.vout,witnessUtxo:{script:_,value:Math.floor(E)},sighashType:k,sequence:4294967293});try{const t=h?.getState?.()?.ordinalsPublicKey||h?.getState?.()?.publicKey||e?.ordinalsPublicKey||e?.publicKey||null,n="string"==typeof t?t.startsWith("0x")?t.slice(2):t:null;if("string"==typeof l.address&&(l.address.startsWith("bc1p")||l.address.startsWith("tb1p"))&&n&&(64===n.length||66===n.length)&&A?.data?.inputs?.[2]){const e=66===n.length?n.slice(2):n;A.data.inputs[2].tapInternalKey=Buffer.from(e,"hex")}}catch{}A.addOutput({address:g,value:0}),A.addOutput({address:g,value:I});const P=E>I?BigInt(E)-BigInt(I):0n,B=BigInt(f)+P;A.addOutput({address:g,value:Number(B)}),d("Requesting wallet signature for offer PSBT (0x83)\u2026");const{assertOpenStoreSellerOfferSignedCorrectly:C}=await n(async()=>{const{assertOpenStoreSellerOfferSignedCorrectly:e}=await Promise.resolve().then(()=>BB);return{assertOpenStoreSellerOfferSignedCorrectly:e}},__VITE_PRELOAD__);let O,L=null;try{const e=await b(h,A.toHex(),{autoFinalized:!1,toSignInputs:[{index:2,address:l.address,sighashType:k}]},!1);L=e?.signedPsbt||null}catch{L=null}if(!L)throw new Error("Wallet refused to sign the 0x83 seller offer. Refusing to create an unsigned offer. Use a wallet that supports SIGHASH_SINGLE|ANYONECANPAY or use the two-step buyer-funded fallback.");try{O=w.Psbt.fromHex(L,{network:S})}catch{O=w.Psbt.fromBase64(L,{network:S})}C({unsignedOfferPsbt:A,signedOfferPsbt:O,sellerInputIndex:2,expectedSighashByte:131});try{const{sanitizePsbtForSharing:e}=await n(async()=>{const{sanitizePsbtForSharing:e}=await Promise.resolve().then(()=>sC);return{sanitizePsbtForSharing:e}},__VITE_PRELOAD__);c(await e(O.toBase64(),{profile:"publish"}))}catch{c(O.toBase64())}d("Signed seller offer PSBT created. Share it with the buyer to paste in Buy \u2192 Manual PSBT.")}catch(cC){d(""),p(cC?.message||String(cC))}},[t,i,r,e]),B=rt.useCallback(async r=>{y(""),h("");let i=null;try{if(!e?.isConnected)throw new Error("Wallet not connected");const o=String(r||"").trim();if(!o)throw new Error("Paste a seller offer PSBT first");const s=Number(t||0);if(!Number.isFinite(s)||s<=0)throw new Error("Set a fee rate first (sat/vB) before buying from a seller PSBT.");const l=e?.provider||window.NexusWalletConnect;if(!l)throw new Error("Wallet provider not available");const c=e?.paymentAddress||e?.address||e?.ordinalsAddress,u=e?.ordinalsAddress||e?.address||e?.paymentAddress;if(!c)throw new Error("Wallet payment/change address not available");if(!u)throw new Error("Wallet ordinals/receive address not available");const d=_(c);if(!Array.isArray(d)||0===d.length)throw new Error("No spendable payment UTXOs loaded. Click \u201cFetch UTXOs\u201d first (or select UTXOs).");const f=d.reduce((e,t)=>e+(Number(t?.value)||0),0);let p=d;if(d.length<3){try{h("Checking offer requirements before split-funding\u2026");const{estimateBuyNeedFromSellerOfferPsbt:e}=await n(async()=>{const{estimateBuyNeedFromSellerOfferPsbt:e}=await Promise.resolve().then(()=>Ow);return{estimateBuyNeedFromSellerOfferPsbt:e}},__VITE_PRELOAD__),t=await e({walletProvider:l,sellerOfferPsbt:o,buyerChangeAddress:c,feeRateSatPerVb:s}),r=BigInt(Math.max(0,Math.floor(Number(f)||0))),i=BigInt(t?.needTotalSats||0n);if(i>0n&&r<i){const e=i-r;throw new Error(`Insufficient buyer funds to buy (skipping split-funding). Need >= ${i.toString()} sats (estFee\u2248${String(t?.feeEstimateSats||"?")}), have ${r.toString()} sats, short ${e.toString()} sats.`)}}catch(a){const e=a?.message||String(a);if(String(e).includes("skipping split-funding"))throw a}h("Not enough payment UTXOs \u2014 creating split funding tx first...");const{createSplitFundingTransaction:t}=await n(async()=>{const{createSplitFundingTransaction:e}=await Promise.resolve().then(()=>lC);return{createSplitFundingTransaction:e}},__VITE_PRELOAD__),r=await t({walletProvider:l,networkName:e.network?.toLowerCase?.()||"mainnet",paymentAddress:c,paymentPublicKeyHex:e?.paymentPublicKey||null,paymentCandidates:d,feeRateSatPerVb:s,dummySats:600,minRemainderSats:546,label:"buy-funding-split-manual"});if(i=r?.txid||null,i&&h(`Split funding tx broadcasted. Mempool: ${nh(`/tx/${i}`)}. Continuing buy\u2026`),p=[...d.filter(e=>`${e.txid}:${e.vout}`!==r.spentOutpoint),...r.splitUtxos||[]],p.length<3)throw new Error("Split completed but still insufficient payment UTXOs to buy. Click \u201cFetch UTXOs\u201d and try again.")}const{createAndBroadcastBuyFromSellerOfferPsbt:m}=await n(async()=>{const{createAndBroadcastBuyFromSellerOfferPsbt:e}=await Promise.resolve().then(()=>Ow);return{createAndBroadcastBuyFromSellerOfferPsbt:e}},__VITE_PRELOAD__);h("Building buyer PSBT from seller offer \u2192 wallet signing...");const g=await m({walletProvider:l,sellerOfferPsbt:o,buyerPaymentUtxos:p,buyerChangeAddress:c,buyerReceiveAddress:u,feeRateSatPerVb:s,broadcast:!0}),y=String(g?.buyTxid||"").slice(0,12);h(`Bought. txid=${y}\u2026 price\u2248${String(g?.inferredPriceSats||"?")} sats`)}catch(cC){h("");let t=cC?.message||String(cC);i&&(t=`${t} | Split funding tx: ${i} | Mempool: ${nh(`/tx/${i}`)}`),y(t)}},[t,_,e]),C=rt.useCallback(async r=>{E(""),v(""),w("");let i=null;try{if(!e?.isConnected)throw new Error("Wallet not connected");const o=String(r||"").trim();if(!o)throw new Error("Paste a seller PSBT first");const s=Number(t||0);if(!Number.isFinite(s)||s<=0)throw new Error("Set a fee rate first (sat/vB) before building a buyer-funded PSBT.");const l=e?.provider||window.NexusWalletConnect;if(!l)throw new Error("Wallet provider not available");const c=e?.paymentAddress||e?.address||e?.ordinalsAddress,u=e?.ordinalsAddress||e?.address||e?.paymentAddress;if(!c)throw new Error("Wallet payment/change address not available");if(!u)throw new Error("Wallet ordinals/receive address not available");const d=_(c);if(!Array.isArray(d)||0===d.length)throw new Error("No spendable payment UTXOs loaded. Click \u201cFetch UTXOs\u201d first (or select UTXOs).");const f=d.reduce((e,t)=>e+(Number(t?.value)||0),0);let p=d;if(d.length<3){try{v("Checking offer requirements before split-funding\u2026");const{estimateBuyNeedFromSellerOfferPsbt:e}=await n(async()=>{const{estimateBuyNeedFromSellerOfferPsbt:e}=await Promise.resolve().then(()=>Ow);return{estimateBuyNeedFromSellerOfferPsbt:e}},__VITE_PRELOAD__),t=await e({walletProvider:l,sellerOfferPsbt:o,buyerChangeAddress:c,feeRateSatPerVb:s}),r=BigInt(Math.max(0,Math.floor(Number(f)||0))),i=BigInt(t?.needTotalSats||0n);if(i>0n&&r<i){const e=i-r;throw new Error(`Insufficient buyer funds to proceed (skipping split-funding). Need >= ${i.toString()} sats (estFee\u2248${String(t?.feeEstimateSats||"?")}), have ${r.toString()} sats, short ${e.toString()} sats.`)}}catch(a){const e=a?.message||String(a);if(String(e).includes("skipping split-funding"))throw a}v("Not enough payment UTXOs \u2014 creating split funding tx first...");const{createSplitFundingTransaction:t}=await n(async()=>{const{createSplitFundingTransaction:e}=await Promise.resolve().then(()=>lC);return{createSplitFundingTransaction:e}},__VITE_PRELOAD__),r=await t({walletProvider:l,networkName:e.network?.toLowerCase?.()||"mainnet",paymentAddress:c,paymentPublicKeyHex:e?.paymentPublicKey||null,paymentCandidates:d,feeRateSatPerVb:s,dummySats:600,minRemainderSats:546,label:"buy-funding-split-manual-2step"});if(i=r?.txid||null,i&&v(`Split funding tx broadcasted. Mempool: ${nh(`/tx/${i}`)}. Continuing\u2026`),p=[...d.filter(e=>`${e.txid}:${e.vout}`!==r.spentOutpoint),...r.splitUtxos||[]],p.length<3)throw new Error("Split completed but still insufficient payment UTXOs. Click \u201cFetch UTXOs\u201d and try again.")}const{createBuyerFundedPsbtForSellerCountersign:m}=await n(async()=>{const{createBuyerFundedPsbtForSellerCountersign:e}=await Promise.resolve().then(()=>Ow);return{createBuyerFundedPsbtForSellerCountersign:e}},__VITE_PRELOAD__);v("Building buyer-funded PSBT \u2192 wallet signing buyer inputs...");const h=await m({walletProvider:l,sellerOfferPsbt:o,buyerPaymentUtxos:p,buyerChangeAddress:c,buyerReceiveAddress:u,feeRateSatPerVb:s}),g=h?.signedBuyerPsbtBase64||"";if(g)try{const{sanitizePsbtForSharing:e}=await n(async()=>{const{sanitizePsbtForSharing:e}=await Promise.resolve().then(()=>sC);return{sanitizePsbtForSharing:e}},__VITE_PRELOAD__);w(await e(g,{profile:"wallet"}))}catch{w(g)}else w("");v("Buyer-funded PSBT ready. Send it to the seller to countersign & broadcast.")}catch(cC){v("");let t=cC?.message||String(cC);i&&(t=`${t} | Split funding tx: ${i} | Mempool: ${nh(`/tx/${i}`)}`),E(t)}},[t,_,e]),O=rt.useCallback(async t=>{N(""),k("");try{if(!e?.isConnected)throw new Error("Wallet not connected");const r=String(t||"").trim();if(!r)throw new Error("Paste a buyer-funded PSBT first");const i=e?.provider||window.NexusWalletConnect;if(!i)throw new Error("Wallet provider not available");const{loadBitcoinLibFromInscription:a}=await n(async()=>{const{loadBitcoinLibFromInscription:e}=await Promise.resolve().then(()=>yg);return{loadBitcoinLibFromInscription:e}},__VITE_PRELOAD__),{signAndBroadcastPsbt:o,broadcastTransaction:s}=await n(async()=>{const{signAndBroadcastPsbt:e,broadcastTransaction:t}=await Promise.resolve().then(()=>Yg);return{signAndBroadcastPsbt:e,broadcastTransaction:t}},__VITE_PRELOAD__),l=await a(),c="undefined"!=typeof window&&window.__NEXUS_NETWORK__||"mainnet",u=String(c).toLowerCase(),d="testnet"===u||"signet"===u||"regtest"===u?l.networks.testnet:l.networks.bitcoin;let f;try{f=l.Psbt.fromBase64(r,{network:d})}catch{f=l.Psbt.fromHex(r,{network:d})}if(f.inputCount<3)throw new Error("Buyer-funded PSBT must have at least 3 inputs (Open Store template).");const p=2,m=e=>{if(!e)return null;try{return Buffer.from(e).toString("hex")}catch{return null}},h=(e,t)=>{try{const n=e?.txInputs?.[t];if(!n)return null;const r=n?.hash?Buffer.from(n.hash).reverse().toString("hex"):null,i="number"==typeof n?.index?n.index:"number"==typeof n?.vout?n.vout:null;return r&&null!==i?`${r.toLowerCase()}:${Math.floor(Number(i))}`:null}catch{return null}},g=e=>{const t=e?.txOutputs?.[1]||null,n=e?.txOutputs?.[2]||null,r=e?.txOutputs?.[3]||null;return{sellerPrevout:h(e,p),out1:{value:Number(t?.value??NaN),scriptHex:m(t?.script)},out2:{value:Number(n?.value??NaN),scriptHex:m(n?.script)},out3:r?{value:Number(r?.value??NaN),scriptHex:m(r?.script)}:null}},y=(e,t)=>{const n=g(t);if(!e?.sellerPrevout||!n?.sellerPrevout||e.sellerPrevout!==n.sellerPrevout)throw new Error("OODL_BUY_WALLET_MUTATED_SELLER_INPUT_OUTPOINT");if(!e?.out1?.scriptHex||!n?.out1?.scriptHex||e.out1.scriptHex!==n.out1.scriptHex)throw new Error("OODL_BUY_WALLET_MUTATED_INSCRIPTION_OUTPUT_SCRIPT");if(!Number.isFinite(e?.out1?.value)||!Number.isFinite(n?.out1?.value)||e.out1.value!==n.out1.value)throw new Error("OODL_BUY_WALLET_MUTATED_INSCRIPTION_OUTPUT_VALUE");if(!e?.out2?.scriptHex||!n?.out2?.scriptHex||e.out2.scriptHex!==n.out2.scriptHex)throw new Error("OODL_BUY_WALLET_MUTATED_SELLER_PAYOUT_SCRIPT");if(!Number.isFinite(e?.out2?.value)||!Number.isFinite(n?.out2?.value)||e.out2.value!==n.out2.value)throw new Error("OODL_BUY_WALLET_MUTATED_SELLER_PAYOUT_VALUE");if(e?.out3){if(!n?.out3)throw new Error("OODL_BUY_WALLET_MUTATED_PLATFORM_FEE_MISSING");if(!e.out3.scriptHex||!n.out3.scriptHex||e.out3.scriptHex!==n.out3.scriptHex)throw new Error("OODL_BUY_WALLET_MUTATED_PLATFORM_FEE_SCRIPT");if(!Number.isFinite(e.out3.value)||!Number.isFinite(n.out3.value)||e.out3.value!==n.out3.value)throw new Error("OODL_BUY_WALLET_MUTATED_PLATFORM_FEE_VALUE")}},b=g(f),w=f?.data?.inputs?.[p]||{};let x=null;try{const e=w?.witnessUtxo?.script||null;e&&(x=l.address.fromOutputScript(e,d))}catch{x=null}const v=x||e?.ordinalsAddress||e?.address||e?.paymentAddress||null;if(!v)throw new Error("Could not infer seller input address for signing.");k("Requesting seller signature (countersign)...");const S=await o(i,f.toHex(),{autoFinalized:!1,toSignInputs:[{index:p,address:v}]},!1),E=S?.signedPsbt||null;if(!E)throw new Error("Seller wallet did not return a signed PSBT");const I=l.Psbt.fromHex(E,{network:d});try{y(b,I)}catch(cC){throw new Error(`Seller countersign mutated PSBT invariants: ${cC?.message||cC}`)}try{I.finalizeAllInputs()}catch{for(let e=0;e<I.inputCount;e+=1)try{I.finalizeInput(e)}catch{}}const A=I.extractTransaction().toHex(),N=await s(i,{txHex:A,psbtBase64:Buffer.from(E,"hex").toString("base64")},"testnet"===u||"signet"===u||"regtest"===u?"testnet":"mainnet","oodl-manual-2step-sell"),T=String(N||"").slice(0,12);k(N?`Broadcasted sale. txid=${T}\u2026`:"Broadcast attempted (no txid returned).")}catch(cC){k(""),N(cC?.message||String(cC))}},[e]);return{manualSellerPsbt:l,manualSellerStatus:u,manualSellerError:f,onCreateManualSellerOfferPsbt:P,manualBuyStatus:m,manualBuyError:g,onBuyFromSellerOfferPsbt:B,manualBuyerFundedPsbt:b,manualBuyerFundedStatus:x,manualBuyerFundedError:S,onCreateBuyerFundedPsbtForSeller:C,manualSellerCountersignStatus:I,manualSellerCountersignError:A,onCountersignAndBroadcastFromBuyerFundedPsbt:O}}({walletState:e,feeRate:re,selectedSaleInscription:bt(),salePriceSats:Ke,saleMinBlockHeight:tt,selectedUtxos:ce,cachedFilteredUtxos:y}),kt=function({walletState:e,feeRate:t,selectedParents:r,selectedUtxos:i,cachedFilteredUtxos:a,salePriceSats:o,listingScriptAddress:s,listingMarkerValueSats:l,listingDryRun:c,saleMinBlockHeight:u,beginTxBusy:d,endTxBusy:f}){const[p,m]=rt.useState(""),[h,g]=rt.useState(""),[y,b]=rt.useState("");return{bulkSellerStatus:p,bulkSellerError:h,bulkBundleJson:y,onCreateBulkListingTx:async(p={})=>{g(""),m(""),b(""),d?.();try{if(!e?.isConnected)throw new Error("Wallet not connected");const d=Array.isArray(r)?r:[];if(0===d.length)throw new Error("Select one or more inscriptions first");const{parseUserPriceToSats:f}=await n(async()=>{const{parseUserPriceToSats:e}=await Promise.resolve().then(()=>Ox);return{parseUserPriceToSats:e}},__VITE_PRELOAD__),h=f(o),g=String(s||"").trim()||null,y=e=>{if(null==e||""===e)return null;const t=Number(e);if(!Number.isFinite(t))return null;const n=Math.floor(t);return n<0?null:n},w=y(p?.minBlockHeight??u);if(null!==w){const{fetchBlockHeightViaProxy:e}=await n(async()=>{const{fetchBlockHeightViaProxy:e}=await Promise.resolve().then(()=>ab);return{fetchBlockHeightViaProxy:e}},__VITE_PRELOAD__),t="undefined"!=typeof window&&window.__NEXUS_NETWORK__||"mainnet";let r;try{r=await e(t)}catch{r=null}const i=Number(r);if(!Number.isFinite(i))throw new Error('Unable to fetch chain tip height to validate "Not valid before block". Clear the field or try again.');const a=Math.floor(i);if(w<=a)throw new Error(`Not valid before block must be > tip height (${a}). Clear it to list immediately.`)}const x=String(l||"").trim();let v=null;if(x){if(!/^[0-9]+$/.test(x))throw new Error("Enter a valid listing script funding amount (integer sats)");const e=Number.parseInt(x,10);if(!Number.isFinite(e)||e<=0)throw new Error("Listing script funding must be > 0 sats");v=e}const S=a?Array.isArray(a)?a:a.spendable||[]:[],E=e?.provider||window.NexusWalletConnect;if(!E)throw new Error("Wallet provider not available");const I=e?.paymentAddress||e?.address;if(!I)throw new Error("Wallet payment address not available");const k=e?.ordinalsAddress||e?.address;if(!k)throw new Error("Wallet ordinals address not available");const A=t=>{if(!t)return null;const n=t?.fullUtxo||t?.utxo||t?.raw||t?.full||t,r=n.txid||n.txId||n.hash,i=n.vout??n.index??n.n,a=n.value??n.satoshis??n.amount,o=n.address||n.addr||I;if(!r||null==i)return null;const s=Number(a);if(!Number.isFinite(s)||s<=0)return null;const l=e?.ordinalsAddress||null,c=e?.paymentAddress||null;if(l&&c&&String(l).trim()!==String(c).trim()){const e=String(o||"").trim();if(e&&e===String(l).trim())return null}return{...t,txid:String(r),vout:Number(i),value:s,address:o}},N=new Set(d.map(e=>{const t=e?.utxo,n=t?.txid,r=t?.vout;return n&&null!=r?`${n}:${r}`:null}).filter(Boolean)),T=Array.isArray(i)?i:[],_=[...Array.isArray(S)?S:[],...T].map(A).filter(Boolean).filter(e=>!N.has(`${e.txid}:${e.vout}`)),P=new Map;_.forEach(e=>P.set(`${e.txid}:${e.vout}`,e));const B=Array.from(P.values()).sort((e,t)=>(t.value||0)-(e.value||0));if(B.length<d.length)throw new Error(`Bulk listing needs at least ${d.length} funding UTXO(s), but only ${B.length} are available. Fetch UTXOs, select more payment UTXOs, or consolidate.`);const{createAndBroadcast3TxSaleListingFlow:C}=await n(async()=>{const{createAndBroadcast3TxSaleListingFlow:e}=await Promise.resolve().then(()=>tw);return{createAndBroadcast3TxSaleListingFlow:e}},__VITE_PRELOAD__),{getOODLFeeOutput:O,getOODLCollectionFeeOutput:L,setDynamicOODLCollections:F}=await n(async()=>{const{getOODLFeeOutput:e,getOODLCollectionFeeOutput:t,setDynamicOODLCollections:n}=await Promise.resolve().then(()=>nv);return{getOODLFeeOutput:e,getOODLCollectionFeeOutput:t,setDynamicOODLCollections:n}},__VITE_PRELOAD__),{loadCollectionsRegistry:R,matchCollectionForInscription:U}=await n(async()=>{const{loadCollectionsRegistry:e,matchCollectionForInscription:t}=await Promise.resolve().then(()=>Xv);return{loadCollectionsRegistry:e,matchCollectionForInscription:t}},__VITE_PRELOAD__),M=String(p?.collectionKey||"").trim()||null;let $=[];try{const e=await R({forceRefresh:!1});$=Array.isArray(e?.collections)?e.collections:[],F($)}catch{$=[]}const H=t=>{const n=t?.id||t?.inscriptionId||t?.inscription_id;if(!n)throw new Error("A selected inscription is missing inscription id");const r=t?.utxo;if(!r?.txid||void 0===r?.vout)throw new Error(`Selected inscription ${String(n).slice(0,12)}\u2026 is missing UTXO data. Refresh and try again.`);const i={...r,address:r?.address||r?.addr||e?.ordinalsAddress||null};if(!i?.address)throw new Error("Parent UTXO missing address. Ensure wallet ordinalsAddress is available.");return{inscriptionId:String(n),parentUtxo:i}},D=async e=>{if(!M){try{const t=await U(e,$);if(t)return String(t)}catch{}try{const{detectAndVerifyBitmapByInscriptionId:t}=await n(async()=>{const{detectAndVerifyBitmapByInscriptionId:e}=await Promise.resolve().then(()=>gv);return{detectAndVerifyBitmapByInscriptionId:e}},__VITE_PRELOAD__),r=await t(e);if("bitmap"===r?.type&&r?.verified)return"bitmap"}catch{}try{const{detectAndVerifyParcelByInscriptionId:t}=await n(async()=>{const{detectAndVerifyParcelByInscriptionId:e}=await Promise.resolve().then(()=>Sv);return{detectAndVerifyParcelByInscriptionId:e}},__VITE_PRELOAD__),r=await t(e);if("parcel"===r?.type&&r?.verified)return"parcel"}catch{}return null}if("uncategorized"===M)return null;if("bitmap"===String(M).toLowerCase()){const{detectAndVerifyBitmapByInscriptionId:t}=await n(async()=>{const{detectAndVerifyBitmapByInscriptionId:e}=await Promise.resolve().then(()=>gv);return{detectAndVerifyBitmapByInscriptionId:e}},__VITE_PRELOAD__),r=await t(e);if("bitmap"!==r?.type||!r?.verified)throw new Error("Selected collection is bitmap, but at least one selected parent is not OCI-verified as a bitmap.");return"bitmap"}if("parcel"===String(M).toLowerCase()){const{detectAndVerifyParcelByInscriptionId:t}=await n(async()=>{const{detectAndVerifyParcelByInscriptionId:e}=await Promise.resolve().then(()=>Sv);return{detectAndVerifyParcelByInscriptionId:e}},__VITE_PRELOAD__),r=await t(e);if("parcel"!==r?.type||!r?.verified)throw new Error('Selected collection is parcel, but at least one selected parent does not look like a parcel inscription (expected "{parcel}.{bitmap}.bitmap").');return"parcel"}const t=$.find(e=>String(e?.key||"").trim()===M)||null;if(!t)throw new Error("Selected collection not found in registry.");if(await U(e,[t])!==M)throw new Error("At least one selected parent does not match the selected collection rules.");return String(M)};m(c?`Dry run: creating ${d.length} listings (no broadcast)\u2026`:`Creating ${d.length} listings\u2026 watch for wallet popups.`);const z=d.map(H),W=[];for(const e of z)W.push(await D(e.inscriptionId));const V=[],j=new Set;for(let e=0;e<z.length;e++){const{inscriptionId:r,parentUtxo:i}=z[e],a=B.find(e=>!j.has(`${e.txid}:${e.vout}`));if(!a)throw new Error("Ran out of funding UTXOs during bulk listing. Consolidate and try again.");j.add(`${a.txid}:${a.vout}`);const o=W[e]||null,s=L(o)||O();let l=null,u=null;if("bitmap"===String(o||"").toLowerCase())try{const{detectAndVerifyBitmapByInscriptionId:e}=await n(async()=>{const{detectAndVerifyBitmapByInscriptionId:e}=await Promise.resolve().then(()=>gv);return{detectAndVerifyBitmapByInscriptionId:e}},__VITE_PRELOAD__),t=await e(r);l=Number.isFinite(Number(t?.bitmapNumber))?Math.floor(Number(t.bitmapNumber)):null}catch{l=null}if("parcel"===String(o||"").toLowerCase())try{const{detectAndVerifyParcelByInscriptionId:e}=await n(async()=>{const{detectAndVerifyParcelByInscriptionId:e}=await Promise.resolve().then(()=>Sv);return{detectAndVerifyParcelByInscriptionId:e}},__VITE_PRELOAD__),t=await e(r);u=Number.isFinite(Number(t?.parcelNumber))?Math.floor(Number(t.parcelNumber)):null,l=Number.isFinite(Number(t?.bitmapNumber))?Math.floor(Number(t.bitmapNumber)):null}catch{u=null,l=null}m(`Listing ${e+1}/${z.length}\u2026 (${String(r).slice(0,12)}\u2026)`);const d={parentInscriptionId:r,collectionKey:o,sellerAddress:I,priceSats:BigInt(h),...null!==w?{minBlockHeight:w}:{},...Number.isFinite(Number(u))?{parcelNumber:Math.floor(Number(u))}:{},...Number.isFinite(Number(l))?{bitmapNumber:Math.floor(Number(l))}:{}},f=await C({walletProvider:E,parentUtxo:i,fundingUtxo:a,fundingUtxos:[a],listingScriptAddress:g,markerValueSats:v,sellerChangeAddress:I,feeRateSatPerVb:t,marker:d,emitOpReturnMarker:!1,emitParcelHintOpReturn:!1,broadcast:!c,oodlFeeAddress:s?.address||null,oodlFeeSats:s?.value||null});if("3tx-complete"!==f?.mode)throw new Error(`Bulk listing halted: wallet cannot complete listing flow (mode=${String(f?.mode||"unknown")}).`);V.push({parentInscriptionId:r,collectionKey:o,commitTxid:f?.commitTxid||null,revealTxid:f?.revealTxid||f?.markerTxid||null,parentOutpointAfterCommit:f?.parentOutpointAfterCommit||null,listingFundingOutpoint:f?.listingFundingOutpoint||null,listingScriptAddress:f?.listingScriptAddress||g||null,sellerListingPsbtHashHex:f?.sellerListingPsbtHashHex||null,sellerListingPsbtBase64:f?.sellerListingPsbtBase64||null,broadcasted:!1!==f?.broadcasted})}const q={version:1,type:"oodl-bulk-listings",createdAt:(new Date).toISOString(),network:String(e?.network||"").trim()||null,sellerAddress:I,ordinalsAddress:k,priceSats:String(h),listingDryRun:!!c,listings:V},K=JSON.stringify(q,null,2);b(K),m(`Bulk complete: ${V.length}/${d.length} listings. Bundle JSON ready.`)}catch(cC){m(""),g(cC?.message||String(cC))}finally{f?.()}},setBulkBundleJson:b}}({walletState:e,feeRate:re,selectedParents:p,selectedUtxos:ce,cachedFilteredUtxos:y,salePriceSats:Ke,listingScriptAddress:Ge,listingMarkerValueSats:Je,listingDryRun:Ze,saleMinBlockHeight:tt,beginTxBusy:We,endTxBusy:Ve}),At=kt?.onCreateBulkListingTx,Nt=kt?.bulkSellerStatus||"",Tt=kt?.bulkSellerError||"",_t=kt?.bulkBundleJson||"",Pt=function({walletState:e,walletInscriptions:t,selectedParents:r,setSelectedParents:i,setReinscriptionTarget:a,setContentType:o,setContent:s,setFileName:l,setRequestedContentEditorTab:c}){const[u,d]=it.useState(""),[f,p]=it.useState(""),[m,h]=it.useState([]),[g,y]=it.useState("");it.useEffect(()=>{let n=!0;return(async()=>{if(p(""),d(""),!e?.isConnected)return void(n&&(h([]),y("")));if(!mh())return void(n&&(h([]),y(""),d("Collections registry unavailable in this environment.")));const r=new Set((Array.isArray(t)?t:[]).map(e=>QS(e?.id||e?.inscriptionId||e?.inscription_id)).filter(Boolean));if(0!==r.size){d("Loading collection authority slots\u2026");try{const e=Ev,t=await async function(e){const t=QS(e);if(!t)return[];const n=[];let r=0;for(;;){const e=th(0===r?`/r/children/${t}`:`/r/children/${t}/${r}`),i=await tE(e);if(!i?.ids||!Array.isArray(i.ids)||0===i.ids.length)break;if(n.push(...i.ids),!i.more)break;if(r++,r>50)break}return n}(e),i=t.filter(e=>r.has(String(e)));if(!n)return;h(i),d(""),!QS(g)&&i.length>0&&y(i[0]),0===i.length&&d("No authority slot found. You must own a child of the collections registry parent to publish a collection.")}catch(cC){if(!n)return;h([]),y(""),p(cC?.message||String(cC)),d("")}}else n&&(h([]),y(""))})(),()=>{n=!1}},[e?.isConnected,t]);const b=it.useCallback(async({key:u,title:d,description:f,indexingAddress:p,feeSats:m,selectedItemIdsOverride:h,offerItemIdsOverride:y,catalogImageInscriptionId:b,galleryInscriptionId:w,includeSaleOffers:x=!1,salePriceSats:v="",salePriceByInscriptionId:S,minBlockHeightByInscriptionId:E,saleOfferItemIdsText:I="",minBlockHeight:k=null,navigateToEditor:A=!0,onProgress:N}={})=>{const T=QS(g);if(!T)throw new Error("Select an authority slot (a child of the registry parent) to publish this collection.");const _=Array.isArray(h)&&h.length>0?h.map(e=>QS(e)).filter(Boolean):(Array.isArray(r)?r:[]).map(e=>QS(e?.id)).filter(Boolean),P=e=>{if(null==e||""===e)return null;const t=Number(e);if(!Number.isFinite(t))throw new Error("Block height must be a number.");const n=Math.floor(t);if(n<0)throw new Error("Block height must be >= 0.");return n},B=P(k),C=(()=>{if(!E||"object"!=typeof E)return!1;for(const e of Object.keys(E)){const t=E[e];if(null!=t&&""!==String(t).trim())return!0}return!1})();if(null!==B||C){const{fetchBlockHeightViaProxy:e}=await n(async()=>{const{fetchBlockHeightViaProxy:e}=await Promise.resolve().then(()=>ab);return{fetchBlockHeightViaProxy:e}},__VITE_PRELOAD__),t="undefined"!=typeof window&&window.__NEXUS_NETWORK__||"mainnet";let r;try{r=await e(t)}catch{r=null}const i=Number(r);if(!Number.isFinite(i))throw new Error('Unable to fetch chain tip height to validate "Not valid before block". Clear the field or try again.');const a=Math.floor(i);if(null!==B&&B<=a)throw new Error(`Not valid before block must be > tip height (${a}). Clear it to publish immediately-valid offers.`);if(C)for(const[n,o]of Object.entries(E||{})){const e=eE(n);if(!e)continue;const t=P(o);if(null!==t&&t<=a)throw new Error(`Not valid before block for ${e} must be > tip height (${a}). Clear it to publish immediately-valid offers.`)}}let O;if(x){const r=new Set(_),i=Array.isArray(y)&&y.length>0?y.map(e=>QS(e)).filter(Boolean):function(e){const t=QS(e);if(!t)return[];const n=t.split(/[\s,]+/g).map(e=>QS(e)).filter(Boolean),r=new Set,i=[];for(const a of n)r.has(a)||(r.add(a),i.push(a));return i}(I),a=i&&i.length>0?i.filter(e=>r.has(e)):_;if(!e?.isConnected)throw new Error("Connect a wallet before generating sale offers.");const{parseUserPriceToSats:o}=await n(async()=>{const{parseUserPriceToSats:e}=await Promise.resolve().then(()=>Ox);return{parseUserPriceToSats:e}},__VITE_PRELOAD__),s=!(!S||"object"!=typeof S),l=o(v);if(!s&&(!Number.isFinite(l)||l<=0))throw new Error("Sale price sats must be > 0 to generate offers.");const c=e?.provider||window.NexusWalletConnect;if(!c)throw new Error("Wallet provider not available");const u=e?.paymentAddress||e?.address||e?.ordinalsAddress;if(!u)throw new Error("Wallet payout address not available");const d=e=>{"function"==typeof N&&N(e)},f=new Set(a);a&&0!==a.length?d(`Building seller offer PSBT(s) for up to ${a.length} inscription(s)\u2026`):(d("No items selected for sale offers; proceeding without embedded offers."),O=[]);const{loadBitcoinLibFromInscription:p}=await n(async()=>{const{loadBitcoinLibFromInscription:e}=await Promise.resolve().then(()=>yg);return{loadBitcoinLibFromInscription:e}},__VITE_PRELOAD__),{sanitizePsbtForSharing:m}=await n(async()=>{const{sanitizePsbtForSharing:e}=await Promise.resolve().then(()=>sC);return{sanitizePsbtForSharing:e}},__VITE_PRELOAD__),{signPsbtsWithFallback:h}=await n(async()=>{const{signPsbtsWithFallback:e}=await Promise.resolve().then(()=>qg);return{signPsbtsWithFallback:e}},__VITE_PRELOAD__),{assertOpenStoreSellerOfferSignedCorrectly:g}=await n(async()=>{const{assertOpenStoreSellerOfferSignedCorrectly:e}=await Promise.resolve().then(()=>BB);return{assertOpenStoreSellerOfferSignedCorrectly:e}},__VITE_PRELOAD__),b=await p(),w="undefined"!=typeof window&&window.__NEXUS_NETWORK__||"mainnet",x=String(w).toLowerCase(),k="testnet"===x||"signet"===x||"regtest"===x?b.networks.testnet:b.networks.bitcoin,A=546,T=(b.Transaction?.SIGHASH_SINGLE??3)|(b.Transaction?.SIGHASH_ANYONECANPAY??128),C=Buffer.alloc(32,0),L={script:Buffer.from("0014"+"00".repeat(20),"hex"),value:1},F=({parentUtxo:t,priceSats:n,minHeight:r})=>{const i=t&&"object"==typeof t?t:null;if(!i?.txid||null==i?.vout)throw new Error("Selected inscription is missing UTXO data. Refresh inscriptions/UTXOs and try again.");const a=Number(i?.value);if(!Number.isFinite(a)||a<=0)throw new Error("Selected inscription UTXO is missing value. Refresh UTXOs/inscriptions and try again.");const o=QS(i?.address||i?.addr||e?.ordinalsAddress);if(!o)throw new Error("Parent UTXO missing address. Ensure wallet ordinalsAddress is available.");const s=Number(n);if(!Number.isFinite(s)||s<=0)throw new Error("Each sale offer price must be > 0 sats.");const l=new b.Psbt({network:k});if(null!=r)try{l.setLocktime(Number(r))}catch{throw new Error("Failed to set offer PSBT locktime for min block height.")}l.addInput({hash:C,index:4294967294,sequence:4294967293,witnessUtxo:L}),l.addInput({hash:C,index:4294967295,sequence:4294967293,witnessUtxo:L});const d=b.address.toOutputScript(o,k);l.addInput({hash:i.txid,index:Number(i.vout),witnessUtxo:{script:d,value:Math.floor(a)},sighashType:T,sequence:4294967293});try{const t=c?.getState?.()?.ordinalsPublicKey||c?.getState?.()?.publicKey||e?.ordinalsPublicKey||e?.publicKey||null,n="string"==typeof t?t.startsWith("0x")?t.slice(2):t:null;if("string"==typeof o&&(o.startsWith("bc1p")||o.startsWith("tb1p"))&&n&&(64===n.length||66===n.length)&&l?.data?.inputs?.[2]){const e=66===n.length?n.slice(2):n;l.data.inputs[2].tapInternalKey=Buffer.from(e,"hex")}}catch{}l.addOutput({address:u,value:0}),l.addOutput({address:u,value:A});const f=a>A?BigInt(a)-BigInt(A):0n,p=BigInt(Math.floor(s))+f;return l.addOutput({address:u,value:Number(p)}),{offerPsbt:l,signOptions:{autoFinalized:!1,toSignInputs:[{index:2,address:o,sighashType:T}]}}},R=(e,t)=>{let n,r;try{n=b.Psbt.fromHex(String(e),{network:k})}catch{n=b.Psbt.fromBase64(String(e),{network:k})}try{r=b.Psbt.fromHex(String(t),{network:k})}catch{r=null}if(!r)throw new Error("Collection offer validation failed: missing unsigned PSBT context");return g({unsignedOfferPsbt:r,signedOfferPsbt:n,sellerInputIndex:2,expectedSighashByte:131}),n.toBase64()},U=[],M=[],$=[],H=[],D=Array.isArray(t)?t:[],z=new Map;for(const e of D){const t=QS(e?.id);t&&!z.has(t)&&z.set(t,e)}for(const t of a){if(!t)continue;if(!f.has(t))continue;const n=z.get(t),r=n?.utxo;if(!r){H.push({inscriptionId:t,reason:"not in wallet (missing utxo)"});continue}const i={...r||{},address:r?.address||r?.addr||e?.ordinalsAddress||null},a=s?o(s?S?.[t]:void 0):l;if(!Number.isFinite(a)||a<=0)throw new Error(`Missing/invalid sale price for ${t}. Set a sats value > 0.`);const c=E&&"object"==typeof E?E?.[t]:void 0,u=null==c||""===String(c).trim()?null:P(c),d=null!==u?u:B;try{const e=F({parentUtxo:i,priceSats:a,minHeight:d});U.push(e.offerPsbt.toHex()),M.push(e.signOptions),$.push({inscriptionId:t,priceSats:a})}catch(cC){H.push({inscriptionId:t,reason:cC?.message||"failed to build offer"})}}if(H.length>0&&d(`Skipping ${H.length} inscription(s) for sale offers (not in wallet / missing UTXO).`),0===U.length)O=[],d("No signable sale offers were generated; proceeding with manifest only.");else{d(`Requesting wallet signature for ${U.length} offer PSBT(s)\u2026`);const e=await h(c,U,M);if(!Array.isArray(e)||e.length!==U.length)throw new Error("Wallet returned an unexpected response when signing multiple PSBTs.");d(`Verifying + sanitizing ${e.length} signed offer PSBT(s)\u2026`);const t=[];for(let n=0;n<e.length;n++){const r=$[n]?.inscriptionId,i=$[n]?.priceSats,a=R(e[n],U[n]),o=await m(a,{profile:"publish"});t.push({inscriptionId:r,priceSats:i,sellerOfferPsbt:o})}O=t,d(`Generated ${t.length} offer PSBT(s). Building manifest\u2026`)}}const L=function({key:e,title:t,description:n,indexingAddress:r,feeSats:i,selectedItemIds:a,saleOffers:o,minBlockHeight:s,catalogImageInscriptionId:l,galleryInscriptionId:c}){const u=ZS(e),d=QS(t)||u,f=QS(n),p=QS(r);if(!u)throw new Error("Collection key is required.");if(!d)throw new Error("Collection title is required.");if(!p)throw new Error("Indexing address is required.");const m=(()=>{const e=Array.isArray(a)?a:[],t=new Set,n=[];for(const r of e){const e=eE(r);e&&(t.has(e)||(t.add(e),n.push(e)))}return n.sort(),n})(),h=(()=>{const e=Number(null==i||""===i?330:i);if(!Number.isFinite(e))throw new Error("Indexing fee sats must be a number.");if(e<330)throw new Error("Indexing fee sats must be >= 330.");return Math.floor(e)})(),g={key:u,title:d,addresses:{indexing:p}},y=eE(l);y&&(g.catalogImage={inscriptionId:y}),f&&(g.description=f),g.fee={sats:h,minSats:h};const b=QS(c),w=b&&/^[a-f0-9]{64}i\d+$/i.test(b),x=w?void 0:function(e,{minCount:t=25}={}){const n=Array.isArray(e)?e:[];if(n.length<t)return null;let r="";const i=[];for(const s of n){const e=eE(s);if(!e)return null;const t=e.match(/^([0-9a-f]{64})i(\d+)$/);if(!t)return null;if(r||(r=t[1]),t[1]!==r)return null;const n=Number(t[2]);if(!Number.isSafeInteger(n)||n<0)return null;i.push(n)}i.sort((e,t)=>e-t);const a=i[0],o=i[i.length-1];if(o-a+1!==i.length)return null;for(let s=1;s<i.length;s++)if(i[s]!==i[s-1]+1)return null;return{txid:r,start:a,end:o}}(m,{minCount:25}),v=x?{children:{include:[`${x.txid}i${x.start}-${x.end}`]}}:void 0,S=(()=>{const e={};return w&&(e.galleryInscriptionId=b),!v&&!w&&m.length>0&&(e.inscriptionIds=m),Object.keys(e).length>0?e:void 0})(),E=(()=>{const e=Array.isArray(o)?o:[],t=new Set,n=[];for(const r of e){const e=eE(r?.inscriptionId||r?.id),i=QS(r?.sellerOfferPsbt||r?.psbt),a=Number(r?.priceSats??r?.price);e&&i&&(!Number.isFinite(a)||a<=0||t.has(e)||(t.add(e),n.push({inscriptionId:e,priceSats:Math.floor(a),sellerOfferPsbt:i})))}return n.sort((e,t)=>String(e.inscriptionId).localeCompare(String(t.inscriptionId))),n})();return{p:"OODL-COLLECTION",version:"1.0",meta:{title:d,description:f||void 0},registry_entry:g,...v?{indexing:v}:{},...S?{match:S}:{},...E.length>0?{open_store:{version:"1",...Number.isFinite(Number(s))?{minBlockHeight:Math.floor(Number(s))}:{},offers:E}}:{}}}({key:u,title:d,description:f,indexingAddress:p,feeSats:m,selectedItemIds:_,saleOffers:O,catalogImageInscriptionId:b,galleryInscriptionId:w,...null===B||C?{}:{minBlockHeight:B}}),F=JSON.stringify(L);"function"==typeof i&&i([]),"function"==typeof a&&a(T),"function"==typeof o&&o("application/json"),"function"==typeof s&&s(F);const R=ZS(u);return"function"==typeof l&&l(R?`oodl-collection-${R}.json`:"oodl-collection.json"),A&&"function"==typeof c&&c("text"),{manifest:L,json:F}},[g,r,e,i,a,o,s,l,c]);return{authoritySlots:m,authorityStatus:u,authorityError:f,selectedAuthoritySlotId:g,setSelectedAuthoritySlotId:y,loadManifestIntoInscriber:b}}({walletState:e,walletInscriptions:c,selectedParents:p,setSelectedParents:m,setReinscriptionTarget:g,setContentType:A,setContent:T,setFileName:C,setRequestedContentEditorTab:Fe}),Bt=Pt?.authoritySlots||[],Ct=Pt?.authorityStatus||"",Ot=Pt?.authorityError||"",Lt=Pt?.selectedAuthoritySlotId||"",Ft=Pt?.setSelectedAuthoritySlotId||(()=>{}),Rt=Pt?.loadManifestIntoInscriber,Ut=it.useCallback(async(t={})=>{if("function"!=typeof Rt)throw new Error("Collection registry flow is not available");We();try{const n=e=>{const n=String(e||"").trim();if(n){try{"function"==typeof t?.onProgress&&t.onProgress(n)}catch{}ge({type:"info",message:n})}};if(q(""),X(!0),n("Preparing collection manifest\u2026"),await Rt({...t||{},navigateToEditor:!1,onProgress:n}),!e?.isConnected)throw new Error("Connect a wallet before launching.");if(!ce||0===ce.length)throw new Error("Select payment UTXOs in the UTXOs tab before launching.");n("Waiting for wallet prompt\u2026"),await new Promise(e=>setTimeout(e,50));const r=ee.current;if("function"!=typeof r)throw new Error("Internal error: inscribe function not ready yet. Please retry.");await r()}finally{Ve()}},[Rt,e?.isConnected,ce]),Mt=function({walletState:e,walletInscriptions:t,selectedUtxos:r,feeRate:i,setToast:a,setContentEncoding:o,setCompressBeforeInscribe:s,setSelectedParents:l,setContentType:c,setFileName:u,setContent:d,setRequestedContentEditorTab:f,handleInscribeRef:p,beginTxBusy:m,endTxBusy:h}){const g=it.useCallback(async(g={})=>{m();try{const m=e=>{const t=String(e||"").trim();if(t){try{"function"==typeof g?.onProgress&&g.onProgress(t)}catch{}a?.({type:"info",message:t})}},h=nE(g?.bitmapInscriptionId),y=Number(g?.bitmapNumber);if(!/^[0-9a-fA-F]{64}i\d+$/.test(h))throw new Error("Bitmap inscription id must be <txid>i<index>.");if(!Number.isFinite(y)||y<0)throw new Error("Bitmap number must be a non-negative integer.");const b=Array.isArray(g?.itemIds)?g.itemIds:[];if(0===b.length)throw new Error("Select at least one parcel inscription id to include.");const w=!!g?.includeSaleOffers,x=g?.salePriceByInscriptionId&&"object"==typeof g.salePriceByInscriptionId?g.salePriceByInscriptionId:{},v=g?.minBlockHeightByInscriptionId&&"object"==typeof g.minBlockHeightByInscriptionId?g.minBlockHeightByInscriptionId:null,S=e=>{if(null==e||""===e)return null;const t=Number(e);if(!Number.isFinite(t))throw new Error("Block height must be a number.");const n=Math.floor(t);if(n<0)throw new Error("Block height must be >= 0.");return n},E=w?S(g?.minBlockHeight):null,I=(()=>{if(!w)return!1;if(!v)return!1;for(const e of Object.keys(v)){const t=v[e];if(null!=t&&""!==String(t).trim())return!0}return!1})(),k="undefined"!=typeof window&&window.__NEXUS_NETWORK__||"mainnet";if(null!==E||I){const{fetchBlockHeightViaProxy:e}=await n(async()=>{const{fetchBlockHeightViaProxy:e}=await Promise.resolve().then(()=>ab);return{fetchBlockHeightViaProxy:e}},__VITE_PRELOAD__);let t;try{t=await e(k)}catch{t=null}const r=Number(t);if(!Number.isFinite(r))throw new Error('Unable to fetch chain tip height to validate "Not valid before block". Clear the field or try again.');const i=Math.floor(r);if(null!==E&&E<=i)throw new Error(`Not valid before block must be > tip height (${i}). Clear it to publish immediately-valid offers.`);if(I)for(const[n,a]of Object.entries(v||{})){const e=S(a);if(null!==e&&e<=i)throw new Error(`Not valid before block for ${String(n)} must be > tip height (${i}). Clear it to publish immediately-valid offers.`)}}m("Preparing Bitmap Parcels manifesto\u2026"),o?.(""),s?.(!0);const{parseUserPriceToSats:A}=await n(async()=>{const{parseUserPriceToSats:e}=await Promise.resolve().then(()=>Ox);return{parseUserPriceToSats:e}},__VITE_PRELOAD__),N={p:"Bitmap Parcel",v:1,bitmap:Math.floor(y),all:!0,items:b.map(e=>({inscription_id:String(e),price_sats:null!=x?.[e]&&""!==String(x[e]).trim()?A(x[e]):null,for_sale:!!w&&null!=x?.[e]&&""!==String(x[e]).trim()})),open_store:{version:1,network:String(k),...null===E||I?{}:{minBlockHeight:E},offers:[]}};if(w){m("Creating seller offer PSBTs\u2026");const r=e?.provider||window.NexusWalletConnect;if(!r)throw new Error("Wallet provider not available");const a=e?.paymentAddress||e?.address||e?.ordinalsAddress;if(!a)throw new Error("Wallet payout address not available");const o=Number(i||0);if(!Number.isFinite(o)||o<=0)throw new Error("Set a fee rate first (sat/vB).");const s=Array.isArray(t)?t:[],l=new Map(s.map(e=>[String(e?.id||e?.inscriptionId||e?.inscription_id||""),e])),c=[];for(const t of b){const n=x?.[t];if(null==n||""===String(n).trim())continue;const r=l.get(String(t)),i=r?.utxo;if(!i?.txid||void 0===i?.vout)throw new Error(`Selected inscription ${t} is missing UTXO data. Refresh inscriptions/UTXOs and try again.`);const a={...i,address:i?.address||i?.addr||e?.ordinalsAddress||null},o=A(n),s=v?v?.[t]:void 0,u=null==s||""===String(s).trim()?null:S(s),d=null!==u?u:E;c.push({inscriptionId:String(t),priceSats:o,parentUtxo:a,minBlockHeight:d})}if(c.length>0){m(`Requesting wallet signature for ${c.length} offer PSBT(s)\u2026`);const t=await async function({walletState:e,walletProvider:t,offers:r,sellerPayoutAddress:i,minBlockHeight:a=null}){if(!e?.isConnected)throw new Error("Wallet not connected");if(!t)throw new Error("Wallet provider not available");if(!i)throw new Error("Wallet payout address not available");if(!Array.isArray(r)||0===r.length)return[];const{loadBitcoinLibFromInscription:o}=await n(async()=>{const{loadBitcoinLibFromInscription:e}=await Promise.resolve().then(()=>yg);return{loadBitcoinLibFromInscription:e}},__VITE_PRELOAD__),{sanitizePsbtForSharing:s}=await n(async()=>{const{sanitizePsbtForSharing:e}=await Promise.resolve().then(()=>sC);return{sanitizePsbtForSharing:e}},__VITE_PRELOAD__),{assertOpenStoreSellerOfferSignedCorrectly:l}=await n(async()=>{const{assertOpenStoreSellerOfferSignedCorrectly:e}=await Promise.resolve().then(()=>BB);return{assertOpenStoreSellerOfferSignedCorrectly:e}},__VITE_PRELOAD__),{signPsbtsWithFallback:c}=await n(async()=>{const{signPsbtsWithFallback:e}=await Promise.resolve().then(()=>qg);return{signPsbtsWithFallback:e}},__VITE_PRELOAD__),u=await o(),d=await async function(e){const t="undefined"!=typeof window&&window.__NEXUS_NETWORK__||"mainnet",n=String(t).toLowerCase();return"testnet"===n||"signet"===n||"regtest"===n?e.networks.testnet:e.networks.bitcoin}(u),f=r.map(n=>function({btc:e,network:t,walletState:n,walletProvider:r,parentUtxo:i,priceSats:a,sellerPayoutAddress:o,minBlockHeight:s=null}){const l=i&&"object"==typeof i?i:null;if(!l?.txid||null==l?.vout)throw new Error("Selected inscription is missing UTXO data. Refresh inscriptions/UTXOs and try again.");const c=Number(l?.value);if(!Number.isFinite(c)||c<=0)throw new Error("Selected inscription UTXO is missing value. Refresh UTXOs/inscriptions and try again.");const u=(null==(d=l?.address||l?.addr||n?.ordinalsAddress)?"":String(d)).trim();var d;if(!u)throw new Error("Parent UTXO missing address. Ensure wallet ordinalsAddress is available.");const f=(e.Transaction?.SIGHASH_SINGLE??3)|(e.Transaction?.SIGHASH_ANYONECANPAY??128),p=new e.Psbt({network:t});if(null!=s){const e=Number(s);if(!Number.isFinite(e)||e<0||e>4294967295||!Number.isInteger(e))throw new Error("minBlockHeight must be a uint32 block height");try{"function"==typeof p.setLocktime?p.setLocktime(e>>>0):p.__CACHE?.__TX&&(p.__CACHE.__TX.locktime=e>>>0)}catch{throw new Error("Wallet/bitcoinjs-lib does not support setting PSBT locktime")}}const m=Buffer.alloc(32,0),h={script:Buffer.from("0014"+"00".repeat(20),"hex"),value:1};p.addInput({hash:m,index:4294967294,sequence:4294967293,witnessUtxo:h}),p.addInput({hash:m,index:4294967295,sequence:4294967293,witnessUtxo:h});const g=e.address.toOutputScript(u,t);p.addInput({hash:l.txid,index:Number(l.vout),witnessUtxo:{script:g,value:Math.floor(c)},sighashType:f,sequence:4294967293});try{const e=r?.getState?.()?.ordinalsPublicKey||r?.getState?.()?.publicKey||n?.ordinalsPublicKey||n?.publicKey||null,t="string"==typeof e?e.startsWith("0x")?e.slice(2):e:null;if("string"==typeof u&&(u.startsWith("bc1p")||u.startsWith("tb1p"))&&t&&(64===t.length||66===t.length)&&p?.data?.inputs?.[2]){const e=66===t.length?t.slice(2):t;p.data.inputs[2].tapInternalKey=Buffer.from(e,"hex")}}catch{}p.addOutput({address:o,value:0}),p.addOutput({address:o,value:546});const y=c>546?BigInt(c)-BigInt(546):0n,b=BigInt(Math.floor(Number(a)))+y;return p.addOutput({address:o,value:Number(b)}),{offerPsbt:p,sellerInputIndex:2,address:u,sellerSighash:f}}({btc:u,network:d,walletState:e,walletProvider:t,parentUtxo:n?.parentUtxo,priceSats:n?.priceSats,sellerPayoutAddress:i,minBlockHeight:null!=n?.minBlockHeight?n.minBlockHeight:a})),p=f.map(e=>e.offerPsbt.toHex()),m=f.map(e=>({autoFinalized:!1,toSignInputs:[{index:e.sellerInputIndex,address:e.address,sighashType:e.sellerSighash}],sighashTypes:[e.sellerSighash]})),h=await c(t,p,m);if(!Array.isArray(h)||h.length!==p.length)throw new Error("Wallet returned unexpected signed PSBT result");const g=[];for(let n=0;n<h.length;n++){const e=f[n].offerPsbt,t=h[n];let r;try{r=u.Psbt.fromHex(t,{network:d})}catch{r=u.Psbt.fromBase64(t,{network:d})}l({unsignedOfferPsbt:e,signedOfferPsbt:r,sellerInputIndex:f[n].sellerInputIndex,expectedSighashByte:131}),g.push(await s(r.toBase64(),{profile:"publish"}))}return g}({walletState:e,walletProvider:r,offers:c.map(e=>({parentUtxo:e.parentUtxo,priceSats:e.priceSats,minBlockHeight:e.minBlockHeight})),sellerPayoutAddress:a,...null===E||I?{}:{minBlockHeight:E}});N.open_store.offers=t.map((e,t)=>({inscription_id:c[t].inscriptionId,price_sats:Number(c[t].priceSats),seller_offer_psbt:String(e)}))}}if(l?.([{id:h,omitParentTag:!0}]),c?.("application/json"),u?.("nxs-parcel-manifest.json"),d?.(JSON.stringify(N)),f?.("review"),!e?.isConnected)throw new Error("Connect a wallet before launching.");if(!r||0===r.length)throw new Error("Select payment UTXOs in the UTXOs tab before launching.");m("Waiting for wallet prompt (manifest inscription)\u2026"),await new Promise(e=>setTimeout(e,50));const T=p?.current;if("function"!=typeof T)throw new Error("Internal error: inscribe function not ready yet. Please retry.");const{OODL_COLLECTION_FEES:_}=await n(async()=>{const{OODL_COLLECTION_FEES:e}=await Promise.resolve().then(()=>nv);return{OODL_COLLECTION_FEES:e}},__VITE_PRELOAD__),P=_?.parcel_manifest||_?.parcel||null,B=nE(P?.address),C=Number(P?.feeSats||600);if(!B)throw new Error("Parcel indexing address not configured");const O=await T({nxsParcelManifestSelfHint:{bitmapNumber:y,all:!0,indexingAddress:B,feeSats:C}});if(!O?.revealTxIds||!Array.isArray(O.revealTxIds)||!Array.isArray(O.mapping))throw new Error("Manifest inscription completed but did not return reveal txids/mapping");if(O.mapping.length<1)throw new Error("Manifest inscription mapping missing");const L=O.mapping[0],F=O.revealTxIds?.[L.segment];if(!F)throw new Error("Manifest reveal txid missing");const R=`${String(F)}i${Number(L.inputIndex)}`;return m("Parcel manifesto published."),{manifestInscriptionResult:O,manifestoInscriptionId:R}}finally{h()}},[m,h,i,p,r,s,d,o,c,u,f,l,a,t,e]);return{onLaunchParcelManifest:g}}({walletState:e,walletInscriptions:c,selectedUtxos:ce,feeRate:re,setToast:ge,setContentEncoding:q,setCompressBeforeInscribe:X,setSelectedParents:m,setContentType:A,setFileName:C,setContent:T,setRequestedContentEditorTab:Fe,handleInscribeRef:ee,beginTxBusy:We,endTxBusy:Ve}),$t=Mt?.onLaunchParcelManifest,Ht=xt||Nt||dt||st||It?.manualSellerStatus||It?.manualBuyStatus||It?.manualBuyerFundedStatus||It?.manualSellerCountersignStatus||"Processing transaction\u2026",Dt=(()=>{try{if(!e?.isConnected)return!1;const t=y?Array.isArray(y)?y:y.spendable||[]:[],n=e?.paymentAddress||e?.address||e?.ordinalsAddress;if(!n)return!1;const r=[...Array.isArray(t)?t:[],...Array.isArray(ce)?ce:[]],i=t=>{if(!t)return null;const r=t?.fullUtxo||t?.utxo||t?.raw||t?.full||t,i=r.txid||r.txId||r.hash,a=r.vout??r.index??r.n,o=r.value??r.satoshis??r.amount,s=r.address||r.addr||n;if(!i||null==a)return null;const l=Number(o);if(!Number.isFinite(l)||l<=0)return null;const c=e?.ordinalsAddress||null,u=e?.paymentAddress||null;if(c&&u&&c!==u){const e=String(s||"").trim();if(e&&e===String(c).trim())return null}return{txid:String(i),vout:Number(a),value:l,address:s}},a=r.map(i).filter(Boolean),o=new Map;a.forEach(e=>o.set(`${e.txid}:${e.vout}`,e));const s=Array.from(o.values());return s.length>0&&s.length<3}catch{return!1}})(),[zt,Wt]=rt.useState([]),[Vt,jt]=rt.useState(null);rt.useEffect(()=>{Fw(),(async()=>{const{clearCachedInscriptions:e}=await n(async()=>{const{clearCachedInscriptions:e}=await Promise.resolve().then(()=>VB);return{clearCachedInscriptions:e}},__VITE_PRELOAD__),{clearCachedCompleteData:t}=await n(async()=>{const{clearCachedCompleteData:e}=await Promise.resolve().then(()=>ky);return{clearCachedCompleteData:e}},__VITE_PRELOAD__);Object.keys(sessionStorage).filter(e=>e.startsWith("nexus_inscriptions_")).forEach(e=>sessionStorage.removeItem(e)),Object.keys(sessionStorage).filter(e=>e.startsWith("nexus_complete_")).forEach(e=>sessionStorage.removeItem(e))})()},[]),rt.useEffect(()=>{(async()=>{if(!e?.isConnected)return;if(c.length>0)return;if(d)return;const t=e.ordinalsAddress||e.address;if(!t)return;const{getCachedInscriptions:r}=await n(async()=>{const{getCachedInscriptions:e}=await Promise.resolve().then(()=>VB);return{getCachedInscriptions:e}},__VITE_PRELOAD__),i=r(t);i&&i.length>0&&(u(i),f(!1))})()},[e?.isConnected,e?.ordinalsAddress,c.length,d]),rt.useEffect(()=>{e?.isConnected||(me(!1),"undefined"!=typeof window&&"inscribing"===window.__nexusGlobalLoading&&(window.__nexusGlobalLoading=null),u([]),m([]),g(null),b(null),ue([]),fe(null),Wt([]),jt(null),ge(null),be(null),Et(null),xe(null),ft(""),mt(""),gt(null),Xe(""),je.current={key:null,started:!1})},[e?.isConnected]);const qt=rt.useRef({wasConnected:!1,hasIdentity:!1,key:null});rt.useEffect(()=>{if("undefined"==typeof window)return;const t=!!e?.isConnected,n=e?.walletType||"",r=e?.ordinalsAddress||"",i=e?.paymentAddress||"",a=e?.address||"",o=`${n}|${r}|${i}|${a}`,s=!!n&&!!(r||i||a),l=qt.current;if(l.wasConnected){if(!t){try{Fw()}catch{}return void window.location.reload()}if(l.hasIdentity&&s&&l.key&&l.key!==o){try{Fw()}catch{}return void window.location.reload()}}qt.current={wasConnected:t,hasIdentity:s,key:o}},[e?.isConnected,e?.walletType,e?.ordinalsAddress,e?.paymentAddress,e?.address]),rt.useEffect(()=>{h&&1!==te&&ne(1)},[h,te]),rt.useEffect(()=>{if(!e?.isConnected)return;const t=(async()=>{const{startBlockHeightMonitor:t,stopBlockHeightMonitor:r,onBlockChange:i}=await n(async()=>{const{startBlockHeightMonitor:e,stopBlockHeightMonitor:t,onBlockChange:n}=await Promise.resolve().then(()=>Qw);return{startBlockHeightMonitor:e,stopBlockHeightMonitor:t,onBlockChange:n}},__VITE_PRELOAD__),a=i(async(t,r,i)=>{const a=[...new Set([e?.ordinalsAddress||"",e?.paymentAddress||e?.address||""].filter(Boolean))];if(0===a.length)return;let o=!1;try{const e="undefined"!=typeof window&&window.__NEXUS_NETWORK__||"mainnet",{fetchCompleteWalletDataDirect:t}=await n(async()=>{const{fetchCompleteWalletDataDirect:e}=await Promise.resolve().then(()=>gy);return{fetchCompleteWalletDataDirect:e}},__VITE_PRELOAD__),r=await t(a,e),s=new Set((Array.isArray(r?.utxos)?r.utxos:[]).filter(e=>e&&e.txid&&"number"==typeof e.vout).map(e=>`${e.txid}:${e.vout}`));try{const{setCachedCompleteData:e}=await n(async()=>{const{setCachedCompleteData:e}=await Promise.resolve().then(()=>ky);return{setCachedCompleteData:e}},__VITE_PRELOAD__);e(a.slice().sort().join(","),r)}catch(l){}try{const{getCachedUtxoResult:e,setCachedUtxoResult:t}=await n(async()=>{const{getCachedUtxoResult:e,setCachedUtxoResult:t}=await Promise.resolve().then(()=>Yy);return{getCachedUtxoResult:e,setCachedUtxoResult:t}},__VITE_PRELOAD__),r=a.slice().sort().join(","),i=e(r);if(i&&"object"==typeof i){const e=e=>Array.isArray(e)?e.filter(e=>e&&s.has(`${e.txid}:${e.vout}`)):e;t(r,{...i,spendable:e(i.spendable),unsafe:e(i.unsafe)})}}catch(l){}ue(e=>(Array.isArray(e)?e:[]).filter(e=>e&&s.has(`${e.txid}:${e.vout}`))),b(e=>{if(!e)return e;if(Array.isArray(e))return e.filter(e=>e&&s.has(`${e.txid}:${e.vout}`));if("object"==typeof e){const t=e=>Array.isArray(e)?e.filter(e=>e&&s.has(`${e.txid}:${e.vout}`)):e;return{...e,spendable:t(e.spendable),unsafe:t(e.unsafe)}}return e}),u(e=>(Array.isArray(e)?e:[]).filter(e=>{const t=e?.utxo?.txid,n=e?.utxo?.vout;return!t||"number"!=typeof n||s.has(`${t}:${n}`)}));try{const{getCachedInscriptions:e,setCachedInscriptions:t}=await n(async()=>{const{getCachedInscriptions:e,setCachedInscriptions:t}=await Promise.resolve().then(()=>VB);return{getCachedInscriptions:e,setCachedInscriptions:t}},__VITE_PRELOAD__);for(const n of a){const r=e(n);if(!Array.isArray(r)||0===r.length)continue;const i=r.filter(e=>{const t=e?.utxo?.txid,n=e?.utxo?.vout;return!t||"number"!=typeof n||s.has(`${t}:${n}`)});i.length!==r.length&&t(n,i)}}catch(l){}x(e=>({...e||{},status:"ready"===String(e?.status||"").toLowerCase()?"unverified":e?.status||"unverified",phase:"block",message:i?"Chain reorg detected. Wallet data reconciled; please refresh to verify ownership.":"New block detected. Wallet data reconciled; please refresh to verify ownership.",ts:Date.now()})),o=!0}catch(uC){}const s=t-r;s>=1&&(ge({type:"info",message:o?`\ud83e\uddf1 ${s} new block${s>1?"s":""} confirmed. Wallet updated smoothly; click "Fetch UTXOs" to fully verify.`:`\ud83e\uddf1 ${s} new block${s>1?"s":""} confirmed. Click "Fetch UTXOs" to refresh.`}),setTimeout(()=>ge(null),1e4))});return t(!0),()=>{a(),r()}})();return()=>{t.then(e=>e&&e())}},[e?.isConnected,e?.ordinalsAddress,e?.paymentAddress,e?.address]),rt.useEffect(()=>{if(N)try{if(N instanceof ArrayBuffer)return void P(N.byteLength);if("object"==typeof N&&void 0!==N.byteLength)return void P(N.byteLength||N.length||0);if("string"==typeof N&&N.startsWith("data:")){const e=N.indexOf(",");if(-1!==e){const t=N.slice(e+1),n="undefined"!=typeof atob?atob(t).length:Buffer.from(t,"base64").length;return void P(n)}}const e=new Blob([N]).size;P(e)}catch{P(N&&N.length?N.length:0)}else P(0)},[N]),rt.useEffect(()=>{let e=!1;if(K&&!String(j||"").trim()&&N){if("string"!=typeof N||!N.startsWith("data:"))return(async()=>{try{const n="string"==typeof(t=N)?(new TextEncoder).encode(t):t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):(new TextEncoder).encode(String(t??"")),r=await ub(n);if(e)return;Y(r?.length??null)}catch(n){if(e)return;Y(null)}var t})(),()=>{e=!0};Y(null)}else Y(null)},[K,j,N]),rt.useEffect(()=>{J.current=G},[G]),rt.useEffect(()=>{Yt()},[N,k,re,p,h,zt,te,j,K,G,O,F,U,$,W,Q,D]),rt.useEffect(()=>{h?"reinscription"!==s&&l("reinscription"):p.length>1?"multi-parent"!==s&&l("multi-parent"):1===p.length?"parent-child"!==s&&l("parent-child"):0===p.length&&"standard"!==s&&l("standard")},[p.length,h]);const Kt=e=>{const t=null==e?"":String(e).trim(),n=Number(t);return!Number.isFinite(n)||n<=0?o:Math.max(o,n)},Xt=e=>{if(null==e||""===String(e).trim())return void ie(null);const t=Number(e);Number.isFinite(t)&&ie(Math.max(o,t))},Gt=e=>ob(e,Kt(re)),Yt=()=>{const t=zt&&zt.length>0;if(t||N&&0!==N.length)try{if(t){const e=Gt(zt);return void fe(e)}let n=null;if(h){const e=String(h).split(",").filter(Boolean);n=e[e.length-1]||null}const r={content:N,contentType:k,contentSize:K&&!String(j||"").trim()&&Number.isFinite(G)?G:_,recipientAddress:Q||e?.ordinalsAddress||e?.address,parentIds:p.map(e=>e.id),reinscriptionTargetId:n,mode:"standard",delegateId:O,metaprotocol:F,metadata:U,properties:$,customTags:D,contentEncoding:j,pointer:W,postage:546},i=n?1:Math.max(1,Math.min(200,parseInt(te,10)||1)),a=Array.from({length:i},()=>({...r}));fe(Gt(a))}catch(uC){fe(null)}else fe(null)},Jt=async(t=null)=>{const r=zt&&zt.length>0;let a=null;if(r){const e=zt.filter(e=>{const t=!!String(e?.contentType||"").trim(),n=Qt(e?.content),r=Zt(e);return!t||!n&&!r});if(e.length>0)return void ge({type:"error",message:`${e.length} item(s) missing contentType or (content/tags)`})}else{const e=!!String(k||"").trim(),t=Qt(N),n=Zt({delegateId:O,metaprotocol:F,metadata:U,properties:$,selectedParents:p,reinscriptionTarget:h,pointer:W});if(!e||!t&&!n)return void ge({type:"error",message:"Please add content, or set delegate/metadata/properties/parents/reinscription."})}if(!e?.isConnected)return void ge({type:"error",message:"No wallet connected"});if(!ce||0===ce.length)return void ge({type:"error",message:"\u26a0\ufe0f Please select payment UTXOs in the UTXOs tab before proceeding"});if(!r&&K&&!String(j||"").trim()&&N&&("string"!=typeof N||!N.startsWith("data:"))&&!Number.isFinite(J.current)){const e=Date.now(),t=4e3;for(ge({type:"info",message:"\ud83e\uddf1 Compressing (Brotli)\u2026"});!Number.isFinite(J.current)&&Date.now()-e<t;)await new Promise(e=>setTimeout(e,50))}const o=ce.reduce((e,t)=>e+t.value,0);let s=de;if(!r){const t=K&&!String(j||"").trim()&&Number.isFinite(J.current)?J.current:_;let n=null;if(h){const e=h.split(",").filter(Boolean);n=e[e.length-1]||null}const r={content:N,contentType:k,contentSize:t,recipientAddress:Q||e?.ordinalsAddress||e?.address,parentIds:p.map(e=>e.id),parentIdsForEnvelope:p.filter(e=>!e?.omitParentTag).map(e=>e.id),reinscriptionTargetId:n,mode:"standard",delegateId:O,metaprotocol:F,metadata:U,properties:$,customTags:D,contentEncoding:j,pointer:W},i=n?1:Math.max(1,Math.min(200,parseInt(te,10)||1));s=Gt(Array.from({length:i},()=>({...r})))}if(s&&o<s.totalRequired)ge({type:"error",message:`\u274c Insufficient funds: need ${s.totalRequired} sats, have ${o} sats`});else{"undefined"!=typeof window&&(window.__nexusGlobalLoading="inscribing"),me(!0),ge(null);try{const o=async t=>{ge({type:"info",message:`\ud83d\udce6 Preparing batch of ${t.length} items...`});const{createInscriptionScript:r}=await n(async()=>{const{createInscriptionScript:e}=await Promise.resolve().then(()=>Wh);return{createInscriptionScript:e}},__VITE_PRELOAD__),a=new Set;t.forEach(e=>{e.parentIds&&Array.isArray(e.parentIds)&&e.parentIds.forEach(e=>a.add(e))});let o=0;const s=new Map;a.size>0&&(o=(await Promise.all(Array.from(a).map(async e=>{try{const t=await Ih(e,{walletInscriptions:c});return s.set(e,t),t}catch(uC){const n=uC&&uC.message?uC.message:String(uC);throw new Error(`Cannot fetch exact parent UTXO value for ${e}. Refusing to assume 546 sats because that can misplace pointers/inscriptions. Error: ${n}`)}}))).reduce((e,t)=>e+t,0));const l=t.filter(e=>!!e.reinscriptionTargetId),u=new Map;if(l.length>0){const e=Array.from(new Set(l.map(e=>e.reinscriptionTargetId).filter(Boolean)));await Promise.all(e.map(async e=>{try{const t=await Ih(e,{walletInscriptions:c});u.set(e,t)}catch(uC){const n=uC&&uC.message?uC.message:String(uC);throw new Error(`Cannot fetch exact reinscription target UTXO value for ${e}. Refusing to assume 546 sats because that can misplace pointers/inscriptions. Error: ${n}`)}}))}const d=new Array(t.length).fill(0),f=[],p=[];for(let e=0;e<t.length;e++)t[e]?.reinscriptionTargetId?f.push(e):p.push(e);let m=0;for(const e of f){const n=t[e]?.reinscriptionTargetId,r=u.get(n),i="number"==typeof r&&Number.isFinite(r)&&r>0?r:546;d[e]=m,m+=i}const h=m+o;let g=0;for(const e of p){d[e]=h+g;const n=Number(t[e]?.postage);g+=Number.isFinite(n)&&n>0?Math.floor(n):546}t.length;const b=e=>e&&"string"==typeof e?e.split(":")[0].trim():e;let w=await Promise.all(t.map(async(t,n)=>{en(t,`Item #${n+1}: `);const i=d[n]||0;let a,o;if(t.metadata)try{a=JSON.parse(t.metadata)}catch(cC){throw new Error(`Item #${n+1}: Invalid metadata JSON`)}if(t.properties)try{o=JSON.parse(t.properties)}catch(cC){throw new Error(`Item #${n+1}: Invalid properties JSON`)}let s,l,u=(t.contentEncoding||"").trim();if(u&&new Set(["br","gzip","deflate","identity"]).has(u),!u&&t&&t.compressBeforeInscribe)try{if("string"==typeof t.content&&t.content.startsWith("data:"))throw new Error("Cannot Brotli-compress a data: URL string; use binary content instead");const e="string"==typeof(f=t.content)?(new TextEncoder).encode(f):f instanceof Uint8Array?f:f instanceof ArrayBuffer?new Uint8Array(f):"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(f)?new Uint8Array(f.buffer,f.byteOffset,f.byteLength):(new TextEncoder).encode(String(f??"")),n=await ub(e);t={...t,content:n,contentSize:n.length,contentEncoding:"br"},u="br"}catch(cC){}var f;if(t.reinscriptionTargetId){let e,r=t.reinscriptionTargetData;if(r||(r=c.find(e=>e.id===t.reinscriptionTargetId)),r||(r=c.find(e=>e.sameSatIds&&e.sameSatIds.includes(t.reinscriptionTargetId))),!r)throw new Error(`Item #${n+1}: Reinscription target ${t.reinscriptionTargetId} not found in wallet or same-sat chains. Please refresh your inscriptions list.`);if(r.sameSatIds&&r.sameSatIds.length>1){const e=r.sameSatIds[0];if(t.reinscriptionTargetId!==e){const t=c.find(t=>t.id===e);t&&(r=t)}}if(null!==r.utxo?.offset&&void 0!==r.utxo?.offset){const t=r.utxo.offset,n=r.utxo.value;t>=0&&(!n||t<n)&&(e=t,l=t)}if(void 0===l&&r.satpoint){const e=String(r.satpoint).split(":");if(e.length>=3){const t=Number(e[2]);Number.isFinite(t)&&t>=0&&(l=t)}}}let p=t.pointer;const m=null!=p&&String(p).length>0,h=!!t.reinscriptionTargetId;if(h&&!m){const e=null!=l?Number(l):0,t=i+(Number.isFinite(e)&&e>0?Math.floor(e):0);t>0&&(p=t)}if(h||m||i>0&&(p=i),t.reinscriptionTargetId&&null!=p&&String(p).length>0){const e=parseInt(p);if(!isNaN(e)&&e<0)throw new Error(`Item #${n+1}: Pointer cannot be negative (${e})`)}const g=t.parentIdsForEnvelope&&Array.isArray(t.parentIdsForEnvelope)?t.parentIdsForEnvelope:t.parentIds,w=r({content:t.content,contentType:t.contentType,parentIds:g&&g.length>0?g.map(b):void 0,delegateId:t.delegateId?b(t.delegateId):void 0,metaprotocol:t.metaprotocol||void 0,pointer:null!=p&&String(p).length>0?parseInt(p):void 0,metadata:a,properties:o,customTags:void 0,contentEncoding:u||void 0});try{import.meta,g&&g.length&&g.length}catch(I){}if(t.reinscriptionTargetId){let e,r,a,o,l,u,d=t.reinscriptionTargetData;if(d||(d=c.find(e=>e.id===t.reinscriptionTargetId)),!d&&(d=c.find(e=>e.sameSatIds&&e.sameSatIds.includes(t.reinscriptionTargetId)),!d))throw new Error(`Item #${n+1}: Reinscription target ${t.reinscriptionTargetId} not found in wallet or same-sat chains. Please refresh your inscriptions list.`);if(d.sameSatIds&&d.sameSatIds.length>1){const e=d.sameSatIds[0];if(t.reinscriptionTargetId!==e){const t=c.find(t=>t.id===e);if(!t)throw new Error(`Item #${n+1}: Latest inscription ${e} in same-sat chain not found in wallet. Please refresh your inscriptions list.`);d=t}}if(!d.utxo&&!d.satpoint)throw new Error(`Item #${n+1}: Reinscription target ${t.reinscriptionTargetId} is missing UTXO data. Please refresh your inscriptions list to fetch complete data.`);if(d.utxo&&(e=d.utxo.txid,r=d.utxo.vout,a=d.utxo.value,o=d.utxo.address,l=d.utxo.scriptHex||d.utxo.script,null!==d.utxo.offset&&void 0!==d.utxo.offset)){const e=d.utxo.offset;e>=0&&(!a||e<a)&&(u=e)}if((!e||void 0===r)&&d.satpoint){const t=String(d.satpoint).split(":");if(t.length>=2&&(e=t[0],r=parseInt(t[1]),t.length>=3)){const e=Number(t[2]);Number.isFinite(e)&&e>=0&&(u=e)}}if(o||(o=d.address),!e||void 0===r)throw new Error(`Item #${n+1}: Cannot extract UTXO location (txid/vout) for reinscription target ${t.reinscriptionTargetId}. This inscription may not be fully indexed yet. Please wait a few minutes and refresh.`);if(!o)throw new Error(`Item #${n+1}: Cannot extract address for reinscription target ${t.reinscriptionTargetId}. This inscription may not be fully indexed yet. Please wait and refresh.`);const f=[d.utxo?.value,d.value,d.output_value,d.outputValue].filter(e=>"number"==typeof e&&Number.isFinite(e)&&e>0);if(0===f.length)throw new Error(`Item #${n+1}: Reinscription target ${t.reinscriptionTargetId} missing spendable value. Refresh inscriptions list.`);const m=f[0];if(null!=p&&""!==p){const e=parseInt(p),t=i||0,r=t+m;if(!isNaN(e)&&(e<t||e>=r))throw new Error(`Item #${n+1}: CRITICAL SAT ALIGNMENT ERROR\n   Pointer: ${e}\n   Output start: ${t}\n   Target UTXO value: ${m} sats\n   Pointer must satisfy: ${t} \u2264 pointer < ${r}\n   \n   Why this matters:\n   - Commit output contains ${m} sats from target + reveal fee from payment\n   - Pointer outside the reinscription output selects the wrong sat stream\n   - This would inscribe the wrong sat (not the reinscription target sat)\n   \n   Fix: Leave pointer blank (auto) or set a pointer within that output's range`)}null!=u&&(u<0||u>=m)&&(u=0),s={txid:e,vout:r,value:m,address:o,inscriptionId:t.reinscriptionTargetId,...void 0!==u?{offset:u}:{}},l&&(s.scriptHex=l)}let x;if(t.parentIds&&t.parentIds.length>0&&(x=t.parentIds.map(e=>{let t,r,i,a,o=c.find(t=>t.id===e);if(!o&&(o=c.find(t=>t.sameSatIds&&t.sameSatIds.includes(e)),!o))throw new Error(`Item #${n+1}: Parent inscription ${e} not found in wallet or same-sat chains`);if(o.sameSatIds&&o.sameSatIds.length>1){const t=o.sameSatIds[0],n=c.find(e=>e.id===t);n&&n.id!==e&&(o={...n,id:e,originalParentId:e,effectiveParentId:t})}let s=null;if(o.utxo&&(t=o.utxo.txid,r=o.utxo.vout,s=o.utxo.value,i=o.utxo.address,a=o.utxo.scriptHex||o.utxo.script),(!t||void 0===r)&&o.satpoint){const e=o.satpoint.split(":");e.length>=2&&(t=e[0],r=parseInt(e[1]))}if(i||(i=o.address),t&&"number"==typeof r){const e=((e,t)=>{const n=y,r=[];Array.isArray(n)?r.push(n):n&&"object"==typeof n&&(Array.isArray(n.unsafe)&&r.push(n.unsafe),Array.isArray(n.spendable)&&r.push(n.spendable),Array.isArray(n.utxos)&&r.push(n.utxos));for(const i of r){const n=(i||[]).find(n=>n&&n.txid===e&&n.vout===t);if(n)return n}return null})(t,r);e&&(!i&&e.address&&(i=e.address),a||!e.scriptHex&&!e.script||(a=e.scriptHex||e.script),"number"==typeof e.value&&Number.isFinite(e.value)&&e.value>0&&("number"==typeof s&&Number.isFinite(s)&&s>0&&e.value,s=e.value))}if(!t||void 0===r)throw new Error(`Item #${n+1}: Parent ${e} missing txid/vout. Has satpoint: ${!!o.satpoint}, has utxo: ${!!o.utxo}`);if(!i)throw new Error(`Item #${n+1}: Parent ${e} missing address. This inscription may need to be refetched.`);if("number"!=typeof s||!Number.isFinite(s)||s<=0)throw new Error(`Item #${n+1}: Parent ${e} missing UTXO value for ${t}:${r}. Cannot sign parent input without the exact previous output amount.`);const l={txid:t,vout:r,value:Math.ceil(s),address:i};return a&&(l.scriptHex=a),l}),s)){const e=`${s.txid}:${s.vout}`;x=x.filter(t=>`${t.txid}:${t.vout}`!==e)}const v=w.length/2,S=e.ordinalsAddress||e.address;if(s&&!S)throw new Error(`Item #${n+1}: Cannot process reinscription - wallet address is missing. Please ensure your wallet is properly connected.`);const E=s?S:t.recipientAddress||S;if(s&&!s.address)throw new Error(`Item #${n+1}: Reinscription target missing address field.`);if(!E||"null"===E||"undefined"===E)throw new Error(`Item #${n+1}: Invalid recipient address "${E}". WalletState: ordinals=${e.ordinalsAddress}, address=${e.address}`);return{...t,inscriptionScript:w,scriptSizeBytes:v,recipientAddress:E,postage:s?0:t.postage||546,parentUtxos:x&&x.length>0?x:void 0,reinscriptionUtxo:s}}));const x=new Set((w||[]).filter(e=>e?.reinscriptionUtxo&&e.reinscriptionUtxo.txid&&"number"==typeof e.reinscriptionUtxo.vout).map(e=>`${e.reinscriptionUtxo.txid}:${e.reinscriptionUtxo.vout}`));if(x.size>0){w=(w||[]).map((e,t)=>{const n=Array.isArray(e?.parentUtxos)?e.parentUtxos:[];if(0===n.length)return e;n.length;const r=[],i=n.filter(e=>{if(!e||!e.txid||"number"!=typeof e.vout)return!1;const t=`${e.txid}:${e.vout}`,n=x.has(t);return n&&r.push(t),!n});return i.length,{...e,parentUtxos:i.length>0?i:void 0}});try{(w||[]).forEach((e,t)=>{Array.isArray(e?.parentIds)&&e.parentIds.length,Array.isArray(e?.parentUtxos)&&e.parentUtxos.length})}catch(B){}}if(w&&w.length>0){const e=new Map,t=[];if(w.forEach((n,r)=>{const i=n&&n.reinscriptionUtxo;if(!i||void 0===i.txid||void 0===i.vout)return;const a=`${i.txid}:${i.vout}`;e.has(a)?t.push({key:a,first:e.get(a),second:r}):e.set(a,r)}),t.length>0){const e=t[0],n=e=>`#${e+1}`;return void ge({type:"error",message:`This reinscription target is already used in batch item ${n(e.first)} and can only be reinscribed once per batch. You can still use it as a parent in other items.`})}}ge({type:"info",message:"\ud83d\udd28 Building batch PSBTs..."});let v=ce;if(e?.ordinalsAddress){const t=e.ordinalsAddress;v=v.filter(e=>e.address!==t)}if(0===v.length)throw new Error("No valid payment UTXOs available after filtering");const S=e.network?.toLowerCase?.()||"mainnet",E=e.paymentAddress||e.address;let I;if(1===t.length){const e=t[0],n=(e=>{if("number"==typeof e.contentSize)return e.contentSize;const t=e.content;if("string"==typeof t)try{return new Blob([t]).size}catch{return t.length}if(t&&"object"==typeof t){if(t.byteLength)return t.byteLength;if(t.length)return t.length}return 0})(e),r=!!e.reinscriptionTargetId||!!e.reinscriptionUtxo;I=Cg(n,Kt(re),e.parentIds?.length||0,{postage:r?0:e.postage||546,isReinscription:r,hasMetadata:!!e.metadata,hasMetaprotocol:!!e.metaprotocol,hasPointer:!!e.pointer,hasDelegate:!!e.delegateId})}else{const e=ob(w,Kt(re));e&&(I={commitFee:e.commitFee,revealFee:e.revealFee,postage:e.postage,totalRequired:e.totalRequired})}const k=[...v],A=w.filter(e=>e.reinscriptionUtxo).map(e=>e.reinscriptionUtxo),N=new Set(A.map(e=>`${e.txid}:${e.vout}`));if(k.filter(e=>N.has(`${e.txid}:${e.vout}`)).length>0)return void ge({type:"error",message:"Selected payment UTXOs include reinscription targets. Deselect those UTXOs and try again."});let T=e.paymentPublicKey,_=e.ordinalsPublicKey;if(!T)try{const e=window.NexusWalletConnect;if(e?.getAccounts){const t=await e.getAccounts(),n=t.find(e=>"payment"===e.purpose),r=t.find(e=>"ordinals"===e.purpose);T=n?.publicKey,_=r?.publicKey,T?.startsWith("0x")&&(T=T.slice(2)),_?.startsWith("0x")&&(_=_.slice(2))}else if(e?.getPublicKey){let t=await e.getPublicKey();t?.startsWith("0x")&&(t=t.slice(2)),T=t,_=t}}catch(uC){}try{if(w.filter(e=>e.reinscriptionUtxo&&!Number.isInteger(e.reinscriptionUtxo.value)).length>0)return void ge({type:"error",message:"Invalid reinscription UTXO value. Refresh UTXOs and try again."});w.forEach(e=>{e.reinscriptionUtxo&&Number.isInteger(e.reinscriptionUtxo.value)&&(e.expectedRevealOutputValue=e.reinscriptionUtxo.value)})}catch(B){}const P=await async function(e){const{wallet:t,network:n="mainnet",strictUtxoValidation:r=!0}=e||{};if(!t)throw new Error("Wallet is required");const i=await gg(),a=cg(i,n),o=Number(e?.feeRate||0);let s={...e};try{if(r){if(Array.isArray(e.paymentUtxos)&&e.paymentUtxos.length>0){const{unspent:t,spent:n}=await async function(e){const t=[],n=[];for(let r=0;r<e.length;r++){const i=e[r];await Qg(i.txid,i.vout)?t.push(i):n.push(i),r<e.length-1&&await new Promise(e=>setTimeout(e,50))}return n.length>0&&n.forEach(e=>{}),{unspent:t,spent:n}}(e.paymentUtxos);n.length,s.paymentUtxos=t}if(Array.isArray(e.items)&&e.items.some(e=>e?.reinscriptionUtxo)){const{valid:t,invalid:n}=await async function(e){const t=e.filter(e=>e.reinscriptionUtxo).map(e=>({item:e,txid:e.reinscriptionUtxo.txid,vout:e.reinscriptionUtxo.vout}));if(0===t.length)return{valid:e,invalid:[]};const n=[],r=[];for(const a of t)await Qg(a.txid,a.vout)?n.push(a.item):r.push(a.item),await new Promise(e=>setTimeout(e,50));const i=e.filter(e=>!e.reinscriptionUtxo);return n.push(...i),r.length,{valid:n,invalid:r}}(e.items);if(n.length>0){const e=n.map(e=>`${e?.reinscriptionUtxo?.txid?.substring(0,12)}:${e?.reinscriptionUtxo?.vout}`).join(", "),t=new Error(`One or more reinscription targets are already spent: ${e}`);throw t.code="REINSCRIPTION_TARGET_SPENT",t}}}}catch(S){throw S}const l=await async function(e){const{wallet:t,paymentUtxos:n,items:r,changeAddress:i,network:a="mainnet",fees:o,feeRate:s,paymentPublicKey:l=null,ordinalsPublicKey:c=null,batchLimits:u={maxInputs:40,maxVsize:85e3},strictReinscriptionFunding:d=!0}=e||{};if(!t)throw new Error("Wallet is required");if(!Array.isArray(r)||0===r.length)throw new Error("At least one item is required");if(!Array.isArray(n)||0===n.length)throw new Error("Payment UTXOs required");const f=await gg(),p=cg(f,a),m=function(e){const t=["commitFee","revealFee","postage","totalRequired"];if(!e||"object"!=typeof e)throw new Error("Fees object is required");for(const n of t)if("number"!=typeof e[n])throw new Error(`Missing or invalid required fee field: ${n}`);if(void 0!==e.platformFee){if("number"!=typeof e.platformFee||e.platformFee<0)throw new Error("platformFee must be a non-negative number");e.platformFee>0&&!e.platformFeeAddress&&Vh.warn("\u26a0\ufe0f platformFee provided but no platformFeeAddress specified")}return e}(o),{normalizedItems:h,sharedOutputItems:g}=function(e,t,n){if(n=n||{},!Array.isArray(e)||0===e.length)throw new Error("At least one item is required");const r=e.map(e=>{const t=e.mode||"standard",n=e.satpoint&&e.satpoint.txid&&void 0!==e.satpoint.vout?{txid:e.satpoint.txid,vout:e.satpoint.vout,offset:Number(e.satpoint.offset||0)}:null,r=e.sharedGroupId||null;return{...e,mode:t,satpoint:n,sharedGroupId:r}});r.forEach((e,t)=>{const n=!(!e.satpoint||!e.satpoint.txid||void 0===e.satpoint.vout),i=e.mode||"";if(n&&"same-sat"!==i){const e=new Error(`SATPOINT_INVALID_MODE: item #${t} provided satpoint but mode is '${i||"unset"}'. satpoint is only valid in 'same-sat' mode.`);throw e.code="SATPOINT_INVALID_MODE",e}if("same-sat"===i){if(r.length>1){const e=new Error(`SAME_SAT_BATCH_UNSUPPORTED: item #${t} in 'same-sat' mode cannot be batched. Use a single-item flow.`);throw e.code="SAME_SAT_BATCH_UNSUPPORTED",e}if(!n){const e=new Error(`SAME_SAT_MISSING_SATPOINT: item #${t} in 'same-sat' mode must include satpoint {txid,vout,offset}`);throw e.code="SAME_SAT_MISSING_SATPOINT",e}if(e.parentUtxo||e.parentUtxos&&e.parentUtxos.length>0){const e=new Error(`SAME_SAT_DISALLOWED_PARENTS: item #${t} cannot use parents in 'same-sat' mode.`);throw e.code="SAME_SAT_DISALLOWED_PARENTS",e}if(e.delegateId){const e=new Error(`SAME_SAT_DISALLOWED_DELEGATION: item #${t} cannot use delegation in 'same-sat' mode.`);throw e.code="SAME_SAT_DISALLOWED_DELEGATION",e}if(!e.reinscriptionUtxo||!e.reinscriptionUtxo.txid||void 0===e.reinscriptionUtxo.vout){const e=new Error(`SAME_SAT_REQUIRES_TARGET: item #${t} must include reinscriptionUtxo matching satpoint in 'same-sat' mode.`);throw e.code="SAME_SAT_REQUIRES_TARGET",e}if(e.satpoint.txid!==e.reinscriptionUtxo.txid||e.satpoint.vout!==e.reinscriptionUtxo.vout){const n=new Error(`SAME_SAT_MISMATCHED_TARGET: item #${t} satpoint ${e.satpoint.txid}:${e.satpoint.vout} does not match reinscriptionUtxo ${e.reinscriptionUtxo.txid}:${e.reinscriptionUtxo.vout}`);throw n.code="SAME_SAT_MISMATCHED_TARGET",n}const i=Number(e.satpoint.offset||0),a=Number(e.reinscriptionUtxo.value||0);if(!Number.isFinite(i)||i<0){const e=new Error(`SAME_SAT_OFFSET_INVALID: item #${t} satpoint.offset must be >= 0`);throw e.code="SAME_SAT_OFFSET_INVALID",e}if(a<=0){const e=new Error(`SAME_SAT_TARGET_VALUE_MISSING: item #${t} reinscriptionUtxo missing value for satpoint validation`);throw e.code="SAME_SAT_TARGET_VALUE_MISSING",e}if(i>=a){const e=new Error(`SAME_SAT_OFFSET_OUT_OF_RANGE: item #${t} satpoint.offset=${i} >= targetValue=${a}`);throw e.code="SAME_SAT_OFFSET_OUT_OF_RANGE",e}}if("shared-output"===i){if(!e.sharedGroupId||0===String(e.sharedGroupId).trim().length){const e=new Error(`SHARED_OUTPUT_MISSING_GROUP: item #${t} in 'shared-output' mode requires non-empty sharedGroupId`);throw e.code="SHARED_OUTPUT_MISSING_GROUP",e}if(e.parentUtxo||e.parentUtxos&&e.parentUtxos.length>0){const e=new Error(`SHARED_OUTPUT_DISALLOWED_PARENTS: item #${t} cannot use parents in 'shared-output' mode.`);throw e.code="SHARED_OUTPUT_DISALLOWED_PARENTS",e}if(e.reinscriptionUtxo){const e=new Error(`SHARED_OUTPUT_DISALLOWED_REINSCRIPTION: item #${t} cannot be a reinscription in 'shared-output' mode.`);throw e.code="SHARED_OUTPUT_DISALLOWED_REINSCRIPTION",e}if(e.delegateId){const e=new Error(`SHARED_OUTPUT_DISALLOWED_DELEGATION: item #${t} cannot use delegation in 'shared-output' mode.`);throw e.code="SHARED_OUTPUT_DISALLOWED_DELEGATION",e}const n=new Error(`SHARED_OUTPUT_NOT_IMPLEMENTED: item #${t} requested shared-output mode; this mode is not available in batch builder`);throw n.code="SHARED_OUTPUT_NOT_IMPLEMENTED",n}if("same-sat"!==e.mode&&e.satpoint){const e=new Error(`SATPOINT_REUSED_BY_STANDARD_ITEM: item #${t} provided satpoint but is not in 'same-sat' mode.`);throw e.code="SATPOINT_REUSED_BY_STANDARD_ITEM",e}if(void 0!==e.pointer&&null!==e.pointer&&String(e.pointer).length>0){const n="number"==typeof e.pointer?e.pointer:Number(String(e.pointer).trim());if(!Number.isInteger(n)||n<0){const e=new Error(`POINTER_INVALID: item #${t} pointer must be a non-negative integer`);throw e.code="POINTER_INVALID",e}if(e.reinscriptionUtxo&&void 0!==e.reinscriptionUtxo.txid){const r=Number(e.reinscriptionUtxo.value||0);if(Number.isFinite(r)&&r>0&&n>=r){const e=new Error(`POINTER_OUT_OF_RANGE: item #${t} pointer (${n}) must be < reinscription target value (${r})`);throw e.code="POINTER_OUT_OF_RANGE",e}}}});const i=new Map;r.forEach((e,t)=>{if(!e.reinscriptionUtxo||void 0===e.reinscriptionUtxo.txid)return;const n=`${e.reinscriptionUtxo.txid}:${e.reinscriptionUtxo.vout}`;if(i.has(n)){const e=i.get(n),r=new Error(`Duplicate reinscription targets: item #${t} shares reinscription target ${n} already used by item #${e}`);throw r.code="REINSCRIPTION_TARGET_REUSED",r}i.set(n,t)}),r.forEach((e,t)=>{if(!e.reinscriptionUtxo||void 0===e.reinscriptionUtxo.txid)return;const n=`${e.reinscriptionUtxo.txid}:${e.reinscriptionUtxo.vout}`;if((Array.isArray(e.parentUtxos)?e.parentUtxos:e.parentUtxo?[e.parentUtxo]:[]).some(e=>`${e.txid}:${e.vout}`===n)){const e=new Error(`REINSCRIPTION_TARGET_AS_PARENT: item #${t} lists reinscription target ${n} as a parent. Use a different parent UTXO or drop the parent reference.`);throw e.code="REINSCRIPTION_TARGET_AS_PARENT",e}});const a=r.map((e,r)=>{const i=Math.ceil((e.inscriptionScript?.length||0)/2),a=Array.isArray(e.parentUtxos)?e.parentUtxos.length:e.parentUtxo?1:0,o=!!e.reinscriptionUtxo,s=Math.max(330,e.postage??n.postage??546),l=e=>{try{return(new TextEncoder).encode(e).length}catch{return Buffer.from(e,"utf8").length}},c="string"==typeof e.metadata?e.metadata:e.metadata?JSON.stringify(e.metadata):"",u="string"==typeof e.properties?e.properties:e.properties?JSON.stringify(e.properties):"",d=!!c&&c.trim().length>0,f=!!u&&u.trim().length>0,p=d?l(c):0,m=f?l(u):0,h=void 0!==e.pointer&&String(e.pointer).length>0,g=!!e.contentEncoding,y=new Set([0,1,2,3,5,7,9,11,17]),b=Array.isArray(e.customTags)?e.customTags.length:e.customTags&&"object"==typeof e.customTags?Object.keys(e.customTags).filter(e=>{const t=Number(e);return Number.isInteger(t)&&t>=0&&t<=255&&!y.has(t)}).length:Array.isArray(e.tags)?e.tags.length:0,w=e.commitFeeRateOverride,x=Cg(i,t,a,{scriptSizeExact:i,hasMetadata:d,metadataSize:p,hasProperties:f,propertiesSize:m,hasPointer:h,hasContentEncoding:g,customTagCount:b,commitFeeRate:w,postage:o?0:s,isReinscription:o}),v=void 0!==e.revealFundingValue&&null!==e.revealFundingValue&&e.revealFundingValue>0,S=o?x.revealFee:v?Number(e.revealFundingValue):x.revealFunding;if(o){const t=Math.ceil(x.revealFee),n=Math.ceil(e.revealFundingValue??x.revealFunding);n>t+100&&(Vh.warn(`\u26a0\ufe0f Item ${r}: Reinscription funding seems too high (${n} sats)`),Vh.warn(`   Expected ~${t} sats (reveal fee only)`),Vh.warn(`   Postage (${e.reinscriptionUtxo.value} sats) comes from target UTXO`))}return{...e,revealFundingValue:S,itemFeeDetail:{scriptSize:i,parentCount:a,isReinscription:o,revealFee:x.revealFee,revealFunding:x.revealFunding,hasMetadata:d,metadataSize:p,hasProperties:f,propertiesSize:m,hasPointer:h,hasContentEncoding:g,customTagCount:b},recipientAddress:e.recipientAddress||e.defaultRecipient,postage:s,__index:r}}),o=a.filter(e=>"shared-output"===e.mode);return{normalizedItems:a,sharedOutputItems:o}}(r,s,m),y=Ug(r.length,r),b=Mg(r.length,r);y.length>0&&(m.platformFee=b,m.platformFeeAddress=y[0].address,m.platformFeeOutputs=y);const w=[];for(let ae=0;ae<h.length;ae++){const e=h[ae],t="undefined"!=typeof globalThis&&globalThis.__TEST_OVERRIDE_BUILD_TAPROOT_ARTIFACTS__?globalThis.__TEST_OVERRIDE_BUILD_TAPROOT_ARTIFACTS__:Sg,n=await t(f,e.inscriptionScript,p),r=Math.ceil((e.inscriptionScript?.length||0)/2),i=Array.isArray(e.parentUtxos)?e.parentUtxos.length:e.parentUtxo?1:0,a=!!e.reinscriptionUtxo,o=e.postage??m.postage??546,l=e=>{try{return(new TextEncoder).encode(e).length}catch{return Buffer.from(e,"utf8").length}},c="string"==typeof e.metadata?e.metadata:e.metadata?JSON.stringify(e.metadata):"",u="string"==typeof e.properties?e.properties:e.properties?JSON.stringify(e.properties):"",d=!!c&&c.trim().length>0,g=!!u&&u.trim().length>0,y=d?l(c):0,b=g?l(u):0,x=void 0!==e.pointer&&String(e.pointer).length>0,v=!!e.contentEncoding,S=new Set([0,1,2,3,5,7,9,11,17]),E=(()=>Array.isArray(e.customTags)?e.customTags.length:e.customTags&&"object"==typeof e.customTags?Object.keys(e.customTags).filter(e=>{const t=Number(e);return Number.isInteger(t)&&t>=0&&t<=255&&!S.has(t)}).length:Array.isArray(e.tags)?e.tags.length:0)(),I=e.commitFeeRateOverride,k=Cg(r,s,i,{scriptSizeExact:r,hasMetadata:d,metadataSize:y,hasProperties:g,propertiesSize:b,hasPointer:x,hasContentEncoding:v,customTagCount:E,commitFeeRate:I,postage:a?0:o,isReinscription:a}),A=void 0!==e.revealFundingValue&&null!==e.revealFundingValue&&e.revealFundingValue>0,N=a?k.revealFee:A?Number(e.revealFundingValue):k.revealFunding;if(w.push({...e,...n,revealFundingValue:N,itemFeeDetail:{scriptSize:r,parentCount:i,isReinscription:a,revealFee:k.revealFee,revealFunding:k.revealFunding,hasMetadata:d,metadataSize:y,hasProperties:g,propertiesSize:b,hasPointer:x,hasContentEncoding:v,customTagCount:E},recipientAddress:e.recipientAddress&&e.recipientAddress.trim()?e.recipientAddress.trim():e.defaultRecipient||n.taprootPayment.address,postage:o,__index:ae}),a){const t=Math.ceil(k.revealFee),n=Math.ceil(e.revealFundingValue??k.revealFunding);n>t+100&&(Vh.warn(`\u26a0\ufe0f Item ${ae}: Reinscription funding seems too high (${n} sats)`),Vh.warn(`   Expected ~${t} sats (reveal fee only)`),Vh.warn(`   Postage (${e.reinscriptionUtxo.value} sats) comes from target UTXO`))}}const x=w.filter(e=>!!e.reinscriptionUtxo),v=w.filter(e=>!e.reinscriptionUtxo),S=x;Vh.debug("\ud83d\udd0d DEBUG reinItemsOrdered:",{count:S.length,items:S.map(e=>({index:e.__index,targetTxid:e.reinscriptionUtxo?.txid?.substring(0,12),targetVout:e.reinscriptionUtxo?.vout,targetValue:e.reinscriptionUtxo?.value,hasUtxo:!!e.reinscriptionUtxo}))});const E=new Map;if(g.length>0){const e=new Map(w.map(e=>[e.__index,e]));for(const n of h){if("shared-output"!==n.mode)continue;const t=e.get(n.__index);E.has(n.sharedGroupId)||E.set(n.sharedGroupId,{items:[],pseudo:null}),E.get(n.sharedGroupId).items.push(t)}const t="undefined"!=typeof globalThis&&globalThis.__TEST_OVERRIDE_BUILD_SHARED_TAPROOT_ARTIFACTS__?globalThis.__TEST_OVERRIDE_BUILD_SHARED_TAPROOT_ARTIFACTS__:Ig;for(const[n,r]of E.entries()){r.items.sort((e,t)=>e.__index-t.__index);const e=r.items.map(e=>e.inscriptionScript),i=await t(f,e,p),a=r.items.reduce((e,t)=>e+Math.ceil(t.revealFundingValue),0);r.pseudo={mode:"shared-output",__sharedGroup:!0,__groupId:n,__groupItems:r.items,__index:r.items[0]?.__index??0,taprootPayment:i.taprootPayment,controlBlock:i.controlBlock,witnessScript:i.witnessScript,leafVersion:i.leafVersion,leafHash:i.leafHash,local:i.local,revealFundingValue:a,postage:0}}}const I=[],k=new Set;for(const ae of v)if("shared-output"===ae.mode){const e=ae.sharedGroupId;if(!k.has(e)){const t=E.get(e);t&&t.pseudo&&(I.push(t.pseudo),k.add(e))}}else I.push(ae);const A=[...S,...I],N=A.map(e=>e.__index),T=S.map(e=>`${e.reinscriptionUtxo.txid}:${e.reinscriptionUtxo.vout}`),_=[],P=A.filter(e=>"shared-output"===e.mode&&e.__sharedGroup),B=function(e){const t=[],n=[];return e.forEach((e,r)=>{const i=e.parentUtxo||e.parentUtxos&&e.parentUtxos.length>0,a=!!e.reinscriptionUtxo,o=!!e.delegateId,s=!!e.etching,l="same-sat"===e.mode;(i||a||o||s||l?n:t).push(e)}),{simple:t,complex:n}}(A.filter(e=>!("shared-output"===e.mode&&e.__sharedGroup))),C=B.simple,O=B.complex,L=O.filter(e=>!!e.reinscriptionUtxo),F=O.filter(e=>!e.reinscriptionUtxo);if(C.length>0){const e=function(e,t={maxInputs:40,maxVsize:85e3}){if(!e||0===e.length)return[];const n=[];let r=[],i=0;for(const a of e){const e=164+(66+(2+Math.ceil((a.inscriptionScript?.length||0)/2))+34)+172;Lg(r.length+1,i+e,t.maxInputs,4*t.maxVsize)&&r.length>0?(n.push(r),r=[a],i=40+e):(r.push(a),i+=e)}return r.length>0&&n.push(r),n}(C,u);for(const t of e)_.push({type:"simple-multi",items:t,parentInputCount:0})}if(L.length>0&&_.push({type:1===L.length?"reinscription-single":"reinscription-multi",items:L}),F.length>0){const e=function(e,t={maxInputs:40,maxVsize:85e3}){if(!e||0===e.length)return[];const n=function(e){const t=new Map;return e.forEach(e=>{const n=function(e){if(e.reinscriptionUtxo&&void 0!==e.reinscriptionUtxo.txid)return`REINSCRIPTION:${e.reinscriptionUtxo.txid}:${e.reinscriptionUtxo.vout}`;const t=Array.isArray(e.parentUtxos)?e.parentUtxos:e.parentUtxo?[e.parentUtxo]:[];return 0===t.length?"NO_PARENTS":t.map(e=>`${e.txid}:${e.vout}`).sort().join("|")}(e);t.has(n)||t.set(n,[]),t.get(n).push(e)}),Array.from(t.values())}(e),r=[];for(const i of n){const e=Og(i).length,n=402*e,a=40,o=172;let s=[],l=a+n;for(const c of i){const i=164+(66+(2+Math.ceil((c.inscriptionScript?.length||0)/2))+34)+o;c.reinscriptionUtxo?(s.length>0&&(r.push(s),s=[],l=a+n),r.push([c])):Lg(e+s.length+1,l+i,t.maxInputs,4*t.maxVsize)&&s.length>0?(r.push(s),s=[c],l=a+n+i):(s.push(c),l+=i)}s.length>0&&r.push(s)}return r}(F,u);for(const t of e)_.push({type:1===t.length?"complex-single":"complex-multi",items:t})}if(P.length>0)for(const ae of P)_.push({type:"shared-output",items:[ae],__sharedPseudo:ae,parentInputCount:0});0===_.length&&_.push({type:"multi-all",items:A});const R=e=>{const t=new Set;return(e||[]).forEach(e=>{(Array.isArray(e?.parentUtxos)?e.parentUtxos:[]).forEach(e=>{e&&e.txid&&"number"==typeof e.vout&&t.add(`${e.txid}:${e.vout}`)});const n=e?.parentUtxo;n&&n.txid&&"number"==typeof n.vout&&t.add(`${n.txid}:${n.vout}`)}),t},U=new Map,M=new Map,$=e=>{let t=M.get(e);if(void 0===t)return M.set(e,e),e;if(t===e)return e;const n=$(t);return M.set(e,n),n},H=(e,t)=>{const n=$(e),r=$(t);n!==r&&M.set(r,n)};for(let ae=0;ae<_.length;ae++){const e=R(_[ae].items);if(0!==e.size)for(const t of e)U.has(t)?H(ae,U.get(t)):U.set(t,ae)}const D=new Map;for(let ae=0;ae<_.length;ae++){if(!M.has(ae))continue;const e=$(ae),t=D.get(e)||[];t.push(ae),D.set(e,t)}let z=!1;for(const ae of D.values())if(ae.length>1){z=!0;break}if(z){const e=new Set,t=[];for(let n=0;n<_.length;n++){if(e.has(n))continue;if(!M.has(n)){t.push(_[n]),e.add(n);continue}const r=$(n),i=(D.get(r)||[]).slice().sort((e,t)=>e-t);if(i.forEach(t=>e.add(t)),1===i.length){t.push(_[n]);continue}const a=[];i.forEach(e=>{const t=_[e]?.items;Array.isArray(t)&&a.push(...t)});const o=a.some(e=>!!e?.reinscriptionUtxo)?1===a.filter(e=>!!e?.reinscriptionUtxo).length&&1===a.length?"reinscription-single":"reinscription-multi":1===a.length?"complex-single":"multi-all";Vh.warn(`\u26a0\ufe0f Merging ${i.length} reveal segments because they share at least one parent UTXO input.`),Vh.warn(`   Merged segment type: ${o} (items=${a.length})`),t.push({type:o,items:a})}_.length=0,t.forEach(e=>_.push(e))}const W=_.filter(e=>(e.items||[]).some(e=>!!e.reinscriptionUtxo));if(x.length>0&&1!==W.length){const e=new Error(`Reinscription fee-pool requires exactly 1 segment containing reinscriptions; found ${W.length}. Reduce batch size or increase batchLimits to avoid splitting reinscriptions.`);throw e.code="REINSCRIPTION_FEEPOOL_SPLIT_REQUIRED",e}_.forEach(e=>{if((e.items||[]).some(e=>!!e.reinscriptionUtxo)||!e.items||e.items.length<=1)return;const t=new Set;e.items.forEach(e=>{(Array.isArray(e.parentUtxos)?e.parentUtxos:[]).forEach(e=>{e&&e.txid&&"number"==typeof e.vout&&t.add(`${e.txid}:${e.vout}`)});const n=e.parentUtxo;n&&n.txid&&"number"==typeof n.vout&&t.add(`${n.txid}:${n.vout}`)});const n=t.size;if(0===n)return;if(n>=e.items.reduce((e,t)=>e+(Array.isArray(t.parentUtxos)?t.parentUtxos.length:0)+(t.parentUtxo?1:0),0))return;const r=Bg(e.items.map(e=>{const t=e?.itemFeeDetail?.scriptSize??e?.scriptSizeBytes??0;return Math.max(0,Math.floor(t))}),s,{parentCount:n,includeFeePoolInput:!1,parentInputType:"p2wpkh"}),i=e.items.reduce((e,t)=>e+(t.postage||546),0),a=Math.max(0,Math.ceil(r.fee)),o=e.items.map((t,n)=>{const r=t.postage||546,o=i>0?r/i:1/e.items.length,s=a*o,l=Math.floor(s);return{idx:n,itemPostage:r,floor:l,frac:s-l}});let l=a-o.reduce((e,t)=>e+t.floor,0);l<0&&(l=0),o.sort((e,t)=>{const n=t.frac-e.frac;return 0!==n?n:e.idx-t.idx}).forEach(e=>{l<=0||(e.floor+=1,l-=1)}),o.sort((e,t)=>e.idx-t.idx),o.forEach(t=>{const n=e.items[t.idx],r=t.floor;n.revealFundingValue=t.itemPostage+r,n.itemFeeDetail&&(n.itemFeeDetail.revealFee=r,n.itemFeeDetail.revealFunding=n.revealFundingValue,n.itemFeeDetail.adjustedForSharedParents=!0)}),Vh.info(`\u2705 Adjusted fees for segment with ${e.items.length} items sharing ${n} parents`),Vh.info(`   Batch reveal fee: ${a} sats (${r.vsize} vB @ ${s} sat/vB)`)});let V=0;if(x.length>0){const e=W[0],t=e&&Array.isArray(e.items)&&e.items.length>0?e.items:x,n=new Set(t.filter(e=>!!e.reinscriptionUtxo).map(e=>`${e.reinscriptionUtxo.txid}:${e.reinscriptionUtxo.vout}`)),r=new Set;t.forEach(e=>{(Array.isArray(e.parentUtxos)?e.parentUtxos:[]).forEach(e=>{if(!e||!e.txid||"number"!=typeof e.vout)return;const t=`${e.txid}:${e.vout}`;n.has(t)||r.add(t)})});const i=r.size,a=Bg(t.map(e=>{const t=e?.itemFeeDetail?.scriptSize??e?.scriptSizeBytes??0;return Math.max(0,Math.floor(t))}),s,{parentCount:i,includeFeePoolInput:!0,parentInputType:"p2wpkh"});V=Math.max(0,Math.ceil(a.fee||0)),V>0&&V<330&&(V=330),V>0&&t.forEach(e=>{if(!e||e.reinscriptionUtxo)return;const t=Math.ceil(e.postage??546);e.revealFundingValue=t,e.itemFeeDetail&&(e.itemFeeDetail.revealFee=0,e.itemFeeDetail.revealFunding=t,e.itemFeeDetail.fundedByFeePool=!0)})}const j="undefined"!=typeof globalThis&&globalThis.__TEST_OVERRIDE_BUILD_TAPROOT_FEEPOOL_ARTIFACTS__?globalThis.__TEST_OVERRIDE_BUILD_TAPROOT_FEEPOOL_ARTIFACTS__:Eg,q=V>0?{...await j(f,p),value:V,commitVoutIndex:A.length}:null;A.forEach((e,t)=>{e.commitVoutIndex=t}),function({bitcoinLib:e,net:t,commitOrderItems:n,feeRate:r}){const i=(n||[]).filter(e=>e&&e.nxsParcelManifestSelfHint&&!e.reinscriptionUtxo);0!==i.length&&i.forEach(n=>{const i=n.nxsParcelManifestSelfHint||{},a=String(i.indexingAddress||"").trim(),o=Math.ceil(Number(i.feeSats||0));if(!a)throw new Error("nxsParcelManifestSelfHint: indexingAddress is required");if(!Number.isFinite(o)||o<=0)throw new Error("nxsParcelManifestSelfHint: feeSats must be > 0");const s=function({bitcoinLib:e,net:t,indexingAddress:n}){const r=e.address.toOutputScript(String(n||"").trim(),t).length;return Zg(r)+Zg(17)}({bitcoinLib:e,net:t,indexingAddress:a}),l=Math.max(0,Math.ceil(Number(r||0)*s)),c=Math.ceil(n.revealFundingValue||0)+o+l;n.revealFundingValue=c,n.itemFeeDetail&&(n.itemFeeDetail.revealFee=Math.ceil((n.itemFeeDetail.revealFee||0)+l),n.itemFeeDetail.revealFunding=c,n.itemFeeDetail.nxsParcelManifestSelfHint={feeSats:o,extraVbytes:s,extraMinerFeeSats:l})})}({bitcoinLib:f,net:p,commitOrderItems:A,feeRate:s});const K=function(e,t,n,r,i,a,o,s=10,l=null){const c=new Map;r.forEach((e,t)=>{if(!e.reinscriptionUtxo||void 0===e.reinscriptionUtxo.txid)return;const n=`${e.reinscriptionUtxo.txid}:${e.reinscriptionUtxo.vout}`;if(c.has(n)){const e=c.get(n),r=new Error(`Duplicate reinscription targets: item #${t} shares reinscription target ${n} already used by item #${e}`);throw r.code="REINSCRIPTION_TARGET_REUSED_COMMIT",r}c.set(n,t)});const u=r.filter(e=>!e.reinscriptionUtxo).reduce((e,t)=>e+Math.ceil(t.revealFundingValue),0),d=l?Math.ceil(l.value||0):0,f=[],p=new Set;for(const G of r)if(G.reinscriptionUtxo&&void 0!==G.reinscriptionUtxo.txid){const e=`${G.reinscriptionUtxo.txid}:${G.reinscriptionUtxo.vout}`;p.has(e)||(p.add(e),f.push(G.reinscriptionUtxo))}const m=f.length,h=f.reduce((e,t)=>e+(t.value||0),0),g=r.filter(e=>!!e.reinscriptionUtxo).reduce((e,t)=>e+(t.reinscriptionUtxo?.value||0),0),y=new Map;r.forEach(e=>{if(!e.reinscriptionUtxo)return;const t=`${e.reinscriptionUtxo.txid}:${e.reinscriptionUtxo.vout}`;y.has(t)||y.set(t,[]),y.get(t).push(e)});const b=Array.from(y.entries()).filter(([e,t])=>t.length>1);b.length>0&&(Vh.warn("\ud83d\udce6 Detected multiple items referencing the same reinscription UTXO (should be blocked earlier):"),b.forEach(([e,t])=>{Vh.warn(`   ${e}: ${t.length} items`)}));const w=new e.Psbt({network:t}),x=[],v=[],S=a.platformFeeOutputs&&Array.isArray(a.platformFeeOutputs)?a.platformFeeOutputs.reduce((e,t)=>e+Math.ceil(t.value),0):Math.ceil(a.platformFee||0),E=new Set(f.map(e=>`${e.txid}:${e.vout}`)),I=[...n].filter(e=>!E.has(`${e.txid}:${e.vout}`)).sort((e,t)=>e.value-t.value),k=[];let A=0;const N=r.length+(S>0?a.platformFeeOutputs?.length||1:0);function T(e,t){const n=_g(e,N+(t?1:0),!0,0,{isReveal:!1});return Math.ceil(n*s)}let _=!0;const P=I.filter(e=>!E.has(`${e.txid}:${e.vout}`)).sort((e,t)=>t.value-e.value),B=g+u+d+S;for(const G of P){const e=B+T(1+m,!0);if(G.value>=e){k.push(G),A+=G.value;const e=I.findIndex(e=>e.txid===G.txid&&e.vout===G.vout);e>=0&&I.splice(e,1),_=!1;break}}for(;_;){const e=I.shift();if(!e){const e=k.length,t=g+u+d+S,n=T(e+m,!0),r=t+n;throw Vh.error(`\u274c Insufficient payment UTXOs:\n  - Commit outputs need: ${t} sats\n    * Target output value (per item): ${g} sats\n    * Target inputs provided: ${h} sats (from ${m} unique reinscription targets)\n    * Normal reveal funding: ${u} sats\n    * Reinscription fee pool: ${d} sats\n    * Platform fees: ${S} sats\n  - Commit fee: ${n} sats\n  - Total need: ${r} sats\n  - Have: ${A} sats from ${e} payment UTXOs\n  - Missing: ${r-A} sats`),new Error(`Insufficient funds: need ${r} sats, have ${A} sats (missing ${r-A} sats)`)}k.push(e),A+=e.value;const t=k.length,n=T(t+m,!1),r=g+u+d+S;if(A>=r+n){const e=A+h-r-n;if(e>0&&e<546&&I.length>0&&A+h<r+T(t+m,!0)+546)continue;_=!1}}let C=0;new Set(k.map(e=>`${e.txid}:${e.vout}`));const O=r.filter(e=>!!e.reinscriptionUtxo);f.forEach(e=>{const t=k.findIndex(t=>t.txid===e.txid&&t.vout===e.vout);t>=0&&k.splice(t,1)});const L=[...k].sort((e,t)=>e.value-t.value);function F(n,r="payment"){let i,a={};const s=(n.address||"").toString();if("target"===r)if(n.scriptHex)i=rg(Buffer.from(n.scriptHex,"hex"),"reinscription witnessUtxo.script");else{if(!s)throw new Error("Reinscription target requires scriptHex or address");i=e.address.toOutputScript(s,t)}else if(o&&s.startsWith("3")){const n=Buffer.from(o,"hex"),r=e.payments.p2wpkh({pubkey:n,network:t});i=e.payments.p2sh({redeem:r,network:t}).output,a.redeemScript=r.output}else i=e.address.toOutputScript(s,t);w.addInput({hash:rg(Buffer.from(n.txid,"hex").reverse(),"commit input hash"),index:n.vout,sequence:4294967293,witnessUtxo:{script:i,value:n.value},...a}),x.push({index:C,address:n.address}),v.push({txid:n.txid,vout:n.vout,value:n.value,label:r,isTarget:E.has(`${n.txid}:${n.vout}`)}),C+=1}const R=new Set;if(O.length>0){for(let e=0;e<O.length;e++){const t=O[e].reinscriptionUtxo;if(!t)continue;const n=`${t.txid}:${t.vout}`;R.has(n)||(F(t,"target"),R.add(n))}L.forEach(e=>F(e,"payment"))}else k.forEach(e=>F(e,"payment"));A=k.reduce((e,t)=>e+t.value,0);const U=r.filter(e=>!e.reinscriptionUtxo);if(O.forEach((e,t)=>{const n=e.reinscriptionUtxo;if(!n||!n.value)throw new Error("Reinscription item missing valid target UTXO value");const r=Math.ceil(n.value),i=r;if(r<=0)throw new Error("Reinscription target value must be positive");if(void 0!==e.pointer&&null!==e.pointer){const n="number"==typeof e.pointer?e.pointer:parseInt(e.pointer);if(!isNaN(n)&&n>=r)throw new Error(`Batch item ${t}: CRITICAL sat alignment error!\nPointer ${n} >= target UTXO value ${r}\nPointer must be < ${r} to stay within original UTXO's sat range.`)}w.addOutput({address:e.taprootPayment.address,value:i})}),U.forEach(e=>{w.addOutput({address:e.taprootPayment.address,value:Math.ceil(e.revealFundingValue)})}),l&&d>0&&w.addOutput({address:l.taprootPayment.address,value:d}),a.platformFeeOutputs&&Array.isArray(a.platformFeeOutputs))a.platformFeeOutputs.forEach(e=>{w.addOutput({address:e.address,value:Math.ceil(e.value)})});else if("number"==typeof a.platformFee&&a.platformFee>0){const e=a.platformFeeAddress||i;w.addOutput({address:e,value:Math.ceil(a.platformFee)})}const M=w.txOutputs.reduce((e,t)=>e+t.value,0),$=A+h,H=k.length+m,D=w.txOutputs.length,z=[...Array.from({length:m},()=>"p2tr"),...k.map(e=>(e=>{const t=String(e||"").trim().toLowerCase();return t?t.startsWith("bc1p")||t.startsWith("tb1p")||t.startsWith("bcrt1p")?"p2tr":t.startsWith("bc1q")||t.startsWith("tb1q")||t.startsWith("bcrt1q")?"p2wpkh":t.startsWith("3")||t.startsWith("2")?"p2sh-p2wpkh":"p2wpkh":"p2wpkh"})(e.address))],W=function(e,t,n,r,i,a=546){const o=i(e,t),s=n-r-o.fee;if(s<=a){const e=n-r,t=o.vsize>0?e/o.vsize:o.achievedFeeRate;return{shouldAddChange:!1,changeValue:0,fee:e,vsize:o.vsize,achievedFeeRate:t,requestedFeeRate:o.requestedFeeRate,dustReason:s<0?`Insufficient funds (need ${-s} more sats)`:`Change would be ${s} sats (below ${a} dust)`}}const l=i(e,t+1),c=n-r-l.fee;if(c<=a){const e=n-r,t=o.vsize>0?e/o.vsize:o.achievedFeeRate;return{shouldAddChange:!1,changeValue:0,fee:e,vsize:o.vsize,achievedFeeRate:t,requestedFeeRate:o.requestedFeeRate,dustReason:`Change would be ${c} sats after fee increase (below ${a} dust)`}}return{shouldAddChange:!0,changeValue:c,fee:l.fee,vsize:l.vsize,achievedFeeRate:l.achievedFeeRate,requestedFeeRate:l.requestedFeeRate}}(H,D,$,M,(e,t)=>function(e,t,n,r={}){const i=_g(e,t,!0,0,{isReveal:!1,...r}),a=Math.ceil(i*n);return{fee:a,vsize:i,achievedFeeRate:a/i,requestedFeeRate:n}}(H,t,s,{inputTypes:z,parentInputType:"p2wpkh"}),546);if(W.shouldAddChange&&W.changeValue>0)w.addOutput({address:i,value:W.changeValue});else if(W.dustReason&&W.dustReason.startsWith("Insufficient funds"))throw new Error(`Insufficient funds for commit: ${W.dustReason}`);const V=W.fee,j=W.vsize,q=W.changeValue||0,K=W.achievedFeeRate;Math.abs(K-s)>.05&&Vh.warn(`\u26a0\ufe0f Commit fee rate deviation: requested ${s} sat/vB, achieved ${K.toFixed(2)} sat/vB`);const X=$-M-V;return(q>0||X!==q)&&(Vh.debug(`\ud83e\uddee Commit accounting:\n  totalInputsValue=${$} sats\n  sumOutputsBeforeChange=${M} sats\n  finalCommitFee=${V} sats\n  expectedChange=${X} sats\n  changeOutputAdded=${q} sats\n  feeRateAchieved=${K.toFixed(2)} sat/vB`),q!==X&&Vh.debug(`   \u21aa\ufe0f Delta (expectedChange - changeOutput) = ${X-q} sats treated as implicit fee pad / rounding`)),r.forEach((e,t)=>{const n=e.reinscriptionUtxo?e.reinscriptionUtxo.value:0,r=Math.ceil(e.revealFundingValue),i=e.recipientAddress||e.taprootPayment.address,a=n>0?n:r,o=n>0?`${n} (target passthrough) -> ${i}`:`${r} (postage+revealFee) -> ${i}`;Vh.debug(`   \u2022 Commit output #${t}: ${a} sats = ${o}`)}),{psbt:w,base64:w.toBase64(),inputsToSign:x,revealFundingValues:r.map(e=>e.revealFundingValue),commitFee:V,commitVsize:j,achievedFeeRate:K,selectedInputs:k}}(f,p,n,A,i||n[0].address,m,l,s,q);if(d)try{const e=[],t=x.length;A.forEach(t=>{const n=t.reinscriptionUtxo?Math.ceil(t.reinscriptionUtxo.value||0):Math.ceil(t.revealFundingValue);e.push(n)});for(let n=0;n<e.length;n++){const r=K.psbt.txOutputs[n];if(!r)throw new Error(`Missing commit output #${n}`);const i=e[n];if(r.value!==i)throw new Error(`Strict check failed: commit output #${n} (${n<t?"reinscription":"normal"}) value=${r.value} != expected=${i}`)}if(q){const e=K.psbt.txOutputs[q.commitVoutIndex];if(!e)throw new Error(`Missing reinscription fee-pool output #${q.commitVoutIndex}`);const t=Math.ceil(q.value||0);if(e.value!==t)throw new Error(`Strict check failed: fee-pool output value=${e.value} != expected=${t}`)}}catch(cC){const t=new Error(`REINSCRIPTION_STRICT_CHECK_FAILED (commit): ${cC.message}`);throw t.code="REINSCRIPTION_STRICT_MISMATCH_COMMIT",t}const X=f.Psbt.fromBase64(K.base64,{network:p}).data.globalMap.unsignedTx.tx.getHash(),G=(n||[]).some(e=>{const t=(e?.address||"").toLowerCase();return t.startsWith("1")||t.startsWith("3")||t.startsWith("2")||t.startsWith("m")||t.startsWith("n")});let Y=K,J=X;if(G){const e=ty(K.psbt,"commit (pre-sign)"),n=K.psbt.toHex(),r=await t.signPsbt(n,{autoFinalized:!0,toSignInputs:K.inputsToSign}),i=f.Psbt.fromHex(r,{network:p});ny({expectedUnsignedTxid:e,psbt:i,label:"commit (post-sign)"});try{i.finalizeAllInputs()}catch{}const a=i.extractTransaction(),o=a.getId();J=Buffer.from(a.getHash()),Y={psbt:i,base64:i.toBase64(),txHex:a.toHex(),txId:o,inputsToSign:K.inputsToSign}}const Q=new Set(A.filter(e=>e.reinscriptionUtxo&&void 0!==e.reinscriptionUtxo.txid).map(e=>`${e.reinscriptionUtxo.txid}:${e.reinscriptionUtxo.vout}`)),Z=[];function ee({bitcoinLib:e,network:t,commitTxHashLE:n,pseudo:r}){const i=new e.Psbt({network:t}),a=[],o=[];return i.addInput({hash:rg(n,"commitTxHashLE"),index:"number"==typeof r.commitVoutIndex?r.commitVoutIndex:0,sequence:4294967293,witnessUtxo:{script:rg(r.taprootPayment.output,"taprootPayment.output"),value:Math.ceil(r.revealFundingValue)},tapLeafScript:[{controlBlock:rg(r.controlBlock,"controlBlock"),leafVersion:r.leafVersion,script:rg(r.witnessScript,"witnessScript")}]}),a.push({index:0,address:r.taprootPayment.address,disableTweakSigner:!0,tapLeafHash:r.leafHash.toString("hex")}),(r.__groupItems||[]).forEach(e=>{const t=Math.ceil(e.postage);i.addOutput({address:e.recipientAddress,value:t}),o.push({address:e.recipientAddress,value:t,purpose:"inscription-output",itemIndex:e.__index})}),{psbt:i,base64:i.toBase64(),inputsToSign:a,outputs:o}}for(let ae=0;ae<_.length;ae++){const e=_[ae],n=e.items;if("simple-multi"===e.type){const e=ry({bitcoinLib:f,network:p,commitTxHashLE:J,items:n});Z.push({type:"simple-multi",...e,itemIndexes:n.map(e=>e.__index),parentInputCount:0});continue}if("shared-output"===e.type){const t=e.__sharedPseudo||n[0],r=ee({bitcoinLib:f,network:p,commitTxHashLE:J,pseudo:t});Z.push({type:"shared-output",...r,itemIndexes:(t.__groupItems||[]).map(e=>e.__index),parentInputCount:0,__sharedPseudo:t});continue}const r=iy({bitcoinLib:f,network:p,commitTxHashLE:J,items:n,ordinalsPublicKey:c,fees:m,wallet:t,globalReinscriptionTargets:Q,reinscriptionFeePool:q});Z.push({type:"multi-all"===e.type?"multi-all":"reinscription-single"===e.type||"reinscription-multi"===e.type?e.type:1===n.length?"complex-single":"complex-multi",...r,itemIndexes:n.map(e=>e.__index),isMixedBatch:r.isMixedBatch})}try{const e=new Set,t=rg(J,"commitTxHashLE");for(let n=0;n<Z.length;n++){const r=Z[n],i=r?.psbt?.data?.globalMap?.unsignedTx?.tx,a=i?.ins;if(Array.isArray(a))for(const n of a){if(!n||!Buffer.isBuffer(n.hash))continue;if(n.hash.equals(t))continue;const r=`${Buffer.from(n.hash).reverse().toString("hex")}:${n.index}`;if(e.has(r)){const e=new Error(`PARENT_INPUT_REUSED_ACROSS_REVEALS: outpoint ${r} appears in multiple reveal segments`);throw e.code="PARENT_INPUT_REUSED_ACROSS_REVEALS",e}e.add(r)}}}catch(cC){throw cC}if(1===Z.length&&"multi-all"===Z[0].type){const e=Z[0];if(d)try{for(let e=0;e<A.length;e++){const t=A[e].taprootPayment.address,n=K.psbt.txOutputs[e]?.script;if(!n)throw new Error(`Missing commit output script at index ${e}`);const r=f.address.fromOutputScript(n,p);if(t!==r)throw new Error(`Commit output order mismatch at index ${e}: expected ${t}, got ${r}`)}}catch(cC){const t=new Error(`COMMIT_OUTPUT_ORDER_MISMATCH: ${cC.message}`);throw t.code="COMMIT_OUTPUT_ORDER_MISMATCH",t}if(d)try{const t=A.filter(e=>!!e.reinscriptionUtxo),n=(e.outputs||[]).filter(e=>"reinscription-output"===e.purpose);if(n.length!==t.length)throw new Error(`Reinscription output count mismatch: found ${n.length}, expected ${t.length}`);t.forEach(e=>{const t=n.find(t=>t.itemIndex===e.__index);if(!t)throw new Error(`Missing reinscription output for item #${e.__index}`);const r=Math.ceil(e.reinscriptionUtxo.value||0);if(t.value!==r)throw new Error(`Strict check failed: item #${e.__index} reinscription output value=${t.value} != expected=${r}`)})}catch(cC){const t=new Error(`REINSCRIPTION_STRICT_CHECK_FAILED (reveal): ${cC.message}`);throw t.code="REINSCRIPTION_STRICT_MISMATCH_REVEAL",t}}if(d)try{Z.forEach((e,t)=>{if(!Array.isArray(e.itemIndexes)||0===e.itemIndexes.length)return;if("shared-output"===e.type)return;const n=e.itemIndexes.map(e=>A.find(t=>t.__index===e)).filter(e=>e&&e.reinscriptionUtxo);if(0===n.length)return;const r=(Array.isArray(e.outputs)?e.outputs:[]).filter(e=>"reinscription-output"===e.purpose);if(r.length!==n.length)throw new Error(`Segment ${t} reinscription outputs=${r.length} != expected=${n.length}`);n.forEach((e,n)=>{const i=r[n],a=Math.ceil(e.reinscriptionUtxo.value||0);if(!i)throw new Error(`Segment ${t} missing reinscription output #${n}`);if(i.value!==a)throw new Error(`Segment ${t} reinscription output #${n} value=${i.value} != expected=${a}`)})})}catch(cC){const t=new Error(`REINSCRIPTION_STRICT_MISMATCH_SEGMENT: ${cC.message}`);throw t.code="REINSCRIPTION_STRICT_MISMATCH_SEGMENT",t}const te=[J,X].filter(Boolean),ne=e=>te.some(t=>((e,t)=>{if(!Buffer.isBuffer(e)||!Buffer.isBuffer(t))return!1;if(e.equals(t))return!0;const n=(r=t,Buffer.isBuffer(r)&&32===r.length?Buffer.from(r).reverse():null);var r;return!!n&&e.equals(n)})(e,t)),re=[];for(let ae=0;ae<Z.length;ae++){const e=Z[ae],t=e.psbt,n=t?.data?.globalMap?.unsignedTx?.tx;if(!n||!Array.isArray(n.ins))throw new Error(`Missing unsignedTx.ins for reveal segment ${ae}`);if("shared-output"===e.type){const t=e.__sharedPseudo.commitVoutIndex,r=n.ins.findIndex(e=>e.index===t&&Buffer.isBuffer(e.hash)&&ne(e.hash));if(-1===r)throw new Error(`Shared-output segment ${ae}: no input spends commit vout ${t}`);e.itemIndexes.forEach(e=>{re.push({itemIndex:e,segment:ae,inputIndex:r})})}else e.itemIndexes.forEach(e=>{const t=A.find(t=>t.__index===e);if(!t)throw new Error(`Item #${e} not found in commitOrderItems`);const r="number"==typeof t.commitVoutIndex?t.commitVoutIndex:A.indexOf(t),i=n.ins.findIndex(e=>e.index===r&&Buffer.isBuffer(e.hash)&&ne(e.hash));if(-1===i)throw new Error(`Reveal seg ${ae}: no input spends commit vout ${r} for item #${e}`);re.push({itemIndex:e,segment:ae,inputIndex:i})})}if(re.length!==h.length)throw new Error(`Mapping mismatch: ${re.length} mapped items vs ${h.length} original items`);try{A.forEach((e,t)=>{const n="number"==typeof e.commitVoutIndex?e.commitVoutIndex:t,r=K.psbt.txOutputs[n];if(!r)throw new Error(`Missing commit output at vout ${n} (item #${e.__index})`);const i=e.reinscriptionUtxo?Math.ceil(e.reinscriptionUtxo.value||0):Math.ceil(e.revealFundingValue);if(r.value!==i)throw new Error(`Commit vout ${n} value=${r.value} != expected=${i} (item #${e.__index})`);const a=f.address.toOutputScript(e.taprootPayment.address,p),o=rg(r.script,"commit.txOut.script");if(!a.equals(o)){const t=e.taprootPayment.address,r=f.address.fromOutputScript(o,p);throw new Error(`Commit vout ${n} script addr=${r} != expected addr=${t} (item #${e.__index})`)}})}catch(cC){const t=new Error(`COMMIT_OUTPUT_MISMATCH: ${cC.message}`);throw t.code="COMMIT_OUTPUT_MISMATCH",t}try{Z.forEach((e,t)=>{const n=e.psbt,r=n?.data?.globalMap?.unsignedTx?.tx;if(r&&Array.isArray(r.ins)){if("shared-output"===e.type){const n=e.__sharedPseudo.commitVoutIndex;if(-1===r.ins.findIndex(e=>e.index===n&&Buffer.isBuffer(e.hash)&&ne(e.hash)))throw new Error(`Reveal seg ${t}: no input spends commit vout ${n} (shared-output group)`);return}e.itemIndexes.forEach(e=>{const n=A.find(t=>t.__index===e);if(!n)throw new Error(`Item #${e} not found in commitOrderItems`);const i="number"==typeof n.commitVoutIndex?n.commitVoutIndex:A.indexOf(n),a=r.ins.findIndex(e=>e.index===i&&Buffer.isBuffer(e.hash)&&ne(e.hash));if(-1===a)throw new Error(`Reveal seg ${t}: no input spends commit vout ${i} (item #${e})`);const o=r.ins[a];if(o.index!==i)throw new Error(`Reveal seg ${t} input ${a} prevoutIndex=${o.index} != expectedCommitVout=${i} (item #${e})`)})}else Vh.warn(`\u26a0\ufe0f Skipping prevout index check for seg ${t} (no unsignedTx.ins)`)})}catch(cC){const t=new Error(`REVEAL_INPUT_INDEX_MISMATCH: ${cC.message}`);throw t.code="REVEAL_INPUT_INDEX_MISMATCH",t}const ie=w.map(e=>({itemIndex:e.__index,revealFee:e.itemFeeDetail?.revealFee,revealFunding:e.itemFeeDetail?.revealFunding,scriptSize:e.itemFeeDetail?.scriptSize}));return{commit:Y,reveals:Z,mapping:re,feeSummary:ie,limits:u,enrichedItems:w,commitOrder:N,reinscriptionOrder:T}}(s);let{commit:c,reveals:u,mapping:d,enrichedItems:f}=l;const p=t?.walletType||t?.name?.toLowerCase()||"",m="function"==typeof t.signPsbts&&"magiceden"!==p;"magiceden"===p&&t.signPsbts;let h=c.txId,g=c.txHex,y=c.psbt;const b=[];if(m&&!g){const e=(()=>{try{return i.Psbt.fromBase64(c.base64,{network:a})}catch{return null}})();if(!e)throw new Error("Commit PSBT could not be parsed for signing");const n=[ty(e,"commit (pre-batch-sign)")],r=[(()=>{try{return e.toHex()}catch{return c.base64}})()],o=[{autoFinalized:!0,toSignInputs:(c.inputsToSign||[]).map(e=>({index:e.index,address:e.address,useTweakedSigner:e.address?.startsWith("bc1p")||e.address?.startsWith("tb1p")}))}],s=[];for(let t=0;t<u.length;t++){const e=u[t],l=i.Psbt.fromBase64(e.base64,{network:a}),c=(()=>{try{return l.toHex()}catch{return e.base64}})(),d=(e.inputsToSign||[]).filter(e=>!e.tapLeafHash&&"number"==typeof e.index);d.length>0&&(r.push(c),s.push(t),n.push(ty(l,`reveal ${t} (pre-batch-sign)`)),o.push({autoFinalized:!1,toSignInputs:d.map(e=>({index:e.index,address:e.address,useTweakedSigner:!0}))}))}const l=await jg(t,r,o);if(l.length!==n.length)throw new Error(`Wallet returned ${l.length} signed PSBTs, expected ${n.length}`);const p=l[0];y=(()=>{try{return i.Psbt.fromHex(p,{network:a})}catch{return i.Psbt.fromBase64(p,{network:a})}})(),ny({expectedUnsignedTxid:n[0],psbt:y,label:"commit (post-batch-sign)"});const m=y.data.inputs.length;if(y.data.inputs.filter(e=>e.finalScriptWitness||e.finalScriptSig).length<m)for(let t=0;t<m;t++){const e=y.data.inputs[t];if(!e.finalScriptWitness&&!e.finalScriptSig)try{e.tapInternalKey||e.tapMerkleRoot?y.finalizeInput(t,kg):y.finalizeInput(t)}catch(cC){throw new Error(`Commit input ${t} finalization failed: ${cC.message}`)}}const w=y.extractTransaction();h=w.getId(),g=w.toHex(),c={...c,psbt:y,signedBase64:y.toBase64(),signedHex:y.toHex(),txHex:g,txId:h};let x=1;for(let t=0;t<u.length;t++){const e=u[t];let r=i.Psbt.fromBase64(e.base64,{network:a});if(s.includes(t)){const o=l[x];r=(()=>{try{return i.Psbt.fromHex(o,{network:a})}catch{return i.Psbt.fromBase64(o,{network:a})}})(),ny({expectedUnsignedTxid:n[x],psbt:r,label:`reveal ${t} (post-batch-sign)`}),x++,(e.inputsToSign||[]).filter(e=>!e.tapLeafHash&&"number"==typeof e.index)}if("shared-output"===e.type){const t=e.__sharedPseudo,n=t?.leafHash,i=t?.local?.privateKey;if(!n||!i)throw new Error("Missing composite leafHash or private key for shared-output segment");await vg(0,r,0,i,n),r.finalizeInput(0,Ng)}else if("complex-single"!==e.type){const n=(e.inputsToSign||[]).filter(e=>!e.tapLeafHash&&"number"==typeof e.index);for(const e of n){const t=e.address&&(e.address.startsWith("bc1q")||e.address.startsWith("tb1q"))?Ag:kg;try{r.finalizeInput(e.index,t)}catch{}}const i=new Set;for(let o=0;o<e.itemIndexes.length;o++){const n=e.itemIndexes[o],a=f.find(e=>e.__index===n)||{},s=a.leafHash,l=a.local?.privateKey;if(!s||!l)throw new Error("Missing leafHash or local private key for multi-item segment");const c=(d||[]).find(e=>e.itemIndex===n&&e.segment===t),u="number"==typeof c?.inputIndex?c.inputIndex:void 0;if("number"!=typeof u)throw new Error(`Mapping not found for itemIndex ${n} in segment ${t}`);await vg(0,r,u,l,s),r.finalizeInput(u,Ng),i.add(u)}const a=(e.inputsToSign||[]).filter(e=>e.tapLeafHash&&"number"==typeof e.index&&!i.has(e.index));if(a.length>0){const e=f.find(e=>e?.local?.privateKey)?.local?.privateKey;if(!e)throw new Error("Missing local private key for extra tapscript inputs");for(const t of a){const n=Buffer.from(String(t.tapLeafHash),"hex");await vg(0,r,t.index,e,n),r.finalizeInput(t.index,Ng)}}}else{const t=(e.inputsToSign||[]).find(e=>e.tapLeafHash);if(t&&"number"==typeof t.index){const n=e.itemIndexes[0],i=f.find(e=>e.__index===n)||{},a=i.leafHash,o=i.local?.privateKey;if(!a||!o)throw new Error("Missing leafHash or local private key for complex segment");await vg(0,r,t.index,o,a)}const n=(e.inputsToSign||[]).filter(e=>!e.tapLeafHash&&"number"==typeof e.index);for(const e of n){const t=e.address&&(e.address.startsWith("bc1q")||e.address.startsWith("tb1q"))?Ag:kg;try{r.finalizeInput(e.index,t)}catch{}}t&&"number"==typeof t.index&&r.finalizeInput(t.index,Ng)}const o=r.extractTransaction();b.push({segment:t,txHex:o.toHex(),txId:o.getId(),psbt:r,psbtHex:r.toHex(),psbtBase64:r.toBase64()}),u[t]={...e,signedBase64:r.toBase64(),signedHex:r.toHex(),txHex:o.toHex(),txId:o.getId()}}}else{if(!g){const e=(()=>{try{return i.Psbt.fromBase64(c.base64,{network:a}).toHex()}catch{return c.base64}})(),n=[{autoFinalized:!0,toSignInputs:(c.inputsToSign||[]).map(e=>({index:e.index,address:e.address,useTweakedSigner:e.address?.startsWith("bc1p")||e.address?.startsWith("tb1p")}))}],[r]=await jg(t,[e],n);y=(()=>{try{return i.Psbt.fromHex(r,{network:a})}catch{return i.Psbt.fromBase64(r,{network:a})}})();const o=y.data.inputs.length;if(y.data.inputs.filter(e=>e.finalScriptWitness||e.finalScriptSig).length<o)for(let t=0;t<o;t++){const e=y.data.inputs[t];if(!e.finalScriptWitness&&!e.finalScriptSig)try{e.tapInternalKey||e.tapMerkleRoot?y.finalizeInput(t,kg):y.finalizeInput(t)}catch(cC){throw new Error(`Commit input ${t} finalization failed: ${cC.message}. This usually means the wallet didn't sign the input properly.`)}}const s=y.extractTransaction();h=s.getId(),g=s.toHex(),c={...c,psbt:y,signedBase64:y.toBase64(),signedHex:y.toHex(),txHex:g,txId:h}}for(let e=0;e<u.length;e++){const n=u[e];let r=i.Psbt.fromBase64(n.base64,{network:a});const o=(n.inputsToSign||[]).filter(e=>!e.tapLeafHash&&"number"==typeof e.index);if(o.length>0){const e=(()=>{try{return r.toHex()}catch{return n.base64}})(),s=[{autoFinalized:!1,toSignInputs:o.map(e=>({index:e.index,address:e.address,useTweakedSigner:!0}))}],[l]=await jg(t,[e],s);r=(()=>{try{return i.Psbt.fromHex(l,{network:a})}catch{return i.Psbt.fromBase64(l,{network:a})}})()}if("shared-output"===n.type){const e=n.__sharedPseudo,t=e?.leafHash,i=e?.local?.privateKey;if(!t||!i)throw new Error("Missing composite leafHash or private key for shared-output segment");await vg(0,r,0,i,t),r.finalizeInput(0,Ng)}else if("complex-single"!==n.type){const t=(n.inputsToSign||[]).filter(e=>!e.tapLeafHash&&"number"==typeof e.index);for(const e of t){const t=e.address&&(e.address.startsWith("bc1q")||e.address.startsWith("tb1q"))?Ag:kg;try{r.finalizeInput(e.index,t)}catch{}}const i=new Set;for(let o=0;o<n.itemIndexes.length;o++){const t=n.itemIndexes[o],a=f.find(e=>e.__index===t)||{},s=a.leafHash,l=a.local?.privateKey;if(!s||!l)throw new Error("Missing leafHash or local private key for multi-item segment");const c=(d||[]).find(n=>n.itemIndex===t&&n.segment===e),u="number"==typeof c?.inputIndex?c.inputIndex:void 0;if("number"!=typeof u)throw new Error(`Mapping not found for itemIndex ${t} in segment ${e}`);await vg(0,r,u,l,s),r.finalizeInput(u,Ng),i.add(u)}const a=(n.inputsToSign||[]).filter(e=>e.tapLeafHash&&"number"==typeof e.index&&!i.has(e.index));if(a.length>0){const e=f.find(e=>e?.local?.privateKey)?.local?.privateKey;if(!e)throw new Error("Missing local private key for extra tapscript inputs");for(const t of a){const n=Buffer.from(String(t.tapLeafHash),"hex");await vg(0,r,t.index,e,n),r.finalizeInput(t.index,Ng)}}}else{const e=(n.inputsToSign||[]).find(e=>e.tapLeafHash);if(e&&"number"==typeof e.index){const t=n.itemIndexes[0],i=f.find(e=>e.__index===t)||{},a=i.leafHash,o=i.local?.privateKey;if(!a||!o)throw new Error("Missing leafHash or local private key for complex segment");await vg(0,r,e.index,o,a)}const t=(n.inputsToSign||[]).filter(e=>!e.tapLeafHash&&"number"==typeof e.index);for(const n of t){const e=n.address&&(n.address.startsWith("bc1q")||n.address.startsWith("tb1q"))?Ag:kg;try{r.finalizeInput(n.index,e)}catch{}}e&&"number"==typeof e.index&&r.finalizeInput(e.index,Ng)}const s=r.extractTransaction();b.push({segment:e,txHex:s.toHex(),txId:s.getId(),psbt:r,psbtHex:r.toHex(),psbtBase64:r.toBase64()}),u[e]={...n,signedBase64:r.toBase64(),signedHex:r.toHex(),txHex:s.toHex(),txId:s.getId()}}}const w=[g,...b.map(e=>e.txHex)],x=[];let v="sequential";if("undefined"!=typeof window&&!mh()&&window.NexusBitcoinProxy&&window.NexusBitcoinProxy.isEnabled())try{const e=await window.NexusBitcoinProxy.broadcastPackage(w);let t,n;if(e&&e.commit&&e.reveal?(t=e.commit.txid,n=e.reveal.txid):e&&e.commitTxId&&e.revealTxId&&(t=e.commitTxId,n=e.revealTxId),!t||!n)throw new Error("Unexpected package relay response format");x.push(t,n),v="bitcoin_proxy_package_relay"}catch(cC){Vh.warn("Package relay failed, falling back to sequential broadcast:",cC?.message)}if(0===x.length){const e=b.some(e=>{const t=e.psbt||(e.psbtHex?(()=>{try{return i.Psbt.fromHex(e.psbtHex,{network:a})}catch{return i.Psbt.fromBase64(e.psbtHex,{network:a})}})():null);return!!t&&t.txOutputs.some(e=>e.value<330)});e&&o>0&&(Vh.warn("\u26a0\ufe0f DUST POLICY WARNING: Transaction has outputs < 330 sats with non-zero fees."),Vh.warn("   Bitcoin nodes will reject this. Solutions:"),Vh.warn("   1. Use postage >= 330 sats (recommended)"),Vh.warn("   2. Set fee rate to 0 (risky, may never confirm)"));const r=await Gg(t,{txHex:g,psbtBase64:y?.toBase64?.()},n,"commit");if(!r)return{success:!1,method:v,commitTxId:null,revealTxIds:[],error:e&&o>0?"Commit broadcast failed: dust output with non-zero fee (Bitcoin policy violation)":"Commit broadcast failed",manualBroadcast:{commitTxHex:g,revealTxHexes:b.map(e=>e.txHex)}};x.push(r);for(const i of b){const e=i.psbt?.toBase64?.(),r=e?{txHex:i.txHex,psbtBase64:e}:i.txHex,a=await Gg(t,r,n,"reveal");a&&x.push(a)}}return{success:x.length>=1+b.length||x.length>=2,method:v,commitTxId:x[0],revealTxIds:x.slice(1),commitTxHex:g,revealTxHexes:b.map(e=>e.txHex),mapping:d,warning:x.length<1+b.length?"Some reveal txids missing - check mempool manually":void 0}}({wallet:window.NexusWalletConnect,paymentUtxos:k.map(e=>({txid:e.txid,vout:e.vout,value:e.value,address:e.address||E})),items:w,changeAddress:E,network:S,fees:{commitFee:I.commitFee,revealFee:I.revealFee,postage:546,totalRequired:I.totalRequired},feeRate:Kt(re),paymentPublicKey:T,ordinalsPublicKey:_,enforceExactTargetOutputs:!0});return jt(P),be(P),i&&i(P),P};if(r)return await o(zt);let s=null,l=null;if(h){const e=h.split(",").filter(Boolean),t=e[e.length-1];if(l=t,s=c.find(e=>e.id===t),!s)throw new Error(`Reinscription target ${t} not found in wallet inscriptions`)}const u=l?e?.ordinalsAddress||s?.utxo?.address||e?.address:Q||e?.ordinalsAddress||e?.address,d={id:Date.now()+Math.random(),__autoSingle:!0,content:N,contentType:k,contentSize:K&&!String(j||"").trim()&&Number.isFinite(J.current)?J.current:_,uncompressedContentSize:_,compressedContentSize:K&&!String(j||"").trim()&&Number.isFinite(J.current)?J.current:void 0,fileName:B,recipientAddress:u,parentIds:p.map(e=>e.id),reinscriptionTargetId:l,reinscriptionTargetData:s,delegateId:O,metaprotocol:F,metadata:U,properties:$,contentEncoding:j,compressBeforeInscribe:!!K,pointer:W,features:[],nxsParcelManifestSelfHint:t?.nxsParcelManifestSelfHint||void 0},f=l?1:Math.max(1,Math.min(200,parseInt(te,10)||1)),m=Array.from({length:f},()=>({...d,id:Date.now()+Math.random(),__autoSingle:!0}));return a=m.map(e=>e.id),Wt(e=>{const t=[...e,...m],n=Gt(t);return n&&fe(n),t}),await o(m)}catch(uC){if(!r&&Array.isArray(a)&&a.length>0){const e=new Set(a);Wt(t=>t.filter(t=>t&&!e.has(t.id)))}ge({type:"error",message:uC.message||"Inscription failed. Please try again."})}finally{me(!1),"undefined"!=typeof window&&"inscribing"===window.__nexusGlobalLoading&&(window.__nexusGlobalLoading=null)}}};ee.current=Jt;const Qt=e=>{if(null==e)return!1;if("string"==typeof e)return e.length>0;if(e instanceof ArrayBuffer)return e.byteLength>0;if("undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(e))return(e.byteLength||0)>0;if("[object ArrayBuffer]"===Object.prototype.toString.call(e))try{return(e.byteLength||0)>0}catch{return!0}return!0},Zt=e=>{if(!e||"object"!=typeof e)return!1;const t=String(e.delegateId||"").trim(),n=String(e.metaprotocol||"").trim(),r=String(e.metadata||"").trim(),i=String(e.properties||"").trim(),a=Array.isArray(e.parentIds)?e.parentIds:null,o=Array.isArray(e.selectedParents)?e.selectedParents:null,s=String(e.reinscriptionTargetId||"").trim(),l=String(e.reinscriptionTarget||"").trim(),c=e.pointer,u=!(null==c||""===String(c));return!!t||!!n||!!r||!!i||a&&a.length>0||o&&o.length>0||!!s||!!l||u},en=(e,t="")=>{const n=(e?.contentEncoding||"").trim(),r=e?.content;if("string"==typeof r){if(n&&(e=>{if("string"!=typeof e)return!1;const t=e.trim();return/^\[object (ArrayBuffer|Uint8Array|Uint8ClampedArray|Int8Array|Int16Array|Int32Array|Uint16Array|Uint32Array|Float32Array|Float64Array|BigInt64Array|BigUint64Array|DataView)\]$/.test(t)})(r))throw new Error(`${t}Invalid content: encoded payload is a stringified binary object. Re-upload the file (.br/.gz) and do not use the Text tab.`);if(n&&!r.length)throw new Error(`${t}Invalid content: encoded payload is empty.`);return}const i=!!r&&(r instanceof ArrayBuffer||"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(r)||"[object ArrayBuffer]"===Object.prototype.toString.call(r));if(n&&!i)throw new Error(`${t}Invalid content: contentEncoding is set but content is not binary. Re-upload the file.`)},tn=it.useCallback(async t=>{try{let n;try{n=JSON.parse(String(t||""))}catch(cC){return void ge({type:"error",message:`\u274c Invalid JSON: ${cC?.message||String(cC)}`})}if(!n||"object"!=typeof n)return void ge({type:"error",message:"\u274c JSON must be an object."});const r=n.defaults&&"object"==typeof n.defaults?n.defaults:{},i=n.feeRate??r.feeRate;if(void 0!==i)try{Xt(i)}catch(cC){return void ge({type:"error",message:`\u274c Invalid feeRate in JSON: ${cC?.message||String(cC)}`})}const a=n.developerFee??n.fees?.developer;if(void 0!==a)if(null===a)Rg(null);else if("object"==typeof a){const e=a.enabled,t=a.amountSats??a.amount??0,n=Number(t);if(!1===e||!Number.isFinite(n)||n<=0)Rg(null);else{const e=String(a.address||"").trim();if(!e)throw new Error("developerFee.address is required when amountSats > 0");Rg({address:e,amountSats:n,description:a.description||a.label||"Developer API Fee",mode:a.mode,perItem:a.perItem})}}const o=n.customFees??n.fees?.customFees;if(void 0!==o)if(null===o)Hg();else if(Array.isArray(o)){Hg();for(let e=0;e<o.length;e++){const t=o[e];if(!t||"object"!=typeof t)throw new Error(`customFees[${e}] must be an object`);const n=String(t.address||"").trim(),r=Number(t.amountSats??t.amount),i=t.description||t.label||`Custom Fee ${e+1}`;if(!n)throw new Error(`customFees[${e}].address is required`);if(!Number.isFinite(r)||r<=0)throw new Error(`customFees[${e}].amountSats must be a positive number`);$g(n,r,i)}}const s=await async function(e,t={}){const{defaultRecipient:n,walletInscriptions:r=[]}=t;let i;try{i=JSON.parse(String(e||""))}catch(uC){throw new Error(`Invalid JSON: ${uC.message}`)}if(!i||"object"!=typeof i)throw new Error("JSON must be an object");const a=i.defaults||{},o=i.items||(i.item?[i.item]:[]);if(0===o.length)throw new Error('JSON must contain "items" array or "item" object');const s=e=>{if(null!=e){if("string"==typeof e){const t=e.trim();if(!t)return;return JSON.parse(t)}return e}},l=e=>String(e??""),c=e=>{if(null==e)return"";if("string"==typeof e)return e;try{return JSON.stringify(e)}catch{return String(e)}},u=new Set;o.forEach(e=>{(Array.isArray(e.parentIds)?e.parentIds:Array.isArray(a.parentIds)?a.parentIds:[]).forEach(e=>u.add(e))});let d=0;u.size>0&&(d=(await Promise.all(Array.from(u).map(async e=>{try{return await Ih(e,{walletInscriptions:r})}catch(uC){const n=uC&&uC.message?uC.message:String(uC);throw new Error(`Cannot fetch exact parent UTXO value for ${e}. Refusing to assume 546 sats because that can misplace pointers/inscriptions. Error: ${n}`)}}))).reduce((e,t)=>e+t,0));const f=o.filter(e=>!!e.reinscriptionTargetId),p=Array.from(new Set(f.map(e=>e.reinscriptionTargetId).filter(Boolean))),m=new Map;p.length>0&&(await Promise.all(p.map(async e=>{try{return[e,await Ih(e,{walletInscriptions:r})]}catch(uC){const n=uC&&uC.message?uC.message:String(uC);throw new Error(`Cannot fetch exact reinscription target UTXO value for ${e}. Refusing to assume 546 sats because that can misplace pointers/inscriptions. Error: ${n}`)}}))).forEach(([e,t])=>m.set(e,t));const h=e=>Math.max(546,parseInt(e.postage||a.postage||546,10)),g=e=>!!o[e]?.reinscriptionTargetId,y=d>0,b=o.some(e=>!!e.reinscriptionTargetId),w=o.some(e=>!e.reinscriptionTargetId),x=y&&b&&w,v=[],S=[],E=new Array(o.length).fill(546),I=new Array(o.length).fill(0);for(let C=0;C<o.length;C++){const e=o[C];if(E[C]=h(e),g(C)){v.push(C);const t=e.reinscriptionTargetId;I[C]=m.has(t)?m.get(t):546}else S.push(C)}const k=v.reduce((e,t)=>e+(I[t]||0),0),A=d+k+S.reduce((e,t)=>e+(E[t]||0),0),N=x?0:d,T=x?k+d:d+k,_=new Array(o.length).fill(void 0);let P=0;for(const C of v)_[C]=N+P,P+=I[C]||0;P=0;for(const C of S)_[C]=T+P,P+=E[C]||0;const B=await Promise.all(o.map(async(e,t)=>{let r=e.content;if(e.contentBase64&&(r=(e=>{const t=atob(String(e||"")),n=new Uint8Array(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n})(e.contentBase64)),!r)throw new Error(`Item #${t+1}: No content provided`);const i="string"==typeof r||r instanceof Uint8Array?r:new Uint8Array(r),o=e.contentType||a.contentType||"text/plain",u=e.metaprotocol??a.metaprotocol,d=e.recipientAddress||a.recipientAddress||n||void 0,f=Math.max(546,parseInt(e.postage||a.postage||546,10)),p=void 0!==e.commitFeeRateOverride?Number(e.commitFeeRateOverride):void 0,m=s(e.metadata??a.metadata),h=s(e.properties??a.properties),g=Array.isArray(e.parentIds)?e.parentIds:Array.isArray(a.parentIds)?a.parentIds:[];let y=void 0!==e.pointer?e.pointer:a.pointer;if(e.reinscriptionTargetId,(void 0===y||""===y)&&Array.isArray(_)&&"number"==typeof _[t]){const e=_[t];e>0&&(y=e)}const b=0===(w=y)?0:w??"";var w;const x=(e=>{if(0===e)return 0;if(null==e)return;const t=String(e).trim();if(!t)return;const n=parseInt(t,10);return Number.isFinite(n)?n:void 0})(b);if(null!=x&&"number"==typeof x){if(x<0)throw new Error(`Item #${t+1}: Pointer must be >= 0, got ${x}`);if(A>0&&x>=A)throw new Error(`Item #${t+1}: Pointer ${x} is outside planned outputs (total=${A}). This would likely create an unbound inscription (fee/miner).`)}const v=e.delegateId??a.delegateId,S=e.contentEncoding??a.contentEncoding,E=e.compressBeforeInscribe??a.compressBeforeInscribe??!1,I=Uh({content:i,contentType:String(o),parentIds:g&&g.length>0?g:void 0,delegateId:v?String(v):void 0,metaprotocol:u?String(u):void 0,pointer:x,metadata:m,properties:h,customTags:void 0,contentEncoding:S?String(S):void 0}),k=c(m),N=c(h),T=l(u),P=l(S),B=l(v),C=!!E,O=0===b?0:b||void 0;return{inscriptionScript:I,mode:"standard",recipientAddress:d||void 0,content:i,contentSize:"string"==typeof i?(new TextEncoder).encode(i).length:i.length,contentType:String(o),commitFeeRateOverride:p,postage:f,metadata:k,properties:N,metaprotocol:T,pointer:O,contentEncoding:P,compressBeforeInscribe:C,customTags:null,delegateId:B,parentIds:g,...void 0!==e.revealFundingValue?{revealFundingValue:Number(e.revealFundingValue)}:{}}}));return{items:B}}(t,{defaultRecipient:e?.ordinalsAddress||e?.address,walletInscriptions:c||[]});if(!s||!s.items||0===s.items.length)return void ge({type:"error",message:"\u274c No items found in JSON"});const l=s.items.map((e,t)=>{let n=null,r=null;if(e.reinscriptionTargetId){const i=c.find(t=>t.id===e.reinscriptionTargetId);if(!i)throw new Error(`Item #${t+1}: Reinscription target ${e.reinscriptionTargetId} not found in wallet`);n=i,r=i.id}const i=(e.parentIds||[]).map(e=>c.find(t=>t.id===e)).filter(Boolean),a=[],o=Array.isArray(e.parentIds)?e.parentIds.length:0;return 1===o&&a.push("\ud83d\udc68\u200d\ud83d\udc67 Parent-Child"),o>1&&a.push(`\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d\udc66 Multi-Parent (${o})`),r&&a.push("\u267b\ufe0f Reinscription"),e.delegateId&&a.push("\ud83d\udd17 Delegate"),e.metaprotocol&&a.push(`\ud83d\udce1 ${e.metaprotocol}`),e.metadata&&a.push("\ud83d\udcca Metadata"),e.properties&&a.push("\ud83c\udfa8 Properties"),e.contentEncoding&&a.push("\ud83d\udddc\ufe0f Encoding"),e.compressBeforeInscribe&&!e.contentEncoding&&a.push("\ud83e\uddf1 Brotli"),void 0!==e.pointer&&null!==e.pointer&&""!==e.pointer&&a.push("\ud83c\udfaf Pointer"),{...e,id:Date.now()+Math.random()+t,mode:"standard",reinscriptionTargetId:r,reinscriptionTargetData:n,selectedParents:i,features:a}});for(let e=0;e<l.length;e++)try{en(l[e],`Item #${e+1}: `)}catch(cC){throw new Error(cC?.message||String(cC))}const u=new Set;for(const e of l)if(e.reinscriptionTargetId){if(u.has(e.reinscriptionTargetId))throw new Error(`Duplicate reinscriptionTargetId in batch: ${e.reinscriptionTargetId} (each target can only be reinscribed once per batch)`);u.add(e.reinscriptionTargetId)}if(1!==l.length||n.items)Wt(l),ge({type:"success",message:`\u2705 Imported batch: ${l.length} item(s)`});else{const e=l[0];T(e.content),A(e.contentType),C(e.fileName||""),m(e.selectedParents||[]),g(e.reinscriptionTargetId||null),L(e.delegateId||""),R(e.metaprotocol||""),M(e.metadata||""),H(e.properties||""),z(e.customTags||null),V(0===e.pointer?0:e.pointer||""),q(e.contentEncoding||""),Z(e.recipientAddress||""),ge({type:"success",message:"\u2705 Imported draft from JSON"})}}catch(cC){ge({type:"error",message:`\u274c JSON import failed: ${cC?.message||String(cC)}`})}},[c,e?.ordinalsAddress,e?.address,en,Xt]),nn=it.useMemo(()=>zt.map(e=>e.reinscriptionTargetId).filter(Boolean),[zt]);return it.createElement("div",{className:"fixed inset-0 bg-black/90 backdrop-blur-md z-[9999] flex items-center justify-center p-0 sm:p-3"},it.createElement("div",{className:"flex flex-col bg-neutral-950 border-0 sm:border border-neutral-800 rounded-none sm:rounded-2xl w-full sm:w-[98vw] max-w-[2000px] h-full h-[100dvh] sm:h-[96vh] shadow-2xl overflow-hidden"},it.createElement(Rw,{walletAddress:e?.ordinalsAddress||e?.address,walletType:e?.walletType,isConnected:e?.isConnected,onConnect:()=>{t&&t()},onDisconnect:r,connectDisabled:!1,showLiveTestWarning:a,utxoCount:ce?.length||0,activeSection:"utxos"===ve?"utxos":"oodl"===ve?"oodl":"inscribe",oodlSection:Ee,onSectionChange:e=>{if("utxos"!==e)return"marketplace"===e?(Le(Ce("oodl")),void Ie("marketplace")):"hub"===e?(Le(Ce("oodl")),void Ie("hub")):void Le(Ce("oodl"!==e?Re||"text":"oodl"));Le(Ce("utxos"))}}),De>0&&e?.isConnected&&it.createElement("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm z-[9200] flex items-center justify-center p-4"},it.createElement("div",{className:"bg-neutral-950 border border-neutral-800 rounded-2xl px-6 py-5 max-w-lg w-full shadow-2xl"},it.createElement("div",{className:"flex items-center gap-3"},it.createElement("div",{className:"h-5 w-5 rounded-full border-2 border-neutral-500 border-t-transparent animate-spin"}),it.createElement("div",{className:"text-sm font-semibold text-neutral-100"},"Waiting for transaction\u2026")),it.createElement("div",{className:"mt-2 text-xs text-neutral-400 leading-relaxed"},String(Ht||"Processing\u2026")),it.createElement("div",{className:"mt-3 text-[11px] text-neutral-500"},"Keep your wallet popup open and approve/deny the request."))),it.createElement("div",{ref:He,className:"oodl"===ve?ke?"isolate relative z-0 grid grid-cols-1 lg:grid-cols-[minmax(0,2fr)_minmax(0,1fr)] gap-2 sm:gap-4 p-1.5 sm:p-4 min-h-0 flex-1 overflow-y-auto overflow-x-hidden":"isolate relative z-0 grid grid-cols-1 gap-2 sm:gap-4 p-1.5 sm:p-4 min-h-0 flex-1 overflow-y-auto overflow-x-hidden":"isolate relative z-0 grid grid-cols-1 lg:grid-cols-[minmax(0,2fr)_minmax(0,1fr)_minmax(0,1fr)] gap-2 sm:gap-4 p-1.5 sm:p-4 min-h-0 flex-1 overflow-y-auto overflow-x-hidden"},it.createElement("div",{className:"h-full min-h-0 "+("editor"!==Me?"max-lg:hidden":"")},it.createElement(OS,{content:N,contentType:k,fileName:B,onFileNameChange:C,onContentChange:T,onContentTypeChange:A,onContentEncodingChange:q,compressBeforeInscribe:K,onCompressBeforeInscribeChange:X,onImportJson:tn,contentSize:_,feeRate:re,onFeeRateChange:Xt,feeEstimate:de,walletAddress:e?.address,walletState:e,walletInscriptions:c,selectedUtxos:ce,onUtxosChange:t=>{const n=new Set(zt.filter(e=>e.reinscriptionTargetData?.utxo).map(e=>`${e.reinscriptionTargetData.utxo.txid}:${e.reinscriptionTargetData.utxo.vout}`));let r=Array.isArray(t)?t.filter(e=>!n.has(`${e.txid}:${e.vout}`)):[];const i=e?.ordinalsAddress,a=e?.paymentAddress||e?.address;i&&a&&i!==a&&(r=r.filter(e=>(e.address||a)!==i)),ue(r),qe(),t.length,r.length},onUtxoSelect:t=>{const n=new Set(zt.filter(e=>e.reinscriptionTargetData?.utxo).map(e=>`${e.reinscriptionTargetData.utxo.txid}:${e.reinscriptionTargetData.utxo.vout}`)),r=`${t.txid}:${t.vout}`,i=e?.ordinalsAddress,a=e?.paymentAddress||e?.address;n.has(r)?ge({type:"error",message:"This UTXO is a reinscription target and cannot fund commit fees."}):i&&a&&i!==a&&(t.address||a)===i?ge({type:"error",message:"This UTXO belongs to your ordinals address and is excluded from payment selection."}):ue(e=>e.some(e=>e.txid===t.txid&&e.vout===t.vout)?e.filter(e=>!(e.txid===t.txid&&e.vout===t.vout)):[...e,t])},onFeesLoaded:e=>{if(oe(e),le(function(){const e=function(){try{const e=sessionStorage.getItem(Lw);return e?JSON.parse(e):null}catch(Kh){return null}}();return e?e.isDefault?{status:"default",message:"Using default rates (network unavailable)",color:"yellow"}:!(t=e.timestamp)||Date.now()-t>3e5?{status:"stale",message:"Fee rates are outdated (click refresh)",color:"orange"}:{status:"fresh",message:"Fee rates up to date",color:"green"}:{status:"not-loaded",message:"Fee rates not loaded",color:"gray"};var t}()),e&&!e.isDefault&&null===re){const t="number"==typeof e.slow&&e.slow>=o?e.slow:"number"==typeof e.medium&&e.medium>=o?e.medium:null;null!==t&&ie(t)}},onFilteredUtxosLoaded:async t=>{try{if(!e?.isConnected)return;if(!t)return;x(e=>({...e||{},status:"extracting",phase:"inscriptions",message:"Extracting inscriptions from wallet UTXOs\u2026",error:"",ts:Date.now()})),qe(),f(!0);const i=e?.ordinalsAddress||e?.address||"",a=e?.paymentAddress||e?.address||"",{getCachedInscriptions:o,setCachedInscriptions:s}=await n(async()=>{const{getCachedInscriptions:e,setCachedInscriptions:t}=await Promise.resolve().then(()=>VB);return{getCachedInscriptions:e,setCachedInscriptions:t}},__VITE_PRELOAD__),l=i&&o(i)||[];let d=[];if(l.length>0)d=l;else{const e=Array.isArray(t)?t.filter(e=>e.reason||e.assetCheck):t.unsafe||[],{extractInscriptionsFromUtxos:r}=await n(async()=>{const{extractInscriptionsFromUtxos:e}=await Promise.resolve().then(()=>UB);return{extractInscriptionsFromUtxos:e}},__VITE_PRELOAD__);d=await r(e),a&&d.length>0&&s(a,d)}const p=i||a;let m=d.map(e=>{const t=c.find(t=>t.id===e.id||t.id===e.rawId);return t?{...t,address:e.address||t.address||p,utxo:{...t.utxo||{},...e.utxo||{},address:e.utxo?.address||e.address||t.utxo?.address||p}}:{...e,address:e.address||p,utxo:{...e.utxo||{},address:e.utxo?.address||e.address||p}}});const h=m.filter(e=>{const t=e.contentType||e.content_type;return!(t&&"application/octet-stream"!==t||e.satpoint)});if(h.length>0){const{enrichInscriptions:e}=await n(async()=>{const{enrichInscriptions:e}=await Promise.resolve().then(()=>US);return{enrichInscriptions:e}},__VITE_PRELOAD__);try{(await e(h,e=>{})).forEach(e=>{const t=m.findIndex(t=>t.id===e.id);if(-1!==t){const n=m[t];m[t]={...e,address:e.address||n.address,utxo:{...e.utxo||{},...n.utxo||{},address:n.utxo?.address||e.address||n.address}}}})}catch(uC){}}try{const e=[i,a].filter(Boolean).flatMap(e=>o(e)||[]);if(e.length>0){const t=new Map;[...m,...e].forEach(e=>{e&&e.id&&t.set(e.id,{...t.get(e.id),...e})}),m=Array.from(t.values())}}catch(r){}try{const e=new Set((d||[]).map(e=>e&&(e.id||e.rawId)).filter(Boolean));e.size>0&&(m=m.filter(t=>e.has(t.id)))}catch(r){}u(m),f(!1);const g=m.filter(e=>e.utxo&&e.utxo.txid&&void 0!==e.utxo.vout&&e.utxo.value&&e.utxo.address);m.length,g.length,b(t),x(e=>({...e||{},status:"ready",phase:"done",message:`Wallet assets ready (${m.length} inscription(s)).`,error:"",ts:Date.now(),lastSuccessAt:Date.now(),inscriptionCount:m.length}))}catch(uC){f(!1),x(t=>({...t||{},status:"error",phase:"inscriptions",message:"",error:uC?.message||String(uC),ts:Date.now()}))}},utxoRescanRequestId:v,onUtxoScanStateChange:I,walletAssetScanState:w,onRequestWalletRescan:E,inscribing:pe,selectedParents:p,reinscriptionTarget:h,delegateId:O,metaprotocol:F,metadata:U,properties:$,pointer:W,contentEncoding:j,recipientAddress:Q,repeatCount:te,onRepeatCountChange:ne,batchItems:zt,onAddToBatch:t=>{const n=t.reinscriptionTarget;let r=null;if(n){const e=n.split(",").filter(Boolean),t=e[e.length-1];if(r=c.find(e=>e.id===t),!r)return void ge({type:"error",message:`\u26a0\ufe0f Reinscription target ${t} not found. Please refresh your inscriptions.`})}const i=!!r;if(i){const e=r;if(!(e.utxo&&e.utxo.txid&&void 0!==e.utxo.vout&&e.utxo.value&&e.utxo.address))return void ge({type:"error",message:`\u26a0\ufe0f Reinscription target ${e.id} is missing complete UTXO data. Please refresh your inscriptions list.`})}const a=i?r.id:null,o=i?r:null,s=a?e?.ordinalsAddress||o?.utxo?.address||e?.address:t.recipientAddress||Q||e?.ordinalsAddress||e?.address,l=((e,t=0)=>{try{if(!e)return 0;if(e instanceof ArrayBuffer)return e.byteLength;if("object"==typeof e&&void 0!==e.byteLength)return e.byteLength||e.length||0;if("string"==typeof e&&e.startsWith("data:")){const t=e.indexOf(",");if(-1!==t){const n=e.slice(t+1);return"undefined"!=typeof atob?atob(n).length:Buffer.from(n,"base64").length}}return"string"==typeof e?new Blob([e]).size:Number.isFinite(t)?t:e.length||0}catch{return Number.isFinite(t)?t:e&&e.length?e.length:0}})(t.content,t.contentSize),u={id:Date.now()+Math.random(),content:t.content,contentType:t.contentType,contentSize:l,uncompressedContentSize:l,fileName:t.fileName||"",recipientAddress:s,parentIds:t.selectedParents?.map(e=>e.id)||[],reinscriptionTargetId:a,reinscriptionTargetData:o,mode:"standard",delegateId:t.delegateId||"",metadata:t.metadata||"",metaprotocol:t.metaprotocol||"",properties:t.properties||"",customTags:t.customTags&&"object"==typeof t.customTags?t.customTags:null,contentEncoding:t.contentEncoding||"",compressBeforeInscribe:!!t.compressBeforeInscribe,pointer:t.pointer||"",features:t.features||[]};try{en(u)}catch(cC){return void ge({type:"error",message:cC.message||"Invalid content"})}if(u.reinscriptionTargetId&&zt.find(e=>e.reinscriptionTargetId===u.reinscriptionTargetId))return void ge({type:"error",message:`\u274c This reinscription target (${u.reinscriptionTargetId.substring(0,16)}...) is already in the batch. Each UTXO can only be reinscribed once per batch. You can still use it as a parent in other items.`});const d=parseInt(t.repeatCount,10),f=u.reinscriptionTargetId?1:Math.max(1,Math.min(200,Number.isFinite(d)?d:1)),p=Array.from({length:f},()=>({...u,id:Date.now()+Math.random()}));Wt(e=>{const t=[...e,...p],n=Gt(t);return n&&fe(n),t}),u.compressBeforeInscribe&&!String(u.contentEncoding||"").trim()&&(async()=>{try{if("string"==typeof u.content&&u.content.startsWith("data:"))return;const e=e=>"string"==typeof e?(new TextEncoder).encode(e):e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):(new TextEncoder).encode(String(e??"")),t=await ub(e(u.content)),n=t?.length;if(!Number.isFinite(n)||n<=0)return;const r=new Set(p.map(e=>e.id));Wt(e=>{const t=e.map(e=>{if(!e||!r.has(e.id))return e;if(String(e.contentEncoding||"").trim())return e;if(!e.compressBeforeInscribe)return e;const t=Array.isArray(e.features)?e.features.includes("\ud83e\uddf1 Brotli")?e.features:[...e.features,"\ud83e\uddf1 Brotli"]:["\ud83e\uddf1 Brotli"];return{...e,compressedContentSize:n,contentSize:n,features:t}}),i=Gt(t);return i&&fe(i),t})}catch(e){}})(),T(""),A("text/plain"),C(""),P(0),m([]),g(null),L(""),M(""),R(""),z(null),V(""),Z(""),X(!1),ge({type:"success",message:`\u2705 Added to batch (+${f}). Form cleared - add another!`}),setTimeout(()=>ge(null),3e3)},onRemoveFromBatch:e=>{Wt(t=>{const n=t.filter((t,n)=>n!==e),r=Gt(n);return fe(r),n}),ge({type:"info",message:"Removed item from batch"})},onEditBatchItem:(e,t)=>{if(t){if(Wt(n=>{const r=n.map((n,r)=>{if(r!==e)return n;const i={...n,...t},a=String(i.contentEncoding||"").trim(),o=!!i.compressBeforeInscribe&&!a,s=Number.isFinite(i.compressedContentSize)&&i.compressedContentSize>0,l=Number.isFinite(i.uncompressedContentSize)?i.uncompressedContentSize:Number.isFinite(i.contentSize)?i.contentSize:0,c=Array.isArray(i.features)?i.features:[];let u=c;return o?c.includes("\ud83e\uddf1 Brotli")||(u=[...c,"\ud83e\uddf1 Brotli"]):u=c.filter(e=>"\ud83e\uddf1 Brotli"!==e),{...i,uncompressedContentSize:l,contentSize:o?s?i.compressedContentSize:i.contentSize:l,features:u}}),i=Gt(r);return fe(i),r}),Object.prototype.hasOwnProperty.call(t,"compressBeforeInscribe")&&t.compressBeforeInscribe){const t=zt[e],n=!!String(t?.contentEncoding||"").trim(),r=Number.isFinite(t?.compressedContentSize)&&t.compressedContentSize>0;n||!t||r||(async()=>{try{if("string"==typeof t.content&&t.content.startsWith("data:"))return;const n=e=>"string"==typeof e?(new TextEncoder).encode(e):e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):(new TextEncoder).encode(String(e??"")),r=await ub(n(t.content)),i=r?.length;if(!Number.isFinite(i)||i<=0)return;Wt(t=>{const n=t.map((t,n)=>{if(n!==e)return t;if(String(t?.contentEncoding||"").trim())return t;if(!t.compressBeforeInscribe)return t;const r=Number.isFinite(t.uncompressedContentSize)?t.uncompressedContentSize:t.contentSize||0,a=Array.isArray(t.features)?t.features:[],o=a.includes("\ud83e\uddf1 Brotli")?a:[...a,"\ud83e\uddf1 Brotli"];return{...t,uncompressedContentSize:r,compressedContentSize:i,contentSize:i,features:o}}),r=Gt(n);return fe(r),n})}catch(n){}})()}return}const n=zt[e];T(n.content),A(n.contentType),C(n.fileName||""),Z(n.recipientAddress),L(n.delegateId),M(n.metadata),R(n.metaprotocol),z(n.customTags||null),V(n.pointer),q(n.contentEncoding||""),X(!!n.compressBeforeInscribe);const r=c.filter(e=>n.parentIds.includes(e.id));m(r),n.reinscriptionTargetId?g(n.reinscriptionTargetId):g(null),Wt(t=>{const n=t.filter((t,n)=>n!==e),r=Gt(n);return fe(r),n}),ge({type:"info",message:'Editing item - make changes and click "Add to Batch"'})},inscriptionMode:s,selectedSaleInscription:bt(),salePriceSats:Ke,onSalePriceSatsChange:Xe,listingScriptAddress:Ge,onListingScriptAddressChange:Ye,markerValueSats:Je,onMarkerValueSatsChange:Qe,listingDryRun:Ze,onListingDryRunChange:et,saleMinBlockHeight:tt,onSaleMinBlockHeightChange:nt,onCreateListingTx:wt,onCreateBulkListingTx:At,createListingDisabled:!e?.isConnected||!bt()||!String(Ke||"").trim(),sellerStatus:xt,sellerError:vt,bulkSellerStatus:Nt,bulkSellerError:Tt,bulkBundleJson:_t,collectionAuthoritySlots:Bt,collectionAuthorityStatus:Ct,collectionAuthorityError:Ot,collectionAuthoritySlotId:Lt,onCollectionAuthoritySlotIdChange:Ft,onLaunchCollection:Ut,onLaunchParcelManifest:$t,manualSellerPsbt:It.manualSellerPsbt,manualSellerStatus:It.manualSellerStatus,manualSellerError:It.manualSellerError,onCreateManualSellerOfferPsbt:It.onCreateManualSellerOfferPsbt?async()=>{We();try{return await It.onCreateManualSellerOfferPsbt()}finally{Ve()}}:void 0,manualBuyStatus:It.manualBuyStatus,manualBuyError:It.manualBuyError,onBuyFromSellerOfferPsbt:It.onBuyFromSellerOfferPsbt?async e=>{We();try{return await It.onBuyFromSellerOfferPsbt(e)}finally{Ve()}}:void 0,manualBuyerFundedPsbt:It.manualBuyerFundedPsbt,manualBuyerFundedStatus:It.manualBuyerFundedStatus,manualBuyerFundedError:It.manualBuyerFundedError,onCreateBuyerFundedPsbtForSeller:It.onCreateBuyerFundedPsbtForSeller?async e=>{We();try{return await It.onCreateBuyerFundedPsbtForSeller(e)}finally{Ve()}}:void 0,manualSellerCountersignStatus:It.manualSellerCountersignStatus,manualSellerCountersignError:It.manualSellerCountersignError,onCountersignAndBroadcastFromBuyerFundedPsbt:It.onCountersignAndBroadcastFromBuyerFundedPsbt?async e=>{We();try{return await It.onCountersignAndBroadcastFromBuyerFundedPsbt(e)}finally{Ve()}}:void 0,buyRevealTxid:at,onBuyRevealTxidChange:ot,onBuyFromRevealTx:async()=>{ut(""),lt("");let t=null;We();try{if(!e?.isConnected)throw new Error("Wallet not connected");const i=String(at||"").trim(),a=/^[0-9a-fA-F]{64}$/.test(i),o=/^[0-9a-fA-F]{64}i\d+$/.test(i.split(":")[0]);if(!a&&!o)throw new Error("Enter a valid reveal txid (64 hex) or inscription id (<txid>i<index>)");const s=y?Array.isArray(y)?y:y.spendable||[]:[],l=t=>{const n=[...Array.isArray(s)?s:[],...Array.isArray(ce)?ce:[]];if(!Array.isArray(n)||0===n.length)return[];const r=n.map(n=>{if(!n)return null;const r=n?.fullUtxo||n?.utxo||n?.raw||n?.full||n,i=r.txid||r.txId||r.hash,a=r.vout??r.index??r.n,o=r.value??r.satoshis??r.amount,s=r.address||r.addr||t;if(!i||null==a)return null;const l=Number(o);if(!Number.isFinite(l)||l<=0)return null;const c=e?.ordinalsAddress||null,u=e?.paymentAddress||null;if(c&&u&&c!==u){const e=String(s||"").trim();if(e&&e===String(c).trim())return null}return{txid:String(i),vout:Number(a),value:l,address:s}}).filter(Boolean),i=new Map;return r.forEach(e=>i.set(`${e.txid}:${e.vout}`,e)),Array.from(i.values())},c=e?.provider||window.NexusWalletConnect;if(!c)throw new Error("Wallet provider not available");const u=e?.paymentAddress||e?.address||e?.ordinalsAddress,d=e?.ordinalsAddress||e?.address||e?.paymentAddress;if(!u)throw new Error("Wallet payment/change address not available");if(!d)throw new Error("Wallet ordinals/receive address not available");const f=l(u);if(!Array.isArray(f)||0===f.length)throw new Error("No spendable payment UTXOs loaded. Click \u201cFetch UTXOs\u201d first (or select UTXOs).");const p=f.reduce((e,t)=>e+(Number(t?.value)||0),0);let m=f;if(f.length<3){try{lt("Checking listing requirements before split-funding\u2026");const{estimateBuyNeedFromRevealTx:e,estimateBuyNeedFromInscriptionId:t}=await n(async()=>{const{estimateBuyNeedFromRevealTx:e,estimateBuyNeedFromInscriptionId:t}=await Promise.resolve().then(()=>Ow);return{estimateBuyNeedFromRevealTx:e,estimateBuyNeedFromInscriptionId:t}},__VITE_PRELOAD__),r=a?await e({walletProvider:c,revealTxid:i,buyerChangeAddress:u,feeRateSatPerVb:re}):await t({walletProvider:c,inscriptionId:i,buyerChangeAddress:u,feeRateSatPerVb:re}),o=BigInt(Math.max(0,Math.floor(Number(p)||0))),s=BigInt(r?.needTotalSats||0n);if(s>0n&&o<s){const e=s-o;throw new Error(`Insufficient buyer funds to buy (skipping split-funding). Need >= ${s.toString()} sats (estFee\u2248${String(r?.feeEstimateSats||"?")}), have ${o.toString()} sats, short ${e.toString()} sats.`)}}catch(r){const e=r?.message||String(r);if(String(e).includes("skipping split-funding"))throw r}lt("Not enough payment UTXOs \u2014 creating split funding tx first...");const{createSplitFundingTransaction:o}=await n(async()=>{const{createSplitFundingTransaction:e}=await Promise.resolve().then(()=>lC);return{createSplitFundingTransaction:e}},__VITE_PRELOAD__),s=await o({walletProvider:c,networkName:e.network?.toLowerCase?.()||"mainnet",paymentAddress:u,paymentPublicKeyHex:e?.paymentPublicKey||null,paymentCandidates:f,feeRateSatPerVb:re,dummySats:600,minRemainderSats:546,label:"buy-funding-split"});if(t=s?.txid||null,t&&lt(`Split funding tx broadcasted (creates 2\xd7600 sat dummies). Mempool: ${nh(`/tx/${t}`)}. Continuing buy\u2026`),m=[...f.filter(e=>`${e.txid}:${e.vout}`!==s.spentOutpoint),...s.splitUtxos||[]],m.length<3)throw new Error("Split completed but still insufficient payment UTXOs to buy. Click \u201cFetch UTXOs\u201d and try again.")}const{createAndBroadcastBuyFromRevealTx:h,createAndBroadcastBuyFromInscriptionId:g}=await n(async()=>{const{createAndBroadcastBuyFromRevealTx:e,createAndBroadcastBuyFromInscriptionId:t}=await Promise.resolve().then(()=>Ow);return{createAndBroadcastBuyFromRevealTx:e,createAndBroadcastBuyFromInscriptionId:t}},__VITE_PRELOAD__),b=t?` Split funding tx: ${nh(`/tx/${t}`)}.`:"";lt(a?`Fetching reveal tx \u2192 extracting seller PSBT \u2192 building buyer PSBT \u2192 wallet signing...${b}`:`Parsing inscription id \u2192 fetching reveal tx \u2192 extracting seller PSBT \u2192 building buyer PSBT \u2192 wallet signing...${b}`);const w=a?await h({walletProvider:c,revealTxid:i,buyerPaymentUtxos:m,buyerChangeAddress:u,buyerReceiveAddress:d,feeRateSatPerVb:re,broadcast:!0}):await g({walletProvider:c,inscriptionId:i,buyerPaymentUtxos:m,buyerChangeAddress:u,buyerReceiveAddress:d,feeRateSatPerVb:re,broadcast:!0});"buy-complete"===w?.mode&&w?.buyTxid&&xe({buyTxid:w.buyTxid,inferredPriceSats:w.inferredPriceSats||null,feeSats:w.feeSats||null});const x=String(w?.buyTxid||"").slice(0,12),v=w?.inferredPriceSats;lt(`Bought. txid=${x}\u2026 price\u2248${v} sats`)}catch(cC){lt("");let n=cC?.message||String(cC);if(cC?.response?.data){const t=cC.response.data;"string"==typeof t?n=`${n} - ${t}`:t?.error?n=`${n} - ${t.error}`:t?.message&&(n=`${n} - ${t.message}`)}t&&(n=`${n} | Split funding tx: ${t} | Mempool: ${nh(`/tx/${t}`)}`),ut(n)}finally{Ve()}},buyDisabled:!e?.isConnected||!String(at||"").trim(),buyStatus:st,buyError:ct,buyFundingNeeded:Dt,onCreateBuyFundingTx:async()=>{mt(""),ft(""),We();try{if(!e?.isConnected)throw new Error("Wallet not connected");const t=e?.provider||window.NexusWalletConnect;if(!t)throw new Error("Wallet provider not available");const r=e?.paymentAddress||e?.address||e?.ordinalsAddress;if(!r)throw new Error("Wallet payment address not available");const i=y?Array.isArray(y)?y:y.spendable||[]:[],a=[...Array.isArray(i)?i:[],...Array.isArray(ce)?ce:[]],o=t=>{if(!t)return null;const n=t?.fullUtxo||t?.utxo||t?.raw||t?.full||t,i=n.txid||n.txId||n.hash,a=n.vout??n.index??n.n,o=n.value??n.satoshis??n.amount,s=n.address||n.addr||r;if(!i||null==a)return null;const l=Number(o);if(!Number.isFinite(l)||l<=0)return null;const c=e?.ordinalsAddress||null,u=e?.paymentAddress||null;if(c&&u&&c!==u){const e=String(s||"").trim();if(e&&e===String(c).trim())return null}return{txid:String(i),vout:Number(a),value:l,address:s}},s=(Array.isArray(a)?a:[]).map(o).filter(Boolean),l=new Map;s.forEach(e=>l.set(`${e.txid}:${e.vout}`,e));const c=Array.from(l.values());if(!Array.isArray(c)||c.length<1)throw new Error("No payment UTXOs available to split. Fund your payment address first.");c.length>=3&&ft("You already have 3+ payment UTXOs \u2014 splitting anyway (testing mode).");const u=Number(re||0);if(!Number.isFinite(u)||u<=0)throw new Error("Set a fee rate first (sat/vB) before creating a split funding transaction.");const d=e.network?.toLowerCase?.()||"mainnet";ft("Creating split funding tx (wallet popup)\u2026");const{createSplitFundingTransaction:f}=await n(async()=>{const{createSplitFundingTransaction:e}=await Promise.resolve().then(()=>lC);return{createSplitFundingTransaction:e}},__VITE_PRELOAD__),{txid:p}=await f({walletProvider:t,networkName:d,paymentAddress:r,paymentPublicKeyHex:e?.paymentPublicKey||null,paymentCandidates:c,feeRateSatPerVb:u,dummySats:600,minRemainderSats:546,label:"buy-funding-split"});ft(`Split funding tx broadcasted. Mempool: ${nh(`/tx/${p}`)}. Click \u201cFetch UTXOs\u201d to refresh.`),gt({fundingTxid:p})}catch(cC){ft(""),mt(cC?.message||String(cC))}finally{Ve()}},buyFundingDisabled:!e?.isConnected,buyFundingStatus:dt,buyFundingError:pt,tabRequest:Oe,oodlSection:Ee,onOodlSectionChange:Ie,onOodlLayoutChange:e=>{Ae(!!e?.showAdvancedOptions),e&&"object"==typeof e&&("boolean"==typeof e.limitParentSelection?Te(e.limitParentSelection):e?.showAdvancedOptions&&Te(!0),"string"==typeof e.parentsLabel&&e.parentsLabel.trim()?Pe(e.parentsLabel.trim()):Pe(e?.showAdvancedOptions?"Inscriptions":"Parents"))},onActiveTabChange:e=>{Se(e),"oodl"!==e&&Ae(!1),e&&"utxos"!==e&&"oodl"!==e&&Ue(e)}})),"oodl"!==ve||ke?it.createElement("div",{className:"min-h-[200px] lg:min-h-0 overflow-hidden "+("options"!==Me?"max-lg:hidden":"")},it.createElement("div",{className:"bg-neutral-900/50 border border-neutral-800/50 rounded-xl h-full flex flex-col overflow-hidden"},it.createElement($S,{delegateId:O,onDelegateChange:L,reinscriptionTarget:h||"",onReinscriptionTargetChange:e=>{const t=e.split(",").filter(Boolean),n=t[t.length-1],r=c.find(e=>e.id===n);if(r){let e,n,i,a="unknown";if(r.utxo&&void 0!==r.utxo.txid&&void 0!==r.utxo.vout&&(e=r.utxo.txid,n=r.utxo.vout,i=r.utxo.address||r.address,a="utxo"),(!e||void 0===n)&&r.satpoint){const t=String(r.satpoint).split(":");t.length>=2&&(e=e||t[0],n=n??parseInt(t[1]),a="utxo"===a?"utxo+satpoint":"satpoint")}t.length}g(e)},recipientAddress:Q,onRecipientAddressChange:Z,selectedParents:p,inscriptionMode:s,onParentSelect:e=>{if(e&&"object"==typeof e&&"bulk"===e.type&&Array.isArray(e.parents))return void m(e.parents);const t=e.id||e.inscriptionId||e.inscription_id,n=p.some(e=>(e.id||e.inscriptionId||e.inscription_id)===t);m(n?e=>e.filter(e=>(e.id||e.inscriptionId||e.inscription_id)!==t):t=>[...t,e])},metaprotocol:F,onMetaprotocolChange:R,metadata:U,onMetadataChange:M,properties:$,onPropertiesChange:H,pointer:W,onPointerChange:V,walletInscriptions:c,loadingInscriptions:d,ordinalsAddress:e?.ordinalsAddress||e?.address||"",existingReinscriptionTargets:nn,limitParentSelection:!("oodl"!==ve||!ke||!Ne),showOnlyParents:"oodl"===ve&&ke,parentsLabel:"oodl"===ve&&ke?_e:"Parents"}))):null,"oodl"!==ve?it.createElement("div",{className:"min-h-[200px] lg:min-h-0 overflow-hidden "+("fees"!==Me?"max-lg:hidden":"")},it.createElement(jS,{feeRate:re,onFeeRateChange:Xt,feeEstimate:de,contentSize:_,feeRates:ae,feeItemCount:zt&&zt.length>0?zt.length:h?1:Math.max(1,Math.min(200,parseInt(te,10)||1)),onSubmit:Jt,isSubmitting:pe,isDisabled:(()=>{if(zt.length>0)return!1;const e=!!String(k||"").trim(),t=Qt(N),n=Zt({delegateId:O,metaprotocol:F,metadata:U,properties:$,selectedParents:p,reinscriptionTarget:h,pointer:W});return!e||!t&&!n})()})):null),it.createElement(JS,{activePanel:Me,onPanelChange:$e,visiblePanels:"oodl"===ve?ke?["editor","options"]:["editor"]:["editor","options","fees"],swipeContainerRef:He})),he&&it.createElement(qS,{type:he.type,message:he.message,onClose:()=>ge(null)}),ye&&it.createElement(KS,{result:ye,onClose:()=>{be(null),Fw(),T(""),P(0),m([]),ue([]),fe(null),Wt([]),jt(null)}}),St&&it.createElement(GS,{kind:"listing",result:St,onClose:()=>Et(null)}),we&&it.createElement(GS,{kind:"buy",result:we,onClose:()=>xe(null)}),ht&&it.createElement(GS,{kind:"funding",result:ht,onClose:()=>gt(null)}))}function aE({message:e="Loading...",subtext:t="",icon:n="\u23f3"}){return it.createElement("div",{className:"loading-overlay"},it.createElement("div",{className:"loading-spinner"},it.createElement("div",{className:"spinner-icon","aria-hidden":!0},n),it.createElement("h3",null,e),t?it.createElement("p",null,t):null))}const oE="nexus_last_wallet",sE={width:"100%",display:"flex",alignItems:"center",gap:"12px",fontSize:"15px",padding:"12px 14px",borderRadius:"10px",border:"1px solid rgba(255,255,255,0.12)",background:"rgba(255,255,255,0.08)",color:"#e5e5e5",cursor:"pointer",transition:"all 0.15s ease"},lE=({wallet:e,walletConfig:t,onClick:n,disabled:r,isConnecting:i,isLastUsed:a})=>it.createElement("button",{onClick:n,disabled:r,style:{...sE,opacity:r?.5:1,cursor:r?"not-allowed":"pointer"},onMouseEnter:e=>{r||(e.currentTarget.style.background="rgba(255,255,255,0.14)",e.currentTarget.style.borderColor="rgba(168,85,247,0.4)")},onMouseLeave:e=>{e.currentTarget.style.background="rgba(255,255,255,0.08)",e.currentTarget.style.borderColor="rgba(255,255,255,0.12)"}},it.createElement("span",{style:{flex:1,textAlign:"left",fontWeight:500}},i?"\u23f3 Connecting\u2026 ":"",e.name,a&&it.createElement("span",{style:{fontSize:"10px",marginLeft:"8px",color:"rgba(168,85,247,0.7)",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.05em"}},"Last used")),it.createElement("span",{style:{opacity:.25,fontSize:"14px",fontWeight:300}},"\u2192")),cE=({config:e})=>it.createElement("a",{href:e.installUrl,target:"_blank",rel:"noopener noreferrer",style:{...sE,opacity:.55,textDecoration:"none",cursor:"pointer"},onMouseEnter:e=>{e.currentTarget.style.opacity="0.8",e.currentTarget.style.borderColor="rgba(255,255,255,0.15)"},onMouseLeave:e=>{e.currentTarget.style.opacity="0.55",e.currentTarget.style.borderColor="rgba(255,255,255,0.12)"}},it.createElement("span",{style:{flex:1,textAlign:"left",fontWeight:500}},e.name),it.createElement("span",{style:{fontSize:"11px",opacity:.7,fontWeight:500}},"Install \u2197")),uE=({children:e,style:t})=>it.createElement("p",{style:{fontSize:"11px",textTransform:"uppercase",letterSpacing:"0.06em",color:"rgba(255,255,255,0.35)",margin:"0 0 6px 2px",fontWeight:600,...t}},e),dE=({isOpen:e,onClose:t,installedWallets:n,wallets:r,onConnectWallet:i,onOpenMobileWallet:a,loading:o,connectingWallet:s})=>{const[l,c]=rt.useState(!1);if(rt.useEffect(()=>{e||c(!1)},[e]),!e)return null;const u=e=>String(e||"").toLowerCase().replace(/\s+/g,""),d=Array.isArray(r)?r:[],f=(()=>{try{return localStorage.getItem(oE)||null}catch{return null}})(),p=(()=>{try{return"undefined"!=typeof window?String(window.location?.href||""):""}catch{return""}})(),m=p?`https://api.qrserver.com/v1/create-qr-code/?size=220x220&data=${encodeURIComponent(p)}`:"",h=e=>{const t=u(e?.name),n=u(e?.id);return d.find(e=>u(e?.name)===t)||d.find(e=>u(e?.id)===n)||fE.find(e=>u(e?.name)===t)||fE.find(e=>u(e?.id)===n)},g=new Set((n||[]).map(e=>u(e?.name))),y=f?(n||[]).find(e=>u(e?.name)===u(f)):null,b=(n||[]).filter(e=>!(y&&u(e?.name)===u(y?.name))),w=fE.filter(e=>!g.has(u(e?.name))),x=e=>{(e=>{try{e&&localStorage.setItem(oE,e)}catch{}})(e),i(e)},v=w.length>0;return it.createElement("div",{className:"modal-overlay",onClick:t,style:{zIndex:99999}},it.createElement("div",{className:"modal-card",onClick:e=>e.stopPropagation()},it.createElement("div",{className:"modal-header"},it.createElement("h2",{className:"modal-title"},"Select Wallet"),it.createElement("button",{className:"modal-close",onClick:t},"\u2715")),it.createElement("div",{className:"modal-body"},0===n.length?it.createElement("div",{className:"empty-state"},it.createElement("div",{className:"empty-state-icon"},"\ud83d\udd0d"),it.createElement("h3",{className:"empty-state-title"},"No Wallets Detected"),it.createElement("p",{className:"empty-state-description"},"No injected wallet provider was found.",it.createElement("br",null),it.createElement("br",null),it.createElement("strong",null,"Desktop:")," Install a Bitcoin wallet browser extension.",it.createElement("br",null),it.createElement("strong",null,"Mobile:")," Open this site inside your wallet app."),it.createElement(uE,{style:{margin:"12px 0 8px 2px",width:"100%"}},"Install a wallet"),it.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"6px",width:"100%"}},fE.filter(e=>e.installUrl).map(e=>it.createElement(cE,{key:e.id,config:e}))),it.createElement(uE,{style:{margin:"16px 0 8px 2px",width:"100%"}},"Or open in mobile app"),it.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"6px",width:"100%"}},[{label:"Open in Xverse",key:"Xverse"},{label:"Open in UniSat",key:"UniSat"},{label:"Open in Magic Eden",key:"MagicEden"}].map(({label:e,key:t})=>it.createElement("button",{key:t,className:"btn btn-secondary",disabled:o||"function"!=typeof a,onClick:()=>a&&a(t),style:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"14px"}},it.createElement("span",null,e),it.createElement("span",{style:{opacity:.3,fontSize:"13px"}},"\u2197")))),p?it.createElement("div",{style:{marginTop:"16px",width:"100%"}},it.createElement("div",{style:{fontSize:"13px",opacity:.7,marginBottom:"8px"}},"Or scan this QR code in your wallet app:"),m?it.createElement("div",{style:{display:"flex",justifyContent:"center",marginBottom:"8px"}},it.createElement("img",{src:m,alt:"QR code",style:{width:180,height:180,borderRadius:8}})):null,it.createElement("a",{href:p,style:{wordBreak:"break-all",fontSize:"11px",opacity:.5}},p)):null):it.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"4px"}},y&&it.createElement(it.Fragment,null,it.createElement(uE,null,"Last used"),it.createElement(lE,{wallet:y,walletConfig:h(y),onClick:()=>x(y.name),disabled:o,isConnecting:s===y.name,isLastUsed:!0})),b.length>0&&it.createElement(it.Fragment,null,it.createElement(uE,{style:{marginTop:y?"14px":"0"}},"Detected"),b.map(e=>it.createElement(lE,{key:e.name,wallet:e,walletConfig:h(e),onClick:()=>x(e.name),disabled:o,isConnecting:s===e.name}))),v&&it.createElement(it.Fragment,null,l?it.createElement(it.Fragment,null,it.createElement(uE,{style:{marginTop:"14px"}},"Available"),w.map(e=>it.createElement(cE,{key:e.id,config:e}))):it.createElement("button",{onClick:()=>c(!0),style:{marginTop:"12px",background:"none",border:"none",color:"rgba(255,255,255,0.4)",fontSize:"12px",cursor:"pointer",padding:"6px 2px",textAlign:"left",fontWeight:500},onMouseEnter:e=>{e.currentTarget.style.color="rgba(255,255,255,0.65)"},onMouseLeave:e=>{e.currentTarget.style.color="rgba(255,255,255,0.4)"}},"\u25be"," Show ",w.length," more wallet",1!==w.length?"s":""))))))},fE=[{id:"bitmapwallet",name:"BitmapWallet",color:"cyan",installUrl:"https://chromewebstore.google.com/detail/bitmapwallet/cpmkedoipcpimgecpmgplbnienfhgfoi"},{id:"unisat",name:"UniSat",color:"orange",installUrl:"https://chromewebstore.google.com/detail/unisat-wallet/ppbibelpcjmhbdihakflkdcoccbgbkpo"},{id:"xverse",name:"Xverse",color:"blue",installUrl:"https://chromewebstore.google.com/detail/xverse-wallet/idnnbdplmphpflfnlkomgpfbpcgelopg"},{id:"okx",name:"OKX",color:"black",installUrl:"https://chromewebstore.google.com/detail/okx-wallet/mcohilncbfahbmgdjkbpemcciiolgcge"},{id:"leather",name:"Leather",color:"brown",installUrl:"https://chromewebstore.google.com/detail/leather/ldinpeekobnhjjdofggfgjlcehidnlci"},{id:"phantom",name:"Phantom",color:"purple",installUrl:"https://chromewebstore.google.com/detail/phantom/bfnaelmomeimhlpmgjnjophhpkkoljpa"},{id:"wizz",name:"Wizz",color:"green",installUrl:"https://chromewebstore.google.com/detail/wizz-wallet/ghlmndacnhlaekppcllcpcjjjomjkjpg"},{id:"oyl",name:"Oyl",color:"red",installUrl:"https://chromewebstore.google.com/detail/oyl-wallet/ilhmamhpjpgpmajkhnpcdiagbjfmmpnp"},{id:"magiceden",name:"Magic Eden",color:"violet",installUrl:"https://chromewebstore.google.com/detail/magic-eden/mkpegjkblkkefacfnmkajcjmabijhclg"}],pE=()=>{const[e,t]=rt.useState(!1),[r,i]=rt.useState(!0),[a,o]=rt.useState({isConnected:!1,walletType:null,address:null,balance:0}),[s,l]=rt.useState(!1),[c,u]=rt.useState(null),[d,f]=rt.useState(!1),[p,m]=rt.useState([]),h=fE;return rt.useEffect(()=>{window.NexusBitcoinProxy={config:Qy,openPopup:async(e,t={},n={})=>new Promise((r,i)=>{const a=`req_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,o=rb();let s;try{s=new URL(o,window.location.href).origin}catch(cC){return void i(new Error("Invalid Bitcoin proxy URL (origin parse failed)"))}const l=(()=>{try{const e=("undefined"!=typeof globalThis?globalThis.__NEXUS_BITCOIN_PROXY_ALLOWED_ORIGINS__:null)??null;if(!e)return null;const t=Array.isArray(e)?e:String(e).split(",").map(e=>e.trim()).filter(Boolean);if(0===t.length)return null;const n=t.map(e=>{try{return new URL(e,window.location.href).origin}catch{return null}}).filter(Boolean);return n.length>0?n:null}catch{return null}})();if(l&&!l.includes(s))return void i(new Error(`Bitcoin proxy origin not allowed: ${s}`));const c=Number.isFinite(n.pollMs)?n.pollMs:100,u=Number.isFinite(n.timeoutMs)?n.timeoutMs:{utxo:2e4,"utxo-with-fees":2e4,fees:15e3,inscriptions:2e4,ordinals:2e4,push:6e4,"push-package":6e4}[e]??2e4,d=`${o}/proxy-popup?requestId=${a}`,f=Math.round((window.screen.width-400)/2),p=Math.round((window.screen.height-300)/2),m=window.open(d,"NexusBitcoinProxy",`width=400,height=300,left=${f},top=${p},popup=yes,location=no,menubar=no,toolbar=no,scrollbars=no,resizable=no`);if(!m)return void i(new Error("Popup blocked. Please allow popups for this site."));let h=null,g=null,y=null,b=null,w=!1;const x=({closePopup:e=!1}={})=>{if(!w&&(w=!0,h&&(clearInterval(h),h=null),g&&(clearTimeout(g),g=null),y&&(clearTimeout(y),y=null),b&&(clearTimeout(b),b=null),window.removeEventListener("message",E),window.removeEventListener("message",I),e&&m&&!m.closed))try{m.close()}catch(t){}};let v=!1;const S=()=>{if(!v&&m&&!m.closed)try{m.postMessage({type:"NEXUS_PROXY_INIT",requestId:a,action:e,params:t},s),v=!0}catch{}};y=setTimeout(S,250),b=setTimeout(S,1e3);const E=n=>{n.data&&n.data.type&&"react-devtools-content-script"!==n.data.source&&n.origin===s&&n.source===m&&"NEXUS_PROXY_REQUEST_PARAMS"===n.data.type&&n.data.requestId===a&&(m.postMessage({type:"NEXUS_PROXY_INIT",requestId:a,action:e,params:t},s),v=!0,window.removeEventListener("message",E))};window.addEventListener("message",E);const I=e=>{e.data&&e.data.type&&"react-devtools-content-script"!==e.data.source&&e.origin===s&&e.source===m&&"NEXUS_PROXY_RESULT"===e.data.type&&e.data.requestId===a&&(x({closePopup:!1}),m&&!m.closed&&m.postMessage({type:"NEXUS_PROXY_ACK",requestId:a},s),e.data.success?r(e.data.result):i(new Error(e.data.error||"Unknown error")))};window.addEventListener("message",I),h=setInterval(()=>{m.closed&&(x({closePopup:!1}),i(new Error("Popup closed without completing request")))},c),g=setTimeout(()=>{x({closePopup:!0}),i(new Error(`Request timeout (${Math.round(u/1e3)}s)`))},u)}),async fetchUtxos(e){if(!this.config.ENABLED)throw new Error("Bitcoin Proxy disabled");return(await this.openPopup("utxo",{address:e},{timeoutMs:2e4,pollMs:100})).data},async broadcastTx(e){if(!this.config.ENABLED)throw new Error("Bitcoin Proxy disabled");return(await this.openPopup("push",{txHex:e},{timeoutMs:6e4,pollMs:100})).txid},async broadcastPackage(e,t=3e3){if(!this.config.ENABLED)throw new Error("Bitcoin Proxy disabled");if(!Array.isArray(e)||e.length<2)throw new Error("Package requires at least 2 transactions");const n=await this.openPopup("push-package",{transactions:e,waitMs:t},{timeoutMs:6e4,pollMs:100});return{commitTxId:n.commit.txid,revealTxId:n.reveal.txid,method:"package",details:n}},async getFees(){if(!this.config.ENABLED)throw new Error("Bitcoin Proxy disabled");return(await this.openPopup("fees",{},{timeoutMs:15e3,pollMs:100})).data},async getUtxosWithFees(e){if(!this.config.ENABLED)throw new Error("Bitcoin Proxy disabled");const t=Array.isArray(e)?e:[e],{FEE_CONFIG:r}=await n(async()=>{const{FEE_CONFIG:e}=await Promise.resolve().then(()=>Dg);return{FEE_CONFIG:e}},__VITE_PRELOAD__),{encodeAddresses:i}=await n(async()=>{const{encodeAddresses:e}=await Promise.resolve().then(()=>EB);return{encodeAddresses:e}},__VITE_PRELOAD__),a=i(t,r.platform.address),o=await this.openPopup("utxo-with-fees",{address:a},{timeoutMs:2e4,pollMs:100});return{utxos:o.utxos||[],fees:o.fees,providers:o.providers,addresses:o.addresses||t,addressCount:o.addressCount||t.length,addressUtxoMap:o.addressUtxoMap||{},platformFee:o.platformFee}},async fetchInscriptions(e){if(!this.config.ENABLED)throw new Error("Bitcoin Proxy disabled");return(await this.openPopup("inscriptions",{address:e},{timeoutMs:2e4,pollMs:100})).inscriptions||[]},async fetchOrdinals(e){if(!this.config.ENABLED)throw new Error("Bitcoin Proxy disabled");const t=String(e||"").trim();if(!t)throw new Error("fetchOrdinals: path is required");return await this.openPopup("ordinals",{path:t},{timeoutMs:2e4,pollMs:100})},async checkHealth(){const e=rb();try{const t=await fetch(`${e}/health`);if(!t.ok)throw new Error(`Health check failed: ${t.status}`);return await t.json()}catch(Kh){throw Kh}},setUrl:nb,getUrl:rb,getConfig:()=>({...Qy}),enable:()=>{Qy.ENABLED=!0},disable:()=>{Qy.ENABLED=!1},isEnabled:()=>Qy.ENABLED},window.NexusBitcoinProxy,async function(){if("undefined"==typeof window)return;const e=()=>{try{const e=window.bitmapWallet;return!!e&&("function"==typeof e.request||"function"==typeof e.requestAccounts||"function"==typeof e.connect||"function"==typeof e.getAccounts)}catch{return!1}},t=(e,t,n="operation")=>Promise.race([e,new Promise((e,r)=>setTimeout(()=>r(new Error(`${n} timed out after ${t}ms`)),t))]);try{await oh()}catch(Kh){}const n=window.NexusBitcoinProxy;window.NexusBitcoinProxy={async isEnabled(){try{return e()?(await t(oh(),750,"initBitcoinApi"),sh()||n&&await n.isEnabled()):n&&await n.isEnabled()}catch{return n&&await n.isEnabled()}},async getUrl(){try{if(await oh(),sh())return"bitmap-wallet"}catch{}return n?await n.getUrl():null},async getFees(){try{if(!e())throw new Error("Bitmap Wallet bridge not present");if(await t(oh(),1500,"initBitcoinApi"),!lh()){const e=await dh();if(e)return e}}catch(Kh){}if(n&&n.getFees)return await n.getFees();throw new Error("No network access method available - install Bitmap Wallet or enable Bitcoin Proxy")},async fetchUtxos(r,i="mainnet"){const a=Array.isArray(r)?r:[r];try{if(!e())throw new Error("Bitmap Wallet bridge not present");if(await t(oh(),1500,"initBitcoinApi"),!lh()){const e=await ch(a,i);if(e)return e}}catch(Kh){}if(n&&n.fetchUtxos)return await n.fetchUtxos(r,i);throw new Error("No network access method available - install Bitmap Wallet or enable Bitcoin Proxy")},async getUtxosWithFees(r,i="mainnet"){const a=Array.isArray(r)?r:[r];try{if(!e())throw new Error("Bitmap Wallet bridge not present");if(await t(oh(),1500,"initBitcoinApi"),!lh()){const[e,t]=await Promise.all([ch(a,i),dh(i)]),n={};e&&Array.isArray(e)&&e.forEach(e=>{const t=`${e.txid}:${e.vout}`;n[t]=e.address});const r=t?{fast:t.fastestFee||25,medium:t.halfHourFee||15,slow:t.hourFee||5,isDefault:!1}:{fast:25,medium:15,slow:5,isDefault:!0};return{utxos:e||[],addresses:a,addressCount:a.length,addressUtxoMap:n,fees:r,providers:["ordinals.com","mempool.space"],method:"bitmap-wallet"}}}catch(Kh){}if(n&&n.getUtxosWithFees)return await n.getUtxosWithFees(r,i);throw new Error("No network access method available - install Bitmap Wallet or enable Bitcoin Proxy")},async broadcastTx(e,t="mainnet"){try{if(await oh(),!lh())return await fh(e,t)}catch(Kh){}if(n&&"function"==typeof n.broadcastTx)return await n.broadcastTx(e,t);throw new Error("No broadcast method available - install Bitmap Wallet or enable Bitcoin Proxy")},async broadcastPackage(e){try{if(await oh(),!lh()){const t=[];for(const n of e)try{const e=await fh(n);t.push({success:!0,txid:e,error:null})}catch(Kh){t.push({success:!1,txid:null,error:Kh.message})}return{success:t.every(e=>e.success),results:t,method:"bitmap-wallet"}}}catch(Kh){}if(n&&n.broadcastPackage)return await n.broadcastPackage(e);throw new Error("No broadcast method available - install Bitmap Wallet or enable Bitcoin Proxy")},async fetchInscriptions(e){try{if(await oh(),!lh()){const t=await async function(e){if(ah||await oh(),lh())return[];const t=[];for(const n of e){const e=await ah.proxyFetch(th(`/wallet/${n}`),{method:"GET"});if(!e?.ok)continue;const r=await e.text();t.push(...uh(r,n))}return t}([e]);return t}}catch(Kh){}if(n&&n.fetchInscriptions)return await n.fetchInscriptions(e);throw new Error("No inscription fetch method available - install Bitmap Wallet or enable Bitcoin Proxy")}}}();const e=()=>{if(window.NexusWalletConnect){t(!0),o(window.NexusWalletConnect.getState());const e=e=>(e||[]).slice().sort((e,t)=>{const n=h.findIndex(t=>t.name===e.name),r=h.findIndex(e=>e.name===t.name);return-1===n?1:-1===r?-1:n-r}),n=[],r=()=>{const t=[250,750,1500,2500];for(const r of t)n.push(setTimeout(()=>{try{if(!window.NexusWalletConnect)return;const t=window.NexusWalletConnect.detectWallets();t&&t.length>0&&m(e(t))}catch(cC){}},r))};try{const t=window.NexusWalletConnect.detectWallets();t&&0!==t.length||((()=>{try{return window.top===window.self}catch(e){return!1}})(),(()=>{try{return String(window.location&&window.location.href)}catch(e){return null}})(),(()=>{try{return String(window.location&&window.location.protocol)}catch(e){return null}})(),"undefined"!=typeof window&&window.isSecureContext,window.acquireVsCodeApi,(()=>{try{return String(navigator&&navigator.userAgent)}catch(e){return null}})(),window.unisat,window.okxwallet,void 0!==window.BitcoinProvider||window.XverseProviders,window.wizz,window.phantom,window.magicEden,void 0!==window.LeatherProvider||void 0!==window.HiroWalletProvider||Array.isArray(window.btc_providers),r()),m(e(t))}catch(cC){m([]),r()}const i=window.NexusWalletConnect.subscribe(e=>{o(e)});return()=>{try{i&&i()}catch(e){}for(const t of n)try{clearTimeout(t)}catch(e){}}}t(!0),setTimeout(e,100)};return e()},[]),rt.useEffect(()=>{},[d]),rt.useEffect(()=>{const e=e=>{"Escape"===e.key&&d&&f(!1)};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[d]),e?it.createElement("div",{className:"nexus-wallet-app "+(r?"dark-theme":"light-theme")},it.createElement("main",{className:"main-content",style:{padding:0}},it.createElement(iE,{walletState:a,onConnect:()=>{f(!0)},onDisconnect:async()=>{"undefined"==typeof window||"inscribing"!==window.__nexusGlobalLoading&&"wallet-connect"!==window.__nexusGlobalLoading||(window.__nexusGlobalLoading=null);try{await window.NexusWalletConnect.disconnect(),l(!1),u(null)}catch(Kh){}finally{"undefined"==typeof window||"inscribing"!==window.__nexusGlobalLoading&&"wallet-connect"!==window.__nexusGlobalLoading||(window.__nexusGlobalLoading=null)}},onInscriptionCreated:e=>{}})),it.createElement(dE,{isOpen:d,onClose:()=>f(!1),installedWallets:p,wallets:h,onConnectWallet:async e=>{f(!1),l(!0),u(e),"undefined"!=typeof window&&(window.__nexusGlobalLoading="wallet-connect");try{await window.NexusWalletConnect.connect(e),window.patchWalletInstance&&window.NexusWalletConnect.currentWallet&&window.patchWalletInstance(window.NexusWalletConnect.currentWallet),window.forceNormalizeAllProviders&&window.forceNormalizeAllProviders()}catch(uC){alert(`Failed to connect to ${e}:\n\n${uC.message}\n\nPlease check the console for more details.`),f(!0)}finally{l(!1),u(null),"undefined"!=typeof window&&"wallet-connect"===window.__nexusGlobalLoading&&(window.__nexusGlobalLoading=null)}},onOpenMobileWallet:async e=>{try{if(!window.NexusWalletConnect?.openMobileWallet)throw new Error("Mobile wallet open is not available (openMobileWallet missing).");await window.NexusWalletConnect.openMobileWallet(e)}catch(uC){const n="undefined"!=typeof window&&window.location?.href?window.location.href:"";let r=!1;if(n)try{navigator?.clipboard?.writeText&&(await navigator.clipboard.writeText(n),r=!0)}catch{r=!1}alert(`Could not open ${e} automatically.\n\nOpen your mobile wallet app, then open its in-app browser / explorer and paste this URL:\n\n${n||"(URL unavailable)"}\n\n`+(r?"Copied to clipboard.":"If needed, press OK to copy.")),n&&!r&&window.prompt("Copy this URL:",n)}},loading:s,connectingWallet:c}),(c||"undefined"!=typeof window&&window.__nexusGlobalLoading)&&it.createElement(aE,{message:c?`Connecting to ${c}...`:"inscribing"===window.__nexusGlobalLoading?"Creating inscription(s)...":"Loading...",subtext:c?"Please approve the connection in your wallet":"inscribing"===window.__nexusGlobalLoading?"Please approve and wait for transaction building":"",icon:"inscribing"===window.__nexusGlobalLoading?"\ud83d\udcdd":"\u23f3"})):it.createElement("div",{className:"nexus-wallet-app "+(r?"dark-theme":"light-theme")},it.createElement("div",{className:"loading-state",style:{minHeight:"100vh"}},it.createElement("div",{className:"spinner"})))},mE=async()=>{try{await Zy()}catch(uC){}if(void 0!==window.__NEXUS_LOADING_DEPS__){if(!0===window.__NEXUS_LOADING_DEPS__)return new Promise(e=>{window.addEventListener("nexus-deps-ready",()=>{mE().then(e)},{once:!0})});window.__NEXUS_DEPS_ERROR__}Qm.createRoot(document.getElementById("root")).render(it.createElement(pE,null))};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",mE):mE();const hE=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));window.NexusWalletConnect=ce,await new Promise(e=>{window.__NEXUS_CRYPTO_READY__?e():window.addEventListener("nexus-crypto-ready",()=>e(),{once:!0})});try{const e=window.bitmapWallet;if(e&&"function"==typeof e.request&&"function"==typeof e.connect&&!e.__nexusConnectShimInstalled){const t=e.connect.bind(e);e.__nexusConnectShimInstalled=!0,e.__nexusOriginalConnect=t,e.connect=async(n={})=>{try{let t;if("function"==typeof e.requestAccounts)t=await e.requestAccounts();else{const n=["requestAccounts","getAccounts","accounts"];let r;for(const i of n)try{const n=await e.request({method:i,params:[]});if(t=Array.isArray(n)?n:n?.accounts||(n?[n]:[]),t&&(!Array.isArray(t)||t.length))break}catch(cC){r=cC}if(!t)throw r||new Error("BitmapWallet: no accounts returned")}const n=Array.isArray(t)?t[0]:t;return{accounts:Array.isArray(t)?t:[t],address:n,connected:!0}}catch(cC){return await t(n)}}}}catch(cC){}window.__NEXUS_LOADING_DEPS__=!1,window.__NEXUS_DEPS_READY__=!0,window.dispatchEvent(new CustomEvent("nexus-deps-ready")),await n(()=>Promise.resolve().then(()=>hE),__VITE_PRELOAD__);var gE={},yE={},bE={};Object.defineProperty(bE,"__esModule",{value:!0}),bE.testnet=bE.regtest=bE.bitcoin=void 0,bE.bitcoin={messagePrefix:"\x18Bitcoin Signed Message:\n",bech32:"bc",bip32:{public:76067358,private:76066276},pubKeyHash:0,scriptHash:5,wif:128},bE.regtest={messagePrefix:"\x18Bitcoin Signed Message:\n",bech32:"bcrt",bip32:{public:70617039,private:70615956},pubKeyHash:111,scriptHash:196,wif:239},bE.testnet={messagePrefix:"\x18Bitcoin Signed Message:\n",bech32:"tb",bip32:{public:70617039,private:70615956},pubKeyHash:111,scriptHash:196,wif:239};var wE={},xE={},vE={},SE={};Object.defineProperty(SE,"__esModule",{value:!0}),SE.encode=SE.decode=SE.check=void 0,SE.check=function(e){if(e.length<8)return!1;if(e.length>72)return!1;if(48!==e[0])return!1;if(e[1]!==e.length-2)return!1;if(2!==e[2])return!1;const t=e[3];if(0===t)return!1;if(5+t>=e.length)return!1;if(2!==e[4+t])return!1;const n=e[5+t];return!(0===n||6+t+n!==e.length||128&e[4]||t>1&&0===e[4]&&!(128&e[5])||128&e[t+6]||n>1&&0===e[t+6]&&!(128&e[t+7]))},SE.decode=function(e){if(e.length<8)throw new Error("DER sequence length is too short");if(e.length>72)throw new Error("DER sequence length is too long");if(48!==e[0])throw new Error("Expected DER sequence");if(e[1]!==e.length-2)throw new Error("DER sequence length is invalid");if(2!==e[2])throw new Error("Expected DER integer");const t=e[3];if(0===t)throw new Error("R length is zero");if(5+t>=e.length)throw new Error("R length is too long");if(2!==e[4+t])throw new Error("Expected DER integer (2)");const n=e[5+t];if(0===n)throw new Error("S length is zero");if(6+t+n!==e.length)throw new Error("S length is invalid");if(128&e[4])throw new Error("R value is negative");if(t>1&&0===e[4]&&!(128&e[5]))throw new Error("R value excessively padded");if(128&e[t+6])throw new Error("S value is negative");if(n>1&&0===e[t+6]&&!(128&e[t+7]))throw new Error("S value excessively padded");return{r:e.slice(4,4+t),s:e.slice(6+t)}},SE.encode=function(e,t){const n=e.length,r=t.length;if(0===n)throw new Error("R length is zero");if(0===r)throw new Error("S length is zero");if(n>33)throw new Error("R length is too long");if(r>33)throw new Error("S length is too long");if(128&e[0])throw new Error("R value is negative");if(128&t[0])throw new Error("S value is negative");if(n>1&&0===e[0]&&!(128&e[1]))throw new Error("R value excessively padded");if(r>1&&0===t[0]&&!(128&t[1]))throw new Error("S value excessively padded");const i=Buffer.allocUnsafe(6+n+r);return i[0]=48,i[1]=i.length-2,i[2]=2,i[3]=e.length,e.copy(i,4),i[4+n]=2,i[5+n]=t.length,t.copy(i,6+n),i};var EE={};Object.defineProperty(EE,"__esModule",{value:!0}),EE.REVERSE_OPS=EE.OPS=void 0;const IE={OP_FALSE:0,OP_0:0,OP_PUSHDATA1:76,OP_PUSHDATA2:77,OP_PUSHDATA4:78,OP_1NEGATE:79,OP_RESERVED:80,OP_TRUE:81,OP_1:81,OP_2:82,OP_3:83,OP_4:84,OP_5:85,OP_6:86,OP_7:87,OP_8:88,OP_9:89,OP_10:90,OP_11:91,OP_12:92,OP_13:93,OP_14:94,OP_15:95,OP_16:96,OP_NOP:97,OP_VER:98,OP_IF:99,OP_NOTIF:100,OP_VERIF:101,OP_VERNOTIF:102,OP_ELSE:103,OP_ENDIF:104,OP_VERIFY:105,OP_RETURN:106,OP_TOALTSTACK:107,OP_FROMALTSTACK:108,OP_2DROP:109,OP_2DUP:110,OP_3DUP:111,OP_2OVER:112,OP_2ROT:113,OP_2SWAP:114,OP_IFDUP:115,OP_DEPTH:116,OP_DROP:117,OP_DUP:118,OP_NIP:119,OP_OVER:120,OP_PICK:121,OP_ROLL:122,OP_ROT:123,OP_SWAP:124,OP_TUCK:125,OP_CAT:126,OP_SUBSTR:127,OP_LEFT:128,OP_RIGHT:129,OP_SIZE:130,OP_INVERT:131,OP_AND:132,OP_OR:133,OP_XOR:134,OP_EQUAL:135,OP_EQUALVERIFY:136,OP_RESERVED1:137,OP_RESERVED2:138,OP_1ADD:139,OP_1SUB:140,OP_2MUL:141,OP_2DIV:142,OP_NEGATE:143,OP_ABS:144,OP_NOT:145,OP_0NOTEQUAL:146,OP_ADD:147,OP_SUB:148,OP_MUL:149,OP_DIV:150,OP_MOD:151,OP_LSHIFT:152,OP_RSHIFT:153,OP_BOOLAND:154,OP_BOOLOR:155,OP_NUMEQUAL:156,OP_NUMEQUALVERIFY:157,OP_NUMNOTEQUAL:158,OP_LESSTHAN:159,OP_GREATERTHAN:160,OP_LESSTHANOREQUAL:161,OP_GREATERTHANOREQUAL:162,OP_MIN:163,OP_MAX:164,OP_WITHIN:165,OP_RIPEMD160:166,OP_SHA1:167,OP_SHA256:168,OP_HASH160:169,OP_HASH256:170,OP_CODESEPARATOR:171,OP_CHECKSIG:172,OP_CHECKSIGVERIFY:173,OP_CHECKMULTISIG:174,OP_CHECKMULTISIGVERIFY:175,OP_NOP1:176,OP_NOP2:177,OP_CHECKLOCKTIMEVERIFY:177,OP_NOP3:178,OP_CHECKSEQUENCEVERIFY:178,OP_NOP4:179,OP_NOP5:180,OP_NOP6:181,OP_NOP7:182,OP_NOP8:183,OP_NOP9:184,OP_NOP10:185,OP_CHECKSIGADD:186,OP_PUBKEYHASH:253,OP_PUBKEY:254,OP_INVALIDOPCODE:255};EE.OPS=IE;const kE={};EE.REVERSE_OPS=kE;for(const dC of Object.keys(IE))kE[IE[dC]]=dC;var AE={};Object.defineProperty(AE,"__esModule",{value:!0}),AE.decode=AE.encode=AE.encodingLength=void 0;const NE=EE;function TE(e){return e<NE.OPS.OP_PUSHDATA1?1:e<=255?2:e<=65535?3:5}AE.encodingLength=TE,AE.encode=function(e,t,n){const r=TE(t);return 1===r?e.writeUInt8(t,n):2===r?(e.writeUInt8(NE.OPS.OP_PUSHDATA1,n),e.writeUInt8(t,n+1)):3===r?(e.writeUInt8(NE.OPS.OP_PUSHDATA2,n),e.writeUInt16LE(t,n+1)):(e.writeUInt8(NE.OPS.OP_PUSHDATA4,n),e.writeUInt32LE(t,n+1)),r},AE.decode=function(e,t){const n=e.readUInt8(t);let r,i;if(n<NE.OPS.OP_PUSHDATA1)r=n,i=1;else if(n===NE.OPS.OP_PUSHDATA1){if(t+2>e.length)return null;r=e.readUInt8(t+1),i=2}else if(n===NE.OPS.OP_PUSHDATA2){if(t+3>e.length)return null;r=e.readUInt16LE(t+1),i=3}else{if(t+5>e.length)return null;if(n!==NE.OPS.OP_PUSHDATA4)throw new Error("Unexpected opcode");r=e.readUInt32LE(t+1),i=5}return{opcode:n,number:r,size:i}};var _E={};Object.defineProperty(_E,"__esModule",{value:!0}),_E.encode=_E.decode=void 0,_E.decode=function(e,t,n){t=t||4,n=void 0===n||n;const r=e.length;if(0===r)return 0;if(r>t)throw new TypeError("Script number overflow");if(n&&!(127&e[r-1]||!(r<=1)&&128&e[r-2]))throw new Error("Non-minimally encoded script number");if(5===r){const t=e.readUInt32LE(0),n=e.readUInt8(4);return 128&n?-(4294967296*(-129&n)+t):4294967296*n+t}let i=0;for(let a=0;a<r;++a)i|=e[a]<<8*a;return 128&e[r-1]?-(i&~(128<<8*(r-1))):i},_E.encode=function(e){let t=Math.abs(e);const n=function(e){return e>2147483647?5:e>8388607?4:e>32767?3:e>127?2:e>0?1:0}(t),r=Buffer.allocUnsafe(n),i=e<0;for(let a=0;a<n;++a)r.writeUInt8(255&t,a),t>>=8;return 128&r[n-1]?r.writeUInt8(i?128:0,n-1):i&&(r[n-1]|=128),r};for(var PE={},BE={},CE={},OE={byteLength:function(e){var t=$E(e),n=t[0],r=t[1];return 3*(n+r)/4-r},toByteArray:function(e){var t,n,r=$E(e),i=r[0],a=r[1],o=new RE(function(e,t,n){return 3*(t+n)/4-n}(0,i,a)),s=0,l=a>0?i-4:i;for(n=0;n<l;n+=4)t=FE[e.charCodeAt(n)]<<18|FE[e.charCodeAt(n+1)]<<12|FE[e.charCodeAt(n+2)]<<6|FE[e.charCodeAt(n+3)],o[s++]=t>>16&255,o[s++]=t>>8&255,o[s++]=255&t;return 2===a&&(t=FE[e.charCodeAt(n)]<<2|FE[e.charCodeAt(n+1)]>>4,o[s++]=255&t),1===a&&(t=FE[e.charCodeAt(n)]<<10|FE[e.charCodeAt(n+1)]<<4|FE[e.charCodeAt(n+2)]>>2,o[s++]=t>>8&255,o[s++]=255&t),o},fromByteArray:function(e){for(var t,n=e.length,r=n%3,i=[],a=16383,o=0,s=n-r;o<s;o+=a)i.push(DE(e,o,o+a>s?s:o+a));return 1===r?(t=e[n-1],i.push(LE[t>>2]+LE[t<<4&63]+"==")):2===r&&(t=(e[n-2]<<8)+e[n-1],i.push(LE[t>>10]+LE[t>>4&63]+LE[t<<2&63]+"=")),i.join("")}},LE=[],FE=[],RE="undefined"!=typeof Uint8Array?Uint8Array:Array,UE="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ME=0;ME<64;++ME)LE[ME]=UE[ME],FE[UE.charCodeAt(ME)]=ME;function $E(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function HE(e){return LE[e>>18&63]+LE[e>>12&63]+LE[e>>6&63]+LE[63&e]}function DE(e,t,n){for(var r,i=[],a=t;a<n;a+=3)r=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),i.push(HE(r));return i.join("")}FE["-".charCodeAt(0)]=62,FE["_".charCodeAt(0)]=63;var zE={read:function(e,t,n,r,i){var a,o,s=8*i-r-1,l=(1<<s)-1,c=l>>1,u=-7,d=n?i-1:0,f=n?-1:1,p=e[t+d];for(d+=f,a=p&(1<<-u)-1,p>>=-u,u+=s;u>0;a=256*a+e[t+d],d+=f,u-=8);for(o=a&(1<<-u)-1,a>>=-u,u+=r;u>0;o=256*o+e[t+d],d+=f,u-=8);if(0===a)a=1-c;else{if(a===l)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,r),a-=c}return(p?-1:1)*o*Math.pow(2,a-r)},write:function(e,t,n,r,i,a){var o,s,l,c=8*a-i-1,u=(1<<c)-1,d=u>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:a-1,m=r?1:-1,h=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+d>=1?f/l:f*Math.pow(2,1-d))*l>=2&&(o++,l/=2),o+d>=u?(s=0,o=u):o+d>=1?(s=(t*l-1)*Math.pow(2,i),o+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,i),o=0));i>=8;e[n+p]=255&s,p+=m,s/=256,i-=8);for(o=o<<i|s,c+=i;c>0;e[n+p]=255&o,p+=m,o/=256,c-=8);e[n+p-m]|=128*h}};!function(e){const t=OE,n=zE,r="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=o,e.SlowBuffer=function(e){return+e!=e&&(e=0),o.alloc(+e)},e.INSPECT_MAX_BYTES=50;const i=2147483647;function a(e){if(e>i)throw new RangeError('The value "'+e+'" is invalid for option "size"');const t=new Uint8Array(e);return Object.setPrototypeOf(t,o.prototype),t}function o(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return c(e)}return s(e,t,n)}function s(e,t,n){if("string"==typeof e)return function(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!o.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const n=0|p(e,t);let r=a(n);const i=r.write(e,t);return i!==n&&(r=r.slice(0,i)),r}(e,t);if(ArrayBuffer.isView(e))return function(e){if(K(e,Uint8Array)){const t=new Uint8Array(e);return d(t.buffer,t.byteOffset,t.byteLength)}return u(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(K(e,ArrayBuffer)||e&&K(e.buffer,ArrayBuffer))return d(e,t,n);if("undefined"!=typeof SharedArrayBuffer&&(K(e,SharedArrayBuffer)||e&&K(e.buffer,SharedArrayBuffer)))return d(e,t,n);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');const r=e.valueOf&&e.valueOf();if(null!=r&&r!==e)return o.from(r,t,n);const i=function(e){if(o.isBuffer(e)){const t=0|f(e.length),n=a(t);return 0===n.length||e.copy(n,0,0,t),n}return void 0!==e.length?"number"!=typeof e.length||X(e.length)?a(0):u(e):"Buffer"===e.type&&Array.isArray(e.data)?u(e.data):void 0}(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return o.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function c(e){return l(e),a(e<0?0:0|f(e))}function u(e){const t=e.length<0?0:0|f(e.length),n=a(t);for(let r=0;r<t;r+=1)n[r]=255&e[r];return n}function d(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');let r;return r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),Object.setPrototypeOf(r,o.prototype),r}function f(e){if(e>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return 0|e}function p(e,t){if(o.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||K(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);const n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;let i=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return V(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return j(e).length;default:if(i)return r?-1:V(e).length;t=(""+t).toLowerCase(),i=!0}}function m(e,t,n){let r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return T(this,t,n);case"utf8":case"utf-8":return I(this,t,n);case"ascii":return A(this,t,n);case"latin1":case"binary":return N(this,t,n);case"base64":return E(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function h(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function g(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),X(n=+n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=o.from(t,r)),o.isBuffer(t))return 0===t.length?-1:y(e,t,n,r,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):y(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function y(e,t,n,r,i){let a,o=1,s=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;o=2,s/=2,l/=2,n/=2}function c(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){let r=-1;for(a=n;a<s;a++)if(c(e,a)===c(t,-1===r?0:a-r)){if(-1===r&&(r=a),a-r+1===l)return r*o}else-1!==r&&(a-=a-r),r=-1}else for(n+l>s&&(n=s-l),a=n;a>=0;a--){let n=!0;for(let r=0;r<l;r++)if(c(e,a+r)!==c(t,r)){n=!1;break}if(n)return a}return-1}function b(e,t,n,r){n=Number(n)||0;const i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;const a=t.length;let o;for(r>a/2&&(r=a/2),o=0;o<r;++o){const r=parseInt(t.substr(2*o,2),16);if(X(r))return o;e[n+o]=r}return o}function w(e,t,n,r){return q(V(t,e.length-n),e,n,r)}function x(e,t,n,r){return q(function(e){const t=[];for(let n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function v(e,t,n,r){return q(j(t),e,n,r)}function S(e,t,n,r){return q(function(e,t){let n,r,i;const a=[];for(let o=0;o<e.length&&!((t-=2)<0);++o)n=e.charCodeAt(o),r=n>>8,i=n%256,a.push(i),a.push(r);return a}(t,e.length-n),e,n,r)}function E(e,n,r){return 0===n&&r===e.length?t.fromByteArray(e):t.fromByteArray(e.slice(n,r))}function I(e,t,n){n=Math.min(e.length,n);const r=[];let i=t;for(;i<n;){const t=e[i];let a=null,o=t>239?4:t>223?3:t>191?2:1;if(i+o<=n){let n,r,s,l;switch(o){case 1:t<128&&(a=t);break;case 2:n=e[i+1],128==(192&n)&&(l=(31&t)<<6|63&n,l>127&&(a=l));break;case 3:n=e[i+1],r=e[i+2],128==(192&n)&&128==(192&r)&&(l=(15&t)<<12|(63&n)<<6|63&r,l>2047&&(l<55296||l>57343)&&(a=l));break;case 4:n=e[i+1],r=e[i+2],s=e[i+3],128==(192&n)&&128==(192&r)&&128==(192&s)&&(l=(15&t)<<18|(63&n)<<12|(63&r)<<6|63&s,l>65535&&l<1114112&&(a=l))}}null===a?(a=65533,o=1):a>65535&&(a-=65536,r.push(a>>>10&1023|55296),a=56320|1023&a),r.push(a),i+=o}return function(e){const t=e.length;if(t<=k)return String.fromCharCode.apply(String,e);let n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=k));return n}(r)}e.kMaxLength=i,o.TYPED_ARRAY_SUPPORT=function(){try{const e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(cC){return!1}}(),!o.TYPED_ARRAY_SUPPORT&&"undefined"!=typeof console&&console.error,Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}}),o.poolSize=8192,o.from=function(e,t,n){return s(e,t,n)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array),o.alloc=function(e,t,n){return function(e,t,n){return l(e),e<=0?a(e):void 0!==t?"string"==typeof n?a(e).fill(t,n):a(e).fill(t):a(e)}(e,t,n)},o.allocUnsafe=function(e){return c(e)},o.allocUnsafeSlow=function(e){return c(e)},o.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==o.prototype},o.compare=function(e,t){if(K(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),K(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),!o.isBuffer(e)||!o.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let n=e.length,r=t.length;for(let i=0,a=Math.min(n,r);i<a;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);let n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;const r=o.allocUnsafe(t);let i=0;for(n=0;n<e.length;++n){let t=e[n];if(K(t,Uint8Array))i+t.length>r.length?(o.isBuffer(t)||(t=o.from(t)),t.copy(r,i)):Uint8Array.prototype.set.call(r,t,i);else{if(!o.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(r,i)}i+=t.length}return r},o.byteLength=p,o.prototype._isBuffer=!0,o.prototype.swap16=function(){const e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)h(this,t,t+1);return this},o.prototype.swap32=function(){const e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)h(this,t,t+3),h(this,t+1,t+2);return this},o.prototype.swap64=function(){const e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)h(this,t,t+7),h(this,t+1,t+6),h(this,t+2,t+5),h(this,t+3,t+4);return this},o.prototype.toString=function(){const e=this.length;return 0===e?"":0===arguments.length?I(this,0,e):m.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(e){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){let t="";const n=e.INSPECT_MAX_BYTES;return t=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(t+=" ... "),"<Buffer "+t+">"},r&&(o.prototype[r]=o.prototype.inspect),o.prototype.compare=function(e,t,n,r,i){if(K(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),!o.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;let a=(i>>>=0)-(r>>>=0),s=(n>>>=0)-(t>>>=0);const l=Math.min(a,s),c=this.slice(r,i),u=e.slice(t,n);for(let o=0;o<l;++o)if(c[o]!==u[o]){a=c[o],s=u[o];break}return a<s?-1:s<a?1:0},o.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},o.prototype.indexOf=function(e,t,n){return g(this,e,t,n,!0)},o.prototype.lastIndexOf=function(e,t,n){return g(this,e,t,n,!1)},o.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}const i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");let a=!1;for(;;)switch(r){case"hex":return b(this,e,t,n);case"utf8":case"utf-8":return w(this,e,t,n);case"ascii":case"latin1":case"binary":return x(this,e,t,n);case"base64":return v(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,e,t,n);default:if(a)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),a=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const k=4096;function A(e,t,n){let r="";n=Math.min(e.length,n);for(let i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function N(e,t,n){let r="";n=Math.min(e.length,n);for(let i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function T(e,t,n){const r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);let i="";for(let a=t;a<n;++a)i+=G[e[a]];return i}function _(e,t,n){const r=e.slice(t,n);let i="";for(let a=0;a<r.length-1;a+=2)i+=String.fromCharCode(r[a]+256*r[a+1]);return i}function P(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function B(e,t,n,r,i,a){if(!o.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function C(e,t,n,r,i){H(t,r,i,e,n,7);let a=Number(t&BigInt(4294967295));e[n++]=a,a>>=8,e[n++]=a,a>>=8,e[n++]=a,a>>=8,e[n++]=a;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o,n}function O(e,t,n,r,i){H(t,r,i,e,n,7);let a=Number(t&BigInt(4294967295));e[n+7]=a,a>>=8,e[n+6]=a,a>>=8,e[n+5]=a,a>>=8,e[n+4]=a;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[n+3]=o,o>>=8,e[n+2]=o,o>>=8,e[n+1]=o,o>>=8,e[n]=o,n+8}function L(e,t,n,r,i,a){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function F(e,t,r,i,a){return t=+t,r>>>=0,a||L(e,0,r,4),n.write(e,t,r,i,23,4),r+4}function R(e,t,r,i,a){return t=+t,r>>>=0,a||L(e,0,r,8),n.write(e,t,r,i,52,8),r+8}o.prototype.slice=function(e,t){const n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);const r=this.subarray(e,t);return Object.setPrototypeOf(r,o.prototype),r},o.prototype.readUintLE=o.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||P(e,t,this.length);let r=this[e],i=1,a=0;for(;++a<t&&(i*=256);)r+=this[e+a]*i;return r},o.prototype.readUintBE=o.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||P(e,t,this.length);let r=this[e+--t],i=1;for(;t>0&&(i*=256);)r+=this[e+--t]*i;return r},o.prototype.readUint8=o.prototype.readUInt8=function(e,t){return e>>>=0,t||P(e,1,this.length),this[e]},o.prototype.readUint16LE=o.prototype.readUInt16LE=function(e,t){return e>>>=0,t||P(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUint16BE=o.prototype.readUInt16BE=function(e,t){return e>>>=0,t||P(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUint32LE=o.prototype.readUInt32LE=function(e,t){return e>>>=0,t||P(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},o.prototype.readUint32BE=o.prototype.readUInt32BE=function(e,t){return e>>>=0,t||P(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readBigUInt64LE=Y(function(e){D(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||z(e,this.length-8);const r=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,i=this[++e]+256*this[++e]+65536*this[++e]+n*2**24;return BigInt(r)+(BigInt(i)<<BigInt(32))}),o.prototype.readBigUInt64BE=Y(function(e){D(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||z(e,this.length-8);const r=t*2**24+65536*this[++e]+256*this[++e]+this[++e],i=this[++e]*2**24+65536*this[++e]+256*this[++e]+n;return(BigInt(r)<<BigInt(32))+BigInt(i)}),o.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||P(e,t,this.length);let r=this[e],i=1,a=0;for(;++a<t&&(i*=256);)r+=this[e+a]*i;return i*=128,r>=i&&(r-=Math.pow(2,8*t)),r},o.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||P(e,t,this.length);let r=t,i=1,a=this[e+--r];for(;r>0&&(i*=256);)a+=this[e+--r]*i;return i*=128,a>=i&&(a-=Math.pow(2,8*t)),a},o.prototype.readInt8=function(e,t){return e>>>=0,t||P(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},o.prototype.readInt16LE=function(e,t){e>>>=0,t||P(e,2,this.length);const n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},o.prototype.readInt16BE=function(e,t){e>>>=0,t||P(e,2,this.length);const n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},o.prototype.readInt32LE=function(e,t){return e>>>=0,t||P(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return e>>>=0,t||P(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readBigInt64LE=Y(function(e){D(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||z(e,this.length-8);const r=this[e+4]+256*this[e+5]+65536*this[e+6]+(n<<24);return(BigInt(r)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)}),o.prototype.readBigInt64BE=Y(function(e){D(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||z(e,this.length-8);const r=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(r)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+n)}),o.prototype.readFloatLE=function(e,t){return e>>>=0,t||P(e,4,this.length),n.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return e>>>=0,t||P(e,4,this.length),n.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return e>>>=0,t||P(e,8,this.length),n.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return e>>>=0,t||P(e,8,this.length),n.read(this,e,!1,52,8)},o.prototype.writeUintLE=o.prototype.writeUIntLE=function(e,t,n,r){e=+e,t>>>=0,n>>>=0,r||B(this,e,t,n,Math.pow(2,8*n)-1,0);let i=1,a=0;for(this[t]=255&e;++a<n&&(i*=256);)this[t+a]=e/i&255;return t+n},o.prototype.writeUintBE=o.prototype.writeUIntBE=function(e,t,n,r){e=+e,t>>>=0,n>>>=0,r||B(this,e,t,n,Math.pow(2,8*n)-1,0);let i=n-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+n},o.prototype.writeUint8=o.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||B(this,e,t,1,255,0),this[t]=255&e,t+1},o.prototype.writeUint16LE=o.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||B(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeUint16BE=o.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||B(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeUint32LE=o.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||B(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},o.prototype.writeUint32BE=o.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||B(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeBigUInt64LE=Y(function(e,t=0){return C(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),o.prototype.writeBigUInt64BE=Y(function(e,t=0){return O(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),o.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t>>>=0,!r){const r=Math.pow(2,8*n-1);B(this,e,t,n,r-1,-r)}let i=0,a=1,o=0;for(this[t]=255&e;++i<n&&(a*=256);)e<0&&0===o&&0!==this[t+i-1]&&(o=1),this[t+i]=(e/a|0)-o&255;return t+n},o.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t>>>=0,!r){const r=Math.pow(2,8*n-1);B(this,e,t,n,r-1,-r)}let i=n-1,a=1,o=0;for(this[t+i]=255&e;--i>=0&&(a*=256);)e<0&&0===o&&0!==this[t+i+1]&&(o=1),this[t+i]=(e/a|0)-o&255;return t+n},o.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||B(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||B(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||B(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||B(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},o.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||B(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeBigInt64LE=Y(function(e,t=0){return C(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),o.prototype.writeBigInt64BE=Y(function(e,t=0){return O(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),o.prototype.writeFloatLE=function(e,t,n){return F(this,e,t,!0,n)},o.prototype.writeFloatBE=function(e,t,n){return F(this,e,t,!1,n)},o.prototype.writeDoubleLE=function(e,t,n){return R(this,e,t,!0,n)},o.prototype.writeDoubleBE=function(e,t,n){return R(this,e,t,!1,n)},o.prototype.copy=function(e,t,n,r){if(!o.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);const i=r-n;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,r):Uint8Array.prototype.set.call(e,this.subarray(n,r),t),i},o.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!o.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===e.length){const t=e.charCodeAt(0);("utf8"===r&&t<128||"latin1"===r)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;let i;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{const a=o.isBuffer(e)?e:o.from(e,r),s=a.length;if(0===s)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<n-t;++i)this[i+t]=a[i%s]}return this};const U={};function M(e,t,n){U[e]=class extends n{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function $(e){let t="",n=e.length;const r="-"===e[0]?1:0;for(;n>=r+4;n-=3)t=`_${e.slice(n-3,n)}${t}`;return`${e.slice(0,n)}${t}`}function H(e,t,n,r,i,a){if(e>n||e<t){const n="bigint"==typeof t?"n":"";let r;throw r=0===t||t===BigInt(0)?`>= 0${n} and < 2${n} ** ${8*(a+1)}${n}`:`>= -(2${n} ** ${8*(a+1)-1}${n}) and < 2 ** ${8*(a+1)-1}${n}`,new U.ERR_OUT_OF_RANGE("value",r,e)}!function(e,t,n){D(t,"offset"),void 0!==e[t]&&void 0!==e[t+n]||z(t,e.length-(n+1))}(r,i,a)}function D(e,t){if("number"!=typeof e)throw new U.ERR_INVALID_ARG_TYPE(t,"number",e)}function z(e,t,n){if(Math.floor(e)!==e)throw D(e,n),new U.ERR_OUT_OF_RANGE("offset","an integer",e);if(t<0)throw new U.ERR_BUFFER_OUT_OF_BOUNDS;throw new U.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${t}`,e)}M("ERR_BUFFER_OUT_OF_BOUNDS",function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),M("ERR_INVALID_ARG_TYPE",function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`},TypeError),M("ERR_OUT_OF_RANGE",function(e,t,n){let r=`The value of "${e}" is out of range.`,i=n;return Number.isInteger(n)&&Math.abs(n)>2**32?i=$(String(n)):"bigint"==typeof n&&(i=String(n),(n>BigInt(2)**BigInt(32)||n<-(BigInt(2)**BigInt(32)))&&(i=$(i)),i+="n"),r+=` It must be ${t}. Received ${i}`,r},RangeError);const W=/[^+/0-9A-Za-z-_]/g;function V(e,t){let n;t=t||1/0;const r=e.length;let i=null;const a=[];for(let o=0;o<r;++o){if(n=e.charCodeAt(o),n>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&a.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&a.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;a.push(n)}else if(n<2048){if((t-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return a}function j(e){return t.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(W,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function q(e,t,n,r){let i;for(i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function K(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function X(e){return e!=e}const G=function(){const e="0123456789abcdef",t=new Array(256);for(let n=0;n<16;++n){const r=16*n;for(let i=0;i<16;++i)t[r+i]=e[n]+e[i]}return t}();function Y(e){return"undefined"==typeof BigInt?J:e}function J(){throw new Error("BigInt not supported")}}(CE);var WE={Array:function(e){return null!=e&&e.constructor===Array},Boolean:function(e){return"boolean"==typeof e},Function:function(e){return"function"==typeof e},Nil:function(e){return null==e},Number:function(e){return"number"==typeof e},Object:function(e){return"object"==typeof e},String:function(e){return"string"==typeof e},"":function(){return!0}};for(var VE in WE.Null=WE.Nil,WE)WE[VE].toJSON=function(e){return e}.bind(null,VE);var jE=WE,qE=jE;function KE(e){return e.name||e.toString().match(/function (.*?)\s*\(/)[1]}function XE(e){return qE.Nil(e)?"":KE(e.constructor)}function GE(e,t){Error.captureStackTrace&&Error.captureStackTrace(e,t)}function YE(e){return qE.Function(e)?e.toJSON?e.toJSON():KE(e):qE.Array(e)?"Array":e&&qE.Object(e)?"Object":void 0!==e?e:""}function JE(e,t,n){var r=function(e){return qE.Function(e)?"":qE.String(e)?JSON.stringify(e):e&&qE.Object(e)?"":e}(t);return"Expected "+YE(e)+", got"+(""!==n?" "+n:"")+(""!==r?" "+r:"")}function QE(e,t,n){n=n||XE(t),this.message=JE(e,t,n),GE(this,QE),this.__type=e,this.__value=t,this.__valueTypeName=n}function ZE(e,t,n,r,i){e?(i=i||XE(r),this.message=function(e,t,n,r,i){var a='" of type ';return"key"===t&&(a='" with key type '),JE('property "'+YE(n)+a+YE(e),r,i)}(e,n,t,r,i)):this.message='Unexpected property "'+t+'"',GE(this,QE),this.__label=n,this.__property=t,this.__type=e,this.__value=r,this.__valueTypeName=i}QE.prototype=Object.create(Error.prototype),QE.prototype.constructor=QE,ZE.prototype=Object.create(Error.prototype),ZE.prototype.constructor=QE;var eI,tI,nI={TfTypeError:QE,TfPropertyTypeError:ZE,tfCustomError:function(e,t){return new QE(e,{},t)},tfSubError:function(e,t,n){return e instanceof ZE?(t=t+"."+e.__property,e=new ZE(e.__type,t,e.__label,e.__value,e.__valueTypeName)):e instanceof QE&&(e=new ZE(e.__type,t,n,e.__value,e.__valueTypeName)),GE(e),e},tfJSON:YE,getValueTypeName:XE},rI=jE,iI=nI.tfJSON,aI=nI.TfTypeError,oI=nI.TfPropertyTypeError,sI=nI.tfSubError,lI=nI.getValueTypeName,cI={arrayOf:function(e,t){function n(n,r){return!!rI.Array(n)&&!rI.Nil(n)&&!(void 0!==t.minLength&&n.length<t.minLength)&&!(void 0!==t.maxLength&&n.length>t.maxLength)&&(void 0===t.length||n.length===t.length)&&n.every(function(t,n){try{return dI(e,t,r)}catch(cC){throw sI(cC,n)}})}return e=uI(e),t=t||{},n.toJSON=function(){var n="["+iI(e)+"]";return void 0!==t.length?n+="{"+t.length+"}":void 0===t.minLength&&void 0===t.maxLength||(n+="{"+(void 0===t.minLength?0:t.minLength)+","+(void 0===t.maxLength?1/0:t.maxLength)+"}"),n},n},maybe:function e(t){function n(n,r){return rI.Nil(n)||t(n,r,e)}return t=uI(t),n.toJSON=function(){return"?"+iI(t)},n},map:function(e,t){function n(n,r){if(!rI.Object(n))return!1;if(rI.Nil(n))return!1;for(var i in n){try{t&&dI(t,i,r)}catch(cC){throw sI(cC,i,"key")}try{var a=n[i];dI(e,a,r)}catch(cC){throw sI(cC,i)}}return!0}return e=uI(e),t&&(t=uI(t)),n.toJSON=t?function(){return"{"+iI(t)+": "+iI(e)+"}"}:function(){return"{"+iI(e)+"}"},n},object:function(e){var t={};for(var n in e)t[n]=uI(e[n]);function r(e,n){if(!rI.Object(e))return!1;if(rI.Nil(e))return!1;var r;try{for(r in t)dI(t[r],e[r],n)}catch(cC){throw sI(cC,r)}if(n)for(r in e)if(!t[r])throw new oI(void 0,r);return!0}return r.toJSON=function(){return iI(t)},r},anyOf:function(){var e=[].slice.call(arguments).map(uI);function t(t,n){return e.some(function(e){try{return dI(e,t,n)}catch(cC){return!1}})}return t.toJSON=function(){return e.map(iI).join("|")},t},allOf:function(){var e=[].slice.call(arguments).map(uI);function t(t,n){return e.every(function(e){try{return dI(e,t,n)}catch(cC){return!1}})}return t.toJSON=function(){return e.map(iI).join(" & ")},t},quacksLike:function(e){function t(t){return e===lI(t)}return t.toJSON=function(){return e},t},tuple:function(){var e=[].slice.call(arguments).map(uI);function t(t,n){return!rI.Nil(t)&&!rI.Nil(t.length)&&(!n||t.length===e.length)&&e.every(function(e,r){try{return dI(e,t[r],n)}catch(cC){throw sI(cC,r)}})}return t.toJSON=function(){return"("+e.map(iI).join(", ")+")"},t},value:function(e){function t(t){return t===e}return t.toJSON=function(){return e},t}};function uI(e){if(rI.String(e))return"?"===e[0]?cI.maybe(e.slice(1)):rI[e]||cI.quacksLike(e);if(e&&rI.Object(e)){if(rI.Array(e)){if(1!==e.length)throw new TypeError("Expected compile() parameter of type Array of length 1");return cI.arrayOf(e[0])}return cI.object(e)}return rI.Function(e)?e:cI.value(e)}function dI(e,t,n,r){if(rI.Function(e)){if(e(t,n))return!0;throw new aI(r||e,t)}return dI(uI(e),t,n)}for(var fI in cI.oneOf=cI.anyOf,rI)dI[fI]=rI[fI];for(fI in cI)dI[fI]=cI[fI];var pI=function(){if(tI)return eI;tI=1;var e=jE,t=nI;function n(e){return Buffer.isBuffer(e)}function r(e){return"string"==typeof e&&/^([0-9a-f]{2})+$/i.test(e)}function i(e,n){var r=e.toJSON();function i(i){if(!e(i))return!1;if(i.length===n)return!0;throw t.tfCustomError(r+"(Length: "+n+")",r+"(Length: "+i.length+")")}return i.toJSON=function(){return r},i}var a=i.bind(null,e.Array),o=i.bind(null,n),s=i.bind(null,r),l=i.bind(null,e.String),c=Math.pow(2,53)-1,u={ArrayN:a,Buffer:n,BufferN:o,Finite:function(e){return"number"==typeof e&&isFinite(e)},Hex:r,HexN:s,Int8:function(e){return e<<24>>24===e},Int16:function(e){return e<<16>>16===e},Int32:function(e){return(0|e)===e},Int53:function(e){return"number"==typeof e&&e>=-c&&e<=c&&Math.floor(e)===e},Range:function(t,n,r){function i(e,i){return r(e,i)&&e>t&&e<n}return r=r||e.Number,i.toJSON=function(){return`${r.toJSON()} between [${t}, ${n}]`},i},StringN:l,UInt8:function(e){return(255&e)===e},UInt16:function(e){return(65535&e)===e},UInt32:function(e){return e>>>0===e},UInt53:function(e){return"number"==typeof e&&e>=0&&e<=c&&Math.floor(e)===e}};for(var d in u)u[d].toJSON=function(e){return e}.bind(null,d);return eI=u}();for(fI in pI)dI[fI]=pI[fI];dI.compile=uI,dI.TfTypeError=aI,dI.TfPropertyTypeError=oI;var mI,hI,gI=dI;function yI(){return hI||(hI=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.signature=e.number=e.isCanonicalScriptSignature=e.isDefinedHashType=e.isCanonicalPubKey=e.toStack=e.fromASM=e.toASM=e.decompile=e.compile=e.countNonPushOnlyOPs=e.isPushOnly=e.OPS=void 0;const t=SE,n=EE;Object.defineProperty(e,"OPS",{enumerable:!0,get:function(){return n.OPS}});const r=AE,i=_E,a=function(){if(mI)return PE;mI=1,Object.defineProperty(PE,"__esModule",{value:!0}),PE.encode=PE.decode=void 0;const e=SE,t=yI(),n=BE,{typeforce:r}=n,i=Buffer.alloc(1,0);function a(e){let t=0;for(;0===e[t];)++t;return t===e.length?i:128&(e=e.slice(t))[0]?Buffer.concat([i,e],1+e.length):e}function o(e){0===e[0]&&(e=e.slice(1));const t=Buffer.alloc(32,0),n=Math.max(0,32-e.length);return e.copy(t,n),t}return PE.decode=function(n){const r=n.readUInt8(n.length-1);if(!(0,t.isDefinedHashType)(r))throw new Error("Invalid hashType "+r);const i=e.decode(n.slice(0,-1)),a=o(i.r),s=o(i.s);return{signature:Buffer.concat([a,s],64),hashType:r}},PE.encode=function(i,o){if(r({signature:n.BufferN(64),hashType:n.UInt8},{signature:i,hashType:o}),!(0,t.isDefinedHashType)(o))throw new Error("Invalid hashType "+o);const s=Buffer.allocUnsafe(1);s.writeUInt8(o,0);const l=a(i.slice(0,32)),c=a(i.slice(32,64));return Buffer.concat([e.encode(l,c),s])},PE}(),o=BE,{typeforce:s}=o,l=n.OPS.OP_RESERVED;function c(e){return o.Buffer(e)||function(e){return o.Number(e)&&(e===n.OPS.OP_0||e>=n.OPS.OP_1&&e<=n.OPS.OP_16||e===n.OPS.OP_1NEGATE)}(e)}function u(e){return o.Array(e)&&e.every(c)}function d(e){return 0===e.length?n.OPS.OP_0:1===e.length?e[0]>=1&&e[0]<=16?l+e[0]:129===e[0]?n.OPS.OP_1NEGATE:void 0:void 0}function f(e){return Buffer.isBuffer(e)}function p(e){return Buffer.isBuffer(e)}function m(e){if(f(e))return e;s(o.Array,e);const t=e.reduce((e,t)=>p(t)?1===t.length&&void 0!==d(t)?e+1:e+r.encodingLength(t.length)+t.length:e+1,0),n=Buffer.allocUnsafe(t);let i=0;if(e.forEach(e=>{if(p(e)){const t=d(e);if(void 0!==t)return n.writeUInt8(t,i),void(i+=1);i+=r.encode(n,e.length,i),e.copy(n,i),i+=e.length}else n.writeUInt8(e,i),i+=1}),i!==n.length)throw new Error("Could not decode chunks");return n}function h(e){if(t=e,o.Array(t))return e;var t;s(o.Buffer,e);const i=[];let a=0;for(;a<e.length;){const t=e[a];if(t>n.OPS.OP_0&&t<=n.OPS.OP_PUSHDATA4){const t=r.decode(e,a);if(null===t)return null;if(a+=t.size,a+t.number>e.length)return null;const n=e.slice(a,a+t.number);a+=t.number;const o=d(n);void 0!==o?i.push(o):i.push(n)}else i.push(t),a+=1}return i}function g(e){const t=-129&e;return t>0&&t<4}e.isPushOnly=u,e.countNonPushOnlyOPs=function(e){return e.length-e.filter(c).length},e.compile=m,e.decompile=h,e.toASM=function(e){if(f(e)&&(e=h(e)),!e)throw new Error("Could not convert invalid chunks to ASM");return e.map(e=>{if(p(e)){const t=d(e);if(void 0===t)return e.toString("hex");e=t}return n.REVERSE_OPS[e]}).join(" ")},e.fromASM=function(e){return s(o.String,e),m(e.split(" ").map(e=>void 0!==n.OPS[e]?n.OPS[e]:(s(o.Hex,e),Buffer.from(e,"hex"))))},e.toStack=function(e){return e=h(e),s(u,e),e.map(e=>p(e)?e:e===n.OPS.OP_0?Buffer.allocUnsafe(0):i.encode(e-l))},e.isCanonicalPubKey=function(e){return o.isPoint(e)},e.isDefinedHashType=g,e.isCanonicalScriptSignature=function(e){return!!Buffer.isBuffer(e)&&!!g(e[e.length-1])&&t.check(e.slice(0,-1))},e.number=i,e.signature=a}(vE)),vE}!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.oneOf=e.Null=e.BufferN=e.Function=e.UInt32=e.UInt8=e.tuple=e.maybe=e.Hex=e.Buffer=e.String=e.Boolean=e.Array=e.Number=e.Hash256bit=e.Hash160bit=e.Buffer256bit=e.isTaptree=e.isTapleaf=e.TAPLEAF_VERSION_MASK=e.Satoshi=e.isPoint=e.stacksEqual=e.typeforce=void 0;const t=CE;e.typeforce=gI;const n=t.Buffer.alloc(32,0),r=t.Buffer.from("fffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f","hex");function i(n){return!(!n||!("output"in n)||!t.Buffer.isBuffer(n.output)||void 0!==n.version&&(n.version&e.TAPLEAF_VERSION_MASK)!==n.version)}e.stacksEqual=function(e,t){return e.length===t.length&&e.every((e,n)=>e.equals(t[n]))},e.isPoint=function(e){if(!t.Buffer.isBuffer(e))return!1;if(e.length<33)return!1;const i=e[0],a=e.slice(1,33);if(0===a.compare(n))return!1;if(a.compare(r)>=0)return!1;if((2===i||3===i)&&33===e.length)return!0;const o=e.slice(33);return 0!==o.compare(n)&&!(o.compare(r)>=0)&&4===i&&65===e.length},e.Satoshi=function(t){return e.typeforce.UInt53(t)&&t<=21e14},e.TAPLEAF_VERSION_MASK=254,e.isTapleaf=i,e.isTaptree=function t(n){return(0,e.Array)(n)?2===n.length&&n.every(e=>t(e)):i(n)},e.Buffer256bit=e.typeforce.BufferN(32),e.Hash160bit=e.typeforce.BufferN(20),e.Hash256bit=e.typeforce.BufferN(32),e.Number=e.typeforce.Number,e.Array=e.typeforce.Array,e.Boolean=e.typeforce.Boolean,e.String=e.typeforce.String,e.Buffer=e.typeforce.Buffer,e.Hex=e.typeforce.Hex,e.maybe=e.typeforce.maybe,e.tuple=e.typeforce.tuple,e.UInt8=e.typeforce.UInt8,e.UInt32=e.typeforce.UInt32,e.Function=e.typeforce.Function,e.BufferN=e.typeforce.BufferN,e.Null=e.typeforce.Null,e.oneOf=e.typeforce.oneOf}(BE);var bI={};Object.defineProperty(bI,"__esModule",{value:!0}),bI.value=bI.prop=void 0,bI.prop=function(e,t,n){Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get(){const e=n.call(this);return this[t]=e,e},set(e){Object.defineProperty(this,t,{configurable:!0,enumerable:!0,value:e,writable:!0})}})},bI.value=function(e){let t;return()=>(void 0!==t||(t=e()),t)},Object.defineProperty(xE,"__esModule",{value:!0}),xE.p2data=void 0;const wI=bE,xI=yI(),vI=BE,SI=bI,EI=xI.OPS;xE.p2data=function(e,t){if(!e.data&&!e.output)throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),(0,vI.typeforce)({network:vI.typeforce.maybe(vI.typeforce.Object),output:vI.typeforce.maybe(vI.typeforce.Buffer),data:vI.typeforce.maybe(vI.typeforce.arrayOf(vI.typeforce.Buffer))},e);const n={name:"embed",network:e.network||wI.bitcoin};if(SI.prop(n,"output",()=>{if(e.data)return xI.compile([EI.OP_RETURN].concat(e.data))}),SI.prop(n,"data",()=>{if(e.output)return xI.decompile(e.output).slice(1)}),t.validate&&e.output){const t=xI.decompile(e.output);if(t[0]!==EI.OP_RETURN)throw new TypeError("Output is invalid");if(!t.slice(1).every(vI.typeforce.Buffer))throw new TypeError("Output is invalid");if(e.data&&!(0,vI.stacksEqual)(e.data,n.data))throw new TypeError("Data mismatch")}return Object.assign(n,e)};var II={};Object.defineProperty(II,"__esModule",{value:!0}),II.p2ms=void 0;const kI=bE,AI=yI(),NI=BE,TI=bI,_I=AI.OPS,PI=_I.OP_RESERVED;II.p2ms=function(e,t){if(!(e.input||e.output||e.pubkeys&&void 0!==e.m||e.signatures))throw new TypeError("Not enough data");function n(e){return AI.isCanonicalScriptSignature(e)||void 0!==(t.allowIncomplete&&e===_I.OP_0)}t=Object.assign({validate:!0},t||{}),(0,NI.typeforce)({network:NI.typeforce.maybe(NI.typeforce.Object),m:NI.typeforce.maybe(NI.typeforce.Number),n:NI.typeforce.maybe(NI.typeforce.Number),output:NI.typeforce.maybe(NI.typeforce.Buffer),pubkeys:NI.typeforce.maybe(NI.typeforce.arrayOf(NI.isPoint)),signatures:NI.typeforce.maybe(NI.typeforce.arrayOf(n)),input:NI.typeforce.maybe(NI.typeforce.Buffer)},e);const r={network:e.network||kI.bitcoin};let i=[],a=!1;function o(e){a||(a=!0,i=AI.decompile(e),r.m=i[0]-PI,r.n=i[i.length-2]-PI,r.pubkeys=i.slice(1,-2))}if(TI.prop(r,"output",()=>{if(e.m&&r.n&&e.pubkeys)return AI.compile([].concat(PI+e.m,e.pubkeys,PI+r.n,_I.OP_CHECKMULTISIG))}),TI.prop(r,"m",()=>{if(r.output)return o(r.output),r.m}),TI.prop(r,"n",()=>{if(r.pubkeys)return r.pubkeys.length}),TI.prop(r,"pubkeys",()=>{if(e.output)return o(e.output),r.pubkeys}),TI.prop(r,"signatures",()=>{if(e.input)return AI.decompile(e.input).slice(1)}),TI.prop(r,"input",()=>{if(e.signatures)return AI.compile([_I.OP_0].concat(e.signatures))}),TI.prop(r,"witness",()=>{if(r.input)return[]}),TI.prop(r,"name",()=>{if(r.m&&r.n)return`p2ms(${r.m} of ${r.n})`}),t.validate){if(e.output){if(o(e.output),!NI.typeforce.Number(i[0]))throw new TypeError("Output is invalid");if(!NI.typeforce.Number(i[i.length-2]))throw new TypeError("Output is invalid");if(i[i.length-1]!==_I.OP_CHECKMULTISIG)throw new TypeError("Output is invalid");if(r.m<=0||r.n>16||r.m>r.n||r.n!==i.length-3)throw new TypeError("Output is invalid");if(!r.pubkeys.every(e=>(0,NI.isPoint)(e)))throw new TypeError("Output is invalid");if(void 0!==e.m&&e.m!==r.m)throw new TypeError("m mismatch");if(void 0!==e.n&&e.n!==r.n)throw new TypeError("n mismatch");if(e.pubkeys&&!(0,NI.stacksEqual)(e.pubkeys,r.pubkeys))throw new TypeError("Pubkeys mismatch")}if(e.pubkeys){if(void 0!==e.n&&e.n!==e.pubkeys.length)throw new TypeError("Pubkey count mismatch");if(r.n=e.pubkeys.length,r.n<r.m)throw new TypeError("Pubkey count cannot be less than m")}if(e.signatures){if(e.signatures.length<r.m)throw new TypeError("Not enough signatures provided");if(e.signatures.length>r.m)throw new TypeError("Too many signatures provided")}if(e.input){if(e.input[0]!==_I.OP_0)throw new TypeError("Input is invalid");if(0===r.signatures.length||!r.signatures.every(n))throw new TypeError("Input has invalid signature(s)");if(e.signatures&&!(0,NI.stacksEqual)(e.signatures,r.signatures))throw new TypeError("Signature mismatch");if(void 0!==e.m&&e.m!==e.signatures.length)throw new TypeError("Signature count mismatch")}}return Object.assign(r,e)};var BI={};Object.defineProperty(BI,"__esModule",{value:!0}),BI.p2pk=void 0;const CI=bE,OI=yI(),LI=BE,FI=bI,RI=OI.OPS;BI.p2pk=function(e,t){if(!(e.input||e.output||e.pubkey||e.input||e.signature))throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),(0,LI.typeforce)({network:LI.typeforce.maybe(LI.typeforce.Object),output:LI.typeforce.maybe(LI.typeforce.Buffer),pubkey:LI.typeforce.maybe(LI.isPoint),signature:LI.typeforce.maybe(OI.isCanonicalScriptSignature),input:LI.typeforce.maybe(LI.typeforce.Buffer)},e);const n=FI.value(()=>OI.decompile(e.input)),r={name:"p2pk",network:e.network||CI.bitcoin};if(FI.prop(r,"output",()=>{if(e.pubkey)return OI.compile([e.pubkey,RI.OP_CHECKSIG])}),FI.prop(r,"pubkey",()=>{if(e.output)return e.output.slice(1,-1)}),FI.prop(r,"signature",()=>{if(e.input)return n()[0]}),FI.prop(r,"input",()=>{if(e.signature)return OI.compile([e.signature])}),FI.prop(r,"witness",()=>{if(r.input)return[]}),t.validate){if(e.output){if(e.output[e.output.length-1]!==RI.OP_CHECKSIG)throw new TypeError("Output is invalid");if(!(0,LI.isPoint)(r.pubkey))throw new TypeError("Output pubkey is invalid");if(e.pubkey&&!e.pubkey.equals(r.pubkey))throw new TypeError("Pubkey mismatch")}if(e.signature&&e.input&&!e.input.equals(r.input))throw new TypeError("Signature mismatch");if(e.input){if(1!==n().length)throw new TypeError("Input is invalid");if(!OI.isCanonicalScriptSignature(r.signature))throw new TypeError("Input has invalid signature")}}return Object.assign(r,e)};var UI={},MI={},$I={},HI={},DI={},zI={},WI={};Object.defineProperty(WI,"__esModule",{value:!0}),WI.crypto=void 0,WI.crypto="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.wrapXOFConstructorWithOpts=e.wrapConstructorWithOpts=e.wrapConstructor=e.Hash=e.nextTick=e.swap32IfBE=e.byteSwapIfBE=e.swap8IfBE=e.isLE=void 0,e.isBytes=n,e.anumber=r,e.abytes=i,e.ahash=function(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.createHasher");r(e.outputLen),r(e.blockLen)},e.aexists=function(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")},e.aoutput=function(e,t){i(e);const n=t.outputLen;if(e.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)},e.u8=function(e){return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)},e.u32=function(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))},e.clean=function(...e){for(let t=0;t<e.length;t++)e[t].fill(0)},e.createView=function(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)},e.rotr=function(e,t){return e<<32-t|e>>>t},e.rotl=function(e,t){return e<<t|e>>>32-t>>>0},e.byteSwap=a,e.byteSwap32=o,e.bytesToHex=function(e){if(i(e),s)return e.toHex();let t="";for(let n=0;n<e.length;n++)t+=l[e[n]];return t},e.hexToBytes=function(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);if(s)return Uint8Array.fromHex(e);const t=e.length,n=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const r=new Uint8Array(n);for(let i=0,a=0;i<n;i++,a+=2){const t=u(e.charCodeAt(a)),n=u(e.charCodeAt(a+1));if(void 0===t||void 0===n){const t=e[a]+e[a+1];throw new Error('hex string expected, got non-hex character "'+t+'" at index '+a)}r[i]=16*t+n}return r},e.asyncLoop=async function(t,n,r){let i=Date.now();for(let a=0;a<t;a++){r(a);const t=Date.now()-i;t>=0&&t<n||(await(0,e.nextTick)(),i+=t)}},e.utf8ToBytes=d,e.bytesToUtf8=function(e){return(new TextDecoder).decode(e)},e.toBytes=f,e.kdfInputToBytes=function(e){return"string"==typeof e&&(e=d(e)),i(e),e},e.concatBytes=function(...e){let t=0;for(let r=0;r<e.length;r++){const n=e[r];i(n),t+=n.length}const n=new Uint8Array(t);for(let r=0,i=0;r<e.length;r++){const t=e[r];n.set(t,i),i+=t.length}return n},e.checkOpts=function(e,t){if(void 0!==t&&"[object Object]"!=={}.toString.call(t))throw new Error("options should be object or undefined");return Object.assign(e,t)},e.createHasher=p,e.createOptHasher=m,e.createXOFer=h,e.randomBytes=function(e=32){if(t.crypto&&"function"==typeof t.crypto.getRandomValues)return t.crypto.getRandomValues(new Uint8Array(e));if(t.crypto&&"function"==typeof t.crypto.randomBytes)return Uint8Array.from(t.crypto.randomBytes(e));throw new Error("crypto.getRandomValues must be defined")};const t=WI;function n(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function r(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function i(e,...t){if(!n(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function a(e){return e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255}function o(e){for(let t=0;t<e.length;t++)e[t]=a(e[t]);return e}e.isLE=68===new Uint8Array(new Uint32Array([287454020]).buffer)[0],e.swap8IfBE=e.isLE?e=>e:e=>a(e),e.byteSwapIfBE=e.swap8IfBE,e.swap32IfBE=e.isLE?e=>e:o;const s=(()=>"function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex)(),l=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0")),c={_0:48,_9:57,A:65,F:70,a:97,f:102};function u(e){return e>=c._0&&e<=c._9?e-c._0:e>=c.A&&e<=c.F?e-(c.A-10):e>=c.a&&e<=c.f?e-(c.a-10):void 0}function d(e){if("string"!=typeof e)throw new Error("string expected");return new Uint8Array((new TextEncoder).encode(e))}function f(e){return"string"==typeof e&&(e=d(e)),i(e),e}function p(e){const t=t=>e().update(f(t)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function m(e){const t=(t,n)=>e(n).update(f(t)).digest(),n=e({});return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=t=>e(t),t}function h(e){const t=(t,n)=>e(n).update(f(t)).digest(),n=e({});return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=t=>e(t),t}e.nextTick=async()=>{},e.Hash=class{},e.wrapConstructor=p,e.wrapConstructorWithOpts=m,e.wrapXOFConstructorWithOpts=h}(zI),Object.defineProperty(DI,"__esModule",{value:!0}),DI.SHA512_IV=DI.SHA384_IV=DI.SHA224_IV=DI.SHA256_IV=DI.HashMD=void 0,DI.setBigUint64=jI,DI.Chi=function(e,t,n){return e&t^~e&n},DI.Maj=function(e,t,n){return e&t^e&n^t&n};const VI=zI;function jI(e,t,n,r){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,n,r);const i=BigInt(32),a=BigInt(4294967295),o=Number(n>>i&a),s=Number(n&a),l=r?4:0,c=r?0:4;e.setUint32(t+l,o,r),e.setUint32(t+c,s,r)}DI.HashMD=class extends VI.Hash{constructor(e,t,n,r){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.buffer=new Uint8Array(e),this.view=(0,VI.createView)(this.buffer)}update(e){(0,VI.aexists)(this),e=(0,VI.toBytes)(e),(0,VI.abytes)(e);const{view:t,buffer:n,blockLen:r}=this,i=e.length;for(let a=0;a<i;){const o=Math.min(r-this.pos,i-a);if(o===r){const t=(0,VI.createView)(e);for(;r<=i-a;a+=r)this.process(t,a);continue}n.set(e.subarray(a,a+o),this.pos),this.pos+=o,a+=o,this.pos===r&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){(0,VI.aexists)(this),(0,VI.aoutput)(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:r,isLE:i}=this;let{pos:a}=this;t[a++]=128,(0,VI.clean)(this.buffer.subarray(a)),this.padOffset>r-a&&(this.process(n,0),a=0);for(let u=a;u<r;u++)t[u]=0;jI(n,r-8,BigInt(8*this.length),i),this.process(n,0);const o=(0,VI.createView)(e),s=this.outputLen;if(s%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=s/4,c=this.get();if(l>c.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<l;u++)o.setUint32(4*u,c[u],i)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:r,finished:i,destroyed:a,pos:o}=this;return e.destroyed=a,e.finished=i,e.length=r,e.pos=o,r%t&&e.buffer.set(n),e}clone(){return this._cloneInto()}},DI.SHA256_IV=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),DI.SHA224_IV=Uint32Array.from([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]),DI.SHA384_IV=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),DI.SHA512_IV=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),Object.defineProperty(HI,"__esModule",{value:!0}),HI.ripemd160=HI.RIPEMD160=HI.md5=HI.MD5=HI.sha1=HI.SHA1=void 0;const qI=DI,KI=zI,XI=Uint32Array.from([1732584193,4023233417,2562383102,271733878,3285377520]),GI=new Uint32Array(80);class YI extends qI.HashMD{constructor(){super(64,20,8,!1),this.A=0|XI[0],this.B=0|XI[1],this.C=0|XI[2],this.D=0|XI[3],this.E=0|XI[4]}get(){const{A:e,B:t,C:n,D:r,E:i}=this;return[e,t,n,r,i]}set(e,t,n,r,i){this.A=0|e,this.B=0|t,this.C=0|n,this.D=0|r,this.E=0|i}process(e,t){for(let s=0;s<16;s++,t+=4)GI[s]=e.getUint32(t,!1);for(let s=16;s<80;s++)GI[s]=(0,KI.rotl)(GI[s-3]^GI[s-8]^GI[s-14]^GI[s-16],1);let{A:n,B:r,C:i,D:a,E:o}=this;for(let s=0;s<80;s++){let e,t;s<20?(e=(0,qI.Chi)(r,i,a),t=1518500249):s<40?(e=r^i^a,t=1859775393):s<60?(e=(0,qI.Maj)(r,i,a),t=2400959708):(e=r^i^a,t=3395469782);const l=(0,KI.rotl)(n,5)+e+o+t+GI[s]|0;o=a,a=i,i=(0,KI.rotl)(r,30),r=n,n=l}n=n+this.A|0,r=r+this.B|0,i=i+this.C|0,a=a+this.D|0,o=o+this.E|0,this.set(n,r,i,a,o)}roundClean(){(0,KI.clean)(GI)}destroy(){this.set(0,0,0,0,0),(0,KI.clean)(this.buffer)}}HI.SHA1=YI,HI.sha1=(0,KI.createHasher)(()=>new YI);const JI=Math.pow(2,32),QI=Array.from({length:64},(e,t)=>Math.floor(JI*Math.abs(Math.sin(t+1)))),ZI=XI.slice(0,4),ek=new Uint32Array(16);class tk extends qI.HashMD{constructor(){super(64,16,8,!0),this.A=0|ZI[0],this.B=0|ZI[1],this.C=0|ZI[2],this.D=0|ZI[3]}get(){const{A:e,B:t,C:n,D:r}=this;return[e,t,n,r]}set(e,t,n,r){this.A=0|e,this.B=0|t,this.C=0|n,this.D=0|r}process(e,t){for(let o=0;o<16;o++,t+=4)ek[o]=e.getUint32(t,!0);let{A:n,B:r,C:i,D:a}=this;for(let o=0;o<64;o++){let e,t,s;o<16?(e=(0,qI.Chi)(r,i,a),t=o,s=[7,12,17,22]):o<32?(e=(0,qI.Chi)(a,r,i),t=(5*o+1)%16,s=[5,9,14,20]):o<48?(e=r^i^a,t=(3*o+5)%16,s=[4,11,16,23]):(e=i^(r|~a),t=7*o%16,s=[6,10,15,21]),e=e+n+QI[o]+ek[t],n=a,a=i,i=r,r+=(0,KI.rotl)(e,s[o%4])}n=n+this.A|0,r=r+this.B|0,i=i+this.C|0,a=a+this.D|0,this.set(n,r,i,a)}roundClean(){(0,KI.clean)(ek)}destroy(){this.set(0,0,0,0),(0,KI.clean)(this.buffer)}}HI.MD5=tk,HI.md5=(0,KI.createHasher)(()=>new tk);const nk=Uint8Array.from([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),rk=(()=>Uint8Array.from(new Array(16).fill(0).map((e,t)=>t)))(),ik=(()=>rk.map(e=>(9*e+5)%16))(),ak=(()=>{const e=[[rk],[ik]];for(let t=0;t<4;t++)for(let n of e)n.push(n[t].map(e=>nk[e]));return e})(),ok=(()=>ak[0])(),sk=(()=>ak[1])(),lk=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map(e=>Uint8Array.from(e)),ck=ok.map((e,t)=>e.map(e=>lk[t][e])),uk=sk.map((e,t)=>e.map(e=>lk[t][e])),dk=Uint32Array.from([0,1518500249,1859775393,2400959708,2840853838]),fk=Uint32Array.from([1352829926,1548603684,1836072691,2053994217,0]);function pk(e,t,n,r){return 0===e?t^n^r:1===e?t&n|~t&r:2===e?(t|~n)^r:3===e?t&r|n&~r:t^(n|~r)}const mk=new Uint32Array(16);class hk extends qI.HashMD{constructor(){super(64,20,8,!0),this.h0=1732584193,this.h1=-271733879,this.h2=-1732584194,this.h3=271733878,this.h4=-1009589776}get(){const{h0:e,h1:t,h2:n,h3:r,h4:i}=this;return[e,t,n,r,i]}set(e,t,n,r,i){this.h0=0|e,this.h1=0|t,this.h2=0|n,this.h3=0|r,this.h4=0|i}process(e,t){for(let f=0;f<16;f++,t+=4)mk[f]=e.getUint32(t,!0);let n=0|this.h0,r=n,i=0|this.h1,a=i,o=0|this.h2,s=o,l=0|this.h3,c=l,u=0|this.h4,d=u;for(let f=0;f<5;f++){const e=4-f,t=dk[f],p=fk[f],m=ok[f],h=sk[f],g=ck[f],y=uk[f];for(let r=0;r<16;r++){const e=(0,KI.rotl)(n+pk(f,i,o,l)+mk[m[r]]+t,g[r])+u|0;n=u,u=l,l=0|(0,KI.rotl)(o,10),o=i,i=e}for(let n=0;n<16;n++){const t=(0,KI.rotl)(r+pk(e,a,s,c)+mk[h[n]]+p,y[n])+d|0;r=d,d=c,c=0|(0,KI.rotl)(s,10),s=a,a=t}}this.set(this.h1+o+c|0,this.h2+l+d|0,this.h3+u+r|0,this.h4+n+a|0,this.h0+i+s|0)}roundClean(){(0,KI.clean)(mk)}destroy(){this.destroyed=!0,(0,KI.clean)(this.buffer),this.set(0,0,0,0,0)}}HI.RIPEMD160=hk,HI.ripemd160=(0,KI.createHasher)(()=>new hk),Object.defineProperty($I,"__esModule",{value:!0}),$I.ripemd160=$I.RIPEMD160=void 0;const gk=HI;$I.RIPEMD160=gk.RIPEMD160,$I.ripemd160=gk.ripemd160;var yk={};Object.defineProperty(yk,"__esModule",{value:!0}),yk.sha1=yk.SHA1=void 0;const bk=HI;yk.SHA1=bk.SHA1,yk.sha1=bk.sha1;var wk={},xk={},vk={};Object.defineProperty(vk,"__esModule",{value:!0}),vk.toBig=vk.shrSL=vk.shrSH=vk.rotrSL=vk.rotrSH=vk.rotrBL=vk.rotrBH=vk.rotr32L=vk.rotr32H=vk.rotlSL=vk.rotlSH=vk.rotlBL=vk.rotlBH=vk.add5L=vk.add5H=vk.add4L=vk.add4H=vk.add3L=vk.add3H=void 0,vk.add=$k,vk.fromBig=Ik,vk.split=kk;const Sk=BigInt(2**32-1),Ek=BigInt(32);function Ik(e,t=!1){return t?{h:Number(e&Sk),l:Number(e>>Ek&Sk)}:{h:0|Number(e>>Ek&Sk),l:0|Number(e&Sk)}}function kk(e,t=!1){const n=e.length;let r=new Uint32Array(n),i=new Uint32Array(n);for(let a=0;a<n;a++){const{h:n,l:o}=Ik(e[a],t);[r[a],i[a]]=[n,o]}return[r,i]}const Ak=(e,t)=>BigInt(e>>>0)<<Ek|BigInt(t>>>0);vk.toBig=Ak;const Nk=(e,t,n)=>e>>>n;vk.shrSH=Nk;const Tk=(e,t,n)=>e<<32-n|t>>>n;vk.shrSL=Tk;const _k=(e,t,n)=>e>>>n|t<<32-n;vk.rotrSH=_k;const Pk=(e,t,n)=>e<<32-n|t>>>n;vk.rotrSL=Pk;const Bk=(e,t,n)=>e<<64-n|t>>>n-32;vk.rotrBH=Bk;const Ck=(e,t,n)=>e>>>n-32|t<<64-n;vk.rotrBL=Ck;const Ok=(e,t)=>t;vk.rotr32H=Ok;const Lk=(e,t)=>e;vk.rotr32L=Lk;const Fk=(e,t,n)=>e<<n|t>>>32-n;vk.rotlSH=Fk;const Rk=(e,t,n)=>t<<n|e>>>32-n;vk.rotlSL=Rk;const Uk=(e,t,n)=>t<<n-32|e>>>64-n;vk.rotlBH=Uk;const Mk=(e,t,n)=>e<<n-32|t>>>64-n;function $k(e,t,n,r){const i=(t>>>0)+(r>>>0);return{h:e+n+(i/2**32|0)|0,l:0|i}}vk.rotlBL=Mk;const Hk=(e,t,n)=>(e>>>0)+(t>>>0)+(n>>>0);vk.add3L=Hk;const Dk=(e,t,n,r)=>t+n+r+(e/2**32|0)|0;vk.add3H=Dk;const zk=(e,t,n,r)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0);vk.add4L=zk;const Wk=(e,t,n,r,i)=>t+n+r+i+(e/2**32|0)|0;vk.add4H=Wk;const Vk=(e,t,n,r,i)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0)+(i>>>0);vk.add5L=Vk;const jk=(e,t,n,r,i,a)=>t+n+r+i+a+(e/2**32|0)|0;vk.add5H=jk;const qk={fromBig:Ik,split:kk,toBig:Ak,shrSH:Nk,shrSL:Tk,rotrSH:_k,rotrSL:Pk,rotrBH:Bk,rotrBL:Ck,rotr32H:Ok,rotr32L:Lk,rotlSH:Fk,rotlSL:Rk,rotlBH:Uk,rotlBL:Mk,add:$k,add3L:Hk,add3H:Dk,add4L:zk,add4H:Wk,add5H:jk,add5L:Vk};vk.default=qk,Object.defineProperty(xk,"__esModule",{value:!0}),xk.sha512_224=xk.sha512_256=xk.sha384=xk.sha512=xk.sha224=xk.sha256=xk.SHA512_256=xk.SHA512_224=xk.SHA384=xk.SHA512=xk.SHA224=xk.SHA256=void 0;const Kk=DI,Xk=vk,Gk=zI,Yk=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Jk=new Uint32Array(64);class Qk extends Kk.HashMD{constructor(e=32){super(64,e,8,!1),this.A=0|Kk.SHA256_IV[0],this.B=0|Kk.SHA256_IV[1],this.C=0|Kk.SHA256_IV[2],this.D=0|Kk.SHA256_IV[3],this.E=0|Kk.SHA256_IV[4],this.F=0|Kk.SHA256_IV[5],this.G=0|Kk.SHA256_IV[6],this.H=0|Kk.SHA256_IV[7]}get(){const{A:e,B:t,C:n,D:r,E:i,F:a,G:o,H:s}=this;return[e,t,n,r,i,a,o,s]}set(e,t,n,r,i,a,o,s){this.A=0|e,this.B=0|t,this.C=0|n,this.D=0|r,this.E=0|i,this.F=0|a,this.G=0|o,this.H=0|s}process(e,t){for(let u=0;u<16;u++,t+=4)Jk[u]=e.getUint32(t,!1);for(let u=16;u<64;u++){const e=Jk[u-15],t=Jk[u-2],n=(0,Gk.rotr)(e,7)^(0,Gk.rotr)(e,18)^e>>>3,r=(0,Gk.rotr)(t,17)^(0,Gk.rotr)(t,19)^t>>>10;Jk[u]=r+Jk[u-7]+n+Jk[u-16]|0}let{A:n,B:r,C:i,D:a,E:o,F:s,G:l,H:c}=this;for(let u=0;u<64;u++){const e=c+((0,Gk.rotr)(o,6)^(0,Gk.rotr)(o,11)^(0,Gk.rotr)(o,25))+(0,Kk.Chi)(o,s,l)+Yk[u]+Jk[u]|0,t=((0,Gk.rotr)(n,2)^(0,Gk.rotr)(n,13)^(0,Gk.rotr)(n,22))+(0,Kk.Maj)(n,r,i)|0;c=l,l=s,s=o,o=a+e|0,a=i,i=r,r=n,n=e+t|0}n=n+this.A|0,r=r+this.B|0,i=i+this.C|0,a=a+this.D|0,o=o+this.E|0,s=s+this.F|0,l=l+this.G|0,c=c+this.H|0,this.set(n,r,i,a,o,s,l,c)}roundClean(){(0,Gk.clean)(Jk)}destroy(){this.set(0,0,0,0,0,0,0,0),(0,Gk.clean)(this.buffer)}}xk.SHA256=Qk;class Zk extends Qk{constructor(){super(28),this.A=0|Kk.SHA224_IV[0],this.B=0|Kk.SHA224_IV[1],this.C=0|Kk.SHA224_IV[2],this.D=0|Kk.SHA224_IV[3],this.E=0|Kk.SHA224_IV[4],this.F=0|Kk.SHA224_IV[5],this.G=0|Kk.SHA224_IV[6],this.H=0|Kk.SHA224_IV[7]}}xk.SHA224=Zk;const eA=(()=>Xk.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))))(),tA=(()=>eA[0])(),nA=(()=>eA[1])(),rA=new Uint32Array(80),iA=new Uint32Array(80);class aA extends Kk.HashMD{constructor(e=64){super(128,e,16,!1),this.Ah=0|Kk.SHA512_IV[0],this.Al=0|Kk.SHA512_IV[1],this.Bh=0|Kk.SHA512_IV[2],this.Bl=0|Kk.SHA512_IV[3],this.Ch=0|Kk.SHA512_IV[4],this.Cl=0|Kk.SHA512_IV[5],this.Dh=0|Kk.SHA512_IV[6],this.Dl=0|Kk.SHA512_IV[7],this.Eh=0|Kk.SHA512_IV[8],this.El=0|Kk.SHA512_IV[9],this.Fh=0|Kk.SHA512_IV[10],this.Fl=0|Kk.SHA512_IV[11],this.Gh=0|Kk.SHA512_IV[12],this.Gl=0|Kk.SHA512_IV[13],this.Hh=0|Kk.SHA512_IV[14],this.Hl=0|Kk.SHA512_IV[15]}get(){const{Ah:e,Al:t,Bh:n,Bl:r,Ch:i,Cl:a,Dh:o,Dl:s,Eh:l,El:c,Fh:u,Fl:d,Gh:f,Gl:p,Hh:m,Hl:h}=this;return[e,t,n,r,i,a,o,s,l,c,u,d,f,p,m,h]}set(e,t,n,r,i,a,o,s,l,c,u,d,f,p,m,h){this.Ah=0|e,this.Al=0|t,this.Bh=0|n,this.Bl=0|r,this.Ch=0|i,this.Cl=0|a,this.Dh=0|o,this.Dl=0|s,this.Eh=0|l,this.El=0|c,this.Fh=0|u,this.Fl=0|d,this.Gh=0|f,this.Gl=0|p,this.Hh=0|m,this.Hl=0|h}process(e,t){for(let b=0;b<16;b++,t+=4)rA[b]=e.getUint32(t),iA[b]=e.getUint32(t+=4);for(let b=16;b<80;b++){const e=0|rA[b-15],t=0|iA[b-15],n=Xk.rotrSH(e,t,1)^Xk.rotrSH(e,t,8)^Xk.shrSH(e,t,7),r=Xk.rotrSL(e,t,1)^Xk.rotrSL(e,t,8)^Xk.shrSL(e,t,7),i=0|rA[b-2],a=0|iA[b-2],o=Xk.rotrSH(i,a,19)^Xk.rotrBH(i,a,61)^Xk.shrSH(i,a,6),s=Xk.rotrSL(i,a,19)^Xk.rotrBL(i,a,61)^Xk.shrSL(i,a,6),l=Xk.add4L(r,s,iA[b-7],iA[b-16]),c=Xk.add4H(l,n,o,rA[b-7],rA[b-16]);rA[b]=0|c,iA[b]=0|l}let{Ah:n,Al:r,Bh:i,Bl:a,Ch:o,Cl:s,Dh:l,Dl:c,Eh:u,El:d,Fh:f,Fl:p,Gh:m,Gl:h,Hh:g,Hl:y}=this;for(let b=0;b<80;b++){const e=Xk.rotrSH(u,d,14)^Xk.rotrSH(u,d,18)^Xk.rotrBH(u,d,41),t=Xk.rotrSL(u,d,14)^Xk.rotrSL(u,d,18)^Xk.rotrBL(u,d,41),w=u&f^~u&m,x=d&p^~d&h,v=Xk.add5L(y,t,x,nA[b],iA[b]),S=Xk.add5H(v,g,e,w,tA[b],rA[b]),E=0|v,I=Xk.rotrSH(n,r,28)^Xk.rotrBH(n,r,34)^Xk.rotrBH(n,r,39),k=Xk.rotrSL(n,r,28)^Xk.rotrBL(n,r,34)^Xk.rotrBL(n,r,39),A=n&i^n&o^i&o,N=r&a^r&s^a&s;g=0|m,y=0|h,m=0|f,h=0|p,f=0|u,p=0|d,({h:u,l:d}=Xk.add(0|l,0|c,0|S,0|E)),l=0|o,c=0|s,o=0|i,s=0|a,i=0|n,a=0|r;const T=Xk.add3L(E,k,N);n=Xk.add3H(T,S,I,A),r=0|T}({h:n,l:r}=Xk.add(0|this.Ah,0|this.Al,0|n,0|r)),({h:i,l:a}=Xk.add(0|this.Bh,0|this.Bl,0|i,0|a)),({h:o,l:s}=Xk.add(0|this.Ch,0|this.Cl,0|o,0|s)),({h:l,l:c}=Xk.add(0|this.Dh,0|this.Dl,0|l,0|c)),({h:u,l:d}=Xk.add(0|this.Eh,0|this.El,0|u,0|d)),({h:f,l:p}=Xk.add(0|this.Fh,0|this.Fl,0|f,0|p)),({h:m,l:h}=Xk.add(0|this.Gh,0|this.Gl,0|m,0|h)),({h:g,l:y}=Xk.add(0|this.Hh,0|this.Hl,0|g,0|y)),this.set(n,r,i,a,o,s,l,c,u,d,f,p,m,h,g,y)}roundClean(){(0,Gk.clean)(rA,iA)}destroy(){(0,Gk.clean)(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}xk.SHA512=aA;class oA extends aA{constructor(){super(48),this.Ah=0|Kk.SHA384_IV[0],this.Al=0|Kk.SHA384_IV[1],this.Bh=0|Kk.SHA384_IV[2],this.Bl=0|Kk.SHA384_IV[3],this.Ch=0|Kk.SHA384_IV[4],this.Cl=0|Kk.SHA384_IV[5],this.Dh=0|Kk.SHA384_IV[6],this.Dl=0|Kk.SHA384_IV[7],this.Eh=0|Kk.SHA384_IV[8],this.El=0|Kk.SHA384_IV[9],this.Fh=0|Kk.SHA384_IV[10],this.Fl=0|Kk.SHA384_IV[11],this.Gh=0|Kk.SHA384_IV[12],this.Gl=0|Kk.SHA384_IV[13],this.Hh=0|Kk.SHA384_IV[14],this.Hl=0|Kk.SHA384_IV[15]}}xk.SHA384=oA;const sA=Uint32Array.from([2352822216,424955298,1944164710,2312950998,502970286,855612546,1738396948,1479516111,258812777,2077511080,2011393907,79989058,1067287976,1780299464,286451373,2446758561]),lA=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class cA extends aA{constructor(){super(28),this.Ah=0|sA[0],this.Al=0|sA[1],this.Bh=0|sA[2],this.Bl=0|sA[3],this.Ch=0|sA[4],this.Cl=0|sA[5],this.Dh=0|sA[6],this.Dl=0|sA[7],this.Eh=0|sA[8],this.El=0|sA[9],this.Fh=0|sA[10],this.Fl=0|sA[11],this.Gh=0|sA[12],this.Gl=0|sA[13],this.Hh=0|sA[14],this.Hl=0|sA[15]}}xk.SHA512_224=cA;class uA extends aA{constructor(){super(32),this.Ah=0|lA[0],this.Al=0|lA[1],this.Bh=0|lA[2],this.Bl=0|lA[3],this.Ch=0|lA[4],this.Cl=0|lA[5],this.Dh=0|lA[6],this.Dl=0|lA[7],this.Eh=0|lA[8],this.El=0|lA[9],this.Fh=0|lA[10],this.Fl=0|lA[11],this.Gh=0|lA[12],this.Gl=0|lA[13],this.Hh=0|lA[14],this.Hl=0|lA[15]}}xk.SHA512_256=uA,xk.sha256=(0,Gk.createHasher)(()=>new Qk),xk.sha224=(0,Gk.createHasher)(()=>new Zk),xk.sha512=(0,Gk.createHasher)(()=>new aA),xk.sha384=(0,Gk.createHasher)(()=>new oA),xk.sha512_256=(0,Gk.createHasher)(()=>new uA),xk.sha512_224=(0,Gk.createHasher)(()=>new cA),Object.defineProperty(wk,"__esModule",{value:!0}),wk.sha224=wk.SHA224=wk.sha256=wk.SHA256=void 0;const dA=xk;wk.SHA256=dA.SHA256,wk.sha256=dA.sha256,wk.SHA224=dA.SHA224,wk.sha224=dA.sha224,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.taggedHash=e.TAGGED_HASH_PREFIXES=e.TAGS=e.hash256=e.hash160=e.sha256=e.sha1=e.ripemd160=void 0;const t=$I,n=yk,r=wk;function i(e){return Buffer.from((0,r.sha256)(Uint8Array.from(e)))}e.ripemd160=function(e){return Buffer.from((0,t.ripemd160)(Uint8Array.from(e)))},e.sha1=function(e){return Buffer.from((0,n.sha1)(Uint8Array.from(e)))},e.sha256=i,e.hash160=function(e){return Buffer.from((0,t.ripemd160)((0,r.sha256)(Uint8Array.from(e))))},e.hash256=function(e){return Buffer.from((0,r.sha256)((0,r.sha256)(Uint8Array.from(e))))},e.TAGS=["BIP0340/challenge","BIP0340/aux","BIP0340/nonce","TapLeaf","TapBranch","TapSighash","TapTweak","KeyAgg list","KeyAgg coefficient"],e.TAGGED_HASH_PREFIXES={"BIP0340/challenge":Buffer.from([123,181,45,122,159,239,88,50,62,177,191,122,64,125,179,130,210,243,242,216,27,177,34,79,73,254,81,143,109,72,211,124,123,181,45,122,159,239,88,50,62,177,191,122,64,125,179,130,210,243,242,216,27,177,34,79,73,254,81,143,109,72,211,124]),"BIP0340/aux":Buffer.from([241,239,78,94,192,99,202,218,109,148,202,250,157,152,126,160,105,38,88,57,236,193,31,151,45,119,165,46,216,193,204,144,241,239,78,94,192,99,202,218,109,148,202,250,157,152,126,160,105,38,88,57,236,193,31,151,45,119,165,46,216,193,204,144]),"BIP0340/nonce":Buffer.from([7,73,119,52,167,155,203,53,91,155,140,125,3,79,18,28,244,52,215,62,247,45,218,25,135,0,97,251,82,191,235,47,7,73,119,52,167,155,203,53,91,155,140,125,3,79,18,28,244,52,215,62,247,45,218,25,135,0,97,251,82,191,235,47]),TapLeaf:Buffer.from([174,234,143,220,66,8,152,49,5,115,75,88,8,29,30,38,56,211,95,28,181,64,8,212,211,87,202,3,190,120,233,238,174,234,143,220,66,8,152,49,5,115,75,88,8,29,30,38,56,211,95,28,181,64,8,212,211,87,202,3,190,120,233,238]),TapBranch:Buffer.from([25,65,161,242,229,110,185,95,162,169,241,148,190,92,1,247,33,111,51,237,130,176,145,70,52,144,208,91,245,22,160,21,25,65,161,242,229,110,185,95,162,169,241,148,190,92,1,247,33,111,51,237,130,176,145,70,52,144,208,91,245,22,160,21]),TapSighash:Buffer.from([244,10,72,223,75,42,112,200,180,146,75,242,101,70,97,237,61,149,253,102,163,19,235,135,35,117,151,198,40,228,160,49,244,10,72,223,75,42,112,200,180,146,75,242,101,70,97,237,61,149,253,102,163,19,235,135,35,117,151,198,40,228,160,49]),TapTweak:Buffer.from([232,15,225,99,156,156,160,80,227,175,27,57,193,67,198,62,66,156,188,235,21,217,64,251,181,197,161,244,175,87,197,233,232,15,225,99,156,156,160,80,227,175,27,57,193,67,198,62,66,156,188,235,21,217,64,251,181,197,161,244,175,87,197,233]),"KeyAgg list":Buffer.from([72,28,151,28,60,11,70,215,240,178,117,174,89,141,78,44,126,215,49,156,89,74,92,110,199,158,160,212,153,2,148,240,72,28,151,28,60,11,70,215,240,178,117,174,89,141,78,44,126,215,49,156,89,74,92,110,199,158,160,212,153,2,148,240]),"KeyAgg coefficient":Buffer.from([191,201,4,3,77,28,136,232,200,14,34,229,61,36,86,109,100,130,78,214,66,114,129,192,145,0,249,77,205,82,201,129,191,201,4,3,77,28,136,232,200,14,34,229,61,36,86,109,100,130,78,214,66,114,129,192,145,0,249,77,205,82,201,129])},e.taggedHash=function(t,n){return i(Buffer.concat([e.TAGGED_HASH_PREFIXES[t],n]))}}(MI);var fA=function(e){for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var r=0;r<58;r++){var i=e.charAt(r),a=i.charCodeAt(0);if(255!==t[a])throw new TypeError(i+" is ambiguous");t[a]=r}var o=58,s=e.charAt(0),l=Math.log(o)/Math.log(256),c=Math.log(256)/Math.log(o);function u(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;for(var n=0,r=0,i=0;e[n]===s;)r++,n++;for(var a=(e.length-n)*l+1>>>0,c=new Uint8Array(a);e[n];){var u=e.charCodeAt(n);if(u>255)return;var d=t[u];if(255===d)return;for(var f=0,p=a-1;(0!==d||f<i)&&-1!==p;p--,f++)d+=o*c[p]>>>0,c[p]=d%256>>>0,d=d/256>>>0;if(0!==d)throw new Error("Non-zero carry");i=f,n++}for(var m=a-i;m!==a&&0===c[m];)m++;for(var h=new Uint8Array(r+(a-m)),g=r;m!==a;)h[g++]=c[m++];return h}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var n=0,r=0,i=0,a=t.length;i!==a&&0===t[i];)i++,n++;for(var l=(a-i)*c+1>>>0,u=new Uint8Array(l);i!==a;){for(var d=t[i],f=0,p=l-1;(0!==d||f<r)&&-1!==p;p--,f++)d+=256*u[p]>>>0,u[p]=d%o>>>0,d=d/o>>>0;if(0!==d)throw new Error("Non-zero carry");r=f,i++}for(var m=l-r;m!==l&&0===u[m];)m++;for(var h=s.repeat(n);m<l;++m)h+=e.charAt(u[m]);return h},decodeUnsafe:u,decode:function(e){var t=u(e);if(t)return t;throw new Error("Non-base58 character")}}}("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),{sha256:pA}=wk,mA=function(e){function t(t){var n=t.slice(0,-4),r=t.slice(-4),i=e(n);if(!(r[0]^i[0]|r[1]^i[1]|r[2]^i[2]|r[3]^i[3]))return n}return{encode:function(t){var n=Uint8Array.from(t),r=e(n),i=n.length+4,a=new Uint8Array(i);return a.set(n,0),a.set(r.subarray(0,4),n.length),fA.encode(a,i)},decode:function(e){var n=t(fA.decode(e));if(!n)throw new Error("Invalid checksum");return n},decodeUnsafe:function(e){var n=fA.decodeUnsafe(e);if(n)return t(n)}}}(function(e){return pA(pA(e))});Object.defineProperty(UI,"__esModule",{value:!0}),UI.p2pkh=void 0;const hA=MI,gA=bE,yA=yI(),bA=BE,wA=bI,xA=mA,vA=yA.OPS;UI.p2pkh=function(e,t){if(!(e.address||e.hash||e.output||e.pubkey||e.input))throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),(0,bA.typeforce)({network:bA.typeforce.maybe(bA.typeforce.Object),address:bA.typeforce.maybe(bA.typeforce.String),hash:bA.typeforce.maybe(bA.typeforce.BufferN(20)),output:bA.typeforce.maybe(bA.typeforce.BufferN(25)),pubkey:bA.typeforce.maybe(bA.isPoint),signature:bA.typeforce.maybe(yA.isCanonicalScriptSignature),input:bA.typeforce.maybe(bA.typeforce.Buffer)},e);const n=wA.value(()=>{const t=Buffer.from(xA.decode(e.address));return{version:t.readUInt8(0),hash:t.slice(1)}}),r=wA.value(()=>yA.decompile(e.input)),i=e.network||gA.bitcoin,a={name:"p2pkh",network:i};if(wA.prop(a,"address",()=>{if(!a.hash)return;const e=Buffer.allocUnsafe(21);return e.writeUInt8(i.pubKeyHash,0),a.hash.copy(e,1),xA.encode(e)}),wA.prop(a,"hash",()=>e.output?e.output.slice(3,23):e.address?n().hash:e.pubkey||a.pubkey?hA.hash160(e.pubkey||a.pubkey):void 0),wA.prop(a,"output",()=>{if(a.hash)return yA.compile([vA.OP_DUP,vA.OP_HASH160,a.hash,vA.OP_EQUALVERIFY,vA.OP_CHECKSIG])}),wA.prop(a,"pubkey",()=>{if(e.input)return r()[1]}),wA.prop(a,"signature",()=>{if(e.input)return r()[0]}),wA.prop(a,"input",()=>{if(e.pubkey&&e.signature)return yA.compile([e.signature,e.pubkey])}),wA.prop(a,"witness",()=>{if(a.input)return[]}),t.validate){let t=Buffer.from([]);if(e.address){if(n().version!==i.pubKeyHash)throw new TypeError("Invalid version or Network mismatch");if(20!==n().hash.length)throw new TypeError("Invalid address");t=n().hash}if(e.hash){if(t.length>0&&!t.equals(e.hash))throw new TypeError("Hash mismatch");t=e.hash}if(e.output){if(25!==e.output.length||e.output[0]!==vA.OP_DUP||e.output[1]!==vA.OP_HASH160||20!==e.output[2]||e.output[23]!==vA.OP_EQUALVERIFY||e.output[24]!==vA.OP_CHECKSIG)throw new TypeError("Output is invalid");const n=e.output.slice(3,23);if(t.length>0&&!t.equals(n))throw new TypeError("Hash mismatch");t=n}if(e.pubkey){const n=hA.hash160(e.pubkey);if(t.length>0&&!t.equals(n))throw new TypeError("Hash mismatch");t=n}if(e.input){const n=r();if(2!==n.length)throw new TypeError("Input is invalid");if(!yA.isCanonicalScriptSignature(n[0]))throw new TypeError("Input has invalid signature");if(!(0,bA.isPoint)(n[1]))throw new TypeError("Input has invalid pubkey");if(e.signature&&!e.signature.equals(n[0]))throw new TypeError("Signature mismatch");if(e.pubkey&&!e.pubkey.equals(n[1]))throw new TypeError("Pubkey mismatch");const i=hA.hash160(n[1]);if(t.length>0&&!t.equals(i))throw new TypeError("Hash mismatch")}}return Object.assign(a,e)};var SA={};Object.defineProperty(SA,"__esModule",{value:!0}),SA.p2sh=void 0;const EA=MI,IA=bE,kA=yI(),AA=BE,NA=bI,TA=mA,_A=kA.OPS;SA.p2sh=function(e,t){if(!(e.address||e.hash||e.output||e.redeem||e.input))throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),(0,AA.typeforce)({network:AA.typeforce.maybe(AA.typeforce.Object),address:AA.typeforce.maybe(AA.typeforce.String),hash:AA.typeforce.maybe(AA.typeforce.BufferN(20)),output:AA.typeforce.maybe(AA.typeforce.BufferN(23)),redeem:AA.typeforce.maybe({network:AA.typeforce.maybe(AA.typeforce.Object),output:AA.typeforce.maybe(AA.typeforce.Buffer),input:AA.typeforce.maybe(AA.typeforce.Buffer),witness:AA.typeforce.maybe(AA.typeforce.arrayOf(AA.typeforce.Buffer))}),input:AA.typeforce.maybe(AA.typeforce.Buffer),witness:AA.typeforce.maybe(AA.typeforce.arrayOf(AA.typeforce.Buffer))},e);let n=e.network;n||(n=e.redeem&&e.redeem.network||IA.bitcoin);const r={network:n},i=NA.value(()=>{const t=Buffer.from(TA.decode(e.address));return{version:t.readUInt8(0),hash:t.slice(1)}}),a=NA.value(()=>kA.decompile(e.input)),o=NA.value(()=>{const t=a(),r=t[t.length-1];return{network:n,output:r===_A.OP_FALSE?Buffer.from([]):r,input:kA.compile(t.slice(0,-1)),witness:e.witness||[]}});if(NA.prop(r,"address",()=>{if(!r.hash)return;const e=Buffer.allocUnsafe(21);return e.writeUInt8(r.network.scriptHash,0),r.hash.copy(e,1),TA.encode(e)}),NA.prop(r,"hash",()=>e.output?e.output.slice(2,22):e.address?i().hash:r.redeem&&r.redeem.output?EA.hash160(r.redeem.output):void 0),NA.prop(r,"output",()=>{if(r.hash)return kA.compile([_A.OP_HASH160,r.hash,_A.OP_EQUAL])}),NA.prop(r,"redeem",()=>{if(e.input)return o()}),NA.prop(r,"input",()=>{if(e.redeem&&e.redeem.input&&e.redeem.output)return kA.compile([].concat(kA.decompile(e.redeem.input),e.redeem.output))}),NA.prop(r,"witness",()=>r.redeem&&r.redeem.witness?r.redeem.witness:r.input?[]:void 0),NA.prop(r,"name",()=>{const e=["p2sh"];return void 0!==r.redeem&&void 0!==r.redeem.name&&e.push(r.redeem.name),e.join("-")}),t.validate){let t=Buffer.from([]);if(e.address){if(i().version!==n.scriptHash)throw new TypeError("Invalid version or Network mismatch");if(20!==i().hash.length)throw new TypeError("Invalid address");t=i().hash}if(e.hash){if(t.length>0&&!t.equals(e.hash))throw new TypeError("Hash mismatch");t=e.hash}if(e.output){if(23!==e.output.length||e.output[0]!==_A.OP_HASH160||20!==e.output[1]||e.output[22]!==_A.OP_EQUAL)throw new TypeError("Output is invalid");const n=e.output.slice(2,22);if(t.length>0&&!t.equals(n))throw new TypeError("Hash mismatch");t=n}const r=e=>{if(e.output){const n=kA.decompile(e.output);if(!n||n.length<1)throw new TypeError("Redeem.output too short");if(e.output.byteLength>520)throw new TypeError("Redeem.output unspendable if larger than 520 bytes");if(kA.countNonPushOnlyOPs(n)>201)throw new TypeError("Redeem.output unspendable with more than 201 non-push ops");const r=EA.hash160(e.output);if(t.length>0&&!t.equals(r))throw new TypeError("Hash mismatch");t=r}if(e.input){const t=e.input.length>0,n=e.witness&&e.witness.length>0;if(!t&&!n)throw new TypeError("Empty input");if(t&&n)throw new TypeError("Input and witness provided");if(t){const t=kA.decompile(e.input);if(!kA.isPushOnly(t))throw new TypeError("Non push-only scriptSig")}}};if(e.input){const e=a();if(!e||e.length<1)throw new TypeError("Input too short");if(!Buffer.isBuffer(o().output))throw new TypeError("Input is invalid");r(o())}if(e.redeem){if(e.redeem.network&&e.redeem.network!==n)throw new TypeError("Network mismatch");if(e.input){const t=o();if(e.redeem.output&&!e.redeem.output.equals(t.output))throw new TypeError("Redeem.output mismatch");if(e.redeem.input&&!e.redeem.input.equals(t.input))throw new TypeError("Redeem.input mismatch")}r(e.redeem)}if(e.witness&&e.redeem&&e.redeem.witness&&!(0,AA.stacksEqual)(e.redeem.witness,e.witness))throw new TypeError("Witness and redeem.witness mismatch")}return Object.assign(r,e)};var PA={},BA={};Object.defineProperty(BA,"__esModule",{value:!0}),BA.bech32m=BA.bech32=void 0;const CA="qpzry9x8gf2tvdw0s3jn54khce6mua7l",OA={};for(let dC=0;dC<32;dC++){const e=CA.charAt(dC);OA[e]=dC}function LA(e){const t=e>>25;return(33554431&e)<<5^996825010&-(1&t)^642813549&-(t>>1&1)^513874426&-(t>>2&1)^1027748829&-(t>>3&1)^705979059&-(t>>4&1)}function FA(e){let t=1;for(let n=0;n<e.length;++n){const r=e.charCodeAt(n);if(r<33||r>126)return"Invalid prefix ("+e+")";t=LA(t)^r>>5}t=LA(t);for(let n=0;n<e.length;++n){const r=e.charCodeAt(n);t=LA(t)^31&r}return t}function RA(e,t,n,r){let i=0,a=0;const o=(1<<n)-1,s=[];for(let l=0;l<e.length;++l)for(i=i<<t|e[l],a+=t;a>=n;)a-=n,s.push(i>>a&o);if(r)a>0&&s.push(i<<n-a&o);else{if(a>=t)return"Excess padding";if(i<<n-a&o)return"Non-zero padding"}return s}function UA(e){return RA(e,8,5,!0)}function MA(e){const t=RA(e,5,8,!1);if(Array.isArray(t))return t}function $A(e){const t=RA(e,5,8,!1);if(Array.isArray(t))return t;throw new Error(t)}function HA(e){let t;function n(e,n){if(n=n||90,e.length<8)return e+" too short";if(e.length>n)return"Exceeds length limit";const r=e.toLowerCase(),i=e.toUpperCase();if(e!==r&&e!==i)return"Mixed-case string "+e;const a=(e=r).lastIndexOf("1");if(-1===a)return"No separator character for "+e;if(0===a)return"Missing prefix for "+e;const o=e.slice(0,a),s=e.slice(a+1);if(s.length<6)return"Data too short";let l=FA(o);if("string"==typeof l)return l;const c=[];for(let t=0;t<s.length;++t){const e=s.charAt(t),n=OA[e];if(void 0===n)return"Unknown character "+e;l=LA(l)^n,t+6>=s.length||c.push(n)}return l!==t?"Invalid checksum for "+e:{prefix:o,words:c}}return t="bech32"===e?1:734539939,{decodeUnsafe:function(e,t){const r=n(e,t);if("object"==typeof r)return r},decode:function(e,t){const r=n(e,t);if("object"==typeof r)return r;throw new Error(r)},encode:function(e,n,r){if(r=r||90,e.length+7+n.length>r)throw new TypeError("Exceeds length limit");let i=FA(e=e.toLowerCase());if("string"==typeof i)throw new Error(i);let a=e+"1";for(let t=0;t<n.length;++t){const e=n[t];if(e>>5)throw new Error("Non 5-bit word");i=LA(i)^e,a+=CA.charAt(e)}for(let t=0;t<6;++t)i=LA(i);i^=t;for(let t=0;t<6;++t)a+=CA.charAt(i>>5*(5-t)&31);return a},toWords:UA,fromWordsUnsafe:MA,fromWords:$A}}BA.bech32=HA("bech32"),BA.bech32m=HA("bech32m"),Object.defineProperty(PA,"__esModule",{value:!0}),PA.p2wpkh=void 0;const DA=MI,zA=bE,WA=yI(),VA=BE,jA=bI,qA=BA,KA=WA.OPS,XA=Buffer.alloc(0);PA.p2wpkh=function(e,t){if(!(e.address||e.hash||e.output||e.pubkey||e.witness))throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),(0,VA.typeforce)({address:VA.typeforce.maybe(VA.typeforce.String),hash:VA.typeforce.maybe(VA.typeforce.BufferN(20)),input:VA.typeforce.maybe(VA.typeforce.BufferN(0)),network:VA.typeforce.maybe(VA.typeforce.Object),output:VA.typeforce.maybe(VA.typeforce.BufferN(22)),pubkey:VA.typeforce.maybe(VA.isPoint),signature:VA.typeforce.maybe(WA.isCanonicalScriptSignature),witness:VA.typeforce.maybe(VA.typeforce.arrayOf(VA.typeforce.Buffer))},e);const n=jA.value(()=>{const t=qA.bech32.decode(e.address),n=t.words.shift(),r=qA.bech32.fromWords(t.words);return{version:n,prefix:t.prefix,data:Buffer.from(r)}}),r=e.network||zA.bitcoin,i={name:"p2wpkh",network:r};if(jA.prop(i,"address",()=>{if(!i.hash)return;const e=qA.bech32.toWords(i.hash);return e.unshift(0),qA.bech32.encode(r.bech32,e)}),jA.prop(i,"hash",()=>e.output?e.output.slice(2,22):e.address?n().data:e.pubkey||i.pubkey?DA.hash160(e.pubkey||i.pubkey):void 0),jA.prop(i,"output",()=>{if(i.hash)return WA.compile([KA.OP_0,i.hash])}),jA.prop(i,"pubkey",()=>e.pubkey?e.pubkey:e.witness?e.witness[1]:void 0),jA.prop(i,"signature",()=>{if(e.witness)return e.witness[0]}),jA.prop(i,"input",()=>{if(i.witness)return XA}),jA.prop(i,"witness",()=>{if(e.pubkey&&e.signature)return[e.signature,e.pubkey]}),t.validate){let t=Buffer.from([]);if(e.address){if(r&&r.bech32!==n().prefix)throw new TypeError("Invalid prefix or Network mismatch");if(0!==n().version)throw new TypeError("Invalid address version");if(20!==n().data.length)throw new TypeError("Invalid address data");t=n().data}if(e.hash){if(t.length>0&&!t.equals(e.hash))throw new TypeError("Hash mismatch");t=e.hash}if(e.output){if(22!==e.output.length||e.output[0]!==KA.OP_0||20!==e.output[1])throw new TypeError("Output is invalid");if(t.length>0&&!t.equals(e.output.slice(2)))throw new TypeError("Hash mismatch");t=e.output.slice(2)}if(e.pubkey){const n=DA.hash160(e.pubkey);if(t.length>0&&!t.equals(n))throw new TypeError("Hash mismatch");if(t=n,!(0,VA.isPoint)(e.pubkey)||33!==e.pubkey.length)throw new TypeError("Invalid pubkey for p2wpkh")}if(e.witness){if(2!==e.witness.length)throw new TypeError("Witness is invalid");if(!WA.isCanonicalScriptSignature(e.witness[0]))throw new TypeError("Witness has invalid signature");if(!(0,VA.isPoint)(e.witness[1])||33!==e.witness[1].length)throw new TypeError("Witness has invalid pubkey");if(e.signature&&!e.signature.equals(e.witness[0]))throw new TypeError("Signature mismatch");if(e.pubkey&&!e.pubkey.equals(e.witness[1]))throw new TypeError("Pubkey mismatch");const n=DA.hash160(e.witness[1]);if(t.length>0&&!t.equals(n))throw new TypeError("Hash mismatch")}}return Object.assign(i,e)};var GA={};Object.defineProperty(GA,"__esModule",{value:!0}),GA.p2wsh=void 0;const YA=MI,JA=bE,QA=yI(),ZA=BE,eN=bI,tN=BA,nN=QA.OPS,rN=Buffer.alloc(0);function iN(e){return!(!Buffer.isBuffer(e)||65!==e.length||4!==e[0]||!(0,ZA.isPoint)(e))}GA.p2wsh=function(e,t){if(!(e.address||e.hash||e.output||e.redeem||e.witness))throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),(0,ZA.typeforce)({network:ZA.typeforce.maybe(ZA.typeforce.Object),address:ZA.typeforce.maybe(ZA.typeforce.String),hash:ZA.typeforce.maybe(ZA.typeforce.BufferN(32)),output:ZA.typeforce.maybe(ZA.typeforce.BufferN(34)),redeem:ZA.typeforce.maybe({input:ZA.typeforce.maybe(ZA.typeforce.Buffer),network:ZA.typeforce.maybe(ZA.typeforce.Object),output:ZA.typeforce.maybe(ZA.typeforce.Buffer),witness:ZA.typeforce.maybe(ZA.typeforce.arrayOf(ZA.typeforce.Buffer))}),input:ZA.typeforce.maybe(ZA.typeforce.BufferN(0)),witness:ZA.typeforce.maybe(ZA.typeforce.arrayOf(ZA.typeforce.Buffer))},e);const n=eN.value(()=>{const t=tN.bech32.decode(e.address),n=t.words.shift(),r=tN.bech32.fromWords(t.words);return{version:n,prefix:t.prefix,data:Buffer.from(r)}}),r=eN.value(()=>QA.decompile(e.redeem.input));let i=e.network;i||(i=e.redeem&&e.redeem.network||JA.bitcoin);const a={network:i};if(eN.prop(a,"address",()=>{if(!a.hash)return;const e=tN.bech32.toWords(a.hash);return e.unshift(0),tN.bech32.encode(i.bech32,e)}),eN.prop(a,"hash",()=>e.output?e.output.slice(2):e.address?n().data:a.redeem&&a.redeem.output?YA.sha256(a.redeem.output):void 0),eN.prop(a,"output",()=>{if(a.hash)return QA.compile([nN.OP_0,a.hash])}),eN.prop(a,"redeem",()=>{if(e.witness)return{output:e.witness[e.witness.length-1],input:rN,witness:e.witness.slice(0,-1)}}),eN.prop(a,"input",()=>{if(a.witness)return rN}),eN.prop(a,"witness",()=>{if(e.redeem&&e.redeem.input&&e.redeem.input.length>0&&e.redeem.output&&e.redeem.output.length>0){const t=QA.toStack(r());return a.redeem=Object.assign({witness:t},e.redeem),a.redeem.input=rN,[].concat(t,e.redeem.output)}if(e.redeem&&e.redeem.output&&e.redeem.witness)return[].concat(e.redeem.witness,e.redeem.output)}),eN.prop(a,"name",()=>{const e=["p2wsh"];return void 0!==a.redeem&&void 0!==a.redeem.name&&e.push(a.redeem.name),e.join("-")}),t.validate){let t=Buffer.from([]);if(e.address){if(n().prefix!==i.bech32)throw new TypeError("Invalid prefix or Network mismatch");if(0!==n().version)throw new TypeError("Invalid address version");if(32!==n().data.length)throw new TypeError("Invalid address data");t=n().data}if(e.hash){if(t.length>0&&!t.equals(e.hash))throw new TypeError("Hash mismatch");t=e.hash}if(e.output){if(34!==e.output.length||e.output[0]!==nN.OP_0||32!==e.output[1])throw new TypeError("Output is invalid");const n=e.output.slice(2);if(t.length>0&&!t.equals(n))throw new TypeError("Hash mismatch");t=n}if(e.redeem){if(e.redeem.network&&e.redeem.network!==i)throw new TypeError("Network mismatch");if(e.redeem.input&&e.redeem.input.length>0&&e.redeem.witness&&e.redeem.witness.length>0)throw new TypeError("Ambiguous witness source");if(e.redeem.output){const n=QA.decompile(e.redeem.output);if(!n||n.length<1)throw new TypeError("Redeem.output is invalid");if(e.redeem.output.byteLength>3600)throw new TypeError("Redeem.output unspendable if larger than 3600 bytes");if(QA.countNonPushOnlyOPs(n)>201)throw new TypeError("Redeem.output unspendable with more than 201 non-push ops");const r=YA.sha256(e.redeem.output);if(t.length>0&&!t.equals(r))throw new TypeError("Hash mismatch");t=r}if(e.redeem.input&&!QA.isPushOnly(r()))throw new TypeError("Non push-only scriptSig");if(e.witness&&e.redeem.witness&&!(0,ZA.stacksEqual)(e.witness,e.redeem.witness))throw new TypeError("Witness and redeem.witness mismatch");if(e.redeem.input&&r().some(iN)||e.redeem.output&&(QA.decompile(e.redeem.output)||[]).some(iN))throw new TypeError("redeem.input or redeem.output contains uncompressed pubkey")}if(e.witness&&e.witness.length>0){const t=e.witness[e.witness.length-1];if(e.redeem&&e.redeem.output&&!e.redeem.output.equals(t))throw new TypeError("Witness and redeem.output mismatch");if(e.witness.some(iN)||(QA.decompile(t)||[]).some(iN))throw new TypeError("Witness contains uncompressed pubkey")}}return Object.assign(a,e)};var aN={},oN={};Object.defineProperty(oN,"__esModule",{value:!0}),oN.getEccLib=oN.initEccLib=void 0;const sN={};oN.initEccLib=function(e,t){var n;e?e!==sN.eccLib&&(t?.DANGER_DO_NOT_VERIFY_ECCLIB||(cN("function"==typeof(n=e).isXOnlyPoint),cN(n.isXOnlyPoint(lN("79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"))),cN(n.isXOnlyPoint(lN("fffffffffffffffffffffffffffffffffffffffffffffffffffffffeeffffc2e"))),cN(n.isXOnlyPoint(lN("f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9"))),cN(n.isXOnlyPoint(lN("0000000000000000000000000000000000000000000000000000000000000001"))),cN(!n.isXOnlyPoint(lN("0000000000000000000000000000000000000000000000000000000000000000"))),cN(!n.isXOnlyPoint(lN("fffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"))),cN("function"==typeof n.xOnlyPointAddTweak),uN.forEach(e=>{const t=n.xOnlyPointAddTweak(lN(e.pubkey),lN(e.tweak));null===e.result?cN(null===t):(cN(null!==t),cN(t.parity===e.parity),cN(Buffer.from(t.xOnlyPubkey).equals(lN(e.result))))})),sN.eccLib=e):sN.eccLib=e},oN.getEccLib=function(){if(!sN.eccLib)throw new Error("No ECC Library provided. You must call initEccLib() with a valid TinySecp256k1Interface instance");return sN.eccLib};const lN=e=>Buffer.from(e,"hex");function cN(e){if(!e)throw new Error("ecc library invalid")}const uN=[{pubkey:"79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798",tweak:"fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364140",parity:-1,result:null},{pubkey:"1617d38ed8d8657da4d4761e8057bc396ea9e4b9d29776d4be096016dbd2509b",tweak:"a8397a935f0dfceba6ba9618f6451ef4d80637abf4e6af2669fbc9de6a8fd2ac",parity:1,result:"e478f99dab91052ab39a33ea35fd5e6e4933f4d28023cd597c9a1f6760346adf"},{pubkey:"2c0b7cf95324a07d05398b240174dc0c2be444d96b159aa6c7f7b1e668680991",tweak:"823c3cd2142744b075a87eade7e1b8678ba308d566226a0056ca2b7a76f86b47",parity:0,result:"9534f8dc8c6deda2dc007655981c78b49c5d96c778fbf363462a11ec9dfd948c"}];var dN={},fN={},pN={exports:{}};!function(e,t){var n=CE,r=n.Buffer;function i(e,t){for(var n in e)t[n]=e[n]}function a(e,t,n){return r(e,t,n)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?e.exports=n:(i(n,t),t.Buffer=a),a.prototype=Object.create(r.prototype),i(r,a),a.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return r(e,t,n)},a.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var i=r(e);return void 0!==t?"string"==typeof n?i.fill(t,n):i.fill(t):i.fill(0),i},a.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r(e)},a.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}}(pN,pN.exports);var mN=pN.exports.Buffer;function hN(e){if(e<0||e>9007199254740991||e%1!=0)throw new RangeError("value out of range")}function gN(e){return hN(e),e<253?1:e<=65535?3:e<=4294967295?5:9}var yN={encode:function e(t,n,r){if(hN(t),n||(n=mN.allocUnsafe(gN(t))),!mN.isBuffer(n))throw new TypeError("buffer must be a Buffer instance");return r||(r=0),t<253?(n.writeUInt8(t,r),e.bytes=1):t<=65535?(n.writeUInt8(253,r),n.writeUInt16LE(t,r+1),e.bytes=3):t<=4294967295?(n.writeUInt8(254,r),n.writeUInt32LE(t,r+1),e.bytes=5):(n.writeUInt8(255,r),n.writeUInt32LE(t>>>0,r+1),n.writeUInt32LE(t/4294967296|0,r+5),e.bytes=9),n},decode:function e(t,n){if(!mN.isBuffer(t))throw new TypeError("buffer must be a Buffer instance");n||(n=0);var r=t.readUInt8(n);if(r<253)return e.bytes=1,r;if(253===r)return e.bytes=3,t.readUInt16LE(n+1);if(254===r)return e.bytes=5,t.readUInt32LE(n+1);e.bytes=9;var i=t.readUInt32LE(n+1),a=4294967296*t.readUInt32LE(n+5)+i;return hN(a),a},encodingLength:gN};Object.defineProperty(fN,"__esModule",{value:!0}),fN.BufferReader=fN.BufferWriter=fN.cloneBuffer=fN.reverseBuffer=fN.writeUInt64LE=fN.readUInt64LE=fN.varuint=void 0;const bN=BE,{typeforce:wN}=bN,xN=yN;function vN(e,t){if("number"!=typeof e)throw new Error("cannot write a non-number as a number");if(e<0)throw new Error("specified a negative value for writing an unsigned value");if(e>t)throw new Error("RangeError: value out of range");if(Math.floor(e)!==e)throw new Error("value has a fractional component")}function SN(e,t){const n=e.readUInt32LE(t);let r=e.readUInt32LE(t+4);return r*=4294967296,vN(r+n,9007199254740991),r+n}function EN(e,t,n){return vN(t,9007199254740991),e.writeInt32LE(-1&t,n),e.writeUInt32LE(Math.floor(t/4294967296),n+4),n+8}fN.varuint=xN,fN.readUInt64LE=SN,fN.writeUInt64LE=EN,fN.reverseBuffer=function(e){if(e.length<1)return e;let t=e.length-1,n=0;for(let r=0;r<e.length/2;r++)n=e[r],e[r]=e[t],e[t]=n,t--;return e},fN.cloneBuffer=function(e){const t=Buffer.allocUnsafe(e.length);return e.copy(t),t};class IN{static withCapacity(e){return new IN(Buffer.alloc(e))}constructor(e,t=0){this.buffer=e,this.offset=t,wN(bN.tuple(bN.Buffer,bN.UInt32),[e,t])}writeUInt8(e){this.offset=this.buffer.writeUInt8(e,this.offset)}writeInt32(e){this.offset=this.buffer.writeInt32LE(e,this.offset)}writeUInt32(e){this.offset=this.buffer.writeUInt32LE(e,this.offset)}writeUInt64(e){this.offset=EN(this.buffer,e,this.offset)}writeVarInt(e){xN.encode(e,this.buffer,this.offset),this.offset+=xN.encode.bytes}writeSlice(e){if(this.buffer.length<this.offset+e.length)throw new Error("Cannot write slice out of bounds");this.offset+=e.copy(this.buffer,this.offset)}writeVarSlice(e){this.writeVarInt(e.length),this.writeSlice(e)}writeVector(e){this.writeVarInt(e.length),e.forEach(e=>this.writeVarSlice(e))}end(){if(this.buffer.length===this.offset)return this.buffer;throw new Error(`buffer size ${this.buffer.length}, offset ${this.offset}`)}}var kN,AN,NN;function TN(){return AN||(AN=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.p2tr=e.p2wsh=e.p2wpkh=e.p2sh=e.p2pkh=e.p2pk=e.p2ms=e.embed=void 0;const t=xE;Object.defineProperty(e,"embed",{enumerable:!0,get:function(){return t.p2data}});const n=II;Object.defineProperty(e,"p2ms",{enumerable:!0,get:function(){return n.p2ms}});const r=BI;Object.defineProperty(e,"p2pk",{enumerable:!0,get:function(){return r.p2pk}});const i=UI;Object.defineProperty(e,"p2pkh",{enumerable:!0,get:function(){return i.p2pkh}});const a=SA;Object.defineProperty(e,"p2sh",{enumerable:!0,get:function(){return a.p2sh}});const o=PA;Object.defineProperty(e,"p2wpkh",{enumerable:!0,get:function(){return o.p2wpkh}});const s=GA;Object.defineProperty(e,"p2wsh",{enumerable:!0,get:function(){return s.p2wsh}});const l=function(){if(kN)return aN;kN=1,Object.defineProperty(aN,"__esModule",{value:!0}),aN.p2tr=void 0;const e=CE,t=bE,n=yI(),r=BE,i=oN,a=dN,o=bI,s=BA,l=_N(),c=n.OPS;return aN.p2tr=function(u,d){if(!(u.address||u.output||u.pubkey||u.internalPubkey||u.witness&&u.witness.length>1))throw new TypeError("Not enough data");d=Object.assign({validate:!0},d||{}),(0,r.typeforce)({address:r.typeforce.maybe(r.typeforce.String),input:r.typeforce.maybe(r.typeforce.BufferN(0)),network:r.typeforce.maybe(r.typeforce.Object),output:r.typeforce.maybe(r.typeforce.BufferN(34)),internalPubkey:r.typeforce.maybe(r.typeforce.BufferN(32)),hash:r.typeforce.maybe(r.typeforce.BufferN(32)),pubkey:r.typeforce.maybe(r.typeforce.BufferN(32)),signature:r.typeforce.maybe(r.typeforce.anyOf(r.typeforce.BufferN(64),r.typeforce.BufferN(65))),witness:r.typeforce.maybe(r.typeforce.arrayOf(r.typeforce.Buffer)),scriptTree:r.typeforce.maybe(r.isTaptree),redeem:r.typeforce.maybe({output:r.typeforce.maybe(r.typeforce.Buffer),redeemVersion:r.typeforce.maybe(r.typeforce.Number),witness:r.typeforce.maybe(r.typeforce.arrayOf(r.typeforce.Buffer))}),redeemVersion:r.typeforce.maybe(r.typeforce.Number)},u);const f=o.value(()=>(0,l.fromBech32)(u.address)),p=o.value(()=>{if(u.witness&&u.witness.length)return u.witness.length>=2&&80===u.witness[u.witness.length-1][0]?u.witness.slice(0,-1):u.witness.slice()}),m=o.value(()=>u.scriptTree?(0,a.toHashTree)(u.scriptTree):u.hash?{hash:u.hash}:void 0),h=u.network||t.bitcoin,g={name:"p2tr",network:h};if(o.prop(g,"address",()=>{if(!g.pubkey)return;const e=s.bech32m.toWords(g.pubkey);return e.unshift(1),s.bech32m.encode(h.bech32,e)}),o.prop(g,"hash",()=>{const e=m();if(e)return e.hash;const t=p();if(t&&t.length>1){const e=t[t.length-1],n=e[0]&r.TAPLEAF_VERSION_MASK,i=t[t.length-2],o=(0,a.tapleafHash)({output:i,version:n});return(0,a.rootHashFromPath)(e,o)}return null}),o.prop(g,"output",()=>{if(g.pubkey)return n.compile([c.OP_1,g.pubkey])}),o.prop(g,"redeemVersion",()=>u.redeemVersion?u.redeemVersion:u.redeem&&void 0!==u.redeem.redeemVersion&&null!==u.redeem.redeemVersion?u.redeem.redeemVersion:a.LEAF_VERSION_TAPSCRIPT),o.prop(g,"redeem",()=>{const e=p();if(e&&!(e.length<2))return{output:e[e.length-2],witness:e.slice(0,-2),redeemVersion:e[e.length-1][0]&r.TAPLEAF_VERSION_MASK}}),o.prop(g,"pubkey",()=>{if(u.pubkey)return u.pubkey;if(u.output)return u.output.slice(2);if(u.address)return f().data;if(g.internalPubkey){const e=(0,a.tweakKey)(g.internalPubkey,g.hash);if(e)return e.x}}),o.prop(g,"internalPubkey",()=>{if(u.internalPubkey)return u.internalPubkey;const e=p();return e&&e.length>1?e[e.length-1].slice(1,33):void 0}),o.prop(g,"signature",()=>{if(u.signature)return u.signature;const e=p();return e&&1===e.length?e[0]:void 0}),o.prop(g,"witness",()=>{if(u.witness)return u.witness;const t=m();if(t&&u.redeem&&u.redeem.output&&u.internalPubkey){const n=(0,a.tapleafHash)({output:u.redeem.output,version:g.redeemVersion}),r=(0,a.findScriptPath)(t,n);if(!r)return;const i=(0,a.tweakKey)(u.internalPubkey,t.hash);if(!i)return;const o=e.Buffer.concat([e.Buffer.from([g.redeemVersion|i.parity]),u.internalPubkey].concat(r));return[u.redeem.output,o]}return u.signature?[u.signature]:void 0}),d.validate){let t=e.Buffer.from([]);if(u.address){if(h&&h.bech32!==f().prefix)throw new TypeError("Invalid prefix or Network mismatch");if(1!==f().version)throw new TypeError("Invalid address version");if(32!==f().data.length)throw new TypeError("Invalid address data");t=f().data}if(u.pubkey){if(t.length>0&&!t.equals(u.pubkey))throw new TypeError("Pubkey mismatch");t=u.pubkey}if(u.output){if(34!==u.output.length||u.output[0]!==c.OP_1||32!==u.output[1])throw new TypeError("Output is invalid");if(t.length>0&&!t.equals(u.output.slice(2)))throw new TypeError("Pubkey mismatch");t=u.output.slice(2)}if(u.internalPubkey){const e=(0,a.tweakKey)(u.internalPubkey,g.hash);if(t.length>0&&!t.equals(e.x))throw new TypeError("Pubkey mismatch");t=e.x}if(t&&t.length&&!(0,i.getEccLib)().isXOnlyPoint(t))throw new TypeError("Invalid pubkey for p2tr");const o=m();if(u.hash&&o&&!u.hash.equals(o.hash))throw new TypeError("Hash mismatch");if(u.redeem&&u.redeem.output&&o){const e=(0,a.tapleafHash)({output:u.redeem.output,version:g.redeemVersion});if(!(0,a.findScriptPath)(o,e))throw new TypeError("Redeem script not in tree")}const s=p();if(u.redeem&&g.redeem){if(u.redeem.redeemVersion&&u.redeem.redeemVersion!==g.redeem.redeemVersion)throw new TypeError("Redeem.redeemVersion and witness mismatch");if(u.redeem.output){if(0===n.decompile(u.redeem.output).length)throw new TypeError("Redeem.output is invalid");if(g.redeem.output&&!u.redeem.output.equals(g.redeem.output))throw new TypeError("Redeem.output and witness mismatch")}if(u.redeem.witness&&g.redeem.witness&&!(0,r.stacksEqual)(u.redeem.witness,g.redeem.witness))throw new TypeError("Redeem.witness and witness mismatch")}if(s&&s.length)if(1===s.length){if(u.signature&&!u.signature.equals(s[0]))throw new TypeError("Signature mismatch")}else{const e=s[s.length-1];if(e.length<33)throw new TypeError(`The control-block length is too small. Got ${e.length}, expected min 33.`);if((e.length-33)%32!=0)throw new TypeError(`The control-block length of ${e.length} is incorrect!`);const n=(e.length-33)/32;if(n>128)throw new TypeError(`The script path is too long. Got ${n}, expected max 128.`);const o=e.slice(1,33);if(u.internalPubkey&&!u.internalPubkey.equals(o))throw new TypeError("Internal pubkey mismatch");if(!(0,i.getEccLib)().isXOnlyPoint(o))throw new TypeError("Invalid internalPubkey for p2tr witness");const l=e[0]&r.TAPLEAF_VERSION_MASK,c=s[s.length-2],d=(0,a.tapleafHash)({output:c,version:l}),f=(0,a.rootHashFromPath)(e,d),p=(0,a.tweakKey)(o,f);if(!p)throw new TypeError("Invalid outputKey for p2tr witness");if(t.length&&!t.equals(p.x))throw new TypeError("Pubkey mismatch for p2tr witness");if(p.parity!==(1&e[0]))throw new Error("Incorrect parity")}}return Object.assign(g,u)},aN}();Object.defineProperty(e,"p2tr",{enumerable:!0,get:function(){return l.p2tr}})}(wE)),wE}function _N(){if(NN)return yE;NN=1,Object.defineProperty(yE,"__esModule",{value:!0}),yE.toOutputScript=yE.fromOutputScript=yE.toBech32=yE.toBase58Check=yE.fromBech32=yE.fromBase58Check=void 0;const e=bE,t=TN(),n=yI(),r=BE,i=BA,a=mA;function o(e){const t=Buffer.from(a.decode(e));if(t.length<21)throw new TypeError(e+" is too short");if(t.length>21)throw new TypeError(e+" is too long");return{version:t.readUInt8(0),hash:t.slice(1)}}function s(e){let t,n;try{t=i.bech32.decode(e)}catch(cC){}if(t){if(n=t.words[0],0!==n)throw new TypeError(e+" uses wrong encoding")}else if(t=i.bech32m.decode(e),n=t.words[0],0===n)throw new TypeError(e+" uses wrong encoding");const r=i.bech32.fromWords(t.words.slice(1));return{version:n,prefix:t.prefix,data:Buffer.from(r)}}function l(e,t,n){const r=i.bech32.toWords(e);return r.unshift(t),0===t?i.bech32.encode(n,r):i.bech32m.encode(n,r)}return yE.fromBase58Check=o,yE.fromBech32=s,yE.toBase58Check=function(e,t){(0,r.typeforce)((0,r.tuple)(r.Hash160bit,r.UInt8),arguments);const n=Buffer.allocUnsafe(21);return n.writeUInt8(t,0),e.copy(n,1),a.encode(n)},yE.toBech32=l,yE.fromOutputScript=function(r,i){i=i||e.bitcoin;try{return t.p2pkh({output:r,network:i}).address}catch(cC){}try{return t.p2sh({output:r,network:i}).address}catch(cC){}try{return t.p2wpkh({output:r,network:i}).address}catch(cC){}try{return t.p2wsh({output:r,network:i}).address}catch(cC){}try{return t.p2tr({output:r,network:i}).address}catch(cC){}try{return function(e,t){const n=e.slice(2);if(n.length<2||n.length>40)throw new TypeError("Invalid program length for segwit address");const r=e[0]-80;if(r<2||r>16)throw new TypeError("Invalid version for segwit address");if(e[1]!==n.length)throw new TypeError("Invalid script for segwit address");return l(n,r,t.bech32)}(r,i)}catch(cC){}throw new Error(n.toASM(r)+" has no matching Address")},yE.toOutputScript=function(r,i){let a,l;i=i||e.bitcoin;try{a=o(r)}catch(cC){}if(a){if(a.version===i.pubKeyHash)return t.p2pkh({hash:a.hash}).output;if(a.version===i.scriptHash)return t.p2sh({hash:a.hash}).output}else{try{l=s(r)}catch(cC){}if(l){if(l.prefix!==i.bech32)throw new Error(r+" has an invalid prefix");if(0===l.version){if(20===l.data.length)return t.p2wpkh({hash:l.data}).output;if(32===l.data.length)return t.p2wsh({hash:l.data}).output}else if(1===l.version){if(32===l.data.length)return t.p2tr({pubkey:l.data}).output}else if(l.version>=2&&l.version<=16&&l.data.length>=2&&l.data.length<=40)return n.compile([l.version+80,l.data])}}throw new Error(r+" has no matching Script")},yE}fN.BufferWriter=IN,fN.BufferReader=class{constructor(e,t=0){this.buffer=e,this.offset=t,wN(bN.tuple(bN.Buffer,bN.UInt32),[e,t])}readUInt8(){const e=this.buffer.readUInt8(this.offset);return this.offset++,e}readInt32(){const e=this.buffer.readInt32LE(this.offset);return this.offset+=4,e}readUInt32(){const e=this.buffer.readUInt32LE(this.offset);return this.offset+=4,e}readUInt64(){const e=SN(this.buffer,this.offset);return this.offset+=8,e}readVarInt(){const e=xN.decode(this.buffer,this.offset);return this.offset+=xN.decode.bytes,e}readSlice(e){if(this.buffer.length<this.offset+e)throw new Error("Cannot read slice out of bounds");const t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}readVarSlice(){return this.readSlice(this.readVarInt())}readVector(){const e=this.readVarInt(),t=[];for(let n=0;n<e;n++)t.push(this.readVarSlice());return t}},function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.tweakKey=e.tapTweakHash=e.tapleafHash=e.findScriptPath=e.toHashTree=e.rootHashFromPath=e.MAX_TAPTREE_DEPTH=e.LEAF_VERSION_TAPSCRIPT=void 0;const t=CE,n=oN,r=MI,i=fN,a=BE;function o(n){const i=n.version||e.LEAF_VERSION_TAPSCRIPT;return r.taggedHash("TapLeaf",t.Buffer.concat([t.Buffer.from([i]),c(n.output)]))}function s(e,n){return r.taggedHash("TapTweak",t.Buffer.concat(n?[e,n]:[e]))}function l(e,n){return r.taggedHash("TapBranch",t.Buffer.concat([e,n]))}function c(e){const n=i.varuint.encodingLength(e.length),r=t.Buffer.allocUnsafe(n);return i.varuint.encode(e.length,r),t.Buffer.concat([r,e])}e.LEAF_VERSION_TAPSCRIPT=192,e.MAX_TAPTREE_DEPTH=128,e.rootHashFromPath=function(e,t){if(e.length<33)throw new TypeError(`The control-block length is too small. Got ${e.length}, expected min 33.`);const n=(e.length-33)/32;let r=t;for(let i=0;i<n;i++){const t=e.slice(33+32*i,65+32*i);r=r.compare(t)<0?l(r,t):l(t,r)}return r},e.toHashTree=function e(t){if((0,a.isTapleaf)(t))return{hash:o(t)};const n=[e(t[0]),e(t[1])];n.sort((e,t)=>e.hash.compare(t.hash));const[r,i]=n;return{hash:l(r.hash,i.hash),left:r,right:i}},e.findScriptPath=function e(t,n){if("left"in(r=t)&&"right"in r){const r=e(t.left,n);if(void 0!==r)return[...r,t.right.hash];const i=e(t.right,n);if(void 0!==i)return[...i,t.left.hash]}else if(t.hash.equals(n))return[];var r},e.tapleafHash=o,e.tapTweakHash=s,e.tweakKey=function(e,r){if(!t.Buffer.isBuffer(e))return null;if(32!==e.length)return null;if(r&&32!==r.length)return null;const i=s(e,r),a=(0,n.getEccLib)().xOnlyPointAddTweak(e,i);return a&&null!==a.xOnlyPubkey?{parity:a.parity,x:t.Buffer.from(a.xOnlyPubkey)}:null}}(dN);var PN={},BN={};Object.defineProperty(BN,"__esModule",{value:!0}),BN.fastMerkleRoot=void 0,BN.fastMerkleRoot=function(e,t){if(!Array.isArray(e))throw TypeError("Expected values Array");if("function"!=typeof t)throw TypeError("Expected digest Function");let n=e.length;const r=e.concat();for(;n>1;){let e=0;for(let i=0;i<n;i+=2,++e){const a=r[i],o=i+1===n?a:r[i+1],s=Buffer.concat([a,o]);r[e]=t(s)}n=e}return r[0]};var CN={};Object.defineProperty(CN,"__esModule",{value:!0}),CN.Transaction=void 0;const ON=fN,LN=MI,FN=yI(),RN=yI(),UN=BE,{typeforce:MN}=UN;function $N(e){const t=e.length;return ON.varuint.encodingLength(t)+t}const HN=Buffer.allocUnsafe(0),DN=[],zN=Buffer.from("0000000000000000000000000000000000000000000000000000000000000000","hex"),WN=Buffer.from("0000000000000000000000000000000000000000000000000000000000000001","hex"),VN=Buffer.from("ffffffffffffffff","hex"),jN={script:HN,valueBuffer:VN};class qN{constructor(){this.version=1,this.locktime=0,this.ins=[],this.outs=[]}static fromBuffer(e,t){const n=new ON.BufferReader(e),r=new qN;r.version=n.readInt32();const i=n.readUInt8(),a=n.readUInt8();let o=!1;i===qN.ADVANCED_TRANSACTION_MARKER&&a===qN.ADVANCED_TRANSACTION_FLAG?o=!0:n.offset-=2;const s=n.readVarInt();for(let c=0;c<s;++c)r.ins.push({hash:n.readSlice(32),index:n.readUInt32(),script:n.readVarSlice(),sequence:n.readUInt32(),witness:DN});const l=n.readVarInt();for(let c=0;c<l;++c)r.outs.push({value:n.readUInt64(),script:n.readVarSlice()});if(o){for(let e=0;e<s;++e)r.ins[e].witness=n.readVector();if(!r.hasWitnesses())throw new Error("Transaction has superfluous witness data")}if(r.locktime=n.readUInt32(),t)return r;if(n.offset!==e.length)throw new Error("Transaction has unexpected data");return r}static fromHex(e){return qN.fromBuffer(Buffer.from(e,"hex"),!1)}static isCoinbaseHash(e){MN(UN.Hash256bit,e);for(let t=0;t<32;++t)if(0!==e[t])return!1;return!0}isCoinbase(){return 1===this.ins.length&&qN.isCoinbaseHash(this.ins[0].hash)}addInput(e,t,n,r){return MN(UN.tuple(UN.Hash256bit,UN.UInt32,UN.maybe(UN.UInt32),UN.maybe(UN.Buffer)),arguments),UN.Null(n)&&(n=qN.DEFAULT_SEQUENCE),this.ins.push({hash:e,index:t,script:r||HN,sequence:n,witness:DN})-1}addOutput(e,t){return MN(UN.tuple(UN.Buffer,UN.Satoshi),arguments),this.outs.push({script:e,value:t})-1}hasWitnesses(){return this.ins.some(e=>0!==e.witness.length)}stripWitnesses(){this.ins.forEach(e=>{e.witness=DN})}weight(){return 3*this.byteLength(!1)+this.byteLength(!0)}virtualSize(){return Math.ceil(this.weight()/4)}byteLength(e=!0){const t=e&&this.hasWitnesses();return(t?10:8)+ON.varuint.encodingLength(this.ins.length)+ON.varuint.encodingLength(this.outs.length)+this.ins.reduce((e,t)=>e+40+$N(t.script),0)+this.outs.reduce((e,t)=>e+8+$N(t.script),0)+(t?this.ins.reduce((e,t)=>e+function(e){const t=e.length;return ON.varuint.encodingLength(t)+e.reduce((e,t)=>e+$N(t),0)}(t.witness),0):0)}clone(){const e=new qN;return e.version=this.version,e.locktime=this.locktime,e.ins=this.ins.map(e=>({hash:e.hash,index:e.index,script:e.script,sequence:e.sequence,witness:e.witness})),e.outs=this.outs.map(e=>({script:e.script,value:e.value})),e}hashForSignature(e,t,n){if(MN(UN.tuple(UN.UInt32,UN.Buffer,UN.Number),arguments),e>=this.ins.length)return WN;const r=FN.compile(FN.decompile(t).filter(e=>e!==RN.OPS.OP_CODESEPARATOR)),i=this.clone();if((31&n)===qN.SIGHASH_NONE)i.outs=[],i.ins.forEach((t,n)=>{n!==e&&(t.sequence=0)});else if((31&n)===qN.SIGHASH_SINGLE){if(e>=this.outs.length)return WN;i.outs.length=e+1;for(let t=0;t<e;t++)i.outs[t]=jN;i.ins.forEach((t,n)=>{n!==e&&(t.sequence=0)})}n&qN.SIGHASH_ANYONECANPAY?(i.ins=[i.ins[e]],i.ins[0].script=r):(i.ins.forEach(e=>{e.script=HN}),i.ins[e].script=r);const a=Buffer.allocUnsafe(i.byteLength(!1)+4);return a.writeInt32LE(n,a.length-4),i.__toBuffer(a,0,!1),LN.hash256(a)}hashForWitnessV1(e,t,n,r,i,a){if(MN(UN.tuple(UN.UInt32,MN.arrayOf(UN.Buffer),MN.arrayOf(UN.Satoshi),UN.UInt32),arguments),n.length!==this.ins.length||t.length!==this.ins.length)throw new Error("Must supply prevout script and value for all inputs");const o=r===qN.SIGHASH_DEFAULT?qN.SIGHASH_ALL:r&qN.SIGHASH_OUTPUT_MASK,s=(r&qN.SIGHASH_INPUT_MASK)===qN.SIGHASH_ANYONECANPAY,l=o===qN.SIGHASH_NONE,c=o===qN.SIGHASH_SINGLE;let u=HN,d=HN,f=HN,p=HN,m=HN;if(!s){let e=ON.BufferWriter.withCapacity(36*this.ins.length);this.ins.forEach(t=>{e.writeSlice(t.hash),e.writeUInt32(t.index)}),u=LN.sha256(e.end()),e=ON.BufferWriter.withCapacity(8*this.ins.length),n.forEach(t=>e.writeUInt64(t)),d=LN.sha256(e.end()),e=ON.BufferWriter.withCapacity(t.map($N).reduce((e,t)=>e+t)),t.forEach(t=>e.writeVarSlice(t)),f=LN.sha256(e.end()),e=ON.BufferWriter.withCapacity(4*this.ins.length),this.ins.forEach(t=>e.writeUInt32(t.sequence)),p=LN.sha256(e.end())}if(l||c){if(c&&e<this.outs.length){const t=this.outs[e],n=ON.BufferWriter.withCapacity(8+$N(t.script));n.writeUInt64(t.value),n.writeVarSlice(t.script),m=LN.sha256(n.end())}}else{const e=this.outs.map(e=>8+$N(e.script)).reduce((e,t)=>e+t),t=ON.BufferWriter.withCapacity(e);this.outs.forEach(e=>{t.writeUInt64(e.value),t.writeVarSlice(e.script)}),m=LN.sha256(t.end())}const h=(i?2:0)+(a?1:0),g=174-(s?49:0)-(l?32:0)+(a?32:0)+(i?37:0),y=ON.BufferWriter.withCapacity(g);if(y.writeUInt8(r),y.writeInt32(this.version),y.writeUInt32(this.locktime),y.writeSlice(u),y.writeSlice(d),y.writeSlice(f),y.writeSlice(p),l||c||y.writeSlice(m),y.writeUInt8(h),s){const r=this.ins[e];y.writeSlice(r.hash),y.writeUInt32(r.index),y.writeUInt64(n[e]),y.writeVarSlice(t[e]),y.writeUInt32(r.sequence)}else y.writeUInt32(e);if(a){const e=ON.BufferWriter.withCapacity($N(a));e.writeVarSlice(a),y.writeSlice(LN.sha256(e.end()))}return c&&y.writeSlice(m),i&&(y.writeSlice(i),y.writeUInt8(0),y.writeUInt32(4294967295)),LN.taggedHash("TapSighash",Buffer.concat([Buffer.from([0]),y.end()]))}hashForWitnessV0(e,t,n,r){MN(UN.tuple(UN.UInt32,UN.Buffer,UN.Satoshi,UN.UInt32),arguments);let i,a=Buffer.from([]),o=zN,s=zN,l=zN;if(r&qN.SIGHASH_ANYONECANPAY||(a=Buffer.allocUnsafe(36*this.ins.length),i=new ON.BufferWriter(a,0),this.ins.forEach(e=>{i.writeSlice(e.hash),i.writeUInt32(e.index)}),s=LN.hash256(a)),r&qN.SIGHASH_ANYONECANPAY||(31&r)===qN.SIGHASH_SINGLE||(31&r)===qN.SIGHASH_NONE||(a=Buffer.allocUnsafe(4*this.ins.length),i=new ON.BufferWriter(a,0),this.ins.forEach(e=>{i.writeUInt32(e.sequence)}),l=LN.hash256(a)),(31&r)!==qN.SIGHASH_SINGLE&&(31&r)!==qN.SIGHASH_NONE){const e=this.outs.reduce((e,t)=>e+8+$N(t.script),0);a=Buffer.allocUnsafe(e),i=new ON.BufferWriter(a,0),this.outs.forEach(e=>{i.writeUInt64(e.value),i.writeVarSlice(e.script)}),o=LN.hash256(a)}else if((31&r)===qN.SIGHASH_SINGLE&&e<this.outs.length){const t=this.outs[e];a=Buffer.allocUnsafe(8+$N(t.script)),i=new ON.BufferWriter(a,0),i.writeUInt64(t.value),i.writeVarSlice(t.script),o=LN.hash256(a)}a=Buffer.allocUnsafe(156+$N(t)),i=new ON.BufferWriter(a,0);const c=this.ins[e];return i.writeInt32(this.version),i.writeSlice(s),i.writeSlice(l),i.writeSlice(c.hash),i.writeUInt32(c.index),i.writeVarSlice(t),i.writeUInt64(n),i.writeUInt32(c.sequence),i.writeSlice(o),i.writeUInt32(this.locktime),i.writeUInt32(r),LN.hash256(a)}getHash(e){return e&&this.isCoinbase()?Buffer.alloc(32,0):LN.hash256(this.__toBuffer(void 0,void 0,e))}getId(){return(0,ON.reverseBuffer)(this.getHash(!1)).toString("hex")}toBuffer(e,t){return this.__toBuffer(e,t,!0)}toHex(){return this.toBuffer(void 0,void 0).toString("hex")}setInputScript(e,t){MN(UN.tuple(UN.Number,UN.Buffer),arguments),this.ins[e].script=t}setWitness(e,t){MN(UN.tuple(UN.Number,[UN.Buffer]),arguments),this.ins[e].witness=t}__toBuffer(e,t,n=!1){e||(e=Buffer.allocUnsafe(this.byteLength(n)));const r=new ON.BufferWriter(e,t||0);r.writeInt32(this.version);const i=n&&this.hasWitnesses();return i&&(r.writeUInt8(qN.ADVANCED_TRANSACTION_MARKER),r.writeUInt8(qN.ADVANCED_TRANSACTION_FLAG)),r.writeVarInt(this.ins.length),this.ins.forEach(e=>{r.writeSlice(e.hash),r.writeUInt32(e.index),r.writeVarSlice(e.script),r.writeUInt32(e.sequence)}),r.writeVarInt(this.outs.length),this.outs.forEach(e=>{void 0!==e.value?r.writeUInt64(e.value):r.writeSlice(e.valueBuffer),r.writeVarSlice(e.script)}),i&&this.ins.forEach(e=>{r.writeVector(e.witness)}),r.writeUInt32(this.locktime),void 0!==t?e.slice(t,r.offset):e}}CN.Transaction=qN,qN.DEFAULT_SEQUENCE=4294967295,qN.SIGHASH_DEFAULT=0,qN.SIGHASH_ALL=1,qN.SIGHASH_NONE=2,qN.SIGHASH_SINGLE=3,qN.SIGHASH_ANYONECANPAY=128,qN.SIGHASH_OUTPUT_MASK=3,qN.SIGHASH_INPUT_MASK=128,qN.ADVANCED_TRANSACTION_MARKER=0,qN.ADVANCED_TRANSACTION_FLAG=1,Object.defineProperty(PN,"__esModule",{value:!0}),PN.Block=void 0;const KN=fN,XN=MI,GN=BN,YN=CN,JN=BE,{typeforce:QN}=JN,ZN=new TypeError("Cannot compute merkle root for zero transactions"),eT=new TypeError("Cannot compute witness commit for non-segwit block");class tT{constructor(){this.version=1,this.prevHash=void 0,this.merkleRoot=void 0,this.timestamp=0,this.witnessCommit=void 0,this.bits=0,this.nonce=0,this.transactions=void 0}static fromBuffer(e){if(e.length<80)throw new Error("Buffer too small (< 80 bytes)");const t=new KN.BufferReader(e),n=new tT;if(n.version=t.readInt32(),n.prevHash=t.readSlice(32),n.merkleRoot=t.readSlice(32),n.timestamp=t.readUInt32(),n.bits=t.readUInt32(),n.nonce=t.readUInt32(),80===e.length)return n;const r=()=>{const e=YN.Transaction.fromBuffer(t.buffer.slice(t.offset),!0);return t.offset+=e.byteLength(),e},i=t.readVarInt();n.transactions=[];for(let o=0;o<i;++o){const e=r();n.transactions.push(e)}const a=n.getWitnessCommit();return a&&(n.witnessCommit=a),n}static fromHex(e){return tT.fromBuffer(Buffer.from(e,"hex"))}static calculateTarget(e){const t=((4278190080&e)>>24)-3,n=8388607&e,r=Buffer.alloc(32,0);return r.writeUIntBE(n,29-t,3),r}static calculateMerkleRoot(e,t){if(QN([{getHash:JN.Function}],e),0===e.length)throw ZN;if(t&&!nT(e))throw eT;const n=e.map(e=>e.getHash(t)),r=(0,GN.fastMerkleRoot)(n,XN.hash256);return t?XN.hash256(Buffer.concat([r,e[0].ins[0].witness[0]])):r}getWitnessCommit(){if(!nT(this.transactions))return null;const e=this.transactions[0].outs.filter(e=>e.script.slice(0,6).equals(Buffer.from("6a24aa21a9ed","hex"))).map(e=>e.script.slice(6,38));if(0===e.length)return null;const t=e[e.length-1];return t instanceof Buffer&&32===t.length?t:null}hasWitnessCommit(){return this.witnessCommit instanceof Buffer&&32===this.witnessCommit.length||null!==this.getWitnessCommit()}hasWitness(){return(e=this.transactions)instanceof Array&&e.some(e=>"object"==typeof e&&e.ins instanceof Array&&e.ins.some(e=>"object"==typeof e&&e.witness instanceof Array&&e.witness.length>0));var e}weight(){return 3*this.byteLength(!1,!1)+this.byteLength(!1,!0)}byteLength(e,t=!0){return e||!this.transactions?80:80+KN.varuint.encodingLength(this.transactions.length)+this.transactions.reduce((e,n)=>e+n.byteLength(t),0)}getHash(){return XN.hash256(this.toBuffer(!0))}getId(){return(0,KN.reverseBuffer)(this.getHash()).toString("hex")}getUTCDate(){const e=new Date(0);return e.setUTCSeconds(this.timestamp),e}toBuffer(e){const t=Buffer.allocUnsafe(this.byteLength(e)),n=new KN.BufferWriter(t);return n.writeInt32(this.version),n.writeSlice(this.prevHash),n.writeSlice(this.merkleRoot),n.writeUInt32(this.timestamp),n.writeUInt32(this.bits),n.writeUInt32(this.nonce),e||!this.transactions||(KN.varuint.encode(this.transactions.length,t,n.offset),n.offset+=KN.varuint.encode.bytes,this.transactions.forEach(e=>{const r=e.byteLength();e.toBuffer(t,n.offset),n.offset+=r})),t}toHex(e){return this.toBuffer(e).toString("hex")}checkTxRoots(){const e=this.hasWitnessCommit();return!(!e&&this.hasWitness())&&this.__checkMerkleRoot()&&(!e||this.__checkWitnessCommit())}checkProofOfWork(){const e=(0,KN.reverseBuffer)(this.getHash()),t=tT.calculateTarget(this.bits);return e.compare(t)<=0}__checkMerkleRoot(){if(!this.transactions)throw ZN;const e=tT.calculateMerkleRoot(this.transactions);return 0===this.merkleRoot.compare(e)}__checkWitnessCommit(){if(!this.transactions)throw ZN;if(!this.hasWitnessCommit())throw eT;const e=tT.calculateMerkleRoot(this.transactions,!0);return 0===this.witnessCommit.compare(e)}}function nT(e){return e instanceof Array&&e[0]&&e[0].ins&&e[0].ins instanceof Array&&e[0].ins[0]&&e[0].ins[0].witness&&e[0].ins[0].witness instanceof Array&&e[0].ins[0].witness.length>0}PN.Block=tT;var rT,iT,aT,oT,sT={},lT={},cT={},uT={},dT={},fT={},pT={};rT=pT,Object.defineProperty(rT,"__esModule",{value:!0}),(iT=rT.GlobalTypes||(rT.GlobalTypes={}))[iT.UNSIGNED_TX=0]="UNSIGNED_TX",iT[iT.GLOBAL_XPUB=1]="GLOBAL_XPUB",rT.GLOBAL_TYPE_NAMES=["unsignedTx","globalXpub"],(aT=rT.InputTypes||(rT.InputTypes={}))[aT.NON_WITNESS_UTXO=0]="NON_WITNESS_UTXO",aT[aT.WITNESS_UTXO=1]="WITNESS_UTXO",aT[aT.PARTIAL_SIG=2]="PARTIAL_SIG",aT[aT.SIGHASH_TYPE=3]="SIGHASH_TYPE",aT[aT.REDEEM_SCRIPT=4]="REDEEM_SCRIPT",aT[aT.WITNESS_SCRIPT=5]="WITNESS_SCRIPT",aT[aT.BIP32_DERIVATION=6]="BIP32_DERIVATION",aT[aT.FINAL_SCRIPTSIG=7]="FINAL_SCRIPTSIG",aT[aT.FINAL_SCRIPTWITNESS=8]="FINAL_SCRIPTWITNESS",aT[aT.POR_COMMITMENT=9]="POR_COMMITMENT",aT[aT.TAP_KEY_SIG=19]="TAP_KEY_SIG",aT[aT.TAP_SCRIPT_SIG=20]="TAP_SCRIPT_SIG",aT[aT.TAP_LEAF_SCRIPT=21]="TAP_LEAF_SCRIPT",aT[aT.TAP_BIP32_DERIVATION=22]="TAP_BIP32_DERIVATION",aT[aT.TAP_INTERNAL_KEY=23]="TAP_INTERNAL_KEY",aT[aT.TAP_MERKLE_ROOT=24]="TAP_MERKLE_ROOT",rT.INPUT_TYPE_NAMES=["nonWitnessUtxo","witnessUtxo","partialSig","sighashType","redeemScript","witnessScript","bip32Derivation","finalScriptSig","finalScriptWitness","porCommitment","tapKeySig","tapScriptSig","tapLeafScript","tapBip32Derivation","tapInternalKey","tapMerkleRoot"],(oT=rT.OutputTypes||(rT.OutputTypes={}))[oT.REDEEM_SCRIPT=0]="REDEEM_SCRIPT",oT[oT.WITNESS_SCRIPT=1]="WITNESS_SCRIPT",oT[oT.BIP32_DERIVATION=2]="BIP32_DERIVATION",oT[oT.TAP_INTERNAL_KEY=5]="TAP_INTERNAL_KEY",oT[oT.TAP_TREE=6]="TAP_TREE",oT[oT.TAP_BIP32_DERIVATION=7]="TAP_BIP32_DERIVATION",rT.OUTPUT_TYPE_NAMES=["redeemScript","witnessScript","bip32Derivation","tapInternalKey","tapTree","tapBip32Derivation"];var mT={};Object.defineProperty(mT,"__esModule",{value:!0});const hT=pT;mT.decode=function(e){if(e.key[0]!==hT.GlobalTypes.GLOBAL_XPUB)throw new Error("Decode Error: could not decode globalXpub with key 0x"+e.key.toString("hex"));if(79!==e.key.length||![2,3].includes(e.key[46]))throw new Error("Decode Error: globalXpub has invalid extended pubkey in key 0x"+e.key.toString("hex"));if(e.value.length/4%1!=0)throw new Error("Decode Error: Global GLOBAL_XPUB value length should be multiple of 4");const t=e.key.slice(1),n={masterFingerprint:e.value.slice(0,4),extendedPubkey:t,path:"m"};for(const i of(r=e.value.length/4-1,[...Array(r).keys()])){const t=e.value.readUInt32LE(4*i+4),r=!!(2147483648&t),a=2147483647&t;n.path+="/"+a.toString(10)+(r?"'":"")}var r;return n},mT.encode=function(e){const t=Buffer.from([hT.GlobalTypes.GLOBAL_XPUB]),n=Buffer.concat([t,e.extendedPubkey]),r=e.path.split("/"),i=Buffer.allocUnsafe(4*r.length);e.masterFingerprint.copy(i,0);let a=4;return r.slice(1).forEach(e=>{const t="'"===e.slice(-1);let n=2147483647&parseInt(t?e.slice(0,-1):e,10);t&&(n+=2147483648),i.writeUInt32LE(n,a),a+=4}),{key:n,value:i}},mT.expected="{ masterFingerprint: Buffer; extendedPubkey: Buffer; path: string; }",mT.check=function(e){const t=e.extendedPubkey,n=e.masterFingerprint,r=e.path;return Buffer.isBuffer(t)&&78===t.length&&[2,3].indexOf(t[45])>-1&&Buffer.isBuffer(n)&&4===n.length&&"string"==typeof r&&!!r.match(/^m(\/\d+'?)*$/)},mT.canAddToArray=function(e,t,n){const r=t.extendedPubkey.toString("hex");return!n.has(r)&&(n.add(r),0===e.filter(e=>e.extendedPubkey.equals(t.extendedPubkey)).length)};var gT={};Object.defineProperty(gT,"__esModule",{value:!0});const yT=pT;gT.encode=function(e){return{key:Buffer.from([yT.GlobalTypes.UNSIGNED_TX]),value:e.toBuffer()}};var bT={};Object.defineProperty(bT,"__esModule",{value:!0});const wT=pT;bT.decode=function(e){if(e.key[0]!==wT.InputTypes.FINAL_SCRIPTSIG)throw new Error("Decode Error: could not decode finalScriptSig with key 0x"+e.key.toString("hex"));return e.value},bT.encode=function(e){return{key:Buffer.from([wT.InputTypes.FINAL_SCRIPTSIG]),value:e}},bT.expected="Buffer",bT.check=function(e){return Buffer.isBuffer(e)},bT.canAdd=function(e,t){return!!e&&!!t&&void 0===e.finalScriptSig};var xT={};Object.defineProperty(xT,"__esModule",{value:!0});const vT=pT;xT.decode=function(e){if(e.key[0]!==vT.InputTypes.FINAL_SCRIPTWITNESS)throw new Error("Decode Error: could not decode finalScriptWitness with key 0x"+e.key.toString("hex"));return e.value},xT.encode=function(e){return{key:Buffer.from([vT.InputTypes.FINAL_SCRIPTWITNESS]),value:e}},xT.expected="Buffer",xT.check=function(e){return Buffer.isBuffer(e)},xT.canAdd=function(e,t){return!!e&&!!t&&void 0===e.finalScriptWitness};var ST={};Object.defineProperty(ST,"__esModule",{value:!0});const ET=pT;ST.decode=function(e){if(e.key[0]!==ET.InputTypes.NON_WITNESS_UTXO)throw new Error("Decode Error: could not decode nonWitnessUtxo with key 0x"+e.key.toString("hex"));return e.value},ST.encode=function(e){return{key:Buffer.from([ET.InputTypes.NON_WITNESS_UTXO]),value:e}},ST.expected="Buffer",ST.check=function(e){return Buffer.isBuffer(e)},ST.canAdd=function(e,t){return!!e&&!!t&&void 0===e.nonWitnessUtxo};var IT={};Object.defineProperty(IT,"__esModule",{value:!0});const kT=pT;IT.decode=function(e){if(e.key[0]!==kT.InputTypes.PARTIAL_SIG)throw new Error("Decode Error: could not decode partialSig with key 0x"+e.key.toString("hex"));if(34!==e.key.length&&66!==e.key.length||![2,3,4].includes(e.key[1]))throw new Error("Decode Error: partialSig has invalid pubkey in key 0x"+e.key.toString("hex"));return{pubkey:e.key.slice(1),signature:e.value}},IT.encode=function(e){const t=Buffer.from([kT.InputTypes.PARTIAL_SIG]);return{key:Buffer.concat([t,e.pubkey]),value:e.signature}},IT.expected="{ pubkey: Buffer; signature: Buffer; }",IT.check=function(e){return Buffer.isBuffer(e.pubkey)&&Buffer.isBuffer(e.signature)&&[33,65].includes(e.pubkey.length)&&[2,3,4].includes(e.pubkey[0])&&function(e){if(!Buffer.isBuffer(e)||e.length<9)return!1;if(48!==e[0])return!1;if(e.length!==e[1]+3)return!1;if(2!==e[2])return!1;const t=e[3];if(t>33||t<1)return!1;if(2!==e[3+t+1])return!1;const n=e[3+t+2];return!(n>33||n<1)&&e.length===3+t+2+n+2}(e.signature)},IT.canAddToArray=function(e,t,n){const r=t.pubkey.toString("hex");return!n.has(r)&&(n.add(r),0===e.filter(e=>e.pubkey.equals(t.pubkey)).length)};var AT={};Object.defineProperty(AT,"__esModule",{value:!0});const NT=pT;AT.decode=function(e){if(e.key[0]!==NT.InputTypes.POR_COMMITMENT)throw new Error("Decode Error: could not decode porCommitment with key 0x"+e.key.toString("hex"));return e.value.toString("utf8")},AT.encode=function(e){return{key:Buffer.from([NT.InputTypes.POR_COMMITMENT]),value:Buffer.from(e,"utf8")}},AT.expected="string",AT.check=function(e){return"string"==typeof e},AT.canAdd=function(e,t){return!!e&&!!t&&void 0===e.porCommitment};var TT={};Object.defineProperty(TT,"__esModule",{value:!0});const _T=pT;TT.decode=function(e){if(e.key[0]!==_T.InputTypes.SIGHASH_TYPE)throw new Error("Decode Error: could not decode sighashType with key 0x"+e.key.toString("hex"));return e.value.readUInt32LE(0)},TT.encode=function(e){const t=Buffer.from([_T.InputTypes.SIGHASH_TYPE]),n=Buffer.allocUnsafe(4);return n.writeUInt32LE(e,0),{key:t,value:n}},TT.expected="number",TT.check=function(e){return"number"==typeof e},TT.canAdd=function(e,t){return!!e&&!!t&&void 0===e.sighashType};var PT={};Object.defineProperty(PT,"__esModule",{value:!0});const BT=pT;function CT(e){return Buffer.isBuffer(e)&&(64===e.length||65===e.length)}PT.decode=function(e){if(e.key[0]!==BT.InputTypes.TAP_KEY_SIG||1!==e.key.length)throw new Error("Decode Error: could not decode tapKeySig with key 0x"+e.key.toString("hex"));if(!CT(e.value))throw new Error("Decode Error: tapKeySig not a valid 64-65-byte BIP340 signature");return e.value},PT.encode=function(e){return{key:Buffer.from([BT.InputTypes.TAP_KEY_SIG]),value:e}},PT.expected="Buffer",PT.check=CT,PT.canAdd=function(e,t){return!!e&&!!t&&void 0===e.tapKeySig};var OT={};Object.defineProperty(OT,"__esModule",{value:!0});const LT=pT;OT.decode=function(e){if(e.key[0]!==LT.InputTypes.TAP_LEAF_SCRIPT)throw new Error("Decode Error: could not decode tapLeafScript with key 0x"+e.key.toString("hex"));if((e.key.length-2)%32!=0)throw new Error("Decode Error: tapLeafScript has invalid control block in key 0x"+e.key.toString("hex"));const t=e.value[e.value.length-1];if((254&e.key[1])!==t)throw new Error("Decode Error: tapLeafScript bad leaf version in key 0x"+e.key.toString("hex"));const n=e.value.slice(0,-1);return{controlBlock:e.key.slice(1),script:n,leafVersion:t}},OT.encode=function(e){const t=Buffer.from([LT.InputTypes.TAP_LEAF_SCRIPT]),n=Buffer.from([e.leafVersion]);return{key:Buffer.concat([t,e.controlBlock]),value:Buffer.concat([e.script,n])}},OT.expected="{ controlBlock: Buffer; leafVersion: number, script: Buffer; }",OT.check=function(e){return Buffer.isBuffer(e.controlBlock)&&(e.controlBlock.length-1)%32==0&&(254&e.controlBlock[0])===e.leafVersion&&Buffer.isBuffer(e.script)},OT.canAddToArray=function(e,t,n){const r=t.controlBlock.toString("hex");return!n.has(r)&&(n.add(r),0===e.filter(e=>e.controlBlock.equals(t.controlBlock)).length)};var FT={};Object.defineProperty(FT,"__esModule",{value:!0});const RT=pT;function UT(e){return Buffer.isBuffer(e)&&32===e.length}FT.decode=function(e){if(e.key[0]!==RT.InputTypes.TAP_MERKLE_ROOT||1!==e.key.length)throw new Error("Decode Error: could not decode tapMerkleRoot with key 0x"+e.key.toString("hex"));if(!UT(e.value))throw new Error("Decode Error: tapMerkleRoot not a 32-byte hash");return e.value},FT.encode=function(e){return{key:Buffer.from([RT.InputTypes.TAP_MERKLE_ROOT]),value:e}},FT.expected="Buffer",FT.check=UT,FT.canAdd=function(e,t){return!!e&&!!t&&void 0===e.tapMerkleRoot};var MT={};Object.defineProperty(MT,"__esModule",{value:!0});const $T=pT;MT.decode=function(e){if(e.key[0]!==$T.InputTypes.TAP_SCRIPT_SIG)throw new Error("Decode Error: could not decode tapScriptSig with key 0x"+e.key.toString("hex"));if(65!==e.key.length)throw new Error("Decode Error: tapScriptSig has invalid key 0x"+e.key.toString("hex"));if(64!==e.value.length&&65!==e.value.length)throw new Error("Decode Error: tapScriptSig has invalid signature in key 0x"+e.key.toString("hex"));return{pubkey:e.key.slice(1,33),leafHash:e.key.slice(33),signature:e.value}},MT.encode=function(e){const t=Buffer.from([$T.InputTypes.TAP_SCRIPT_SIG]);return{key:Buffer.concat([t,e.pubkey,e.leafHash]),value:e.signature}},MT.expected="{ pubkey: Buffer; leafHash: Buffer; signature: Buffer; }",MT.check=function(e){return Buffer.isBuffer(e.pubkey)&&Buffer.isBuffer(e.leafHash)&&Buffer.isBuffer(e.signature)&&32===e.pubkey.length&&32===e.leafHash.length&&(64===e.signature.length||65===e.signature.length)},MT.canAddToArray=function(e,t,n){const r=t.pubkey.toString("hex")+t.leafHash.toString("hex");return!n.has(r)&&(n.add(r),0===e.filter(e=>e.pubkey.equals(t.pubkey)&&e.leafHash.equals(t.leafHash)).length)};var HT={},DT={},zT={};function WT(e){if(e<0||e>9007199254740991||e%1!=0)throw new RangeError("value out of range")}function VT(e){return WT(e),e<253?1:e<=65535?3:e<=4294967295?5:9}Object.defineProperty(zT,"__esModule",{value:!0}),zT.encode=function e(t,n,r){if(WT(t),n||(n=Buffer.allocUnsafe(VT(t))),!Buffer.isBuffer(n))throw new TypeError("buffer must be a Buffer instance");return r||(r=0),t<253?(n.writeUInt8(t,r),Object.assign(e,{bytes:1})):t<=65535?(n.writeUInt8(253,r),n.writeUInt16LE(t,r+1),Object.assign(e,{bytes:3})):t<=4294967295?(n.writeUInt8(254,r),n.writeUInt32LE(t,r+1),Object.assign(e,{bytes:5})):(n.writeUInt8(255,r),n.writeUInt32LE(t>>>0,r+1),n.writeUInt32LE(t/4294967296|0,r+5),Object.assign(e,{bytes:9})),n},zT.decode=function e(t,n){if(!Buffer.isBuffer(t))throw new TypeError("buffer must be a Buffer instance");n||(n=0);const r=t.readUInt8(n);if(r<253)return Object.assign(e,{bytes:1}),r;if(253===r)return Object.assign(e,{bytes:3}),t.readUInt16LE(n+1);if(254===r)return Object.assign(e,{bytes:5}),t.readUInt32LE(n+1);{Object.assign(e,{bytes:9});const r=t.readUInt32LE(n+1),i=4294967296*t.readUInt32LE(n+5)+r;return WT(i),i}},zT.encodingLength=VT,Object.defineProperty(DT,"__esModule",{value:!0});const jT=zT;function qT(e){const t=e.key.length,n=e.value.length,r=jT.encodingLength(t),i=jT.encodingLength(n),a=Buffer.allocUnsafe(r+t+i+n);return jT.encode(t,a,0),e.key.copy(a,r),jT.encode(n,a,r+t),e.value.copy(a,r+t+i),a}function KT(e,t){if("number"!=typeof e)throw new Error("cannot write a non-number as a number");if(e<0)throw new Error("specified a negative value for writing an unsigned value");if(e>t)throw new Error("RangeError: value out of range");if(Math.floor(e)!==e)throw new Error("value has a fractional component")}DT.range=e=>[...Array(e).keys()],DT.reverseBuffer=function(e){if(e.length<1)return e;let t=e.length-1,n=0;for(let r=0;r<e.length/2;r++)n=e[r],e[r]=e[t],e[t]=n,t--;return e},DT.keyValsToBuffer=function(e){const t=e.map(qT);return t.push(Buffer.from([0])),Buffer.concat(t)},DT.keyValToBuffer=qT,DT.readUInt64LE=function(e,t){const n=e.readUInt32LE(t);let r=e.readUInt32LE(t+4);return r*=4294967296,KT(r+n,9007199254740991),r+n},DT.writeUInt64LE=function(e,t,n){return KT(t,9007199254740991),e.writeInt32LE(-1&t,n),e.writeUInt32LE(Math.floor(t/4294967296),n+4),n+8},Object.defineProperty(HT,"__esModule",{value:!0});const XT=pT,GT=DT,YT=zT;HT.decode=function(e){if(e.key[0]!==XT.InputTypes.WITNESS_UTXO)throw new Error("Decode Error: could not decode witnessUtxo with key 0x"+e.key.toString("hex"));const t=GT.readUInt64LE(e.value,0);let n=8;const r=YT.decode(e.value,n);n+=YT.encodingLength(r);const i=e.value.slice(n);if(i.length!==r)throw new Error("Decode Error: WITNESS_UTXO script is not proper length");return{script:i,value:t}},HT.encode=function(e){const{script:t,value:n}=e,r=YT.encodingLength(t.length),i=Buffer.allocUnsafe(8+r+t.length);return GT.writeUInt64LE(i,n,0),YT.encode(t.length,i,8),t.copy(i,8+r),{key:Buffer.from([XT.InputTypes.WITNESS_UTXO]),value:i}},HT.expected="{ script: Buffer; value: number; }",HT.check=function(e){return Buffer.isBuffer(e.script)&&"number"==typeof e.value},HT.canAdd=function(e,t){return!!e&&!!t&&void 0===e.witnessUtxo};var JT={};Object.defineProperty(JT,"__esModule",{value:!0});const QT=pT,ZT=zT;JT.decode=function(e){if(e.key[0]!==QT.OutputTypes.TAP_TREE||1!==e.key.length)throw new Error("Decode Error: could not decode tapTree with key 0x"+e.key.toString("hex"));let t=0;const n=[];for(;t<e.value.length;){const r=e.value[t++],i=e.value[t++],a=ZT.decode(e.value,t);t+=ZT.encodingLength(a),n.push({depth:r,leafVersion:i,script:e.value.slice(t,t+a)}),t+=a}return{leaves:n}},JT.encode=function(e){const t=Buffer.from([QT.OutputTypes.TAP_TREE]),n=[].concat(...e.leaves.map(e=>[Buffer.of(e.depth,e.leafVersion),ZT.encode(e.script.length),e.script]));return{key:t,value:Buffer.concat(n)}},JT.expected="{ leaves: [{ depth: number; leafVersion: number, script: Buffer; }] }",JT.check=function(e){return Array.isArray(e.leaves)&&e.leaves.every(e=>e.depth>=0&&e.depth<=128&&(254&e.leafVersion)===e.leafVersion&&Buffer.isBuffer(e.script))},JT.canAdd=function(e,t){return!!e&&!!t&&void 0===e.tapTree};var e_={};Object.defineProperty(e_,"__esModule",{value:!0});const t_=e=>33===e.length&&[2,3].includes(e[0])||65===e.length&&4===e[0];e_.makeConverter=function(e,t=t_){return{decode:function(n){if(n.key[0]!==e)throw new Error("Decode Error: could not decode bip32Derivation with key 0x"+n.key.toString("hex"));const r=n.key.slice(1);if(!t(r))throw new Error("Decode Error: bip32Derivation has invalid pubkey in key 0x"+n.key.toString("hex"));if(n.value.length/4%1!=0)throw new Error("Decode Error: Input BIP32_DERIVATION value length should be multiple of 4");const i={masterFingerprint:n.value.slice(0,4),pubkey:r,path:"m"};for(const e of(a=n.value.length/4-1,[...Array(a).keys()])){const t=n.value.readUInt32LE(4*e+4),r=!!(2147483648&t),a=2147483647&t;i.path+="/"+a.toString(10)+(r?"'":"")}var a;return i},encode:function(t){const n=Buffer.from([e]),r=Buffer.concat([n,t.pubkey]),i=t.path.split("/"),a=Buffer.allocUnsafe(4*i.length);t.masterFingerprint.copy(a,0);let o=4;return i.slice(1).forEach(e=>{const t="'"===e.slice(-1);let n=2147483647&parseInt(t?e.slice(0,-1):e,10);t&&(n+=2147483648),a.writeUInt32LE(n,o),o+=4}),{key:r,value:a}},check:function(e){return Buffer.isBuffer(e.pubkey)&&Buffer.isBuffer(e.masterFingerprint)&&"string"==typeof e.path&&t(e.pubkey)&&4===e.masterFingerprint.length},expected:"{ masterFingerprint: Buffer; pubkey: Buffer; path: string; }",canAddToArray:function(e,t,n){const r=t.pubkey.toString("hex");return!n.has(r)&&(n.add(r),0===e.filter(e=>e.pubkey.equals(t.pubkey)).length)}}};var n_={};Object.defineProperty(n_,"__esModule",{value:!0}),n_.makeChecker=function(e){return function(t){let n;if(e.includes(t.key[0])&&(n=t.key.slice(1),33!==n.length&&65!==n.length||![2,3,4].includes(n[0])))throw new Error("Format Error: invalid pubkey in key 0x"+t.key.toString("hex"));return n}};var r_={};Object.defineProperty(r_,"__esModule",{value:!0}),r_.makeConverter=function(e){return{decode:function(t){if(t.key[0]!==e)throw new Error("Decode Error: could not decode redeemScript with key 0x"+t.key.toString("hex"));return t.value},encode:function(t){return{key:Buffer.from([e]),value:t}},check:function(e){return Buffer.isBuffer(e)},expected:"Buffer",canAdd:function(e,t){return!!e&&!!t&&void 0===e.redeemScript}}};var i_={};Object.defineProperty(i_,"__esModule",{value:!0});const a_=zT,o_=e_,s_=e=>32===e.length;i_.makeConverter=function(e){const t=o_.makeConverter(e,s_);return{decode:function(e){const n=a_.decode(e.value),r=a_.encodingLength(n),i=t.decode({key:e.key,value:e.value.slice(r+32*n)}),a=new Array(n);for(let t=0,o=r;t<n;t++,o+=32)a[t]=e.value.slice(o,o+32);return Object.assign({},i,{leafHashes:a})},encode:function(e){const n=t.encode(e),r=a_.encodingLength(e.leafHashes.length),i=Buffer.allocUnsafe(r);a_.encode(e.leafHashes.length,i);const a=Buffer.concat([i,...e.leafHashes,n.value]);return Object.assign({},n,{value:a})},check:function(e){return Array.isArray(e.leafHashes)&&e.leafHashes.every(e=>Buffer.isBuffer(e)&&32===e.length)&&t.check(e)},expected:"{ masterFingerprint: Buffer; pubkey: Buffer; path: string; leafHashes: Buffer[]; }",canAddToArray:t.canAddToArray}};var l_={};Object.defineProperty(l_,"__esModule",{value:!0}),l_.makeConverter=function(e){return{decode:function(t){if(t.key[0]!==e||1!==t.key.length)throw new Error("Decode Error: could not decode tapInternalKey with key 0x"+t.key.toString("hex"));if(32!==t.value.length)throw new Error("Decode Error: tapInternalKey not a 32-byte x-only pubkey");return t.value},encode:function(t){return{key:Buffer.from([e]),value:t}},check:function(e){return Buffer.isBuffer(e)&&32===e.length},expected:"Buffer",canAdd:function(e,t){return!!e&&!!t&&void 0===e.tapInternalKey}}};var c_={};Object.defineProperty(c_,"__esModule",{value:!0}),c_.makeConverter=function(e){return{decode:function(t){if(t.key[0]!==e)throw new Error("Decode Error: could not decode witnessScript with key 0x"+t.key.toString("hex"));return t.value},encode:function(t){return{key:Buffer.from([e]),value:t}},check:function(e){return Buffer.isBuffer(e)},expected:"Buffer",canAdd:function(e,t){return!!e&&!!t&&void 0===e.witnessScript}}},Object.defineProperty(fT,"__esModule",{value:!0});const u_=pT,d_=bT,f_=xT,p_=ST,m_=IT,h_=AT,g_=TT,y_=PT,b_=OT,w_=FT,x_=MT,v_=HT,S_=JT,E_=e_,I_=n_,k_=r_,A_=i_,N_=l_,T_=c_,__={unsignedTx:gT,globalXpub:mT,checkPubkey:I_.makeChecker([])};fT.globals=__;const P_={nonWitnessUtxo:p_,partialSig:m_,sighashType:g_,finalScriptSig:d_,finalScriptWitness:f_,porCommitment:h_,witnessUtxo:v_,bip32Derivation:E_.makeConverter(u_.InputTypes.BIP32_DERIVATION),redeemScript:k_.makeConverter(u_.InputTypes.REDEEM_SCRIPT),witnessScript:T_.makeConverter(u_.InputTypes.WITNESS_SCRIPT),checkPubkey:I_.makeChecker([u_.InputTypes.PARTIAL_SIG,u_.InputTypes.BIP32_DERIVATION]),tapKeySig:y_,tapScriptSig:x_,tapLeafScript:b_,tapBip32Derivation:A_.makeConverter(u_.InputTypes.TAP_BIP32_DERIVATION),tapInternalKey:N_.makeConverter(u_.InputTypes.TAP_INTERNAL_KEY),tapMerkleRoot:w_};fT.inputs=P_;const B_={bip32Derivation:E_.makeConverter(u_.OutputTypes.BIP32_DERIVATION),redeemScript:k_.makeConverter(u_.OutputTypes.REDEEM_SCRIPT),witnessScript:T_.makeConverter(u_.OutputTypes.WITNESS_SCRIPT),checkPubkey:I_.makeChecker([u_.OutputTypes.BIP32_DERIVATION]),tapBip32Derivation:A_.makeConverter(u_.OutputTypes.TAP_BIP32_DERIVATION),tapTree:S_,tapInternalKey:N_.makeConverter(u_.OutputTypes.TAP_INTERNAL_KEY)};fT.outputs=B_,Object.defineProperty(dT,"__esModule",{value:!0});const C_=fT,O_=DT,L_=zT,F_=pT;function R_(e,t,n){if(!t.equals(Buffer.from([n])))throw new Error(`Format Error: Invalid ${e} key: ${t.toString("hex")}`)}function U_(e,{globalMapKeyVals:t,inputKeyVals:n,outputKeyVals:r}){const i={unsignedTx:e};let a=0;for(const u of t)switch(u.key[0]){case F_.GlobalTypes.UNSIGNED_TX:if(R_("global",u.key,F_.GlobalTypes.UNSIGNED_TX),a>0)throw new Error("Format Error: GlobalMap has multiple UNSIGNED_TX");a++;break;case F_.GlobalTypes.GLOBAL_XPUB:void 0===i.globalXpub&&(i.globalXpub=[]),i.globalXpub.push(C_.globals.globalXpub.decode(u));break;default:i.unknownKeyVals||(i.unknownKeyVals=[]),i.unknownKeyVals.push(u)}const o=n.length,s=r.length,l=[],c=[];for(const u of O_.range(o)){const e={};for(const t of n[u])switch(C_.inputs.checkPubkey(t),t.key[0]){case F_.InputTypes.NON_WITNESS_UTXO:if(R_("input",t.key,F_.InputTypes.NON_WITNESS_UTXO),void 0!==e.nonWitnessUtxo)throw new Error("Format Error: Input has multiple NON_WITNESS_UTXO");e.nonWitnessUtxo=C_.inputs.nonWitnessUtxo.decode(t);break;case F_.InputTypes.WITNESS_UTXO:if(R_("input",t.key,F_.InputTypes.WITNESS_UTXO),void 0!==e.witnessUtxo)throw new Error("Format Error: Input has multiple WITNESS_UTXO");e.witnessUtxo=C_.inputs.witnessUtxo.decode(t);break;case F_.InputTypes.PARTIAL_SIG:void 0===e.partialSig&&(e.partialSig=[]),e.partialSig.push(C_.inputs.partialSig.decode(t));break;case F_.InputTypes.SIGHASH_TYPE:if(R_("input",t.key,F_.InputTypes.SIGHASH_TYPE),void 0!==e.sighashType)throw new Error("Format Error: Input has multiple SIGHASH_TYPE");e.sighashType=C_.inputs.sighashType.decode(t);break;case F_.InputTypes.REDEEM_SCRIPT:if(R_("input",t.key,F_.InputTypes.REDEEM_SCRIPT),void 0!==e.redeemScript)throw new Error("Format Error: Input has multiple REDEEM_SCRIPT");e.redeemScript=C_.inputs.redeemScript.decode(t);break;case F_.InputTypes.WITNESS_SCRIPT:if(R_("input",t.key,F_.InputTypes.WITNESS_SCRIPT),void 0!==e.witnessScript)throw new Error("Format Error: Input has multiple WITNESS_SCRIPT");e.witnessScript=C_.inputs.witnessScript.decode(t);break;case F_.InputTypes.BIP32_DERIVATION:void 0===e.bip32Derivation&&(e.bip32Derivation=[]),e.bip32Derivation.push(C_.inputs.bip32Derivation.decode(t));break;case F_.InputTypes.FINAL_SCRIPTSIG:R_("input",t.key,F_.InputTypes.FINAL_SCRIPTSIG),e.finalScriptSig=C_.inputs.finalScriptSig.decode(t);break;case F_.InputTypes.FINAL_SCRIPTWITNESS:R_("input",t.key,F_.InputTypes.FINAL_SCRIPTWITNESS),e.finalScriptWitness=C_.inputs.finalScriptWitness.decode(t);break;case F_.InputTypes.POR_COMMITMENT:R_("input",t.key,F_.InputTypes.POR_COMMITMENT),e.porCommitment=C_.inputs.porCommitment.decode(t);break;case F_.InputTypes.TAP_KEY_SIG:R_("input",t.key,F_.InputTypes.TAP_KEY_SIG),e.tapKeySig=C_.inputs.tapKeySig.decode(t);break;case F_.InputTypes.TAP_SCRIPT_SIG:void 0===e.tapScriptSig&&(e.tapScriptSig=[]),e.tapScriptSig.push(C_.inputs.tapScriptSig.decode(t));break;case F_.InputTypes.TAP_LEAF_SCRIPT:void 0===e.tapLeafScript&&(e.tapLeafScript=[]),e.tapLeafScript.push(C_.inputs.tapLeafScript.decode(t));break;case F_.InputTypes.TAP_BIP32_DERIVATION:void 0===e.tapBip32Derivation&&(e.tapBip32Derivation=[]),e.tapBip32Derivation.push(C_.inputs.tapBip32Derivation.decode(t));break;case F_.InputTypes.TAP_INTERNAL_KEY:R_("input",t.key,F_.InputTypes.TAP_INTERNAL_KEY),e.tapInternalKey=C_.inputs.tapInternalKey.decode(t);break;case F_.InputTypes.TAP_MERKLE_ROOT:R_("input",t.key,F_.InputTypes.TAP_MERKLE_ROOT),e.tapMerkleRoot=C_.inputs.tapMerkleRoot.decode(t);break;default:e.unknownKeyVals||(e.unknownKeyVals=[]),e.unknownKeyVals.push(t)}l.push(e)}for(const u of O_.range(s)){const e={};for(const t of r[u])switch(C_.outputs.checkPubkey(t),t.key[0]){case F_.OutputTypes.REDEEM_SCRIPT:if(R_("output",t.key,F_.OutputTypes.REDEEM_SCRIPT),void 0!==e.redeemScript)throw new Error("Format Error: Output has multiple REDEEM_SCRIPT");e.redeemScript=C_.outputs.redeemScript.decode(t);break;case F_.OutputTypes.WITNESS_SCRIPT:if(R_("output",t.key,F_.OutputTypes.WITNESS_SCRIPT),void 0!==e.witnessScript)throw new Error("Format Error: Output has multiple WITNESS_SCRIPT");e.witnessScript=C_.outputs.witnessScript.decode(t);break;case F_.OutputTypes.BIP32_DERIVATION:void 0===e.bip32Derivation&&(e.bip32Derivation=[]),e.bip32Derivation.push(C_.outputs.bip32Derivation.decode(t));break;case F_.OutputTypes.TAP_INTERNAL_KEY:R_("output",t.key,F_.OutputTypes.TAP_INTERNAL_KEY),e.tapInternalKey=C_.outputs.tapInternalKey.decode(t);break;case F_.OutputTypes.TAP_TREE:R_("output",t.key,F_.OutputTypes.TAP_TREE),e.tapTree=C_.outputs.tapTree.decode(t);break;case F_.OutputTypes.TAP_BIP32_DERIVATION:void 0===e.tapBip32Derivation&&(e.tapBip32Derivation=[]),e.tapBip32Derivation.push(C_.outputs.tapBip32Derivation.decode(t));break;default:e.unknownKeyVals||(e.unknownKeyVals=[]),e.unknownKeyVals.push(t)}c.push(e)}return{globalMap:i,inputs:l,outputs:c}}dT.psbtFromBuffer=function(e,t){let n=0;function r(){const t=L_.decode(e,n);n+=L_.encodingLength(t);const r=e.slice(n,n+t);return n+=t,r}function i(){return{key:r(),value:r()}}function a(){if(n>=e.length)throw new Error("Format Error: Unexpected End of PSBT");const t=0===e.readUInt8(n);return t&&n++,t}if(1886610036!==function(){const t=e.readUInt32BE(n);return n+=4,t}())throw new Error("Format Error: Invalid Magic Number");if(255!==function(){const t=e.readUInt8(n);return n+=1,t}())throw new Error("Format Error: Magic Number must be followed by 0xff separator");const o=[],s={};for(;!a();){const e=i(),t=e.key.toString("hex");if(s[t])throw new Error("Format Error: Keys must be unique for global keymap: key "+t);s[t]=1,o.push(e)}const l=o.filter(e=>e.key[0]===F_.GlobalTypes.UNSIGNED_TX);if(1!==l.length)throw new Error("Format Error: Only one UNSIGNED_TX allowed");const c=t(l[0].value),{inputCount:u,outputCount:d}=c.getInputOutputCounts(),f=[],p=[];for(const m of O_.range(u)){const e={},t=[];for(;!a();){const n=i(),r=n.key.toString("hex");if(e[r])throw new Error("Format Error: Keys must be unique for each input: input index "+m+" key "+r);e[r]=1,t.push(n)}f.push(t)}for(const m of O_.range(d)){const e={},t=[];for(;!a();){const n=i(),r=n.key.toString("hex");if(e[r])throw new Error("Format Error: Keys must be unique for each output: output index "+m+" key "+r);e[r]=1,t.push(n)}p.push(t)}return U_(c,{globalMapKeyVals:o,inputKeyVals:f,outputKeyVals:p})},dT.checkKeyBuffer=R_,dT.psbtFromKeyVals=U_;var M_={};Object.defineProperty(M_,"__esModule",{value:!0});const $_=fT,H_=DT;M_.psbtToBuffer=function({globalMap:e,inputs:t,outputs:n}){const{globalKeyVals:r,inputKeyVals:i,outputKeyVals:a}=W_({globalMap:e,inputs:t,outputs:n}),o=H_.keyValsToBuffer(r),s=e=>0===e.length?[Buffer.from([0])]:e.map(H_.keyValsToBuffer),l=s(i),c=s(a),u=Buffer.allocUnsafe(5);return u.writeUIntBE(482972169471,0,5),Buffer.concat([u,o].concat(l,c))};const D_=(e,t)=>e.key.compare(t.key);function z_(e,t){const n=new Set,r=Object.entries(e).reduce((e,[r,i])=>{if("unknownKeyVals"===r)return e;const a=t[r];if(void 0===a)return e;const o=(Array.isArray(i)?i:[i]).map(a.encode);return o.map(e=>e.key.toString("hex")).forEach(e=>{if(n.has(e))throw new Error("Serialize Error: Duplicate key: "+e);n.add(e)}),e.concat(o)},[]),i=e.unknownKeyVals?e.unknownKeyVals.filter(e=>!n.has(e.key.toString("hex"))):[];return r.concat(i).sort(D_)}function W_({globalMap:e,inputs:t,outputs:n}){return{globalKeyVals:z_(e,$_.globals),inputKeyVals:t.map(e=>z_(e,$_.inputs)),outputKeyVals:n.map(e=>z_(e,$_.outputs))}}M_.psbtToKeyVals=W_,function(e){function t(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),t(dT),t(M_)}(uT),Object.defineProperty(cT,"__esModule",{value:!0});const V_=uT;function j_(e,t,n){return r=>{if(e.has(r))return;const i=n.filter(e=>e.key.toString("hex")===r)[0];t.push(i),e.add(r)}}function q_(e){return e.globalMap.unsignedTx}function K_(e){const t=new Set;return e.forEach(e=>{const n=e.key.toString("hex");if(t.has(n))throw new Error("Combine: KeyValue Map keys should be unique");t.add(n)}),t}cT.combine=function(e){const t=e[0],n=V_.psbtToKeyVals(t),r=e.slice(1);if(0===r.length)throw new Error("Combine: Nothing to combine");const i=q_(t);if(void 0===i)throw new Error("Combine: Self missing transaction");const a=K_(n.globalKeyVals),o=n.inputKeyVals.map(K_),s=n.outputKeyVals.map(K_);for(const l of r){const e=q_(l);if(void 0===e||!e.toBuffer().equals(i.toBuffer()))throw new Error("Combine: One of the Psbts does not have the same transaction.");const t=V_.psbtToKeyVals(l);K_(t.globalKeyVals).forEach(j_(a,n.globalKeyVals,t.globalKeyVals)),t.inputKeyVals.map(K_).forEach((e,r)=>e.forEach(j_(o[r],n.inputKeyVals[r],t.inputKeyVals[r]))),t.outputKeyVals.map(K_).forEach((e,r)=>e.forEach(j_(s[r],n.outputKeyVals[r],t.outputKeyVals[r])))}return V_.psbtFromKeyVals(i,{globalMapKeyVals:n.globalKeyVals,inputKeyVals:n.inputKeyVals,outputKeyVals:n.outputKeyVals})};var X_={};!function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=fT;function n(e,t){const n=e[t];if(void 0===n)throw new Error(`No input #${t}`);return n}function r(e,t){const n=e[t];if(void 0===n)throw new Error(`No output #${t}`);return n}function i(e,t,n,r){throw new Error(`Data for ${e} key ${t} is incorrect: Expected ${n} and got ${JSON.stringify(r)}`)}function a(e){return(n,r)=>{for(const a of Object.keys(n)){const o=n[a],{canAdd:s,canAddToArray:l,check:c,expected:u}=t[e+"s"][a]||{};if(c)if(l){if(!Array.isArray(o)||r[a]&&!Array.isArray(r[a]))throw new Error(`Key type ${a} must be an array`);o.every(c)||i(e,a,u,o);const t=r[a]||[],n=new Set;if(!o.every(e=>l(t,e,n)))throw new Error("Can not add duplicate data to array");r[a]=t.concat(o)}else{if(c(o)||i(e,a,u,o),!s(r,o))throw new Error(`Can not add duplicate data to ${e}`);r[a]=o}}}}e.checkForInput=n,e.checkForOutput=r,e.checkHasKey=function(e,t,n){if(e.key[0]<n)throw new Error("Use the method for your specific key instead of addUnknownKeyVal*");if(t&&0!==t.filter(t=>t.key.equals(e.key)).length)throw new Error(`Duplicate Key: ${e.key.toString("hex")}`)},e.getEnumLength=function(e){let t=0;return Object.keys(e).forEach(e=>{Number(isNaN(Number(e)))&&t++}),t},e.inputCheckUncleanFinalized=function(e,t){let n=!1;if(t.nonWitnessUtxo||t.witnessUtxo){const e=!!t.redeemScript,r=!!t.witnessScript,i=!e||!!t.finalScriptSig,a=!r||!!t.finalScriptWitness,o=!!t.finalScriptSig||!!t.finalScriptWitness;n=i&&a&&o}if(!1===n)throw new Error(`Input #${e} has too much or too little data to clean`)},e.updateGlobal=a("global"),e.updateInput=a("input"),e.updateOutput=a("output"),e.addInputAttributes=function(t,r){const i=n(t,t.length-1);e.updateInput(r,i)},e.addOutputAttributes=function(t,n){const i=r(t,t.length-1);e.updateOutput(n,i)},e.defaultVersionSetter=function(e,t){if(!Buffer.isBuffer(t)||t.length<4)throw new Error("Set Version: Invalid Transaction");return t.writeUInt32LE(e,0),t},e.defaultLocktimeSetter=function(e,t){if(!Buffer.isBuffer(t)||t.length<4)throw new Error("Set Locktime: Invalid Transaction");return t.writeUInt32LE(e,t.length-4),t}}(X_),Object.defineProperty(lT,"__esModule",{value:!0});const G_=cT,Y_=uT,J_=pT,Q_=X_;lT.Psbt=class{constructor(e){this.inputs=[],this.outputs=[],this.globalMap={unsignedTx:e}}static fromBase64(e,t){const n=Buffer.from(e,"base64");return this.fromBuffer(n,t)}static fromHex(e,t){const n=Buffer.from(e,"hex");return this.fromBuffer(n,t)}static fromBuffer(e,t){const n=Y_.psbtFromBuffer(e,t),r=new this(n.globalMap.unsignedTx);return Object.assign(r,n),r}toBase64(){return this.toBuffer().toString("base64")}toHex(){return this.toBuffer().toString("hex")}toBuffer(){return Y_.psbtToBuffer(this)}updateGlobal(e){return Q_.updateGlobal(e,this.globalMap),this}updateInput(e,t){const n=Q_.checkForInput(this.inputs,e);return Q_.updateInput(t,n),this}updateOutput(e,t){const n=Q_.checkForOutput(this.outputs,e);return Q_.updateOutput(t,n),this}addUnknownKeyValToGlobal(e){return Q_.checkHasKey(e,this.globalMap.unknownKeyVals,Q_.getEnumLength(J_.GlobalTypes)),this.globalMap.unknownKeyVals||(this.globalMap.unknownKeyVals=[]),this.globalMap.unknownKeyVals.push(e),this}addUnknownKeyValToInput(e,t){const n=Q_.checkForInput(this.inputs,e);return Q_.checkHasKey(t,n.unknownKeyVals,Q_.getEnumLength(J_.InputTypes)),n.unknownKeyVals||(n.unknownKeyVals=[]),n.unknownKeyVals.push(t),this}addUnknownKeyValToOutput(e,t){const n=Q_.checkForOutput(this.outputs,e);return Q_.checkHasKey(t,n.unknownKeyVals,Q_.getEnumLength(J_.OutputTypes)),n.unknownKeyVals||(n.unknownKeyVals=[]),n.unknownKeyVals.push(t),this}addInput(e){this.globalMap.unsignedTx.addInput(e),this.inputs.push({unknownKeyVals:[]});const t=e.unknownKeyVals||[],n=this.inputs.length-1;if(!Array.isArray(t))throw new Error("unknownKeyVals must be an Array");return t.forEach(e=>this.addUnknownKeyValToInput(n,e)),Q_.addInputAttributes(this.inputs,e),this}addOutput(e){this.globalMap.unsignedTx.addOutput(e),this.outputs.push({unknownKeyVals:[]});const t=e.unknownKeyVals||[],n=this.outputs.length-1;if(!Array.isArray(t))throw new Error("unknownKeyVals must be an Array");return t.forEach(e=>this.addUnknownKeyValToOutput(n,e)),Q_.addOutputAttributes(this.outputs,e),this}clearFinalizedInput(e){const t=Q_.checkForInput(this.inputs,e);Q_.inputCheckUncleanFinalized(e,t);for(const n of Object.keys(t))["witnessUtxo","nonWitnessUtxo","finalScriptSig","finalScriptWitness","unknownKeyVals"].includes(n)||delete t[n];return this}combine(...e){const t=G_.combine([this].concat(e));return Object.assign(this,t),this}getTransaction(){return this.globalMap.unsignedTx.toBuffer()}};var Z_={},eP={};Object.defineProperty(eP,"__esModule",{value:!0}),eP.signatureBlocksAction=eP.checkInputForSig=eP.pubkeyInScript=eP.pubkeyPositionInScript=eP.witnessStackToScriptWitness=eP.isP2TR=eP.isP2SHScript=eP.isP2WSHScript=eP.isP2WPKH=eP.isP2PKH=eP.isP2PK=eP.isP2MS=void 0;const tP=zT,nP=yI(),rP=CN,iP=MI,aP=TN();function oP(e){return t=>{try{return e({output:t}),!0}catch(uC){return!1}}}function sP(e,t){const n=(0,iP.hash160)(e),r=e.slice(1,33),i=nP.decompile(t);if(null===i)throw new Error("Unknown script error");return i.findIndex(t=>"number"!=typeof t&&(t.equals(e)||t.equals(n)||t.equals(r)))}function lP(e,t,n){const{hashType:r}=t(e),i=[];switch(r&rP.Transaction.SIGHASH_ANYONECANPAY&&i.push("addInput"),31&r){case rP.Transaction.SIGHASH_ALL:break;case rP.Transaction.SIGHASH_SINGLE:case rP.Transaction.SIGHASH_NONE:i.push("addOutput"),i.push("setInputSequence")}return-1===i.indexOf(n)}eP.isP2MS=oP(aP.p2ms),eP.isP2PK=oP(aP.p2pk),eP.isP2PKH=oP(aP.p2pkh),eP.isP2WPKH=oP(aP.p2wpkh),eP.isP2WSHScript=oP(aP.p2wsh),eP.isP2SHScript=oP(aP.p2sh),eP.isP2TR=oP(aP.p2tr),eP.witnessStackToScriptWitness=function(e){let t=Buffer.allocUnsafe(0);function n(e){const n=t.length,r=tP.encodingLength(e);t=Buffer.concat([t,Buffer.allocUnsafe(r)]),tP.encode(e,t,n)}var r;return n((r=e).length),r.forEach(function(e){n(e.length),function(e){t=Buffer.concat([t,Buffer.from(e)])}(e)}),t},eP.pubkeyPositionInScript=sP,eP.pubkeyInScript=function(e,t){return-1!==sP(e,t)},eP.checkInputForSig=function(e,t){return function(e){let t=[];if(0===(e.partialSig||[]).length){if(!e.finalScriptSig&&!e.finalScriptWitness)return[];t=function(e){const t=e.finalScriptSig&&nP.decompile(e.finalScriptSig)||[],n=e.finalScriptWitness&&nP.decompile(e.finalScriptWitness)||[];return t.concat(n).filter(e=>Buffer.isBuffer(e)&&nP.isCanonicalScriptSignature(e)).map(e=>({signature:e}))}(e)}else t=e.partialSig;return t.map(e=>e.signature)}(e).some(e=>lP(e,nP.signature.decode,t))},eP.signatureBlocksAction=lP,Object.defineProperty(Z_,"__esModule",{value:!0}),Z_.checkTaprootInputForSigs=Z_.tapTreeFromList=Z_.tapTreeToList=Z_.tweakInternalPubKey=Z_.checkTaprootOutputFields=Z_.checkTaprootInputFields=Z_.isTaprootOutput=Z_.isTaprootInput=Z_.serializeTaprootSignature=Z_.tapScriptFinalizer=Z_.toXOnly=void 0;const cP=BE,uP=CN,dP=eP,fP=dN,pP=TN(),mP=eP;function hP(e){return e&&!!(e.tapInternalKey||e.tapMerkleRoot||e.tapLeafScript&&e.tapLeafScript.length||e.tapBip32Derivation&&e.tapBip32Derivation.length||e.witnessUtxo&&(0,dP.isP2TR)(e.witnessUtxo.script))}function gP(e,t){return e&&!!(e.tapInternalKey||e.tapTree||e.tapBip32Derivation&&e.tapBip32Derivation.length||t&&(0,dP.isP2TR)(t))}function yP(e=[]){return 1===e.length&&0===e[0].depth?{output:e[0].script,version:e[0].leafVersion}:function(e){let t;for(const n of e)if(t=xP(n,t),!t)throw new Error("No room left to insert tapleaf in tree");return t}(e)}function bP(e){return{signature:e.slice(0,64),hashType:e.slice(64)[0]||uP.Transaction.SIGHASH_DEFAULT}}function wP(e,t=[],n=0){if(n>fP.MAX_TAPTREE_DEPTH)throw new Error("Max taptree depth exceeded.");return e?(0,cP.isTapleaf)(e)?(t.push({depth:n,leafVersion:e.version||fP.LEAF_VERSION_TAPSCRIPT,script:e.output}),t):(e[0]&&wP(e[0],t,n+1),e[1]&&wP(e[1],t,n+1),t):[]}function xP(e,t,n=0){if(n>fP.MAX_TAPTREE_DEPTH)throw new Error("Max taptree depth exceeded.");if(e.depth===n)return t?void 0:{output:e.script,version:e.leafVersion};if((0,cP.isTapleaf)(t))return;const r=xP(e,t&&t[0],n+1);if(r)return[r,t&&t[1]];const i=xP(e,t&&t[1],n+1);return i?[t&&t[0],i]:void 0}function vP(e,t){if(!t)return!0;const n=(0,fP.tapleafHash)({output:e.script,version:e.leafVersion});return(0,fP.rootHashFromPath)(e.controlBlock,n).equals(t)}function SP(e){return e&&!!(e.redeemScript||e.witnessScript||e.bip32Derivation&&e.bip32Derivation.length)}Z_.toXOnly=e=>32===e.length?e:e.slice(1,33),Z_.tapScriptFinalizer=function(e,t,n){const r=function(e,t,n){if(!e.tapScriptSig||!e.tapScriptSig.length)throw new Error(`Can not finalize taproot input #${t}. No tapleaf script signature provided.`);const r=(e.tapLeafScript||[]).sort((e,t)=>e.controlBlock.length-t.controlBlock.length).find(t=>function(e,t,n){const r=(0,fP.tapleafHash)({output:e.script,version:e.leafVersion});return(!n||n.equals(r))&&void 0!==t.find(e=>e.leafHash.equals(r))}(t,e.tapScriptSig,n));if(!r)throw new Error(`Can not finalize taproot input #${t}. Signature for tapleaf script not found.`);return r}(t,e,n);try{const e=function(e,t){const n=(0,fP.tapleafHash)({output:t.script,version:t.leafVersion});return(e.tapScriptSig||[]).filter(e=>e.leafHash.equals(n)).map(e=>function(e,t){return Object.assign({positionInScript:(0,dP.pubkeyPositionInScript)(t.pubkey,e)},t)}(t.script,e)).sort((e,t)=>t.positionInScript-e.positionInScript).map(e=>e.signature)}(t,r),n=e.concat(r.script).concat(r.controlBlock);return{finalScriptWitness:(0,dP.witnessStackToScriptWitness)(n)}}catch(uC){throw new Error(`Can not finalize taproot input #${e}: ${uC}`)}},Z_.serializeTaprootSignature=function(e,t){const n=t?Buffer.from([t]):Buffer.from([]);return Buffer.concat([e,n])},Z_.isTaprootInput=hP,Z_.isTaprootOutput=gP,Z_.checkTaprootInputFields=function(e,t,n){!function(e,t,n){const r=hP(e)&&SP(t),i=SP(e)&&hP(t),a=e===t&&hP(t)&&SP(t);if(r||i||a)throw new Error(`Invalid arguments for Psbt.${n}. Cannot use both taproot and non-taproot fields.`)}(e,t,n),function(e,t,n){if(t.tapMerkleRoot){const r=(t.tapLeafScript||[]).every(e=>vP(e,t.tapMerkleRoot)),i=(e.tapLeafScript||[]).every(e=>vP(e,t.tapMerkleRoot));if(!r||!i)throw new Error(`Invalid arguments for Psbt.${n}. Tapleaf not part of taptree.`)}else if(e.tapMerkleRoot&&!(t.tapLeafScript||[]).every(t=>vP(t,e.tapMerkleRoot)))throw new Error(`Invalid arguments for Psbt.${n}. Tapleaf not part of taptree.`)}(e,t,n)},Z_.checkTaprootOutputFields=function(e,t,n){!function(e,t,n){const r=gP(e)&&SP(t),i=SP(e)&&gP(t),a=e===t&&gP(t)&&SP(t);if(r||i||a)throw new Error(`Invalid arguments for Psbt.${n}. Cannot use both taproot and non-taproot fields.`)}(e,t,n),function(e,t){if(!t.tapTree&&!t.tapInternalKey)return;const n=t.tapInternalKey||e.tapInternalKey,r=t.tapTree||e.tapTree;if(n){const{script:t}=e,i=function(e,t){const n=t&&yP(t.leaves),{output:r}=(0,pP.p2tr)({internalPubkey:e,scriptTree:n});return r}(n,r);if(t&&!t.equals(i))throw new Error("Error adding output. Script or address missmatch.")}}(e,t)},Z_.tweakInternalPubKey=function(e,t){const n=t.tapInternalKey,r=n&&(0,fP.tweakKey)(n,t.tapMerkleRoot);if(!r)throw new Error(`Cannot tweak tap internal key for input #${e}. Public key: ${n&&n.toString("hex")}`);return r.x},Z_.tapTreeToList=function(e){if(!(0,cP.isTaptree)(e))throw new Error("Cannot convert taptree to tapleaf list. Expecting a tapree structure.");return wP(e)},Z_.tapTreeFromList=yP,Z_.checkTaprootInputForSigs=function(e,t){const n=function(e){const t=[];if(e.tapKeySig&&t.push(e.tapKeySig),e.tapScriptSig&&t.push(...e.tapScriptSig.map(e=>e.signature)),!t.length){const n=function(e){if(!e)return;const t=e.slice(2);return 64===t.length||65===t.length?t:void 0}(e.finalScriptWitness);n&&t.push(n)}return t}(e);return n.some(e=>(0,mP.signatureBlocksAction)(e,bP,t))},Object.defineProperty(sT,"__esModule",{value:!0}),sT.Psbt=void 0;const EP=lT,IP=zT,kP=X_,AP=_N(),NP=fN,TP=bE,_P=TN(),PP=dN,BP=yI(),CP=CN,OP=Z_,LP=eP,FP={network:TP.bitcoin,maximumFeeRate:5e3};class RP{static fromBase64(e,t={}){const n=Buffer.from(e,"base64");return this.fromBuffer(n,t)}static fromHex(e,t={}){const n=Buffer.from(e,"hex");return this.fromBuffer(n,t)}static fromBuffer(e,t={}){const n=EP.Psbt.fromBuffer(e,UP),r=new RP(t,n);return function(e,t){e.ins.forEach(e=>{qP(t,e)})}(r.__CACHE.__TX,r.__CACHE),r}constructor(e={},t=new EP.Psbt(new MP)){this.data=t,this.opts=Object.assign({},FP,e),this.__CACHE={__NON_WITNESS_UTXO_TX_CACHE:[],__NON_WITNESS_UTXO_BUF_CACHE:[],__TX_IN_CACHE:{},__TX:this.data.globalMap.unsignedTx.tx,__UNSAFE_SIGN_NONSEGWIT:!1},0===this.data.inputs.length&&this.setVersion(2);const n=(e,t,n,r)=>Object.defineProperty(e,t,{enumerable:n,writable:r});n(this,"__CACHE",!1,!0),n(this,"opts",!1,!0)}get inputCount(){return this.data.inputs.length}get version(){return this.__CACHE.__TX.version}set version(e){this.setVersion(e)}get locktime(){return this.__CACHE.__TX.locktime}set locktime(e){this.setLocktime(e)}get txInputs(){return this.__CACHE.__TX.ins.map(e=>({hash:(0,NP.cloneBuffer)(e.hash),index:e.index,sequence:e.sequence}))}get txOutputs(){return this.__CACHE.__TX.outs.map(e=>{let t;try{t=(0,AP.fromOutputScript)(e.script,this.opts.network)}catch(n){}return{script:(0,NP.cloneBuffer)(e.script),value:e.value,address:t}})}combine(...e){return this.data.combine(...e.map(e=>e.data)),this}clone(){const e=RP.fromBuffer(this.data.toBuffer());return e.opts=JSON.parse(JSON.stringify(this.opts)),e}setMaximumFeeRate(e){WP(e),this.opts.maximumFeeRate=e}setVersion(e){WP(e),VP(this.data.inputs,"setVersion");const t=this.__CACHE;return t.__TX.version=e,t.__EXTRACTED_TX=void 0,this}setLocktime(e){WP(e),VP(this.data.inputs,"setLocktime");const t=this.__CACHE;return t.__TX.locktime=e,t.__EXTRACTED_TX=void 0,this}setInputSequence(e,t){WP(t),VP(this.data.inputs,"setInputSequence");const n=this.__CACHE;if(n.__TX.ins.length<=e)throw new Error("Input index too high");return n.__TX.ins[e].sequence=t,n.__EXTRACTED_TX=void 0,this}addInputs(e){return e.forEach(e=>this.addInput(e)),this}addInput(e){if(arguments.length>1||!e||void 0===e.hash||void 0===e.index)throw new Error("Invalid arguments for Psbt.addInput. Requires single object with at least [hash] and [index]");(0,OP.checkTaprootInputFields)(e,e,"addInput"),VP(this.data.inputs,"addInput"),e.witnessScript&&pB(e.witnessScript);const t=this.__CACHE;this.data.addInput(e),qP(t,t.__TX.ins[t.__TX.ins.length-1]);const n=this.data.inputs.length-1,r=this.data.inputs[n];return r.nonWitnessUtxo&&oB(this.__CACHE,r,n),t.__FEE=void 0,t.__FEE_RATE=void 0,t.__EXTRACTED_TX=void 0,this}addOutputs(e){return e.forEach(e=>this.addOutput(e)),this}addOutput(e){if(arguments.length>1||!e||void 0===e.value||void 0===e.address&&void 0===e.script)throw new Error("Invalid arguments for Psbt.addOutput. Requires single object with at least [script or address] and [value]");VP(this.data.inputs,"addOutput");const{address:t}=e;if("string"==typeof t){const{network:n}=this.opts,r=(0,AP.toOutputScript)(t,n);e=Object.assign({},e,{script:r})}(0,OP.checkTaprootOutputFields)(e,e,"addOutput");const n=this.__CACHE;return this.data.addOutput(e),n.__FEE=void 0,n.__FEE_RATE=void 0,n.__EXTRACTED_TX=void 0,this}extractTransaction(e){if(!this.data.inputs.every(DP))throw new Error("Not finalized");const t=this.__CACHE;if(e||function(e,t,n){const r=t.__FEE_RATE||e.getFeeRate(),i=t.__EXTRACTED_TX.virtualSize(),a=r*i;if(r>=n.maximumFeeRate)throw new Error(`Warning: You are paying around ${(a/1e8).toFixed(8)} in fees, which is ${r} satoshi per byte for a transaction with a VSize of ${i} bytes (segwit counted as 0.25 byte per byte). Use setMaximumFeeRate method to raise your threshold, or pass true to the first arg of extractTransaction.`)}(this,t,this.opts),t.__EXTRACTED_TX)return t.__EXTRACTED_TX;const n=t.__TX.clone();return sB(this.data.inputs,n,t,!0),n}getFeeRate(){return YP("__FEE_RATE","fee rate",this.data.inputs,this.__CACHE)}getFee(){return YP("__FEE","fee",this.data.inputs,this.__CACHE)}finalizeAllInputs(){return(0,kP.checkForInput)(this.data.inputs,0),hB(this.data.inputs.length).forEach(e=>this.finalizeInput(e)),this}finalizeInput(e,t){const n=(0,kP.checkForInput)(this.data.inputs,e);return(0,OP.isTaprootInput)(n)?this._finalizeTaprootInput(e,n,void 0,t):this._finalizeInput(e,n,t)}finalizeTaprootInput(e,t,n=OP.tapScriptFinalizer){const r=(0,kP.checkForInput)(this.data.inputs,e);if((0,OP.isTaprootInput)(r))return this._finalizeTaprootInput(e,r,t,n);throw new Error(`Cannot finalize input #${e}. Not Taproot.`)}_finalizeInput(e,t,n=JP){const{script:r,isP2SH:i,isP2WSH:a,isSegwit:o}=function(e,t,n){const r=n.__TX,i={script:null,isSegwit:!1,isP2SH:!1,isP2WSH:!1};if(i.isP2SH=!!t.redeemScript,i.isP2WSH=!!t.witnessScript,t.witnessScript)i.script=t.witnessScript;else if(t.redeemScript)i.script=t.redeemScript;else if(t.nonWitnessUtxo){const a=lB(n,t,e),o=r.ins[e].index;i.script=a.outs[o].script}else t.witnessUtxo&&(i.script=t.witnessUtxo.script);return(t.witnessScript||(0,LP.isP2WPKH)(i.script))&&(i.isSegwit=!0),i}(e,t,this.__CACHE);if(!r)throw new Error(`No script found for input #${e}`);!function(e){if(!e.sighashType||!e.partialSig)return;const{partialSig:t,sighashType:n}=e;t.forEach(e=>{const{hashType:t}=BP.signature.decode(e.signature);if(n!==t)throw new Error("Signature sighash does not match input sighash type")})}(t);const{finalScriptSig:s,finalScriptWitness:l}=n(e,t,r,o,i,a);if(s&&this.data.updateInput(e,{finalScriptSig:s}),l&&this.data.updateInput(e,{finalScriptWitness:l}),!s&&!l)throw new Error(`Unknown error finalizing input #${e}`);return this.data.clearFinalizedInput(e),this}_finalizeTaprootInput(e,t,n,r=OP.tapScriptFinalizer){if(!t.witnessUtxo)throw new Error(`Cannot finalize input #${e}. Missing withness utxo.`);if(t.tapKeySig){const n=_P.p2tr({output:t.witnessUtxo.script,signature:t.tapKeySig}),r=(0,LP.witnessStackToScriptWitness)(n.witness);this.data.updateInput(e,{finalScriptWitness:r})}else{const{finalScriptWitness:i}=r(e,t,n);this.data.updateInput(e,{finalScriptWitness:i})}return this.data.clearFinalizedInput(e),this}getInputType(e){const t=(0,kP.checkForInput)(this.data.inputs,e),n=fB(cB(e,t,this.__CACHE),e,"input",t.redeemScript||function(e){if(!e)return;const t=BP.decompile(e);if(!t)return;const n=t[t.length-1];var r;return Buffer.isBuffer(n)&&!dB(n)&&(r=n,!BP.isCanonicalScriptSignature(r))&&BP.decompile(n)?n:void 0}(t.finalScriptSig),t.witnessScript||function(e){if(!e)return;const t=aB(e),n=t[t.length-1];return!dB(n)&&BP.decompile(n)?n:void 0}(t.finalScriptWitness));return("raw"===n.type?"":n.type+"-")+mB(n.meaningfulScript)}inputHasPubkey(e,t){return function(e,t,n,r){const i=cB(n,t,r),{meaningfulScript:a}=fB(i,n,"input",t.redeemScript,t.witnessScript);return(0,LP.pubkeyInScript)(e,a)}(t,(0,kP.checkForInput)(this.data.inputs,e),e,this.__CACHE)}inputHasHDKey(e,t){const n=(0,kP.checkForInput)(this.data.inputs,e),r=zP(t);return!!n.bip32Derivation&&n.bip32Derivation.some(r)}outputHasPubkey(e,t){return function(e,t,n,r){const i=r.__TX.outs[n].script,{meaningfulScript:a}=fB(i,n,"output",t.redeemScript,t.witnessScript);return(0,LP.pubkeyInScript)(e,a)}(t,(0,kP.checkForOutput)(this.data.outputs,e),e,this.__CACHE)}outputHasHDKey(e,t){const n=(0,kP.checkForOutput)(this.data.outputs,e),r=zP(t);return!!n.bip32Derivation&&n.bip32Derivation.some(r)}validateSignaturesOfAllInputs(e){return(0,kP.checkForInput)(this.data.inputs,0),hB(this.data.inputs.length).map(t=>this.validateSignaturesOfInput(t,e)).reduce((e,t)=>!0===t&&e,!0)}validateSignaturesOfInput(e,t,n){const r=this.data.inputs[e];return(0,OP.isTaprootInput)(r)?this.validateSignaturesOfTaprootInput(e,t,n):this._validateSignaturesOfInput(e,t,n)}_validateSignaturesOfInput(e,t,n){const r=this.data.inputs[e],i=(r||{}).partialSig;if(!r||!i||i.length<1)throw new Error("No signatures to validate");if("function"!=typeof t)throw new Error("Need validator function to validate signatures");const a=n?i.filter(e=>e.pubkey.equals(n)):i;if(a.length<1)throw new Error("No signatures for this pubkey");const o=[];let s,l,c;for(const u of a){const n=BP.signature.decode(u.signature),{hash:i,script:a}=c!==n.hashType?ZP(e,Object.assign({},r,{sighashType:n.hashType}),this.__CACHE,!0):{hash:s,script:l};c=n.hashType,s=i,l=a,jP(u.pubkey,a,"verify"),o.push(t(u.pubkey,i,n.signature))}return o.every(e=>!0===e)}validateSignaturesOfTaprootInput(e,t,n){const r=this.data.inputs[e],i=(r||{}).tapKeySig,a=(r||{}).tapScriptSig;if(!r&&!i&&(!a||a.length))throw new Error("No signatures to validate");if("function"!=typeof t)throw new Error("Need validator function to validate signatures");const o=(n=n&&(0,OP.toXOnly)(n))?nB(e,r,this.data.inputs,n,this.__CACHE):function(e,t,n,r){const i=[];if(t.tapInternalKey){const n=eB(e,t,r);n&&i.push(n)}if(t.tapScriptSig){const e=t.tapScriptSig.map(e=>e.pubkey);i.push(...e)}return i.map(i=>nB(e,t,n,i,r)).flat()}(e,r,this.data.inputs,this.__CACHE);if(!o.length)throw new Error("No signatures for this pubkey");const s=o.find(e=>!e.leafHash);let l=0;if(i&&s){if(!t(s.pubkey,s.hash,tB(i)))return!1;l++}if(a)for(const c of a){const e=o.find(e=>c.pubkey.equals(e.pubkey));if(e){if(!t(c.pubkey,e.hash,tB(c.signature)))return!1;l++}}return l>0}signAllInputsHD(e,t=[CP.Transaction.SIGHASH_ALL]){if(!e||!e.publicKey||!e.fingerprint)throw new Error("Need HDSigner to sign input");const n=[];for(const r of hB(this.data.inputs.length))try{this.signInputHD(r,e,t),n.push(!0)}catch(uC){n.push(!1)}if(n.every(e=>!1===e))throw new Error("No inputs were signed");return this}signAllInputsHDAsync(e,t=[CP.Transaction.SIGHASH_ALL]){return new Promise((n,r)=>{if(!e||!e.publicKey||!e.fingerprint)return r(new Error("Need HDSigner to sign input"));const i=[],a=[];for(const o of hB(this.data.inputs.length))a.push(this.signInputHDAsync(o,e,t).then(()=>{i.push(!0)},()=>{i.push(!1)}));return Promise.all(a).then(()=>{if(i.every(e=>!1===e))return r(new Error("No inputs were signed"));n()})})}signInputHD(e,t,n=[CP.Transaction.SIGHASH_ALL]){if(!t||!t.publicKey||!t.fingerprint)throw new Error("Need HDSigner to sign input");return iB(e,this.data.inputs,t).forEach(t=>this.signInput(e,t,n)),this}signInputHDAsync(e,t,n=[CP.Transaction.SIGHASH_ALL]){return new Promise((r,i)=>{if(!t||!t.publicKey||!t.fingerprint)return i(new Error("Need HDSigner to sign input"));const a=iB(e,this.data.inputs,t).map(t=>this.signInputAsync(e,t,n));return Promise.all(a).then(()=>{r()}).catch(i)})}signAllInputs(e,t){if(!e||!e.publicKey)throw new Error("Need Signer to sign input");const n=[];for(const r of hB(this.data.inputs.length))try{this.signInput(r,e,t),n.push(!0)}catch(uC){n.push(!1)}if(n.every(e=>!1===e))throw new Error("No inputs were signed");return this}signAllInputsAsync(e,t){return new Promise((n,r)=>{if(!e||!e.publicKey)return r(new Error("Need Signer to sign input"));const i=[],a=[];for(const[o]of this.data.inputs.entries())a.push(this.signInputAsync(o,e,t).then(()=>{i.push(!0)},()=>{i.push(!1)}));return Promise.all(a).then(()=>{if(i.every(e=>!1===e))return r(new Error("No inputs were signed"));n()})})}signInput(e,t,n){if(!t||!t.publicKey)throw new Error("Need Signer to sign input");const r=(0,kP.checkForInput)(this.data.inputs,e);return(0,OP.isTaprootInput)(r)?this._signTaprootInput(e,r,t,void 0,n):this._signInput(e,t,n)}signTaprootInput(e,t,n,r){if(!t||!t.publicKey)throw new Error("Need Signer to sign input");const i=(0,kP.checkForInput)(this.data.inputs,e);if((0,OP.isTaprootInput)(i))return this._signTaprootInput(e,i,t,n,r);throw new Error(`Input #${e} is not of type Taproot.`)}_signInput(e,t,n=[CP.Transaction.SIGHASH_ALL]){const{hash:r,sighashType:i}=QP(this.data.inputs,e,t.publicKey,this.__CACHE,n),a=[{pubkey:t.publicKey,signature:BP.signature.encode(t.sign(r),i)}];return this.data.updateInput(e,{partialSig:a}),this}_signTaprootInput(e,t,n,r,i=[CP.Transaction.SIGHASH_DEFAULT]){const a=this.checkTaprootHashesForSig(e,t,n,r,i),o=a.filter(e=>!e.leafHash).map(e=>(0,OP.serializeTaprootSignature)(n.signSchnorr(e.hash),t.sighashType))[0],s=a.filter(e=>!!e.leafHash).map(e=>({pubkey:(0,OP.toXOnly)(n.publicKey),signature:(0,OP.serializeTaprootSignature)(n.signSchnorr(e.hash),t.sighashType),leafHash:e.leafHash}));return o&&this.data.updateInput(e,{tapKeySig:o}),s.length&&this.data.updateInput(e,{tapScriptSig:s}),this}signInputAsync(e,t,n){return Promise.resolve().then(()=>{if(!t||!t.publicKey)throw new Error("Need Signer to sign input");const r=(0,kP.checkForInput)(this.data.inputs,e);return(0,OP.isTaprootInput)(r)?this._signTaprootInputAsync(e,r,t,void 0,n):this._signInputAsync(e,t,n)})}signTaprootInputAsync(e,t,n,r){return Promise.resolve().then(()=>{if(!t||!t.publicKey)throw new Error("Need Signer to sign input");const i=(0,kP.checkForInput)(this.data.inputs,e);if((0,OP.isTaprootInput)(i))return this._signTaprootInputAsync(e,i,t,n,r);throw new Error(`Input #${e} is not of type Taproot.`)})}_signInputAsync(e,t,n=[CP.Transaction.SIGHASH_ALL]){const{hash:r,sighashType:i}=QP(this.data.inputs,e,t.publicKey,this.__CACHE,n);return Promise.resolve(t.sign(r)).then(n=>{const r=[{pubkey:t.publicKey,signature:BP.signature.encode(n,i)}];this.data.updateInput(e,{partialSig:r})})}async _signTaprootInputAsync(e,t,n,r,i=[CP.Transaction.SIGHASH_DEFAULT]){const a=this.checkTaprootHashesForSig(e,t,n,r,i),o=[],s=a.filter(e=>!e.leafHash)[0];if(s){const e=Promise.resolve(n.signSchnorr(s.hash)).then(e=>({tapKeySig:(0,OP.serializeTaprootSignature)(e,t.sighashType)}));o.push(e)}const l=a.filter(e=>!!e.leafHash);if(l.length){const e=l.map(e=>Promise.resolve(n.signSchnorr(e.hash)).then(r=>({tapScriptSig:[{pubkey:(0,OP.toXOnly)(n.publicKey),signature:(0,OP.serializeTaprootSignature)(r,t.sighashType),leafHash:e.leafHash}]})));o.push(...e)}return Promise.all(o).then(t=>{t.forEach(t=>this.data.updateInput(e,t))})}checkTaprootHashesForSig(e,t,n,r,i){if("function"!=typeof n.signSchnorr)throw new Error(`Need Schnorr Signer to sign taproot input #${e}.`);const a=nB(e,t,this.data.inputs,n.publicKey,this.__CACHE,r,i);if(!a||!a.length)throw new Error(`Can not sign for input #${e} with the key ${n.publicKey.toString("hex")}`);return a}toBuffer(){return $P(this.__CACHE),this.data.toBuffer()}toHex(){return $P(this.__CACHE),this.data.toHex()}toBase64(){return $P(this.__CACHE),this.data.toBase64()}updateGlobal(e){return this.data.updateGlobal(e),this}updateInput(e,t){return t.witnessScript&&pB(t.witnessScript),(0,OP.checkTaprootInputFields)(this.data.inputs[e],t,"updateInput"),this.data.updateInput(e,t),t.nonWitnessUtxo&&oB(this.__CACHE,this.data.inputs[e],e),this}updateOutput(e,t){const n=this.data.outputs[e];return(0,OP.checkTaprootOutputFields)(n,t,"updateOutput"),this.data.updateOutput(e,t),this}addUnknownKeyValToGlobal(e){return this.data.addUnknownKeyValToGlobal(e),this}addUnknownKeyValToInput(e,t){return this.data.addUnknownKeyValToInput(e,t),this}addUnknownKeyValToOutput(e,t){return this.data.addUnknownKeyValToOutput(e,t),this}clearFinalizedInput(e){return this.data.clearFinalizedInput(e),this}}sT.Psbt=RP;const UP=e=>new MP(e);class MP{constructor(e=Buffer.from([2,0,0,0,0,0,0,0,0,0])){this.tx=CP.Transaction.fromBuffer(e),function(e){if(!e.ins.every(e=>e.script&&0===e.script.length&&e.witness&&0===e.witness.length))throw new Error("Format Error: Transaction ScriptSigs are not empty")}(this.tx),Object.defineProperty(this,"tx",{enumerable:!1,writable:!0})}getInputOutputCounts(){return{inputCount:this.tx.ins.length,outputCount:this.tx.outs.length}}addInput(e){if(void 0===e.hash||void 0===e.index||!Buffer.isBuffer(e.hash)&&"string"!=typeof e.hash||"number"!=typeof e.index)throw new Error("Error adding input.");const t="string"==typeof e.hash?(0,NP.reverseBuffer)(Buffer.from(e.hash,"hex")):e.hash;this.tx.addInput(t,e.index,e.sequence)}addOutput(e){if(void 0===e.script||void 0===e.value||!Buffer.isBuffer(e.script)||"number"!=typeof e.value)throw new Error("Error adding output.");this.tx.addOutput(e.script,e.value)}toBuffer(){return this.tx.toBuffer()}}function $P(e){if(!1!==e.__UNSAFE_SIGN_NONSEGWIT)throw new Error("Not BIP174 compliant, can not export")}function HP(e,t,n){if(!t)return!1;let r;if(r=n?n.map(e=>{const n=function(e){if(65===e.length){const t=1&e[64],n=e.slice(0,33);return n[0]=2|t,n}return e.slice()}(e);return t.find(e=>e.pubkey.equals(n))}).filter(e=>!!e):t,r.length>e)throw new Error("Too many signatures");return r.length===e}function DP(e){return!!e.finalScriptSig||!!e.finalScriptWitness}function zP(e){return t=>!!t.masterFingerprint.equals(e.fingerprint)&&!!e.derivePath(t.path).publicKey.equals(t.pubkey)}function WP(e){if("number"!=typeof e||e!==Math.floor(e)||e>4294967295||e<0)throw new Error("Invalid 32 bit integer")}function VP(e,t){e.forEach(e=>{if((0,OP.isTaprootInput)(e)?(0,OP.checkTaprootInputForSigs)(e,t):(0,LP.checkInputForSig)(e,t))throw new Error("Can not modify transaction, signatures exist.")})}function jP(e,t,n){if(!(0,LP.pubkeyInScript)(e,t))throw new Error(`Can not ${n} for this input with the key ${e.toString("hex")}`)}function qP(e,t){const n=(0,NP.reverseBuffer)(Buffer.from(t.hash)).toString("hex")+":"+t.index;if(e.__TX_IN_CACHE[n])throw new Error("Duplicate input detected.");e.__TX_IN_CACHE[n]=1}function KP(e,t){return(n,r,i,a)=>{const o=e({redeem:{output:i}}).output;if(!r.equals(o))throw new Error(`${t} for ${a} #${n} doesn't match the scriptPubKey in the prevout`)}}const XP=KP(_P.p2sh,"Redeem script"),GP=KP(_P.p2wsh,"Witness script");function YP(e,t,n,r){if(!n.every(DP))throw new Error(`PSBT must be finalized to calculate ${t}`);if("__FEE_RATE"===e&&r.__FEE_RATE)return r.__FEE_RATE;if("__FEE"===e&&r.__FEE)return r.__FEE;let i,a=!0;return r.__EXTRACTED_TX?(i=r.__EXTRACTED_TX,a=!1):i=r.__TX.clone(),sB(n,i,r,a),"__FEE_RATE"===e?r.__FEE_RATE:"__FEE"===e?r.__FEE:void 0}function JP(e,t,n,r,i,a){const o=mB(n);if(!function(e,t,n){switch(n){case"pubkey":case"pubkeyhash":case"witnesspubkeyhash":return HP(1,e.partialSig);case"multisig":const n=_P.p2ms({output:t});return HP(n.m,e.partialSig,n.pubkeys);default:return!1}}(t,n,o))throw new Error(`Can not finalize input #${e}`);return function(e,t,n,r,i,a){let o,s;const l=function(e,t,n){let r;switch(t){case"multisig":const t=function(e,t){return _P.p2ms({output:e}).pubkeys.map(e=>(t.filter(t=>t.pubkey.equals(e))[0]||{}).signature).filter(e=>!!e)}(e,n);r=_P.p2ms({output:e,signatures:t});break;case"pubkey":r=_P.p2pk({output:e,signature:n[0].signature});break;case"pubkeyhash":r=_P.p2pkh({output:e,pubkey:n[0].pubkey,signature:n[0].signature});break;case"witnesspubkeyhash":r=_P.p2wpkh({output:e,pubkey:n[0].pubkey,signature:n[0].signature})}return r}(e,t,n),c=a?_P.p2wsh({redeem:l}):null,u=i?_P.p2sh({redeem:c||l}):null;return r?(s=c?(0,LP.witnessStackToScriptWitness)(c.witness):(0,LP.witnessStackToScriptWitness)(l.witness),u&&(o=u.input)):o=u?u.input:l.input,{finalScriptSig:o,finalScriptWitness:s}}(n,o,t.partialSig,r,i,a)}function QP(e,t,n,r,i){const a=(0,kP.checkForInput)(e,t),{hash:o,sighashType:s,script:l}=ZP(t,a,r,!1,i);return jP(n,l,"sign"),{hash:o,sighashType:s}}function ZP(e,t,n,r,i){const a=n.__TX,o=t.sighashType||CP.Transaction.SIGHASH_ALL;let s,l;if(rB(o,i),t.nonWitnessUtxo){const r=lB(n,t,e),i=a.ins[e].hash,o=r.getHash();if(!i.equals(o))throw new Error(`Non-witness UTXO hash for input #${e} doesn't match the hash specified in the prevout`);const s=a.ins[e].index;l=r.outs[s]}else{if(!t.witnessUtxo)throw new Error("Need a Utxo input item for signing");l=t.witnessUtxo}const{meaningfulScript:c,type:u}=fB(l.script,e,"input",t.redeemScript,t.witnessScript);if(["p2sh-p2wsh","p2wsh"].indexOf(u)>=0)s=a.hashForWitnessV0(e,c,l.value,o);else if((0,LP.isP2WPKH)(c)){const t=_P.p2pkh({hash:c.slice(2)}).output;s=a.hashForWitnessV0(e,t,l.value,o)}else{if(void 0===t.nonWitnessUtxo&&!1===n.__UNSAFE_SIGN_NONSEGWIT)throw new Error(`Input #${e} has witnessUtxo but non-segwit script: ${c.toString("hex")}`);!r&&n.__UNSAFE_SIGN_NONSEGWIT,s=a.hashForSignature(e,c,o)}return{script:c,sighashType:o,hash:s}}function eB(e,t,n){const{script:r}=uB(e,t,n);return(0,LP.isP2TR)(r)?r.subarray(2,34):null}function tB(e){return 64===e.length?e:e.subarray(0,64)}function nB(e,t,n,r,i,a,o){const s=i.__TX,l=t.sighashType||CP.Transaction.SIGHASH_DEFAULT;rB(l,o);const c=n.map((e,t)=>uB(t,e,i)),u=c.map(e=>e.script),d=c.map(e=>e.value),f=[];if(t.tapInternalKey&&!a){const n=eB(e,t,i)||Buffer.from([]);if((0,OP.toXOnly)(r).equals(n)){const t=s.hashForWitnessV1(e,u,d,l);f.push({pubkey:r,hash:t})}}const p=(t.tapLeafScript||[]).filter(e=>(0,LP.pubkeyInScript)(r,e.script)).map(e=>{const t=(0,PP.tapleafHash)({output:e.script,version:e.leafVersion});return Object.assign({hash:t},e)}).filter(e=>!a||a.equals(e.hash)).map(t=>{const n=s.hashForWitnessV1(e,u,d,l,t.hash);return{pubkey:r,hash:n,leafHash:t.hash}});return f.concat(p)}function rB(e,t){if(t&&t.indexOf(e)<0){const t=function(e){let t=e&CP.Transaction.SIGHASH_ANYONECANPAY?"SIGHASH_ANYONECANPAY | ":"";switch(31&e){case CP.Transaction.SIGHASH_ALL:t+="SIGHASH_ALL";break;case CP.Transaction.SIGHASH_SINGLE:t+="SIGHASH_SINGLE";break;case CP.Transaction.SIGHASH_NONE:t+="SIGHASH_NONE"}return t}(e);throw new Error(`Sighash type is not allowed. Retry the sign method passing the sighashTypes array of whitelisted types. Sighash type: ${t}`)}}function iB(e,t,n){const r=(0,kP.checkForInput)(t,e);if(!r.bip32Derivation||0===r.bip32Derivation.length)throw new Error("Need bip32Derivation to sign with HD");const i=r.bip32Derivation.map(e=>e.masterFingerprint.equals(n.fingerprint)?e:void 0).filter(e=>!!e);if(0===i.length)throw new Error("Need one bip32Derivation masterFingerprint to match the HDSigner fingerprint");return i.map(e=>{const t=n.derivePath(e.path);if(!e.pubkey.equals(t.publicKey))throw new Error("pubkey did not match bip32Derivation");return t})}function aB(e){let t=0;function n(){const n=IP.decode(e,t);return t+=IP.decode.bytes,n}function r(){return r=n(),t+=r,e.slice(t-r,t);var r}return function(){const e=n(),t=[];for(let n=0;n<e;n++)t.push(r());return t}()}function oB(e,t,n){e.__NON_WITNESS_UTXO_BUF_CACHE[n]=t.nonWitnessUtxo;const r=CP.Transaction.fromBuffer(t.nonWitnessUtxo);e.__NON_WITNESS_UTXO_TX_CACHE[n]=r;const i=e,a=n;delete t.nonWitnessUtxo,Object.defineProperty(t,"nonWitnessUtxo",{enumerable:!0,get(){const e=i.__NON_WITNESS_UTXO_BUF_CACHE[a],t=i.__NON_WITNESS_UTXO_TX_CACHE[a];if(void 0!==e)return e;{const e=t.toBuffer();return i.__NON_WITNESS_UTXO_BUF_CACHE[a]=e,e}},set(e){i.__NON_WITNESS_UTXO_BUF_CACHE[a]=e}})}function sB(e,t,n,r){let i=0;e.forEach((e,a)=>{if(r&&e.finalScriptSig&&(t.ins[a].script=e.finalScriptSig),r&&e.finalScriptWitness&&(t.ins[a].witness=aB(e.finalScriptWitness)),e.witnessUtxo)i+=e.witnessUtxo.value;else if(e.nonWitnessUtxo){const r=lB(n,e,a),o=t.ins[a].index,s=r.outs[o];i+=s.value}});const a=t.outs.reduce((e,t)=>e+t.value,0),o=i-a;if(o<0)throw new Error("Outputs are spending more than Inputs");const s=t.virtualSize();n.__FEE=o,n.__EXTRACTED_TX=t,n.__FEE_RATE=Math.floor(o/s)}function lB(e,t,n){const r=e.__NON_WITNESS_UTXO_TX_CACHE;return r[n]||oB(e,t,n),r[n]}function cB(e,t,n){const{script:r}=uB(e,t,n);return r}function uB(e,t,n){if(void 0!==t.witnessUtxo)return{script:t.witnessUtxo.script,value:t.witnessUtxo.value};if(void 0!==t.nonWitnessUtxo){const r=lB(n,t,e).outs[n.__TX.ins[e].index];return{script:r.script,value:r.value}}throw new Error("Can't find pubkey in input without Utxo data")}function dB(e){return 33===e.length&&BP.isCanonicalPubKey(e)}function fB(e,t,n,r,i){const a=(0,LP.isP2SHScript)(e),o=a&&r&&(0,LP.isP2WSHScript)(r),s=(0,LP.isP2WSHScript)(e);if(a&&void 0===r)throw new Error("scriptPubkey is P2SH but redeemScript missing");if((s||o)&&void 0===i)throw new Error("scriptPubkey or redeemScript is P2WSH but witnessScript missing");let l;return o?(l=i,XP(t,e,r,n),GP(t,r,i,n),pB(l)):s?(l=i,GP(t,e,i,n),pB(l)):a?(l=r,XP(t,e,r,n)):l=e,{meaningfulScript:l,type:o?"p2sh-p2wsh":a?"p2sh":s?"p2wsh":"raw"}}function pB(e){if((0,LP.isP2WPKH)(e)||(0,LP.isP2SHScript)(e))throw new Error("P2WPKH or P2SH can not be contained within P2WSH")}function mB(e){return(0,LP.isP2WPKH)(e)?"witnesspubkeyhash":(0,LP.isP2PKH)(e)?"pubkeyhash":(0,LP.isP2MS)(e)?"multisig":(0,LP.isP2PK)(e)?"pubkey":"nonstandard"}function hB(e){return[...Array(e).keys()]}!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.initEccLib=e.Transaction=e.opcodes=e.Psbt=e.Block=e.script=e.payments=e.networks=e.crypto=e.address=void 0;const t=_N();e.address=t;const n=MI;e.crypto=n;const r=bE;e.networks=r;const i=TN();e.payments=i;const a=yI();e.script=a;var o=PN;Object.defineProperty(e,"Block",{enumerable:!0,get:function(){return o.Block}});var s=sT;Object.defineProperty(e,"Psbt",{enumerable:!0,get:function(){return s.Psbt}});var l=EE;Object.defineProperty(e,"opcodes",{enumerable:!0,get:function(){return l.OPS}});var c=CN;Object.defineProperty(e,"Transaction",{enumerable:!0,get:function(){return c.Transaction}});var u=oN;Object.defineProperty(e,"initEccLib",{enumerable:!0,get:function(){return u.initEccLib}})}(gE);const gB=e({__proto__:null,default:ue(gE)},[gE]),yB="nexus_pending_utxos";function bB(e){if(!e)return[];try{const t=sessionStorage.getItem(yB);if(!t)return[];const n=JSON.parse(t),r=n[e]||[],i=Date.now(),a=r.filter(e=>i-e.usedAt<864e5);return a.length!==r.length&&(n[e]=a,sessionStorage.setItem(yB,JSON.stringify(n))),a}catch(Kh){return[]}}const wB=Object.freeze(Object.defineProperty({__proto__:null,filterPendingUtxos:function(e,t){if(!e||!Array.isArray(e)||!t)return e;const n=bB(t);if(0===n.length)return e;const r=e.filter(e=>!n.some(t=>t.txid===e.txid&&t.vout===e.vout));return e.length,r.length,r},getPendingUtxoCount:function(e){return bB(e).length},getPendingUtxos:bB},Symbol.toStringTag,{value:"Module"}));function xB(e){if(!e||"string"!=typeof e)return null;const t=e.match(/^([a-f0-9]{64})i(\d+)$/);return t?{txid:t[1],vout:parseInt(t[2]),inscriptionId:e}:null}const vB=Object.freeze(Object.defineProperty({__proto__:null,parseInscriptionId:xB,validateOrdinalsUtxoData:function(e,t){const n=[],r={...e};if(!e)return{isValid:!1,warnings:["No ordinals data"],correctedData:null};if(!t)return{isValid:!1,warnings:["No UTXO data to validate against"],correctedData:r};if(e.inscriptions&&Array.isArray(e.inscriptions)){const i=[];for(const r of e.inscriptions){const e=xB(r);e?(i.push(r),e.txid,t.txid):n.push(`Invalid inscription ID format: ${r}`)}r.inscriptions=i}return{isValid:!0,warnings:n,correctedData:r}}},Symbol.toStringTag,{value:"Module"}));function SB(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return t.toString(36)}const EB=Object.freeze(Object.defineProperty({__proto__:null,encodeAddresses:function(e,t){if(!e||0===e.length)throw new Error("No addresses to encode");if(!t||"string"!=typeof t)throw new Error("Platform address required for encoding");const n={addrs:e,ts:Date.now(),check:SB(e.join("")+t)};return function(e,t){const n=[];for(let r=0;r<e.length;r++)n.push(e.charCodeAt(r)^t.charCodeAt(r%t.length));return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}(JSON.stringify(n),t)}},Symbol.toStringTag,{value:"Module"})),IB=Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"}));function kB(e){if(!e)return null;try{return(Buffer.isBuffer(e)?e:Buffer.from(e)).toString("hex")}catch{return null}}function AB(e){return("string"==typeof e?e.trim().toLowerCase():"")||null}function NB(e,t){const n=e?.data?.inputs?.[t];return n&&"object"==typeof n?n:null}function TB(e,{sellerInputIndex:t=2}={}){if(!e)throw new Error("snapshotOpenStoreOfferCriticalShape: psbt is required");const n=Array.isArray(e?.txInputs)?e.txInputs:[],r=Array.from({length:n.length}).map((t,n)=>PB(e,n)),i=Array.isArray(e?.txOutputs)?e.txOutputs:[],a=i.map(e=>function(e){if(!e)return{value:null,scriptHex:null};const t=Number(e.value);return{value:Number.isFinite(t)?Math.floor(t):null,scriptHex:AB(kB(e.script))}}(e)),o=PB(e,t),s=NB(e,t)||{},l=s?.witnessUtxo||null;return{sellerInputIndex:Number(t),sellerOutpoint:o||null,sellerWitnessUtxoValue:Number.isFinite(Number(l?.value))?Math.floor(Number(l.value)):null,sellerWitnessUtxoScriptHex:AB(kB(l?.script)),inputCount:n.length,outputCount:i.length,inputOutpoints:r,outputs:a}}function _B(e,t){if(!e)return!1;try{const n=Buffer.isBuffer(e)?e:Buffer.from(e);return n.length>=65&&(255&n[n.length-1])==(255&t)}catch{return!1}}function PB(e,t=0){const n=function(e,t=0){if(!e)return null;if(Array.isArray(e.txInputs)&&e.txInputs[t])return e.txInputs[t];const n=e?.data?.globalMap?.unsignedTx?.tx?.ins;return Array.isArray(n)&&n[t]?n[t]:null}(e,t);if(!n)return null;const r=n.index??n.vout,i=function(e){if(!e)return null;const t=Buffer.isBuffer(e)?e:Buffer.from(e);return 32!==t.length?null:Buffer.from(t).reverse().toString("hex")}(n.hash)||("string"==typeof n.hash?n.hash:null);return i&&Number.isFinite(Number(r))?`${i.toLowerCase()}:${Math.floor(Number(r))}`:null}const BB=Object.freeze(Object.defineProperty({__proto__:null,assertOpenStoreSellerOfferSignedCorrectly:function({unsignedOfferPsbt:e,signedOfferPsbt:t,sellerInputIndex:n=2,expectedSighashByte:r=131}={}){if(!e)throw new Error("assertOpenStoreSellerOfferSignedCorrectly: unsignedOfferPsbt is required");if(!t)throw new Error("assertOpenStoreSellerOfferSignedCorrectly: signedOfferPsbt is required");const i=Number(n);if(!Number.isFinite(i)||i<0)throw new Error("assertOpenStoreSellerOfferSignedCorrectly: invalid sellerInputIndex");const a=function(e,t){const n=[];if(!e||!t)return["missing snapshot"];"number"==typeof e.inputCount&&"number"==typeof t.inputCount&&e.inputCount!==t.inputCount&&n.push(`input count changed (${e.inputCount} -> ${t.inputCount})`),"number"==typeof e.outputCount&&"number"==typeof t.outputCount&&e.outputCount!==t.outputCount&&n.push(`output count changed (${e.outputCount} -> ${t.outputCount})`);const r=Math.max(e.inputOutpoints?.length||0,t.inputOutpoints?.length||0);for(let a=0;a<r;a++){const r=e.inputOutpoints?.[a]||null,i=t.inputOutpoints?.[a]||null;r&&i&&r!==i&&n.push(`input[${a}] outpoint changed (${r} -> ${i})`)}e.sellerOutpoint&&t.sellerOutpoint&&e.sellerOutpoint!==t.sellerOutpoint&&n.push(`seller outpoint changed (${e.sellerOutpoint} -> ${t.sellerOutpoint})`),null!==e.sellerWitnessUtxoValue&&null!==t.sellerWitnessUtxoValue&&e.sellerWitnessUtxoValue!==t.sellerWitnessUtxoValue&&n.push(`seller witnessUtxo.value changed (${e.sellerWitnessUtxoValue} -> ${t.sellerWitnessUtxoValue})`),e.sellerWitnessUtxoScriptHex&&t.sellerWitnessUtxoScriptHex&&e.sellerWitnessUtxoScriptHex!==t.sellerWitnessUtxoScriptHex&&n.push("seller witnessUtxo.script changed");const i=Math.max(e.outputs?.length||0,t.outputs?.length||0);for(let a=0;a<i;a++){const r=e.outputs?.[a]??{value:null,scriptHex:null},i=t.outputs?.[a]??{value:null,scriptHex:null};(null!==r.value&&void 0!==r.value||null!==r.scriptHex&&void 0!==r.scriptHex)==(null!==i.value&&void 0!==i.value||null!==i.scriptHex&&void 0!==i.scriptHex)?(null!==r.value&&void 0!==r.value&&null!==i.value&&void 0!==i.value&&r.value!==i.value&&n.push(`output[${a}] value changed (${r.value} -> ${i.value})`),null!==r.scriptHex&&void 0!==r.scriptHex&&null!==i.scriptHex&&void 0!==i.scriptHex&&r.scriptHex!==i.scriptHex&&n.push(`output[${a}] script changed`)):n.push(`output[${a}] presence changed`)}return n}(TB(e,{sellerInputIndex:i}),TB(t,{sellerInputIndex:i}));if(a.length>0)throw new Error(`OODL_OFFER_SIGNING_TEMPLATE_MUTATED: ${a.join("; ")}`);const o=function(e,t,n){const r=NB(e,t)||{},i=r?.sighashType,a="number"==typeof i&&(255&i)==(255&n),o=r?.tapKeySig,s=_B(o,n),l=Array.isArray(r?.partialSig)?r.partialSig:[];return{okType:a,okTap:s,okPartial:l.some(e=>_B(e?.signature,n)),hasAnySig:Boolean(o)||l.length>0}}(t,i,r);if(!o.hasAnySig)throw new Error("OODL_OFFER_SIGNING_MISSING_SIGNATURE");if(!o.okTap&&!o.okPartial)throw new Error("OODL_OFFER_SIGNING_SIGHASH_INVALID");try{const e=t?.data?.inputs?.[i];e&&e.sighashType!==r&&(e.sighashType=r)}catch{}return!0},getPsbtInputOutpoint:PB,snapshotOpenStoreOfferCriticalShape:TB},Symbol.toStringTag,{value:"Module"})),CB=Object.freeze(Object.defineProperty({__proto__:null,clearAllCachesForWallet:async function(e){const t=Array.isArray(e)?e:[e],{clearCachedCompleteData:r,bumpCompleteDataCache:i}=await n(async()=>{const{clearCachedCompleteData:e,bumpCompleteDataCache:t}=await Promise.resolve().then(()=>ky);return{clearCachedCompleteData:e,bumpCompleteDataCache:t}},__VITE_PRELOAD__);r(t.sort().join(","));const{clearCachedInscriptions:a,bumpInscriptionCache:o}=await n(async()=>{const{clearCachedInscriptions:e,bumpInscriptionCache:t}=await Promise.resolve().then(()=>VB);return{clearCachedInscriptions:e,bumpInscriptionCache:t}},__VITE_PRELOAD__);for(const n of t)a(n);const{bumpSessionCacheNamespace:s}=await n(async()=>{const{bumpSessionCacheNamespace:e}=await Promise.resolve().then(()=>Yy);return{bumpSessionCacheNamespace:e}},__VITE_PRELOAD__);s("manual-refresh")}},Symbol.toStringTag,{value:"Module"})),OB=(globalThis.__NEXUS_DEBUG_WALLET__,(...e)=>{}),LB=(...e)=>{};async function FB(e){try{const t=th(`/r/sat/${e}`),n=await fetch(t);return n.ok?(await n.json()).ids||[]:(n.status,[])}catch(cC){return cC.message,[]}}function RB(e){if(!e)return e;const t=e.inscriptionId||e.id||e.rawId,n=vh(t);return{id:n,rawId:t,number:e.inscriptionNumber||e.number||null,contentType:e.contentType||e.content_type||null,satpoint:e.satpoint||e.output||null,value:e.value||e.output_value||null,inscriptionValue:"number"==typeof e.inscriptionValue?e.inscriptionValue:null,address:e.address||null,sat:e.sat||null,label:e.label||(null!=e.number?`#${e.inscriptionNumber||e.number}${e.contentType?" - "+(e.contentType||e.content_type):""}`:`${n.substring(0,12)}...${e.contentType?" - "+e.contentType:""}`),utxo:e.utxo||null,fromUtxo:!!e.fromUtxo,fromSatScan:!!e.fromSatScan,source:e.source||"wallet",sameSatIds:e.sameSatIds?[...e.sameSatIds].reverse():null}}const UB=Object.freeze(Object.defineProperty({__proto__:null,extractInscriptionsFromUtxos:async function(e){if(!e)return[];const t=Array.isArray(e)?e:e.unsafe||[];if(0===t.length)return[];const n=[];t.length;const r=new Map,i=new Set;for(const o of t){const e=o.assetCheck?.details?.utxoData||{},t=Array.isArray(e.sat_ranges)?e.sat_ranges:null,n=o.inscriptionIds||e.inscriptions||[],r=n.length>1,a=n.some(e=>{const t=e.match(/i(\d+)$/);return t&&parseInt(t[1])>0});(r||a)&&t&&t.length>0&&t.forEach(e=>{Array.isArray(e)&&"number"==typeof e[0]&&i.add(e[0])})}if(i.size>0){i.size;for(const e of i)try{const t=await FB(e);t&&t.length>0&&r.set(e,new Set(t))}catch(cC){LB(cC.message)}r.size}const a=new Map;r.forEach((e,t)=>{e.forEach(e=>a.set(e,t))});for(const o of t){const{txid:e,vout:t,address:i}=o,s=o.assetCheck?.details?.utxoData||{},l=Array.isArray(s.sat_ranges)?s.sat_ranges:null,c=o.inscriptionIds||s.inscriptions||[],u=e=>{if(!l||0===l.length)return null;const t=l[0]?.[0];if("number"!=typeof t)return null;const n=l.map(e=>Array.isArray(e)&&"number"==typeof e[0]?e[0]-t:null);return"number"==typeof e&&n.length!==e?null:n};if(o.assetCheck?.details?.inscriptionData){const s=o.assetCheck.details.inscriptionData.inscriptions||[],d=u(s.length),f=[];if(l&&l.length===s.length)for(const[e,t]of l)f.push(t-e);else if(1===s.length)f.push(o.value);else{const e=Math.floor(o.value/s.length);for(let t=0;t<s.length;t++)f.push(e)}for(let u=0;u<s.length;u++){const p=s[u],m=p.inscriptionId||`${e}i${t}`,h=Array.isArray(d)?d[u]:null,g=f[u]||o.value,y=a.get(m)||l?.[0]?.[0],b=y?r.get(y):null,w=b?Array.from(b).reverse():null;n.push(RB({inscriptionId:m,contentType:p.contentType,satpoint:`${e}:${t}${null!=h?":"+h:""}`,value:o.value,inscriptionValue:g,address:i,label:`${m.substring(0,12)}... - ${p.contentType}`,utxo:{txid:e,vout:t,value:o.value,inscriptionValue:g,address:i,offset:h,inscriptionIds:c},sat:y,sameSatIds:w,fromUtxo:!0,source:"utxo"}))}}else if(c.length>0){const s=u(c.length);OB(c.length);const d=[];if(l&&l.length===c.length){for(const[e,t]of l)d.push(t-e);OB()}else if(1===c.length)d.push(o.value);else{const e=Math.floor(o.value/c.length);for(let t=0;t<c.length;t++)d.push(e);OB(o.value)}for(let u=0;u<c.length;u++){const f=c[u],p=Array.isArray(s)?s[u]:null,m=d[u]||o.value,h=a.get(f)||l?.[0]?.[0],g=h?r.get(h):null,y=g?Array.from(g).reverse():null;OB(c.length),y&&y.length>1&&OB(y.length,y.map(e=>e.substring(0,16)+"...")),n.push(RB({inscriptionId:f,contentType:"application/octet-stream",satpoint:`${e}:${t}${null!=p?":"+p:""}`,value:o.value,inscriptionValue:m,address:i,label:f.substring(0,12)+"...",utxo:{txid:e,vout:t,value:o.value,inscriptionValue:m,address:i,offset:p,inscriptionIds:c,isSameSat:y&&y.length>1},sat:h,sameSatIds:y,fromUtxo:!0,source:"utxo"}))}}}return n.length,n.length,n.filter(e=>e.sameSatIds&&e.sameSatIds.length>1).length,r.size,n}},Symbol.toStringTag,{value:"Module"})),MB=3e5;let $B="INS-v1";const HB=(()=>{try{return window.sessionStorage}catch{return null}})(),DB=new Map;function zB(e){return`${$B}:${e}`}function WB(e,t){e&&Array.isArray(t)&&function(e,t){const n=zB(e),r=Array.isArray(t)?{_cacheTimestamp:Date.now(),_data:t}:{...t,_cacheTimestamp:Date.now()};if(DB.set(n,r),HB)try{HB.setItem(n,JSON.stringify(r))}catch(cC){}}(`inscriptions:${e}`,t)}const VB=Object.freeze(Object.defineProperty({__proto__:null,bumpInscriptionCache:function(e=""){$B=`INS-v1:${Date.now()}${e?":"+e:""}`},clearCachedInscriptions:function(e){e&&function(e){const t=zB(e);if(DB.delete(t),HB)try{HB.removeItem(t)}catch{}}(`inscriptions:${e}`)},getCachedInscriptions:function(e){if(!e)return null;const t=function(e){const t=zB(e);if(DB.has(t)){const e=DB.get(t);if(e._cacheTimestamp&&Date.now()-e._cacheTimestamp>MB){if(DB.delete(t),HB)try{HB.removeItem(t)}catch{}return null}return void 0!==e._data?e._data:e}if(HB){const e=HB.getItem(t);if(e)try{const n=JSON.parse(e);return n._cacheTimestamp&&Date.now()-n._cacheTimestamp>MB?(HB.removeItem(t),null):(DB.set(t,n),void 0!==n._data?n._data:n)}catch{}}return null}(`inscriptions:${e}`);if(!t)return null;let n=!1;const r=Array.isArray(t)?t.map(e=>{try{if(!e||!e.utxo)return e;const t=e.utxo.totalUtxoValue,r=e.utxo.value;if("number"==typeof t&&Number.isFinite(t)&&t>0&&"number"==typeof r&&Number.isFinite(r)&&r>0&&t!==r){n=!0;const i={...e,utxo:{...e.utxo}};return"number"!=typeof i.utxo.inscriptionValue&&(i.utxo.inscriptionValue=r),"number"!=typeof i.inscriptionValue&&(i.inscriptionValue="number"==typeof e.value?e.value:r),i.utxo.value=t,i.value=t,i}return e}catch{return e}}):t;if(n)try{WB(e,r)}catch{}return r},setCachedInscriptions:WB},Symbol.toStringTag,{value:"Module"}));function jB(e){if(!e||e.length<32||e.length>36)return null;const t=e.slice(0,32),n=function(e){const t=e instanceof Uint8Array?e:new Uint8Array(e);let n="";for(let r=0;r<t.length;r++)n+=t[r].toString(16).padStart(2,"0");return n}(new Uint8Array(t).reverse()),r=e.slice(32);let i=0;if(r.length>0)for(let a=0;a<Math.min(r.length,4);a++)i|=r[a]<<8*a;return`${n}i${i}`}function qB(e,t=0){if(t>=e.length)throw new Error("CBOR: unexpected end of data");const n=e[t],r=n>>5,i=31&n,a=t=>{if(i<24)return{value:i,nextOffset:t+1};if(24===i)return{value:e[t+1],nextOffset:t+2};if(25===i)return{value:e[t+1]<<8|e[t+2],nextOffset:t+3};if(26===i)return{value:(e[t+1]<<24|e[t+2]<<16|e[t+3]<<8|e[t+4])>>>0,nextOffset:t+5};throw new Error(`CBOR: unsupported additional info ${i}`)};if(0===r){const{value:e,nextOffset:n}=a(t);return{value:e,nextOffset:n}}if(1===r){const{value:e,nextOffset:n}=a(t);return{value:-1-e,nextOffset:n}}if(2===r){const{value:n,nextOffset:r}=a(t),i=r+n;if(i>e.length)throw new Error("CBOR: byte string overflows");return{value:e.slice(r,i),nextOffset:i}}if(3===r){const{value:n,nextOffset:r}=a(t),i=r+n;if(i>e.length)throw new Error("CBOR: text string overflows");const o=e.slice(r,i);return{value:"undefined"!=typeof TextDecoder?(new TextDecoder).decode(o):String.fromCharCode(...o),nextOffset:i}}if(4===r){const{value:n,nextOffset:r}=a(t),i=[];let o=r;for(let t=0;t<n;t++){const t=qB(e,o);i.push(t.value),o=t.nextOffset}return{value:i,nextOffset:o}}if(5===r){const{value:n,nextOffset:r}=a(t),i=new Map;let o=r;for(let t=0;t<n;t++){const t=qB(e,o),n=qB(e,t.nextOffset);i.set(t.value,n.value),o=n.nextOffset}return{value:i,nextOffset:o}}if(7===r){if(20===i)return{value:!1,nextOffset:t+1};if(21===i)return{value:!0,nextOffset:t+1};if(22===i)return{value:null,nextOffset:t+1};if(23===i)return{value:void 0,nextOffset:t+1};const{value:e,nextOffset:n}=a(t);return{value:e,nextOffset:n}}throw new Error(`CBOR: unsupported major type ${r} at offset ${t}`)}function KB(e,t){if(t>=e.length)return null;const n=e[t];if(0===n)return{data:new Uint8Array(0),nextOffset:t+1};if(n>=1&&n<=75){const r=t+1+n;return r>e.length?null:{data:e.slice(t+1,r),nextOffset:r}}if(76===n){if(t+2>e.length)return null;const n=t+2+e[t+1];return n>e.length?null:{data:e.slice(t+2,n),nextOffset:n}}if(77===n){if(t+3>e.length)return null;const n=t+3+(e[t+1]|e[t+2]<<8);return n>e.length?null:{data:e.slice(t+3,n),nextOffset:n}}if(78===n){if(t+5>e.length)return null;const n=t+5+(e[t+1]|e[t+2]<<8|e[t+3]<<16|e[t+4]<<24);return n>e.length?null:{data:e.slice(t+5,n),nextOffset:n}}return n>=81&&n<=96?{data:new Uint8Array([n-80]),nextOffset:t+1}:null}function XB(e){return 0===e.length?0:1===e.length?e[0]:null}function GB(e){const t=e instanceof Uint8Array?e:new Uint8Array(e);let n=-1;for(let s=0;s<t.length-5;s++)if(0===t[s]&&99===t[s+1]&&3===t[s+2]&&111===t[s+3]&&114===t[s+4]&&100===t[s+5]){n=s+6;break}if(n<0)return null;const r=new Map;let i=n,a=-1;for(;i<t.length&&104!==t[i];){const e=KB(t,i);if(!e){i++;continue}const n=XB(e.data);if(i=e.nextOffset,0===n){a=i;break}if(null===n)continue;if(i>=t.length||104===t[i])break;const o=KB(t,i);o?(i=o.nextOffset,r.has(n)||r.set(n,[]),r.get(n).push(o.data)):i++}let o=null;if(a>=0){const e=[];let n=a;for(;n<t.length&&104!==t[n];){const r=KB(t,n);r?(e.push(r.data),n=r.nextOffset):n++}if(e.length>0){const t=e.reduce((e,t)=>e+t.length,0);o=new Uint8Array(t);let n=0;for(const r of e)o.set(r,n),n+=r.length}}return{tags:r,body:o}}function YB(e){const t=[],n=e=>{if(e instanceof Uint8Array&&e.length>=32&&e.length<=36)return jB(e);if(e instanceof Map){const t=e.get(0);if(t instanceof Uint8Array&&t.length>=32&&t.length<=36)return jB(t)}if(e&&"object"==typeof e&&!(e instanceof Uint8Array)&&!(e instanceof Map)&&!Array.isArray(e)){const t=e[0];if(t instanceof Uint8Array&&t.length>=32&&t.length<=36)return jB(t)}return null};if(e instanceof Map){const r=e.get(0);if(Array.isArray(r))for(const e of r){const r=n(e);r&&t.push(r)}return t}if(Array.isArray(e)){for(const r of e){const e=n(r);e&&t.push(e)}return t}return t}function JB(e){const t=[],n=[161,0,88,32];let r=0;for(;r<e.length;){let i=!0;for(let t=0;t<n.length;t++)if(e[r+t]!==n[t]){i=!1;break}if(i){const i=r+n.length,a=i+32;if(a<=e.length){const n=jB(e.slice(i,a));n&&t.push(n)}r=i+1}else r++}return t}async function QB(e,t={}){const{network:r=null,bruteForce:i=!0}=t,a=String(e||"").trim();if(!a)return[];let o=a;if(o.includes("i")&&(o=function(e){const t=String(e||"").trim().match(/^([a-f0-9]{64})i\d+$/i);return t?t[1].toLowerCase():null}(a)),!o||!/^[a-f0-9]{64}$/i.test(o))throw new Error(`getGalleryInscriptionIds: invalid inscription ID or txid: ${a}`);o=o.toLowerCase();const[{loadBitcoinLibFromInscription:s},{fetchTxHexViaProxy:l}]=await Promise.all([n(()=>Promise.resolve().then(()=>yg),__VITE_PRELOAD__),n(()=>Promise.resolve().then(()=>ab),__VITE_PRELOAD__)]),c=await s(),u=r||"undefined"!=typeof window&&window.__NEXUS_NETWORK__||"mainnet",d=await l(o,u);if(!d||"string"!=typeof d||d.length<100)throw new Error(`getGalleryInscriptionIds: failed to fetch tx hex for ${o}`);const f=c.Transaction.fromHex(d),p=Array.isArray(f?.ins)?f.ins:[];if(0===p.length)throw new Error("getGalleryInscriptionIds: tx has no inputs");for(let n=0;n<p.length;n++){const e=p[n]?.witness;if(!Array.isArray(e)||e.length<2)continue;const t=e[e.length-2];if(!t||0===t.length)continue;const r=GB(t instanceof Uint8Array?t:new Uint8Array(t.buffer||t));if(!r)continue;const a=r.tags.get(17);if(!a||0===a.length)continue;const o=a.reduce((e,t)=>e+t.length,0),s=new Uint8Array(o);let l=0;for(const n of a)s.set(n,l),l+=n.length;let c=[];try{const{value:e}=qB(s,0);c=YB(e)}catch(cC){}if(0===c.length&&i&&(c=JB(s)),c.length>0)return c}return[]}const ZB=Object.freeze(Object.defineProperty({__proto__:null,decodeCBOR:qB,extractGalleryIdsBruteForce:JB,extractGalleryIdsFromCbor:YB,getGalleryInscriptionIds:QB,hasGalleryProperties:async function(e,t={}){try{return(await QB(e,t)).length>0}catch{return!1}},inscriptionIdFromBytes:jB,parseOrdinalsEnvelope:GB},Symbol.toStringTag,{value:"Module"}));function eC(e){return(null==e?"":String(e)).trim()}function tC(e){const t=function(e){const t=eC(e);if(!t)return null;const n=t.startsWith("0x")?t.slice(2):t;if(n.length%2!=0)return null;const r=new Uint8Array(n.length/2);for(let i=0;i<r.length;i++){const e=Number.parseInt(n.slice(2*i,2*i+2),16);if(!Number.isFinite(e))return null;r[i]=e}return r}(e);if(!t||t.length<1)return null;if(106!==t[0])return null;const n=[];let r=1;for(;r<t.length;){const e=t[r];r+=1;let i=null;if(e>=1&&e<=75)i=e;else if(76===e){if(r+1>t.length)return null;i=t[r],r+=1}else if(77===e){if(r+2>t.length)return null;i=t[r]|t[r+1]<<8,r+=2}else{if(78!==e)break;if(r+4>t.length)return null;i=t[r]|t[r+1]<<8|t[r+2]<<16|t[r+3]<<24,i>>>=0,r+=4}if(!Number.isFinite(i)||i<0)return null;if(r+i>t.length)return null;n.push(t.slice(r,r+i)),r+=i}return 0===n.length?null:function(e){const t=Array.isArray(e)?e.filter(Boolean):[];if(0===t.length)return new Uint8Array(0);const n=t.reduce((e,t)=>e+(t?.length||0),0),r=new Uint8Array(n);let i=0;for(const a of t)r.set(a,i),i+=a.length;return r}(n)}function nC(e){const t=Array.isArray(e)?e:[];for(const n of t){if("op_return"!==n?.scriptpubkey_type||!n?.scriptpubkey)continue;const e=tC(n.scriptpubkey);if(!e||e.length<6)continue;const t=Eb(e);if(t)return t}return null}function rC(e,{indexingAddress:t,minFeeSats:n}){const r=eC(t),i=Number(n);if(!r||!Number.isFinite(i)||i<=0)return!1;const a=Array.isArray(e?.vout)?e.vout:[];for(const o of a){const e=eC(o?.scriptpubkey_address),t=Number(o?.value);if(e&&e===r&&Number.isFinite(t)&&t>=i)return!0}return!1}function iC(e,t){const n=eC(e).toLowerCase();if(!/^[0-9a-f]{64}$/.test(n))return"";if(t?.manifestoInscriptionId){const e=eC(t.manifestoInscriptionId).toLowerCase();if(/^[0-9a-f]{64}i\d+$/.test(e))return e}const r=Number(t?.manifestoInputIndex);return Number.isFinite(r)&&r>=0?`${n}i${String(Math.floor(r))}`:""}const aC=Object.freeze(Object.defineProperty({__proto__:null,discoverParcelManifestRegistrations:async function({limit:e=50}={}){const t=qx?.parcel_manifest,n=eC(t?.address),r=Number(t?.minFeeSats??t?.feeSats??600);if(!n)return[];const i=await async function(e){const t=eC(e);if(!t)return[];try{const e=nh(`/api/address/${t}/txs`),n=await fetch(e);if(!n.ok)return[];const r=await n.json();return Array.isArray(r)?r:[]}catch{return[]}}(n),a=[];for(const s of i){const e=eC(s?.txid).toLowerCase();if(!/^[0-9a-f]{64}$/.test(e))continue;if(!rC(s,{indexingAddress:n,minFeeSats:r}))continue;const t=nC(s?.vout);if(!t)continue;const i=iC(e,t);if(!i)continue;const o=Number(t?.bitmapNumber);if(!Number.isFinite(o)||o<0)continue;const l=s?.status?.block_time?1e3*Number(s.status.block_time):null;a.push({txid:e,blockTimeMs:Number.isFinite(l)?Math.floor(l):null,bitmapNumber:Math.floor(o),manifestoInscriptionId:i,hintVersion:Number(t?.version)||null,all:!1!==t?.all})}a.sort((e,t)=>{const n=Number(e?.blockTimeMs||0),r=Number(t?.blockTimeMs||0);return r!==n?r-n:String(t?.txid||"").localeCompare(String(e?.txid||""))});const o=Number(e);return Number.isFinite(o)&&o>0?a.slice(0,Math.floor(o)):a}},Symbol.toStringTag,{value:"Module"}));function oC(e){return!(!e||"object"!=typeof e&&"function"!=typeof e)&&(e instanceof Uint8Array||"undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&ArrayBuffer.isView(e))}const sC=Object.freeze(Object.defineProperty({__proto__:null,sanitizePsbtForSharing:async function(e,t={}){const n=String(e||"").trim();if(!n)throw new Error("sanitizePsbtForSharing: psbt is required");const r=await gg(),i=!0===t?.parseWithNetwork,a=i?function(e){const t="undefined"!=typeof window&&window.__NEXUS_NETWORK__||"mainnet",n=String(t).toLowerCase();return"testnet"===n||"signet"===n||"regtest"===n?e.networks.testnet:e.networks.bitcoin}(r):null;let o;try{o=function(e){if("string"!=typeof e)return!1;const t=e.trim();return t.length>0&&t.length%2==0&&/^[0-9a-fA-F]+$/.test(t)}(n)?i?r.Psbt.fromHex(n,{network:a}):r.Psbt.fromHex(n):i?r.Psbt.fromBase64(n,{network:a}):r.Psbt.fromBase64(n)}catch(cC){throw new Error(`sanitizePsbtForSharing: could not parse psbt (${cC?.message||cC})`)}return function(e,{removeGlobalXpub:t=!0,removeUnknownAndProprietary:n=!1,removeInputDerivations:r=!1,removeOutputDerivations:i=!0,removeNonWitnessUtxoWhenWitnessUtxoPresent:a=!0}={}){const o=e?.data;if(!o)return;o.globalMap&&(t&&o.globalMap.globalXpub&&delete o.globalMap.globalXpub,n&&(o.globalMap.unknownKeyVals&&delete o.globalMap.unknownKeyVals,o.globalMap.proprietaryKeyVals&&delete o.globalMap.proprietaryKeyVals));const s=Array.isArray(o.inputs)?o.inputs:[];for(const c of s)if(c&&"object"==typeof c){if(a&&c.nonWitnessUtxo){const e=c.witnessUtxo;e&&oC(e.script)&&e.script.length>0&&"number"==typeof e.value&&Number.isSafeInteger(e.value)&&e.value>=0&&delete c.nonWitnessUtxo}r&&(c.bip32Derivation&&delete c.bip32Derivation,c.tapBip32Derivation&&delete c.tapBip32Derivation),n&&(c.unknownKeyVals&&delete c.unknownKeyVals,c.proprietaryKeyVals&&delete c.proprietaryKeyVals)}const l=Array.isArray(o.outputs)?o.outputs:[];for(const c of l)c&&"object"==typeof c&&(i&&(c.bip32Derivation&&delete c.bip32Derivation,c.tapBip32Derivation&&delete c.tapBip32Derivation),n&&(c.unknownKeyVals&&delete c.unknownKeyVals,c.proprietaryKeyVals&&delete c.proprietaryKeyVals))}(o,{..."publish"===(t?.profile?String(t.profile):null)?{removeGlobalXpub:!0,removeOutputDerivations:!0,removeNonWitnessUtxoWhenWitnessUtxoPresent:!0,removeUnknownAndProprietary:!0,removeInputDerivations:!0}:{removeGlobalXpub:!0,removeOutputDerivations:!0,removeNonWitnessUtxoWhenWitnessUtxoPresent:!0,removeUnknownAndProprietary:!1,removeInputDerivations:!1},...t||{}}),o.toBase64()}},Symbol.toStringTag,{value:"Module"})),lC=Object.freeze(Object.defineProperty({__proto__:null,createSplitFundingTransaction:async function({walletProvider:e,networkName:t,paymentAddress:n,paymentPublicKeyHex:r=null,paymentCandidates:i,feeRateSatPerVb:a,dummySats:o=600,minRemainderSats:s=546,label:l="funding-split"}={}){if(!e)throw new Error("Missing walletProvider");if(!n)throw new Error("Missing paymentAddress");if(!Array.isArray(i)||i.length<1)throw new Error("No payment UTXOs available to split. Fund your payment address first.");const c=Number(a||0);if(!Number.isFinite(c)||c<=0)throw new Error("Set a fee rate first (sat/vB) before creating a split funding transaction.");const u=await gg(),d=function(e){const t=String(e||"").toLowerCase().trim();return"testnet"===t||"signet"===t||"regtest"===t?t:"mainnet"}(t),f="testnet"===d||"signet"===d||"regtest"===d?u.networks.testnet:u.networks.bitcoin,p=i.slice().sort((e,t)=>Number(t?.value||0)-Number(e?.value||0))[0];if(!p?.txid||null==p?.vout)throw new Error("Selected payment UTXO is missing txid/vout");const m=`${String(p.txid)}:${Number(p.vout)}`,h=String(p.address||"").trim();if(!h)throw new Error("Funding input is missing an address");let g,y=r;y||(y=await async function(e){try{let t=null;if(e?.getAccounts){const n=await e.getAccounts(),r=Array.isArray(n)?n.find(e=>"payment"===e?.purpose):null;t=r?.publicKey||null}else e?.getPublicKey&&(t=await e.getPublicKey());return"string"==typeof t&&t.startsWith("0x")&&(t=t.slice(2)),(!t||/^[0-9a-fA-F]{66}$/.test(t)||/^[0-9a-fA-F]{130}$/.test(t))&&t||null}catch{return null}}(e));const b={};let w="p2wpkh";if(h.startsWith("3")||h.startsWith("2")){if(w="p2sh-p2wpkh",!y)throw new Error("Cannot create funding tx with nested SegWit address (3.../2...) without payment public key. Try disconnecting and reconnecting your wallet, or switch to a native SegWit (bc1...) payment address.");const e=Buffer.from(y,"hex"),t=u.payments.p2wpkh({pubkey:e,network:f});g=u.payments.p2sh({redeem:t,network:f}).output,b.redeemScript=t.output}else g=u.address.toOutputScript(h,f),w=h.startsWith("bc1p")||h.startsWith("tb1p")?"p2tr":"p2wpkh";const x=String(n).trim(),v=u.address.toOutputScript(x,f),S=x.startsWith("bc1p")||x.startsWith("tb1p")?"p2tr":"p2wpkh",E=_g(1,3,!0,0,{isReveal:!1,inputTypes:[w],outputTypes:[S,S,S]}),I=Math.ceil(E*c),k=Number(p.value),A=k-2*Number(o)-I;if(!Number.isFinite(A)||A<Number(s))throw new Error(`Selected payment UTXO is too small to split. Need > ${2*Number(o)+I+Number(s)} sats, got ${k}.`);const N=new u.Psbt({network:f});N.addInput({hash:Buffer.from(String(p.txid),"hex").reverse(),index:Number(p.vout),sequence:4294967293,witnessUtxo:{script:g,value:Number(p.value)},...b}),N.addOutput({script:v,value:Number(o)}),N.addOutput({script:v,value:Number(o)}),N.addOutput({script:v,value:Math.floor(A)});const T=await Xg(e,N.toHex(),{autoFinalized:!0,toSignInputs:[{index:0,address:h}],network:d,label:l},!0),_=T?.txid||null;if(!_)throw new Error("Funding transaction broadcast did not return a txid.");return{txid:_,spentOutpoint:m,splitUtxos:[{txid:_,vout:0,value:Number(o),address:String(n).trim()},{txid:_,vout:1,value:Number(o),address:String(n).trim()},{txid:_,vout:2,value:Math.floor(A),address:String(n).trim()}],feeSats:I}}},Symbol.toStringTag,{value:"Module"}));

</script>
  <style>
*,:before,:after{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }*,:before,:after{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}:before,:after{--tw-content: ""}html,:host{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;-o-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,samp,pre{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dl,dd,h1,h2,h3,h4,h5,h6,hr,figure,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}ol,ul,menu{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{opacity:1;color:#9ca3af}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}button,[role=button]{cursor:pointer}:disabled{cursor:default}img,svg,video,canvas,audio,iframe,embed,object{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.container{width:100%}@media (min-width: 640px){.container{max-width:640px}}@media (min-width: 768px){.container{max-width:768px}}@media (min-width: 1024px){.container{max-width:1024px}}@media (min-width: 1280px){.container{max-width:1280px}}@media (min-width: 1536px){.container{max-width:1536px}}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}.pointer-events-none{pointer-events:none}.pointer-events-auto{pointer-events:auto}.\!visible{visibility:visible!important}.visible{visibility:visible}.collapse{visibility:collapse}.static{position:static}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.sticky{position:sticky}.inset-0{inset:0}.inset-x-3{left:.75rem;right:.75rem}.bottom-2{bottom:.5rem}.bottom-4{bottom:1rem}.left-2{left:.5rem}.left-2\.5{left:.625rem}.left-3{left:.75rem}.right-0{right:0}.right-2{right:.5rem}.right-2\.5{right:.625rem}.right-4{right:1rem}.top-0{top:0}.top-1\/2{top:50%}.top-14{top:3.5rem}.top-16{top:4rem}.top-2{top:.5rem}.top-full{top:100%}.isolate{isolation:isolate}.z-0{z-index:0}.z-10{z-index:10}.z-\[100\]{z-index:100}.z-\[9000\]{z-index:9000}.z-\[9001\]{z-index:9001}.z-\[9200\]{z-index:9200}.z-\[9500\]{z-index:9500}.z-\[9800\]{z-index:9800}.z-\[99999\]{z-index:99999}.z-\[9999\]{z-index:9999}.mx-0{margin-left:0;margin-right:0}.mx-auto{margin-left:auto;margin-right:auto}.my-1{margin-top:.25rem;margin-bottom:.25rem}.mb-1{margin-bottom:.25rem}.mb-2{margin-bottom:.5rem}.mb-3{margin-bottom:.75rem}.mb-4{margin-bottom:1rem}.ml-1{margin-left:.25rem}.ml-2{margin-left:.5rem}.mt-0\.5{margin-top:.125rem}.mt-1{margin-top:.25rem}.mt-1\.5{margin-top:.375rem}.mt-2{margin-top:.5rem}.mt-3{margin-top:.75rem}.mt-4{margin-top:1rem}.line-clamp-2{overflow:hidden;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2}.block{display:block}.inline{display:inline}.inline-flex{display:inline-flex}.table{display:table}.grid{display:grid}.contents{display:contents}.hidden{display:none}.aspect-square{aspect-ratio:1 / 1}.h-0\.5{height:.125rem}.h-1\.5{height:.375rem}.h-10{height:2.5rem}.h-11{height:2.75rem}.h-12{height:3rem}.h-14{height:3.5rem}.h-2{height:.5rem}.h-2\.5{height:.625rem}.h-2\/3{height:66.666667%}.h-20{height:5rem}.h-3{height:.75rem}.h-3\.5{height:.875rem}.h-4{height:1rem}.h-40{height:10rem}.h-5{height:1.25rem}.h-6{height:1.5rem}.h-8{height:2rem}.h-9{height:2.25rem}.h-\[100dvh\]{height:100dvh}.h-full{height:100%}.max-h-40{max-height:10rem}.max-h-48{max-height:12rem}.max-h-56{max-height:14rem}.max-h-64{max-height:16rem}.max-h-\[85dvh\]{max-height:85dvh}.max-h-\[85vh\]{max-height:85vh}.max-h-\[90dvh\]{max-height:90dvh}.max-h-\[90vh\]{max-height:90vh}.min-h-0{min-height:0px}.min-h-\[200px\]{min-height:200px}.min-h-\[32px\]{min-height:32px}.min-h-\[36px\]{min-height:36px}.min-h-\[44px\]{min-height:44px}.w-1\.5{width:.375rem}.w-10{width:2.5rem}.w-12{width:3rem}.w-14{width:3.5rem}.w-2{width:.5rem}.w-2\.5{width:.625rem}.w-2\/3{width:66.666667%}.w-20{width:5rem}.w-24{width:6rem}.w-28{width:7rem}.w-3{width:.75rem}.w-3\.5{width:.875rem}.w-4{width:1rem}.w-5{width:1.25rem}.w-52{width:13rem}.w-6{width:1.5rem}.w-8{width:2rem}.w-\[280px\]{width:280px}.w-auto{width:auto}.w-full{width:100%}.min-w-0{min-width:0px}.min-w-\[200px\]{min-width:200px}.min-w-\[36px\]{min-width:36px}.min-w-\[80px\]{min-width:80px}.min-w-max{min-width:-moz-max-content;min-width:max-content}.max-w-2xl{max-width:42rem}.max-w-3xl{max-width:48rem}.max-w-\[1200px\]{max-width:1200px}.max-w-\[120px\]{max-width:120px}.max-w-\[2000px\]{max-width:2000px}.max-w-\[280px\]{max-width:280px}.max-w-\[560px\]{max-width:560px}.max-w-\[600px\]{max-width:600px}.max-w-\[60px\]{max-width:60px}.max-w-\[820px\]{max-width:820px}.max-w-lg{max-width:32rem}.flex-1{flex:1 1 0%}.flex-shrink-0,.shrink-0{flex-shrink:0}.-translate-y-1\/2{--tw-translate-y: -50%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.rotate-180{--tw-rotate: 180deg;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.transform{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}@keyframes pulse{50%{opacity:.5}}.animate-pulse{animation:pulse 2s cubic-bezier(.4,0,.6,1) infinite}@keyframes slideDown{0%{transform:translateY(-20px);opacity:0}to{transform:translateY(0);opacity:1}}.animate-slide-down{animation:slideDown .3s ease-out}.animate-spin{animation:spin 1s linear infinite}.cursor-not-allowed{cursor:not-allowed}.cursor-pointer{cursor:pointer}.touch-manipulation{touch-action:manipulation}.select-none{-webkit-user-select:none;-moz-user-select:none;user-select:none}.resize{resize:both}.list-inside{list-style-position:inside}.list-disc{list-style-type:disc}.appearance-none{-webkit-appearance:none;-moz-appearance:none;appearance:none}.grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.flex-wrap{flex-wrap:wrap}.place-items-center{place-items:center}.items-start{align-items:flex-start}.items-end{align-items:flex-end}.items-baseline{align-items:baseline}.items-stretch{align-items:stretch}.justify-end{justify-content:flex-end}.gap-0\.5{gap:.125rem}.gap-1{gap:.25rem}.gap-1\.5{gap:.375rem}.gap-2{gap:.5rem}.gap-3{gap:.75rem}.gap-4{gap:1rem}.gap-6{gap:1.5rem}.gap-x-3{-moz-column-gap:.75rem;column-gap:.75rem}.gap-x-4{-moz-column-gap:1rem;column-gap:1rem}.gap-y-2{row-gap:.5rem}.space-y-1>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(.25rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.25rem * var(--tw-space-y-reverse))}.space-y-1\.5>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(.375rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.375rem * var(--tw-space-y-reverse))}.space-y-2>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.5rem * var(--tw-space-y-reverse))}.space-y-3>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(.75rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.75rem * var(--tw-space-y-reverse))}.divide-y>:not([hidden])~:not([hidden]){--tw-divide-y-reverse: 0;border-top-width:calc(1px * calc(1 - var(--tw-divide-y-reverse)));border-bottom-width:calc(1px * var(--tw-divide-y-reverse))}.divide-neutral-800\/40>:not([hidden])~:not([hidden]){border-color:#26262666}.overflow-auto{overflow:auto}.overflow-hidden{overflow:hidden}.overflow-visible{overflow:visible}.overflow-x-auto{overflow-x:auto}.overflow-y-auto{overflow-y:auto}.overflow-x-hidden{overflow-x:hidden}.truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.whitespace-nowrap{white-space:nowrap}.whitespace-pre-wrap{white-space:pre-wrap}.break-words{overflow-wrap:break-word}.break-all{word-break:break-all}.rounded{border-radius:.25rem}.rounded-2xl{border-radius:1rem}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:.5rem}.rounded-md{border-radius:.375rem}.rounded-none{border-radius:0}.rounded-sm{border-radius:.125rem}.rounded-xl{border-radius:.75rem}.rounded-t-2xl{border-top-left-radius:1rem;border-top-right-radius:1rem}.border{border-width:1px}.border-0{border-width:0px}.border-2{border-width:2px}.border-b{border-bottom-width:1px}.border-l-2{border-left-width:2px}.border-t{border-top-width:1px}.border-dashed{border-style:dashed}.border-amber-400\/40{border-color:#fbbf2466}.border-amber-500\/20{border-color:#f59e0b33}.border-blue-400\/30{border-color:#60a5fa4d}.border-blue-500\/30{border-color:#3b82f64d}.border-blue-700{--tw-border-opacity: 1;border-color:rgb(29 78 216 / var(--tw-border-opacity, 1))}.border-cyan-400\/80{border-color:#22d3eecc}.border-emerald-500\/20{border-color:#10b98133}.border-fuchsia-400\/70{border-color:#e879f9b3}.border-fuchsia-500\/20{border-color:#d946ef33}.border-fuchsia-500\/40{border-color:#d946ef66}.border-gray-700{--tw-border-opacity: 1;border-color:rgb(55 65 81 / var(--tw-border-opacity, 1))}.border-green-400\/30{border-color:#4ade804d}.border-green-500{--tw-border-opacity: 1;border-color:rgb(34 197 94 / var(--tw-border-opacity, 1))}.border-green-500\/30{border-color:#22c55e4d}.border-green-500\/40{border-color:#22c55e66}.border-neutral-500{--tw-border-opacity: 1;border-color:rgb(115 115 115 / var(--tw-border-opacity, 1))}.border-neutral-700\/30{border-color:#4040404d}.border-neutral-700\/40{border-color:#40404066}.border-neutral-700\/50{border-color:#40404080}.border-neutral-700\/60{border-color:#40404099}.border-neutral-800{--tw-border-opacity: 1;border-color:rgb(38 38 38 / var(--tw-border-opacity, 1))}.border-neutral-800\/30{border-color:#2626264d}.border-neutral-800\/40{border-color:#26262666}.border-neutral-800\/50{border-color:#26262680}.border-neutral-800\/60{border-color:#26262699}.border-neutral-800\/70{border-color:#262626b3}.border-purple-400{--tw-border-opacity: 1;border-color:rgb(192 132 252 / var(--tw-border-opacity, 1))}.border-purple-500\/20{border-color:#a855f733}.border-purple-500\/25{border-color:#a855f740}.border-purple-500\/30{border-color:#a855f74d}.border-purple-500\/40{border-color:#a855f766}.border-red-400\/30{border-color:#f871714d}.border-red-500\/30{border-color:#ef44444d}.border-red-500\/40{border-color:#ef444466}.border-sky-500\/20{border-color:#0ea5e933}.border-transparent{border-color:transparent}.border-white\/\[0\.06\]{border-color:#ffffff0f}.border-yellow-500\/30{border-color:#eab3084d}.border-yellow-500\/40{border-color:#eab30866}.border-t-transparent{border-top-color:transparent}.bg-amber-500\/10{background-color:#f59e0b1a}.bg-black{--tw-bg-opacity: 1;background-color:rgb(0 0 0 / var(--tw-bg-opacity, 1))}.bg-black\/10{background-color:#0000001a}.bg-black\/40{background-color:#0006}.bg-black\/55{background-color:#0000008c}.bg-black\/60{background-color:#0009}.bg-black\/70{background-color:#000000b3}.bg-black\/90{background-color:#000000e6}.bg-blue-500\/10{background-color:#3b82f61a}.bg-blue-500\/90{background-color:#3b82f6e6}.bg-blue-900{--tw-bg-opacity: 1;background-color:rgb(30 58 138 / var(--tw-bg-opacity, 1))}.bg-cyan-400{--tw-bg-opacity: 1;background-color:rgb(34 211 238 / var(--tw-bg-opacity, 1))}.bg-cyan-500\/10{background-color:#06b6d41a}.bg-emerald-500{--tw-bg-opacity: 1;background-color:rgb(16 185 129 / var(--tw-bg-opacity, 1))}.bg-fuchsia-500\/10{background-color:#d946ef1a}.bg-gray-600{--tw-bg-opacity: 1;background-color:rgb(75 85 99 / var(--tw-bg-opacity, 1))}.bg-gray-700{--tw-bg-opacity: 1;background-color:rgb(55 65 81 / var(--tw-bg-opacity, 1))}.bg-gray-800{--tw-bg-opacity: 1;background-color:rgb(31 41 55 / var(--tw-bg-opacity, 1))}.bg-green-500{--tw-bg-opacity: 1;background-color:rgb(34 197 94 / var(--tw-bg-opacity, 1))}.bg-green-500\/10{background-color:#22c55e1a}.bg-green-500\/20{background-color:#22c55e33}.bg-green-500\/80{background-color:#22c55ecc}.bg-green-500\/90{background-color:#22c55ee6}.bg-green-600{--tw-bg-opacity: 1;background-color:rgb(22 163 74 / var(--tw-bg-opacity, 1))}.bg-green-900{--tw-bg-opacity: 1;background-color:rgb(20 83 45 / var(--tw-bg-opacity, 1))}.bg-neutral-700{--tw-bg-opacity: 1;background-color:rgb(64 64 64 / var(--tw-bg-opacity, 1))}.bg-neutral-800{--tw-bg-opacity: 1;background-color:rgb(38 38 38 / var(--tw-bg-opacity, 1))}.bg-neutral-800\/40{background-color:#26262666}.bg-neutral-800\/50{background-color:#26262680}.bg-neutral-800\/60{background-color:#26262699}.bg-neutral-800\/70{background-color:#262626b3}.bg-neutral-900{--tw-bg-opacity: 1;background-color:rgb(23 23 23 / var(--tw-bg-opacity, 1))}.bg-neutral-900\/30{background-color:#1717174d}.bg-neutral-900\/40{background-color:#17171766}.bg-neutral-900\/50{background-color:#17171780}.bg-neutral-900\/60{background-color:#17171799}.bg-neutral-900\/95{background-color:#171717f2}.bg-neutral-950{--tw-bg-opacity: 1;background-color:rgb(10 10 10 / var(--tw-bg-opacity, 1))}.bg-neutral-950\/20{background-color:#0a0a0a33}.bg-neutral-950\/30{background-color:#0a0a0a4d}.bg-neutral-950\/40{background-color:#0a0a0a66}.bg-neutral-950\/50{background-color:#0a0a0a80}.bg-neutral-950\/60{background-color:#0a0a0a99}.bg-neutral-950\/70{background-color:#0a0a0ab3}.bg-neutral-950\/80{background-color:#0a0a0acc}.bg-neutral-950\/95{background-color:#0a0a0af2}.bg-orange-600{--tw-bg-opacity: 1;background-color:rgb(234 88 12 / var(--tw-bg-opacity, 1))}.bg-purple-400{--tw-bg-opacity: 1;background-color:rgb(192 132 252 / var(--tw-bg-opacity, 1))}.bg-purple-500{--tw-bg-opacity: 1;background-color:rgb(168 85 247 / var(--tw-bg-opacity, 1))}.bg-purple-500\/10{background-color:#a855f71a}.bg-purple-500\/15{background-color:#a855f726}.bg-purple-500\/20{background-color:#a855f733}.bg-purple-600{--tw-bg-opacity: 1;background-color:rgb(147 51 234 / var(--tw-bg-opacity, 1))}.bg-purple-600\/30{background-color:#9333ea4d}.bg-red-500\/10{background-color:#ef44441a}.bg-red-500\/90{background-color:#ef4444e6}.bg-white{--tw-bg-opacity: 1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.bg-white\/\[0\.04\]{background-color:#ffffff0a}.bg-yellow-500\/10{background-color:#eab3081a}.bg-yellow-500\/20{background-color:#eab30833}.bg-opacity-30{--tw-bg-opacity: .3}.bg-opacity-50{--tw-bg-opacity: .5}.bg-gradient-to-b{background-image:linear-gradient(to bottom,var(--tw-gradient-stops))}.bg-gradient-to-br{background-image:linear-gradient(to bottom right,var(--tw-gradient-stops))}.bg-gradient-to-r{background-image:linear-gradient(to right,var(--tw-gradient-stops))}.from-amber-500\/15{--tw-gradient-from: rgb(245 158 11 / .15) var(--tw-gradient-from-position);--tw-gradient-to: rgb(245 158 11 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.from-black\/0{--tw-gradient-from: rgb(0 0 0 / 0) var(--tw-gradient-from-position);--tw-gradient-to: rgb(0 0 0 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.from-blue-500{--tw-gradient-from: #3b82f6 var(--tw-gradient-from-position);--tw-gradient-to: rgb(59 130 246 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.from-emerald-500\/15{--tw-gradient-from: rgb(16 185 129 / .15) var(--tw-gradient-from-position);--tw-gradient-to: rgb(16 185 129 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.from-fuchsia-500\/15{--tw-gradient-from: rgb(217 70 239 / .15) var(--tw-gradient-from-position);--tw-gradient-to: rgb(217 70 239 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.from-neutral-900{--tw-gradient-from: #171717 var(--tw-gradient-from-position);--tw-gradient-to: rgb(23 23 23 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.from-neutral-900\/60{--tw-gradient-from: rgb(23 23 23 / .6) var(--tw-gradient-from-position);--tw-gradient-to: rgb(23 23 23 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.from-neutral-900\/80{--tw-gradient-from: rgb(23 23 23 / .8) var(--tw-gradient-from-position);--tw-gradient-to: rgb(23 23 23 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.from-neutral-900\/95{--tw-gradient-from: rgb(23 23 23 / .95) var(--tw-gradient-from-position);--tw-gradient-to: rgb(23 23 23 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.from-purple-300{--tw-gradient-from: #d8b4fe var(--tw-gradient-from-position);--tw-gradient-to: rgb(216 180 254 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.from-purple-500{--tw-gradient-from: #a855f7 var(--tw-gradient-from-position);--tw-gradient-to: rgb(168 85 247 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.from-purple-500\/15{--tw-gradient-from: rgb(168 85 247 / .15) var(--tw-gradient-from-position);--tw-gradient-to: rgb(168 85 247 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.from-sky-500\/15{--tw-gradient-from: rgb(14 165 233 / .15) var(--tw-gradient-from-position);--tw-gradient-to: rgb(14 165 233 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.via-black\/0{--tw-gradient-to: rgb(0 0 0 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), rgb(0 0 0 / 0) var(--tw-gradient-via-position), var(--tw-gradient-to)}.via-purple-400{--tw-gradient-to: rgb(192 132 252 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), #c084fc var(--tw-gradient-via-position), var(--tw-gradient-to)}.to-black\/35{--tw-gradient-to: rgb(0 0 0 / .35) var(--tw-gradient-to-position)}.to-black\/45{--tw-gradient-to: rgb(0 0 0 / .45) var(--tw-gradient-to-position)}.to-cyan-500\/5{--tw-gradient-to: rgb(6 182 212 / .05) var(--tw-gradient-to-position)}.to-neutral-900\/50{--tw-gradient-to: rgb(23 23 23 / .5) var(--tw-gradient-to-position)}.to-neutral-900\/80{--tw-gradient-to: rgb(23 23 23 / .8) var(--tw-gradient-to-position)}.to-neutral-950{--tw-gradient-to: #0a0a0a var(--tw-gradient-to-position)}.to-neutral-950\/80{--tw-gradient-to: rgb(10 10 10 / .8) var(--tw-gradient-to-position)}.to-orange-500\/5{--tw-gradient-to: rgb(249 115 22 / .05) var(--tw-gradient-to-position)}.to-pink-500{--tw-gradient-to: #ec4899 var(--tw-gradient-to-position)}.to-pink-500\/5{--tw-gradient-to: rgb(236 72 153 / .05) var(--tw-gradient-to-position)}.to-purple-500{--tw-gradient-to: #a855f7 var(--tw-gradient-to-position)}.to-purple-600\/5{--tw-gradient-to: rgb(147 51 234 / .05) var(--tw-gradient-to-position)}.to-teal-500\/5{--tw-gradient-to: rgb(20 184 166 / .05) var(--tw-gradient-to-position)}.bg-clip-text{-webkit-background-clip:text;background-clip:text}.object-cover{-o-object-fit:cover;object-fit:cover}.p-0{padding:0}.p-1{padding:.25rem}.p-1\.5{padding:.375rem}.p-2{padding:.5rem}.p-2\.5{padding:.625rem}.p-3{padding:.75rem}.p-4{padding:1rem}.p-5{padding:1.25rem}.px-1{padding-left:.25rem;padding-right:.25rem}.px-1\.5{padding-left:.375rem;padding-right:.375rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-2\.5{padding-left:.625rem;padding-right:.625rem}.px-3{padding-left:.75rem;padding-right:.75rem}.px-4{padding-left:1rem;padding-right:1rem}.px-5{padding-left:1.25rem;padding-right:1.25rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.py-0\.5{padding-top:.125rem;padding-bottom:.125rem}.py-1{padding-top:.25rem;padding-bottom:.25rem}.py-1\.5{padding-top:.375rem;padding-bottom:.375rem}.py-12{padding-top:3rem;padding-bottom:3rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.py-2\.5{padding-top:.625rem;padding-bottom:.625rem}.py-3{padding-top:.75rem;padding-bottom:.75rem}.py-3\.5{padding-top:.875rem;padding-bottom:.875rem}.py-4{padding-top:1rem;padding-bottom:1rem}.py-5{padding-top:1.25rem;padding-bottom:1.25rem}.py-8{padding-top:2rem;padding-bottom:2rem}.pb-0{padding-bottom:0}.pb-1{padding-bottom:.25rem}.pb-2{padding-bottom:.5rem}.pb-3{padding-bottom:.75rem}.pb-4{padding-bottom:1rem}.pl-10{padding-left:2.5rem}.pl-7{padding-left:1.75rem}.pr-2{padding-right:.5rem}.pr-3{padding-right:.75rem}.pr-9{padding-right:2.25rem}.pt-1\.5{padding-top:.375rem}.pt-2{padding-top:.5rem}.pt-3{padding-top:.75rem}.pt-4{padding-top:1rem}.text-left{text-align:left}.text-right{text-align:right}.font-mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-\[10px\]{font-size:10px}.text-\[11px\]{font-size:11px}.text-\[12px\]{font-size:12px}.text-\[13px\]{font-size:13px}.text-\[15px\]{font-size:15px}.text-\[9px\]{font-size:9px}.text-base{font-size:1rem;line-height:1.5rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-xs{font-size:.75rem;line-height:1rem}.font-bold{font-weight:700}.font-extrabold{font-weight:800}.font-medium{font-weight:500}.font-normal{font-weight:400}.font-semibold{font-weight:600}.uppercase{text-transform:uppercase}.italic{font-style:italic}.ordinal{--tw-ordinal: ordinal;font-variant-numeric:var(--tw-ordinal) var(--tw-slashed-zero) var(--tw-numeric-figure) var(--tw-numeric-spacing) var(--tw-numeric-fraction)}.tabular-nums{--tw-numeric-spacing: tabular-nums;font-variant-numeric:var(--tw-ordinal) var(--tw-slashed-zero) var(--tw-numeric-figure) var(--tw-numeric-spacing) var(--tw-numeric-fraction)}.leading-none{line-height:1}.leading-relaxed{line-height:1.625}.leading-snug{line-height:1.375}.tracking-tight{letter-spacing:-.025em}.tracking-wide{letter-spacing:.025em}.tracking-wider{letter-spacing:.05em}.tracking-widest{letter-spacing:.1em}.text-amber-200{--tw-text-opacity: 1;color:rgb(253 230 138 / var(--tw-text-opacity, 1))}.text-amber-200\/90{color:#fde68ae6}.text-amber-300{--tw-text-opacity: 1;color:rgb(252 211 77 / var(--tw-text-opacity, 1))}.text-amber-300\/90{color:#fcd34de6}.text-amber-400{--tw-text-opacity: 1;color:rgb(251 191 36 / var(--tw-text-opacity, 1))}.text-blue-100{--tw-text-opacity: 1;color:rgb(219 234 254 / var(--tw-text-opacity, 1))}.text-blue-200{--tw-text-opacity: 1;color:rgb(191 219 254 / var(--tw-text-opacity, 1))}.text-blue-300{--tw-text-opacity: 1;color:rgb(147 197 253 / var(--tw-text-opacity, 1))}.text-blue-400{--tw-text-opacity: 1;color:rgb(96 165 250 / var(--tw-text-opacity, 1))}.text-cyan-200{--tw-text-opacity: 1;color:rgb(165 243 252 / var(--tw-text-opacity, 1))}.text-emerald-400{--tw-text-opacity: 1;color:rgb(52 211 153 / var(--tw-text-opacity, 1))}.text-fuchsia-100{--tw-text-opacity: 1;color:rgb(250 232 255 / var(--tw-text-opacity, 1))}.text-fuchsia-200{--tw-text-opacity: 1;color:rgb(245 208 254 / var(--tw-text-opacity, 1))}.text-fuchsia-400{--tw-text-opacity: 1;color:rgb(232 121 249 / var(--tw-text-opacity, 1))}.text-gray-300{--tw-text-opacity: 1;color:rgb(209 213 219 / var(--tw-text-opacity, 1))}.text-gray-400{--tw-text-opacity: 1;color:rgb(156 163 175 / var(--tw-text-opacity, 1))}.text-green-200{--tw-text-opacity: 1;color:rgb(187 247 208 / var(--tw-text-opacity, 1))}.text-green-300{--tw-text-opacity: 1;color:rgb(134 239 172 / var(--tw-text-opacity, 1))}.text-green-400{--tw-text-opacity: 1;color:rgb(74 222 128 / var(--tw-text-opacity, 1))}.text-green-400\/70{color:#4ade80b3}.text-neutral-100{--tw-text-opacity: 1;color:rgb(245 245 245 / var(--tw-text-opacity, 1))}.text-neutral-200{--tw-text-opacity: 1;color:rgb(229 229 229 / var(--tw-text-opacity, 1))}.text-neutral-300{--tw-text-opacity: 1;color:rgb(212 212 212 / var(--tw-text-opacity, 1))}.text-neutral-400{--tw-text-opacity: 1;color:rgb(163 163 163 / var(--tw-text-opacity, 1))}.text-neutral-500{--tw-text-opacity: 1;color:rgb(115 115 115 / var(--tw-text-opacity, 1))}.text-neutral-600{--tw-text-opacity: 1;color:rgb(82 82 82 / var(--tw-text-opacity, 1))}.text-neutral-700{--tw-text-opacity: 1;color:rgb(64 64 64 / var(--tw-text-opacity, 1))}.text-neutral-950{--tw-text-opacity: 1;color:rgb(10 10 10 / var(--tw-text-opacity, 1))}.text-orange-400{--tw-text-opacity: 1;color:rgb(251 146 60 / var(--tw-text-opacity, 1))}.text-purple-200{--tw-text-opacity: 1;color:rgb(233 213 255 / var(--tw-text-opacity, 1))}.text-purple-300{--tw-text-opacity: 1;color:rgb(216 180 254 / var(--tw-text-opacity, 1))}.text-purple-400{--tw-text-opacity: 1;color:rgb(192 132 252 / var(--tw-text-opacity, 1))}.text-purple-50{--tw-text-opacity: 1;color:rgb(250 245 255 / var(--tw-text-opacity, 1))}.text-red-300{--tw-text-opacity: 1;color:rgb(252 165 165 / var(--tw-text-opacity, 1))}.text-red-400{--tw-text-opacity: 1;color:rgb(248 113 113 / var(--tw-text-opacity, 1))}.text-sky-400{--tw-text-opacity: 1;color:rgb(56 189 248 / var(--tw-text-opacity, 1))}.text-transparent{color:transparent}.text-white{--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.text-white\/70{color:#ffffffb3}.text-yellow-300{--tw-text-opacity: 1;color:rgb(253 224 71 / var(--tw-text-opacity, 1))}.text-yellow-300\/80{color:#fde047cc}.text-yellow-300\/90{color:#fde047e6}.text-yellow-400{--tw-text-opacity: 1;color:rgb(250 204 21 / var(--tw-text-opacity, 1))}.underline{text-decoration-line:underline}.underline-offset-2{text-underline-offset:2px}.accent-fuchsia-500{accent-color:#d946ef}.accent-purple-500{accent-color:#a855f7}.opacity-0{opacity:0}.opacity-25{opacity:.25}.opacity-70{opacity:.7}.opacity-75{opacity:.75}.opacity-80{opacity:.8}.shadow-2xl{--tw-shadow: 0 25px 50px -12px rgb(0 0 0 / .25);--tw-shadow-colored: 0 25px 50px -12px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-\[0_0_0_1px_rgba\(16\,185\,129\,0\.35\)\,0_10px_30px_rgba\(16\,185\,129\,0\.15\)\]{--tw-shadow: 0 0 0 1px rgba(16,185,129,.35),0 10px 30px rgba(16,185,129,.15);--tw-shadow-colored: 0 0 0 1px var(--tw-shadow-color), 0 10px 30px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-\[0_0_0_1px_rgba\(59\,130\,246\,0\.10\)\,0_0_18px_rgba\(59\,130\,246\,0\.06\)\]{--tw-shadow: 0 0 0 1px rgba(59,130,246,.1),0 0 18px rgba(59,130,246,.06);--tw-shadow-colored: 0 0 0 1px var(--tw-shadow-color), 0 0 18px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-\[0_0_0_1px_rgba\(59\,130\,246\,0\.10\)\,0_0_22px_rgba\(59\,130\,246\,0\.08\)\]{--tw-shadow: 0 0 0 1px rgba(59,130,246,.1),0 0 22px rgba(59,130,246,.08);--tw-shadow-colored: 0 0 0 1px var(--tw-shadow-color), 0 0 22px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-\[0_0_0_1px_rgba\(59\,130\,246\,0\.15\)\,0_0_30px_rgba\(59\,130\,246\,0\.10\)\]{--tw-shadow: 0 0 0 1px rgba(59,130,246,.15),0 0 30px rgba(59,130,246,.1);--tw-shadow-colored: 0 0 0 1px var(--tw-shadow-color), 0 0 30px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-\[0_0_12px_rgba\(34\,211\,238\,0\.45\)\]{--tw-shadow: 0 0 12px rgba(34,211,238,.45);--tw-shadow-colored: 0 0 12px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-\[0_0_6px_rgba\(168\,85\,247\,0\.4\)\]{--tw-shadow: 0 0 6px rgba(168,85,247,.4);--tw-shadow-colored: 0 0 6px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-\[0_8px_30px_rgba\(0\,0\,0\,0\.35\)\]{--tw-shadow: 0 8px 30px rgba(0,0,0,.35);--tw-shadow-colored: 0 8px 30px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-\[inset_0_1px_0_rgba\(168\,85\,247\,0\.1\)\]{--tw-shadow: inset 0 1px 0 rgba(168,85,247,.1);--tw-shadow-colored: inset 0 1px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-lg{--tw-shadow: 0 10px 15px -3px rgb(0 0 0 / .1), 0 4px 6px -4px rgb(0 0 0 / .1);--tw-shadow-colored: 0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-purple-500\/30{--tw-shadow-color: rgb(168 85 247 / .3);--tw-shadow: var(--tw-shadow-colored)}.outline-none{outline:2px solid transparent;outline-offset:2px}.ring-1{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.ring-amber-500\/15{--tw-ring-color: rgb(245 158 11 / .15)}.ring-neutral-700\/40{--tw-ring-color: rgb(64 64 64 / .4)}.ring-neutral-800\/70{--tw-ring-color: rgb(38 38 38 / .7)}.ring-neutral-900\/60{--tw-ring-color: rgb(23 23 23 / .6)}.ring-purple-500\/50{--tw-ring-color: rgb(168 85 247 / .5)}.ring-white\/10{--tw-ring-color: rgb(255 255 255 / .1)}.ring-white\/\[0\.04\]{--tw-ring-color: rgb(255 255 255 / .04)}.ring-white\/\[0\.06\]{--tw-ring-color: rgb(255 255 255 / .06)}.blur{--tw-blur: blur(8px);filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.drop-shadow-\[0_0_10px_rgba\(251\,191\,36\,0\.10\)\]{--tw-drop-shadow: drop-shadow(0 0 10px rgba(251,191,36,.1));filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.drop-shadow-\[0_0_10px_rgba\(251\,191\,36\,0\.15\)\]{--tw-drop-shadow: drop-shadow(0 0 10px rgba(251,191,36,.15));filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.drop-shadow-\[0_0_10px_rgba\(251\,191\,36\,0\.18\)\]{--tw-drop-shadow: drop-shadow(0 0 10px rgba(251,191,36,.18));filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.drop-shadow-lg{--tw-drop-shadow: drop-shadow(0 10px 8px rgb(0 0 0 / .04)) drop-shadow(0 4px 3px rgb(0 0 0 / .1));filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.backdrop-blur{--tw-backdrop-blur: blur(8px);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.backdrop-blur-md{--tw-backdrop-blur: blur(12px);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.backdrop-blur-sm{--tw-backdrop-blur: blur(4px);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.backdrop-blur-xl{--tw-backdrop-blur: blur(24px);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.transition{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-all{transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-colors{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-transform{transition-property:transform;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.duration-150{transition-duration:.15s}.duration-200{transition-duration:.2s}.duration-300{transition-duration:.3s}.ease-out{transition-timing-function:cubic-bezier(0,0,.2,1)}:root{--bgPrimary: #0a0118;--bgSecondary: #1a0b2e;--bgCard: #1a0b2e;--bgElevated: #2d1b4e;--bgHover: #3d2b5e;--inputBg: var(--bgSecondary);--inputBorder: var(--borderMedium);--inputFocus: var(--borderActive);--textPrimary: #f1f5f9;--textSecondary: #e2e8f0;--textMuted: #94a3b8;--textDisabled: #64748b;--accentPurple: #a855f7;--accentPink: var(--accentPurple);--accentBlue: #3b82f6;--accentCyan: #06b6d4;--accentAmber: #f59e0b;--accentRed: #ef4444;--accentGreen: #22c55e;--borderSubtle: rgba(168, 85, 247, .1);--borderMedium: rgba(168, 85, 247, .2);--borderBright: rgba(168, 85, 247, .4);--borderActive: #a855f7;--gradientPurplePink: linear-gradient(135deg, var(--accentPurple) 0%, var(--accentPurple) 100%);--gradientSecondary: linear-gradient(135deg, #2d1b4e 0%, #1a0b2e 100%);--gradientCardBg: linear-gradient(135deg, rgba(45, 27, 78, .8), rgba(26, 11, 46, .6));--gradientHover: linear-gradient(135deg, var(--accentPurple) 0%, var(--accentPurple) 100%);--shadowSm: 0 1px 2px 0 rgba(0, 0, 0, .5);--shadowMd: 0 4px 6px -1px rgba(0, 0, 0, .5);--shadowLg: 0 10px 15px -3px rgba(0, 0, 0, .5);--shadowXl: 0 20px 25px -5px rgba(0, 0, 0, .5);--shadowPurple: 0 10px 15px -3px rgba(168, 85, 247, .3);--glowPurple: 0 0 20px rgba(168, 85, 247, .5);--shadowPink: var(--shadowPurple);--glowPink: var(--glowPurple);--fontFamily-sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;--fontFamily-mono: "SF Mono", Monaco, "Cascadia Code", "Roboto Mono", Consolas, "Courier New", monospace;--fontSize-xs: .75rem;--fontSize-sm: .875rem;--fontSize-base: 1rem;--fontSize-lg: 1.125rem;--fontSize-xl: 1.25rem;--fontSize-2xl: 1.5rem;--fontSize-3xl: 1.875rem;--fontSize-4xl: 2.25rem;--fontWeight-normal: 400;--fontWeight-medium: 500;--fontWeight-semibold: 600;--fontWeight-bold: 700;--spacing-xs: .25rem;--spacing-sm: .5rem;--spacing-md: 1rem;--spacing-lg: 1.5rem;--spacing-xl: 2rem;--spacing-xxl: 3rem;--radius-sm: .25rem;--radius-md: .5rem;--radius-lg: .75rem;--radius-xl: 1rem;--radius-xxl: 1.5rem;--radius-round: 9999px;--transition-fast: all .15s ease;--transition-normal: all .3s ease;--transition-slow: all .5s ease}.inscription-container{background:var(--bgPrimary);color:var(--textPrimary);min-height:100vh;min-height:100dvh;padding:var(--spacing-xl);font-family:var(--fontFamily-sans);overflow-x:hidden;width:100%;max-width:100vw}@media (max-width: 640px){.inscription-container{padding:var(--spacing-sm)}}.inscription-section{margin-bottom:var(--spacing-xxl)}.inscription-card{background:var(--gradientCardBg);border:1px solid var(--borderMedium);border-radius:var(--radius-xl);padding:var(--spacing-xl);box-shadow:var(--shadowPurple);transition:var(--transition-normal)}.inscription-card:hover{border-color:var(--borderBright);box-shadow:var(--glowPurple);transform:translateY(-2px)}.content-editor.inscription-card{padding:0}.content-editor-body{display:flex;gap:var(--spacing-md);height:100%;min-height:0}.content-editor-workspace{flex:1;min-width:0;display:flex;flex-direction:column;gap:var(--spacing-md);min-height:0;overflow:hidden}.content-editor-workspace>.fade-in{flex:1;min-height:0;display:flex;flex-direction:column}.content-editor-workspace textarea{flex:1}.content-fee-panel{flex:0 0 25%;min-width:240px;max-width:none;display:flex;flex-direction:column;min-height:0}.content-fee-panel>*{flex:1;min-height:0}@media (max-width: 1024px){.content-editor-body{flex-direction:column}.content-fee-panel{flex:1 1 auto;max-width:none;min-width:0}}.content-editor-header{align-items:center;gap:var(--spacing-lg);flex-wrap:wrap}.content-editor-header.inscription-card-header{border-bottom:none;padding-bottom:0;margin-bottom:var(--spacing-md)}.content-editor-header-main{display:flex;align-items:center;gap:var(--spacing-lg);flex:1;min-width:0;flex-wrap:wrap}.content-editor-tabs{display:flex;gap:4px;padding:4px;align-items:flex-end;border-bottom:1px solid var(--borderMedium);border-radius:var(--radius-md) var(--radius-md) 0 0;max-width:100%;overflow-x:auto;-webkit-overflow-scrolling:touch;flex-wrap:nowrap}.content-editor-tabs .tab-button{white-space:nowrap;flex-shrink:0;min-height:36px;padding:6px 10px;font-size:12px}@media (max-width: 640px){.content-editor-tabs{gap:2px;padding:2px}.content-editor-tabs .tab-button{padding:5px 6px!important;font-size:11px!important}}.inscription-card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--spacing-lg);padding-bottom:var(--spacing-md);border-bottom:1px solid var(--borderSubtle)}.inscription-card-title{font-size:var(--fontSize-xl);font-weight:var(--fontWeight-semibold);color:var(--textPrimary);display:flex;align-items:center;gap:var(--spacing-sm)}.inscription-card-body{color:var(--textSecondary)}.mode-badge{background:var(--gradientPurplePink);color:#fff;padding:var(--spacing-sm) var(--spacing-lg);border-radius:var(--radius-round);font-weight:var(--fontWeight-semibold);font-size:var(--fontSize-sm);display:inline-flex;align-items:center;gap:var(--spacing-sm);box-shadow:var(--shadowPink);transition:var(--transition-normal)}.mode-badge:hover{box-shadow:var(--glowPink);transform:scale(1.05)}.mode-badge-large{padding:var(--spacing-md) var(--spacing-xl);font-size:var(--fontSize-base);border-radius:var(--radius-xxl)}.inscription-preview{background:var(--bgSecondary);border:2px solid var(--borderMedium);border-radius:var(--radius-lg);padding:var(--spacing-lg);overflow:hidden;transition:var(--transition-normal);cursor:pointer;position:relative}.inscription-preview:hover{border-color:var(--borderBright);box-shadow:var(--shadowPurple);transform:translateY(-2px)}.inscription-preview.selected{border-color:var(--accentPurple);box-shadow:var(--glowPurple);background:#a855f71a}.inscription-preview-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--spacing-md);padding-bottom:var(--spacing-sm);border-bottom:1px solid var(--borderSubtle)}.inscription-preview-content{max-height:300px;overflow:auto;margin-bottom:var(--spacing-md);border-radius:var(--radius-md);background:var(--bgPrimary);padding:var(--spacing-md)}.inscription-preview-meta{display:flex;flex-direction:column;gap:var(--spacing-sm);font-size:var(--fontSize-sm);color:var(--textMuted)}.meta-item{display:flex;gap:var(--spacing-xs);align-items:baseline}.meta-label{color:var(--textMuted);font-weight:var(--fontWeight-medium)}.meta-value{color:var(--textSecondary);font-family:var(--fontFamily-mono)}.inscription-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px;margin-top:var(--spacing-lg);width:100%}@media (max-width: 768px){.inscription-grid{grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:8px}}@media (max-width: 480px){.inscription-grid{grid-template-columns:repeat(2,1fr);gap:6px}}.btn-primary-purple{background:var(--gradientButton);color:#fff;border:none;padding:var(--spacing-md) var(--spacing-xl);border-radius:var(--radius-md);font-weight:var(--fontWeight-semibold);font-size:var(--fontSize-base);cursor:pointer;transition:var(--transition-normal);box-shadow:var(--shadowPurple);display:inline-flex;align-items:center;gap:var(--spacing-sm)}.btn-primary-purple:hover{background:var(--gradientButtonHover);box-shadow:var(--glowPurple);transform:translateY(-2px)}.btn-primary-purple:active{transform:translateY(0)}.btn-primary-purple:disabled{opacity:.5;cursor:not-allowed;transform:none}.btn-secondary{background:var(--bgTertiary);color:var(--textPrimary);border:1px solid var(--borderMedium);padding:var(--spacing-md) var(--spacing-xl);border-radius:var(--radius-md);font-weight:var(--fontWeight-medium);font-size:var(--fontSize-base);cursor:pointer;transition:var(--transition-normal)}.btn-secondary:hover{border-color:var(--borderBright);background:var(--bgQuaternary)}.btn-icon{background:transparent;border:none;color:var(--textSecondary);cursor:pointer;padding:var(--spacing-sm);border-radius:var(--radius-md);transition:var(--transition-fast);display:inline-flex;align-items:center;justify-content:center}.btn-icon:hover{color:var(--textPrimary);background:var(--bgTertiary)}.step-indicator{display:flex;gap:var(--spacing-md);padding:var(--spacing-lg);background:var(--bgSecondary);border-radius:var(--radius-lg);margin-bottom:var(--spacing-xl)}.step-item{flex:1;text-align:center;padding:var(--spacing-lg);border-radius:var(--radius-md);background:var(--bgTertiary);border:2px solid var(--borderSubtle);transition:var(--transition-normal);cursor:pointer}.step-item.active{background:var(--gradientPurpleDeep);border-color:var(--accentPurple);box-shadow:var(--shadowPurple)}.step-item.completed{border-color:var(--accentCyan);background:#06b6d41a}.step-emoji{font-size:var(--fontSize-3xl);display:block;margin-bottom:var(--spacing-sm)}.step-title{font-weight:var(--fontWeight-semibold);color:var(--textPrimary);margin-bottom:var(--spacing-xs)}.step-description{font-size:var(--fontSize-sm);color:var(--textMuted)}.validation-warning{background:var(--warningBg);border:1px solid var(--accentAmber);border-radius:var(--radius-md);padding:var(--spacing-md);color:var(--accentAmber);margin:var(--spacing-sm) 0;display:flex;align-items:flex-start;gap:var(--spacing-sm)}.validation-error{background:var(--errorBg);border:1px solid var(--accentRed);border-radius:var(--radius-md);padding:var(--spacing-md);color:var(--accentRed);margin:var(--spacing-sm) 0;display:flex;align-items:flex-start;gap:var(--spacing-sm)}.validation-success{background:var(--successBg);border:1px solid var(--accentGreen);border-radius:var(--radius-md);padding:var(--spacing-md);color:var(--accentGreen);margin:var(--spacing-sm) 0;display:flex;align-items:flex-start;gap:var(--spacing-sm)}.validation-info{background:var(--infoBg);border:1px solid var(--accentCyan);border-radius:var(--radius-md);padding:var(--spacing-md);color:var(--accentCyan);margin:var(--spacing-sm) 0;display:flex;align-items:flex-start;gap:var(--spacing-sm)}.form-label{display:block;margin-bottom:var(--spacing-sm);font-weight:var(--fontWeight-medium);color:var(--textPrimary);font-size:var(--fontSize-sm)}.form-input{width:100%;background:var(--inputBg);border:1px solid var(--inputBorder);border-radius:var(--radius-md);padding:var(--spacing-md);color:var(--textPrimary);font-size:var(--fontSize-base);font-family:var(--fontFamily-mono);transition:var(--transition-fast)}.form-input:focus{outline:none;border-color:var(--inputFocus);box-shadow:0 0 0 3px #a855f733}.form-input::-moz-placeholder{color:var(--textMuted)}.form-input::placeholder{color:var(--textMuted)}.form-textarea{min-height:120px;resize:vertical;font-family:var(--fontFamily-mono)}.form-select{width:100%;background:var(--inputBg);border:1px solid var(--inputBorder);border-radius:var(--radius-md);padding:var(--spacing-md);color:var(--textPrimary);font-size:var(--fontSize-base);cursor:pointer;transition:var(--transition-fast)}.form-select:focus{outline:none;border-color:var(--inputFocus);box-shadow:0 0 0 3px #a855f733}.feature-chips{display:flex;flex-wrap:wrap;gap:var(--spacing-sm);margin-top:var(--spacing-md)}.feature-chip{background:var(--bgTertiary);border:1px solid var(--borderMedium);border-radius:var(--radius-round);padding:var(--spacing-xs) var(--spacing-md);font-size:var(--fontSize-sm);color:var(--textSecondary);display:inline-flex;align-items:center;gap:var(--spacing-xs);transition:var(--transition-fast)}.feature-chip:hover{border-color:var(--borderBright);background:var(--bgQuaternary)}.feature-chip-active{background:var(--gradientPurpleDeep);border-color:var(--accentPurple);color:var(--textPrimary)}.toggle-switch{display:flex;align-items:center;gap:var(--spacing-md);cursor:pointer;-webkit-user-select:none;-moz-user-select:none;user-select:none}.toggle-track{width:44px;height:24px;background:var(--bgTertiary);border:1px solid var(--borderMedium);border-radius:var(--radius-round);position:relative;transition:var(--transition-fast)}.toggle-track.active{background:var(--gradientPurplePink);border-color:var(--accentPurple)}.toggle-thumb{width:18px;height:18px;background:#fff;border-radius:50%;position:absolute;top:2px;left:2px;transition:var(--transition-fast);box-shadow:0 2px 4px #0003}.toggle-track.active .toggle-thumb{left:22px}.toggle-advanced{background:transparent;border:none;color:var(--accentPurple);font-weight:var(--fontWeight-semibold);cursor:pointer;display:flex;align-items:center;gap:var(--spacing-sm);padding:var(--spacing-md);transition:var(--transition-fast)}.toggle-advanced:hover{color:var(--accentPink)}.advanced-section{margin-top:var(--spacing-lg);padding:var(--spacing-lg);background:var(--bgSecondary);border:1px solid var(--borderMedium);border-radius:var(--radius-lg)}.advanced-section-title{font-weight:var(--fontWeight-semibold);color:var(--textPrimary);margin-bottom:var(--spacing-md);display:flex;align-items:center;gap:var(--spacing-sm)}.fee-breakdown{background:var(--bgSecondary);border:1px solid var(--borderMedium);border-radius:var(--radius-lg);padding:var(--spacing-lg)}.fee-item{display:flex;justify-content:space-between;padding:var(--spacing-sm) 0;color:var(--textSecondary)}.fee-item-label{font-weight:var(--fontWeight-medium)}.fee-item-value{font-family:var(--fontFamily-mono);color:var(--textPrimary)}.fee-divider{border-top:1px solid var(--borderSubtle);margin:var(--spacing-md) 0}.fee-total{font-size:var(--fontSize-lg);font-weight:var(--fontWeight-bold);color:var(--accentPurple)}.tooltip{position:relative;display:inline-block}.tooltip-text{visibility:hidden;background:var(--tooltipBg);color:var(--textPrimary);text-align:center;border-radius:var(--radius-md);padding:var(--spacing-sm) var(--spacing-md);position:absolute;z-index:var(--zIndex-tooltip);bottom:125%;left:50%;transform:translate(-50%);white-space:nowrap;font-size:var(--fontSize-sm);border:1px solid var(--borderMedium);box-shadow:var(--shadowPurple);opacity:0;transition:var(--transition-fast)}.tooltip:hover .tooltip-text{visibility:visible;opacity:1}.spinner{width:40px;height:40px;border:3px solid var(--borderMedium);border-top-color:var(--accentPurple);border-radius:50%;animation:spin .8s linear infinite}.inscription-container ::-webkit-scrollbar{width:10px;height:10px}.inscription-container ::-webkit-scrollbar-track{background:var(--bgSecondary);border-radius:var(--radius-md)}.inscription-container ::-webkit-scrollbar-thumb{background:var(--primaryMedium);border-radius:var(--radius-md)}.inscription-container ::-webkit-scrollbar-thumb:hover{background:var(--primaryLight)}@media (max-width: 768px){.inscription-container{padding:var(--spacing-sm)}.inscription-card{padding:var(--spacing-sm);border-radius:var(--radius-md)}}@media (max-width: 480px){.inscription-container{padding:var(--spacing-xs)}.step-indicator{flex-direction:column;gap:var(--spacing-sm);padding:var(--spacing-sm)}.inscription-card{padding:var(--spacing-xs);border-radius:var(--radius-sm)}.inscription-preview-content{max-height:200px}}@keyframes fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}@keyframes pulse{0%,to{opacity:1}50%{opacity:.5}}.fade-in{animation:fadeIn .3s ease}.pulse{animation:pulse 2s ease-in-out infinite}.placeholder\:text-neutral-500::-moz-placeholder{--tw-text-opacity: 1;color:rgb(115 115 115 / var(--tw-text-opacity, 1))}.placeholder\:text-neutral-500::placeholder{--tw-text-opacity: 1;color:rgb(115 115 115 / var(--tw-text-opacity, 1))}.first\:border-t-0:first-child{border-top-width:0px}.last\:border-b-0:last-child{border-bottom-width:0px}.focus-within\:ring-2:focus-within{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.focus-within\:ring-sky-500\/30:focus-within{--tw-ring-color: rgb(14 165 233 / .3)}.focus-within\:ring-offset-0:focus-within{--tw-ring-offset-width: 0px}.hover\:-translate-y-0\.5:hover{--tw-translate-y: -.125rem;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.hover\:translate-y-\[-1px\]:hover{--tw-translate-y: -1px;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.hover\:scale-\[1\.02\]:hover{--tw-scale-x: 1.02;--tw-scale-y: 1.02;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.hover\:border-neutral-600\/50:hover{border-color:#52525280}.hover\:border-neutral-600\/60:hover{border-color:#52525299}.hover\:border-neutral-700:hover{--tw-border-opacity: 1;border-color:rgb(64 64 64 / var(--tw-border-opacity, 1))}.hover\:border-purple-500\/30:hover{border-color:#a855f74d}.hover\:border-purple-500\/60:hover{border-color:#a855f799}.hover\:border-red-500\/60:hover{border-color:#ef444499}.hover\:border-sky-500\/25:hover{border-color:#0ea5e940}.hover\:border-sky-500\/40:hover{border-color:#0ea5e966}.hover\:border-white\/10:hover{border-color:#ffffff1a}.hover\:bg-blue-500\/10:hover{background-color:#3b82f61a}.hover\:bg-emerald-400:hover{--tw-bg-opacity: 1;background-color:rgb(52 211 153 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-500:hover{--tw-bg-opacity: 1;background-color:rgb(107 114 128 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-600:hover{--tw-bg-opacity: 1;background-color:rgb(75 85 99 / var(--tw-bg-opacity, 1))}.hover\:bg-green-500\/25:hover{background-color:#22c55e40}.hover\:bg-green-700:hover{--tw-bg-opacity: 1;background-color:rgb(21 128 61 / var(--tw-bg-opacity, 1))}.hover\:bg-neutral-700:hover{--tw-bg-opacity: 1;background-color:rgb(64 64 64 / var(--tw-bg-opacity, 1))}.hover\:bg-neutral-700\/50:hover{background-color:#40404080}.hover\:bg-neutral-700\/60:hover{background-color:#40404099}.hover\:bg-neutral-800:hover{--tw-bg-opacity: 1;background-color:rgb(38 38 38 / var(--tw-bg-opacity, 1))}.hover\:bg-neutral-800\/30:hover{background-color:#2626264d}.hover\:bg-neutral-800\/40:hover{background-color:#26262666}.hover\:bg-neutral-800\/60:hover{background-color:#26262699}.hover\:bg-orange-700:hover{--tw-bg-opacity: 1;background-color:rgb(194 65 12 / var(--tw-bg-opacity, 1))}.hover\:bg-purple-500:hover{--tw-bg-opacity: 1;background-color:rgb(168 85 247 / var(--tw-bg-opacity, 1))}.hover\:bg-purple-500\/20:hover{background-color:#a855f733}.hover\:bg-purple-600:hover{--tw-bg-opacity: 1;background-color:rgb(147 51 234 / var(--tw-bg-opacity, 1))}.hover\:bg-purple-600\/40:hover{background-color:#9333ea66}.hover\:bg-red-500\/10:hover{background-color:#ef44441a}.hover\:bg-red-500\/20:hover{background-color:#ef444433}.hover\:from-blue-600:hover{--tw-gradient-from: #2563eb var(--tw-gradient-from-position);--tw-gradient-to: rgb(37 99 235 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.hover\:from-purple-600:hover{--tw-gradient-from: #9333ea var(--tw-gradient-from-position);--tw-gradient-to: rgb(147 51 234 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.hover\:to-pink-600:hover{--tw-gradient-to: #db2777 var(--tw-gradient-to-position)}.hover\:to-purple-600:hover{--tw-gradient-to: #9333ea var(--tw-gradient-to-position)}.hover\:text-blue-300:hover{--tw-text-opacity: 1;color:rgb(147 197 253 / var(--tw-text-opacity, 1))}.hover\:text-neutral-100:hover{--tw-text-opacity: 1;color:rgb(245 245 245 / var(--tw-text-opacity, 1))}.hover\:text-neutral-200:hover{--tw-text-opacity: 1;color:rgb(229 229 229 / var(--tw-text-opacity, 1))}.hover\:text-purple-200:hover{--tw-text-opacity: 1;color:rgb(233 213 255 / var(--tw-text-opacity, 1))}.hover\:text-purple-300:hover{--tw-text-opacity: 1;color:rgb(216 180 254 / var(--tw-text-opacity, 1))}.hover\:text-red-200:hover{--tw-text-opacity: 1;color:rgb(254 202 202 / var(--tw-text-opacity, 1))}.hover\:text-red-300:hover{--tw-text-opacity: 1;color:rgb(252 165 165 / var(--tw-text-opacity, 1))}.hover\:text-sky-100:hover{--tw-text-opacity: 1;color:rgb(224 242 254 / var(--tw-text-opacity, 1))}.hover\:text-sky-200:hover{--tw-text-opacity: 1;color:rgb(186 230 253 / var(--tw-text-opacity, 1))}.hover\:text-sky-300:hover{--tw-text-opacity: 1;color:rgb(125 211 252 / var(--tw-text-opacity, 1))}.hover\:text-white:hover{--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.hover\:shadow-xl:hover{--tw-shadow: 0 20px 25px -5px rgb(0 0 0 / .1), 0 8px 10px -6px rgb(0 0 0 / .1);--tw-shadow-colored: 0 20px 25px -5px var(--tw-shadow-color), 0 8px 10px -6px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.hover\:shadow-blue-500\/50:hover{--tw-shadow-color: rgb(59 130 246 / .5);--tw-shadow: var(--tw-shadow-colored)}.hover\:shadow-purple-500\/50:hover{--tw-shadow-color: rgb(168 85 247 / .5);--tw-shadow: var(--tw-shadow-colored)}.hover\:ring-purple-400\/60:hover{--tw-ring-color: rgb(192 132 252 / .6)}.hover\:ring-sky-500\/25:hover{--tw-ring-color: rgb(14 165 233 / .25)}.focus\:border-fuchsia-500:focus{--tw-border-opacity: 1;border-color:rgb(217 70 239 / var(--tw-border-opacity, 1))}.focus\:border-purple-500\/40:focus{border-color:#a855f766}.focus\:border-purple-500\/60:focus{border-color:#a855f799}.focus\:border-sky-500\/60:focus{border-color:#0ea5e999}.focus\:outline-none:focus{outline:2px solid transparent;outline-offset:2px}.focus\:ring-1:focus{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.focus\:ring-2:focus{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.focus\:ring-fuchsia-500:focus{--tw-ring-opacity: 1;--tw-ring-color: rgb(217 70 239 / var(--tw-ring-opacity, 1))}.focus\:ring-purple-400\/30:focus{--tw-ring-color: rgb(192 132 252 / .3)}.focus\:ring-purple-500\/20:focus{--tw-ring-color: rgb(168 85 247 / .2)}.focus\:ring-sky-500\/20:focus{--tw-ring-color: rgb(14 165 233 / .2)}.focus\:ring-sky-500\/30:focus{--tw-ring-color: rgb(14 165 233 / .3)}.focus-visible\:outline-none:focus-visible{outline:2px solid transparent;outline-offset:2px}.focus-visible\:ring-2:focus-visible{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.focus-visible\:ring-inset:focus-visible{--tw-ring-inset: inset}.focus-visible\:ring-amber-500\/40:focus-visible{--tw-ring-color: rgb(245 158 11 / .4)}.focus-visible\:ring-emerald-500\/40:focus-visible{--tw-ring-color: rgb(16 185 129 / .4)}.focus-visible\:ring-purple-500\/40:focus-visible{--tw-ring-color: rgb(168 85 247 / .4)}.focus-visible\:ring-sky-500\/40:focus-visible{--tw-ring-color: rgb(14 165 233 / .4)}.active\:translate-y-\[1px\]:active{--tw-translate-y: 1px;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.active\:scale-\[0\.97\]:active{--tw-scale-x: .97;--tw-scale-y: .97;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.active\:scale-\[0\.98\]:active{--tw-scale-x: .98;--tw-scale-y: .98;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.active\:bg-neutral-800\/80:active{background-color:#262626cc}.active\:bg-neutral-900\/60:active{background-color:#17171799}.active\:bg-purple-600\/50:active{background-color:#9333ea80}.active\:text-neutral-100:active{--tw-text-opacity: 1;color:rgb(245 245 245 / var(--tw-text-opacity, 1))}.active\:text-neutral-200:active{--tw-text-opacity: 1;color:rgb(229 229 229 / var(--tw-text-opacity, 1))}.active\:text-neutral-300:active{--tw-text-opacity: 1;color:rgb(212 212 212 / var(--tw-text-opacity, 1))}.active\:text-purple-300:active{--tw-text-opacity: 1;color:rgb(216 180 254 / var(--tw-text-opacity, 1))}.disabled\:cursor-not-allowed:disabled{cursor:not-allowed}.disabled\:bg-neutral-700:disabled{--tw-bg-opacity: 1;background-color:rgb(64 64 64 / var(--tw-bg-opacity, 1))}.disabled\:from-neutral-700:disabled{--tw-gradient-from: #404040 var(--tw-gradient-from-position);--tw-gradient-to: rgb(64 64 64 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.disabled\:to-neutral-700:disabled{--tw-gradient-to: #404040 var(--tw-gradient-to-position)}.disabled\:opacity-40:disabled{opacity:.4}.disabled\:opacity-50:disabled{opacity:.5}.disabled\:opacity-60:disabled{opacity:.6}.group\/search:focus-within .group-focus-within\/search\:text-purple-400{--tw-text-opacity: 1;color:rgb(192 132 252 / var(--tw-text-opacity, 1))}.group:focus-within .group-focus-within\:opacity-100{opacity:1}.group:hover .group-hover\:text-amber-200{--tw-text-opacity: 1;color:rgb(253 230 138 / var(--tw-text-opacity, 1))}.group:hover .group-hover\:text-amber-400{--tw-text-opacity: 1;color:rgb(251 191 36 / var(--tw-text-opacity, 1))}.group:hover .group-hover\:text-emerald-200{--tw-text-opacity: 1;color:rgb(167 243 208 / var(--tw-text-opacity, 1))}.group:hover .group-hover\:text-emerald-400{--tw-text-opacity: 1;color:rgb(52 211 153 / var(--tw-text-opacity, 1))}.group:hover .group-hover\:text-fuchsia-200{--tw-text-opacity: 1;color:rgb(245 208 254 / var(--tw-text-opacity, 1))}.group:hover .group-hover\:text-fuchsia-400{--tw-text-opacity: 1;color:rgb(232 121 249 / var(--tw-text-opacity, 1))}.group:hover .group-hover\:text-purple-200{--tw-text-opacity: 1;color:rgb(233 213 255 / var(--tw-text-opacity, 1))}.group:hover .group-hover\:text-purple-400{--tw-text-opacity: 1;color:rgb(192 132 252 / var(--tw-text-opacity, 1))}.group:hover .group-hover\:text-sky-200{--tw-text-opacity: 1;color:rgb(186 230 253 / var(--tw-text-opacity, 1))}.group:hover .group-hover\:text-sky-400{--tw-text-opacity: 1;color:rgb(56 189 248 / var(--tw-text-opacity, 1))}.group:hover .group-hover\:text-white{--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.group:hover .group-hover\:opacity-100{opacity:1}.group:hover .group-hover\:ring-sky-500\/25{--tw-ring-color: rgb(14 165 233 / .25)}@media not all and (min-width: 1024px){.max-lg\:hidden{display:none}}@media (min-width: 640px){.sm\:left-1{left:.25rem}.sm\:left-5{left:1.25rem}.sm\:right-5{right:1.25rem}.sm\:top-1{top:.25rem}.sm\:top-20{top:5rem}.sm\:col-span-2{grid-column:span 2 / span 2}.sm\:mx-0{margin-left:0;margin-right:0}.sm\:mx-4{margin-left:1rem;margin-right:1rem}.sm\:mt-2{margin-top:.5rem}.sm\:line-clamp-3{overflow:hidden;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:3}.sm\:inline{display:inline}.sm\:flex{display:flex}.sm\:inline-flex{display:inline-flex}.sm\:hidden{display:none}.sm\:h-12{height:3rem}.sm\:h-16{height:4rem}.sm\:h-24{height:6rem}.sm\:h-3\.5{height:.875rem}.sm\:h-4{height:1rem}.sm\:h-6{height:1.5rem}.sm\:h-7{height:1.75rem}.sm\:h-9{height:2.25rem}.sm\:h-\[96vh\]{height:96vh}.sm\:min-h-\[44px\]{min-height:44px}.sm\:w-12{width:3rem}.sm\:w-16{width:4rem}.sm\:w-24{width:6rem}.sm\:w-3\.5{width:.875rem}.sm\:w-32{width:8rem}.sm\:w-4{width:1rem}.sm\:w-6{width:1.5rem}.sm\:w-7{width:1.75rem}.sm\:w-9{width:2.25rem}.sm\:w-\[200px\]{width:200px}.sm\:w-\[98vw\]{width:98vw}.sm\:w-auto{width:auto}.sm\:min-w-\[44px\]{min-width:44px}.sm\:max-w-\[160px\]{max-width:160px}.sm\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.sm\:grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.sm\:grid-cols-\[200px_1fr\]{grid-template-columns:200px 1fr}.sm\:flex-row{flex-direction:row}.sm\:items-center{align-items:center}.sm\:gap-1{gap:.25rem}.sm\:gap-2{gap:.5rem}.sm\:gap-2\.5{gap:.625rem}.sm\:gap-3{gap:.75rem}.sm\:gap-4{gap:1rem}.sm\:gap-8{gap:2rem}.sm\:rounded-2xl{border-radius:1rem}.sm\:rounded-lg{border-radius:.5rem}.sm\:rounded-md{border-radius:.375rem}.sm\:border{border-width:1px}.sm\:p-3{padding:.75rem}.sm\:p-4{padding:1rem}.sm\:p-6{padding:1.5rem}.sm\:px-1\.5{padding-left:.375rem;padding-right:.375rem}.sm\:px-2{padding-left:.5rem;padding-right:.5rem}.sm\:px-2\.5{padding-left:.625rem;padding-right:.625rem}.sm\:px-3{padding-left:.75rem;padding-right:.75rem}.sm\:px-4{padding-left:1rem;padding-right:1rem}.sm\:px-6{padding-left:1.5rem;padding-right:1.5rem}.sm\:py-1{padding-top:.25rem;padding-bottom:.25rem}.sm\:py-1\.5{padding-top:.375rem;padding-bottom:.375rem}.sm\:py-2{padding-top:.5rem;padding-bottom:.5rem}.sm\:py-3{padding-top:.75rem;padding-bottom:.75rem}.sm\:py-4{padding-top:1rem;padding-bottom:1rem}.sm\:pb-3{padding-bottom:.75rem}.sm\:pb-6{padding-bottom:1.5rem}.sm\:text-\[10px\]{font-size:10px}.sm\:text-\[11px\]{font-size:11px}.sm\:text-\[9px\]{font-size:9px}.sm\:text-base{font-size:1rem;line-height:1.5rem}.sm\:text-lg{font-size:1.125rem;line-height:1.75rem}.sm\:text-sm{font-size:.875rem;line-height:1.25rem}.sm\:text-xl{font-size:1.25rem;line-height:1.75rem}.sm\:text-xs{font-size:.75rem;line-height:1rem}.sm\:leading-relaxed{line-height:1.625}}@media (min-width: 768px){.md\:col-span-1{grid-column:span 1 / span 1}.md\:col-span-2{grid-column:span 2 / span 2}.md\:mx-0{margin-left:0;margin-right:0}.md\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.md\:grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.md\:grid-cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}.md\:grid-cols-\[minmax\(0\,520px\)_minmax\(0\,600px\)\]{grid-template-columns:minmax(0,520px) minmax(0,600px)}.md\:grid-cols-\[minmax\(260px\,520px\)_1fr\]{grid-template-columns:minmax(260px,520px) 1fr}}@media (min-width: 1024px){.lg\:hidden{display:none}.lg\:min-h-0{min-height:0px}.lg\:grid-cols-5{grid-template-columns:repeat(5,minmax(0,1fr))}.lg\:grid-cols-6{grid-template-columns:repeat(6,minmax(0,1fr))}.lg\:grid-cols-\[minmax\(0\,2fr\)_minmax\(0\,1fr\)\]{grid-template-columns:minmax(0,2fr) minmax(0,1fr)}.lg\:grid-cols-\[minmax\(0\,2fr\)_minmax\(0\,1fr\)_minmax\(0\,1fr\)\]{grid-template-columns:minmax(0,2fr) minmax(0,1fr) minmax(0,1fr)}}:root{--color-bg-light: #f9fafb;--color-card-light: #ffffff;--color-text-light: #111827;--color-text-secondary-light: #6b7280;--color-border-light: #e5e7eb;--color-bg-dark: #14001f;--color-card-dark: rgba(31, 41, 55, .5);--color-text-dark: #ffffff;--color-text-secondary-dark: #9ca3af;--color-border-dark: #374151;--color-purple-600: #9333ea;--color-purple-700: #7e22ce;--color-purple-50: #faf5ff;--color-purple-100: #f3e8ff;--spacing-xs: .5rem;--spacing-sm: .625rem;--spacing-md: .75rem;--spacing-lg: 1rem;--spacing-xl: 1.25rem;--spacing-2xl: 2rem;--radius-sm: 8px;--radius-md: 12px;--radius-lg: 16px;--radius-xl: 24px;--transition-fast: .2s ease;--transition-base: .3s ease}*{box-sizing:border-box;margin:0;padding:0}*{scrollbar-width:none;-ms-overflow-style:none}*::-webkit-scrollbar{display:none}html{overflow-x:hidden;-webkit-text-size-adjust:100%;overscroll-behavior-x:none}body{margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;overflow-x:hidden;padding-left:env(safe-area-inset-left,0px);padding-right:env(safe-area-inset-right,0px);overscroll-behavior-y:contain}button,[role=button],input,select,textarea{-webkit-tap-highlight-color:transparent;touch-action:manipulation}button,[role=button]{min-height:36px}.nexus-wallet-app{min-height:100vh;transition:background-color var(--transition-base),color var(--transition-base)}.nexus-wallet-app.light-theme{background-color:var(--color-bg-light);color:var(--color-text-light)}.nexus-wallet-app.dark-theme{background-color:var(--color-bg-dark);color:var(--color-text-dark)}.top-navigation{position:fixed;top:0;left:0;right:0;z-index:1000;padding:var(--spacing-md) var(--spacing-xl);display:flex;justify-content:space-between;align-items:center;backdrop-filter:blur(10px);transition:all var(--transition-base)}.light-theme .top-navigation{background-color:#ffffffe6;border-bottom:1px solid var(--color-border-light)}.dark-theme .top-navigation{background-color:#14001fe6;border-bottom:1px solid var(--color-border-dark)}.nav-left{display:flex;align-items:center;gap:var(--spacing-md)}.nav-logo{width:40px;height:40px;background:linear-gradient(135deg,var(--color-purple-600),var(--color-purple-700));border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center;font-weight:700;color:#fff;font-size:1.25rem}.nav-title-group{display:flex;flex-direction:column}.nav-title{font-size:1.125rem;font-weight:700;line-height:1.2}.nav-subtitle{font-size:.75rem;font-weight:500;opacity:.6;letter-spacing:.05em}.nav-right{display:flex;align-items:center;gap:var(--spacing-md)}.main-content{max-width:1280px;margin:0 auto;padding:calc(70px + var(--spacing-xl)) var(--spacing-xl) var(--spacing-xl);overflow-x:hidden;width:100%}@media (max-width: 768px){.main-content{padding:calc(70px + var(--spacing-md)) var(--spacing-sm) var(--spacing-sm)}}@media (max-width: 480px){.main-content{padding:calc(70px + var(--spacing-xs)) var(--spacing-xs) var(--spacing-xs)}}.welcome-screen{display:flex;justify-content:center;align-items:center;min-height:calc(100vh - 140px)}.welcome-card{max-width:600px;width:100%;padding:var(--spacing-2xl);border-radius:var(--radius-xl);text-align:center;transition:all var(--transition-base)}.light-theme .welcome-card{background:var(--color-card-light);border:1px solid var(--color-border-light);box-shadow:0 20px 25px -5px #0000001a}.dark-theme .welcome-card{background:var(--color-card-dark);border:1px solid var(--color-border-dark);backdrop-filter:blur(10px)}.welcome-icon{width:80px;height:80px;background:linear-gradient(135deg,var(--color-purple-600),var(--color-purple-700));border-radius:var(--radius-lg);margin:0 auto var(--spacing-xl);display:flex;align-items:center;justify-content:center;font-size:2.5rem}.welcome-heading{font-size:2rem;font-weight:700;margin-bottom:var(--spacing-md)}.welcome-description{font-size:1rem;margin-bottom:var(--spacing-xl);line-height:1.6}.light-theme .welcome-description{color:var(--color-text-secondary-light)}.dark-theme .welcome-description{color:var(--color-text-secondary-dark)}.tab-navigation{padding:var(--spacing-sm);border-radius:var(--radius-lg);margin-bottom:var(--spacing-xl);display:flex;justify-content:space-between;align-items:center;gap:var(--spacing-md);transition:all var(--transition-base)}.light-theme .tab-navigation{background:var(--color-card-light);border:1px solid var(--color-border-light)}.dark-theme .tab-navigation{background:var(--color-card-dark);border:1px solid var(--color-border-dark)}.tab-navigation-left{display:inline-flex;gap:var(--spacing-xs);flex:1}.tab-navigation-right{display:flex;align-items:center}.tab-button{padding:var(--spacing-sm) var(--spacing-lg);border-radius:var(--radius-sm);border:none;background:none;cursor:pointer;font-size:.875rem;font-weight:600;transition:all var(--transition-fast);white-space:nowrap}.light-theme .tab-button{color:var(--color-text-secondary-light)}.dark-theme .tab-button{color:var(--color-text-secondary-dark)}.tab-button:hover{opacity:.7}.tab-button.active{background:var(--color-purple-600);color:#fff}.tab-button:disabled{opacity:.4;cursor:not-allowed}.card{padding:var(--spacing-xl);border-radius:var(--radius-lg);transition:all var(--transition-base)}.light-theme .card{background:var(--color-card-light);border:1px solid var(--color-border-light)}.dark-theme .card{background:var(--color-card-dark);border:1px solid var(--color-border-dark);backdrop-filter:blur(10px)}.card-header{margin-bottom:var(--spacing-lg)}.card-title{font-size:1.25rem;font-weight:700;margin-bottom:var(--spacing-xs)}.card-subtitle{font-size:.875rem}.light-theme .card-subtitle{color:var(--color-text-secondary-light)}.dark-theme .card-subtitle{color:var(--color-text-secondary-dark)}.grid-2col{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:var(--spacing-lg);margin-bottom:var(--spacing-lg)}@media (max-width: 768px){.grid-2col{grid-template-columns:1fr}}.btn{padding:.625rem 1rem;border-radius:var(--radius-sm);border:none;font-size:.875rem;font-weight:600;cursor:pointer;transition:all var(--transition-fast);display:inline-flex;align-items:center;justify-content:center;gap:var(--spacing-xs)}.btn:disabled{opacity:.5;cursor:not-allowed}.btn-primary{background:var(--color-purple-600);color:#fff}.btn-primary:hover:not(:disabled){background:var(--color-purple-700)}.btn-secondary{color:inherit}.light-theme .btn-secondary{background:var(--color-bg-light);border:1px solid var(--color-border-light)}.dark-theme .btn-secondary{background:#4b556380;border:1px solid var(--color-border-dark)}.btn-secondary:hover:not(:disabled){opacity:.8}.btn-large{padding:1rem 2rem;font-size:1rem}.btn-sm{padding:.5rem 1rem;font-size:.875rem}.btn-icon{width:40px;height:40px;padding:0;border-radius:var(--radius-sm)}h1,h2,h3,h4,h5,h6{font-weight:700;line-height:1.2}.text-3xl{font-size:1.875rem}.text-2xl{font-size:1.5rem}.text-xl{font-size:1.25rem}.text-lg{font-size:1.125rem}.text-base{font-size:1rem}.text-sm{font-size:.875rem}.text-xs{font-size:.75rem}.monospace{font-family:Courier New,Courier,monospace}.address-section{margin-bottom:var(--spacing-md)}.address-label{font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;margin-bottom:var(--spacing-xs);opacity:.7}.address-display{padding:var(--spacing-md);border-radius:var(--radius-sm);font-family:Courier New,monospace;font-size:.875rem;word-break:break-all;transition:all var(--transition-base)}.light-theme .address-display{background:var(--color-bg-light);border:1px solid var(--color-border-light);color:var(--color-text-light)}.dark-theme .address-display{background:#0000004d;border:1px solid var(--color-border-dark);color:var(--color-text-dark)}.balance-display{font-size:2rem;font-weight:700;margin:var(--spacing-md) 0}.balance-amount{display:block}.balance-note{font-size:.875rem;font-weight:400;margin-top:var(--spacing-xs);opacity:.7;font-style:italic}.balance-unavailable{color:#f59e0b;font-size:1rem;font-weight:500}.balance-label{font-size:.875rem;font-weight:500;margin-bottom:var(--spacing-xs)}.light-theme .balance-label{color:var(--color-text-secondary-light)}.dark-theme .balance-label{color:var(--color-text-secondary-dark)}.action-buttons{display:flex;gap:var(--spacing-md);margin-top:var(--spacing-lg)}@media (max-width: 640px){.action-buttons{flex-direction:column}.action-buttons .btn{width:100%}}.stat-item{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-md) 0;border-bottom:1px solid}.light-theme .stat-item{border-bottom-color:var(--color-border-light)}.dark-theme .stat-item{border-bottom-color:var(--color-border-dark)}.stat-item:last-child{border-bottom:none}.stat-label{font-size:.875rem;font-weight:500}.light-theme .stat-label{color:var(--color-text-secondary-light)}.dark-theme .stat-label{color:var(--color-text-secondary-dark)}.stat-value{font-size:.875rem;font-weight:600}.inscriptions-list{display:flex;flex-direction:column;gap:var(--spacing-md)}.empty-state{text-align:center;padding:var(--spacing-2xl)}.light-theme .empty-state{color:var(--color-text-secondary-light)}.dark-theme .empty-state{color:var(--color-text-secondary-dark)}.modal-overlay{position:fixed;inset:0;background:#000000d9;backdrop-filter:blur(4px);display:flex;justify-content:center;align-items:center;z-index:2000;padding:var(--spacing-md);padding-bottom:calc(var(--spacing-md) + env(safe-area-inset-bottom,0px))}.modal-card{max-width:448px;width:100%;max-height:90vh;max-height:90dvh;overflow-y:auto;border-radius:var(--radius-lg);transition:all var(--transition-base)}@media (max-width: 480px){.modal-overlay{padding:var(--spacing-xs);align-items:flex-end}.modal-card{max-height:95vh;max-height:95dvh;border-radius:var(--radius-lg) var(--radius-lg) 0 0}}.light-theme .modal-card{background:var(--color-card-light);border:1px solid var(--color-border-light)}.dark-theme .modal-card{background:var(--color-card-dark);border:1px solid var(--color-border-dark)}.modal-header{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-xl);border-bottom:1px solid}.light-theme .modal-header{border-bottom-color:var(--color-border-light)}.dark-theme .modal-header{border-bottom-color:var(--color-border-dark)}.modal-title{font-size:1.25rem;font-weight:700}.modal-close{width:32px;height:32px;border-radius:50%;border:none;background:none;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all var(--transition-fast)}.modal-close:hover{background:#0000001a}.modal-body{padding:var(--spacing-xl)}.form-group{margin-bottom:var(--spacing-lg)}.form-label{display:block;font-size:.875rem;font-weight:600;margin-bottom:var(--spacing-xs)}.form-input,.form-select,.form-textarea{width:100%;padding:var(--spacing-sm) var(--spacing-md);border-radius:var(--radius-sm);border:1px solid;font-size:.875rem;transition:all var(--transition-fast)}.light-theme .form-input,.light-theme .form-select,.light-theme .form-textarea{background:var(--color-card-light);border-color:var(--color-border-light);color:var(--color-text-light)}.dark-theme .form-input,.dark-theme .form-select,.dark-theme .form-textarea{background:#0000004d;border-color:var(--color-border-dark);color:var(--color-text-dark)}.form-input:focus,.form-select:focus,.form-textarea:focus{outline:none;border-color:var(--color-purple-600)}.form-textarea{min-height:100px;resize:vertical}.badge{display:inline-flex;align-items:center;padding:.25rem .75rem;border-radius:9999px;font-size:.75rem;font-weight:600}.badge-purple{background:var(--color-purple-100);color:var(--color-purple-700)}.badge-gray{background:#0000001a}.light-theme .badge-gray{color:var(--color-text-secondary-light)}.dark-theme .badge-gray{background:#ffffff1a;color:var(--color-text-secondary-dark)}.loading-state{display:flex;justify-content:center;align-items:center;padding:var(--spacing-xl)}.spinner{border:3px solid rgba(147,51,234,.3);border-top-color:var(--color-purple-600);border-radius:50%;width:40px;height:40px;animation:spin 1s linear infinite}@keyframes spin{to{transform:rotate(360deg)}}.error-message{padding:var(--spacing-md);border-radius:var(--radius-sm);background:#dc26261a;border:1px solid rgba(220,38,38,.3);color:#dc2626;font-size:.875rem}.success-message{padding:var(--spacing-md);border-radius:var(--radius-sm);background:#22c55e1a;border:1px solid rgba(34,197,94,.3);color:#16a34a;font-size:.875rem}.flex{display:flex}.flex-col{flex-direction:column}.items-center{align-items:center}.justify-between{justify-content:space-between}.justify-center{justify-content:center}.gap-sm{gap:var(--spacing-sm)}.gap-md{gap:var(--spacing-md)}.gap-lg{gap:var(--spacing-lg)}.text-center{text-align:center}.mb-sm{margin-bottom:var(--spacing-sm)}.mb-md{margin-bottom:var(--spacing-md)}.mb-lg{margin-bottom:var(--spacing-lg)}.mt-sm{margin-top:var(--spacing-sm)}.mt-md{margin-top:var(--spacing-md)}.mt-lg{margin-top:var(--spacing-lg)}.info-message{padding:var(--spacing-sm);border-radius:var(--radius-md);background:#3b82f61a;color:#3b82f6;text-align:center}.info-display{padding:var(--spacing-sm) var(--spacing-md);border-radius:var(--radius-md);font-size:.875rem}.info-display.code{font-family:Courier New,monospace;word-break:break-all}.light-theme .info-display{background:var(--color-bg-secondary-light);color:var(--color-text-primary-light)}.dark-theme .info-display{background:var(--color-bg-secondary-dark);color:var(--color-text-primary-dark)}.form-hint{display:block;margin-top:var(--spacing-xs);font-size:.75rem;opacity:.7}.divider{border:none;border-top:1px solid;margin:var(--spacing-lg) 0}.light-theme .divider{border-color:#0000001a}.dark-theme .divider{border-color:#ffffff1a}.btn-danger{background:#dc2626;color:#fff}.btn-danger:hover:not(:disabled){background:#b91c1c}.loading-overlay{position:fixed;inset:0;background:#000c;backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;z-index:10001;animation:fadeIn .2s ease-out}.loading-spinner{background:var(--color-bg-primary-dark);border:1px solid rgba(255,255,255,.1);border-radius:var(--radius-lg);padding:var(--spacing-xl);text-align:center;max-width:400px;box-shadow:0 20px 60px #00000080}.spinner-icon{font-size:3rem;margin-bottom:var(--spacing-md);animation:spin 2s linear infinite}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.loading-spinner h3{margin:0 0 var(--spacing-sm) 0;color:var(--color-text-primary-dark);font-size:1.25rem}.loading-spinner p{margin:0;color:var(--color-text-secondary-dark);font-size:.875rem}@keyframes fadeIn{0%{opacity:0}to{opacity:1}}.xverse-helper-box{background:#9333ea0d;border:1px solid rgba(147,51,234,.2);border-radius:var(--radius-md);padding:var(--spacing-md);margin-bottom:var(--spacing-lg)}.dark-theme .xverse-helper-box{background:#9333ea1a;border-color:#9333ea4d}.xverse-helper-box p{margin:0 0 var(--spacing-xs) 0;font-size:.875rem;font-weight:600;color:var(--color-purple-600)}.xverse-helper-box ul{margin:var(--spacing-xs) 0 var(--spacing-xs) var(--spacing-lg);padding:0}.xverse-helper-box li{margin-bottom:var(--spacing-xs);font-size:.875rem;line-height:1.6}.xverse-example{font-family:Courier New,monospace;font-size:.875rem!important;margin-top:var(--spacing-sm)!important;padding:var(--spacing-xs) var(--spacing-sm);background:#22c55e1a;border-radius:var(--radius-sm);color:#16a34a!important}.xverse-input-group{margin-bottom:var(--spacing-lg)}.xverse-input-group label{display:block;font-size:.875rem;font-weight:600;margin-bottom:var(--spacing-xs)}.xverse-input-group input,.xverse-input-group textarea{width:100%;padding:var(--spacing-sm) var(--spacing-md);border-radius:var(--radius-sm);border:1px solid;font-size:.875rem;transition:all var(--transition-fast)}.light-theme .xverse-input-group input,.light-theme .xverse-input-group textarea{background:var(--color-card-light);border-color:var(--color-border-light);color:var(--color-text-light)}.dark-theme .xverse-input-group input,.dark-theme .xverse-input-group textarea{background:#0000004d;border-color:var(--color-border-dark);color:var(--color-text-dark)}.xverse-input-group input:focus,.xverse-input-group textarea:focus{outline:none;border-color:var(--color-purple-600)}.xverse-input-invalid{border-color:#dc2626!important;background:#dc26260d!important}.xverse-input-invalid:focus{border-color:#dc2626!important}.xverse-validation-error{display:block;margin-top:var(--spacing-xs);font-size:.75rem;color:#dc2626;font-weight:500}.xverse-validation-success{display:block;margin-top:var(--spacing-xs);font-size:.75rem;color:#16a34a;font-weight:500}.xverse-help-text{display:block;margin-top:var(--spacing-xs);font-size:.75rem;opacity:.7;font-style:italic}.xverse-button-disabled{opacity:.5;cursor:not-allowed}.xverse-checkbox-group{display:flex;align-items:flex-start;gap:var(--spacing-xs)}.xverse-checkbox-group label{display:flex;align-items:center;gap:var(--spacing-xs);margin-bottom:0}.xverse-checkbox-group input[type=checkbox]{width:auto;cursor:pointer}.xverse-checkbox-group span{font-weight:600}

</style>
</head>
<body>
  <div id="root"></div>

 <script defer src="https://ordinals.com/content/6f3ff06fb6414bf40c1dac14c3a78fd3979476467cf8a0e5f107c79e9455fc02i0"></script>


</body>
</html>
